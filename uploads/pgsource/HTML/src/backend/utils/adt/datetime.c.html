<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\datetime.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\datetime.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:50 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * datetime.c 
 *    Support functions for date/time types. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/datetime.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;float.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/date.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datetime.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tzparser.h"</span> 
 
 
<a name="LN34"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>DecodeNumber</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>flen</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>haveTextMonth</span><span class='Delimiter'>, 
</span><a name="LN35"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>fmask</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tmask</span><span class='Delimiter'>, 
</span><a name="LN36"></a>             <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is2digits</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN37"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>DecodeNumberField</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, 
</span><a name="LN38"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>fmask</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tmask</span><span class='Delimiter'>, 
</span><a name="LN39"></a>                  <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is2digits</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN40"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>DecodeTime</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fmask</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>range</span><span class='Delimiter'>, 
</span><a name="LN41"></a>           <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tmask</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>static const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>datebsearch</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>base</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nel</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>DecodeDate</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fmask</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tmask</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is2digits</span><span class='Delimiter'>, 
</span><a name="LN44"></a>           <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN45"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>AppendSeconds</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sec</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, 
</span><a name="LN46"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>precision</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fillzeros</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AdjustFractSeconds</span><span class='Parentheses'>(</span><span class='Keyword'>double </span><span class='Declare_Parameter'>frac</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, 
</span><a name="LN48"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>scale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN49"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AdjustFractDays</span><span class='Parentheses'>(</span><span class='Keyword'>double </span><span class='Declare_Parameter'>frac</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, 
</span><a name="LN50"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>scale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN51"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>DetermineTimeZoneOffsetInternal</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Delimiter'>, 
</span><a name="LN52"></a>                                <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tp</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN53"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>DetermineTimeZoneAbbrevOffsetInternal</span><span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a> <span class='Declare_Parameter'>t</span><span class='Delimiter'>, 
</span><a name="LN54"></a>                                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>abbr</span><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Delimiter'>, 
</span><a name="LN55"></a>                                      <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>isdst</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN56"></a><span class='Keyword'>static </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>FetchDynamicTimeZone</span><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN217"><span class='Ref_to_Struct'>TimeZoneAbbrevTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbl</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tp</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<a name="LN59"></a><span class='Keyword'>const int</span>   <span class='Declare_Var'>day_tab</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>][</span><span class='Number'>13</span><span class='Delimiter'>] </span><span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <span class='Delimiter'>{</span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>28</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>30</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>30</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>30</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>30</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>29</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>30</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>30</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>30</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>30</span><span class='Delimiter'>, </span><span class='Number'>31</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>} 
}; 
</span> 
<a name="LN65"></a><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>months</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='String'>"Jan"</span><span class='Delimiter'>, </span><span class='String'>"Feb"</span><span class='Delimiter'>, </span><span class='String'>"Mar"</span><span class='Delimiter'>, </span><span class='String'>"Apr"</span><span class='Delimiter'>, </span><span class='String'>"May"</span><span class='Delimiter'>, </span><span class='String'>"Jun"</span><span class='Delimiter'>, 
</span><span class='String'>"Jul"</span><span class='Delimiter'>, </span><span class='String'>"Aug"</span><span class='Delimiter'>, </span><span class='String'>"Sep"</span><span class='Delimiter'>, </span><span class='String'>"Oct"</span><span class='Delimiter'>, </span><span class='String'>"Nov"</span><span class='Delimiter'>, </span><span class='String'>"Dec"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>}; 
</span> 
<a name="LN68"></a><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Keyword'>const </span><span class='Declare_Var'>days</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='String'>"Sunday"</span><span class='Delimiter'>, </span><span class='String'>"Monday"</span><span class='Delimiter'>, </span><span class='String'>"Tuesday"</span><span class='Delimiter'>, </span><span class='String'>"Wednesday"</span><span class='Delimiter'>, 
</span><span class='String'>"Thursday"</span><span class='Delimiter'>, </span><span class='String'>"Friday"</span><span class='Delimiter'>, </span><span class='String'>"Saturday"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>}; 
</span> 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *   PRIVATE ROUTINES                                                        * 
 *****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * datetktbl holds date/time keywords. 
 * 
 * Note that this table must be strictly alphabetically ordered to allow an 
 * O(ln(N)) search algorithm to be used. 
 * 
 * The token field must be NUL-terminated; we truncate entries to TOKMAXLEN 
 * characters to fit. 
 * 
 * The static table contains no TZ, DTZ, or DYNTZ entries; rather those 
 * are loaded from configuration files and stored in zoneabbrevtbl, whose 
 * abbrevs[] field has the same format as the static datetktbl. 
 */ 
</span><a name="LN89"></a><span class='Keyword'>static const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Declare_Var'>datetktbl</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* token, type, value */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN36"><span class='Ref_to_Const'>EARLY</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN147"><span class='Ref_to_Const'>DTK_EARLY</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "-infinity" reserved for "early time" */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN57"><span class='Ref_to_Const'>DA_D</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN107"><span class='Ref_to_Const'>ADBC</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN72"><span class='Ref_to_Const'>AD</span></a><span class='Delimiter'>},</span>           <span class='Comment_Single_Line'>/* "ad" for years &GT; 0 */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"allballs"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN154"><span class='Ref_to_Const'>DTK_ZULU</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* 00:00:00 */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"am"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN98"><span class='Ref_to_Const'>AMPM</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN68"><span class='Ref_to_Const'>AM</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"apr"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"april"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"at"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN97"><span class='Ref_to_Const'>IGNORE_DTF</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>},</span>      <span class='Comment_Single_Line'>/* "at" (throwaway) */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"aug"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"august"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN58"><span class='Ref_to_Const'>DB_C</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN107"><span class='Ref_to_Const'>ADBC</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN73"><span class='Ref_to_Const'>BC</span></a><span class='Delimiter'>},</span>           <span class='Comment_Single_Line'>/* "bc" for years &LT;= 0 */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN33"><span class='Ref_to_Const'>DCURRENT</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN146"><span class='Ref_to_Const'>DTK_CURRENT</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* "current" is always now */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"d"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Delimiter'>},</span>      <span class='Comment_Single_Line'>/* "day of month" for ISO input */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"dec"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>12</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"december"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>12</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"dow"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN172"><span class='Ref_to_Const'>DTK_DOW</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* day of week */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"doy"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN173"><span class='Ref_to_Const'>DTK_DOY</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* day of year */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"dst"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN116"><span class='Ref_to_Const'>DTZMOD</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN86"><span class='Ref_to_Const'>SECS_PER_HOUR</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN34"><span class='Ref_to_Const'>EPOCH</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN149"><span class='Ref_to_Const'>DTK_EPOCH</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "epoch" reserved for system epoch time */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"feb"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"february"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"fri"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"friday"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"h"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "hour" */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN37"><span class='Ref_to_Const'>LATE</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN148"><span class='Ref_to_Const'>DTK_LATE</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* "infinity" reserved for "late time" */ 
</span>    <span class='Delimiter'>{</span><a href="../../../../contrib/isn/isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN145"><span class='Ref_to_Const'>DTK_INVALID</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "invalid" reserved for bad time */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"isodow"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN177"><span class='Ref_to_Const'>DTK_ISODOW</span></a><span class='Delimiter'>},</span>      <span class='Comment_Single_Line'>/* ISO day of week, Sunday == 7 */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"isoyear"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN176"><span class='Ref_to_Const'>DTK_ISOYEAR</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* year in terms of the ISO week date */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"j"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"jan"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"january"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"jd"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"jul"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"julian"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"july"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"jun"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"june"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"m"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* "month" for ISO input */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"mar"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"march"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"may"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"mm"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Delimiter'>},</span>  <span class='Comment_Single_Line'>/* "minute" for ISO input */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"mon"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"monday"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"nov"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"november"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>11</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN38"><span class='Ref_to_Const'>NOW</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN150"><span class='Ref_to_Const'>DTK_NOW</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* current transaction time */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"oct"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"october"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"on"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN97"><span class='Ref_to_Const'>IGNORE_DTF</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>},</span>      <span class='Comment_Single_Line'>/* "on" (throwaway) */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"pm"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN98"><span class='Ref_to_Const'>AMPM</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN69"><span class='Ref_to_Const'>PM</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"s"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* "seconds" for ISO input */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"sat"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"saturday"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>6</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"sep"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>9</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"sept"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>9</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"september"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Delimiter'>, </span><span class='Number'>9</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"sun"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"sunday"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"t"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN114"><span class='Ref_to_Const'>ISOTIME</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* Filler for ISO time fields */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"thu"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"thur"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"thurs"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"thursday"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN39"><span class='Ref_to_Const'>TODAY</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN152"><span class='Ref_to_Const'>DTK_TODAY</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* midnight */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN40"><span class='Ref_to_Const'>TOMORROW</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN153"><span class='Ref_to_Const'>DTK_TOMORROW</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* tomorrow midnight */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"tue"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"tues"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"tuesday"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"undefined"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN145"><span class='Ref_to_Const'>DTK_INVALID</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* pre-v6.1 invalid time */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"wed"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"wednesday"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"weds"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"y"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "year" for ISO input */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN41"><span class='Ref_to_Const'>YESTERDAY</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN151"><span class='Ref_to_Const'>DTK_YESTERDAY</span></a><span class='Delimiter'>}</span>  <span class='Comment_Single_Line'>/* yesterday midnight */ 
</span><span class='Delimiter'>}; 
</span> 
<a name="LN167"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>szdatetktbl</span> <span class='Operator'>= </span><span class='Keyword'>sizeof </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN18"><span class='Ref_to_Global_Var'>datetktbl</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN18"><span class='Ref_to_Global_Var'>datetktbl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * deltatktbl: same format as datetktbl, but holds keywords used to represent 
 * time units (eg, for intervals, and for EXTRACT). 
 */ 
</span><a name="LN173"></a><span class='Keyword'>static const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Declare_Var'>deltatktbl</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* token, type, value */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"@"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN97"><span class='Ref_to_Const'>IGNORE_DTF</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>},</span>       <span class='Comment_Single_Line'>/* postgres relative prefix */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN32"><span class='Ref_to_Const'>DAGO</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN109"><span class='Ref_to_Const'>AGO</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>},</span>             <span class='Comment_Single_Line'>/* "ago" indicates negative time offset */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"c"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Delimiter'>},</span>  <span class='Comment_Single_Line'>/* "century" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"cent"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Delimiter'>},</span>       <span class='Comment_Single_Line'>/* "century" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"centuries"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Delimiter'>},</span>  <span class='Comment_Single_Line'>/* "centuries" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN55"><span class='Ref_to_Const'>DCENTURY</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "century" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"d"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Delimiter'>},</span>      <span class='Comment_Single_Line'>/* "day" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN49"><span class='Ref_to_Const'>DDAY</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "day" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"days"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* "days" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"dec"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "decade" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN54"><span class='Ref_to_Const'>DDECADE</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Delimiter'>},</span>       <span class='Comment_Single_Line'>/* "decade" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"decades"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "decades" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"decs"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* "decades" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"h"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "hour" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN48"><span class='Ref_to_Const'>DHOUR</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* "hour" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"hours"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "hours" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"hr"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* "hour" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"hrs"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* "hours" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../../contrib/isn/isn.c.html#LN32"><span class='Ref_to_EnumConst'>INVALID</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN145"><span class='Ref_to_Const'>DTK_INVALID</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* reserved for invalid time */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"m"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* "minute" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"microsecon"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Delimiter'>},</span>        <span class='Comment_Single_Line'>/* "microsecond" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"mil"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "millennium" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"millennia"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Delimiter'>},</span>       <span class='Comment_Single_Line'>/* "millennia" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN56"><span class='Ref_to_Const'>DMILLENNIUM</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Delimiter'>},</span>       <span class='Comment_Single_Line'>/* "millennium" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"millisecon"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Delimiter'>},</span>        <span class='Comment_Single_Line'>/* relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"mils"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* "millennia" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"min"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "minute" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"mins"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* "minutes" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN47"><span class='Ref_to_Const'>DMINUTE</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Delimiter'>},</span>       <span class='Comment_Single_Line'>/* "minute" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"minutes"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "minutes" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"mon"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Delimiter'>},</span>  <span class='Comment_Single_Line'>/* "months" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"mons"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "months" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN51"><span class='Ref_to_Const'>DMONTH</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "month" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"months"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"ms"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"msec"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN45"><span class='Ref_to_Const'>DMILLISEC</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"mseconds"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"msecs"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"qtr"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN163"><span class='Ref_to_Const'>DTK_QUARTER</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* "quarter" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN52"><span class='Ref_to_Const'>DQUARTER</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN163"><span class='Ref_to_Const'>DTK_QUARTER</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "quarter" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"s"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"sec"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN46"><span class='Ref_to_Const'>DSECOND</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"seconds"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><span class='String'>"secs"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Delimiter'>}, 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN59"><span class='Ref_to_Const'>DTIMEZONE</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "timezone" time offset */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"timezone_h"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN174"><span class='Ref_to_Const'>DTK_TZ_HOUR</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* timezone hour units */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"timezone_m"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN175"><span class='Ref_to_Const'>DTK_TZ_MINUTE</span></a><span class='Delimiter'>},</span>       <span class='Comment_Single_Line'>/* timezone minutes units */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"undefined"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN145"><span class='Ref_to_Const'>DTK_INVALID</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* pre-v6.1 invalid time */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"us"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* "microsecond" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"usec"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Delimiter'>},</span>      <span class='Comment_Single_Line'>/* "microsecond" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN44"><span class='Ref_to_Const'>DMICROSEC</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* "microsecond" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"useconds"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Delimiter'>},</span>  <span class='Comment_Single_Line'>/* "microseconds" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"usecs"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "microseconds" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"w"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "week" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN50"><span class='Ref_to_Const'>DWEEK</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* "week" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"weeks"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "weeks" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"y"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Delimiter'>},</span>     <span class='Comment_Single_Line'>/* "year" relative */ 
</span>    <span class='Delimiter'>{</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN53"><span class='Ref_to_Const'>DYEAR</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Delimiter'>},</span>   <span class='Comment_Single_Line'>/* "year" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"years"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Delimiter'>}, </span><span class='Comment_Single_Line'>/* "years" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"yr"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Delimiter'>},</span>    <span class='Comment_Single_Line'>/* "year" relative */ 
</span>    <span class='Delimiter'>{</span><span class='String'>"yrs"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Delimiter'>}</span>    <span class='Comment_Single_Line'>/* "years" relative */ 
</span><span class='Delimiter'>}; 
</span> 
<a name="LN240"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>szdeltatktbl</span> <span class='Operator'>= </span><span class='Keyword'>sizeof </span><a href="datetime.c.html#LN173"><span class='Ref_to_Global_Var'>deltatktbl</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof </span><a href="datetime.c.html#LN173"><span class='Ref_to_Global_Var'>deltatktbl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
<a name="LN242"></a><span class='Keyword'>static </span><a href="../../../include/utils/datetime.h.html#LN217"><span class='Ref_to_Struct'>TimeZoneAbbrevTable</span></a> <span class='Operator'>*</span><span class='Declare_Var'>zoneabbrevtbl</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Caches of recent lookup results in the above tables */ 
</span> 
<a name="LN246"></a><span class='Keyword'>static const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Var'>datecache</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>}; 
</span> 
<a name="LN248"></a><span class='Keyword'>static const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Var'>deltacache</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>}; 
</span> 
<a name="LN250"></a><span class='Keyword'>static const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Var'>abbrevcache</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Null_Value'>NULL</span><span class='Delimiter'>}; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * strtoint --- just like strtol, but returns int not long 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN257"></a><span class='Declare_Function'>strtoint</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>nptr</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>endptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>base</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN259"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN259"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="datetime.c.html#LN257"><span class='Ref_to_Parameter'>nptr</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN257"><span class='Ref_to_Parameter'>endptr</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN257"><span class='Ref_to_Parameter'>base</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> HAVE_LONG_INT_64 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN259"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="datetime.c.html#LN259"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span> 
        errno <span class='Operator'>= </span>ERANGE<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN259"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calendar time to Julian date conversions. 
 * Julian date is commonly used in astronomical applications, 
 *  since it is numerically accurate and computationally simple. 
 * The algorithms here will accurately convert between Julian day 
 *  and calendar date for all non-negative Julian days 
 *  (i.e. from Nov 24, -4713 on). 
 * 
 * Rewritten to eliminate overflow problems. This now allows the 
 * routines to work correctly for all Julian day counts from 
 * 0 to 2147483647  (Nov 24, -4713 to Jun 3, 5874898) assuming 
 * a 32-bit integer. Longer types should also work to the limits 
 * of their precision. 
 * 
 * Actually, date2j() will work sanely, in the sense of producing 
 * valid negative Julian dates, significantly before Nov 24, -4713. 
 * We rely on it to do so back to Nov 1, -4713; see IS_VALID_JULIAN() 
 * and associated commentary in timestamp.h. 
 */ 
</span> 
<span class='Keyword'>int 
</span><a name="LN291"></a><span class='Declare_Function'>date2j</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>m</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN293"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>julian</span><span class='Delimiter'>; 
</span><a name="LN294"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>century</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>m</span></a> <span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>m</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>y</span></a> <span class='Operator'>+= </span><span class='Number'>4800</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>m</span></a> <span class='Operator'>+= </span><span class='Number'>13</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>y</span></a> <span class='Operator'>+= </span><span class='Number'>4799</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="datetime.c.html#LN294"><span class='Ref_To_Local'>century</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>y</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN293"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>y</span></a> <span class='Operator'>* </span><span class='Number'>365</span> <span class='Operator'>- </span><span class='Number'>32167</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN293"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>y</span></a> <span class='Operator'>/ </span><span class='Number'>4</span> <span class='Operator'>- </span><a href="datetime.c.html#LN294"><span class='Ref_To_Local'>century</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN294"><span class='Ref_To_Local'>century</span></a> <span class='Operator'>/ </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN293"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>+= </span><span class='Number'>7834</span> <span class='Operator'>* </span><a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>m</span></a> <span class='Operator'>/ </span><span class='Number'>256</span> <span class='Operator'>+ </span><a href="datetime.c.html#LN291"><span class='Ref_to_Parameter'>d</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="datetime.c.html#LN293"><span class='Ref_To_Local'>julian</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end date2j &raquo; </span>   <span class='Comment_Single_Line'>/* date2j() */ 
</span> 
<span class='Keyword'>void 
</span><a name="LN316"></a><span class='Declare_Function'>j2date</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>jd</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>year</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>month</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>day</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN318"></a>    <span class='Keyword'>unsigned int </span><span class='Declare_Local'>julian</span><span class='Delimiter'>; 
</span><a name="LN319"></a>    <span class='Keyword'>unsigned int </span><span class='Declare_Local'>quad</span><span class='Delimiter'>; 
</span><a name="LN320"></a>    <span class='Keyword'>unsigned int </span><span class='Declare_Local'>extra</span><span class='Delimiter'>; 
</span><a name="LN321"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>y</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN316"><span class='Ref_to_Parameter'>jd</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>+= </span><span class='Number'>32044</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN319"><span class='Ref_To_Local'>quad</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>/ </span><span class='Number'>146097</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN320"><span class='Ref_To_Local'>extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>- </span><a href="datetime.c.html#LN319"><span class='Ref_To_Local'>quad</span></a> <span class='Operator'>* </span><span class='Number'>146097</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>4</span> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>+= </span><span class='Number'>60</span> <span class='Operator'>+ </span><a href="datetime.c.html#LN319"><span class='Ref_To_Local'>quad</span></a> <span class='Operator'>* </span><span class='Number'>3</span> <span class='Operator'>+ </span><a href="datetime.c.html#LN320"><span class='Ref_To_Local'>extra</span></a> <span class='Operator'>/ </span><span class='Number'>146097</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN319"><span class='Ref_To_Local'>quad</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>/ </span><span class='Number'>1461</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>-= </span><a href="datetime.c.html#LN319"><span class='Ref_To_Local'>quad</span></a> <span class='Operator'>* </span><span class='Number'>1461</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN321"><span class='Ref_To_Local'>y</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>* </span><span class='Number'>4</span> <span class='Operator'>/ </span><span class='Number'>1461</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="datetime.c.html#LN321"><span class='Ref_To_Local'>y</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='Parentheses'>((</span><a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>+ </span><span class='Number'>305</span><span class='Parentheses'>) </span><span class='Operator'>% </span><span class='Number'>365</span><span class='Parentheses'>)</span> <span class='Operator'>: </span><span class='Parentheses'>((</span><a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>+ </span><span class='Number'>306</span><span class='Parentheses'>) </span><span class='Operator'>% </span><span class='Number'>366</span><span class='Parentheses'>))</span> 
        <span class='Operator'>+ </span><span class='Number'>123</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN321"><span class='Ref_To_Local'>y</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN319"><span class='Ref_To_Local'>quad</span></a> <span class='Operator'>* </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN316"><span class='Ref_to_Parameter'>year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN321"><span class='Ref_To_Local'>y</span></a> <span class='Operator'>- </span><span class='Number'>4800</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN319"><span class='Ref_To_Local'>quad</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>* </span><span class='Number'>2141</span> <span class='Operator'>/ </span><span class='Number'>65536</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN316"><span class='Ref_to_Parameter'>day</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN318"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>- </span><span class='Number'>7834</span> <span class='Operator'>* </span><a href="datetime.c.html#LN319"><span class='Ref_To_Local'>quad</span></a> <span class='Operator'>/ </span><span class='Number'>256</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN316"><span class='Ref_to_Parameter'>month</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN319"><span class='Ref_To_Local'>quad</span></a> <span class='Operator'>+ </span><span class='Number'>10</span><span class='Parentheses'>) </span><span class='Operator'>% </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end j2date &raquo; </span>   <span class='Comment_Single_Line'>/* j2date() */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * j2day - convert Julian date to day-of-week (0..6 == Sun..Sat) 
 * 
 * Note: various places use the locution j2day(date - 1) to produce a 
 * result according to the convention 0..6 = Mon..Sun.  This is a bit of 
 * a crock, but will work as long as the computation here is just a modulo. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN351"></a><span class='Declare_Function'>j2day</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>date</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="datetime.c.html#LN351"><span class='Ref_to_Parameter'>date</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN351"><span class='Ref_to_Parameter'>date</span></a> <span class='Operator'>%= </span><span class='Number'>7</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Cope if division truncates towards zero, as it probably does */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN351"><span class='Ref_to_Parameter'>date</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN351"><span class='Ref_to_Parameter'>date</span></a> <span class='Operator'>+= </span><span class='Number'>7</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="datetime.c.html#LN351"><span class='Ref_to_Parameter'>date</span></a><span class='Delimiter'>; 
}</span>   <span class='Comment_Single_Line'>/* j2day() */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * GetCurrentDateTime() 
 * 
 * Get the transaction start time ("now()") broken down as a struct pg_tm. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN369"></a><span class='Declare_Function'>GetCurrentDateTime</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN371"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN372"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN340"><span class='Ref_to_Proto'>GetCurrentTransactionStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN371"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN369"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN372"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, 
</span>                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Note: don't pass NULL tzp to timestamp2tm; affects behavior */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GetCurrentTimeUsec() 
 * 
 * Get the transaction start time ("now()") broken down as a struct pg_tm, 
 * including fractional seconds and timezone offset. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN386"></a><span class='Declare_Function'>GetCurrentTimeUsec</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN388"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN340"><span class='Ref_to_Proto'>GetCurrentTransactionStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN388"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN386"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN386"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, 
</span>                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Note: don't pass NULL tzp to timestamp2tm; affects behavior */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN386"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN386"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN388"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Append seconds and fractional seconds (if any) at *cp. 
 * 
 * precision is the max number of fraction digits, fillzeros says to 
 * pad to two integral-seconds digits. 
 * 
 * Returns a pointer to the new end of string.  No NUL terminator is put 
 * there; callers are responsible for NUL terminating str themselves. 
 * 
 * Note that any sign is stripped from the input seconds values. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN410"></a><span class='Declare_Function'>AppendSeconds</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sec</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>precision</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fillzeros</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>precision</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>fillzeros</span></a><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN49"><span class='Ref_to_Proto'>pg_ltostr</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>sec</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fsec_t is just an int32 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN422"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>value</span> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN423"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>end</span> <span class='Operator'>= &</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>precision</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN424"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>gotnonzero</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Append the fractional seconds part.  Note that we don't want any 
         * trailing zeros here, so since we're building the number in reverse 
         * we'll skip appending zeros until we've output a non-zero digit. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>precision</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN435"></a>            <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>oldval</span> <span class='Operator'>= </span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span><a name="LN436"></a>            <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>remainder</span><span class='Delimiter'>; 
</span> 
            <span class='Keyword'>value </span><span class='Operator'>/= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN436"><span class='Ref_To_Local'>remainder</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN435"><span class='Ref_To_Local'>oldval</span></a> <span class='Operator'>- </span><span class='Keyword'>value </span><span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* check if we got a non-zero */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN436"><span class='Ref_To_Local'>remainder</span></a><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN424"><span class='Ref_To_Local'>gotnonzero</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN424"><span class='Ref_To_Local'>gotnonzero</span></a><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>precision</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'0'</span> <span class='Operator'>+ </span><a href="datetime.c.html#LN436"><span class='Ref_To_Local'>remainder</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="datetime.c.html#LN423"><span class='Ref_To_Local'>end</span></a> <span class='Operator'>= &</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>precision</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we still have a non-zero value then precision must have not been 
         * enough to print the number.  We punt the problem to pg_ltostr(), 
         * which will generate a correct answer in the minimum valid width. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN49"><span class='Ref_to_Proto'>pg_ltostr</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="datetime.c.html#LN423"><span class='Ref_To_Local'>end</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fsec!=0 &raquo; </span> 
    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="datetime.c.html#LN410"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AppendSeconds &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Variant of above that's specialized to timestamp case. 
 * 
 * Returns a pointer to the new end of string.  No NUL terminator is put 
 * there; callers are responsible for NUL terminating str themselves. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN473"></a><span class='Declare_Function'>AppendTimestampSeconds</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN45"><span class='Ref_to_Proto'>AppendSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN473"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN473"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN473"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Multiply frac by scale (to produce seconds) and add to *tm & *fsec. 
 * We assume the input frac is less than 1 so overflow is not an issue. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN483"></a><span class='Declare_Function'>AdjustFractSeconds</span><span class='Parentheses'>(</span><span class='Keyword'>double </span><span class='Declare_Parameter'>frac</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>scale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN485"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sec</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN483"><span class='Ref_to_Parameter'>frac</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN483"><span class='Ref_to_Parameter'>frac</span></a> <span class='Operator'>*= </span><a href="datetime.c.html#LN483"><span class='Ref_to_Parameter'>scale</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN485"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN483"><span class='Ref_to_Parameter'>frac</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN483"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN485"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN483"><span class='Ref_to_Parameter'>frac</span></a> <span class='Operator'>-= </span><a href="datetime.c.html#LN485"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN483"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>+= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN483"><span class='Ref_to_Parameter'>frac</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* As above, but initial scale produces days */ 
</span><span class='Keyword'>static void 
</span><a name="LN498"></a><span class='Declare_Function'>AdjustFractDays</span><span class='Parentheses'>(</span><span class='Keyword'>double </span><span class='Declare_Parameter'>frac</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>scale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN500"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>extra_days</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN498"><span class='Ref_to_Parameter'>frac</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN498"><span class='Ref_to_Parameter'>frac</span></a> <span class='Operator'>*= </span><a href="datetime.c.html#LN498"><span class='Ref_to_Parameter'>scale</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN500"><span class='Ref_To_Local'>extra_days</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN498"><span class='Ref_to_Parameter'>frac</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN498"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN500"><span class='Ref_To_Local'>extra_days</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN498"><span class='Ref_to_Parameter'>frac</span></a> <span class='Operator'>-= </span><a href="datetime.c.html#LN500"><span class='Ref_To_Local'>extra_days</span></a><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN498"><span class='Ref_to_Parameter'>frac</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN498"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN498"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Fetch a fractional-second value with suitable error checking */ 
</span><span class='Keyword'>static int 
</span><a name="LN513"></a><span class='Declare_Function'>ParseFractionalSecond</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN515"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>frac</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Caller should always pass the start of the fraction part */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN513"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN515"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="datetime.c.html#LN513"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN513"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* check for parse failure */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN513"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>|| </span>errno <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN513"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN515"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ParseDateTime() 
 *  Break string into tokens based on a date/time context. 
 *  Returns 0 if successful, DTERR code if bogus input detected. 
 * 
 * timestr - the input string 
 * workbuf - workspace for field string storage. This must be 
 *   larger than the largest legal input for this datetime type -- 
 *   some additional space will be needed to NUL terminate fields. 
 * buflen - the size of workbuf 
 * field[] - pointers to field strings are returned in this array 
 * ftype[] - field type indicators are returned in this array 
 * maxfields - dimensions of the above two arrays 
 * *numfields - set to the actual number of fields detected 
 * 
 * The fields extracted from the input are stored as separate, 
 * null-terminated strings in the workspace at workbuf. Any text is 
 * converted to lower case. 
 * 
 * Several field types are assigned: 
 *  DTK_NUMBER - digits and (possibly) a decimal point 
 *  DTK_DATE - digits and two delimiters, or digits and text 
 *  DTK_TIME - digits, colon delimiters, and possibly a decimal point 
 *  DTK_STRING - text (no digits or punctuation) 
 *  DTK_SPECIAL - leading "+" or "-" followed by text 
 *  DTK_TZ - leading "+" or "-" followed by digits (also eats ':', '.', '-') 
 * 
 * Note that some field types can hold unexpected items: 
 *  DTK_NUMBER can hold date fields (yy.ddd) 
 *  DTK_STRING can hold months (January) and time zones (PST) 
 *  DTK_DATE can hold time zone names (America/New_York, GMT-8) 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN561"></a><span class='Declare_Function'>ParseDateTime</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>timestr</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>workbuf</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>buflen</span><span class='Delimiter'>, 
</span><a name="LN562"></a>              <span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>ftype</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>maxfields</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>numfields</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN564"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nf</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN565"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>cp</span> <span class='Operator'>= </span><a href="datetime.c.html#LN561"><span class='Ref_to_Parameter'>timestr</span></a><span class='Delimiter'>; 
</span><a name="LN566"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>bufp</span> <span class='Operator'>= </span><a href="datetime.c.html#LN561"><span class='Ref_to_Parameter'>workbuf</span></a><span class='Delimiter'>; 
</span><a name="LN567"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>bufend</span> <span class='Operator'>= </span><a href="datetime.c.html#LN561"><span class='Ref_to_Parameter'>workbuf</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN561"><span class='Ref_to_Parameter'>buflen</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the character pointed-to by "bufptr" to "newchar", and increment 
     * "bufptr". "end" gives the end of the buffer -- we return an error if 
     * there is no space left to append a character to the buffer. Note that 
     * "bufptr" is evaluated twice. 
     */ 
</span><a name="LN575"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>APPEND_CHAR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>bufptr</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>end</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>newchar</span><span class='Parentheses'>)</span>       <span class='Operator'>\ 
</span>    <span class='Control'>do</span>                                          <span class='Operator'>\ 
</span>    <span class='Delimiter'>{</span>                                           <span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span>bufptr<span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span>end<span class='Parentheses'>))</span>            <span class='Operator'>\ 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>;</span>            <span class='Operator'>\ 
</span>        <span class='Operator'>*</span><span class='Parentheses'>(</span>bufptr<span class='Parentheses'>)</span><span class='Operator'>++ = </span>newchar<span class='Delimiter'>;</span>                  <span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
    <span class='Comment_Multi_Line'>/* outer loop through fields */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Ignore spaces between fields */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Record start of current field */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a> <span class='Operator'>&GT;= </span><a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>maxfields</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* leading digit? then date or time */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* time field? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                       <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>)</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>))</span> 
                    <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* date field? allow embedded text month */ 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'/'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* save delimiting character to use later */ 
</span><a name="LN618"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>delim</span> <span class='Operator'>= *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; 
</span> 
                <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* second field is all digits? then no embedded text month */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>((</span><a href="datetime.c.html#LN618"><span class='Ref_To_Local'>delim</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN136"><span class='Ref_to_Const'>DTK_NUMBER</span></a> <span class='Operator'>: </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                        <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * insist that the delimiters match to get a three-field 
                     * date. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><a href="datetime.c.html#LN618"><span class='Ref_To_Local'>delim</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><a href="datetime.c.html#LN618"><span class='Ref_To_Local'>delim</span></a><span class='Parentheses'>)</span> 
                            <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>while</span> <span class='Parentheses'>(</span>isalnum<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><a href="datetime.c.html#LN618"><span class='Ref_To_Local'>delim</span></a><span class='Parentheses'>)</span> 
                        <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><a href="../../../port/pgstrcasecmp.c.html#LN120"><span class='Ref_to_Func'>pg_tolower</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *cp=='-'||*cp=='/'||*... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * otherwise, number only and will determine year, month, day, or 
             * concatenated fields later... 
             */ 
</span>            <span class='Control'>else</span> 
                <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN136"><span class='Ref_to_Const'>DTK_NUMBER</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if isdigit((unsignedchar... &raquo; </span> 
        <span class='Comment_Multi_Line'>/* Leading decimal point? Then fractional seconds... */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN136"><span class='Ref_to_Const'>DTK_NUMBER</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * text? then date string, month, day of week, special, or timezone 
         */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN670"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_date</span><span class='Delimiter'>; 
</span> 
            <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN137"><span class='Ref_to_Const'>DTK_STRING</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><a href="../../../port/pgstrcasecmp.c.html#LN120"><span class='Ref_to_Func'>pg_tolower</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><a href="../../../port/pgstrcasecmp.c.html#LN120"><span class='Ref_to_Func'>pg_tolower</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Dates can have embedded '-', '/', or '.' separators.  It could 
             * also be a timezone name containing embedded '/', '+', '-', '_', 
             * or ':' (but '_' or ':' can't be the first punctuation). If the 
             * next character is a digit or '+', we need to check whether what 
             * we have so far is a recognized non-timezone keyword --- if so, 
             * don't believe that this is the start of a timezone. 
             */ 
</span>            <a href="datetime.c.html#LN670"><span class='Ref_To_Local'>is_date</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'/'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN670"><span class='Ref_To_Local'>is_date</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'+'</span> <span class='Operator'>|| </span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* null-terminate current field value */ 
</span>                <span class='Comment_Multi_Line'>/* we need search only the core token table, not TZ names */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN42"><span class='Ref_to_Proto'>datebsearch</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>], </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN18"><span class='Ref_to_Global_Var'>datetktbl</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN167"><span class='Ref_to_Global_Var'>szdatetktbl</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                    <a href="datetime.c.html#LN670"><span class='Ref_To_Local'>is_date</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN670"><span class='Ref_To_Local'>is_date</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>do</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><a href="../../../port/pgstrcasecmp.c.html#LN120"><span class='Ref_to_Func'>pg_tolower</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'+'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| 
</span>                         <span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'/'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'_'</span> <span class='Operator'>|| 
</span>                         <span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>':'</span> <span class='Operator'>|| 
</span>                         isalnum<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if isalpha((unsignedchar... &raquo; </span> 
        <span class='Comment_Multi_Line'>/* sign? then special or numeric timezone */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'+'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* soak up leading whitespace */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                <a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* numeric timezone? */ 
</span>            <span class='Comment_Multi_Line'>/* note that "DTK_TZ" could also be a signed float or yyyy-mm */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>                       <span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>':'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>)</span> 
                    <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* special? */ 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN144"><span class='Ref_to_Const'>DTK_SPECIAL</span></a><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><a href="../../../port/pgstrcasecmp.c.html#LN120"><span class='Ref_to_Func'>pg_tolower</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                    <a href="datetime.c.html#LN575"><span class='Ref_to_Macro'>APPEND_CHAR</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN567"><span class='Ref_To_Local'>bufend</span></a><span class='Delimiter'>, </span><a href="../../../port/pgstrcasecmp.c.html#LN120"><span class='Ref_to_Func'>pg_tolower</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* otherwise something wrong... */ 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *cp=='+'||*cp=='-' &raquo; </span> 
        <span class='Comment_Multi_Line'>/* ignore other punctuation but use as delimiter */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>ispunct<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN565"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* otherwise, something is not right... */ 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* force in a delimiter after each field */ 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN566"><span class='Ref_To_Local'>bufp</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *cp!='\0' &raquo; </span> 
 
    <span class='Operator'>*</span><a href="datetime.c.html#LN562"><span class='Ref_to_Parameter'>numfields</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN564"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ParseDateTime &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DecodeDateTime() 
 * Interpret previously parsed fields for general date and time. 
 * Return 0 if full date, 1 if only time, and negative DTERR code if problems. 
 * (Currently, all callers treat 1 as an error return too.) 
 * 
 *      External format(s): 
 *              "&LT;weekday&GT; &LT;month&GT;-&LT;day&GT;-&LT;year&GT; &LT;hour&GT;:&LT;minute&GT;:&LT;second&GT;" 
 *              "Fri Feb-7-1997 15:23:27" 
 *              "Feb-7-1997 15:23:27" 
 *              "2-7-1997 15:23:27" 
 *              "1997-2-7 15:23:27" 
 *              "1997.038 15:23:27"     (day of year 1-366) 
 *      Also supports input in compact time: 
 *              "970207 152327" 
 *              "97038 152327" 
 *              "20011225T040506.789-07" 
 * 
 * Use the system-provided functions to get the current time zone 
 * if not specified in the input string. 
 * 
 * If the date is outside the range of pg_time_t (in practice that could only 
 * happen if pg_time_t is just 32 bits), then assume UTC time zone - thomas 
 * 1997-05-27 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN782"></a><span class='Declare_Function'>DecodeDateTime</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>ftype</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nf</span><span class='Delimiter'>, 
</span><a name="LN783"></a>               <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dtype</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN785"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fmask</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN786"></a>                <span class='Declare_Local'>tmask</span><span class='Delimiter'>, 
</span><a name="LN787"></a>                <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN788"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ptype</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* "prefix type" for ISO y2001m02d04 format */ 
</span><a name="LN789"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN790"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN791"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span><a name="LN792"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>mer</span> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN70"><span class='Ref_to_Const'>HR24</span></a><span class='Delimiter'>; 
</span><a name="LN793"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>haveTextMonth</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN794"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isjulian</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN795"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is2digits</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN796"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>bc</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN797"></a>    <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>namedTz</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN798"></a>    <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>abbrevTz</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN799"></a>    <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>valtz</span><span class='Delimiter'>; 
</span><a name="LN800"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>abbrev</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN801"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>cur_tm</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We'll insist on at least all of the date fields, but initialize the 
     * remaining fields in case they are not set later... 
     */ 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* don't know daylight savings time status apriori */ 
</span>    <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>nf</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Integral julian day with attached time zone? All other 
                 * forms with JD will be separated into distinct fields, so we 
                 * handle just this case here. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN830"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN831"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN831"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN830"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE <span class='Operator'>|| </span><a href="datetime.c.html#LN831"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span> 
                    <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN831"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN794"><span class='Ref_To_Local'>isjulian</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Get the time zone from the end of the string */ 
</span>                    <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN299"><span class='Ref_to_Proto'>DecodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN830"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ptype==DTK_JULIAN &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Already have a date? Then this might be a time zone name 
                 * with embedded punctuation (e.g. "America/New_York") or a 
                 * run-together time with trailing time zone (e.g. hhmmss-zz). 
                 * - thomas 2001-12-25 
                 * 
                 * We consider it a time zone if we already have month & day. 
                 * This is to allow the form "mmm dd hhmmss tz year", which 
                 * we've historically accepted. 
                 */ 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                         <span class='Parentheses'>((</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)))</span> <span class='Operator'>== 
</span>                          <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>))))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* No time zone accepted? Then quit... */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span><a name="LN874"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* Sanity check; should not fail this test */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Starts with a digit but we already have a time 
                         * field? Then we are in trouble with a date and time 
                         * already... 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>)</span> 
                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN874"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>'-'</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* Get the time zone from the end of the string */ 
</span>                        <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN299"><span class='Ref_to_Proto'>DecodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN874"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN874"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Then read the rest of the field as a concatenated 
                         * time 
                         */ 
</span>                        <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                  <a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>&</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                                  <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN795"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * modify tmask after returning from 
                         * DecodeNumberField() 
                         */ 
</span>                        <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if isdigit((unsignedchar... &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN797"><span class='Ref_To_Local'>namedTz</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN797"><span class='Ref_To_Local'>namedTz</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * We should return an error code instead of 
                             * ereport'ing directly, but then there is no way 
                             * to report the bad time zone name. 
                             */ 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                                            <a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Comment_Multi_Line'>/* we'll apply the zone setting below */ 
</span>                        <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ptype!=0||((fmask&(DT... &raquo; </span> 
                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN43"><span class='Ref_to_Proto'>DecodeDate</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN795"><span class='Ref_To_Local'>is2digits</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * This might be an ISO time following a "t" field. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Sanity check; should not fail this test */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN40"><span class='Ref_to_Proto'>DecodeTime</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN21"><span class='Ref_to_Const'>INTERVAL_FULL_RANGE</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Check upper limit on hours; other limits checked in 
                 * DecodeTime() 
                 */ 
</span>                <span class='Comment_Multi_Line'>/* test for &GT; 24:00:00 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>|| 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>== </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>&& 
</span>                     <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)))</span> 
                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN976"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN299"><span class='Ref_to_Proto'>DecodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN976"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN976"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN136"><span class='Ref_to_Const'>DTK_NUMBER</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Was this an "ISO date" with embedded field labels? An 
                 * example is "y2001m02d04" - thomas 2001-02-04 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN997"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN998"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
                    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN997"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * only a few kinds are allowed to have an embedded 
                     * decimal 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN997"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Operator'>: 
</span>                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Operator'>: 
</span>                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Control'>default</span><span class='Operator'>: 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN997"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span> 
                            <span class='Comment_Multi_Line'>/* 
                             * already have a month and hour? then assume 
                             * minutes 
                             */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                                <span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <span class='Delimiter'>{ 
</span>                                <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>else</span> 
                            <span class='Delimiter'>{ 
</span>                                <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN997"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN512"><span class='Ref_to_Func'>ParseFractionalSecond</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN997"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                                    <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN185"><span class='Ref_to_Const'>DTK_ALL_SECS_M</span></a><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN299"><span class='Ref_to_Proto'>DecodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Operator'>: 
</span>                            <span class='Comment_Multi_Line'>/* previous field was a label for "julian date" */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Delimiter'>; 
</span>                            <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN998"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN794"><span class='Ref_To_Local'>isjulian</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
                            <span class='Comment_Multi_Line'>/* fractional Julian Day? */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN997"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span><a name="LN1094"></a>                                <span class='Keyword'>double</span>      <span class='Declare_Local'>time</span><span class='Delimiter'>; 
</span> 
                                errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1094"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="datetime.c.html#LN997"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN997"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN997"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>|| </span>errno <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1094"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>*= </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>                                <a href="../../../include/utils/timestamp.h.html#LN86"><span class='Ref_to_Proto'>dt2time</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1094"><span class='Ref_To_Local'>time</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Operator'>: 
</span>                            <span class='Comment_Multi_Line'>/* previous field was "t" for ISO time */ 
</span>                            <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                      <span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <span class='Operator'>&</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                                      <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN795"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ptype &raquo; </span> 
 
                    <a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ptype!=0 &raquo; </span> 
                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span><a name="LN1130"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN1131"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>flen</span><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN1131"><span class='Ref_To_Local'>flen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN1130"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>'.'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Embedded decimal and no date yet? */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1130"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& !</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN43"><span class='Ref_to_Proto'>DecodeDate</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, 
</span>                                           <span class='Operator'>&</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN795"><span class='Ref_To_Local'>is2digits</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* embedded decimal and several digits before? */ 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1130"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="datetime.c.html#LN1131"><span class='Ref_To_Local'>flen</span></a> <span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN1130"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Interpret as a concatenated date or time Set the 
                         * type field to allow decoding other fields later. 
                         * Example: 20011223 or 040506 
                         */ 
</span>                        <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1131"><span class='Ref_To_Local'>flen</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>&</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                                  <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN795"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Is this a YMD or HMS specification, or a year number? 
                     * YMD and HMS are required to be six digits or more, so 
                     * if it is 5 digits, it is a year.  If it is six or more 
                     * more digits, we assume it is YMD or HMS unless no date 
                     * and no time values have been specified.  This forces 6+ 
                     * digit years to be at the end of the string, or to use 
                     * the ISO date specification. 
                     */ 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1131"><span class='Ref_To_Local'>flen</span></a> <span class='Operator'>&GT;= </span><span class='Number'>6</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                                           <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>)))</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1131"><span class='Ref_To_Local'>flen</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>&</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                                  <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN795"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* otherwise it is a single date/time field... */ 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN34"><span class='Ref_to_Proto'>DecodeNumber</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1131"><span class='Ref_To_Local'>flen</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                             <a href="datetime.c.html#LN793"><span class='Ref_To_Local'>haveTextMonth</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                             <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN795"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN137"><span class='Ref_to_Const'>DTK_STRING</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN144"><span class='Ref_to_Const'>DTK_SPECIAL</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* timezone abbrevs take precedence over built-in tokens */ 
</span>                <a href="datetime.c.html#LN787"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN325"><span class='Ref_to_Proto'>DecodeTimezoneAbbrev</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN799"><span class='Ref_To_Local'>valtz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN787"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Parentheses'>) 
</span>                    <a href="datetime.c.html#LN787"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN327"><span class='Ref_to_Proto'>DecodeSpecial</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN787"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN97"><span class='Ref_to_Const'>IGNORE_DTF</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN787"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN787"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Operator'>: 
</span>                        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN146"><span class='Ref_to_Const'>DTK_CURRENT</span></a><span class='Operator'>: 
</span>                                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date/time value \"current\" is no longer supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN150"><span class='Ref_to_Const'>DTK_NOW</span></a><span class='Operator'>: 
</span>                                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                                <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                                <a href="../../../include/utils/datetime.h.html#LN289"><span class='Ref_to_Proto'>GetCurrentTimeUsec</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN151"><span class='Ref_to_Const'>DTK_YESTERDAY</span></a><span class='Operator'>: 
</span>                                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Delimiter'>; 
</span>                                <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                                <a href="../../../include/utils/datetime.h.html#LN288"><span class='Ref_to_Proto'>GetCurrentDateTime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN152"><span class='Ref_to_Const'>DTK_TODAY</span></a><span class='Operator'>: 
</span>                                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Delimiter'>; 
</span>                                <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                                <a href="../../../include/utils/datetime.h.html#LN288"><span class='Ref_to_Proto'>GetCurrentDateTime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN153"><span class='Ref_to_Const'>DTK_TOMORROW</span></a><span class='Operator'>: 
</span>                                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Delimiter'>; 
</span>                                <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                                <a href="../../../include/utils/datetime.h.html#LN288"><span class='Ref_to_Proto'>GetCurrentDateTime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN801"><span class='Ref_To_Local'>cur_tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN154"><span class='Ref_to_Const'>DTK_ZULU</span></a><span class='Operator'>: 
</span>                                <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                                <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                                    <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>default</span><span class='Operator'>: 
</span>                                <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch val &raquo; </span> 
 
                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Operator'>: 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * already have a (numeric) month? then see if we can 
                         * substitute... 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& !</span><a href="datetime.c.html#LN793"><span class='Ref_To_Local'>haveTextMonth</span></a> <span class='Operator'>&& 
</span>                            <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>))</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>                            <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&LT;= </span><span class='Number'>31</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <a href="datetime.c.html#LN793"><span class='Ref_To_Local'>haveTextMonth</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN116"><span class='Ref_to_Const'>DTZMOD</span></a><span class='Operator'>: 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * daylight savings time modifier (solves "MET DST" 
                         * syntax) 
                         */ 
</span>                        <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN95"><span class='Ref_to_Const'>DTZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>-= </span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN95"><span class='Ref_to_Const'>DTZ</span></a><span class='Operator'>: 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * set mask for TZ here _or_ check for DTZ later when 
                         * getting default timezone 
                         */ 
</span>                        <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN96"><span class='Ref_to_Const'>DYNTZ</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* we'll determine the actual offset later */ 
</span>                        <a href="datetime.c.html#LN798"><span class='Ref_To_Local'>abbrevTz</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN799"><span class='Ref_To_Local'>valtz</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN800"><span class='Ref_To_Local'>abbrev</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN98"><span class='Ref_to_Const'>AMPM</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN792"><span class='Ref_To_Local'>mer</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN107"><span class='Ref_to_Const'>ADBC</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN796"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN73"><span class='Ref_to_Const'>BC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN105"><span class='Ref_to_Const'>DOW</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN32"><span class='Ref_to_Member'>tm_wday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN114"><span class='Ref_to_Const'>ISOTIME</span></a><span class='Operator'>: 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * This is a filler field "t" indicating that the next 
                         * field is time. Try to verify that this is sensible. 
                         */ 
</span>                        <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* No preceding date? Then quit... */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span> 
                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/*** 
                         * We will need one of the following fields: 
                         *  DTK_NUMBER should be hhmmss.fff 
                         *  DTK_TIME should be hh:mm:ss.fff 
                         *  DTK_DATE should be hhmmss-zz 
                         ***/ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>nf</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>                            <span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN136"><span class='Ref_to_Const'>DTK_NUMBER</span></a> <span class='Operator'>&& 
</span>                             <a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a> <span class='Operator'>&& 
</span>                             <a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                        <a href="datetime.c.html#LN788"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN790"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Operator'>: 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Before giving up and declaring error, check to see 
                         * if it is an all-alpha timezone name. 
                         */ 
</span>                        <a href="datetime.c.html#LN797"><span class='Ref_To_Local'>namedTz</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN782"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN789"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN797"><span class='Ref_To_Local'>namedTz</span></a><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* we'll apply the zone setting below */ 
</span>                        <a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch type &raquo; </span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ftype[i] &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>& </span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>|= </span><a href="datetime.c.html#LN786"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nf;i++ &raquo; </span>                           <span class='Comment_Single_Line'>/* end loop over fields */ 
</span> 
    <span class='Comment_Multi_Line'>/* do final checking/adjustment of Y/M/D fields */ 
</span>    <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN322"><span class='Ref_to_Proto'>ValidateDate</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN794"><span class='Ref_To_Local'>isjulian</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN795"><span class='Ref_To_Local'>is2digits</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN796"><span class='Ref_To_Local'>bc</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="datetime.c.html#LN791"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* handle AM/PM */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN792"><span class='Ref_To_Local'>mer</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN70"><span class='Ref_to_Const'>HR24</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN792"><span class='Ref_To_Local'>mer</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN68"><span class='Ref_to_Const'>AM</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>== </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN792"><span class='Ref_To_Local'>mer</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN69"><span class='Ref_to_Const'>PM</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>!= </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* do additional checking for full date specs... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we had a full timezone spec, compute the offset (we could not do 
         * it before, because we need the date to resolve DST status). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN797"><span class='Ref_To_Local'>namedTz</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* daylight savings time modifier disallowed with full TZ */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN116"><span class='Ref_to_Const'>DTZMOD</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN797"><span class='Ref_To_Local'>namedTz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Likewise, if we had a dynamic timezone abbreviation, resolve it 
         * now. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN798"><span class='Ref_To_Local'>abbrevTz</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* daylight savings time modifier disallowed with dynamic TZ */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN116"><span class='Ref_to_Const'>DTZMOD</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN312"><span class='Ref_to_Proto'>DetermineTimeZoneAbbrevOffset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN800"><span class='Ref_To_Local'>abbrev</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN798"><span class='Ref_To_Local'>abbrevTz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* timezone not specified? then use session timezone */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& !</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * daylight savings time modifier but no standard timezone? then 
             * error 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN785"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN116"><span class='Ref_to_Const'>DTZMOD</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN783"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.c.html#LN27"><span class='Ref_to_Global_Var'>session_timezone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *dtype==DTK_DATE &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeDateTime &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DetermineTimeZoneOffset() 
 * 
 * Given a struct pg_tm in which tm_year, tm_mon, tm_mday, tm_hour, tm_min, 
 * and tm_sec fields are set, and a zic-style time zone definition, determine 
 * the applicable GMT offset and daylight-savings status at that time. 
 * Set the struct pg_tm's tm_isdst field accordingly, and return the GMT 
 * offset as the function result. 
 * 
 * Note: if the date is out of the range we can deal with, we return zero 
 * as the GMT offset and set tm_isdst = 0.  We don't throw an error here, 
 * though probably some higher-level code will. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1470"></a><span class='Declare_Function'>DetermineTimeZoneOffset</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1472"></a>    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>t</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="datetime.c.html#LN51"><span class='Ref_to_Proto'>DetermineTimeZoneOffsetInternal</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1470"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1470"><span class='Ref_to_Parameter'>tzp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1472"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* DetermineTimeZoneOffsetInternal() 
 * 
 * As above, but also return the actual UTC time imputed to the date/time 
 * into *tp. 
 * 
 * In event of an out-of-range date, we punt by returning zero into *tp. 
 * This is okay for the immediate callers but is a good reason for not 
 * exposing this worker function globally. 
 * 
 * Note: it might seem that we should use mktime() for this, but bitter 
 * experience teaches otherwise.  This code is much faster than most versions 
 * of mktime(), anyway. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1492"></a><span class='Declare_Function'>DetermineTimeZoneOffsetInternal</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Delimiter'>, </span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1494"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>date</span><span class='Delimiter'>, 
</span><a name="LN1495"></a>                <span class='Declare_Local'>sec</span><span class='Delimiter'>; 
</span><a name="LN1496"></a>    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>day</span><span class='Delimiter'>, 
</span><a name="LN1497"></a>                <span class='Declare_Local'>mytime</span><span class='Delimiter'>, 
</span><a name="LN1498"></a>                <span class='Declare_Local'>prevtime</span><span class='Delimiter'>, 
</span><a name="LN1499"></a>                <span class='Declare_Local'>boundary</span><span class='Delimiter'>, 
</span><a name="LN1500"></a>                <span class='Declare_Local'>beforetime</span><span class='Delimiter'>, 
</span><a name="LN1501"></a>                <span class='Declare_Local'>aftertime</span><span class='Delimiter'>; 
</span><a name="LN1502"></a>    <span class='Keyword'>long int</span>    <span class='Declare_Local'>before_gmtoff</span><span class='Delimiter'>, 
</span><a name="LN1503"></a>                <span class='Declare_Local'>after_gmtoff</span><span class='Delimiter'>; 
</span><a name="LN1504"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>before_isdst</span><span class='Delimiter'>, 
</span><a name="LN1505"></a>                <span class='Declare_Local'>after_isdst</span><span class='Delimiter'>; 
</span><a name="LN1506"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First, generate the pg_time_t value corresponding to the given 
     * y/m/d/h/m/s taken as GMT time.  If this overflows, punt and decide the 
     * timezone is GMT.  (For a valid Julian date, integer overflow should be 
     * impossible with 64-bit pg_time_t, but let's check for safety.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN154"><span class='Ref_to_Macro'>IS_VALID_JULIAN</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="datetime.c.html#LN1605"><span class='Ref_to_Label'>overflow</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN1494"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN1496"><span class='Ref_To_Local'>day</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a><span class='Parentheses'>) </span><a href="datetime.c.html#LN1494"><span class='Ref_To_Local'>date</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1496"><span class='Ref_To_Local'>day</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a> <span class='Operator'>!= </span><a href="datetime.c.html#LN1494"><span class='Ref_To_Local'>date</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="datetime.c.html#LN1605"><span class='Ref_to_Label'>overflow</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN1495"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1496"><span class='Ref_To_Local'>day</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN1495"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* since sec &GT;= 0, overflow could only be from +day to -mytime */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN1496"><span class='Ref_To_Local'>day</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="datetime.c.html#LN1605"><span class='Ref_to_Label'>overflow</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find the DST time boundary just before or following the target time. We 
     * assume that all zones have GMT offsets less than 24 hours, and that DST 
     * boundaries can't be closer together than 48 hours, so backing up 24 
     * hours and finding the "next" boundary will work. 
     */ 
</span>    <a href="datetime.c.html#LN1498"><span class='Ref_To_Local'>prevtime</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN1498"><span class='Ref_To_Local'>prevtime</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="datetime.c.html#LN1605"><span class='Ref_to_Label'>overflow</span></a><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN1506"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN49"><span class='Ref_to_Proto'>pg_next_dst_boundary</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="datetime.c.html#LN1498"><span class='Ref_To_Local'>prevtime</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="datetime.c.html#LN1502"><span class='Ref_To_Local'>before_gmtoff</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1504"><span class='Ref_To_Local'>before_isdst</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="datetime.c.html#LN1499"><span class='Ref_To_Local'>boundary</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="datetime.c.html#LN1503"><span class='Ref_To_Local'>after_gmtoff</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1505"><span class='Ref_To_Local'>after_isdst</span></a><span class='Delimiter'>, 
</span>                               <a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1506"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="datetime.c.html#LN1605"><span class='Ref_to_Label'>overflow</span></a><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* failure? */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1506"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Non-DST zone, life is simple */ 
</span>        <a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1504"><span class='Ref_To_Local'>before_isdst</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>- </span><a href="datetime.c.html#LN1502"><span class='Ref_To_Local'>before_gmtoff</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN1502"><span class='Ref_To_Local'>before_gmtoff</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Form the candidate pg_time_t values with local-time adjustment 
     */ 
</span>    <a href="datetime.c.html#LN1500"><span class='Ref_To_Local'>beforetime</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>- </span><a href="datetime.c.html#LN1502"><span class='Ref_To_Local'>before_gmtoff</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN1502"><span class='Ref_To_Local'>before_gmtoff</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>         <a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN1500"><span class='Ref_To_Local'>beforetime</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="datetime.c.html#LN1502"><span class='Ref_To_Local'>before_gmtoff</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>         <a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN1500"><span class='Ref_To_Local'>beforetime</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="datetime.c.html#LN1605"><span class='Ref_to_Label'>overflow</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN1501"><span class='Ref_To_Local'>aftertime</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>- </span><a href="datetime.c.html#LN1503"><span class='Ref_To_Local'>after_gmtoff</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN1503"><span class='Ref_To_Local'>after_gmtoff</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>         <a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN1501"><span class='Ref_To_Local'>aftertime</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="datetime.c.html#LN1503"><span class='Ref_To_Local'>after_gmtoff</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>         <a href="datetime.c.html#LN1497"><span class='Ref_To_Local'>mytime</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN1501"><span class='Ref_To_Local'>aftertime</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="datetime.c.html#LN1605"><span class='Ref_to_Label'>overflow</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If both before or both after the boundary time, we know what to do. The 
     * boundary time itself is considered to be after the transition, which 
     * means we can accept aftertime == boundary in the second case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1500"><span class='Ref_To_Local'>beforetime</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN1499"><span class='Ref_To_Local'>boundary</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN1501"><span class='Ref_To_Local'>aftertime</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN1499"><span class='Ref_To_Local'>boundary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1504"><span class='Ref_To_Local'>before_isdst</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1500"><span class='Ref_To_Local'>beforetime</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN1502"><span class='Ref_To_Local'>before_gmtoff</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1500"><span class='Ref_To_Local'>beforetime</span></a> <span class='Operator'>&GT; </span><a href="datetime.c.html#LN1499"><span class='Ref_To_Local'>boundary</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN1501"><span class='Ref_To_Local'>aftertime</span></a> <span class='Operator'>&GT;= </span><a href="datetime.c.html#LN1499"><span class='Ref_To_Local'>boundary</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1505"><span class='Ref_To_Local'>after_isdst</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1501"><span class='Ref_To_Local'>aftertime</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN1503"><span class='Ref_To_Local'>after_gmtoff</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's an invalid or ambiguous time due to timezone transition.  In a 
     * spring-forward transition, prefer the "before" interpretation; in a 
     * fall-back transition, prefer "after".  (We used to define and implement 
     * this test as "prefer the standard-time interpretation", but that rule 
     * does not help to resolve the behavior when both times are reported as 
     * standard time; which does happen, eg Europe/Moscow in Oct 2014.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1500"><span class='Ref_To_Local'>beforetime</span></a> <span class='Operator'>&GT; </span><a href="datetime.c.html#LN1501"><span class='Ref_To_Local'>aftertime</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1504"><span class='Ref_To_Local'>before_isdst</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1500"><span class='Ref_To_Local'>beforetime</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN1502"><span class='Ref_To_Local'>before_gmtoff</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1505"><span class='Ref_To_Local'>after_isdst</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1501"><span class='Ref_To_Local'>aftertime</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN1503"><span class='Ref_To_Local'>after_gmtoff</span></a><span class='Delimiter'>; 
</span> 
<a name="LN1605"></a><span class='Label'>overflow</span><span class='Operator'>: 
</span>    <span class='Comment_Multi_Line'>/* Given date is out of range, so assume UTC */ 
</span>    <a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN1492"><span class='Ref_to_Parameter'>tp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DetermineTimeZoneOffsetInternal &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DetermineTimeZoneAbbrevOffset() 
 * 
 * Determine the GMT offset and DST flag to be attributed to a dynamic 
 * time zone abbreviation, that is one whose meaning has changed over time. 
 * *tm contains the local time at which the meaning should be determined, 
 * and tm-&GT;tm_isdst receives the DST flag. 
 * 
 * This differs from the behavior of DetermineTimeZoneOffset() in that a 
 * standard-time or daylight-time abbreviation forces use of the corresponding 
 * GMT offset even when the zone was then in DS or standard time respectively. 
 * (However, that happens only if we can match the given abbreviation to some 
 * abbreviation that appears in the IANA timezone data.  Otherwise, we fall 
 * back to doing DetermineTimeZoneOffset().) 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1628"></a><span class='Declare_Function'>DetermineTimeZoneAbbrevOffset</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>abbr</span><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1630"></a>    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>t</span><span class='Delimiter'>; 
</span><a name="LN1631"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>zone_offset</span><span class='Delimiter'>; 
</span><a name="LN1632"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>abbr_offset</span><span class='Delimiter'>; 
</span><a name="LN1633"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>abbr_isdst</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute the UTC time we want to probe at.  (In event of overflow, we'll 
     * probe at the epoch, which is a bit random but probably doesn't matter.) 
     */ 
</span>    <a href="datetime.c.html#LN1631"><span class='Ref_To_Local'>zone_offset</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN51"><span class='Ref_to_Proto'>DetermineTimeZoneOffsetInternal</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1628"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1628"><span class='Ref_to_Parameter'>tzp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1630"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Try to match the abbreviation to something in the zone definition. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN53"><span class='Ref_to_Proto'>DetermineTimeZoneAbbrevOffsetInternal</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1630"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1628"><span class='Ref_to_Parameter'>abbr</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1628"><span class='Ref_to_Parameter'>tzp</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="datetime.c.html#LN1632"><span class='Ref_To_Local'>abbr_offset</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1633"><span class='Ref_To_Local'>abbr_isdst</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Success, so use the abbrev-specific answers. */ 
</span>        <a href="datetime.c.html#LN1628"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1633"><span class='Ref_To_Local'>abbr_isdst</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="datetime.c.html#LN1632"><span class='Ref_To_Local'>abbr_offset</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * No match, so use the answers we already got from 
     * DetermineTimeZoneOffsetInternal. 
     */ 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN1631"><span class='Ref_To_Local'>zone_offset</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DetermineTimeZoneAbbrevOffset &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DetermineTimeZoneAbbrevOffsetTS() 
 * 
 * As above but the probe time is specified as a TimestampTz (hence, UTC time), 
 * and DST status is returned into *isdst rather than into tm-&GT;tm_isdst. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1666"></a><span class='Declare_Function'>DetermineTimeZoneAbbrevOffsetTS</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>ts</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>abbr</span><span class='Delimiter'>, 
</span><a name="LN1667"></a>                                <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>isdst</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1669"></a>    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>t</span> <span class='Operator'>= </span><a href="../../../bin/pg_waldump/compat.c.html#LN26"><span class='Ref_to_Func'>timestamptz_to_time_t</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1666"><span class='Ref_to_Parameter'>ts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1670"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>zone_offset</span><span class='Delimiter'>; 
</span><a name="LN1671"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>abbr_offset</span><span class='Delimiter'>; 
</span><a name="LN1672"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN1673"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN1674"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the abbrev matches anything in the zone data, this is pretty easy. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN53"><span class='Ref_to_Proto'>DetermineTimeZoneAbbrevOffsetInternal</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1669"><span class='Ref_To_Local'>t</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1666"><span class='Ref_to_Parameter'>abbr</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1667"><span class='Ref_to_Parameter'>tzp</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="datetime.c.html#LN1671"><span class='Ref_To_Local'>abbr_offset</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1667"><span class='Ref_to_Parameter'>isdst</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="datetime.c.html#LN1671"><span class='Ref_To_Local'>abbr_offset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Else, break down the timestamp so we can use DetermineTimeZoneOffset. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1666"><span class='Ref_to_Parameter'>ts</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1672"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1673"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1674"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN1667"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN1670"><span class='Ref_To_Local'>zone_offset</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="datetime.c.html#LN1673"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1667"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN1667"><span class='Ref_to_Parameter'>isdst</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1673"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN1670"><span class='Ref_To_Local'>zone_offset</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DetermineTimeZoneAbbrevOffsetTS &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DetermineTimeZoneAbbrevOffsetInternal() 
 * 
 * Workhorse for above two functions: work from a pg_time_t probe instant. 
 * On success, return GMT offset and DST status into *offset and *isdst. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1703"></a><span class='Declare_Function'>DetermineTimeZoneAbbrevOffsetInternal</span><span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a> <span class='Declare_Parameter'>t</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>abbr</span><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Delimiter'>, 
</span><a name="LN1704"></a>                                      <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>isdst</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1706"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>upabbr</span><span class='Delimiter'>[</span><a href="../../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1707"></a>    <span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN1708"></a>    <span class='Keyword'>long int</span>    <span class='Declare_Local'>gmtoff</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We need to force the abbrev to upper case */ 
</span>    <a href="../../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1706"><span class='Ref_To_Local'>upabbr</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1703"><span class='Ref_to_Parameter'>abbr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN1706"><span class='Ref_To_Local'>upabbr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1707"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN1706"><span class='Ref_To_Local'>upabbr</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="datetime.c.html#LN1707"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN1707"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Operator'>*</span><a href="datetime.c.html#LN1707"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../port/pgstrcasecmp.c.html#LN103"><span class='Ref_to_Func'>pg_toupper</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN1707"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the abbrev's meaning at this time in this zone */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN56"><span class='Ref_to_Proto'>pg_interpret_timezone_abbrev</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1706"><span class='Ref_To_Local'>upabbr</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="datetime.c.html#LN1703"><span class='Ref_to_Parameter'>t</span></a><span class='Delimiter'>, 
</span>                                     <span class='Operator'>&</span><a href="datetime.c.html#LN1708"><span class='Ref_To_Local'>gmtoff</span></a><span class='Delimiter'>, 
</span>                                     <a href="datetime.c.html#LN1704"><span class='Ref_to_Parameter'>isdst</span></a><span class='Delimiter'>, 
</span>                                     <a href="datetime.c.html#LN1703"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Change sign to agree with DetermineTimeZoneOffset() */ 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN1704"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>-</span><a href="datetime.c.html#LN1708"><span class='Ref_To_Local'>gmtoff</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DetermineTimeZoneAbbrevOffsetInternal &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DecodeTimeOnly() 
 * Interpret parsed string as time fields only. 
 * Returns 0 if successful, DTERR code if bogus input detected. 
 * 
 * Note that support for time zone is here for 
 * SQL TIME WITH TIME ZONE, but it reveals 
 * bogosity with SQL date/time standards, since 
 * we must infer a time zone from current time. 
 * - thomas 2000-03-10 
 * Allow specifying date to get a better time zone, 
 * if time zones are allowed. - thomas 2001-12-26 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1743"></a><span class='Declare_Function'>DecodeTimeOnly</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>ftype</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nf</span><span class='Delimiter'>, 
</span><a name="LN1744"></a>               <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dtype</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1746"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fmask</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN1747"></a>                <span class='Declare_Local'>tmask</span><span class='Delimiter'>, 
</span><a name="LN1748"></a>                <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN1749"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ptype</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* "prefix type" for ISO h04mm05s06 format */ 
</span><a name="LN1750"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1751"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN1752"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span><a name="LN1753"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isjulian</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN1754"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is2digits</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN1755"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>bc</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN1756"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>mer</span> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN70"><span class='Ref_to_Const'>HR24</span></a><span class='Delimiter'>; 
</span><a name="LN1757"></a>    <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>namedTz</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1758"></a>    <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>abbrevTz</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1759"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>abbrev</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1760"></a>    <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>valtz</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* don't know daylight savings time status apriori */ 
</span>    <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>nf</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Time zone not allowed? Then should not accept dates or time 
                 * zones no matter what else! 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Under limited circumstances, we will accept a date... */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>nf</span></a> <span class='Operator'>&GT;= </span><span class='Number'>2</span> <span class='Operator'>&& 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>nf</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a> <span class='Operator'>|| </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN43"><span class='Ref_to_Proto'>DecodeDate</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1754"><span class='Ref_To_Local'>is2digits</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* otherwise, this is a time and/or time zone */ 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span><a name="LN1800"></a>                        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Starts with a digit but we already have a time 
                         * field? Then we are in trouble with time already... 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>)</span> 
                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Should not get here and fail. Sanity check only... 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN1800"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>'-'</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* Get the time zone from the end of the string */ 
</span>                        <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN299"><span class='Ref_to_Proto'>DecodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1800"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN1800"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Then read the rest of the field as a concatenated 
                         * time 
                         */ 
</span>                        <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                  <span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>&</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                                  <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1754"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span> 
                        <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if isdigit((unsignedchar... &raquo; </span> 
                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN1757"><span class='Ref_To_Local'>namedTz</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN1757"><span class='Ref_To_Local'>namedTz</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * We should return an error code instead of 
                             * ereport'ing directly, but then there is no way 
                             * to report the bad time zone name. 
                             */ 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                                            <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Comment_Multi_Line'>/* we'll apply the zone setting below */ 
</span>                        <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Operator'>: 
</span>                <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN40"><span class='Ref_to_Proto'>DecodeTime</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN21"><span class='Ref_to_Const'>INTERVAL_FULL_RANGE</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1867"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN299"><span class='Ref_to_Proto'>DecodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN1867"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1867"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN136"><span class='Ref_to_Const'>DTK_NUMBER</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Was this an "ISO time" with embedded field labels? An 
                 * example is "h04m05s06" - thomas 2001-02-04 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1749"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1888"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN1889"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Only accept a date under limited circumstances */ 
</span>                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1749"><span class='Ref_To_Local'>ptype</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN1888"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * only a few kinds are allowed to have an embedded 
                     * decimal 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN1888"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1749"><span class='Ref_To_Local'>ptype</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Operator'>: 
</span>                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Operator'>: 
</span>                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                            <span class='Control'>default</span><span class='Operator'>: 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN1888"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1749"><span class='Ref_To_Local'>ptype</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span> 
                            <span class='Comment_Multi_Line'>/* 
                             * already have a month and hour? then assume 
                             * minutes 
                             */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                                <span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <span class='Delimiter'>{ 
</span>                                <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>else</span> 
                            <span class='Delimiter'>{ 
</span>                                <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN1888"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span>                                <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN512"><span class='Ref_to_Func'>ParseFractionalSecond</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1888"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                                    <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN185"><span class='Ref_to_Const'>DTK_ALL_SECS_M</span></a><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN299"><span class='Ref_to_Proto'>DecodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Operator'>: 
</span>                            <span class='Comment_Multi_Line'>/* previous field was a label for "julian date" */ 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Delimiter'>; 
</span>                            <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1889"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1753"><span class='Ref_To_Local'>isjulian</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN1888"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                            <span class='Delimiter'>{ 
</span><a name="LN1997"></a>                                <span class='Keyword'>double</span>      <span class='Declare_Local'>time</span><span class='Delimiter'>; 
</span> 
                                errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1997"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="datetime.c.html#LN1888"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1888"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN1888"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>|| </span>errno <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1997"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>*= </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>                                <a href="../../../include/utils/timestamp.h.html#LN86"><span class='Ref_to_Proto'>dt2time</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1997"><span class='Ref_To_Local'>time</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Delimiter'>; 
</span>                            <span class='Delimiter'>} 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Operator'>: 
</span>                            <span class='Comment_Multi_Line'>/* previous field was "t" for ISO time */ 
</span>                            <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                      <span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <span class='Operator'>&</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                                      <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1754"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span> 
                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ptype &raquo; </span> 
 
                    <a href="datetime.c.html#LN1749"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ptype!=0 &raquo; </span> 
                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span><a name="LN2035"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN2036"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>flen</span><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN2036"><span class='Ref_To_Local'>flen</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN2035"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='String'>'.'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Embedded decimal? */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2035"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * Under limited circumstances, we will accept a 
                         * date... 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>nf</span></a> <span class='Operator'>&GT;= </span><span class='Number'>2</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>nf</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN43"><span class='Ref_to_Proto'>DecodeDate</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, 
</span>                                               <span class='Operator'>&</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1754"><span class='Ref_To_Local'>is2digits</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Comment_Multi_Line'>/* embedded decimal and several digits before? */ 
</span>                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2036"><span class='Ref_To_Local'>flen</span></a> <span class='Operator'>- </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN2035"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                        <span class='Delimiter'>{ 
</span>                            <span class='Comment_Multi_Line'>/* 
                             * Interpret as a concatenated date or time Set 
                             * the type field to allow decoding other fields 
                             * later. Example: 20011223 or 040506 
                             */ 
</span>                            <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2036"><span class='Ref_To_Local'>flen</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                      <span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <span class='Operator'>&</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                                      <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1754"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                                <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                            <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cp!=NULL &raquo; </span> 
                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2036"><span class='Ref_To_Local'>flen</span></a> <span class='Operator'>&GT; </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2036"><span class='Ref_To_Local'>flen</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                  <span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>&</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                                  <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1754"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* otherwise it is a single date/time field... */ 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN34"><span class='Ref_to_Proto'>DecodeNumber</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2036"><span class='Ref_To_Local'>flen</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                             <span class='Boolean'>FALSE</span><span class='Delimiter'>, 
</span>                                             <span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                             <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1754"><span class='Ref_To_Local'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN137"><span class='Ref_to_Const'>DTK_STRING</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN144"><span class='Ref_to_Const'>DTK_SPECIAL</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* timezone abbrevs take precedence over built-in tokens */ 
</span>                <a href="datetime.c.html#LN1748"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN325"><span class='Ref_to_Proto'>DecodeTimezoneAbbrev</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN1760"><span class='Ref_To_Local'>valtz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1748"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Parentheses'>) 
</span>                    <a href="datetime.c.html#LN1748"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN327"><span class='Ref_to_Proto'>DecodeSpecial</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1748"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN97"><span class='Ref_to_Const'>IGNORE_DTF</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1748"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1748"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Operator'>: 
</span>                        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN146"><span class='Ref_to_Const'>DTK_CURRENT</span></a><span class='Operator'>: 
</span>                                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date/time value \"current\" is no longer supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN150"><span class='Ref_to_Const'>DTK_NOW</span></a><span class='Operator'>: 
</span>                                <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Delimiter'>; 
</span>                                <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Delimiter'>; 
</span>                                <a href="../../../include/utils/datetime.h.html#LN289"><span class='Ref_to_Proto'>GetCurrentTimeUsec</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN154"><span class='Ref_to_Const'>DTK_ZULU</span></a><span class='Operator'>: 
</span>                                <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                                <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                            <span class='Control'>default</span><span class='Operator'>: 
</span>                                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch val &raquo; </span> 
 
                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN116"><span class='Ref_to_Const'>DTZMOD</span></a><span class='Operator'>: 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * daylight savings time modifier (solves "MET DST" 
                         * syntax) 
                         */ 
</span>                        <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN95"><span class='Ref_to_Const'>DTZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>-= </span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN95"><span class='Ref_to_Const'>DTZ</span></a><span class='Operator'>: 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * set mask for TZ here _or_ check for DTZ later when 
                         * getting default timezone 
                         */ 
</span>                        <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN96"><span class='Ref_to_Const'>DYNTZ</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>|= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* we'll determine the actual offset later */ 
</span>                        <a href="datetime.c.html#LN1758"><span class='Ref_To_Local'>abbrevTz</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1760"><span class='Ref_To_Local'>valtz</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN1759"><span class='Ref_To_Local'>abbrev</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                        <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN98"><span class='Ref_to_Const'>AMPM</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN1756"><span class='Ref_To_Local'>mer</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN107"><span class='Ref_to_Const'>ADBC</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN1755"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN73"><span class='Ref_to_Const'>BC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN1749"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN114"><span class='Ref_to_Const'>ISOTIME</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/*** 
                         * We will need one of the following fields: 
                         *  DTK_NUMBER should be hhmmss.fff 
                         *  DTK_TIME should be hh:mm:ss.fff 
                         *  DTK_DATE should be hhmmss-zz 
                         ***/ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>nf</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>                            <span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN136"><span class='Ref_to_Const'>DTK_NUMBER</span></a> <span class='Operator'>&& 
</span>                             <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a> <span class='Operator'>&& 
</span>                             <a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Parentheses'>))</span> 
                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                        <a href="datetime.c.html#LN1749"><span class='Ref_To_Local'>ptype</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1751"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Operator'>: 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * Before giving up and declaring error, check to see 
                         * if it is an all-alpha timezone name. 
                         */ 
</span>                        <a href="datetime.c.html#LN1757"><span class='Ref_To_Local'>namedTz</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1743"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN1750"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN1757"><span class='Ref_To_Local'>namedTz</span></a><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                        <span class='Comment_Multi_Line'>/* we'll apply the zone setting below */ 
</span>                        <a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch type &raquo; </span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ftype[i] &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>& </span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>|= </span><a href="datetime.c.html#LN1747"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nf;i++ &raquo; </span>                           <span class='Comment_Single_Line'>/* end loop over fields */ 
</span> 
    <span class='Comment_Multi_Line'>/* do final checking/adjustment of Y/M/D fields */ 
</span>    <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN322"><span class='Ref_to_Proto'>ValidateDate</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1753"><span class='Ref_To_Local'>isjulian</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1754"><span class='Ref_To_Local'>is2digits</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1755"><span class='Ref_To_Local'>bc</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="datetime.c.html#LN1752"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* handle AM/PM */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1756"><span class='Ref_To_Local'>mer</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN70"><span class='Ref_to_Const'>HR24</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1756"><span class='Ref_To_Local'>mer</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN68"><span class='Ref_to_Const'>AM</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>== </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1756"><span class='Ref_To_Local'>mer</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN69"><span class='Ref_to_Const'>PM</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>!= </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This should match the checks in make_timestamp_internal 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a> <span class='Operator'>|| 
</span>        <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>|| 
</span>    <span class='Comment_Multi_Line'>/* test for &GT; 24:00:00 */ 
</span>        <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>== </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>&& 
</span>         <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&LT; </span><a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we had a full timezone spec, compute the offset (we could not do it 
     * before, because we may need the date to resolve DST status). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1757"><span class='Ref_To_Local'>namedTz</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2278"></a>        <span class='Keyword'>long int</span>    <span class='Declare_Local'>gmtoff</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* daylight savings time modifier disallowed with full TZ */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN116"><span class='Ref_to_Const'>DTZMOD</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* if non-DST zone, we do not need to know the date */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN61"><span class='Ref_to_Proto'>pg_get_timezone_offset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1757"><span class='Ref_To_Local'>namedTz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2278"><span class='Ref_To_Local'>gmtoff</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= -</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN2278"><span class='Ref_To_Local'>gmtoff</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* a date has to be specified */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span> 
                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1757"><span class='Ref_To_Local'>namedTz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if namedTz!=NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Likewise, if we had a dynamic timezone abbreviation, resolve it now. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1758"><span class='Ref_To_Local'>abbrevTz</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2303"></a>        <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN2304"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>tmp</span> <span class='Operator'>= &</span><a href="datetime.c.html#LN2303"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * daylight savings time modifier but no standard timezone? then error 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN116"><span class='Ref_to_Const'>DTZMOD</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/datetime.h.html#LN288"><span class='Ref_to_Proto'>GetCurrentDateTime</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2304"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN2304"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2304"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2304"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="datetime.c.html#LN2304"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2304"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2304"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN312"><span class='Ref_to_Proto'>DetermineTimeZoneAbbrevOffset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2304"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1759"><span class='Ref_To_Local'>abbrev</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN1758"><span class='Ref_To_Local'>abbrevTz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2304"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if abbrevTz!=NULL &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* timezone not specified? then use session timezone */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& !</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2330"></a>        <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN2331"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>tmp</span> <span class='Operator'>= &</span><a href="datetime.c.html#LN2330"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * daylight savings time modifier but no standard timezone? then error 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN116"><span class='Ref_to_Const'>DTZMOD</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN1746"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/datetime.h.html#LN288"><span class='Ref_to_Proto'>GetCurrentDateTime</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2331"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN2331"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2331"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2331"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="datetime.c.html#LN2331"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2331"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2331"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2331"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.c.html#LN27"><span class='Ref_to_Global_Var'>session_timezone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN1744"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2331"><span class='Ref_To_Local'>tmp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if tzp!=NULL&&!(fmask&DT... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeTimeOnly &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* DecodeDate() 
 * Decode date string which includes delimiters. 
 * Return 0 if okay, a DTERR code if not. 
 * 
 *  str: field to be parsed 
 *  fmask: bitmask for field types already seen 
 *  *tmask: receives bitmask for fields found here 
 *  *is2digits: set to TRUE if we find 2-digit year 
 *  *tm: field values are stored into appropriate members of this struct 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2368"></a><span class='Declare_Function'>DecodeDate</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fmask</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tmask</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is2digits</span><span class='Delimiter'>, 
</span><a name="LN2369"></a>           <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2371"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN2372"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nf</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2373"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN2374"></a>                <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN2375"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span><a name="LN2376"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>haveTextMonth</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN2377"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN2378"></a>                <span class='Declare_Local'>val</span><span class='Delimiter'>, 
</span><a name="LN2379"></a>                <span class='Declare_Local'>dmask</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2380"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>field</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* parse this string... */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN2372"><span class='Ref_To_Local'>nf</span></a> <span class='Operator'>&LT; </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* skip field separators */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>&& !</span>isalnum<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span> 
            <a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* end of string after separator */ 
</span> 
        <a href="datetime.c.html#LN2380"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN2372"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span> 
                <a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span> 
                <a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Just get rid of any non-digit, non-alpha characters... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2372"><span class='Ref_To_Local'>nf</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *str!='\0'&&nf&LT;MAXDAT... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* look first for text fields, since that will be unambiguous month */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN2372"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isalpha<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN2380"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN2377"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN327"><span class='Ref_to_Proto'>DecodeSpecial</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2380"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN2378"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2377"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN97"><span class='Ref_to_Const'>IGNORE_DTF</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="datetime.c.html#LN2379"><span class='Ref_To_Local'>dmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2377"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2377"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Operator'>: 
</span>                    <a href="datetime.c.html#LN2369"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2378"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN2376"><span class='Ref_To_Local'>haveTextMonth</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="datetime.c.html#LN2379"><span class='Ref_To_Local'>dmask</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
            <a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>|= </span><a href="datetime.c.html#LN2379"><span class='Ref_To_Local'>dmask</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>|= </span><a href="datetime.c.html#LN2379"><span class='Ref_To_Local'>dmask</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* mark this field as being completed */ 
</span>            <a href="datetime.c.html#LN2380"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if isalpha((unsignedchar... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nf;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* now pick up remaining numeric fields */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN2372"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2380"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN2374"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN2380"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
        <a href="datetime.c.html#LN2375"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN34"><span class='Ref_to_Proto'>DecodeNumber</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2374"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2380"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN2373"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN2376"><span class='Ref_To_Local'>haveTextMonth</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>fmask</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="datetime.c.html#LN2379"><span class='Ref_To_Local'>dmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2369"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="datetime.c.html#LN2371"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2375"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="datetime.c.html#LN2375"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="datetime.c.html#LN2379"><span class='Ref_To_Local'>dmask</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
        <a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>|= </span><a href="datetime.c.html#LN2379"><span class='Ref_To_Local'>dmask</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>|= </span><a href="datetime.c.html#LN2379"><span class='Ref_To_Local'>dmask</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nf;i++ &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN2368"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& ~</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN104"><span class='Ref_to_Const'>DOY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Parentheses'>)))</span> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* validation of the field values must wait until ValidateDate() */ 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeDate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ValidateDate() 
 * Check valid year/month/day values, handle BC and DOY cases 
 * Return 0 if okay, a DTERR code if not. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2478"></a><span class='Declare_Function'>ValidateDate</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>fmask</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isjulian</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is2digits</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>bc</span><span class='Delimiter'>, 
</span><a name="LN2479"></a>             <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2478"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2478"><span class='Ref_to_Parameter'>isjulian</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* tm_year is correct and should not be touched */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2478"><span class='Ref_to_Parameter'>bc</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* there is no year zero in AD/BC notation */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* internally, we represent 1 BC as year zero, 2 BC as -1, etc */ 
</span>            <a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2478"><span class='Ref_to_Parameter'>is2digits</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* process 1 or 2-digit input as 1970-2069 AD, allow '0' and '00' */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* just paranoia */ 
</span>                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&LT; </span><span class='Number'>70</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><span class='Number'>2000</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&LT; </span><span class='Number'>100</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><span class='Number'>1900</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* there is no year zero in AD/BC notation */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fmask&DTK_M(YEAR) &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* now that we have correct year, decode DOY */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2478"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN104"><span class='Ref_to_Const'>DOY</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN33"><span class='Ref_to_Member'>tm_yday</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>               <span class='Operator'>&</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* check for valid month */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2478"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN27"><span class='Ref_to_Const'>DTERR_MD_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* minimal check for valid day */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2478"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>&GT; </span><span class='Number'>31</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN27"><span class='Ref_to_Const'>DTERR_MD_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN2478"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Check for valid day of month, now that we know for sure the month 
         * and year.  Note we don't use MD_FIELD_OVERFLOW here, since it seems 
         * unlikely that "Feb 29" is a YMD-order error. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>&GT; </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN12"><span class='Ref_to_Global_Var'>day_tab</span></a><span class='Delimiter'>[</span><a href="../../../timezone/private.h.html#LN142"><span class='Ref_to_Macro'>isleap</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>][</span><a href="datetime.c.html#LN2479"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ValidateDate &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DecodeTime() 
 * Decode time string which includes delimiters. 
 * Return 0 if okay, a DTERR code if not. 
 * 
 * Only check the lower limit on hours, since this same code can be 
 * used to represent time spans. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2557"></a><span class='Declare_Function'>DecodeTime</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fmask</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>range</span><span class='Delimiter'>, 
</span><a name="LN2558"></a>           <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tmask</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2560"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN2561"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Delimiter'>; 
</span> 
    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2557"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* If it's a MINUTE TO SECOND interval, take 2 fields as being mm:ss */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2557"><span class='Ref_to_Parameter'>range</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* always assume mm:ss.sss is MINUTE TO SECOND */ 
</span>        <a href="datetime.c.html#LN2561"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN512"><span class='Ref_to_Func'>ParseFractionalSecond</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2561"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="datetime.c.html#LN2561"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN2561"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN512"><span class='Ref_to_Func'>ParseFractionalSecond</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2560"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2561"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="datetime.c.html#LN2561"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* do a sanity check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        <a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a> <span class='Operator'>|| 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&LT; </span><a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN2558"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeTime &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DecodeNumber() 
 * Interpret plain numeric field as a date value in context. 
 * Return 0 if okay, a DTERR code if not. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2633"></a><span class='Declare_Function'>DecodeNumber</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>flen</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>haveTextMonth</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fmask</span><span class='Delimiter'>, 
</span><a name="LN2634"></a>             <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tmask</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is2digits</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2636"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN2637"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN2638"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2637"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2637"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2637"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * More than two digits before decimal point? Then could be a date or 
         * a run-together time: 2001.360 20011225 040506.789 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2637"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>- </span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN2638"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>flen</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>                                      <span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                      <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2638"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="datetime.c.html#LN2638"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="datetime.c.html#LN2638"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN512"><span class='Ref_to_Func'>ParseFractionalSecond</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2637"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2638"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="datetime.c.html#LN2638"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *cp=='.' &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2637"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Special case for day of year */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>flen</span></a> <span class='Operator'>== </span><span class='Number'>3</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>        <a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&LT;= </span><span class='Number'>366</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN104"><span class='Ref_to_Const'>DOY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN33"><span class='Ref_to_Member'>tm_yday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* tm_mon and tm_mday can't actually be set yet ... */ 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Switch based on what we have so far */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Nothing so far; make a decision about what we think the input 
             * is.  There used to be lots of heuristics here, but the 
             * consensus now is to be paranoid.  It *must* be either 
             * YYYY-MM-DD (with a more-than-two-digit year field), or the 
             * field order defined by DateOrder. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>flen</span></a> <span class='Operator'>&GT;= </span><span class='Number'>3</span> <span class='Operator'>|| </span><a href="../init/globals.c.html#LN107"><span class='Ref_to_Global_Var'>DateOrder</span></a> <span class='Operator'>== </span><a href="../../../include/miscadmin.h.html#LN218"><span class='Ref_to_Const'>DATEORDER_YMD</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN107"><span class='Ref_to_Global_Var'>DateOrder</span></a> <span class='Operator'>== </span><a href="../../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>))</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Must be at second field of YY-MM-DD */ 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>))</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>haveTextMonth</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * We are at the first numeric field of a date that included a 
                 * textual month name.  We want to support the variants 
                 * MON-DD-YYYY, DD-MON-YYYY, and YYYY-MON-DD as unambiguous 
                 * inputs.  We will also accept MON-DD-YY or DD-MON-YY in 
                 * either DMY or MDY modes, as well as YY-MON-DD in YMD mode. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>flen</span></a> <span class='Operator'>&GT;= </span><span class='Number'>3</span> <span class='Operator'>|| </span><a href="../init/globals.c.html#LN107"><span class='Ref_to_Global_Var'>DateOrder</span></a> <span class='Operator'>== </span><a href="../../../include/miscadmin.h.html#LN218"><span class='Ref_to_Const'>DATEORDER_YMD</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if haveTextMonth &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Must be at second field of MM-DD-YY */ 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>))</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>haveTextMonth</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Need to accept DD-MON-YYYY even in YMD mode */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>flen</span></a> <span class='Operator'>&GT;= </span><span class='Number'>3</span> <span class='Operator'>&& *</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>is2digits</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Guess that first numeric field is day was wrong */ 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* YEAR is already set */ 
</span>                    <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>is2digits</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Must be at third field of YY-MM-DD */ 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>))</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Must be at second field of DD-MM-YY */ 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>))</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Must be at third field of DD-MM-YY or MM-DD-YY */ 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2636"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>))</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* we have all the date, so it must be a time field */ 
</span>            <a href="datetime.c.html#LN2638"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN37"><span class='Ref_to_Proto'>DecodeNumberField</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>flen</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>fmask</span></a><span class='Delimiter'>, 
</span>                                      <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, 
</span>                                      <a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>is2digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2638"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="datetime.c.html#LN2638"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Anything else is bogus input */ 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch fmask&DTK_DATE_M &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * When processing a year field, mark it for adjustment if it's only one 
     * or two digits. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>))</span> 
        <span class='Operator'>*</span><a href="datetime.c.html#LN2634"><span class='Ref_to_Parameter'>is2digits</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2633"><span class='Ref_to_Parameter'>flen</span></a> <span class='Operator'>&LT;= </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeNumber &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DecodeNumberField() 
 * Interpret numeric string as a concatenated date or time field. 
 * Return a DTK token (&GT;= 0) if successful, a DTERR code (&LT; 0) if not. 
 * 
 * Use the context of previously decoded fields to help with 
 * the interpretation. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2818"></a><span class='Declare_Function'>DecodeNumberField</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>fmask</span><span class='Delimiter'>, 
</span><a name="LN2819"></a>                <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tmask</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is2digits</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2821"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Have a decimal point? Then this is a date or something with a seconds 
     * field... 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN2821"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Can we use ParseFractionalSecond here?  Not clear whether trailing 
         * junk should be rejected ... 
         */ 
</span><a name="LN2833"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>frac</span><span class='Delimiter'>; 
</span> 
        errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2833"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="datetime.c.html#LN2821"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2833"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Now truncate off the fraction for further processing */ 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN2821"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* No decimal point and no complete date yet? */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT;= </span><span class='Number'>6</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Start from end and consider first 2 as Day, next 2 as Month, 
             * and the rest as Year. 
             */ 
</span>            <a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Parentheses'>))</span> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>- </span><span class='Number'>4</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>- </span><span class='Number'>4</span><span class='Parentheses'>))</span> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>- </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                <span class='Operator'>*</span><a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>is2digits</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (fmask&DTK_DATE_M)!=D... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* not all time fields are specified? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>fmask</span></a> <span class='Operator'>& </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* hhmmss */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>== </span><span class='Number'>6</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* hhmm? */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>== </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2819"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span>atoi<span class='Parentheses'>(</span><a href="datetime.c.html#LN2818"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (fmask&DTK_TIME_M)!=D... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeNumberField &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DecodeTimezone() 
 * Interpret string as a numeric timezone. 
 * 
 * Return 0 if okay (and set *tzp), a DTERR code if not okay. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2905"></a><span class='Declare_Function'>DecodeTimezone</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2907"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN2908"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hr</span><span class='Delimiter'>, 
</span><a name="LN2909"></a>                <span class='Declare_Local'>min</span><span class='Delimiter'>, 
</span><a name="LN2910"></a>                <span class='Declare_Local'>sec</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2911"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* leading character must be "+" or "-" */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2905"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>!= </span><span class='String'>'+'</span> <span class='Operator'>&& *</span><a href="datetime.c.html#LN2905"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>!= </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN2908"><span class='Ref_To_Local'>hr</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2905"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2911"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN29"><span class='Ref_to_Const'>DTERR_TZDISP_OVERFLOW</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* explicit delimiter? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2911"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2909"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2911"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2911"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN29"><span class='Ref_to_Const'>DTERR_TZDISP_OVERFLOW</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2911"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN2910"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2911"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN2911"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN29"><span class='Ref_to_Const'>DTERR_TZDISP_OVERFLOW</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* otherwise, might have run things together... */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2911"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>&& </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN2905"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN2909"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2908"><span class='Ref_To_Local'>hr</span></a> <span class='Operator'>% </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2908"><span class='Ref_To_Local'>hr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2908"><span class='Ref_To_Local'>hr</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* we could, but don't, support a run-together hhmmss format */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="datetime.c.html#LN2909"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Range-check the values; see notes in datatype/timestamp.h */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2908"><span class='Ref_To_Local'>hr</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN2908"><span class='Ref_To_Local'>hr</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN102"><span class='Ref_to_Const'>MAX_TZDISP_HOUR</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN29"><span class='Ref_to_Const'>DTERR_TZDISP_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2909"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN2909"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN29"><span class='Ref_to_Const'>DTERR_TZDISP_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2910"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN2910"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN29"><span class='Ref_to_Const'>DTERR_TZDISP_OVERFLOW</span></a><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN2907"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN2908"><span class='Ref_To_Local'>hr</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN2909"><span class='Ref_To_Local'>min</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN2910"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2905"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN2907"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN2907"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="datetime.c.html#LN2905"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN2907"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN2911"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeTimezone &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DecodeTimezoneAbbrev() 
 * Interpret string as a timezone abbreviation, if possible. 
 * 
 * Returns an abbreviation type (TZ, DTZ, or DYNTZ), or UNKNOWN_FIELD if 
 * string is not any known abbreviation.  On success, set *offset and *tz to 
 * represent the UTC offset (for TZ or DTZ) or underlying zone (for DYNTZ). 
 * Note that full timezone names (such as America/New_York) are not handled 
 * here, mostly for historical reasons. 
 * 
 * Given string must be lowercased already. 
 * 
 * Implement a cache lookup since it is likely that dates 
 *  will be related in format. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2983"></a><span class='Declare_Function'>DecodeTimezoneAbbrev</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>lowtoken</span><span class='Delimiter'>, 
</span><a name="LN2984"></a>                     <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>tz</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2986"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN2987"></a>    <span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN250"><span class='Ref_to_Global_Var'>abbrevcache</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN2983"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>]; 
</span>    <span class='Comment_Multi_Line'>/* use strncmp so that we match truncated tokens */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strncmp<span class='Parentheses'>(</span><a href="datetime.c.html#LN2983"><span class='Ref_to_Parameter'>lowtoken</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN199"><span class='Ref_to_Const'>TOKMAXLEN</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN242"><span class='Ref_to_Global_Var'>zoneabbrevtbl</span></a><span class='Parentheses'>) 
</span>            <a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN42"><span class='Ref_to_Proto'>datebsearch</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN2983"><span class='Ref_to_Parameter'>lowtoken</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN242"><span class='Ref_to_Global_Var'>zoneabbrevtbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN221"><span class='Ref_to_Member'>abbrevs</span></a><span class='Delimiter'>, 
</span>                             <a href="datetime.c.html#LN242"><span class='Ref_to_Global_Var'>zoneabbrevtbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN220"><span class='Ref_to_Member'>numabbrevs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN2986"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN2984"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN2984"><span class='Ref_to_Parameter'>tz</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN250"><span class='Ref_to_Global_Var'>abbrevcache</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN2983"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN2986"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN205"><span class='Ref_to_Member'>type</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN2986"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN96"><span class='Ref_to_Const'>DYNTZ</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2984"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2984"><span class='Ref_to_Parameter'>tz</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN56"><span class='Ref_to_Proto'>FetchDynamicTimeZone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN242"><span class='Ref_to_Global_Var'>zoneabbrevtbl</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2984"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN2987"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN2984"><span class='Ref_to_Parameter'>tz</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="datetime.c.html#LN2986"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeTimezoneAbbrev &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DecodeSpecial() 
 * Decode text string using lookup table. 
 * 
 * Recognizes the keywords listed in datetktbl. 
 * Note: at one time this would also recognize timezone abbreviations, 
 * but no more; use DecodeTimezoneAbbrev for that. 
 * 
 * Given string must be lowercased already. 
 * 
 * Implement a cache lookup since it is likely that dates 
 *  will be related in format. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3038"></a><span class='Declare_Function'>DecodeSpecial</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>lowtoken</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3040"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN3041"></a>    <span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN3041"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN246"><span class='Ref_to_Global_Var'>datecache</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3038"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>]; 
</span>    <span class='Comment_Multi_Line'>/* use strncmp so that we match truncated tokens */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3041"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strncmp<span class='Parentheses'>(</span><a href="datetime.c.html#LN3038"><span class='Ref_to_Parameter'>lowtoken</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3041"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN199"><span class='Ref_to_Const'>TOKMAXLEN</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN3041"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN42"><span class='Ref_to_Proto'>datebsearch</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3038"><span class='Ref_to_Parameter'>lowtoken</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN18"><span class='Ref_to_Global_Var'>datetktbl</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN167"><span class='Ref_to_Global_Var'>szdatetktbl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3041"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN3040"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3038"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN246"><span class='Ref_to_Global_Var'>datecache</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3038"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="datetime.c.html#LN3041"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3040"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3041"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN205"><span class='Ref_to_Member'>type</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3038"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3041"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="datetime.c.html#LN3040"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeSpecial &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ClearPgTM 
 * 
 * Zero out a pg_tm and associated fsec_t 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN3070"></a><span class='Declare_Function'>ClearPgTm</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="datetime.c.html#LN3070"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3070"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3070"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3070"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3070"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3070"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN3070"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* DecodeInterval() 
 * Interpret previously parsed fields for general time interval. 
 * Returns 0 if successful, DTERR code if bogus input detected. 
 * dtype, tm, fsec are output parameters. 
 * 
 * Allow "date" field DTK_DATE since this could be just 
 *  an unsigned floating point number. - thomas 1997-11-16 
 * 
 * Allow ISO-style time span, with implicit units on number of days 
 *  preceding an hh:mm:ss field. - thomas 1998-04-30 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3094"></a><span class='Declare_Function'>DecodeInterval</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>ftype</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nf</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>range</span><span class='Delimiter'>, 
</span><a name="LN3095"></a>               <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dtype</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3097"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_before</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN3098"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN3099"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fmask</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN3100"></a>                <span class='Declare_Local'>tmask</span><span class='Delimiter'>, 
</span><a name="LN3101"></a>                <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN3102"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3103"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span><a name="LN3104"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN3105"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>fval</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN156"><span class='Ref_to_Const'>DTK_DELTA</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN97"><span class='Ref_to_Const'>IGNORE_DTF</span></a><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN104"><span class='Ref_to_Func'>ClearPgTm</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* read through list backwards to pick up units before values */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>nf</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>ftype</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN140"><span class='Ref_to_Const'>DTK_TIME</span></a><span class='Operator'>: 
</span>                <a href="datetime.c.html#LN3103"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN40"><span class='Ref_to_Proto'>DecodeTime</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="datetime.c.html#LN3099"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>range</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3103"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="datetime.c.html#LN3103"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Timezone means a token with a leading sign character and at 
                 * least one digit; there could be ':', '.', '-' embedded in 
                 * it as well. 
                 */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'+'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Check for signed hh:mm or hh:mm:ss.  If so, process exactly 
                 * like DTK_TIME case above, plus handling the sign. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                    <a href="datetime.c.html#LN40"><span class='Ref_to_Proto'>DecodeTime</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN3099"><span class='Ref_To_Local'>fmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>range</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* flip the sign on all fields */ 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= -</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Set the next type to be a day, if units are not 
                     * specified. This handles the case of '1 +02:03' since we 
                     * are reading right to left. 
                     */ 
</span>                    <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if strchr(field[i]+1,':'... &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* 
                 * Otherwise, fall through to DTK_NUMBER case, which can 
                 * handle signed float numbers and signed year-month values. 
                 */ 
</span> 
                <span class='Comment_Multi_Line'>/* FALL THROUGH */ 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN136"><span class='Ref_to_Const'>DTK_NUMBER</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN97"><span class='Ref_to_Const'>IGNORE_DTF</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* use typmod to decide what rightmost field is */ 
</span>                    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>range</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                        <span class='Control'>default</span><span class='Operator'>: 
</span>                            <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Delimiter'>; 
</span>                            <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch range &raquo; </span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type==IGNORE_DTF &raquo; </span> 
 
                errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE<span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* SQL "years-months" syntax */ 
</span><a name="LN3212"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>val2</span><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN3212"><span class='Ref_To_Local'>val2</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN17"><span class='Ref_to_Func'>strtoint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ERANGE <span class='Operator'>|| </span><a href="datetime.c.html#LN3212"><span class='Ref_To_Local'>val2</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN3212"><span class='Ref_To_Local'>val2</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>                        <a href="datetime.c.html#LN3212"><span class='Ref_To_Local'>val2</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3212"><span class='Ref_To_Local'>val2</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN3212"><span class='Ref_To_Local'>val2</span></a><span class='Parentheses'>)</span> <span class='Operator'>&GT; </span>INT_MAX <span class='Operator'>|| 
</span>                        <span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN3212"><span class='Ref_To_Local'>val2</span></a><span class='Parentheses'>)</span> <span class='Operator'>&LT; </span>INT_MIN<span class='Parentheses'>)</span> 
                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN3212"><span class='Ref_To_Local'>val2</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>|| </span>errno <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>                        <a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3098"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                    <a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* DTK_M(type); */ 
</span> 
                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Operator'>: 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>+= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN103"><span class='Ref_to_Const'>MICROSECOND</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* avoid overflowing the fsec field */ 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>+= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>((</span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN102"><span class='Ref_to_Const'>MILLISECOND</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>+= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * If any subseconds were specified, consider this 
                         * microsecond and millisecond input as well. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN185"><span class='Ref_to_Const'>DTK_ALL_SECS_M</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN86"><span class='Ref_to_Const'>SECS_PER_HOUR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* set for next field */ 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><span class='Number'>7</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN49"><span class='Ref_to_Proto'>AdjustFractDays</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN117"><span class='Ref_to_Const'>WEEK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN49"><span class='Ref_to_Proto'>AdjustFractDays</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN118"><span class='Ref_to_Const'>DECADE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>* </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN119"><span class='Ref_to_Const'>CENTURY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                            <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3105"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN184"><span class='Ref_to_Macro'>DTK_M</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN120"><span class='Ref_to_Const'>MILLENNIUM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch type &raquo; </span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN137"><span class='Ref_to_Const'>DTK_STRING</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN144"><span class='Ref_to_Const'>DTK_SPECIAL</span></a><span class='Operator'>: 
</span>                <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN318"><span class='Ref_to_Proto'>DecodeUnits</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN97"><span class='Ref_to_Const'>IGNORE_DTF</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* DTK_M(type); */ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN109"><span class='Ref_to_Const'>AGO</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3097"><span class='Ref_To_Local'>is_before</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3101"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Operator'>: 
</span>                        <a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a> <span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN187"><span class='Ref_to_Const'>DTK_TIME_M</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3104"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ftype[i] &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a> <span class='Operator'>& </span><a href="datetime.c.html#LN3099"><span class='Ref_To_Local'>fmask</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3099"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>|= </span><a href="datetime.c.html#LN3100"><span class='Ref_To_Local'>tmask</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=nf-1;i&GT;=0;i-- &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* ensure that at least one time field has been found */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3099"><span class='Ref_To_Local'>fmask</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ensure fractional seconds are fractional */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3382"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>sec</span><span class='Delimiter'>; 
</span> 
        <a href="datetime.c.html#LN3382"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>= *</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>-= </span><a href="datetime.c.html#LN3382"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3382"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * The SQL standard defines the interval literal 
     *   '-1 1:00:00' 
     * to mean "negative 1 days and negative 1 hours", while Postgres 
     * traditionally treats this as meaning "negative 1 days and positive 
     * 1 hours".  In SQL_STANDARD intervalstyle, we apply the leading sign 
     * to all fields if there are no other explicit signs. 
     * 
     * We leave the signs alone if there are additional explicit signs. 
     * This protects us against misinterpreting postgres-style dump output, 
     * since the postgres-style output code has always put an explicit sign on 
     * all fields following a negative field.  But note that SQL-spec output 
     * is ambiguous and can be misinterpreted on load!  (So it's best practice 
     * to dump in postgres style, not SQL style.) 
     *---------- 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN108"><span class='Ref_to_Global_Var'>IntervalStyle</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN18"><span class='Ref_to_Const'>INTSTYLE_SQL_STANDARD</span></a> <span class='Operator'>&& *</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Check for additional explicit signs */ 
</span><a name="LN3408"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>more_signs</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>nf</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN3094"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3102"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'+'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN3408"><span class='Ref_To_Local'>more_signs</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN3408"><span class='Ref_To_Local'>more_signs</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Rather than re-determining which field was field[0], just force 
             * 'em all negative. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= -</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !more_signs &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IntervalStyle==INTSTY... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* finally, AGO negates everything */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3097"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= -</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN3095"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeInterval &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Helper functions to avoid duplicated code in DecodeISO8601Interval. 
 * 
 * Parse a decimal value and break it into integer and fractional parts. 
 * Returns 0 or DTERR code. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3465"></a><span class='Declare_Function'>ParseISO8601Number</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>endptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>ipart</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Operator'>*</span><span class='Declare_Parameter'>fpart</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3467"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| *</span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>    errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3467"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>endptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* did we not see anything that looks like a double? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>endptr</span></a> <span class='Operator'>== </span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>|| </span>errno <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* watch out for overflow */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3467"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&LT; </span>INT_MIN <span class='Operator'>|| </span><a href="datetime.c.html#LN3467"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&GT; </span>INT_MAX<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* be very sure we truncate towards zero (cf dtrunc()) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3467"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>ipart</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>floor<span class='Parentheses'>(</span><a href="datetime.c.html#LN3467"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>ipart</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>-</span>floor<span class='Parentheses'>(</span><span class='Operator'>-</span><a href="datetime.c.html#LN3467"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>fpart</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3467"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>- *</span><a href="datetime.c.html#LN3465"><span class='Ref_to_Parameter'>ipart</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ParseISO8601Number &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Determine number of integral digits in a valid ISO 8601 number field 
 * (we should ignore sign and any fraction part) 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3493"></a><span class='Declare_Function'>ISO8601IntegerWidth</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fieldstart</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* We might have had a leading '-' */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3493"><span class='Ref_to_Parameter'>fieldstart</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN3493"><span class='Ref_to_Parameter'>fieldstart</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> strspn<span class='Parentheses'>(</span><a href="datetime.c.html#LN3493"><span class='Ref_to_Parameter'>fieldstart</span></a><span class='Delimiter'>, </span><span class='String'>"0123456789"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* DecodeISO8601Interval() 
 *  Decode an ISO 8601 time interval of the "format with designators" 
 *  (section 4.4.3.2) or "alternative format" (section 4.4.3.3) 
 *  Examples:  P1D  for 1 day 
 *             PT1H for 1 hour 
 *             P2Y6M7DT1H30M for 2 years, 6 months, 7 days 1 hour 30 min 
 *             P0002-06-07T01:30:00 the same value in alternative format 
 * 
 * Returns 0 if successful, DTERR code if bogus input detected. 
 * Note: error code should be DTERR_BAD_FORMAT if input doesn't look like 
 * ISO8601, otherwise this could cause unexpected error messages. 
 * dtype, tm, fsec are output parameters. 
 * 
 *  A couple exceptions from the spec: 
 *   - a week field ('W') may coexist with other units 
 *   - allows decimals in fields other than the least significant unit. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3520"></a><span class='Declare_Function'>DecodeISO8601Interval</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, 
</span><a name="LN3521"></a>                      <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dtype</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3523"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>datepart</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN3524"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>havefield</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>dtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN156"><span class='Ref_to_Const'>DTK_DELTA</span></a><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN104"><span class='Ref_to_Func'>ClearPgTm</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>2</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'P'</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3535"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fieldstart</span><span class='Delimiter'>; 
</span><a name="LN3536"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN3537"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>fval</span><span class='Delimiter'>; 
</span><a name="LN3538"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>unit</span><span class='Delimiter'>; 
</span><a name="LN3539"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'T'</span><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* T indicates the beginning of the time part */ 
</span>        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN3523"><span class='Ref_To_Local'>datepart</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="datetime.c.html#LN3535"><span class='Ref_To_Local'>fieldstart</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN66"><span class='Ref_to_Func'>ParseISO8601Number</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note: we could step off the end of the string here.  Code below 
         * *must* exit the loop if unit == '\0'. 
         */ 
</span>        <a href="datetime.c.html#LN3538"><span class='Ref_To_Local'>unit</span></a> <span class='Operator'>= *</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3523"><span class='Ref_To_Local'>datepart</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3538"><span class='Ref_To_Local'>unit</span></a><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* before T: Y M W D */ 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='String'>'Y'</span><span class='Operator'>: 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'M'</span><span class='Operator'>: 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN49"><span class='Ref_to_Proto'>AdjustFractDays</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'W'</span><span class='Operator'>: 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><span class='Number'>7</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN49"><span class='Ref_to_Proto'>AdjustFractDays</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'T'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* ISO 8601 4.4.3.3 Alternative Format / Basic */ 
</span>                <span class='Control'>case</span> <span class='String'>'\0'</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN91"><span class='Ref_to_Func'>ISO8601IntegerWidth</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3535"><span class='Ref_To_Local'>fieldstart</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>8</span> <span class='Operator'>&& !</span><a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/ </span><span class='Number'>10000</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>) </span><span class='Operator'>% </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>% </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                        <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3538"><span class='Ref_To_Local'>unit</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3523"><span class='Ref_To_Local'>datepart</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* Else fall through to extended alternative format */ 
</span>                <span class='Control'>case</span> <span class='String'>'-'</span><span class='Operator'>:</span>       <span class='Comment_Multi_Line'>/* ISO 8601 4.4.3.3 Alternative Format, 
                                 * Extended */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3538"><span class='Ref_To_Local'>unit</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3538"><span class='Ref_To_Local'>unit</span></a> <span class='Operator'>== </span><span class='String'>'T'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN3523"><span class='Ref_To_Local'>datepart</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN66"><span class='Ref_to_Func'>ParseISO8601Number</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN49"><span class='Ref_to_Proto'>AdjustFractDays</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'T'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN3523"><span class='Ref_To_Local'>datepart</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>!= </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN66"><span class='Ref_to_Func'>ParseISO8601Number</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'T'</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN3523"><span class='Ref_To_Local'>datepart</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* not a valid date unit suffix */ 
</span>                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch unit &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if datepart &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3538"><span class='Ref_To_Local'>unit</span></a><span class='Parentheses'>)</span>       <span class='Comment_Single_Line'>/* after T: H M S */ 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='String'>'H'</span><span class='Operator'>: 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN86"><span class='Ref_to_Const'>SECS_PER_HOUR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'M'</span><span class='Operator'>: 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'S'</span><span class='Operator'>: 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'\0'</span><span class='Operator'>:</span>      <span class='Comment_Single_Line'>/* ISO 8601 4.4.3.3 Alternative Format */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN91"><span class='Ref_to_Func'>ISO8601IntegerWidth</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3535"><span class='Ref_To_Local'>fieldstart</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>6</span> <span class='Operator'>&& !</span><a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/ </span><span class='Number'>10000</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>) </span><span class='Operator'>% </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                        <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>% </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                        <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* Else fall through to extended alternative format */ 
</span>                <span class='Control'>case</span> <span class='String'>':'</span><span class='Operator'>:</span>       <span class='Comment_Multi_Line'>/* ISO 8601 4.4.3.3 Alternative Format, 
                                 * Extended */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN86"><span class='Ref_to_Const'>SECS_PER_HOUR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3538"><span class='Ref_To_Local'>unit</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN66"><span class='Ref_to_Func'>ParseISO8601Number</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>!= </span><span class='String'>':'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
                    <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN66"><span class='Ref_to_Func'>ParseISO8601Number</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="datetime.c.html#LN3539"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+= </span><a href="datetime.c.html#LN3536"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN33"><span class='Ref_to_Func'>AdjustFractSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3537"><span class='Ref_To_Local'>fval</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3521"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN3520"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* not a valid time unit suffix */ 
</span>                    <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch unit &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="datetime.c.html#LN3524"><span class='Ref_To_Local'>havefield</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *str &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeISO8601Interval &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* DecodeUnits() 
 * Decode text string using lookup table. 
 * 
 * This routine recognizes keywords associated with time interval units. 
 * 
 * Given string must be lowercased already. 
 * 
 * Implement a cache lookup since it is likely that dates 
 *  will be related in format. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN3727"></a><span class='Declare_Function'>DecodeUnits</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>lowtoken</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3729"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN3730"></a>    <span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN3730"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN248"><span class='Ref_to_Global_Var'>deltacache</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3727"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>]; 
</span>    <span class='Comment_Multi_Line'>/* use strncmp so that we match truncated tokens */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3730"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span>strncmp<span class='Parentheses'>(</span><a href="datetime.c.html#LN3727"><span class='Ref_to_Parameter'>lowtoken</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3730"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN199"><span class='Ref_to_Const'>TOKMAXLEN</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN3730"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN42"><span class='Ref_to_Proto'>datebsearch</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3727"><span class='Ref_to_Parameter'>lowtoken</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN173"><span class='Ref_to_Global_Var'>deltatktbl</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN240"><span class='Ref_to_Global_Var'>szdeltatktbl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3730"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN3729"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3727"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN248"><span class='Ref_to_Global_Var'>deltacache</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3727"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="datetime.c.html#LN3730"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3729"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3730"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN205"><span class='Ref_to_Member'>type</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3727"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3730"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="datetime.c.html#LN3729"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end DecodeUnits &raquo; </span>   <span class='Comment_Single_Line'>/* DecodeUnits() */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Report an error detected by one of the datetime input processing routines. 
 * 
 * dterr is the error code, str is the original input string, datatype is 
 * the name of the datatype we were trying to accept. 
 * 
 * Note: it might seem useless to distinguish DTERR_INTERVAL_OVERFLOW and 
 * DTERR_TZDISP_OVERFLOW from DTERR_FIELD_OVERFLOW, but SQL99 mandates three 
 * separate SQLSTATE codes, so ... 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3764"></a><span class='Declare_Function'>DateTimeParseError</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>dterr</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>datatype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3764"><span class='Ref_to_Parameter'>dterr</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_FIELD_OVERFLOW<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date/time field value out of range: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="datetime.c.html#LN3764"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN27"><span class='Ref_to_Const'>DTERR_MD_FIELD_OVERFLOW</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* &LT;nanny&GT;same as above, but add hint about DateStyle&LT;/nanny&GT; */ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_FIELD_OVERFLOW<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date/time field value out of range: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="datetime.c.html#LN3764"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Perhaps you need a different \"datestyle\" setting."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN28"><span class='Ref_to_Const'>DTERR_INTERVAL_OVERFLOW</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INTERVAL_FIELD_OVERFLOW<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval field value out of range: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="datetime.c.html#LN3764"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN29"><span class='Ref_to_Const'>DTERR_TZDISP_OVERFLOW</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TIME_ZONE_DISPLACEMENT_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone displacement out of range: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="datetime.c.html#LN3764"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Operator'>: 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_DATETIME_FORMAT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s: \"%s\""</span><span class='Delimiter'>, 
</span>                            <a href="datetime.c.html#LN3764"><span class='Ref_to_Parameter'>datatype</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3764"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch dterr &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end DateTimeParseError &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* datebsearch() 
 * Binary search -- from Knuth (6.2.1) Algorithm B.  Special case like this 
 * is WAY faster than the generic bsearch(). 
 */ 
</span><span class='Keyword'>static const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>* 
</span><a name="LN3809"></a><span class='Declare_Function'>datebsearch</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>base</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3809"><span class='Ref_to_Parameter'>nel</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3813"></a>        <span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>last</span> <span class='Operator'>= </span><a href="datetime.c.html#LN3809"><span class='Ref_to_Parameter'>base</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN3809"><span class='Ref_to_Parameter'>nel</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN3814"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>position</span><span class='Delimiter'>; 
</span><a name="LN3815"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3813"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>&GT;= </span><a href="datetime.c.html#LN3809"><span class='Ref_to_Parameter'>base</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN3814"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3809"><span class='Ref_to_Parameter'>base</span></a> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="datetime.c.html#LN3813"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>- </span><a href="datetime.c.html#LN3809"><span class='Ref_to_Parameter'>base</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* precheck the first character for a bit of extra speed */ 
</span>            <a href="datetime.c.html#LN3815"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN3809"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN3814"><span class='Ref_To_Local'>position</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3815"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* use strncmp so that we match truncated tokens */ 
</span>                <a href="datetime.c.html#LN3815"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>strncmp<span class='Parentheses'>(</span><a href="datetime.c.html#LN3809"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3814"><span class='Ref_To_Local'>position</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN199"><span class='Ref_to_Const'>TOKMAXLEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3815"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="datetime.c.html#LN3814"><span class='Ref_To_Local'>position</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3815"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN3813"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3814"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="datetime.c.html#LN3809"><span class='Ref_to_Parameter'>base</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3814"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nel&GT;0 &raquo; </span> 
    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end datebsearch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* EncodeTimezone() 
 *      Copies representation of a numeric timezone offset to str. 
 * 
 * Returns a pointer to the new end of string.  No NUL terminator is put 
 * there; callers are responsible for NUL terminating str themselves. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN3845"></a><span class='Declare_Function'>EncodeTimezone</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>tz</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>style</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3847"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hour</span><span class='Delimiter'>, 
</span><a name="LN3848"></a>                <span class='Declare_Local'>min</span><span class='Delimiter'>, 
</span><a name="LN3849"></a>                <span class='Declare_Local'>sec</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN3849"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>= </span>abs<span class='Parentheses'>(</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3848"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3849"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3849"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>-= </span><a href="datetime.c.html#LN3848"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3847"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3848"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3848"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>-= </span><a href="datetime.c.html#LN3847"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* TZ is negated compared to sign we wish to display ... */ 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>tz</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>? </span><span class='String'>'+'</span> <span class='Operator'>: </span><span class='String'>'-'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3849"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3847"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3848"><span class='Ref_To_Local'>min</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3849"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3848"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>style</span></a> <span class='Operator'>== </span><a href="../../../include/miscadmin.h.html#LN215"><span class='Ref_to_Const'>USE_XSD_DATES</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3847"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3848"><span class='Ref_To_Local'>min</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3847"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN3845"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EncodeTimezone &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* EncodeDateOnly() 
 * Encode date as local time. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3883"></a><span class='Declare_Function'>EncodeDateOnly</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>style</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>style</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN12"><span class='Ref_to_Const'>USE_ISO_DATES</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/miscadmin.h.html#LN215"><span class='Ref_to_Const'>USE_XSD_DATES</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* compatible with ISO date formats */ 
</span>            <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>: -</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN13"><span class='Ref_to_Const'>USE_SQL_DATES</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* compatible with Oracle/Ingres date formats */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN107"><span class='Ref_to_Global_Var'>DateOrder</span></a> <span class='Operator'>== </span><a href="../../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'/'</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'/'</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'/'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>: -</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN14"><span class='Ref_to_Const'>USE_GERMAN_DATES</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* German-style date format */ 
</span>            <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>: -</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN11"><span class='Ref_to_Const'>USE_POSTGRES_DATES</span></a><span class='Operator'>: 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* traditional date-only style for Postgres */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN107"><span class='Ref_to_Global_Var'>DateOrder</span></a> <span class='Operator'>== </span><a href="../../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>: -</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch style &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memcpy<span class='Parentheses'>(</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>" BC"</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Don't copy NUL */ 
</span>        <a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN3883"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EncodeDateOnly &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* EncodeTimeOnly() 
 * Encode time fields only. 
 * 
 * tm and fsec are the value to encode, print_tz determines whether to include 
 * a time zone (the difference between time and timetz types), tz is the 
 * numeric time zone offset, style is the date style, str is where to write the 
 * output. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3968"></a><span class='Declare_Function'>EncodeTimeOnly</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>print_tz</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>tz</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>style</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN45"><span class='Ref_to_Proto'>AppendSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/date.h.html#LN49"><span class='Ref_to_Const'>MAX_TIME_PRECISION</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>print_tz</span></a><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3844"><span class='Ref_to_Func'>EncodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>tz</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>style</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN3968"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* EncodeDateTime() 
 * Encode date and time interpreted as local time. 
 * 
 * tm and fsec are the value to encode, print_tz determines whether to include 
 * a time zone (the difference between timestamp and timestamptz types), tz is 
 * the numeric time zone offset, tzn is the textual time zone, which if 
 * specified will be used instead of tz by some styles, style is the date 
 * style, str is where to write the output. 
 * 
 * Supported date styles: 
 *  Postgres - day mon hh:mm:ss yyyy tz 
 *  SQL - mm/dd/yyyy hh:mm:ss.ss tz 
 *  ISO - yyyy-mm-dd hh:mm:ss+/-tz 
 *  German - dd.mm.yyyy hh:mm:ss tz 
 *  XSD - yyyy-mm-ddThh:mm:ss.ss+/-tz 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN3998"></a><span class='Declare_Function'>EncodeDateTime</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>print_tz</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>tz</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzn</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>style</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4000"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>day</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&GT;= </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Negative tm_isdst means we have no valid time zone translation. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>print_tz</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>style</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN12"><span class='Ref_to_Const'>USE_ISO_DATES</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/miscadmin.h.html#LN215"><span class='Ref_to_Const'>USE_XSD_DATES</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Compatible with ISO-8601 date formats */ 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>: -</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>style</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN12"><span class='Ref_to_Const'>USE_ISO_DATES</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>' '</span> <span class='Operator'>: </span><span class='String'>'T'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN472"><span class='Ref_to_Func'>AppendTimestampSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>print_tz</span></a><span class='Parentheses'>) 
</span>                <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3844"><span class='Ref_to_Func'>EncodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tz</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>style</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN13"><span class='Ref_to_Const'>USE_SQL_DATES</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Compatible with Oracle/Ingres date formats */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN107"><span class='Ref_to_Global_Var'>DateOrder</span></a> <span class='Operator'>== </span><a href="../../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'/'</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'/'</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'/'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>: -</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN472"><span class='Ref_to_Func'>AppendTimestampSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Note: the uses of %.*s in this function would be risky if the 
             * timezone names ever contain non-ASCII characters.  However, all 
             * TZ abbreviations in the IANA database are plain ASCII. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>print_tz</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tzn</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>" %.*s"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN7"><span class='Ref_to_Const'>MAXTZLEN</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tzn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3844"><span class='Ref_to_Func'>EncodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tz</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>style</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN14"><span class='Ref_to_Const'>USE_GERMAN_DATES</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* German variant on European style */ 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>: -</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN472"><span class='Ref_to_Func'>AppendTimestampSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>print_tz</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tzn</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>" %.*s"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN7"><span class='Ref_to_Const'>MAXTZLEN</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tzn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3844"><span class='Ref_to_Func'>EncodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tz</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>style</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN11"><span class='Ref_to_Const'>USE_POSTGRES_DATES</span></a><span class='Operator'>: 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Backward-compatible with traditional Postgres abstime dates */ 
</span>            <a href="datetime.c.html#LN4000"><span class='Ref_To_Local'>day</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN32"><span class='Ref_to_Member'>tm_wday</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4000"><span class='Ref_To_Local'>day</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN68"><span class='Ref_to_Global_Var'>days</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN32"><span class='Ref_to_Member'>tm_wday</span></a><span class='Delimiter'>], </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../init/globals.c.html#LN107"><span class='Ref_to_Global_Var'>DateOrder</span></a> <span class='Operator'>== </span><a href="../../../include/miscadmin.h.html#LN219"><span class='Ref_to_Const'>DATEORDER_DMY</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN65"><span class='Ref_to_Global_Var'>months</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                memcpy<span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN65"><span class='Ref_to_Global_Var'>months</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN472"><span class='Ref_to_Func'>AppendTimestampSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN48"><span class='Ref_to_Proto'>pg_ltostr_zeropad</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>: -</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>print_tz</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tzn</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>" %.*s"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN7"><span class='Ref_to_Const'>MAXTZLEN</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tzn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * We have a time zone, but no string version. Use the 
                     * numeric form, but be sure to include a leading space to 
                     * avoid formatting something which would be rejected by 
                     * the date/time parser later. - thomas 2001-10-19 
                     */ 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN3844"><span class='Ref_to_Func'>EncodeTimezone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tz</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>style</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch style &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memcpy<span class='Parentheses'>(</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>" BC"</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Don't copy NUL */ 
</span>        <a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN3998"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end EncodeDateTime &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Helper functions to avoid duplicated code in EncodeInterval. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* Append an ISO-8601-style interval field, but only if value isn't zero */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN4168"></a><span class='Declare_Function'>AddISO8601IntPart</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>units</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="datetime.c.html#LN4168"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4168"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"%d%c"</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN4168"><span class='Ref_to_Parameter'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN4168"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4168"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Append a postgres-style interval field, but only if value isn't zero */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN4178"></a><span class='Declare_Function'>AddPostgresIntPart</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>units</span><span class='Delimiter'>, 
</span><a name="LN4179"></a>                   <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_zero</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_before</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="datetime.c.html#LN4178"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4178"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"%s%s%d %s%s"</span><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><span class='Operator'>!*</span><a href="datetime.c.html#LN4179"><span class='Ref_to_Parameter'>is_zero</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>" "</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN4179"><span class='Ref_to_Parameter'>is_before</span></a> <span class='Operator'>&& </span><span class='Keyword'>value </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>"+"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>            <span class='Keyword'>value</span><span class='Delimiter'>, 
</span>            <a href="datetime.c.html#LN4178"><span class='Ref_to_Parameter'>units</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>"s"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Each nonzero field sets is_before for (only) the next one.  This is a 
     * tad bizarre but it's how it worked before... 
     */ 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN4179"><span class='Ref_to_Parameter'>is_before</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN4179"><span class='Ref_to_Parameter'>is_zero</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN4178"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4178"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end AddPostgresIntPart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* Append a verbose-style interval field, but only if value isn't zero */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN4201"></a><span class='Declare_Function'>AddVerboseIntPart</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>units</span><span class='Delimiter'>, 
</span><a name="LN4202"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_zero</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_before</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="datetime.c.html#LN4201"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* first nonzero value sets is_before */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN4202"><span class='Ref_to_Parameter'>is_zero</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN4202"><span class='Ref_to_Parameter'>is_before</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>value </span><span class='Operator'>= </span>abs<span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN4202"><span class='Ref_to_Parameter'>is_before</span></a><span class='Parentheses'>) 
</span>        <span class='Keyword'>value </span><span class='Operator'>= -</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4201"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>, </span><span class='String'>" %d %s%s"</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN4201"><span class='Ref_to_Parameter'>units</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>""</span> <span class='Operator'>: </span><span class='String'>"s"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="datetime.c.html#LN4202"><span class='Ref_to_Parameter'>is_zero</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN4201"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>+ </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4201"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* EncodeInterval() 
 * Interpret time structure as a delta time and convert to string. 
 * 
 * Support "traditional Postgres" and ISO-8601 styles. 
 * Actually, afaik ISO does not address time interval formatting, 
 *  but this looks similar to the spec for absolute date/time. 
 * - thomas 1998-04-30 
 * 
 * Actually, afaik, ISO 8601 does specify formats for "time 
 * intervals...[of the]...format with time-unit designators", which 
 * are pretty ugly.  The format looks something like 
 *     P1Y1M1DT1H1M1.12345S 
 * but useful for exchanging data with computers instead of humans. 
 * - ron 2003-07-14 
 * 
 * And ISO's SQL 2008 standard specifies standards for 
 * "year-month literal"s (that look like '2-3') and 
 * "day-time literal"s (that look like ('4 5:6:7') 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4240"></a><span class='Declare_Function'>EncodeInterval</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>style</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4242"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span><a name="LN4243"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>year</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span><a name="LN4244"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>mon</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span><a name="LN4245"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>mday</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span><a name="LN4246"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hour</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span><a name="LN4247"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>min</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span><a name="LN4248"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sec</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span><a name="LN4249"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_before</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN4250"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_zero</span> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The sign of year and month are guaranteed to match, since they are 
     * stored internally as "month". But we'll need to check for is_before and 
     * is_zero when determining the signs of day and hour/minute/seconds 
     * fields. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>style</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* SQL Standard interval format */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN18"><span class='Ref_to_Const'>INTSTYLE_SQL_STANDARD</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4263"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_negative</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN4266"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_positive</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN4269"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_year_month</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN4270"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_day_time</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN4272"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_day</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN4273"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>sql_standard_value</span> <span class='Operator'>= !</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4263"><span class='Ref_To_Local'>has_negative</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN4266"><span class='Ref_To_Local'>has_positive</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <span class='Operator'>!</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4269"><span class='Ref_To_Local'>has_year_month</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN4270"><span class='Ref_To_Local'>has_day_time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * SQL Standard wants only 1 "&LT;sign&GT;" preceding the whole 
                 * interval ... but can't do that if mixed signs. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4263"><span class='Ref_To_Local'>has_negative</span></a> <span class='Operator'>&& </span><a href="datetime.c.html#LN4273"><span class='Ref_To_Local'>sql_standard_value</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN4263"><span class='Ref_To_Local'>has_negative</span></a> <span class='Operator'>&& !</span><a href="datetime.c.html#LN4266"><span class='Ref_To_Local'>has_positive</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN4273"><span class='Ref_To_Local'>sql_standard_value</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * For non sql-standard interval values, force outputting 
                     * the signs to avoid ambiguities with intervals with 
                     * mixed sign components. 
                     */ 
</span><a name="LN4303"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>year_sign</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>'-'</span> <span class='Operator'>: </span><span class='String'>'+'</span><span class='Delimiter'>; 
</span><a name="LN4304"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>day_sign</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>'-'</span> <span class='Operator'>: </span><span class='String'>'+'</span><span class='Delimiter'>; 
</span><a name="LN4305"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>sec_sign</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                                            <a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>'-'</span> <span class='Operator'>: </span><span class='String'>'+'</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"%c%d-%d %c%d %c%d:%02d:"</span><span class='Delimiter'>, 
</span>                            <a href="datetime.c.html#LN4303"><span class='Ref_To_Local'>year_sign</span></a><span class='Delimiter'>, </span>abs<span class='Parentheses'>(</span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span>abs<span class='Parentheses'>(</span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="datetime.c.html#LN4304"><span class='Ref_To_Local'>day_sign</span></a><span class='Delimiter'>, </span>abs<span class='Parentheses'>(</span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="datetime.c.html#LN4305"><span class='Ref_To_Local'>sec_sign</span></a><span class='Delimiter'>, </span>abs<span class='Parentheses'>(</span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span>abs<span class='Parentheses'>(</span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN45"><span class='Ref_to_Proto'>AppendSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !sql_standard_value &raquo; </span> 
                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4269"><span class='Ref_To_Local'>has_year_month</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"%d-%d"</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4272"><span class='Ref_To_Local'>has_day</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"%d %d:%02d:"</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN45"><span class='Ref_to_Proto'>AppendSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"%d:%02d:"</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN45"><span class='Ref_to_Proto'>AppendSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* ISO 8601 "time-intervals by duration only" */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN19"><span class='Ref_to_Const'>INTSTYLE_ISO_8601</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* special-case zero to avoid printing nothing */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                <a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"PT0S"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'P'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN737"><span class='Ref_to_Func'>AddISO8601IntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a><span class='Delimiter'>, </span><span class='String'>'Y'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN737"><span class='Ref_to_Func'>AddISO8601IntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a><span class='Delimiter'>, </span><span class='String'>'M'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN737"><span class='Ref_to_Func'>AddISO8601IntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a><span class='Delimiter'>, </span><span class='String'>'D'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'T'</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN737"><span class='Ref_to_Func'>AddISO8601IntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><span class='String'>'H'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN737"><span class='Ref_to_Func'>AddISO8601IntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a><span class='Delimiter'>, </span><span class='String'>'M'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN45"><span class='Ref_to_Proto'>AppendSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'S'</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Compatible with postgresql &LT; 8.4 when DateStyle = 'iso' */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN16"><span class='Ref_to_Const'>INTSTYLE_POSTGRES</span></a><span class='Operator'>: 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN714"><span class='Ref_to_Func'>AddPostgresIntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a><span class='Delimiter'>, </span><span class='String'>"year"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Ideally we should spell out "month" like we do for "year" and 
             * "day".  However, for backward compatibility, we can't easily 
             * fix this.  bjm 2011-05-24 
             */ 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN714"><span class='Ref_to_Func'>AddPostgresIntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a><span class='Delimiter'>, </span><span class='String'>"mon"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN714"><span class='Ref_to_Func'>AddPostgresIntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a><span class='Delimiter'>, </span><span class='String'>"day"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a> <span class='Operator'>|| </span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4377"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>minus</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"%s%s%02d:%02d:"</span><span class='Delimiter'>, 
</span>                        <a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a> <span class='Operator'>? </span><span class='String'>""</span> <span class='Operator'>: </span><span class='String'>" "</span><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="datetime.c.html#LN4377"><span class='Ref_To_Local'>minus</span></a> <span class='Operator'>? </span><span class='String'>"-"</span> <span class='Operator'>: </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a> <span class='Operator'>? </span><span class='String'>"+"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                        abs<span class='Parentheses'>(</span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span>abs<span class='Parentheses'>(</span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+= </span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN45"><span class='Ref_to_Proto'>AppendSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Compatible with postgresql &LT; 8.4 when DateStyle != 'iso' */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN17"><span class='Ref_to_Const'>INTSTYLE_POSTGRES_VERBOSE</span></a><span class='Operator'>: 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"@"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN694"><span class='Ref_to_Func'>AddVerboseIntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4243"><span class='Ref_To_Local'>year</span></a><span class='Delimiter'>, </span><span class='String'>"year"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN694"><span class='Ref_to_Func'>AddVerboseIntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4244"><span class='Ref_To_Local'>mon</span></a><span class='Delimiter'>, </span><span class='String'>"mon"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN694"><span class='Ref_to_Func'>AddVerboseIntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4245"><span class='Ref_To_Local'>mday</span></a><span class='Delimiter'>, </span><span class='String'>"day"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN694"><span class='Ref_to_Func'>AddVerboseIntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4246"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><span class='String'>"hour"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN694"><span class='Ref_to_Func'>AddVerboseIntPart</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4247"><span class='Ref_To_Local'>min</span></a><span class='Delimiter'>, </span><span class='String'>"min"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>' '</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Parentheses'>) 
</span>                        <a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN45"><span class='Ref_to_Proto'>AppendSeconds</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>" sec%s"</span><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span>abs<span class='Parentheses'>(</span><a href="datetime.c.html#LN4248"><span class='Ref_To_Local'>sec</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4240"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='String'>"s"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* identically zero? then put in a unitless zero... */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4250"><span class='Ref_To_Local'>is_zero</span></a><span class='Parentheses'>) 
</span>                strcat<span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>" 0"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4249"><span class='Ref_To_Local'>is_before</span></a><span class='Parentheses'>) 
</span>                strcat<span class='Parentheses'>(</span><a href="datetime.c.html#LN4242"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>" ago"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch style &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end EncodeInterval &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * We've been burnt by stupid errors in the ordering of the datetkn tables 
 * once too often.  Arrange to check them during postmaster start. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4431"></a><span class='Declare_Function'>CheckDateTokenTable</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablename</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>base</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4433"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ok</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN4434"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN4431"><span class='Ref_to_Parameter'>nel</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* check for token strings that don't fit */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4431"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN199"><span class='Ref_to_Const'>TOKMAXLEN</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* %.*s is safe since all our tokens are ASCII */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"token too long in %s table: \"%.*s\""</span><span class='Delimiter'>, 
</span>                 <a href="datetime.c.html#LN4431"><span class='Ref_to_Parameter'>tablename</span></a><span class='Delimiter'>, 
</span>                 <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN199"><span class='Ref_to_Const'>TOKMAXLEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN4431"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4433"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* don't risk applying strcmp */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* check for out of order */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            strcmp<span class='Parentheses'>(</span><a href="datetime.c.html#LN4431"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4431"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"ordering error in %s table: \"%s\" &GT;= \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="datetime.c.html#LN4431"><span class='Ref_to_Parameter'>tablename</span></a><span class='Delimiter'>, 
</span>                 <a href="datetime.c.html#LN4431"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>, 
</span>                 <a href="datetime.c.html#LN4431"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>[</span><a href="datetime.c.html#LN4434"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4433"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nel;i++ &raquo; </span> 
    <span class='Control'>return</span> <a href="datetime.c.html#LN4433"><span class='Ref_To_Local'>ok</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CheckDateTokenTable &raquo; </span> 
 
<span class='Keyword'>bool 
</span><a name="LN4463"></a><span class='Declare_Function'>CheckDateTokenTables</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4465"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ok</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a> <span class='Operator'>== </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><span class='Number'>1970</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a> <span class='Operator'>== </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><span class='Number'>2000</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4465"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>&= </span><a href="datetime.c.html#LN4430"><span class='Ref_to_Func'>CheckDateTokenTable</span></a><span class='Parentheses'>(</span><span class='String'>"datetktbl"</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN18"><span class='Ref_to_Global_Var'>datetktbl</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN167"><span class='Ref_to_Global_Var'>szdatetktbl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4465"><span class='Ref_To_Local'>ok</span></a> <span class='Operator'>&= </span><a href="datetime.c.html#LN4430"><span class='Ref_to_Func'>CheckDateTokenTable</span></a><span class='Parentheses'>(</span><span class='String'>"deltatktbl"</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN173"><span class='Ref_to_Global_Var'>deltatktbl</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN240"><span class='Ref_to_Global_Var'>szdeltatktbl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN4465"><span class='Ref_To_Local'>ok</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Common code for temporal protransform functions.  Types time, timetz, 
 * timestamp and timestamptz each have a range of allowed precisions.  An 
 * unspecified precision is rigorously equivalent to the highest specifiable 
 * precision. 
 * 
 * Note: timestamp_scale throws an error when the typmod is out of range, but 
 * we can't get there from a cast: our typmodin will have caught it already. 
 */ 
</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>* 
</span><a name="LN4485"></a><span class='Declare_Function'>TemporalTransform</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>max_precis</span><span class='Delimiter'>, </span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4487"></a>    <a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4485"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4488"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4489"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>typmod</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4487"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4489"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4487"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4489"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>)</span> <span class='Operator'>&&!</span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4489"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4497"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>source</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4487"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4498"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>old_precis</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4497"><span class='Ref_To_Local'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4499"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>new_precis</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4489"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constvalue<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4499"><span class='Ref_To_Local'>new_precis</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="datetime.c.html#LN4499"><span class='Ref_To_Local'>new_precis</span></a> <span class='Operator'>== </span><a href="datetime.c.html#LN4485"><span class='Ref_to_Parameter'>max_precis</span></a> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="datetime.c.html#LN4498"><span class='Ref_To_Local'>old_precis</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN4499"><span class='Ref_To_Local'>new_precis</span></a> <span class='Operator'>&GT;= </span><a href="datetime.c.html#LN4498"><span class='Ref_To_Local'>old_precis</span></a><span class='Parentheses'>))</span> 
            <a href="datetime.c.html#LN4488"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN34"><span class='Ref_to_Proto'>relabel_to_typmod</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4497"><span class='Ref_To_Local'>source</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4499"><span class='Ref_To_Local'>new_precis</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="datetime.c.html#LN4488"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TemporalTransform &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This function gets called during timezone config file load or reload 
 * to create the final array of timezone tokens.  The argument array 
 * is already sorted in name order. 
 * 
 * The result is a TimeZoneAbbrevTable (which must be a single malloc'd chunk) 
 * or NULL on malloc failure.  No other error conditions are defined. 
 */ 
</span><a href="../../../include/utils/datetime.h.html#LN217"><span class='Ref_to_Struct'>TimeZoneAbbrevTable</span></a> <span class='Operator'>* 
</span><a name="LN4518"></a><span class='Declare_Function'>ConvertTimeZoneAbbrevs</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/utils/tzparser.h.html#LN22"><span class='Ref_to_Struct'>tzEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>abbrevs</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4520"></a>    <a href="../../../include/utils/datetime.h.html#LN217"><span class='Ref_to_Struct'>TimeZoneAbbrevTable</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tbl</span><span class='Delimiter'>; 
</span><a name="LN4521"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>tbl_size</span><span class='Delimiter'>; 
</span><a name="LN4522"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Space for fixed fields and datetkn array */ 
</span>    <a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN217"><span class='Ref_to_Struct'>TimeZoneAbbrevTable</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>abbrevs</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>        <a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Count up space for dynamic abbreviations */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4522"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN4522"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN4522"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4531"></a>        <span class='Control'>struct</span> <a href="../../../include/utils/tzparser.h.html#LN22"><span class='Ref_to_Struct'>tzEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>abbr</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>abbrevs</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN4522"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4531"><span class='Ref_To_Local'>abbr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/tzparser.h.html#LN26"><span class='Ref_to_Member'>zone</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4535"></a>            <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>dsize</span><span class='Delimiter'>; 
</span> 
            <a href="datetime.c.html#LN4535"><span class='Ref_To_Local'>dsize</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN226"><span class='Ref_to_Struct'>DynamicZoneAbbrev</span></a><span class='Delimiter'>, </span><a href="../../../timezone/zic.c.html#LN89"><span class='Ref_to_Struct'>zone</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4531"><span class='Ref_To_Local'>abbr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/tzparser.h.html#LN26"><span class='Ref_to_Member'>zone</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a> <span class='Operator'>+= </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4535"><span class='Ref_To_Local'>dsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Alloc the result ... */ 
</span>    <a href="datetime.c.html#LN4520"><span class='Ref_To_Local'>tbl</span></a> <span class='Operator'>= </span><a href="../../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN4520"><span class='Ref_To_Local'>tbl</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ... and fill it in */ 
</span>    <a href="datetime.c.html#LN4520"><span class='Ref_To_Local'>tbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN219"><span class='Ref_to_Member'>tblsize</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4520"><span class='Ref_To_Local'>tbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN220"><span class='Ref_to_Member'>numabbrevs</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* in this loop, tbl_size reprises the space calculation above */ 
</span>    <a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN217"><span class='Ref_to_Struct'>TimeZoneAbbrevTable</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>abbrevs</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>        <a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4522"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="datetime.c.html#LN4522"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN4522"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4557"></a>        <span class='Control'>struct</span> <a href="../../../include/utils/tzparser.h.html#LN22"><span class='Ref_to_Struct'>tzEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>abbr</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>abbrevs</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN4522"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span><a name="LN4558"></a>        <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>dtoken</span> <span class='Operator'>= </span><a href="datetime.c.html#LN4520"><span class='Ref_To_Local'>tbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN221"><span class='Ref_to_Member'>abbrevs</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN4522"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* use strlcpy to truncate name if necessary */ 
</span>        <a href="../../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4558"><span class='Ref_To_Local'>dtoken</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4557"><span class='Ref_To_Local'>abbr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/tzparser.h.html#LN25"><span class='Ref_to_Member'>abbrev</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN199"><span class='Ref_to_Const'>TOKMAXLEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4557"><span class='Ref_To_Local'>abbr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/tzparser.h.html#LN26"><span class='Ref_to_Member'>zone</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Allocate a DynamicZoneAbbrev for this abbreviation */ 
</span><a name="LN4565"></a>            <a href="../../../include/utils/datetime.h.html#LN226"><span class='Ref_to_Struct'>DynamicZoneAbbrev</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dtza</span><span class='Delimiter'>; 
</span><a name="LN4566"></a>            <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>dsize</span><span class='Delimiter'>; 
</span> 
            <a href="datetime.c.html#LN4565"><span class='Ref_To_Local'>dtza</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN226"><span class='Ref_to_Struct'>DynamicZoneAbbrev</span></a> <span class='Operator'>*</span><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4520"><span class='Ref_To_Local'>tbl</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4565"><span class='Ref_To_Local'>dtza</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN228"><span class='Ref_to_Member'>tz</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="../../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4565"><span class='Ref_To_Local'>dtza</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN229"><span class='Ref_to_Member'>zone</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4557"><span class='Ref_To_Local'>abbr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/tzparser.h.html#LN26"><span class='Ref_to_Member'>zone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="datetime.c.html#LN4558"><span class='Ref_To_Local'>dtoken</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN205"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN96"><span class='Ref_to_Const'>DYNTZ</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* value is offset from table start to DynamicZoneAbbrev */ 
</span>            <a href="datetime.c.html#LN4558"><span class='Ref_To_Local'>dtoken</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a><span class='Delimiter'>; 
</span> 
            <a href="datetime.c.html#LN4566"><span class='Ref_To_Local'>dsize</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN226"><span class='Ref_to_Struct'>DynamicZoneAbbrev</span></a><span class='Delimiter'>, </span><a href="../../../timezone/zic.c.html#LN89"><span class='Ref_to_Struct'>zone</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                strlen<span class='Parentheses'>(</span><a href="datetime.c.html#LN4557"><span class='Ref_To_Local'>abbr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/tzparser.h.html#LN26"><span class='Ref_to_Member'>zone</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a> <span class='Operator'>+= </span><a href="../../../include/c.h.html#LN587"><span class='Ref_to_Macro'>MAXALIGN</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4566"><span class='Ref_To_Local'>dsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="datetime.c.html#LN4558"><span class='Ref_To_Local'>dtoken</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN205"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN4557"><span class='Ref_To_Local'>abbr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/tzparser.h.html#LN29"><span class='Ref_to_Member'>is_dst</span></a> <span class='Operator'>? </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN95"><span class='Ref_to_Const'>DTZ</span></a> <span class='Operator'>: </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4558"><span class='Ref_To_Local'>dtoken</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="datetime.c.html#LN4557"><span class='Ref_To_Local'>abbr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/tzparser.h.html#LN28"><span class='Ref_to_Member'>offset</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;n;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Assert the two loops above agreed on size calculations */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4520"><span class='Ref_To_Local'>tbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN219"><span class='Ref_to_Member'>tblsize</span></a> <span class='Operator'>== </span><a href="datetime.c.html#LN4521"><span class='Ref_To_Local'>tbl_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check the ordering, if testing */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4430"><span class='Ref_to_Func'>CheckDateTokenTable</span></a><span class='Parentheses'>(</span><span class='String'>"timezone abbreviations"</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN4520"><span class='Ref_To_Local'>tbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN221"><span class='Ref_to_Member'>abbrevs</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4518"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="datetime.c.html#LN4520"><span class='Ref_To_Local'>tbl</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ConvertTimeZoneAbbrevs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Install a TimeZoneAbbrevTable as the active table. 
 * 
 * Caller is responsible that the passed table doesn't go away while in use. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4602"></a><span class='Declare_Function'>InstallTimeZoneAbbrevs</span><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN217"><span class='Ref_to_Struct'>TimeZoneAbbrevTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="datetime.c.html#LN242"><span class='Ref_to_Global_Var'>zoneabbrevtbl</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN4602"><span class='Ref_to_Parameter'>tbl</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* reset abbrevcache, which may contain pointers into old table */ 
</span>    memset<span class='Parentheses'>(</span><a href="datetime.c.html#LN250"><span class='Ref_to_Global_Var'>abbrevcache</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN250"><span class='Ref_to_Global_Var'>abbrevcache</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Helper subroutine to locate pg_tz timezone for a dynamic abbreviation. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>* 
</span><a name="LN4613"></a><span class='Declare_Function'>FetchDynamicTimeZone</span><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN217"><span class='Ref_to_Struct'>TimeZoneAbbrevTable</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tbl</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4615"></a>    <a href="../../../include/utils/datetime.h.html#LN226"><span class='Ref_to_Struct'>DynamicZoneAbbrev</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dtza</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Just some sanity checks to prevent indexing off into nowhere */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4613"><span class='Ref_to_Parameter'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN205"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN96"><span class='Ref_to_Const'>DYNTZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4613"><span class='Ref_to_Parameter'>tp</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="datetime.c.html#LN4613"><span class='Ref_to_Parameter'>tp</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value </span><span class='Operator'>&LT; </span><a href="datetime.c.html#LN4613"><span class='Ref_to_Parameter'>tbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN219"><span class='Ref_to_Member'>tblsize</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4615"><span class='Ref_To_Local'>dtza</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN226"><span class='Ref_to_Struct'>DynamicZoneAbbrev</span></a> <span class='Operator'>*</span><span class='Parentheses'>) ((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4613"><span class='Ref_to_Parameter'>tbl</span></a> <span class='Operator'>+ </span><a href="datetime.c.html#LN4613"><span class='Ref_to_Parameter'>tp</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look up the underlying zone if we haven't already */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4615"><span class='Ref_To_Local'>dtza</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN228"><span class='Ref_to_Member'>tz</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN4615"><span class='Ref_To_Local'>dtza</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN228"><span class='Ref_to_Member'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4615"><span class='Ref_To_Local'>dtza</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN229"><span class='Ref_to_Member'>zone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ideally we'd let the caller ereport instead of doing it here, but 
         * then there is no way to report the bad time zone name. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4615"><span class='Ref_To_Local'>dtza</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN228"><span class='Ref_to_Member'>tz</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CONFIG_FILE_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                            <a href="datetime.c.html#LN4615"><span class='Ref_To_Local'>dtza</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN229"><span class='Ref_to_Member'>zone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"This time zone name appears in the configuration file for time zone abbreviation \"%s\"."</span><span class='Delimiter'>, 
</span>                               <a href="datetime.c.html#LN4613"><span class='Ref_to_Parameter'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN4615"><span class='Ref_To_Local'>dtza</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN228"><span class='Ref_to_Member'>tz</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end FetchDynamicTimeZone &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * This set-returning function reads all the available time zone abbreviations 
 * and returns a set of (abbrev, utc_offset, is_dst). 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4649"></a><span class='Declare_Function'>pg_timezone_abbrevs</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4651"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN4652"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>pindex</span><span class='Delimiter'>; 
</span><a name="LN4653"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4654"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4655"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN4656"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN4657"></a>    <span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN202"><span class='Ref_to_Typedef'>datetkn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN4658"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buffer</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN199"><span class='Ref_to_Const'>TOKMAXLEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4659"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>gmtoffset</span><span class='Delimiter'>; 
</span><a name="LN4660"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_dst</span><span class='Delimiter'>; 
</span><a name="LN4661"></a>    <span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN4662"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN4663"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>resInterval</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* stuff done only on the first call of the function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4668"></a>        <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN4669"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* create a function context for cross-call persistence */ 
</span>        <a href="datetime.c.html#LN4651"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * switch to memory context appropriate for multiple function calls 
         */ 
</span>        <a href="datetime.c.html#LN4669"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4651"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* allocate memory for user context */ 
</span>        <a href="datetime.c.html#LN4652"><span class='Ref_To_Local'>pindex</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN4652"><span class='Ref_To_Local'>pindex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN4651"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4652"><span class='Ref_To_Local'>pindex</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * build tupdesc for result tuples. This must match this function's 
         * pg_proc entry! 
         */ 
</span>        <a href="datetime.c.html#LN4668"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4668"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"abbrev"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4668"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"utc_offset"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4668"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='String'>"is_dst"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="datetime.c.html#LN4651"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN119"><span class='Ref_to_Member'>tuple_desc</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4668"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4669"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* stuff done on every call of the function */ 
</span>    <a href="datetime.c.html#LN4651"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4652"><span class='Ref_To_Local'>pindex</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4651"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN242"><span class='Ref_to_Global_Var'>zoneabbrevtbl</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <span class='Operator'>*</span><a href="datetime.c.html#LN4652"><span class='Ref_To_Local'>pindex</span></a> <span class='Operator'>&GT;= </span><a href="datetime.c.html#LN242"><span class='Ref_to_Global_Var'>zoneabbrevtbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN220"><span class='Ref_to_Member'>numabbrevs</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4651"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4657"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN242"><span class='Ref_to_Global_Var'>zoneabbrevtbl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/datetime.h.html#LN221"><span class='Ref_to_Member'>abbrevs</span></a> <span class='Operator'>+ *</span><a href="datetime.c.html#LN4652"><span class='Ref_To_Local'>pindex</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4657"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN205"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a><span class='Operator'>: 
</span>            <a href="datetime.c.html#LN4659"><span class='Ref_To_Local'>gmtoffset</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN4657"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4660"><span class='Ref_To_Local'>is_dst</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN95"><span class='Ref_to_Const'>DTZ</span></a><span class='Operator'>: 
</span>            <a href="datetime.c.html#LN4659"><span class='Ref_To_Local'>gmtoffset</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN4657"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4660"><span class='Ref_To_Local'>is_dst</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN96"><span class='Ref_to_Const'>DYNTZ</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Determine the current meaning of the abbrev */ 
</span><a name="LN4723"></a>                <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tzp</span><span class='Delimiter'>; 
</span><a name="LN4724"></a>                <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>now</span><span class='Delimiter'>; 
</span><a name="LN4725"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>isdst</span><span class='Delimiter'>; 
</span> 
                <a href="datetime.c.html#LN4723"><span class='Ref_To_Local'>tzp</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN56"><span class='Ref_to_Proto'>FetchDynamicTimeZone</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN242"><span class='Ref_to_Global_Var'>zoneabbrevtbl</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4657"><span class='Ref_To_Local'>tp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN4724"><span class='Ref_To_Local'>now</span></a> <span class='Operator'>= </span><a href="../../../include/access/xact.h.html#LN340"><span class='Ref_to_Proto'>GetCurrentTransactionStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN4659"><span class='Ref_To_Local'>gmtoffset</span></a> <span class='Operator'>= -</span><a href="../../../include/utils/datetime.h.html#LN313"><span class='Ref_to_Proto'>DetermineTimeZoneAbbrevOffsetTS</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4724"><span class='Ref_To_Local'>now</span></a><span class='Delimiter'>, 
</span>                                                             <a href="datetime.c.html#LN4657"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>, 
</span>                                                             <a href="datetime.c.html#LN4723"><span class='Ref_To_Local'>tzp</span></a><span class='Delimiter'>, 
</span>                                                             <span class='Operator'>&</span><a href="datetime.c.html#LN4725"><span class='Ref_To_Local'>isdst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="datetime.c.html#LN4660"><span class='Ref_To_Local'>is_dst</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4725"><span class='Ref_To_Local'>isdst</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized timezone type %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4657"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN205"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4659"><span class='Ref_To_Local'>gmtoffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <a href="datetime.c.html#LN4660"><span class='Ref_To_Local'>is_dst</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch tp-&GT;type &raquo; </span> 
 
    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4656"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4656"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert name to text, using upcasing conversion that is the inverse of 
     * what ParseDateTime() uses. 
     */ 
</span>    <a href="../../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4658"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4657"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN204"><span class='Ref_to_Member'>token</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4658"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4661"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4658"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="datetime.c.html#LN4661"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="datetime.c.html#LN4661"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Operator'>*</span><a href="datetime.c.html#LN4661"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../port/pgstrcasecmp.c.html#LN103"><span class='Ref_to_Func'>pg_toupper</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN4661"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4655"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4658"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert offset (in seconds) to an interval */ 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="datetime.c.html#LN4662"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4662"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN4659"><span class='Ref_To_Local'>gmtoffset</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4663"><span class='Ref_To_Local'>resInterval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/timestamp.h.html#LN89"><span class='Ref_to_Proto'>tm2interval</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="datetime.c.html#LN4662"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN4663"><span class='Ref_To_Local'>resInterval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4655"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4663"><span class='Ref_To_Local'>resInterval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4655"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4660"><span class='Ref_To_Local'>is_dst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="datetime.c.html#LN4652"><span class='Ref_To_Local'>pindex</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4654"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4651"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN119"><span class='Ref_to_Member'>tuple_desc</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4655"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4656"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4653"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN221"><span class='Ref_to_Macro'>HeapTupleGetDatum</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4654"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4651"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4653"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_timezone_abbrevs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * This set-returning function reads all the available full time zones 
 * and returns a set of (name, abbrev, utc_offset, is_dst). 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4777"></a><span class='Declare_Function'>pg_timezone_names</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4779"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN4780"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN4781"></a>    <a href="../../../timezone/pgtz.c.html#LN393"><span class='Ref_to_Struct'>pg_tzenum</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>tzenum</span><span class='Delimiter'>; 
</span><a name="LN4782"></a>    <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN4783"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4784"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN4785"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN4786"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN4787"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tzoff</span><span class='Delimiter'>; 
</span><a name="LN4788"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN4789"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN4790"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tzn</span><span class='Delimiter'>; 
</span><a name="LN4791"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>resInterval</span><span class='Delimiter'>; 
</span><a name="LN4792"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>itm</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* stuff done only on the first call of the function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4797"></a>        <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* create a function context for cross-call persistence */ 
</span>        <a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * switch to memory context appropriate for multiple function calls 
         */ 
</span>        <a href="datetime.c.html#LN4779"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* initialize timezone scanning code */ 
</span>        <a href="datetime.c.html#LN4781"><span class='Ref_To_Local'>tzenum</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN79"><span class='Ref_to_Proto'>pg_tzenumerate_start</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4781"><span class='Ref_To_Local'>tzenum</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * build tupdesc for result tuples. This must match this function's 
         * pg_proc entry! 
         */ 
</span>        <a href="datetime.c.html#LN4797"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4797"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"name"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4797"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"abbrev"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4797"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='String'>"utc_offset"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4797"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>4</span><span class='Delimiter'>, </span><span class='String'>"is_dst"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN119"><span class='Ref_to_Member'>tuple_desc</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4797"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4779"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* stuff done on every call of the function */ 
</span>    <a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4781"><span class='Ref_To_Local'>tzenum</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../timezone/pgtz.c.html#LN393"><span class='Ref_to_Struct'>pg_tzenum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* search for another zone to display */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="datetime.c.html#LN4779"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN4782"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN80"><span class='Ref_to_Proto'>pg_tzenumerate_next</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4781"><span class='Ref_To_Local'>tzenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4779"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="datetime.c.html#LN4782"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/pgtime.h.html#LN81"><span class='Ref_to_Proto'>pg_tzenumerate_end</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4781"><span class='Ref_To_Local'>tzenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Convert now() to local time in this zone */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN340"><span class='Ref_to_Proto'>GetCurrentTransactionStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="datetime.c.html#LN4787"><span class='Ref_To_Local'>tzoff</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4788"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4789"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="datetime.c.html#LN4790"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4782"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore if conversion fails */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Ignore zic's rather silly "Factory" time zone.  The long string 
         * about "see zic manual page" is used in tzdata versions before 
         * 2016g; we can drop it someday when we're pretty sure no such data 
         * exists in the wild on platforms using --with-system-tzdata.  In 
         * 2016g and later, the time zone abbreviation "-00" is used for 
         * "Factory" as well as some invalid cases, all of which we can 
         * reasonably omit from the pg_timezone_names view. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="datetime.c.html#LN4790"><span class='Ref_To_Local'>tzn</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="datetime.c.html#LN4790"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><span class='String'>"-00"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        strcmp<span class='Parentheses'>(</span><a href="datetime.c.html#LN4790"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><span class='String'>"Local time zone must be set--see zic manual page"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Found a displayable zone */ 
</span>        <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4786"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="datetime.c.html#LN4786"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4785"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN62"><span class='Ref_to_Proto'>pg_get_timezone_name</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4782"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4785"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4790"><span class='Ref_To_Local'>tzn</span></a> <span class='Operator'>? </span><a href="datetime.c.html#LN4790"><span class='Ref_To_Local'>tzn</span></a> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="datetime.c.html#LN4792"><span class='Ref_To_Local'>itm</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4792"><span class='Ref_To_Local'>itm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= -</span><a href="datetime.c.html#LN4787"><span class='Ref_To_Local'>tzoff</span></a><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4791"><span class='Ref_To_Local'>resInterval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/timestamp.h.html#LN89"><span class='Ref_to_Proto'>tm2interval</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="datetime.c.html#LN4792"><span class='Ref_To_Local'>itm</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="datetime.c.html#LN4791"><span class='Ref_To_Local'>resInterval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4785"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4791"><span class='Ref_To_Local'>resInterval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4785"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="datetime.c.html#LN4784"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN119"><span class='Ref_to_Member'>tuple_desc</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4785"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4786"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="datetime.c.html#LN4783"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN221"><span class='Ref_to_Macro'>HeapTupleGetDatum</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4784"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN4780"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="datetime.c.html#LN4783"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_timezone_names &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>