<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\dbsize.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\dbsize.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:51 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/* 
 * dbsize.c 
 *      Database object size functions, and related inquiries 
 * 
 * Copyright (c) 2002-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/dbsize.c 
 * 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/stat.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/catalog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_authid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_tablespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/tablespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/fd.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/acl.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/numeric.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/relfilenodemap.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/relmapper.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
<span class='Comment_Multi_Line'>/* Divide by two and round towards positive infinity. */ 
</span><a name="LN34"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>half_rounded</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>   <span class='Parentheses'>(((</span><a href="dbsize.c.html#LN34"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>((</span><a href="dbsize.c.html#LN34"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* Return physical size of directory contents, or 0 if dir doesn't exist */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN38"></a><span class='Declare_Function'>db_dir_size</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN40"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>dirsize</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN41"></a>    <span class='Control'>struct</span> <a href="../../../include/port/win32_msvc/dirent.h.html#LN8"><span class='Ref_to_Struct'>dirent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>direntry</span><span class='Delimiter'>; 
</span><a name="LN42"></a>    <a href="../../../port/dirent.c.html#LN24"><span class='Ref_to_Struct'>DIR</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>dirdesc</span><span class='Delimiter'>; 
</span><a name="LN43"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>filename</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
    <a href="dbsize.c.html#LN42"><span class='Ref_To_Local'>dirdesc</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN91"><span class='Ref_to_Proto'>AllocateDir</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN38"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="dbsize.c.html#LN42"><span class='Ref_To_Local'>dirdesc</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="dbsize.c.html#LN41"><span class='Ref_To_Local'>direntry</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN92"><span class='Ref_to_Proto'>ReadDir</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN42"><span class='Ref_To_Local'>dirdesc</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN38"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN52"></a>        <span class='Control'>struct</span> <a href="../../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>fst</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="dbsize.c.html#LN41"><span class='Ref_To_Local'>direntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><span class='String'>"."</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="dbsize.c.html#LN41"><span class='Ref_To_Local'>direntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><span class='String'>".."</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN43"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN43"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN38"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN41"><span class='Ref_To_Local'>direntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN43"><span class='Ref_To_Local'>filename</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="dbsize.c.html#LN52"><span class='Ref_To_Local'>fst</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not stat file \"%s\": %m"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN43"><span class='Ref_To_Local'>filename</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="dbsize.c.html#LN40"><span class='Ref_To_Local'>dirsize</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN52"><span class='Ref_To_Local'>fst</span></a><span class='Operator'>.</span>st_size<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (direntry=ReadDir(dir... &raquo; </span> 
 
    <a href="../../../include/storage/fd.h.html#LN93"><span class='Ref_to_Proto'>FreeDir</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN42"><span class='Ref_To_Local'>dirdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="dbsize.c.html#LN40"><span class='Ref_To_Local'>dirsize</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end db_dir_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * calculate size of database in all tablespaces 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN82"></a><span class='Declare_Function'>calculate_database_size</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>dbOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN84"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>totalsize</span><span class='Delimiter'>; 
</span><a name="LN85"></a>    <a href="../../../port/dirent.c.html#LN24"><span class='Ref_to_Struct'>DIR</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>dirdesc</span><span class='Delimiter'>; 
</span><a name="LN86"></a>    <span class='Control'>struct</span> <a href="../../../include/port/win32_msvc/dirent.h.html#LN8"><span class='Ref_to_Struct'>dirent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>direntry</span><span class='Delimiter'>; 
</span><a name="LN87"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>dirpath</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN88"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pathname</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>+ </span><span class='Number'>12</span> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/catalog/catalog.h.html#LN25"><span class='Ref_to_Const'>TABLESPACE_VERSION_DIRECTORY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]; 
</span><a name="LN89"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * User must have connect privilege for target database or be a member of 
     * pg_read_all_stats 
     */ 
</span>    <a href="dbsize.c.html#LN89"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN284"><span class='Ref_to_Proto'>pg_database_aclcheck</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN82"><span class='Ref_to_Parameter'>dbOid</span></a><span class='Delimiter'>, </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN83"><span class='Ref_to_Const'>ACL_CONNECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN89"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/utils/acl.h.html#LN230"><span class='Ref_to_Proto'>is_member_of_role</span></a><span class='Parentheses'>(</span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_authid.h.html#LN107"><span class='Ref_to_Const'>DEFAULT_ROLE_READ_ALL_STATS</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN89"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN183"><span class='Ref_to_EnumConst'>ACL_KIND_DATABASE</span></a><span class='Delimiter'>, 
</span>                       <a href="../../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN82"><span class='Ref_to_Parameter'>dbOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Shared storage in pg_global is not counted */ 
</span> 
    <span class='Comment_Multi_Line'>/* Include pg_default storage */ 
</span>    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN88"><span class='Ref_To_Local'>pathname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN88"><span class='Ref_To_Local'>pathname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"base/%u"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN82"><span class='Ref_to_Parameter'>dbOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="dbsize.c.html#LN84"><span class='Ref_To_Local'>totalsize</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN37"><span class='Ref_to_Func'>db_dir_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN88"><span class='Ref_To_Local'>pathname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scan the non-default tablespaces */ 
</span>    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN87"><span class='Ref_To_Local'>dirpath</span></a><span class='Delimiter'>, </span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"pg_tblspc"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="dbsize.c.html#LN85"><span class='Ref_To_Local'>dirdesc</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN91"><span class='Ref_to_Proto'>AllocateDir</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN87"><span class='Ref_To_Local'>dirpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="dbsize.c.html#LN85"><span class='Ref_To_Local'>dirdesc</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not open tablespace directory \"%s\": %m"</span><span class='Delimiter'>, 
</span>                        <a href="dbsize.c.html#LN87"><span class='Ref_To_Local'>dirpath</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="dbsize.c.html#LN86"><span class='Ref_To_Local'>direntry</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN92"><span class='Ref_to_Proto'>ReadDir</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN85"><span class='Ref_To_Local'>dirdesc</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN87"><span class='Ref_To_Local'>dirpath</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="dbsize.c.html#LN86"><span class='Ref_To_Local'>direntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><span class='String'>"."</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="dbsize.c.html#LN86"><span class='Ref_To_Local'>direntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><span class='String'>".."</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN88"><span class='Ref_To_Local'>pathname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN88"><span class='Ref_To_Local'>pathname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"pg_tblspc/%s/%s/%u"</span><span class='Delimiter'>, 
</span>                 <a href="dbsize.c.html#LN86"><span class='Ref_To_Local'>direntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/catalog.h.html#LN25"><span class='Ref_to_Const'>TABLESPACE_VERSION_DIRECTORY</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN82"><span class='Ref_to_Parameter'>dbOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="dbsize.c.html#LN84"><span class='Ref_To_Local'>totalsize</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN37"><span class='Ref_to_Func'>db_dir_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN88"><span class='Ref_To_Local'>pathname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/storage/fd.h.html#LN93"><span class='Ref_to_Proto'>FreeDir</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN85"><span class='Ref_To_Local'>dirdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="dbsize.c.html#LN84"><span class='Ref_To_Local'>totalsize</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calculate_database_size &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN137"></a><span class='Declare_Function'>pg_database_size_oid</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN139"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>dbOid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN140"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN140"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN81"><span class='Ref_to_Func'>calculate_database_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN139"><span class='Ref_To_Local'>dbOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN140"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN140"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN151"></a><span class='Declare_Function'>pg_database_size_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN153"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>dbName</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN154"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>dbOid</span> <span class='Operator'>= </span><a href="../../../include/commands/dbcommands.h.html#LN28"><span class='Ref_to_Proto'>get_database_oid</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="dbsize.c.html#LN153"><span class='Ref_To_Local'>dbName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN155"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN155"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN81"><span class='Ref_to_Func'>calculate_database_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN154"><span class='Ref_To_Local'>dbOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN155"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN155"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate total size of tablespace. Returns -1 if the tablespace directory 
 * cannot be found. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN171"></a><span class='Declare_Function'>calculate_tablespace_size</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>tblspcOid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN173"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tblspcPath</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN174"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pathname</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN175"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>totalsize</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN176"></a>    <a href="../../../port/dirent.c.html#LN24"><span class='Ref_to_Struct'>DIR</span></a>        <span class='Operator'>*</span><span class='Declare_Local'>dirdesc</span><span class='Delimiter'>; 
</span><a name="LN177"></a>    <span class='Control'>struct</span> <a href="../../../include/port/win32_msvc/dirent.h.html#LN8"><span class='Ref_to_Struct'>dirent</span></a> <span class='Operator'>*</span><span class='Declare_Local'>direntry</span><span class='Delimiter'>; 
</span><a name="LN178"></a>    <a href="../../../include/utils/acl.h.html#LN169"><span class='Ref_to_Typedef'>AclResult</span></a>   <span class='Declare_Local'>aclresult</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * User must be a member of pg_read_all_stats or have CREATE privilege for 
     * target tablespace, either explicitly granted or implicitly because it 
     * is default for current database. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN171"><span class='Ref_to_Parameter'>tblspcOid</span></a> <span class='Operator'>!= </span><a href="../init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a> <span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/utils/acl.h.html#LN230"><span class='Ref_to_Proto'>is_member_of_role</span></a><span class='Parentheses'>(</span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_authid.h.html#LN107"><span class='Ref_to_Const'>DEFAULT_ROLE_READ_ALL_STATS</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="dbsize.c.html#LN178"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/acl.h.html#LN290"><span class='Ref_to_Proto'>pg_tablespace_aclcheck</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN171"><span class='Ref_to_Parameter'>tblspcOid</span></a><span class='Delimiter'>, </span><a href="../init/miscinit.c.html#LN281"><span class='Ref_to_Func'>GetUserId</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><a href="../../../include/nodes/parsenodes.h.html#LN81"><span class='Ref_to_Const'>ACL_CREATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN178"><span class='Ref_To_Local'>aclresult</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/acl.h.html#LN171"><span class='Ref_to_EnumConst'>ACLCHECK_OK</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/acl.h.html#LN295"><span class='Ref_to_Proto'>aclcheck_error</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN178"><span class='Ref_To_Local'>aclresult</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/acl.h.html#LN195"><span class='Ref_to_EnumConst'>ACL_KIND_TABLESPACE</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/commands/tablespace.h.html#LN56"><span class='Ref_to_Proto'>get_tablespace_name</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN171"><span class='Ref_to_Parameter'>tblspcOid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN171"><span class='Ref_to_Parameter'>tblspcOid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_tablespace.h.html#LN62"><span class='Ref_to_Const'>DEFAULTTABLESPACE_OID</span></a><span class='Parentheses'>) 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN173"><span class='Ref_To_Local'>tblspcPath</span></a><span class='Delimiter'>, </span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"base"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN171"><span class='Ref_to_Parameter'>tblspcOid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_tablespace.h.html#LN63"><span class='Ref_to_Const'>GLOBALTABLESPACE_OID</span></a><span class='Parentheses'>) 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN173"><span class='Ref_To_Local'>tblspcPath</span></a><span class='Delimiter'>, </span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"global"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN173"><span class='Ref_To_Local'>tblspcPath</span></a><span class='Delimiter'>, </span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"pg_tblspc/%u/%s"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN171"><span class='Ref_to_Parameter'>tblspcOid</span></a><span class='Delimiter'>, 
</span>                 <a href="../../../include/catalog/catalog.h.html#LN25"><span class='Ref_to_Const'>TABLESPACE_VERSION_DIRECTORY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN176"><span class='Ref_To_Local'>dirdesc</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN91"><span class='Ref_to_Proto'>AllocateDir</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN173"><span class='Ref_To_Local'>tblspcPath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="dbsize.c.html#LN176"><span class='Ref_To_Local'>dirdesc</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="dbsize.c.html#LN177"><span class='Ref_To_Local'>direntry</span></a> <span class='Operator'>= </span><a href="../../../include/storage/fd.h.html#LN92"><span class='Ref_to_Proto'>ReadDir</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN176"><span class='Ref_To_Local'>dirdesc</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN173"><span class='Ref_To_Local'>tblspcPath</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN209"></a>        <span class='Control'>struct</span> <a href="../../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>fst</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span>strcmp<span class='Parentheses'>(</span><a href="dbsize.c.html#LN177"><span class='Ref_To_Local'>direntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><span class='String'>"."</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            strcmp<span class='Parentheses'>(</span><a href="dbsize.c.html#LN177"><span class='Ref_To_Local'>direntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Delimiter'>, </span><span class='String'>".."</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN174"><span class='Ref_To_Local'>pathname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN174"><span class='Ref_To_Local'>pathname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>"%s/%s"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN173"><span class='Ref_To_Local'>tblspcPath</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN177"><span class='Ref_To_Local'>direntry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/port/win32_msvc/dirent.h.html#LN13"><span class='Ref_to_Member'>d_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN174"><span class='Ref_To_Local'>pathname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="dbsize.c.html#LN209"><span class='Ref_To_Local'>fst</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not stat file \"%s\": %m"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN174"><span class='Ref_To_Local'>pathname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/port/win32.h.html#LN429"><span class='Ref_to_Macro'>S_ISDIR</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN209"><span class='Ref_To_Local'>fst</span></a><span class='Operator'>.</span>st_mode<span class='Parentheses'>))</span> 
            <a href="dbsize.c.html#LN175"><span class='Ref_To_Local'>totalsize</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN37"><span class='Ref_to_Func'>db_dir_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN174"><span class='Ref_To_Local'>pathname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="dbsize.c.html#LN175"><span class='Ref_To_Local'>totalsize</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN209"><span class='Ref_To_Local'>fst</span></a><span class='Operator'>.</span>st_size<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (direntry=ReadDir(dir... &raquo; </span> 
 
    <a href="../../../include/storage/fd.h.html#LN93"><span class='Ref_to_Proto'>FreeDir</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN176"><span class='Ref_To_Local'>dirdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="dbsize.c.html#LN175"><span class='Ref_To_Local'>totalsize</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calculate_tablespace_size &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN241"></a><span class='Declare_Function'>pg_tablespace_size_oid</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN243"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tblspcOid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN244"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN244"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN170"><span class='Ref_to_Func'>calculate_tablespace_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN243"><span class='Ref_To_Local'>tblspcOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN244"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN244"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN255"></a><span class='Declare_Function'>pg_tablespace_size_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN257"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>tblspcName</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN258"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tblspcOid</span> <span class='Operator'>= </span><a href="../../../include/commands/tablespace.h.html#LN55"><span class='Ref_to_Proto'>get_tablespace_oid</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="dbsize.c.html#LN257"><span class='Ref_To_Local'>tblspcName</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN259"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN259"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN170"><span class='Ref_to_Func'>calculate_tablespace_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN258"><span class='Ref_To_Local'>tblspcOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN259"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN259"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * calculate size of (one fork of) a relation 
 * 
 * Note: we can safely apply this to temp tables of other sessions, so there 
 * is no check here or at the call sites for that. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN277"></a><span class='Declare_Function'>calculate_relation_size</span><span class='Parentheses'>(</span><a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>rfn</span><span class='Delimiter'>, </span><a href="../../../include/storage/backendid.h.html#LN20"><span class='Ref_to_Typedef'>BackendId</span></a> <span class='Declare_Parameter'>backend</span><span class='Delimiter'>, </span><a href="../../../include/common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a> <span class='Declare_Parameter'>forknum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN279"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>totalsize</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN280"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>relationpath</span><span class='Delimiter'>; 
</span><a name="LN281"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>pathname</span><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>]; 
</span><a name="LN282"></a>    <span class='Keyword'>unsigned int </span><span class='Declare_Local'>segcount</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN280"><span class='Ref_To_Local'>relationpath</span></a> <span class='Operator'>= </span><a href="../../../include/common/relpath.h.html#LN61"><span class='Ref_to_Macro'>relpathbackend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="dbsize.c.html#LN277"><span class='Ref_to_Parameter'>rfn</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN277"><span class='Ref_to_Parameter'>backend</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN277"><span class='Ref_to_Parameter'>forknum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN282"><span class='Ref_To_Local'>segcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;; </span><a href="dbsize.c.html#LN282"><span class='Ref_To_Local'>segcount</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN288"></a>        <span class='Control'>struct</span> <a href="../../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a> <span class='Declare_Local'>fst</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN282"><span class='Ref_To_Local'>segcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN281"><span class='Ref_To_Local'>pathname</span></a><span class='Delimiter'>, </span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, 
</span>                     <a href="dbsize.c.html#LN280"><span class='Ref_To_Local'>relationpath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN281"><span class='Ref_To_Local'>pathname</span></a><span class='Delimiter'>, </span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Delimiter'>, </span><span class='String'>"%s.%u"</span><span class='Delimiter'>, 
</span>                     <a href="dbsize.c.html#LN280"><span class='Ref_To_Local'>relationpath</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN282"><span class='Ref_To_Local'>segcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/port.h.html#LN275"><span class='Ref_to_Macro'>stat</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN281"><span class='Ref_To_Local'>pathname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="dbsize.c.html#LN288"><span class='Ref_To_Local'>fst</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>== </span>ENOENT<span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN132"><span class='Ref_to_Proto'>errcode_for_file_access</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not stat file \"%s\": %m"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN281"><span class='Ref_To_Local'>pathname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="dbsize.c.html#LN279"><span class='Ref_To_Local'>totalsize</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN288"><span class='Ref_To_Local'>fst</span></a><span class='Operator'>.</span>st_size<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for segcount=0;;segcount+... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="dbsize.c.html#LN279"><span class='Ref_To_Local'>totalsize</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calculate_relation_size &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN315"></a><span class='Declare_Function'>pg_relation_size</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN317"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relOid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN318"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>forkName</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN319"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN320"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN319"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN85"><span class='Ref_to_Proto'>try_relation_open</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN317"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Before 9.2, we used to throw an error if the relation didn't exist, but 
     * that makes queries like "SELECT pg_relation_size(oid) FROM pg_class" 
     * less robust, because while we scan pg_class with an MVCC snapshot, 
     * someone else might drop the table. It's better to return NULL for 
     * already-dropped tables than throw an error and abort the whole query. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN319"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN320"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN276"><span class='Ref_to_Func'>calculate_relation_size</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN319"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN319"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../include/common/relpath.h.html#LN44"><span class='Ref_to_Proto'>forkname_to_number</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN318"><span class='Ref_To_Local'>forkName</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN319"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN320"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_relation_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate total on-disk size of a TOAST relation, including its indexes. 
 * Must not be applied to non-TOAST relations. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN347"></a><span class='Declare_Function'>calculate_toast_table_size</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>toastrelid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN349"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN350"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>toastRel</span><span class='Delimiter'>; 
</span><a name="LN351"></a>    <a href="../../../include/common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a>  <span class='Declare_Local'>forkNum</span><span class='Delimiter'>; 
</span><a name="LN352"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>lc</span><span class='Delimiter'>; 
</span><a name="LN353"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>indexlist</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN350"><span class='Ref_To_Local'>toastRel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN347"><span class='Ref_to_Parameter'>toastrelid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* toast heap size, including FSM and VM size */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN351"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="dbsize.c.html#LN351"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/common/relpath.h.html#LN38"><span class='Ref_to_Const'>MAX_FORKNUM</span></a><span class='Delimiter'>; </span><a href="dbsize.c.html#LN351"><span class='Ref_To_Local'>forkNum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="dbsize.c.html#LN349"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN276"><span class='Ref_to_Func'>calculate_relation_size</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN350"><span class='Ref_To_Local'>toastRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="dbsize.c.html#LN350"><span class='Ref_To_Local'>toastRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN351"><span class='Ref_To_Local'>forkNum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* toast index size, including FSM and VM size */ 
</span>    <a href="dbsize.c.html#LN353"><span class='Ref_To_Local'>indexlist</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN350"><span class='Ref_To_Local'>toastRel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Size is calculated using all the indexes available */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN352"><span class='Ref_To_Local'>lc</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN353"><span class='Ref_To_Local'>indexlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN368"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>toastIdxRel</span><span class='Delimiter'>; 
</span> 
        <a href="dbsize.c.html#LN368"><span class='Ref_To_Local'>toastIdxRel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN352"><span class='Ref_To_Local'>lc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN351"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="dbsize.c.html#LN351"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/common/relpath.h.html#LN38"><span class='Ref_to_Const'>MAX_FORKNUM</span></a><span class='Delimiter'>; </span><a href="dbsize.c.html#LN351"><span class='Ref_To_Local'>forkNum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="dbsize.c.html#LN349"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN276"><span class='Ref_to_Func'>calculate_relation_size</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN368"><span class='Ref_To_Local'>toastIdxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="dbsize.c.html#LN368"><span class='Ref_To_Local'>toastIdxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN351"><span class='Ref_To_Local'>forkNum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN368"><span class='Ref_To_Local'>toastIdxRel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN353"><span class='Ref_To_Local'>indexlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN350"><span class='Ref_To_Local'>toastRel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="dbsize.c.html#LN349"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calculate_toast_table_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate total on-disk size of a given table, 
 * including FSM and VM, plus TOAST table if any. 
 * Indexes other than the TOAST table's index are not included. 
 * 
 * Note that this also behaves sanely if applied to an index or toast table; 
 * those won't have attached toast tables, but they can have multiple forks. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN393"></a><span class='Declare_Function'>calculate_table_size</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN395"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN396"></a>    <a href="../../../include/common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a>  <span class='Declare_Local'>forkNum</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * heap size, including FSM and VM 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN396"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="dbsize.c.html#LN396"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/common/relpath.h.html#LN38"><span class='Ref_to_Const'>MAX_FORKNUM</span></a><span class='Delimiter'>; </span><a href="dbsize.c.html#LN396"><span class='Ref_To_Local'>forkNum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="dbsize.c.html#LN395"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN276"><span class='Ref_to_Func'>calculate_relation_size</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN393"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN393"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a><span class='Delimiter'>, 
</span>                                        <a href="dbsize.c.html#LN396"><span class='Ref_To_Local'>forkNum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Size of toast relation 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN393"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltoastrelid<span class='Parentheses'>))</span> 
        <a href="dbsize.c.html#LN395"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN346"><span class='Ref_to_Func'>calculate_toast_table_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN393"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>reltoastrelid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="dbsize.c.html#LN395"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calculate_table_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate total on-disk size of all indexes attached to the given table. 
 * 
 * Can be applied safely to an index, but you'll just get zero. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN420"></a><span class='Declare_Function'>calculate_indexes_size</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN422"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Aggregate all indexes on the given relation 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN420"><span class='Ref_to_Parameter'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN113"><span class='Ref_to_Member'>rd_rel</span></a><span class='Operator'>-&GT;</span>relhasindex<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN429"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>index_oids</span> <span class='Operator'>= </span><a href="../../../include/utils/relcache.h.html#LN40"><span class='Ref_to_Proto'>RelationGetIndexList</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN420"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN430"></a>        <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN430"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN429"><span class='Ref_To_Local'>index_oids</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN434"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>idxOid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN430"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN435"></a>            <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>idxRel</span><span class='Delimiter'>; 
</span><a name="LN436"></a>            <a href="../../../include/common/relpath.h.html#LN23"><span class='Ref_to_Enum'>ForkNumber</span></a>  <span class='Declare_Local'>forkNum</span><span class='Delimiter'>; 
</span> 
            <a href="dbsize.c.html#LN435"><span class='Ref_To_Local'>idxRel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN84"><span class='Ref_to_Proto'>relation_open</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN434"><span class='Ref_To_Local'>idxOid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN436"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="dbsize.c.html#LN436"><span class='Ref_To_Local'>forkNum</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/common/relpath.h.html#LN38"><span class='Ref_to_Const'>MAX_FORKNUM</span></a><span class='Delimiter'>; </span><a href="dbsize.c.html#LN436"><span class='Ref_To_Local'>forkNum</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="dbsize.c.html#LN422"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN276"><span class='Ref_to_Func'>calculate_relation_size</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN435"><span class='Ref_To_Local'>idxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN84"><span class='Ref_to_Member'>rd_node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                <a href="dbsize.c.html#LN435"><span class='Ref_To_Local'>idxRel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN88"><span class='Ref_to_Member'>rd_backend</span></a><span class='Delimiter'>, 
</span>                                                <a href="dbsize.c.html#LN436"><span class='Ref_To_Local'>forkNum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN435"><span class='Ref_To_Local'>idxRel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN429"><span class='Ref_To_Local'>index_oids</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rel-&GT;rd_rel-&GT;relhasin... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="dbsize.c.html#LN422"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calculate_indexes_size &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN455"></a><span class='Declare_Function'>pg_table_size</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN457"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relOid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN458"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN459"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN458"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN85"><span class='Ref_to_Proto'>try_relation_open</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN457"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN458"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN459"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN392"><span class='Ref_to_Func'>calculate_table_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN458"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN458"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN459"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN474"></a><span class='Declare_Function'>pg_indexes_size</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN476"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relOid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN477"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN478"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN477"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN85"><span class='Ref_to_Proto'>try_relation_open</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN476"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN477"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN478"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN419"><span class='Ref_to_Func'>calculate_indexes_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN477"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN477"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN478"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *  Compute the on-disk size of all files for the relation, 
 *  including heap data, index data, toast data, FSM, VM. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> 
<a name="LN497"></a><span class='Declare_Function'>calculate_total_relation_size</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>rel</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN499"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Aggregate the table size, this includes size of the heap, toast and 
     * toast index with free space and visibility map 
     */ 
</span>    <a href="dbsize.c.html#LN499"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN392"><span class='Ref_to_Func'>calculate_table_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN497"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add size of all attached indexes as well 
     */ 
</span>    <a href="dbsize.c.html#LN499"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>+= </span><a href="dbsize.c.html#LN419"><span class='Ref_to_Func'>calculate_indexes_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN497"><span class='Ref_to_Parameter'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="dbsize.c.html#LN499"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN516"></a><span class='Declare_Function'>pg_total_relation_size</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN518"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relOid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN519"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN520"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN519"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN85"><span class='Ref_to_Proto'>try_relation_open</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN518"><span class='Ref_To_Local'>relOid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN519"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN520"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN496"><span class='Ref_to_Func'>calculate_total_relation_size</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN519"><span class='Ref_To_Local'>rel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN89"><span class='Ref_to_Proto'>relation_close</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN519"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN520"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * formatting with size units 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN538"></a><span class='Declare_Function'>pg_size_pretty</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN540"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>size</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN541"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>64</span><span class='Delimiter'>]; 
</span><a name="LN542"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>limit</span> <span class='Operator'>= </span><span class='Number'>10</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span><a name="LN543"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>limit2</span> <span class='Operator'>= </span><a href="dbsize.c.html#LN542"><span class='Ref_To_Local'>limit</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="dbsize.c.html#LN542"><span class='Ref_To_Local'>limit</span></a><span class='Parentheses'>)</span> 
        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" bytes"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>9</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* keep one extra bit for rounding */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="dbsize.c.html#LN543"><span class='Ref_To_Local'>limit2</span></a><span class='Parentheses'>)</span> 
            <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" kB"</span><span class='Delimiter'>, 
</span>                     <a href="dbsize.c.html#LN34"><span class='Ref_to_Macro'>half_rounded</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="dbsize.c.html#LN543"><span class='Ref_To_Local'>limit2</span></a><span class='Parentheses'>)</span> 
                <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" MB"</span><span class='Delimiter'>, 
</span>                         <a href="dbsize.c.html#LN34"><span class='Ref_to_Macro'>half_rounded</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="dbsize.c.html#LN543"><span class='Ref_To_Local'>limit2</span></a><span class='Parentheses'>)</span> 
                    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" GB"</span><span class='Delimiter'>, 
</span>                             <a href="dbsize.c.html#LN34"><span class='Ref_to_Macro'>half_rounded</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" TB"</span><span class='Delimiter'>, 
</span>                             <a href="dbsize.c.html#LN34"><span class='Ref_to_Macro'>half_rounded</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN540"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN541"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_size_pretty &raquo; </span> 
 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN579"></a><span class='Declare_Function'>numeric_to_cstring</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN581"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN579"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN639"><span class='Ref_to_Func'>numeric_out</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN581"><span class='Ref_To_Local'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> 
<a name="LN587"></a><span class='Declare_Function'>int64_to_numeric</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>v</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN589"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN587"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN589"><span class='Ref_To_Local'>d</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN595"></a><span class='Declare_Function'>numeric_is_less</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN597"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>da</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN595"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN598"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>db</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN595"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2094"><span class='Ref_to_Func'>numeric_lt</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN597"><span class='Ref_To_Local'>da</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN598"><span class='Ref_To_Local'>db</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> 
<a name="LN604"></a><span class='Declare_Function'>numeric_absolute</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN606"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN604"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN607"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN607"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1077"><span class='Ref_to_Func'>numeric_abs</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN606"><span class='Ref_To_Local'>d</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN607"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> 
<a name="LN614"></a><span class='Declare_Function'>numeric_half_rounded</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN616"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN614"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN617"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>zero</span><span class='Delimiter'>; 
</span><a name="LN618"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>one</span><span class='Delimiter'>; 
</span><a name="LN619"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>two</span><span class='Delimiter'>; 
</span><a name="LN620"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN617"><span class='Ref_To_Local'>zero</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="dbsize.c.html#LN618"><span class='Ref_To_Local'>one</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="dbsize.c.html#LN619"><span class='Ref_To_Local'>two</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2079"><span class='Ref_to_Func'>numeric_ge</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN616"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN617"><span class='Ref_To_Local'>zero</span></a><span class='Parentheses'>)))</span> 
        <a href="dbsize.c.html#LN616"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2246"><span class='Ref_to_Func'>numeric_add</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN616"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN618"><span class='Ref_To_Local'>one</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="dbsize.c.html#LN616"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2284"><span class='Ref_to_Func'>numeric_sub</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN616"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN618"><span class='Ref_To_Local'>one</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN620"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2412"><span class='Ref_to_Func'>numeric_div_trunc</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN616"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN619"><span class='Ref_To_Local'>two</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN620"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_half_rounded &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> 
<a name="LN636"></a><span class='Declare_Function'>numeric_shift_right</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>n</span><span class='Delimiter'>, </span><span class='Keyword'>unsigned </span><span class='Declare_Parameter'>count</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN638"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>d</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN636"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN639"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>divisor_int64</span><span class='Delimiter'>; 
</span><a name="LN640"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>divisor_numeric</span><span class='Delimiter'>; 
</span><a name="LN641"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN639"><span class='Ref_To_Local'>divisor_int64</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) (</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="dbsize.c.html#LN636"><span class='Ref_to_Parameter'>count</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="dbsize.c.html#LN640"><span class='Ref_To_Local'>divisor_numeric</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN639"><span class='Ref_To_Local'>divisor_int64</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="dbsize.c.html#LN641"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2412"><span class='Ref_to_Func'>numeric_div_trunc</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN638"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN640"><span class='Ref_To_Local'>divisor_numeric</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN641"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN650"></a><span class='Declare_Function'>pg_size_pretty_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN652"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>size</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN653"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>limit</span><span class='Delimiter'>, 
</span><a name="LN654"></a>                <span class='Declare_Local'>limit2</span><span class='Delimiter'>; 
</span><a name="LN655"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN653"><span class='Ref_To_Local'>limit</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN586"><span class='Ref_to_Func'>int64_to_numeric</span></a><span class='Parentheses'>(</span><span class='Number'>10</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="dbsize.c.html#LN654"><span class='Ref_To_Local'>limit2</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN586"><span class='Ref_to_Func'>int64_to_numeric</span></a><span class='Parentheses'>(</span><span class='Number'>10</span> <span class='Operator'>* </span><span class='Number'>1024</span> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN594"><span class='Ref_to_Func'>numeric_is_less</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN603"><span class='Ref_to_Func'>numeric_absolute</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN653"><span class='Ref_To_Local'>limit</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="dbsize.c.html#LN655"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s bytes"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN578"><span class='Ref_to_Func'>numeric_to_cstring</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* keep one extra bit for rounding */ 
</span>        <span class='Comment_Multi_Line'>/* size &GT;&GT;= 9 */ 
</span>        <a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN635"><span class='Ref_to_Func'>numeric_shift_right</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>, </span><span class='Number'>9</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN594"><span class='Ref_to_Func'>numeric_is_less</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN603"><span class='Ref_to_Func'>numeric_absolute</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN654"><span class='Ref_To_Local'>limit2</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN613"><span class='Ref_to_Func'>numeric_half_rounded</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="dbsize.c.html#LN655"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s kB"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN578"><span class='Ref_to_Func'>numeric_to_cstring</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* size &GT;&GT;= 10 */ 
</span>            <a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN635"><span class='Ref_to_Func'>numeric_shift_right</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN594"><span class='Ref_to_Func'>numeric_is_less</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN603"><span class='Ref_to_Func'>numeric_absolute</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN654"><span class='Ref_To_Local'>limit2</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN613"><span class='Ref_to_Func'>numeric_half_rounded</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="dbsize.c.html#LN655"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s MB"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN578"><span class='Ref_to_Func'>numeric_to_cstring</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* size &GT;&GT;= 10 */ 
</span>                <a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN635"><span class='Ref_to_Func'>numeric_shift_right</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN594"><span class='Ref_to_Func'>numeric_is_less</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN603"><span class='Ref_to_Func'>numeric_absolute</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN654"><span class='Ref_To_Local'>limit2</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN613"><span class='Ref_to_Func'>numeric_half_rounded</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="dbsize.c.html#LN655"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s GB"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN578"><span class='Ref_to_Func'>numeric_to_cstring</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* size &GT;&GT;= 10 */ 
</span>                    <a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN635"><span class='Ref_to_Func'>numeric_shift_right</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN613"><span class='Ref_to_Func'>numeric_half_rounded</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="dbsize.c.html#LN655"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s TB"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN578"><span class='Ref_to_Func'>numeric_to_cstring</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN652"><span class='Ref_To_Local'>size</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN655"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_size_pretty_numeric &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert a human-readable size to a size in bytes 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN712"></a><span class='Declare_Function'>pg_size_bytes</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN714"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN715"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>, 
</span><a name="LN716"></a>               <span class='Operator'>*</span><span class='Declare_Local'>strptr</span><span class='Delimiter'>, 
</span><a name="LN717"></a>               <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span><a name="LN718"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>saved_char</span><span class='Delimiter'>; 
</span><a name="LN719"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span><a name="LN720"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN721"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_digits</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN715"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN714"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip leading whitespace */ 
</span>    <a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN715"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Parentheses'>))</span> 
        <a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check that we have a valid number and determine where it ends */ 
</span>    <a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Part (1): sign */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| *</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><span class='String'>'+'</span><span class='Parentheses'>) 
</span>        <a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Part (2): main digit string */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="dbsize.c.html#LN721"><span class='Ref_To_Local'>have_digits</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>do</span> 
            <a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Part (3): optional decimal point and fractional digits */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="dbsize.c.html#LN721"><span class='Ref_To_Local'>have_digits</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>do</span> 
                <a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Complain if we don't have a valid number at this point */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="dbsize.c.html#LN721"><span class='Ref_To_Local'>have_digits</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid size: \"%s\""</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN715"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Part (4): optional exponent */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><span class='String'>'e'</span> <span class='Operator'>|| *</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><span class='String'>'E'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN768"></a>        <span class='Keyword'>long</span>        <span class='Declare_Local'>exponent</span><span class='Delimiter'>; 
</span><a name="LN769"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note we might one day support EB units, so if what follows 'E' 
         * isn't a number, just treat it all as a unit to be parsed. 
         */ 
</span>        <a href="dbsize.c.html#LN768"><span class='Ref_To_Local'>exponent</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="dbsize.c.html#LN769"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="dbsize.c.html#LN768"><span class='Ref_To_Local'>exponent</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* Silence -Wunused-result warnings */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN769"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>&GT; </span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN769"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the number, saving the next character, which may be the first 
     * character of the unit string. 
     */ 
</span>    <a href="dbsize.c.html#LN718"><span class='Ref_To_Local'>saved_char</span></a> <span class='Operator'>= *</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN719"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN557"><span class='Ref_to_Func'>numeric_in</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN718"><span class='Ref_To_Local'>saved_char</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip whitespace between number and unit */ 
</span>    <a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Parentheses'>))</span> 
        <a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Handle possible unit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN803"></a>        <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>multiplier</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Trim any trailing whitespace */ 
</span>        <a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN715"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN714"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>))</span> 
            <a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
        <a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="dbsize.c.html#LN717"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Parse the unit case-insensitively */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Delimiter'>, </span><span class='String'>"bytes"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="dbsize.c.html#LN803"><span class='Ref_To_Local'>multiplier</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Delimiter'>, </span><span class='String'>"kb"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="dbsize.c.html#LN803"><span class='Ref_To_Local'>multiplier</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Delimiter'>, </span><span class='String'>"mb"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="dbsize.c.html#LN803"><span class='Ref_To_Local'>multiplier</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>1024</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Delimiter'>, </span><span class='String'>"gb"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="dbsize.c.html#LN803"><span class='Ref_To_Local'>multiplier</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>1024</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>1024</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Delimiter'>, </span><span class='String'>"tb"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="dbsize.c.html#LN803"><span class='Ref_To_Local'>multiplier</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Number'>1024</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>1024</span> <span class='Operator'>* </span><span class='Number'>1024</span> <span class='Operator'>* </span><span class='Number'>1024</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>else</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid size: \"%s\""</span><span class='Delimiter'>, </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN714"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Invalid size unit: \"%s\"."</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN716"><span class='Ref_To_Local'>strptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Valid units are \"bytes\", \"kB\", \"MB\", \"GB\", and \"TB\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN803"><span class='Ref_To_Local'>multiplier</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN837"></a>            <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>mul_num</span><span class='Delimiter'>; 
</span> 
            <a href="dbsize.c.html#LN837"><span class='Ref_To_Local'>mul_num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN803"><span class='Ref_To_Local'>multiplier</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="dbsize.c.html#LN719"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2322"><span class='Ref_to_Func'>numeric_mul</span></a><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN837"><span class='Ref_To_Local'>mul_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                      <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN719"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *strptr!='\0' &raquo; </span> 
 
    <a href="dbsize.c.html#LN720"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN610"><span class='Ref_to_Macro'>DatumGetInt64</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2985"><span class='Ref_to_Func'>numeric_int8</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN719"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN720"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_size_bytes &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get the filenode of a relation 
 * 
 * This is expected to be used in queries like 
 *      SELECT pg_relation_filenode(oid) FROM pg_class; 
 * That leads to a couple of choices.  We work from the pg_class row alone 
 * rather than actually opening each relation, for efficiency.  We don't 
 * fail if we can't find the relation --- some rows might be visible in 
 * the query's MVCC snapshot even though the relations have been dropped. 
 * (Note: we could avoid using the catcache, but there's little point 
 * because the relation mapper also works "in the now".)  We also don't 
 * fail if the relation doesn't have storage.  In all these cases it 
 * seems better to quietly return NULL. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN869"></a><span class='Declare_Function'>pg_relation_filenode</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN871"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN872"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN873"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN874"></a>    <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relform</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN873"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN871"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN873"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="dbsize.c.html#LN874"><span class='Ref_To_Local'>relform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN873"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN874"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* okay, these have storage */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN874"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relfilenode<span class='Parentheses'>) 
</span>                <a href="dbsize.c.html#LN872"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN874"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relfilenode<span class='Delimiter'>; 
</span>            <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* Consult the relation mapper */ 
</span>                <a href="dbsize.c.html#LN872"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relmapper.h.html#LN37"><span class='Ref_to_Proto'>RelationMapOidToFilenode</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN871"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, 
</span>                                                  <a href="dbsize.c.html#LN874"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relisshared<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no storage, return NULL */ 
</span>            <a href="dbsize.c.html#LN872"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch relform-&GT;relkind &raquo; </span> 
 
    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN873"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN872"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN319"><span class='Ref_to_Macro'>PG_RETURN_OID</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN872"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_relation_filenode &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get the relation via (reltablespace, relfilenode) 
 * 
 * This is expected to be used when somebody wants to match an individual file 
 * on the filesystem back to its table. That's not trivially possible via 
 * pg_class, because that doesn't contain the relfilenodes of shared and nailed 
 * tables. 
 * 
 * We don't fail but return NULL if we cannot find a mapping. 
 * 
 * InvalidOid can be passed instead of the current database's default 
 * tablespace. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN924"></a><span class='Declare_Function'>pg_filenode_relation</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN926"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reltablespace</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN927"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relfilenode</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN928"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>heaprel</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN928"><span class='Ref_To_Local'>heaprel</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relfilenodemap.h.html#LN15"><span class='Ref_to_Proto'>RelidByRelfilenode</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN926"><span class='Ref_To_Local'>reltablespace</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN927"><span class='Ref_To_Local'>relfilenode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN928"><span class='Ref_To_Local'>heaprel</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN319"><span class='Ref_to_Macro'>PG_RETURN_OID</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN928"><span class='Ref_To_Local'>heaprel</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Get the pathname (relative to $PGDATA) of a relation 
 * 
 * See comments for pg_relation_filenode. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN944"></a><span class='Declare_Function'>pg_relation_filepath</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN946"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN947"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN948"></a>    <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>relform</span><span class='Delimiter'>; 
</span><a name="LN949"></a>    <a href="../../../include/storage/relfilenode.h.html#LN56"><span class='Ref_to_Struct'>RelFileNode</span></a> <span class='Declare_Local'>rnode</span><span class='Delimiter'>; 
</span><a name="LN950"></a>    <a href="../../../include/storage/backendid.h.html#LN20"><span class='Ref_to_Typedef'>BackendId</span></a>   <span class='Declare_Local'>backend</span><span class='Delimiter'>; 
</span><a name="LN951"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>path</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN947"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN946"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN947"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN947"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relkind<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN160"><span class='Ref_to_Const'>RELKIND_INDEX</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN161"><span class='Ref_to_Const'>RELKIND_SEQUENCE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN162"><span class='Ref_to_Const'>RELKIND_TOASTVALUE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* okay, these have storage */ 
</span> 
            <span class='Comment_Multi_Line'>/* This logic should match RelationInitPhysicalAddr */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>reltablespace<span class='Parentheses'>) 
</span>                <a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>reltablespace<span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a> <span class='Operator'>= </span><a href="../init/globals.c.html#LN78"><span class='Ref_to_Global_Var'>MyDatabaseTableSpace</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_tablespace.h.html#LN63"><span class='Ref_to_Const'>GLOBALTABLESPACE_OID</span></a><span class='Parentheses'>) 
</span>                <a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>= </span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relfilenode<span class='Parentheses'>) 
</span>                <a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a> <span class='Operator'>= </span><a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relfilenode<span class='Delimiter'>; 
</span>            <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* Consult the relation mapper */ 
</span>                <a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a> <span class='Operator'>= </span><a href="../../../include/utils/relmapper.h.html#LN37"><span class='Ref_to_Proto'>RelationMapOidToFilenode</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN946"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, 
</span>                                                       <a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relisshared<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* no storage, return NULL */ 
</span>            <a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* some compilers generate warnings without these next two lines */ 
</span>            <a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN59"><span class='Ref_to_Member'>dbNode</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN58"><span class='Ref_to_Member'>spcNode</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch relform-&GT;relkind &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Operator'>.</span><a href="../../../include/storage/relfilenode.h.html#LN60"><span class='Ref_to_Member'>relNode</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN947"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Determine owning backend. */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN170"><span class='Ref_to_Const'>RELPERSISTENCE_UNLOGGED</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN169"><span class='Ref_to_Const'>RELPERSISTENCE_PERMANENT</span></a><span class='Operator'>: 
</span>            <a href="dbsize.c.html#LN950"><span class='Ref_To_Local'>backend</span></a> <span class='Operator'>= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_class.h.html#LN171"><span class='Ref_to_Const'>RELPERSISTENCE_TEMP</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/catalog/namespace.h.html#LN125"><span class='Ref_to_Proto'>isTempOrTempToastNamespace</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>))</span> 
                <a href="dbsize.c.html#LN950"><span class='Ref_To_Local'>backend</span></a> <span class='Operator'>= </span><a href="../../../include/storage/backendid.h.html#LN33"><span class='Ref_to_Macro'>BackendIdForTempRelations</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Do it the hard way. */ 
</span>                <a href="dbsize.c.html#LN950"><span class='Ref_To_Local'>backend</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN128"><span class='Ref_to_Proto'>GetTempNamespaceBackendId</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="dbsize.c.html#LN950"><span class='Ref_To_Local'>backend</span></a> <span class='Operator'>!= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid relpersistence: %c"</span><span class='Delimiter'>, </span><a href="dbsize.c.html#LN948"><span class='Ref_To_Local'>relform</span></a><span class='Operator'>-&GT;</span>relpersistence<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="dbsize.c.html#LN950"><span class='Ref_To_Local'>backend</span></a> <span class='Operator'>= </span><a href="../../../include/storage/backendid.h.html#LN22"><span class='Ref_to_Const'>InvalidBackendId</span></a><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* placate compiler */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch relform-&GT;relpersisten... &raquo; </span> 
 
    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN947"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="dbsize.c.html#LN951"><span class='Ref_To_Local'>path</span></a> <span class='Operator'>= </span><a href="../../../include/common/relpath.h.html#LN61"><span class='Ref_to_Macro'>relpathbackend</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN949"><span class='Ref_To_Local'>rnode</span></a><span class='Delimiter'>, </span><a href="dbsize.c.html#LN950"><span class='Ref_To_Local'>backend</span></a><span class='Delimiter'>, </span><a href="../../../include/common/relpath.h.html#LN26"><span class='Ref_to_EnumConst'>MAIN_FORKNUM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="dbsize.c.html#LN951"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_relation_filepath &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>