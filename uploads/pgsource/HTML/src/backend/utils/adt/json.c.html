<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\json.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\json.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:51 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * json.c 
 *      JSON data type support. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/json.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/transam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/spi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/stringinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_coerce.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/date.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datetime.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/json.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/jsonapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * The context of the parser is maintained by the recursive descent 
 * mechanism, but is passed explicitly to the error reporting routine 
 * for better diagnostics. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>enum</span>                    <span class='Comment_Single_Line'>/* contexts of JSON parser */ 
</span><span class='Delimiter'>{ 
</span><a name="LN41"></a>    <span class='Declare_Enum_Const'>JSON_PARSE_VALUE</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* expecting a value */ 
</span><a name="LN42"></a>    <span class='Declare_Enum_Const'>JSON_PARSE_STRING</span><span class='Delimiter'>,</span>          <span class='Comment_Single_Line'>/* expecting a string (for a field name) */ 
</span><a name="LN43"></a>    <span class='Declare_Enum_Const'>JSON_PARSE_ARRAY_START</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* saw '[', expecting value or ']' */ 
</span><a name="LN44"></a>    <span class='Declare_Enum_Const'>JSON_PARSE_ARRAY_NEXT</span><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* saw array element, expecting ',' or ']' */ 
</span><a name="LN45"></a>    <span class='Declare_Enum_Const'>JSON_PARSE_OBJECT_START</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* saw '{', expecting label or '}' */ 
</span><a name="LN46"></a>    <span class='Declare_Enum_Const'>JSON_PARSE_OBJECT_LABEL</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* saw object label, expecting ':' */ 
</span><a name="LN47"></a>    <span class='Declare_Enum_Const'>JSON_PARSE_OBJECT_NEXT</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* saw object value, expecting ',' or '}' */ 
</span><a name="LN48"></a>    <span class='Declare_Enum_Const'>JSON_PARSE_OBJECT_COMMA</span><span class='Delimiter'>,</span>    <span class='Comment_Single_Line'>/* saw object ',', expecting next label */ 
</span><a name="LN49"></a>    <span class='Declare_Enum_Const'>JSON_PARSE_END</span>              <span class='Comment_Single_Line'>/* saw the end of a document, expect nothing */ 
</span><a name="LN50"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>JsonParseContext</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>enum</span>                    <span class='Comment_Single_Line'>/* type categories for datum_to_json */ 
</span><span class='Delimiter'>{ 
</span><a name="LN54"></a>    <span class='Declare_Enum_Const'>JSONTYPE_NULL</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* null, so we didn't bother to identify */ 
</span><a name="LN55"></a>    <span class='Declare_Enum_Const'>JSONTYPE_BOOL</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* boolean (built-in types only) */ 
</span><a name="LN56"></a>    <span class='Declare_Enum_Const'>JSONTYPE_NUMERIC</span><span class='Delimiter'>,</span>           <span class='Comment_Single_Line'>/* numeric (ditto) */ 
</span><a name="LN57"></a>    <span class='Declare_Enum_Const'>JSONTYPE_DATE</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* we use special formatting for datetimes */ 
</span><a name="LN58"></a>    <span class='Declare_Enum_Const'>JSONTYPE_TIMESTAMP</span><span class='Delimiter'>, 
</span><a name="LN59"></a>    <span class='Declare_Enum_Const'>JSONTYPE_TIMESTAMPTZ</span><span class='Delimiter'>, 
</span><a name="LN60"></a>    <span class='Declare_Enum_Const'>JSONTYPE_JSON</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* JSON itself (and JSONB) */ 
</span><a name="LN61"></a>    <span class='Declare_Enum_Const'>JSONTYPE_ARRAY</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* array */ 
</span><a name="LN62"></a>    <span class='Declare_Enum_Const'>JSONTYPE_COMPOSITE</span><span class='Delimiter'>,</span>         <span class='Comment_Single_Line'>/* composite */ 
</span><a name="LN63"></a>    <span class='Declare_Enum_Const'>JSONTYPE_CAST</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* something with an explicit cast to JSON */ 
</span><a name="LN64"></a>    <span class='Declare_Enum_Const'>JSONTYPE_OTHER</span>              <span class='Comment_Single_Line'>/* all else */ 
</span><a name="LN65"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>JsonTypeCategory</span><span class='Delimiter'>; 
</span> 
<a name="LN67"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>JsonAggState</span> 
<span class='Delimiter'>{ 
</span><a name="LN69"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Member'>str</span><span class='Delimiter'>; 
</span><a name="LN70"></a>    <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Member'>key_category</span><span class='Delimiter'>; 
</span><a name="LN71"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>key_output_func</span><span class='Delimiter'>; 
</span><a name="LN72"></a>    <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Member'>val_category</span><span class='Delimiter'>; 
</span><a name="LN73"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>val_output_func</span><span class='Delimiter'>; 
</span><a name="LN74"></a>} <span class='Declare_Typedef'>JsonAggState</span><span class='Delimiter'>; 
</span> 
<a name="LN76"></a><span class='Keyword'>static inline void </span><span class='Declare_Prototype'>json_lex</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN77"></a><span class='Keyword'>static inline void </span><span class='Declare_Prototype'>json_lex_string</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN78"></a><span class='Keyword'>static inline void </span><span class='Declare_Prototype'>json_lex_number</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, 
</span><a name="LN79"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>num_err</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>total_len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN80"></a><span class='Keyword'>static inline void </span><span class='Declare_Prototype'>parse_scalar</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN81"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>parse_object_field</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN82"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>parse_object</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN83"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>parse_array_element</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>parse_array</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>report_parse_error</span><span class='Parentheses'>(</span><a href="json.c.html#LN39"><span class='Ref_to_Typedef'>JsonParseContext</span></a> <span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>report_invalid_token</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN87"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>report_json_context</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN88"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>extract_mb_char</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>composite_to_json</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>composite</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN90"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_line_feeds</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN91"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>array_dim_to_json</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndims</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, 
</span><a name="LN92"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vals</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>valcount</span><span class='Delimiter'>, 
</span><a name="LN93"></a>                  <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Parameter'>tcategory</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>outfuncoid</span><span class='Delimiter'>, 
</span><a name="LN94"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_line_feeds</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN95"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>array_to_json_internal</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>array</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN96"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_line_feeds</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN97"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>json_categorize_type</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typoid</span><span class='Delimiter'>, 
</span><a name="LN98"></a>                     <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tcategory</span><span class='Delimiter'>, 
</span><a name="LN99"></a>                     <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outfuncoid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN100"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>datum_to_json</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_null</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN101"></a>              <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Parameter'>tcategory</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>outfuncoid</span><span class='Delimiter'>, 
</span><a name="LN102"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>key_scalar</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN103"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_json</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_null</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN104"></a>         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>val_type</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>key_scalar</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN105"></a><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>catenate_stringinfo_string</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>addon</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* the null action object used for pure validation */ 
</span><a name="LN108"></a><span class='Keyword'>static </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Declare_Var'>nullSemAction</span> <span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL 
</span><span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* Recursive Descent parser support routines */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * lex_peek 
 * 
 * what is the current look_ahead token? 
*/ 
</span><span class='Keyword'>static inline </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> 
<a name="LN122"></a><span class='Declare_Function'>lex_peek</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="json.c.html#LN122"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * lex_accept 
 * 
 * accept the look_ahead token and move the lexer to the next token if the 
 * look_ahead token matches the token parameter. In that case, and if required, 
 * also hand back the de-escaped lexeme. 
 * 
 * returns true if the token matched, false otherwise. 
 */ 
</span><span class='Keyword'>static inline bool 
</span><a name="LN137"></a><span class='Declare_Function'>lex_accept</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>lexeme</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lexeme</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lexeme</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN150"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>- </span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN151"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tokstr</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN150"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                memcpy<span class='Parentheses'>(</span><a href="json.c.html#LN151"><span class='Ref_To_Local'>tokstr</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN150"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN151"><span class='Ref_To_Local'>tokstr</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN150"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lexeme</span></a> <span class='Operator'>= </span><a href="json.c.html#LN151"><span class='Ref_To_Local'>tokstr</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="json.c.html#LN76"><span class='Ref_to_Proto'>json_lex</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN137"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if lex-&GT;token_type==toke... &raquo; </span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end lex_accept &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * lex_accept 
 * 
 * move the lexer to the next token if the current look_ahead token matches 
 * the parameter token. Otherwise, report an error. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN171"></a><span class='Declare_Function'>lex_expect</span><span class='Parentheses'>(</span><a href="json.c.html#LN39"><span class='Ref_to_Typedef'>JsonParseContext</span></a> <span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>token</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN171"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN171"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="json.c.html#LN85"><span class='Ref_to_Proto'>report_parse_error</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN171"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN171"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* chars to consider as part of an alphanumeric token */ 
</span><a name="LN178"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>JSON_ALPHANUMERIC_CHAR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>)</span>  <span class='Operator'>\ 
</span>    <span class='Parentheses'>(((</span><a href="json.c.html#LN178"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='String'>'a'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="json.c.html#LN178"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='String'>'z'</span><span class='Parentheses'>)</span> <span class='Operator'>|| \ 
</span>     <span class='Parentheses'>((</span><a href="json.c.html#LN178"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='String'>'A'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="json.c.html#LN178"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='String'>'Z'</span><span class='Parentheses'>)</span> <span class='Operator'>|| \ 
</span>     <span class='Parentheses'>((</span><a href="json.c.html#LN178"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="json.c.html#LN178"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>)</span> <span class='Operator'>|| \ 
</span>     <span class='Parentheses'>(</span><a href="json.c.html#LN178"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'_'</span> <span class='Operator'>|| \ 
</span>     <a href="../../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN178"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Utility function to check if a string is a valid JSON number. 
 * 
 * str is of length len, and need not be null-terminated. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN191"></a><span class='Declare_Function'>IsValidJsonNumber</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN193"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>numeric_error</span><span class='Delimiter'>; 
</span><a name="LN194"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>total_len</span><span class='Delimiter'>; 
</span><a name="LN195"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Declare_Local'>dummy_lex</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN191"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * json_lex_number expects a leading  '-' to have been eaten already. 
     * 
     * having to cast away the constness of str is ugly, but there's not much 
     * easy alternative. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN191"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN195"><span class='Ref_To_Local'>dummy_lex</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="json.c.html#LN191"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN195"><span class='Ref_To_Local'>dummy_lex</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>= </span><a href="json.c.html#LN191"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN195"><span class='Ref_To_Local'>dummy_lex</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="json.c.html#LN191"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN195"><span class='Ref_To_Local'>dummy_lex</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>= </span><a href="json.c.html#LN191"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="json.c.html#LN78"><span class='Ref_to_Proto'>json_lex_number</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN195"><span class='Ref_To_Local'>dummy_lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN195"><span class='Ref_To_Local'>dummy_lex</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN193"><span class='Ref_To_Local'>numeric_error</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN194"><span class='Ref_To_Local'>total_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="json.c.html#LN193"><span class='Ref_To_Local'>numeric_error</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="json.c.html#LN194"><span class='Ref_To_Local'>total_len</span></a> <span class='Operator'>== </span><a href="json.c.html#LN195"><span class='Ref_To_Local'>dummy_lex</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end IsValidJsonNumber &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Input. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN226"></a><span class='Declare_Function'>json_in</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN228"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN229"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN228"><span class='Ref_To_Local'>json</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN230"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* validate it */ 
</span>    <a href="json.c.html#LN230"><span class='Ref_To_Local'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN229"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN230"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN108"><span class='Ref_to_Global_Var'>nullSemAction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Internal representation is the same as text, for now */ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN229"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Output. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN244"></a><span class='Declare_Function'>json_out</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* we needn't detoast because text_to_cstring will handle that */ 
</span><a name="LN247"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>txt</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN247"><span class='Ref_To_Local'>txt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Binary send. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN256"></a><span class='Declare_Function'>json_send</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN258"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN259"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN259"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN22"><span class='Ref_to_Proto'>pq_sendtext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN259"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN258"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN258"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN259"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Binary receive. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN270"></a><span class='Declare_Function'>json_recv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN272"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN273"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN274"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN275"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN273"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN44"><span class='Ref_to_Proto'>pq_getmsgtext</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN272"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN272"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="json.c.html#LN272"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN274"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Validate it. */ 
</span>    <a href="json.c.html#LN275"><span class='Ref_To_Local'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN123"><span class='Ref_to_Proto'>makeJsonLexContextCstringLen</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN273"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN274"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN275"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN108"><span class='Ref_to_Global_Var'>nullSemAction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN273"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN274"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * makeJsonLexContext 
 * 
 * lex constructor, with or without StringInfo object 
 * for de-escaped lexemes. 
 * 
 * Without is better as it makes the processing faster, so only make one 
 * if really required. 
 * 
 * If you already have the json as a text* value, use the first of these 
 * functions, otherwise use  makeJsonLexContextCstringLen(). 
 */ 
</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>* 
</span><a name="LN299"></a><span class='Declare_Function'>makeJsonLexContext</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>need_escapes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/jsonapi.h.html#LN123"><span class='Ref_to_Proto'>makeJsonLexContextCstringLen</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN299"><span class='Ref_to_Parameter'>json</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN299"><span class='Ref_to_Parameter'>json</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="json.c.html#LN299"><span class='Ref_to_Parameter'>need_escapes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>* 
</span><a name="LN307"></a><span class='Declare_Function'>makeJsonLexContextCstringLen</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>need_escapes</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN309"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN309"><span class='Ref_To_Local'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a> <span class='Operator'>= </span><a href="json.c.html#LN309"><span class='Ref_To_Local'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN309"><span class='Ref_To_Local'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN60"><span class='Ref_to_Member'>line_start</span></a> <span class='Operator'>= </span><a href="json.c.html#LN307"><span class='Ref_to_Parameter'>json</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN309"><span class='Ref_To_Local'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN59"><span class='Ref_to_Member'>line_number</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN309"><span class='Ref_To_Local'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>= </span><a href="json.c.html#LN307"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN307"><span class='Ref_to_Parameter'>need_escapes</span></a><span class='Parentheses'>) 
</span>        <a href="json.c.html#LN309"><span class='Ref_To_Local'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="json.c.html#LN309"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pg_parse_json 
 * 
 * Publicly visible entry point for the JSON parser. 
 * 
 * lex is a lexing context, set up for the json to be processed by calling 
 * makeJsonLexContext(). sem is a structure of function pointers to semantic 
 * action routines to be called at appropriate spots during parsing, and a 
 * pointer to a state object to be passed to those routines. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN330"></a><span class='Declare_Function'>pg_parse_json</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN332"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Local'>tok</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get the initial token */ 
</span>    <a href="json.c.html#LN76"><span class='Ref_to_Proto'>json_lex</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN330"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN332"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="json.c.html#LN121"><span class='Ref_to_Func'>lex_peek</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN330"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* parse by recursive descent */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN332"><span class='Ref_To_Local'>tok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN24"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_START</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN82"><span class='Ref_to_Proto'>parse_object</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN330"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN330"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN26"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_START</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN84"><span class='Ref_to_Proto'>parse_array</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN330"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN330"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="json.c.html#LN80"><span class='Ref_to_Proto'>parse_scalar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN330"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN330"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* json can be a bare scalar */ 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="json.c.html#LN170"><span class='Ref_to_Func'>lex_expect</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN49"><span class='Ref_to_EnumConst'>JSON_PARSE_END</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN330"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN33"><span class='Ref_to_EnumConst'>JSON_TOKEN_END</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pg_parse_json &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * json_count_array_elements 
 * 
 * Returns number of array elements in lex context at start of array token 
 * until end of array token at same nesting level. 
 * 
 * Designed to be called from array_start routines. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN365"></a><span class='Declare_Function'>json_count_array_elements</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN367"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Declare_Local'>copylex</span><span class='Delimiter'>; 
</span><a name="LN368"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It's safe to do this with a shallow copy because the lexical routines 
     * don't scribble on the input. They do scribble on the other pointers 
     * etc, so doing this with a copy makes that safe. 
     */ 
</span>    memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN367"><span class='Ref_To_Local'>copylex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN365"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN367"><span class='Ref_To_Local'>copylex</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* not interested in values here */ 
</span>    <a href="json.c.html#LN367"><span class='Ref_To_Local'>copylex</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN368"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN170"><span class='Ref_to_Func'>lex_expect</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN43"><span class='Ref_to_EnumConst'>JSON_PARSE_ARRAY_START</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN367"><span class='Ref_To_Local'>copylex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN26"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_START</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN121"><span class='Ref_to_Func'>lex_peek</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN367"><span class='Ref_To_Local'>copylex</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/jsonapi.h.html#LN27"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_END</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>do</span> 
        <span class='Delimiter'>{ 
</span>            <a href="json.c.html#LN368"><span class='Ref_To_Local'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="json.c.html#LN83"><span class='Ref_to_Proto'>parse_array_element</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN367"><span class='Ref_To_Local'>copylex</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN108"><span class='Ref_to_Global_Var'>nullSemAction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN367"><span class='Ref_To_Local'>copylex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN28"><span class='Ref_to_EnumConst'>JSON_TOKEN_COMMA</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="json.c.html#LN170"><span class='Ref_to_Func'>lex_expect</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN44"><span class='Ref_to_EnumConst'>JSON_PARSE_ARRAY_NEXT</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN367"><span class='Ref_To_Local'>copylex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN27"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_END</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="json.c.html#LN368"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_count_array_elements &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  Recursive Descent parse routines. There is one for each structural 
 *  element in a json document: 
 *    - scalar (string, number, true, false, null) 
 *    - array  ( [ ] ) 
 *    - array element 
 *    - object ( { } ) 
 *    - object field 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN405"></a><span class='Declare_Function'>parse_scalar</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN407"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN408"></a>    <a href="../../../include/utils/jsonapi.h.html#LN67"><span class='Ref_to_Typedef'>json_scalar_action</span></a> <span class='Declare_Local'>sfunc</span> <span class='Operator'>= </span><a href="json.c.html#LN405"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a><span class='Delimiter'>; 
</span><a name="LN409"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>valaddr</span><span class='Delimiter'>; 
</span><a name="LN410"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Local'>tok</span> <span class='Operator'>= </span><a href="json.c.html#LN121"><span class='Ref_to_Func'>lex_peek</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN405"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN409"><span class='Ref_To_Local'>valaddr</span></a> <span class='Operator'>= </span><a href="json.c.html#LN408"><span class='Ref_To_Local'>sfunc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: &</span><a href="json.c.html#LN407"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* a scalar must be a string, a number, true, false, or null */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN410"><span class='Ref_To_Local'>tok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN30"><span class='Ref_to_EnumConst'>JSON_TOKEN_TRUE</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN405"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN30"><span class='Ref_to_EnumConst'>JSON_TOKEN_TRUE</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN409"><span class='Ref_To_Local'>valaddr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN31"><span class='Ref_to_EnumConst'>JSON_TOKEN_FALSE</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN405"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN31"><span class='Ref_to_EnumConst'>JSON_TOKEN_FALSE</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN409"><span class='Ref_To_Local'>valaddr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN405"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN409"><span class='Ref_To_Local'>valaddr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN23"><span class='Ref_to_EnumConst'>JSON_TOKEN_NUMBER</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN405"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN23"><span class='Ref_to_EnumConst'>JSON_TOKEN_NUMBER</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN409"><span class='Ref_To_Local'>valaddr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN405"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN409"><span class='Ref_To_Local'>valaddr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="json.c.html#LN85"><span class='Ref_to_Proto'>report_parse_error</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN41"><span class='Ref_to_EnumConst'>JSON_PARSE_VALUE</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN405"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch tok &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN408"><span class='Ref_To_Local'>sfunc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN408"><span class='Ref_To_Local'>sfunc</span></a><span class='Parentheses'>) (</span><a href="json.c.html#LN405"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN407"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN410"><span class='Ref_To_Local'>tok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_scalar &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN441"></a><span class='Declare_Function'>parse_object_field</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * An object field is "fieldname" : value where value can be a scalar, 
     * object or array.  Note: in user-facing docs and error messages, we 
     * generally call a field name a "key". 
     */ 
</span> 
<a name="LN449"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fname</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span><a name="LN450"></a>    <a href="../../../include/utils/jsonapi.h.html#LN65"><span class='Ref_to_Typedef'>json_ofield_action</span></a> <span class='Declare_Local'>ostart</span> <span class='Operator'>= </span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN88"><span class='Ref_to_Member'>object_field_start</span></a><span class='Delimiter'>; 
</span><a name="LN451"></a>    <a href="../../../include/utils/jsonapi.h.html#LN65"><span class='Ref_to_Typedef'>json_ofield_action</span></a> <span class='Declare_Local'>oend</span> <span class='Operator'>= </span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN89"><span class='Ref_to_Member'>object_field_end</span></a><span class='Delimiter'>; 
</span><a name="LN452"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN453"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>fnameaddr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN454"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Local'>tok</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN450"><span class='Ref_To_Local'>ostart</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="json.c.html#LN451"><span class='Ref_To_Local'>oend</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="json.c.html#LN453"><span class='Ref_To_Local'>fnameaddr</span></a> <span class='Operator'>= &</span><a href="json.c.html#LN449"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN453"><span class='Ref_To_Local'>fnameaddr</span></a><span class='Parentheses'>))</span> 
        <a href="json.c.html#LN85"><span class='Ref_to_Proto'>report_parse_error</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN42"><span class='Ref_to_EnumConst'>JSON_PARSE_STRING</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN170"><span class='Ref_to_Func'>lex_expect</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN46"><span class='Ref_to_EnumConst'>JSON_PARSE_OBJECT_LABEL</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN29"><span class='Ref_to_EnumConst'>JSON_TOKEN_COLON</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN454"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="json.c.html#LN121"><span class='Ref_to_Func'>lex_peek</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN452"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><a href="json.c.html#LN454"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN450"><span class='Ref_To_Local'>ostart</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN450"><span class='Ref_To_Local'>ostart</span></a><span class='Parentheses'>) (</span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN449"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN452"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN454"><span class='Ref_To_Local'>tok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN24"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_START</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN82"><span class='Ref_to_Proto'>parse_object</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN26"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_START</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN84"><span class='Ref_to_Proto'>parse_array</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="json.c.html#LN80"><span class='Ref_to_Proto'>parse_scalar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN451"><span class='Ref_To_Local'>oend</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN451"><span class='Ref_To_Local'>oend</span></a><span class='Parentheses'>) (</span><a href="json.c.html#LN441"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN449"><span class='Ref_To_Local'>fname</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN452"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_object_field &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN487"></a><span class='Declare_Function'>parse_object</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * an object is a possibly empty sequence of object fields, separated by 
     * commas and surrounded by curly braces. 
     */ 
</span><a name="LN493"></a>    <a href="../../../include/utils/jsonapi.h.html#LN64"><span class='Ref_to_Typedef'>json_struct_action</span></a> <span class='Declare_Local'>ostart</span> <span class='Operator'>= </span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN84"><span class='Ref_to_Member'>object_start</span></a><span class='Delimiter'>; 
</span><a name="LN494"></a>    <a href="../../../include/utils/jsonapi.h.html#LN64"><span class='Ref_to_Typedef'>json_struct_action</span></a> <span class='Declare_Local'>oend</span> <span class='Operator'>= </span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN85"><span class='Ref_to_Member'>object_end</span></a><span class='Delimiter'>; 
</span><a name="LN495"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Local'>tok</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN493"><span class='Ref_To_Local'>ostart</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN493"><span class='Ref_To_Local'>ostart</span></a><span class='Parentheses'>) (</span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Data inside an object is at a higher nesting level than the object 
     * itself. Note that we increment this after we call the semantic routine 
     * for the object start and restore it before we call the routine for the 
     * object end. 
     */ 
</span>    <a href="json.c.html#LN487"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we know this will succeed, just clearing the token */ 
</span>    <a href="json.c.html#LN170"><span class='Ref_to_Func'>lex_expect</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN45"><span class='Ref_to_EnumConst'>JSON_PARSE_OBJECT_START</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN24"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_START</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN495"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="json.c.html#LN121"><span class='Ref_to_Func'>lex_peek</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN495"><span class='Ref_To_Local'>tok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN81"><span class='Ref_to_Proto'>parse_object_field</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN28"><span class='Ref_to_EnumConst'>JSON_TOKEN_COMMA</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
                <a href="json.c.html#LN81"><span class='Ref_to_Proto'>parse_object_field</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN25"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_END</span></a><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* case of an invalid initial token inside the object */ 
</span>            <a href="json.c.html#LN85"><span class='Ref_to_Proto'>report_parse_error</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN45"><span class='Ref_to_EnumConst'>JSON_PARSE_OBJECT_START</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="json.c.html#LN170"><span class='Ref_to_Func'>lex_expect</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN47"><span class='Ref_to_EnumConst'>JSON_PARSE_OBJECT_NEXT</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN25"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_END</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN487"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN494"><span class='Ref_To_Local'>oend</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN494"><span class='Ref_To_Local'>oend</span></a><span class='Parentheses'>) (</span><a href="json.c.html#LN487"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_object &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN537"></a><span class='Declare_Function'>parse_array_element</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN539"></a>    <a href="../../../include/utils/jsonapi.h.html#LN66"><span class='Ref_to_Typedef'>json_aelem_action</span></a> <span class='Declare_Local'>astart</span> <span class='Operator'>= </span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN90"><span class='Ref_to_Member'>array_element_start</span></a><span class='Delimiter'>; 
</span><a name="LN540"></a>    <a href="../../../include/utils/jsonapi.h.html#LN66"><span class='Ref_to_Typedef'>json_aelem_action</span></a> <span class='Declare_Local'>aend</span> <span class='Operator'>= </span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN91"><span class='Ref_to_Member'>array_element_end</span></a><span class='Delimiter'>; 
</span><a name="LN541"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Local'>tok</span> <span class='Operator'>= </span><a href="json.c.html#LN121"><span class='Ref_to_Func'>lex_peek</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN543"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN543"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><a href="json.c.html#LN541"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN539"><span class='Ref_To_Local'>astart</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN539"><span class='Ref_To_Local'>astart</span></a><span class='Parentheses'>) (</span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN543"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* an array element is any object, array or scalar */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN541"><span class='Ref_To_Local'>tok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN24"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_START</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN82"><span class='Ref_to_Proto'>parse_object</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN26"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_START</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN84"><span class='Ref_to_Proto'>parse_array</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="json.c.html#LN80"><span class='Ref_to_Proto'>parse_scalar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN540"><span class='Ref_To_Local'>aend</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN540"><span class='Ref_To_Local'>aend</span></a><span class='Parentheses'>) (</span><a href="json.c.html#LN537"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN543"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_array_element &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN568"></a><span class='Declare_Function'>parse_array</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>sem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * an array is a possibly empty sequence of array elements, separated by 
     * commas and surrounded by square brackets. 
     */ 
</span><a name="LN574"></a>    <a href="../../../include/utils/jsonapi.h.html#LN64"><span class='Ref_to_Typedef'>json_struct_action</span></a> <span class='Declare_Local'>astart</span> <span class='Operator'>= </span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN86"><span class='Ref_to_Member'>array_start</span></a><span class='Delimiter'>; 
</span><a name="LN575"></a>    <a href="../../../include/utils/jsonapi.h.html#LN64"><span class='Ref_to_Typedef'>json_struct_action</span></a> <span class='Declare_Local'>aend</span> <span class='Operator'>= </span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN87"><span class='Ref_to_Member'>array_end</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN574"><span class='Ref_To_Local'>astart</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN574"><span class='Ref_To_Local'>astart</span></a><span class='Parentheses'>) (</span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Data inside an array is at a higher nesting level than the array 
     * itself. Note that we increment this after we call the semantic routine 
     * for the array start and restore it before we call the routine for the 
     * array end. 
     */ 
</span>    <a href="json.c.html#LN568"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN170"><span class='Ref_to_Func'>lex_expect</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN43"><span class='Ref_to_EnumConst'>JSON_PARSE_ARRAY_START</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN26"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_START</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN121"><span class='Ref_to_Func'>lex_peek</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/jsonapi.h.html#LN27"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_END</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span> 
        <a href="json.c.html#LN83"><span class='Ref_to_Proto'>parse_array_element</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="json.c.html#LN136"><span class='Ref_to_Func'>lex_accept</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN28"><span class='Ref_to_EnumConst'>JSON_TOKEN_COMMA</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
            <a href="json.c.html#LN83"><span class='Ref_to_Proto'>parse_array_element</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="json.c.html#LN170"><span class='Ref_to_Func'>lex_expect</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN44"><span class='Ref_to_EnumConst'>JSON_PARSE_ARRAY_NEXT</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN27"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_END</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN568"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN575"><span class='Ref_To_Local'>aend</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN575"><span class='Ref_To_Local'>aend</span></a><span class='Parentheses'>) (</span><a href="json.c.html#LN568"><span class='Ref_to_Parameter'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Lex one token from the input stream. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN612"></a><span class='Declare_Function'>json_lex</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN614"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span><a name="LN615"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip leading whitespace. */ 
</span>    <a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN615"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>- </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="json.c.html#LN615"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& 
</span>           <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>' '</span> <span class='Operator'>|| *</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'\t'</span> <span class='Operator'>|| *</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span> <span class='Operator'>|| *</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'\r'</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>++</span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN59"><span class='Ref_to_Member'>line_number</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>++</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>++</span><a href="json.c.html#LN615"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Determine token type. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN615"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN33"><span class='Ref_to_EnumConst'>JSON_TOKEN_END</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Single-character token, some kind of punctuation mark. */ 
</span>            <span class='Control'>case</span> <span class='String'>'{'</span><span class='Operator'>: 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN24"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_START</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'}'</span><span class='Operator'>: 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN25"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_END</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'['</span><span class='Operator'>: 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN26"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_START</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>']'</span><span class='Operator'>: 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN27"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_END</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>','</span><span class='Operator'>: 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN28"><span class='Ref_to_EnumConst'>JSON_TOKEN_COMMA</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>':'</span><span class='Operator'>: 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN29"><span class='Ref_to_EnumConst'>JSON_TOKEN_COLON</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'"'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* string */ 
</span>                <a href="json.c.html#LN77"><span class='Ref_to_Proto'>json_lex_string</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'-'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Negative number. */ 
</span>                <a href="json.c.html#LN78"><span class='Ref_to_Proto'>json_lex_number</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN23"><span class='Ref_to_EnumConst'>JSON_TOKEN_NUMBER</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'0'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'1'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'2'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'3'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'4'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'5'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'6'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'7'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'8'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'9'</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* Positive number. */ 
</span>                <a href="json.c.html#LN78"><span class='Ref_to_Proto'>json_lex_number</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN23"><span class='Ref_to_EnumConst'>JSON_TOKEN_NUMBER</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN698"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * We're not dealing with a string, number, legal 
                     * punctuation mark, or end of string.  The only legal 
                     * tokens we might find here are true, false, and null, 
                     * but for error reporting purposes we scan until we see a 
                     * non-alphanumeric character.  That way, we can report 
                     * the whole word as an unexpected token, rather than just 
                     * some unintuitive prefix thereof. 
                     */ 
</span>                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="json.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; </span><a href="json.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>- </span><a href="json.c.html#LN615"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&& </span><a href="json.c.html#LN178"><span class='Ref_to_Macro'>JSON_ALPHANUMERIC_CHAR</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN698"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="json.c.html#LN698"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
                         <span class='Comment_Multi_Line'>/* skip */ </span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * We got some sort of unexpected punctuation or an 
                     * otherwise unexpected character, so just complain about 
                     * that one character. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>                        <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <a href="json.c.html#LN86"><span class='Ref_to_Proto'>report_invalid_token</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * We've got a real alphanumeric token here.  If it 
                     * happens to be true, false, or null, all is well.  If 
                     * not, error out. 
                     */ 
</span>                    <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>                    <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN698"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='Number'>4</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='String'>"true"</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN30"><span class='Ref_to_EnumConst'>JSON_TOKEN_TRUE</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='String'>"null"</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                            <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            <a href="json.c.html#LN86"><span class='Ref_to_Proto'>report_invalid_token</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN698"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='Number'>5</span> <span class='Operator'>&& </span>memcmp<span class='Parentheses'>(</span><a href="json.c.html#LN614"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='String'>"false"</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN31"><span class='Ref_to_EnumConst'>JSON_TOKEN_FALSE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="json.c.html#LN86"><span class='Ref_to_Proto'>report_invalid_token</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN612"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch *s &raquo; </span>                       <span class='Comment_Single_Line'>/* end of switch */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end json_lex &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The next token in the input stream is known to be a string; lex it. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN753"></a><span class='Declare_Function'>json_lex_string</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN755"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span><a name="LN756"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN757"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hi_surrogate</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../lib/stringinfo.c.html#LN60"><span class='Ref_to_Func'>resetStringInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN756"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a> <span class='Operator'>- </span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN756"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Premature end of the string. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN756"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;= </span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span>            <a href="json.c.html#LN86"><span class='Ref_to_Proto'>report_invalid_token</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>&LT; </span><span class='Number'>32</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Per RFC4627, these characters MUST be escaped. */ 
</span>            <span class='Comment_Multi_Line'>/* Since *s isn't printable, exclude it from the context string */ 
</span>            <a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Character with value 0x%02x must be escaped."</span><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* OK, we have an escape character. */ 
</span>            <a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="json.c.html#LN756"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN756"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;= </span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN86"><span class='Ref_to_Proto'>report_invalid_token</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>== </span><span class='String'>'u'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN801"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN802"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>ch</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="json.c.html#LN801"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="json.c.html#LN801"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><span class='Number'>4</span><span class='Delimiter'>; </span><a href="json.c.html#LN801"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <a href="json.c.html#LN756"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN756"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;= </span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>; 
</span>                        <a href="json.c.html#LN86"><span class='Ref_to_Proto'>report_invalid_token</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& *</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>                        <a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>* </span><span class='Number'>16</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>&GT;= </span><span class='String'>'a'</span> <span class='Operator'>&& *</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>&LT;= </span><span class='String'>'f'</span><span class='Parentheses'>) 
</span>                        <a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>* </span><span class='Number'>16</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>- </span><span class='String'>'a'</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>&GT;= </span><span class='String'>'A'</span> <span class='Operator'>&& *</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>&LT;= </span><span class='String'>'F'</span><span class='Parentheses'>) 
</span>                        <a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>* </span><span class='Number'>16</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>- </span><span class='String'>'A'</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, 
</span>                                        <span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"\"\\u\" must be followed by four hexadecimal digits."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=4;i++ &raquo; </span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN832"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>utf8str</span><span class='Delimiter'>[</span><span class='Number'>5</span><span class='Delimiter'>]; 
</span><a name="LN833"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>utf8len</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0xd800</span> <span class='Operator'>&& </span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0xdbff</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN757"><span class='Ref_To_Local'>hi_surrogate</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, 
</span>                                       <span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unicode high surrogate must not follow a high surrogate."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="json.c.html#LN757"><span class='Ref_To_Local'>hi_surrogate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>& </span><span class='Number'>0x3ff</span><span class='Parentheses'>) </span><span class='Operator'>&LT;&LT; </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                        <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0xdc00</span> <span class='Operator'>&& </span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0xdfff</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN757"><span class='Ref_To_Local'>hi_surrogate</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unicode low surrogate must follow a high surrogate."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                        <a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>= </span><span class='Number'>0x10000</span> <span class='Operator'>+ </span><a href="json.c.html#LN757"><span class='Ref_To_Local'>hi_surrogate</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>& </span><span class='Number'>0x3ff</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="json.c.html#LN757"><span class='Ref_To_Local'>hi_surrogate</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN757"><span class='Ref_To_Local'>hi_surrogate</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unicode low surrogate must follow a high surrogate."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * For UTF8, replace the escape sequence by the actual 
                     * utf8 character in lex-&GT;strval. Do this also for other 
                     * encodings if the escape designates an ASCII character, 
                     * otherwise raise an error. 
                     */ 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* We can't allow this, since our TEXT type doesn't */ 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNTRANSLATABLE_CHARACTER<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unsupported Unicode escape sequence"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"\\u0000 cannot be converted to text."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="../mb/wchar.c.html#LN473"><span class='Ref_to_Func'>unicode_to_utf8</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="json.c.html#LN832"><span class='Ref_To_Local'>utf8str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="json.c.html#LN833"><span class='Ref_To_Local'>utf8len</span></a> <span class='Operator'>= </span><a href="../mb/wchar.c.html#LN539"><span class='Ref_to_Func'>pg_utf_mblen</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="json.c.html#LN832"><span class='Ref_To_Local'>utf8str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN832"><span class='Ref_To_Local'>utf8str</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN833"><span class='Ref_To_Local'>utf8len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0x007f</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* 
                         * This is the only way to designate things like a 
                         * form feed character in JSON, so it's useful in all 
                         * encodings. 
                         */ 
</span>                        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><a href="json.c.html#LN802"><span class='Ref_To_Local'>ch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNTRANSLATABLE_CHARACTER<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unsupported Unicode escape sequence"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unicode escape values cannot be used for code point values above 007F when the server encoding is not UTF8."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if lex-&GT;strval!=NULL &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *s=='u' &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN757"><span class='Ref_To_Local'>hi_surrogate</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, 
</span>                                    <span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unicode low surrogate must follow a high surrogate."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <span class='String'>'"'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'\\'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'/'</span><span class='Operator'>: 
</span>                        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>: 
</span>                        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'\b'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'f'</span><span class='Operator'>: 
</span>                        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'\f'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>: 
</span>                        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'r'</span><span class='Operator'>: 
</span>                        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'\r'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>: 
</span>                        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'\t'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <span class='Comment_Multi_Line'>/* Not a valid string escape, so error out. */ 
</span>                        <a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, 
</span>                                        <span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                            <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Escape sequence \"\\%s\" is invalid."</span><span class='Delimiter'>, 
</span>                                      <a href="json.c.html#LN88"><span class='Ref_to_Proto'>extract_mb_char</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                 <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch *s &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if lex-&GT;strval!=NULL &raquo; </span> 
            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><span class='String'>"\"\\/bfnrt"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Simpler processing if we're not bothered about de-escaping 
                 * 
                 * It's very tempting to remove the strchr() call here and 
                 * replace it with a switch statement, but testing so far has 
                 * shown it's not a performance win. 
                 */ 
</span>                <a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Escape sequence \"\\%s\" is invalid."</span><span class='Delimiter'>, 
</span>                                   <a href="json.c.html#LN88"><span class='Ref_to_Proto'>extract_mb_char</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *s=='\\' &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN757"><span class='Ref_To_Local'>hi_surrogate</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unicode low surrogate must follow a high surrogate."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN757"><span class='Ref_To_Local'>hi_surrogate</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Unicode low surrogate must follow a high surrogate."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Hooray, we found the end of the string! */ 
</span>    <a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN753"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN755"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_lex_string &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The next token in the input stream is known to be a number; lex it. 
 * 
 * In JSON, a number consists of four parts: 
 * 
 * (1) An optional minus sign ('-'). 
 * 
 * (2) Either a single '0', or a string of one or more digits that does not 
 *     begin with a '0'. 
 * 
 * (3) An optional decimal part, consisting of a period ('.') followed by 
 *     one or more digits.  (Note: While this part can be omitted 
 *     completely, it's not OK to have only the decimal point without 
 *     any digits afterwards.) 
 * 
 * (4) An optional exponent part, consisting of 'e' or 'E', optionally 
 *     followed by '+' or '-', followed by one or more digits.  (Note: 
 *     As with the decimal part, if 'e' or 'E' is present, it must be 
 *     followed by at least one digit.) 
 * 
 * The 's' argument to this function points to the ostensible beginning 
 * of part 2 - i.e. the character after any optional minus sign, or the 
 * first character of the string if there is none. 
 * 
 * If num_err is not NULL, we return an error flag to *num_err rather than 
 * raising an error for a badly-formed number.  Also, if total_len is not NULL 
 * the distance from lex-&GT;input to the token end+1 is returned to *total_len. 
 */ 
</span><span class='Keyword'>static inline void 
</span><a name="LN1026"></a><span class='Declare_Function'>json_lex_number</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, 
</span><a name="LN1027"></a>                <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>num_err</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>total_len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1029"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>error</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1030"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>- </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Part (1): leading sign indicator. */ 
</span>    <span class='Comment_Multi_Line'>/* Caller already did this for us; so do nothing. */ 
</span> 
    <span class='Comment_Multi_Line'>/* Part (2): parse main digit string. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&GT;= </span><span class='String'>'1'</span> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>do</span> 
        <span class='Delimiter'>{ 
</span>            <a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="json.c.html#LN1029"><span class='Ref_To_Local'>error</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Part (3): parse optional decimal portion. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>== </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>|| *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&LT; </span><span class='String'>'0'</span> <span class='Operator'>|| *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&GT; </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>            <a href="json.c.html#LN1029"><span class='Ref_To_Local'>error</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>do</span> 
            <span class='Delimiter'>{ 
</span>                <a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Part (4): parse optional exponent. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'e'</span> <span class='Operator'>|| *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'E'</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'+'</span> <span class='Operator'>|| *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>== </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>|| *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&LT; </span><span class='String'>'0'</span> <span class='Operator'>|| *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&GT; </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>            <a href="json.c.html#LN1029"><span class='Ref_To_Local'>error</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>do</span> 
            <span class='Delimiter'>{ 
</span>                <a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& *</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if len&LT;lex-&GT;input_length... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Check for trailing garbage.  As in json_lex(), any alphanumeric stuff 
     * here should be considered part of the token for error-reporting 
     * purposes. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& </span><a href="json.c.html#LN178"><span class='Ref_to_Macro'>JSON_ALPHANUMERIC_CHAR</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <a href="json.c.html#LN1029"><span class='Ref_To_Local'>error</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1027"><span class='Ref_to_Parameter'>total_len</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="json.c.html#LN1027"><span class='Ref_to_Parameter'>total_len</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1030"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1027"><span class='Ref_to_Parameter'>num_err</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* let the caller handle any error */ 
</span>        <span class='Operator'>*</span><a href="json.c.html#LN1027"><span class='Ref_to_Parameter'>num_err</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1029"><span class='Ref_To_Local'>error</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* return token endpoint */ 
</span>        <a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* handle error if any */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1029"><span class='Ref_To_Local'>error</span></a><span class='Parentheses'>) 
</span>            <a href="json.c.html#LN86"><span class='Ref_to_Proto'>report_invalid_token</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1026"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end json_lex_number &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Report a parse error. 
 * 
 * lex-&GT;token_start and lex-&GT;token_terminator must identify the current token. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1124"></a><span class='Declare_Function'>report_parse_error</span><span class='Parentheses'>(</span><a href="json.c.html#LN39"><span class='Ref_to_Typedef'>JsonParseContext</span></a> <span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1126"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>token</span><span class='Delimiter'>; 
</span><a name="LN1127"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>toklen</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Handle case where the input ended prematurely. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN33"><span class='Ref_to_EnumConst'>JSON_TOKEN_END</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The input string ended unexpectedly."</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Separate out the current token. */ 
</span>    <a href="json.c.html#LN1127"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>- </span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1127"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1127"><span class='Ref_To_Local'>toklen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN1127"><span class='Ref_To_Local'>toklen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Complain, with the appropriate detail message. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>ctx</span></a> <span class='Operator'>== </span><a href="json.c.html#LN49"><span class='Ref_to_EnumConst'>JSON_PARSE_END</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Expected end of input, but found \"%s\"."</span><span class='Delimiter'>, 
</span>                           <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>ctx</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="json.c.html#LN41"><span class='Ref_to_EnumConst'>JSON_PARSE_VALUE</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Expected JSON value, but found \"%s\"."</span><span class='Delimiter'>, 
</span>                                   <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="json.c.html#LN42"><span class='Ref_to_EnumConst'>JSON_PARSE_STRING</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Expected string, but found \"%s\"."</span><span class='Delimiter'>, 
</span>                                   <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="json.c.html#LN43"><span class='Ref_to_EnumConst'>JSON_PARSE_ARRAY_START</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Expected array element or \"]\", but found \"%s\"."</span><span class='Delimiter'>, 
</span>                                   <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="json.c.html#LN44"><span class='Ref_to_EnumConst'>JSON_PARSE_ARRAY_NEXT</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Expected \",\" or \"]\", but found \"%s\"."</span><span class='Delimiter'>, 
</span>                                <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="json.c.html#LN45"><span class='Ref_to_EnumConst'>JSON_PARSE_OBJECT_START</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Expected string or \"}\", but found \"%s\"."</span><span class='Delimiter'>, 
</span>                               <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="json.c.html#LN46"><span class='Ref_to_EnumConst'>JSON_PARSE_OBJECT_LABEL</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Expected \":\", but found \"%s\"."</span><span class='Delimiter'>, 
</span>                                   <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="json.c.html#LN47"><span class='Ref_to_EnumConst'>JSON_PARSE_OBJECT_NEXT</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Expected \",\" or \"}\", but found \"%s\"."</span><span class='Delimiter'>, 
</span>                                <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="json.c.html#LN48"><span class='Ref_to_EnumConst'>JSON_PARSE_OBJECT_COMMA</span></a><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Expected string, but found \"%s\"."</span><span class='Delimiter'>, 
</span>                                   <a href="json.c.html#LN1126"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected json parse state: %d"</span><span class='Delimiter'>, </span><a href="json.c.html#LN1124"><span class='Ref_to_Parameter'>ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ctx &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end report_parse_error &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Report an invalid input token. 
 * 
 * lex-&GT;token_start and lex-&GT;token_terminator must identify the token. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1231"></a><span class='Declare_Function'>report_invalid_token</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1233"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>token</span><span class='Delimiter'>; 
</span><a name="LN1234"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>toklen</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Separate out the offending token. */ 
</span>    <a href="json.c.html#LN1234"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1231"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a> <span class='Operator'>- </span><a href="json.c.html#LN1231"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1233"><span class='Ref_To_Local'>token</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1234"><span class='Ref_To_Local'>toklen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="json.c.html#LN1233"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1231"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1234"><span class='Ref_To_Local'>toklen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1233"><span class='Ref_To_Local'>token</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN1234"><span class='Ref_To_Local'>toklen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"json"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Token \"%s\" is invalid."</span><span class='Delimiter'>, </span><a href="json.c.html#LN1233"><span class='Ref_To_Local'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="json.c.html#LN87"><span class='Ref_to_Proto'>report_json_context</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1231"><span class='Ref_to_Parameter'>lex</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Report a CONTEXT line for bogus JSON input. 
 * 
 * lex-&GT;token_terminator must be set to identify the spot where we detected 
 * the error.  Note that lex-&GT;token_start might be NULL, in case we recognized 
 * error at EOF. 
 * 
 * The return value isn't meaningful, but we make it non-void so that this 
 * can be invoked inside ereport(). 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1260"></a><span class='Declare_Function'>report_json_context</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lex</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1262"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>context_start</span><span class='Delimiter'>; 
</span><a name="LN1263"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>context_end</span><span class='Delimiter'>; 
</span><a name="LN1264"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>line_start</span><span class='Delimiter'>; 
</span><a name="LN1265"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>line_number</span><span class='Delimiter'>; 
</span><a name="LN1266"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ctxt</span><span class='Delimiter'>; 
</span><a name="LN1267"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ctxtlen</span><span class='Delimiter'>; 
</span><a name="LN1268"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>prefix</span><span class='Delimiter'>; 
</span><a name="LN1269"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>suffix</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Choose boundaries for the part of the input we will display */ 
</span>    <a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1260"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1263"><span class='Ref_To_Local'>context_end</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1260"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN55"><span class='Ref_to_Member'>token_terminator</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1264"><span class='Ref_To_Local'>line_start</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1265"><span class='Ref_To_Local'>line_number</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Always advance over newlines */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1263"><span class='Ref_To_Local'>context_end</span></a> <span class='Operator'>&& *</span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a> <span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="json.c.html#LN1264"><span class='Ref_To_Local'>line_start</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a><span class='Delimiter'>; 
</span>            <a href="json.c.html#LN1265"><span class='Ref_To_Local'>line_number</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Otherwise, done as soon as we are close enough to context_end */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1263"><span class='Ref_To_Local'>context_end</span></a> <span class='Operator'>- </span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a> <span class='Operator'>&LT; </span><span class='Number'>50</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Advance to next multibyte character */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN972"><span class='Ref_to_Macro'>IS_HIGHBIT_SET</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a><span class='Parentheses'>))</span> 
            <a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a> <span class='Operator'>+= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We add "..." to indicate that the excerpt doesn't start at the 
     * beginning of the line ... but if we're within 3 characters of the 
     * beginning of the line, we might as well just show the whole line. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a> <span class='Operator'>- </span><a href="json.c.html#LN1264"><span class='Ref_To_Local'>line_start</span></a> <span class='Operator'>&LT;= </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>        <a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1264"><span class='Ref_To_Local'>line_start</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get a null-terminated copy of the data to present */ 
</span>    <a href="json.c.html#LN1267"><span class='Ref_To_Local'>ctxtlen</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1263"><span class='Ref_To_Local'>context_end</span></a> <span class='Operator'>- </span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1266"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1267"><span class='Ref_To_Local'>ctxtlen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="json.c.html#LN1266"><span class='Ref_To_Local'>ctxt</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1267"><span class='Ref_To_Local'>ctxtlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1266"><span class='Ref_To_Local'>ctxt</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN1267"><span class='Ref_To_Local'>ctxtlen</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Show the context, prefixing "..." if not starting at start of line, and 
     * suffixing "..." if not ending at end of line. 
     */ 
</span>    <a href="json.c.html#LN1268"><span class='Ref_To_Local'>prefix</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN1262"><span class='Ref_To_Local'>context_start</span></a> <span class='Operator'>&GT; </span><a href="json.c.html#LN1264"><span class='Ref_To_Local'>line_start</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>"..."</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1269"><span class='Ref_To_Local'>suffix</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN1260"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonapi.h.html#LN33"><span class='Ref_to_EnumConst'>JSON_TOKEN_END</span></a> <span class='Operator'>&& </span><a href="json.c.html#LN1263"><span class='Ref_To_Local'>context_end</span></a> <span class='Operator'>- </span><a href="json.c.html#LN1260"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1260"><span class='Ref_to_Parameter'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN53"><span class='Ref_to_Member'>input_length</span></a> <span class='Operator'>&& *</span><a href="json.c.html#LN1263"><span class='Ref_To_Local'>context_end</span></a> <span class='Operator'>!= </span><span class='String'>'\n'</span> <span class='Operator'>&& *</span><a href="json.c.html#LN1263"><span class='Ref_To_Local'>context_end</span></a> <span class='Operator'>!= </span><span class='String'>'\r'</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>"..."</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> errcontext<span class='Parentheses'>(</span><span class='String'>"JSON data, line %d: %s%s%s"</span><span class='Delimiter'>, 
</span>                      <a href="json.c.html#LN1265"><span class='Ref_To_Local'>line_number</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1268"><span class='Ref_To_Local'>prefix</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1266"><span class='Ref_To_Local'>ctxt</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1269"><span class='Ref_To_Local'>suffix</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end report_json_context &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract a single, possibly multi-byte char from the input string. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1325"></a><span class='Declare_Function'>extract_mb_char</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1327"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1328"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1328"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1325"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1327"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1328"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="json.c.html#LN1327"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1325"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1328"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1327"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN1328"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="json.c.html#LN1327"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Determine how we want to print values of a given type in datum_to_json. 
 * 
 * Given the datatype OID, return its JsonTypeCategory, as well as the type's 
 * output function OID.  If the returned category is JSONTYPE_CAST, we 
 * return the OID of the type-&GT;JSON cast function instead. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1346"></a><span class='Declare_Function'>json_categorize_type</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typoid</span><span class='Delimiter'>, 
</span><a name="LN1347"></a>                     <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tcategory</span><span class='Delimiter'>, 
</span><a name="LN1348"></a>                     <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>outfuncoid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1350"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typisvarlena</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Look through any domain */ 
</span>    <a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN168"><span class='Ref_to_Proto'>getBaseType</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="json.c.html#LN1348"><span class='Ref_to_Parameter'>outfuncoid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need to get the output function for everything except date and 
     * timestamp types, array and composite types, booleans, and non-builtin 
     * types where there's a cast to json. 
     */ 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN55"><span class='Ref_to_EnumConst'>JSONTYPE_BOOL</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN38"><span class='Ref_to_Const'>FLOAT4OID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN39"><span class='Ref_to_Const'>FLOAT8OID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN58"><span class='Ref_to_Const'>NUMERICOID</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1348"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1350"><span class='Ref_To_Local'>typisvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN56"><span class='Ref_to_EnumConst'>JSONTYPE_NUMERIC</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN50"><span class='Ref_to_Const'>DATEOID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN57"><span class='Ref_to_EnumConst'>JSONTYPE_DATE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN52"><span class='Ref_to_Const'>TIMESTAMPOID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN58"><span class='Ref_to_EnumConst'>JSONTYPE_TIMESTAMP</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN53"><span class='Ref_to_Const'>TIMESTAMPTZOID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN59"><span class='Ref_to_EnumConst'>JSONTYPE_TIMESTAMPTZ</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN355"><span class='Ref_to_Const'>JSONOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN75"><span class='Ref_to_Const'>JSONBOID</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1348"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1350"><span class='Ref_To_Local'>typisvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN60"><span class='Ref_to_EnumConst'>JSONTYPE_JSON</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Check for arrays and composites */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN157"><span class='Ref_to_Proto'>get_element_type</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| </span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN687"><span class='Ref_to_Const'>ANYARRAYOID</span></a> 
                <span class='Operator'>|| </span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN681"><span class='Ref_to_Const'>RECORDARRAYOID</span></a><span class='Parentheses'>)</span> 
                <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN61"><span class='Ref_to_EnumConst'>JSONTYPE_ARRAY</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a><span class='Parentheses'>))</span>   <span class='Comment_Single_Line'>/* includes RECORDOID */ 
</span>                <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN62"><span class='Ref_to_EnumConst'>JSONTYPE_COMPOSITE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* It's probably the general case ... */ 
</span>                <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN64"><span class='Ref_to_EnumConst'>JSONTYPE_OTHER</span></a><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* but let's look for a cast to json, if it's not built-in */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/access/transam.h.html#LN93"><span class='Ref_to_Const'>FirstNormalObjectId</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1411"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>castfunc</span><span class='Delimiter'>; 
</span><a name="LN1412"></a>                    <a href="../../../include/parser/parse_coerce.h.html#LN23"><span class='Ref_to_Enum'>CoercionPathType</span></a> <span class='Declare_Local'>ctype</span><span class='Delimiter'>; 
</span> 
                    <a href="json.c.html#LN1412"><span class='Ref_To_Local'>ctype</span></a> <span class='Operator'>= </span><a href="../../../include/parser/parse_coerce.h.html#LN86"><span class='Ref_to_Proto'>find_coercion_pathway</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN355"><span class='Ref_to_Const'>JSONOID</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/nodes/primnodes.h.html#LN422"><span class='Ref_to_EnumConst'>COERCION_EXPLICIT</span></a><span class='Delimiter'>, 
</span>                                                  <span class='Operator'>&</span><a href="json.c.html#LN1411"><span class='Ref_To_Local'>castfunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1412"><span class='Ref_To_Local'>ctype</span></a> <span class='Operator'>== </span><a href="../../../include/parser/parse_coerce.h.html#LN26"><span class='Ref_to_EnumConst'>COERCION_PATH_FUNC</span></a> <span class='Operator'>&& </span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1411"><span class='Ref_To_Local'>castfunc</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Operator'>*</span><a href="json.c.html#LN1347"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN63"><span class='Ref_to_EnumConst'>JSONTYPE_CAST</span></a><span class='Delimiter'>; 
</span>                        <span class='Operator'>*</span><a href="json.c.html#LN1348"><span class='Ref_to_Parameter'>outfuncoid</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1411"><span class='Ref_To_Local'>castfunc</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* non builtin type with no cast */ 
</span>                        <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1348"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1350"><span class='Ref_To_Local'>typisvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* any other builtin type */ 
</span>                    <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1346"><span class='Ref_to_Parameter'>typoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1348"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1350"><span class='Ref_To_Local'>typisvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch typoid &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end json_categorize_type &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Turn a Datum into JSON text, appending the string to "result". 
 * 
 * tcategory and outfuncoid are from a previous call to json_categorize_type, 
 * except that if is_null is true then they can be invalid. 
 * 
 * If key_scalar is true, the value is being printed as a key, so insist 
 * it's of an acceptable type, and force it to be quoted. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1448"></a><span class='Declare_Function'>datum_to_json</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_null</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN1449"></a>              <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Parameter'>tcategory</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>outfuncoid</span><span class='Delimiter'>, 
</span><a name="LN1450"></a>              <span class='Keyword'>bool </span><span class='Declare_Parameter'>key_scalar</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1452"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>outputstr</span><span class='Delimiter'>; 
</span><a name="LN1453"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>jsontext</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* callers are expected to ensure that null keys are not passed in */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="json.c.html#LN1450"><span class='Ref_to_Parameter'>key_scalar</span></a> <span class='Operator'>&& </span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>is_null</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>is_null</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"null"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1450"><span class='Ref_to_Parameter'>key_scalar</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="json.c.html#LN1449"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>== </span><a href="json.c.html#LN61"><span class='Ref_to_EnumConst'>JSONTYPE_ARRAY</span></a> <span class='Operator'>|| 
</span>         <a href="json.c.html#LN1449"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>== </span><a href="json.c.html#LN62"><span class='Ref_to_EnumConst'>JSONTYPE_COMPOSITE</span></a> <span class='Operator'>|| 
</span>         <a href="json.c.html#LN1449"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>== </span><a href="json.c.html#LN60"><span class='Ref_to_EnumConst'>JSONTYPE_JSON</span></a> <span class='Operator'>|| 
</span>         <a href="json.c.html#LN1449"><span class='Ref_to_Parameter'>tcategory</span></a> <span class='Operator'>== </span><a href="json.c.html#LN63"><span class='Ref_to_EnumConst'>JSONTYPE_CAST</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"key value must be scalar, not array, composite, or json"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1449"><span class='Ref_to_Parameter'>tcategory</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="json.c.html#LN61"><span class='Ref_to_EnumConst'>JSONTYPE_ARRAY</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN95"><span class='Ref_to_Proto'>array_to_json_internal</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="json.c.html#LN62"><span class='Ref_to_EnumConst'>JSONTYPE_COMPOSITE</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN89"><span class='Ref_to_Proto'>composite_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="json.c.html#LN55"><span class='Ref_to_EnumConst'>JSONTYPE_BOOL</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>"true"</span> <span class='Operator'>: </span><span class='String'>"false"</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1450"><span class='Ref_to_Parameter'>key_scalar</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="json.c.html#LN56"><span class='Ref_to_EnumConst'>JSONTYPE_NUMERIC</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1449"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Don't call escape_json for a non-key if it's a valid JSON 
             * number. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="json.c.html#LN1450"><span class='Ref_to_Parameter'>key_scalar</span></a> <span class='Operator'>&& </span><a href="../../../include/utils/jsonapi.h.html#LN132"><span class='Ref_to_Proto'>IsValidJsonNumber</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)))</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="json.c.html#LN57"><span class='Ref_to_EnumConst'>JSONTYPE_DATE</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1505"></a>                <a href="../../../include/utils/date.h.html#LN21"><span class='Ref_to_Typedef'>DateADT</span></a>     <span class='Declare_Local'>date</span><span class='Delimiter'>; 
</span><a name="LN1506"></a>                <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN1507"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                <a href="json.c.html#LN1505"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>= </span><a href="../../../include/utils/date.h.html#LN51"><span class='Ref_to_Macro'>DatumGetDateADT</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Same as date_out(), but forcing DateStyle */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/date.h.html#LN41"><span class='Ref_to_Macro'>DATE_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1505"><span class='Ref_To_Local'>date</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/utils/date.h.html#LN71"><span class='Ref_to_Proto'>EncodeSpecialDate</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1505"><span class='Ref_To_Local'>date</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1507"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1505"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>+ </span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="json.c.html#LN1506"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="json.c.html#LN1506"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="json.c.html#LN1506"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/datetime.h.html#LN316"><span class='Ref_to_Proto'>EncodeDateOnly</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN1506"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="../../../include/miscadmin.h.html#LN215"><span class='Ref_to_Const'>USE_XSD_DATES</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1507"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"\"%s\""</span><span class='Delimiter'>, </span><a href="json.c.html#LN1507"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="json.c.html#LN58"><span class='Ref_to_EnumConst'>JSONTYPE_TIMESTAMP</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1524"></a>                <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span><span class='Delimiter'>; 
</span><a name="LN1525"></a>                <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN1526"></a>                <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN1527"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                <a href="json.c.html#LN1524"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN26"><span class='Ref_to_Macro'>DatumGetTimestamp</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Same as timestamp_out(), but forcing DateStyle */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1524"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN194"><span class='Ref_to_Func'>EncodeSpecialTimestamp</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1524"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1527"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1524"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1525"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1526"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN315"><span class='Ref_to_Proto'>EncodeDateTime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN1525"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1526"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../../include/miscadmin.h.html#LN215"><span class='Ref_to_Const'>USE_XSD_DATES</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1527"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"\"%s\""</span><span class='Delimiter'>, </span><a href="json.c.html#LN1527"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="json.c.html#LN59"><span class='Ref_to_EnumConst'>JSONTYPE_TIMESTAMPTZ</span></a><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1544"></a>                <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span><span class='Delimiter'>; 
</span><a name="LN1545"></a>                <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN1546"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN1547"></a>                <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN1548"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tzn</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1549"></a>                <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                <a href="json.c.html#LN1544"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN27"><span class='Ref_to_Macro'>DatumGetTimestampTz</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* Same as timestamptz_out(), but forcing DateStyle */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1544"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN194"><span class='Ref_to_Func'>EncodeSpecialTimestamp</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1544"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1549"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1544"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1546"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1545"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1547"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1548"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN315"><span class='Ref_to_Proto'>EncodeDateTime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN1545"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1547"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="json.c.html#LN1546"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1548"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><a href="../../../include/miscadmin.h.html#LN215"><span class='Ref_to_Const'>USE_XSD_DATES</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1549"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"\"%s\""</span><span class='Delimiter'>, </span><a href="json.c.html#LN1549"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="json.c.html#LN60"><span class='Ref_to_EnumConst'>JSONTYPE_JSON</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* JSON and JSONB output will already be escaped */ 
</span>            <a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1449"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="json.c.html#LN63"><span class='Ref_to_EnumConst'>JSONTYPE_CAST</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* outfuncoid refers to a cast function, not an output function */ 
</span>            <a href="json.c.html#LN1453"><span class='Ref_To_Local'>jsontext</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN621"><span class='Ref_to_Macro'>OidFunctionCall1</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1449"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1453"><span class='Ref_To_Local'>jsontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1453"><span class='Ref_To_Local'>jsontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1449"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1448"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1452"><span class='Ref_To_Local'>outputstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch tcategory &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end datum_to_json &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Process a single dimension of an array. 
 * If it's the innermost dimension, output the values, otherwise call 
 * ourselves recursively to process the next dimension. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1592"></a><span class='Declare_Function'>array_dim_to_json</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dim</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndims</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>dims</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vals</span><span class='Delimiter'>, 
</span><a name="LN1593"></a>                  <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>valcount</span><span class='Delimiter'>, </span><a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Parameter'>tcategory</span><span class='Delimiter'>, 
</span><a name="LN1594"></a>                  <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>outfuncoid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>use_line_feeds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1596"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1597"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sep</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>dim</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1597"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1594"><span class='Ref_to_Parameter'>use_line_feeds</span></a> <span class='Operator'>? </span><span class='String'>",\n "</span> <span class='Operator'>: </span><span class='String'>","</span><span class='Delimiter'>; 
</span> 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>'['</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1596"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="json.c.html#LN1596"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>dim</span></a><span class='Delimiter'>]; </span><a href="json.c.html#LN1596"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1596"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1597"><span class='Ref_To_Local'>sep</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>dim</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>== </span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>ndims</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="json.c.html#LN100"><span class='Ref_to_Proto'>datum_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>vals</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="json.c.html#LN1593"><span class='Ref_to_Parameter'>valcount</span></a><span class='Delimiter'>], </span><a href="json.c.html#LN1593"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="json.c.html#LN1593"><span class='Ref_to_Parameter'>valcount</span></a><span class='Delimiter'>], </span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1593"><span class='Ref_to_Parameter'>tcategory</span></a><span class='Delimiter'>, 
</span>                          <a href="json.c.html#LN1594"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN1593"><span class='Ref_to_Parameter'>valcount</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Do we want line feeds on inner dimensions of arrays? For now 
             * we'll say no. 
             */ 
</span>            <a href="json.c.html#LN91"><span class='Ref_to_Proto'>array_dim_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>dim</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>ndims</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>dims</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>vals</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1593"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, 
</span>                              <a href="json.c.html#LN1593"><span class='Ref_to_Parameter'>valcount</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1593"><span class='Ref_to_Parameter'>tcategory</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1594"><span class='Ref_to_Parameter'>outfuncoid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=dims[dim];i++ &raquo; </span> 
 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1592"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>']'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_dim_to_json &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Turn an array into JSON. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1634"></a><span class='Declare_Function'>array_to_json_internal</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>array</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>use_line_feeds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1636"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1634"><span class='Ref_to_Parameter'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1637"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1636"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1638"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dim</span><span class='Delimiter'>; 
</span><a name="LN1639"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>; 
</span><a name="LN1640"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>; 
</span><a name="LN1641"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN1642"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elements</span><span class='Delimiter'>; 
</span><a name="LN1643"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN1644"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN1645"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN1646"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN1647"></a>    <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Local'>tcategory</span><span class='Delimiter'>; 
</span><a name="LN1648"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>outfuncoid</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1639"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1636"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1638"><span class='Ref_To_Local'>dim</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1636"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1640"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1639"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1638"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1640"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1634"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"[]"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1637"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="json.c.html#LN1644"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1645"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1646"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN97"><span class='Ref_to_Proto'>json_categorize_type</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1637"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="json.c.html#LN1647"><span class='Ref_To_Local'>tcategory</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1648"><span class='Ref_To_Local'>outfuncoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1636"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1637"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1644"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1645"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, 
</span>                      <a href="json.c.html#LN1646"><span class='Ref_To_Local'>typalign</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1642"><span class='Ref_To_Local'>elements</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1643"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="json.c.html#LN1640"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN91"><span class='Ref_to_Proto'>array_dim_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1634"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="json.c.html#LN1639"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1638"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1642"><span class='Ref_To_Local'>elements</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1643"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1641"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1647"><span class='Ref_To_Local'>tcategory</span></a><span class='Delimiter'>, 
</span>                      <a href="json.c.html#LN1648"><span class='Ref_To_Local'>outfuncoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1634"><span class='Ref_to_Parameter'>use_line_feeds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1642"><span class='Ref_To_Local'>elements</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1643"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_to_json_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Turn a composite / record into JSON. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1681"></a><span class='Declare_Function'>composite_to_json</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>composite</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>use_line_feeds</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1683"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>td</span><span class='Delimiter'>; 
</span><a name="LN1684"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tupType</span><span class='Delimiter'>; 
</span><a name="LN1685"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tupTypmod</span><span class='Delimiter'>; 
</span><a name="LN1686"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1687"></a>    <a href="../../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tmptup</span><span class='Delimiter'>, 
</span><a name="LN1688"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1689"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1690"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>needsep</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1691"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sep</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1691"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1681"><span class='Ref_to_Parameter'>use_line_feeds</span></a> <span class='Operator'>? </span><span class='String'>",\n "</span> <span class='Operator'>: </span><span class='String'>","</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1683"><span class='Ref_To_Local'>td</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1681"><span class='Ref_to_Parameter'>composite</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract rowtype info and find a tupdesc */ 
</span>    <a href="json.c.html#LN1684"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN444"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypeId</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1683"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1685"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN454"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypMod</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1683"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1686"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1684"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1685"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Build a temporary HeapTuple control structure */ 
</span>    <a href="json.c.html#LN1687"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1683"><span class='Ref_To_Local'>td</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1687"><span class='Ref_To_Local'>tmptup</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="json.c.html#LN1683"><span class='Ref_To_Local'>td</span></a><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN1688"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= &</span><a href="json.c.html#LN1687"><span class='Ref_To_Local'>tmptup</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1681"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="json.c.html#LN1689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN1686"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="json.c.html#LN1689"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1711"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN1712"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN1713"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>attname</span><span class='Delimiter'>; 
</span><a name="LN1714"></a>        <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Local'>tcategory</span><span class='Delimiter'>; 
</span><a name="LN1715"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>outfuncoid</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1686"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN1689"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1690"><span class='Ref_To_Local'>needsep</span></a><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1681"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1691"><span class='Ref_To_Local'>sep</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1690"><span class='Ref_To_Local'>needsep</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN1713"><span class='Ref_To_Local'>attname</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1686"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN1689"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1681"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1713"><span class='Ref_To_Local'>attname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1681"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN1711"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN768"><span class='Ref_to_Macro'>heap_getattr</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1688"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="json.c.html#LN1686"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1712"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1712"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="json.c.html#LN1714"><span class='Ref_To_Local'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN54"><span class='Ref_to_EnumConst'>JSONTYPE_NULL</span></a><span class='Delimiter'>; 
</span>            <a href="json.c.html#LN1715"><span class='Ref_To_Local'>outfuncoid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="json.c.html#LN97"><span class='Ref_to_Proto'>json_categorize_type</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1686"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN1689"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="json.c.html#LN1714"><span class='Ref_To_Local'>tcategory</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1715"><span class='Ref_To_Local'>outfuncoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN100"><span class='Ref_to_Proto'>datum_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1711"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1712"><span class='Ref_To_Local'>isnull</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1681"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1714"><span class='Ref_To_Local'>tcategory</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1715"><span class='Ref_To_Local'>outfuncoid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;tupdesc-&GT;natts;... &raquo; </span> 
 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1681"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>'}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1686"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end composite_to_json &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Append JSON text for "val" to "result". 
 * 
 * This is just a thin wrapper around datum_to_json.  If the same type will be 
 * printed many times, avoid using this; better to do the json_categorize_type 
 * lookups only once. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1754"></a><span class='Declare_Function'>add_json</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>is_null</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN1755"></a>         <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>val_type</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>key_scalar</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1757"></a>    <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Local'>tcategory</span><span class='Delimiter'>; 
</span><a name="LN1758"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>outfuncoid</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1755"><span class='Ref_to_Parameter'>val_type</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine input data type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1754"><span class='Ref_to_Parameter'>is_null</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN1757"><span class='Ref_To_Local'>tcategory</span></a> <span class='Operator'>= </span><a href="json.c.html#LN54"><span class='Ref_to_EnumConst'>JSONTYPE_NULL</span></a><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1758"><span class='Ref_To_Local'>outfuncoid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="json.c.html#LN97"><span class='Ref_to_Proto'>json_categorize_type</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1755"><span class='Ref_to_Parameter'>val_type</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="json.c.html#LN1757"><span class='Ref_To_Local'>tcategory</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1758"><span class='Ref_To_Local'>outfuncoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN100"><span class='Ref_to_Proto'>datum_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1754"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1754"><span class='Ref_to_Parameter'>is_null</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1754"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1757"><span class='Ref_To_Local'>tcategory</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1758"><span class='Ref_To_Local'>outfuncoid</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1755"><span class='Ref_to_Parameter'>key_scalar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end add_json &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function array_to_json(row) 
 */ 
</span><span class='Keyword'>extern </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1781"></a><span class='Declare_Function'>array_to_json</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1783"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>array</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1784"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1784"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN95"><span class='Ref_to_Proto'>array_to_json_internal</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1783"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1784"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1784"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1784"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function array_to_json(row, prettybool) 
 */ 
</span><span class='Keyword'>extern </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1797"></a><span class='Declare_Function'>array_to_json_pretty</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1799"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>array</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1800"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>use_line_feeds</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1801"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1801"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN95"><span class='Ref_to_Proto'>array_to_json_internal</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1799"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1801"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1800"><span class='Ref_To_Local'>use_line_feeds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1801"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1801"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function row_to_json(row) 
 */ 
</span><span class='Keyword'>extern </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1814"></a><span class='Declare_Function'>row_to_json</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1816"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>array</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1817"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1817"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN89"><span class='Ref_to_Proto'>composite_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1816"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1817"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1817"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1817"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function row_to_json(row, prettybool) 
 */ 
</span><span class='Keyword'>extern </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1830"></a><span class='Declare_Function'>row_to_json_pretty</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1832"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>array</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1833"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>use_line_feeds</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1834"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1834"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN89"><span class='Ref_to_Proto'>composite_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1832"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1834"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1833"><span class='Ref_To_Local'>use_line_feeds</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1834"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1834"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function to_json(anyvalue) 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1847"></a><span class='Declare_Function'>to_json</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1849"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1850"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>val_type</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1851"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1852"></a>    <a href="json.c.html#LN52"><span class='Ref_to_Typedef'>JsonTypeCategory</span></a> <span class='Declare_Local'>tcategory</span><span class='Delimiter'>; 
</span><a name="LN1853"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>outfuncoid</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1850"><span class='Ref_To_Local'>val_type</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine input data type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN97"><span class='Ref_to_Proto'>json_categorize_type</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1850"><span class='Ref_To_Local'>val_type</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="json.c.html#LN1852"><span class='Ref_To_Local'>tcategory</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1853"><span class='Ref_To_Local'>outfuncoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1851"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN100"><span class='Ref_to_Proto'>datum_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1849"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="json.c.html#LN1851"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1852"><span class='Ref_To_Local'>tcategory</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1853"><span class='Ref_To_Local'>outfuncoid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1851"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1851"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end to_json &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * json_agg transition function 
 * 
 * aggregate input column as a json array value. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1876"></a><span class='Declare_Function'>json_agg_transfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1878"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>aggcontext</span><span class='Delimiter'>, 
</span><a name="LN1879"></a>                <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1880"></a>    <a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN1881"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1878"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"json_agg_transfn called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1891"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arg_type</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1891"><span class='Ref_To_Local'>arg_type</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine input data type"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make this state object in a context where it will persist for the 
         * duration of the aggregate call.  MemoryContextSwitchTo is only 
         * needed the first time, as the StringInfo routines make sure they 
         * use the right context to enlarge the object if necessary. 
         */ 
</span>        <a href="json.c.html#LN1879"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1878"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1879"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><span class='String'>'['</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN97"><span class='Ref_to_Proto'>json_categorize_type</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1891"><span class='Ref_To_Local'>arg_type</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN72"><span class='Ref_to_Member'>val_category</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN73"><span class='Ref_to_Member'>val_output_func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if PG_ARGISNULL(0) &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* fast path for NULLs */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN100"><span class='Ref_to_Proto'>datum_to_json</span></a><span class='Parentheses'>((</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN54"><span class='Ref_to_EnumConst'>JSONTYPE_NULL</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="json.c.html#LN1881"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* add some whitespace if structured type and not first item */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN72"><span class='Ref_to_Member'>val_category</span></a> <span class='Operator'>== </span><a href="json.c.html#LN61"><span class='Ref_to_EnumConst'>JSONTYPE_ARRAY</span></a> <span class='Operator'>|| 
</span>         <a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN72"><span class='Ref_to_Member'>val_category</span></a> <span class='Operator'>== </span><a href="json.c.html#LN62"><span class='Ref_to_EnumConst'>JSONTYPE_COMPOSITE</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><span class='String'>"\n "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="json.c.html#LN100"><span class='Ref_to_Proto'>datum_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1881"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN72"><span class='Ref_to_Member'>val_category</span></a><span class='Delimiter'>, 
</span>                  <a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN73"><span class='Ref_to_Member'>val_output_func</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The transition type for array_agg() is declared to be "internal", which 
     * is a pass-by-value type the same size as a pointer.  So we can safely 
     * pass the JsonAggState pointer through nodeAgg.c's machinations. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1880"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_agg_transfn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * json_agg final function 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1952"></a><span class='Declare_Function'>json_agg_finalfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1954"></a>    <a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1954"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? 
</span>        <span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>        <span class='Parentheses'>(</span><a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* NULL result for no rows in, as is standard with aggregates */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1954"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Else return state with appropriate array terminator added */ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN105"><span class='Ref_to_Proto'>catenate_stringinfo_string</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1954"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><span class='String'>"]"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * json_object_agg transition function. 
 * 
 * aggregate two input columns as a single json object value. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1977"></a><span class='Declare_Function'>json_object_agg_transfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1979"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>aggcontext</span><span class='Delimiter'>, 
</span><a name="LN1980"></a>                <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN1981"></a>    <a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN1982"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1979"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"json_object_agg_transfn called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1992"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>arg_type</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Make the StringInfo in a context where it will persist for the 
         * duration of the aggregate call. Switching context is only needed 
         * for this initial step, as the StringInfo routines make sure they 
         * use the right context to enlarge the object if necessary. 
         */ 
</span>        <a href="json.c.html#LN1980"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1979"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1980"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN1992"><span class='Ref_To_Local'>arg_type</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1992"><span class='Ref_To_Local'>arg_type</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine data type for argument %d"</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN97"><span class='Ref_to_Proto'>json_categorize_type</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1992"><span class='Ref_To_Local'>arg_type</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN70"><span class='Ref_to_Member'>key_category</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN71"><span class='Ref_to_Member'>key_output_func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN1992"><span class='Ref_To_Local'>arg_type</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN1992"><span class='Ref_To_Local'>arg_type</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine data type for argument %d"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN97"><span class='Ref_to_Proto'>json_categorize_type</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1992"><span class='Ref_To_Local'>arg_type</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN72"><span class='Ref_to_Member'>val_category</span></a><span class='Delimiter'>, 
</span>                             <span class='Operator'>&</span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN73"><span class='Ref_to_Member'>val_output_func</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><span class='String'>"{ "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if PG_ARGISNULL(0) &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: since json_object_agg() is declared as taking type "any", the 
     * parser will not do any type conversion on unknown-type literals (that 
     * is, undecorated strings or NULLs).  Such values will arrive here as 
     * type UNKNOWN, which fortunately does not matter to us, since 
     * unknownout() works fine. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"field name must not be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN1982"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN100"><span class='Ref_to_Proto'>datum_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1982"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN70"><span class='Ref_to_Member'>key_category</span></a><span class='Delimiter'>, 
</span>                  <a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN71"><span class='Ref_to_Member'>key_output_func</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><span class='String'>" : "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span> 
        <a href="json.c.html#LN1982"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="json.c.html#LN1982"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN100"><span class='Ref_to_Proto'>datum_to_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1982"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN72"><span class='Ref_to_Member'>val_category</span></a><span class='Delimiter'>, 
</span>                  <a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN73"><span class='Ref_to_Member'>val_output_func</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN1981"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_object_agg_transfn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * json_object_agg final function. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2068"></a><span class='Declare_Function'>json_object_agg_finalfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2070"></a>    <a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN2070"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="json.c.html#LN67"><span class='Ref_to_Struct'>JsonAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* NULL result for no rows in, as is standard with aggregates */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2070"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Else return state with appropriate object terminator added */ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN105"><span class='Ref_to_Proto'>catenate_stringinfo_string</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2070"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="json.c.html#LN69"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, </span><span class='String'>" }"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Helper function for aggregates: return given StringInfo's contents plus 
 * specified trailing string, as a text datum.  We need this because aggregate 
 * final functions are not allowed to modify the aggregate state. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN2091"></a><span class='Declare_Function'>catenate_stringinfo_string</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>addon</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* custom version of cstring_to_text_with_len */ 
</span><a name="LN2094"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>buflen</span> <span class='Operator'>= </span><a href="json.c.html#LN2091"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span><a name="LN2095"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>addlen</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="json.c.html#LN2091"><span class='Ref_to_Parameter'>addon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2096"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2094"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>+ </span><a href="json.c.html#LN2095"><span class='Ref_To_Local'>addlen</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2096"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2094"><span class='Ref_To_Local'>buflen</span></a> <span class='Operator'>+ </span><a href="json.c.html#LN2095"><span class='Ref_To_Local'>addlen</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2096"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="json.c.html#LN2091"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2094"><span class='Ref_To_Local'>buflen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2096"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="json.c.html#LN2094"><span class='Ref_To_Local'>buflen</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2091"><span class='Ref_to_Parameter'>addon</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2095"><span class='Ref_To_Local'>addlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="json.c.html#LN2096"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_build_object(variadic "any") 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2109"></a><span class='Declare_Function'>json_build_object</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2111"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nargs</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN2112"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2113"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN2114"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sep</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN2115"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2116"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>val_type</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2111"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>% </span><span class='Number'>2</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument list must have even number of elements"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"The arguments of json_build_object() must consist of alternating keys and values."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN2115"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2115"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN2111"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>; </span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Note: since json_build_object() is declared as taking type "any", 
         * the parser will not do any type conversion on unknown-type literals 
         * (that is, undecorated strings or NULLs).  Such values will arrive 
         * here as type UNKNOWN, which fortunately does not matter to us, 
         * since unknownout() works fine. 
         */ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2115"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2114"><span class='Ref_To_Local'>sep</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN2114"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>= </span><span class='String'>", "</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* process key */ 
</span>        <a href="json.c.html#LN2116"><span class='Ref_To_Local'>val_type</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2116"><span class='Ref_To_Local'>val_type</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine data type for argument %d"</span><span class='Delimiter'>, 
</span>                            <a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument %d cannot be null"</span><span class='Delimiter'>, </span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Object keys should be text."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN2113"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN103"><span class='Ref_to_Proto'>add_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2113"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="json.c.html#LN2115"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2116"><span class='Ref_To_Local'>val_type</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2115"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>" : "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* process value */ 
</span>        <a href="json.c.html#LN2116"><span class='Ref_To_Local'>val_type</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2116"><span class='Ref_To_Local'>val_type</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine data type for argument %d"</span><span class='Delimiter'>, 
</span>                            <a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="json.c.html#LN2113"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="json.c.html#LN2113"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN103"><span class='Ref_to_Proto'>add_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2113"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="json.c.html#LN2115"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2116"><span class='Ref_To_Local'>val_type</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nargs;i+=2 &raquo; </span> 
 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2115"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2115"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2115"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_build_object &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * degenerate case of json_build_object where it gets 0 arguments. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2187"></a><span class='Declare_Function'>json_build_object_noargs</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><span class='String'>"{}"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_build_array(variadic "any") 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2196"></a><span class='Declare_Function'>json_build_array</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2198"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nargs</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN2199"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2200"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN2201"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>sep</span> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span><a name="LN2202"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2203"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>val_type</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN2202"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2202"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'['</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2199"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="json.c.html#LN2199"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN2198"><span class='Ref_To_Local'>nargs</span></a><span class='Delimiter'>; </span><a href="json.c.html#LN2199"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Note: since json_build_array() is declared as taking type "any", 
         * the parser will not do any type conversion on unknown-type literals 
         * (that is, undecorated strings or NULLs).  Such values will arrive 
         * here as type UNKNOWN, which fortunately does not matter to us, 
         * since unknownout() works fine. 
         */ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2202"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2201"><span class='Ref_To_Local'>sep</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="json.c.html#LN2201"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>= </span><span class='String'>", "</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN2203"><span class='Ref_To_Local'>val_type</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><a href="json.c.html#LN2199"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2203"><span class='Ref_To_Local'>val_type</span></a> <span class='Operator'>== </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine data type for argument %d"</span><span class='Delimiter'>, 
</span>                            <a href="json.c.html#LN2199"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2199"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
            <a href="json.c.html#LN2200"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="json.c.html#LN2200"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2199"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN103"><span class='Ref_to_Proto'>add_json</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2200"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2199"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="json.c.html#LN2202"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2203"><span class='Ref_To_Local'>val_type</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nargs;i++ &raquo; </span> 
 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2202"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>']'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2202"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2202"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_build_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * degenerate case of json_build_array where it gets 0 arguments. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2246"></a><span class='Declare_Function'>json_build_array_noargs</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><span class='String'>"[]"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_object(text[]) 
 * 
 * take a one or two dimensional array of text as key/value pairs 
 * for a json object. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2258"></a><span class='Declare_Function'>json_object</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2260"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>in_array</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2261"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndims</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2260"><span class='Ref_To_Local'>in_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2262"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2263"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>in_datums</span><span class='Delimiter'>; 
</span><a name="LN2264"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>in_nulls</span><span class='Delimiter'>; 
</span><a name="LN2265"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>in_count</span><span class='Delimiter'>, 
</span><a name="LN2266"></a>                <span class='Declare_Local'>count</span><span class='Delimiter'>, 
</span><a name="LN2267"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2268"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rval</span><span class='Delimiter'>; 
</span><a name="LN2269"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2261"><span class='Ref_To_Local'>ndims</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>            <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"{}"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2260"><span class='Ref_To_Local'>in_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>% </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array must have even number of elements"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2260"><span class='Ref_To_Local'>in_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"array must have two columns"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch ndims &raquo; </span> 
 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2260"><span class='Ref_To_Local'>in_array</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="json.c.html#LN2263"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN2264"><span class='Ref_To_Local'>in_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN2265"><span class='Ref_To_Local'>in_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN2266"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><a href="json.c.html#LN2265"><span class='Ref_To_Local'>in_count</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2267"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="json.c.html#LN2267"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN2266"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="json.c.html#LN2267"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2264"><span class='Ref_To_Local'>in_nulls</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN2267"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null value not allowed for object key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN2269"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2263"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN2267"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2267"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2269"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>" : "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2269"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2264"><span class='Ref_To_Local'>in_nulls</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN2267"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"null"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="json.c.html#LN2269"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2263"><span class='Ref_To_Local'>in_datums</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN2267"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2269"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2269"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;count;++i &raquo; </span> 
 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2263"><span class='Ref_To_Local'>in_datums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2264"><span class='Ref_To_Local'>in_nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN2268"><span class='Ref_To_Local'>rval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2262"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2268"><span class='Ref_To_Local'>rval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end json_object &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_object(text[], text[]) 
 * 
 * take separate key and value arrays of text to construct a json object 
 * pairwise. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2349"></a><span class='Declare_Function'>json_object_two_arg</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2351"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>key_array</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2352"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>val_array</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2353"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nkdims</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2351"><span class='Ref_To_Local'>key_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2354"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nvdims</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2352"><span class='Ref_To_Local'>val_array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2355"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2356"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>key_datums</span><span class='Delimiter'>, 
</span><a name="LN2357"></a>               <span class='Operator'>*</span><span class='Declare_Local'>val_datums</span><span class='Delimiter'>; 
</span><a name="LN2358"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>key_nulls</span><span class='Delimiter'>, 
</span><a name="LN2359"></a>               <span class='Operator'>*</span><span class='Declare_Local'>val_nulls</span><span class='Delimiter'>; 
</span><a name="LN2360"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>key_count</span><span class='Delimiter'>, 
</span><a name="LN2361"></a>                <span class='Declare_Local'>val_count</span><span class='Delimiter'>, 
</span><a name="LN2362"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2363"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>rval</span><span class='Delimiter'>; 
</span><a name="LN2364"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2353"><span class='Ref_To_Local'>nkdims</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="json.c.html#LN2353"><span class='Ref_To_Local'>nkdims</span></a> <span class='Operator'>!= </span><a href="json.c.html#LN2354"><span class='Ref_To_Local'>nvdims</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2353"><span class='Ref_To_Local'>nkdims</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><span class='String'>"{}"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2351"><span class='Ref_To_Local'>key_array</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="json.c.html#LN2356"><span class='Ref_To_Local'>key_datums</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN2358"><span class='Ref_To_Local'>key_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN2360"><span class='Ref_To_Local'>key_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2352"><span class='Ref_To_Local'>val_array</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="json.c.html#LN2357"><span class='Ref_To_Local'>val_datums</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN2359"><span class='Ref_To_Local'>val_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="json.c.html#LN2361"><span class='Ref_To_Local'>val_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2360"><span class='Ref_To_Local'>key_count</span></a> <span class='Operator'>!= </span><a href="json.c.html#LN2361"><span class='Ref_To_Local'>val_count</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"mismatched array dimensions"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2362"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="json.c.html#LN2362"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="json.c.html#LN2360"><span class='Ref_To_Local'>key_count</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="json.c.html#LN2362"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2358"><span class='Ref_To_Local'>key_nulls</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN2362"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null value not allowed for object key"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="json.c.html#LN2364"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2356"><span class='Ref_To_Local'>key_datums</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN2362"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2362"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>", "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2364"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>" : "</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2364"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2359"><span class='Ref_To_Local'>val_nulls</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN2362"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"null"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="json.c.html#LN2364"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2357"><span class='Ref_To_Local'>val_datums</span></a><span class='Delimiter'>[</span><a href="json.c.html#LN2362"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2364"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2364"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;key_count;++i &raquo; </span> 
 
    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2356"><span class='Ref_To_Local'>key_datums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2358"><span class='Ref_To_Local'>key_nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2357"><span class='Ref_To_Local'>val_datums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2359"><span class='Ref_To_Local'>val_nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN2363"><span class='Ref_To_Local'>rval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2355"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2363"><span class='Ref_To_Local'>rval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_object_two_arg &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Produce a JSON string literal, properly escaping characters in the text. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN2432"></a><span class='Declare_Function'>escape_json</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2434"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2434"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="json.c.html#LN2434"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="json.c.html#LN2434"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="json.c.html#LN2434"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'\b'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\b"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'\f'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\f"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'\n'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'\r'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\r"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'\t'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\t"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'"'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\\""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'\\'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\\\"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="json.c.html#LN2434"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT; </span><span class='String'>' '</span><span class='Parentheses'>)</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"\\u%04x"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="json.c.html#LN2434"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="json.c.html#LN2434"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch *p &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for p=str;*p;p++ &raquo; </span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2432"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end escape_json &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_typeof(json) -&GT; text 
 * 
 * Returns the type of the outermost JSON value as TEXT.  Possible types are 
 * "object", "array", "string", "number", "boolean", and "null". 
 * 
 * Performs a single call to json_lex() to get the first token of the supplied 
 * value.  This initial token uniquely determines the value's type.  As our 
 * input must already have been validated by json_in() or json_recv(), the 
 * initial token should never be JSON_TOKEN_OBJECT_END, JSON_TOKEN_ARRAY_END, 
 * JSON_TOKEN_COLON, JSON_TOKEN_COMMA, or JSON_TOKEN_END. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2486"></a><span class='Declare_Function'>json_typeof</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2488"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span><span class='Delimiter'>; 
</span> 
<a name="LN2490"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span><span class='Delimiter'>; 
</span><a name="LN2491"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Local'>tok</span><span class='Delimiter'>; 
</span><a name="LN2492"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span> 
    <a href="json.c.html#LN2488"><span class='Ref_To_Local'>json</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN2490"><span class='Ref_To_Local'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2488"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Lex exactly one token from the input and check its type. */ 
</span>    <a href="json.c.html#LN76"><span class='Ref_to_Proto'>json_lex</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2490"><span class='Ref_To_Local'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="json.c.html#LN2491"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="json.c.html#LN121"><span class='Ref_to_Func'>lex_peek</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2490"><span class='Ref_To_Local'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="json.c.html#LN2491"><span class='Ref_To_Local'>tok</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN24"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_START</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN2492"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><span class='String'>"object"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN26"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_START</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN2492"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><span class='String'>"array"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN2492"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><span class='String'>"string"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN23"><span class='Ref_to_EnumConst'>JSON_TOKEN_NUMBER</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN2492"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><span class='String'>"number"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN30"><span class='Ref_to_EnumConst'>JSON_TOKEN_TRUE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN31"><span class='Ref_to_EnumConst'>JSON_TOKEN_FALSE</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN2492"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><span class='String'>"boolean"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Operator'>: 
</span>            <a href="json.c.html#LN2492"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><span class='String'>"null"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected json token: %d"</span><span class='Delimiter'>, </span><a href="json.c.html#LN2491"><span class='Ref_To_Local'>tok</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch tok &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="json.c.html#LN2492"><span class='Ref_To_Local'>type</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_typeof &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>