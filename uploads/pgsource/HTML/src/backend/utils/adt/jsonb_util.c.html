<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\jsonb_util.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\jsonb_util.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:51 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * jsonb_util.c 
 *    converting between Jsonb and JsonbValues, and iterating. 
 * 
 * Copyright (c) 2014-2017, PostgreSQL Global Development Group 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/jsonb_util.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/jsonb.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Maximum number of elements in an array (or key/value pairs in an object). 
 * This is limited by two things: the size of the JEntry array must fit 
 * in MaxAllocSize, and the number of elements (or pairs) must fit in the bits 
 * reserved for that in the JsonbContainer.header field. 
 * 
 * (The total size of an array's or object's elements is also limited by 
 * JENTRY_OFFLENMASK, but we're not concerned about that here.) 
 */ 
</span><a name="LN32"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>JSONB_MAX_ELEMS</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN202"><span class='Ref_to_Const'>JB_CMASK</span></a><span class='Parentheses'>))</span> 
<a name="LN33"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>JSONB_MAX_PAIRS</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN202"><span class='Ref_to_Const'>JB_CMASK</span></a><span class='Parentheses'>))</span> 
 
<a name="LN35"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>fillJsonbValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>container</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN36"></a>               <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>base_addr</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>offset</span><span class='Delimiter'>, 
</span><a name="LN37"></a>               <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN38"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>equalsJsonbScalarValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN39"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>compareJsonbScalarValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN40"></a><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>convertToJsonb</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN41"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>convertJsonbValue</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>header</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN42"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>convertJsonbArray</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>header</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>convertJsonbObject</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>header</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>convertJsonbScalar</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>header</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN46"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>reserveFromBuffer</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>appendToBuffer</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>copyToBuffer</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN49"></a><span class='Keyword'>static short </span><span class='Declare_Prototype'>padBufferToInt</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN51"></a><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>iteratorFromContainer</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>container</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN52"></a><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>freeAndGetParent</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>it</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN53"></a><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pushState</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pstate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>appendKey</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>appendValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN56"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>appendElement</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN57"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>lengthCompareJsonbStringValue</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN58"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>lengthCompareJsonbPair</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN59"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>uniqueifyJsonbObject</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN60"></a><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>pushJsonbValueScalar</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, 
</span><a name="LN61"></a>                     <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Parameter'>seq</span><span class='Delimiter'>, 
</span><a name="LN62"></a>                     <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Turn an in-memory JsonbValue into a Jsonb for on-disk storage. 
 * 
 * There isn't a JsonbToJsonbValue(), because generally we find it more 
 * convenient to directly iterate through the Jsonb representation and only 
 * really convert nested scalar values.  JsonbIteratorNext() does this, so that 
 * clients of the iteration code don't have to directly deal with the binary 
 * representation (JsonbDeepContains() is a notable exception, although all 
 * exceptions are internal to this module).  In general, functions that accept 
 * a JsonbValue argument are concerned with the manipulation of scalar values, 
 * or simple containers of scalar values, where it would be inconvenient to 
 * deal with a great amount of other state. 
 */ 
</span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>* 
</span><a name="LN78"></a><span class='Declare_Function'>JsonbValueToJsonb</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN80"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN282"><span class='Ref_to_Macro'>IsAJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Scalar value */ 
</span><a name="LN85"></a>        <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pstate</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN86"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN87"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>scalarArray</span><span class='Delimiter'>; 
</span> 
        <a href="jsonb_util.c.html#LN87"><span class='Ref_To_Local'>scalarArray</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN87"><span class='Ref_To_Local'>scalarArray</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN87"><span class='Ref_To_Local'>scalarArray</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN85"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN87"><span class='Ref_To_Local'>scalarArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN85"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN86"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN85"><span class='Ref_To_Local'>pstate</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonb_util.c.html#LN80"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN40"><span class='Ref_to_Proto'>convertToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN86"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a> <span class='Operator'>|| </span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN80"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN40"><span class='Ref_to_Proto'>convertToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN80"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN80"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN80"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN78"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN80"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end JsonbValueToJsonb &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get the offset of the variable-length portion of a Jsonb node within 
 * the variable-length-data part of its container.  The node is identified 
 * by index within the container's JEntry array. 
 */ 
</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN120"></a><span class='Declare_Function'>getJsonbOffset</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN122"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN123"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Start offset of this entry is equal to the end offset of the previous 
     * entry.  Walk backwards to the most recent entry stored as an end 
     * offset, returning that offset plus any lengths in between. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN123"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN120"><span class='Ref_to_Parameter'>index</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN123"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN123"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN122"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/jsonb.h.html#LN153"><span class='Ref_to_Macro'>JBE_OFFLENFLD</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN120"><span class='Ref_to_Parameter'>jc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN196"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN123"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN154"><span class='Ref_to_Macro'>JBE_HAS_OFF</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN120"><span class='Ref_to_Parameter'>jc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN196"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN123"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN122"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getJsonbOffset &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get the length of the variable-length portion of a Jsonb node. 
 * The node is identified by index within the container's JEntry array. 
 */ 
</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN145"></a><span class='Declare_Function'>getJsonbLength</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN147"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>off</span><span class='Delimiter'>; 
</span><a name="LN148"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the length is stored directly in the JEntry, just return it. 
     * Otherwise, get the begin offset of the entry, and subtract that from 
     * the stored end+1 offset. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN154"><span class='Ref_to_Macro'>JBE_HAS_OFF</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN145"><span class='Ref_to_Parameter'>jc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN196"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN145"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN147"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN119"><span class='Ref_to_Func'>getJsonbOffset</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN145"><span class='Ref_to_Parameter'>jc</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN145"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN148"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN153"><span class='Ref_to_Macro'>JBE_OFFLENFLD</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN145"><span class='Ref_to_Parameter'>jc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN196"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN145"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="jsonb_util.c.html#LN147"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="jsonb_util.c.html#LN148"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN153"><span class='Ref_to_Macro'>JBE_OFFLENFLD</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN145"><span class='Ref_to_Parameter'>jc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN196"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN145"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN148"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getJsonbLength &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * BT comparator worker function.  Returns an integer less than, equal to, or 
 * greater than zero, indicating whether a is less than, equal to, or greater 
 * than b.  Consistent with the requirements for a B-Tree operator class 
 * 
 * Strings are compared lexically, in contrast with other places where we use a 
 * much simpler comparator logic for searching through Strings.  Since this is 
 * called from B-Tree support function 1, we're careful about not leaking 
 * memory here. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN177"></a><span class='Declare_Function'>compareJsonbContainers</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN179"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ita</span><span class='Delimiter'>, 
</span><a name="LN180"></a>               <span class='Operator'>*</span><span class='Declare_Local'>itb</span><span class='Delimiter'>; 
</span><a name="LN181"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN179"><span class='Ref_To_Local'>ita</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN177"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonb_util.c.html#LN180"><span class='Ref_To_Local'>itb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN177"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span><a name="LN188"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>va</span><span class='Delimiter'>, 
</span><a name="LN189"></a>                    <span class='Declare_Local'>vb</span><span class='Delimiter'>; 
</span><a name="LN190"></a>        <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>ra</span><span class='Delimiter'>, 
</span><a name="LN191"></a>                    <span class='Declare_Local'>rb</span><span class='Delimiter'>; 
</span> 
        <a href="jsonb_util.c.html#LN190"><span class='Ref_To_Local'>ra</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN179"><span class='Ref_To_Local'>ita</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN191"><span class='Ref_To_Local'>rb</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN180"><span class='Ref_To_Local'>itb</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN190"><span class='Ref_To_Local'>ra</span></a> <span class='Operator'>== </span><a href="jsonb_util.c.html#LN191"><span class='Ref_To_Local'>rb</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN190"><span class='Ref_To_Local'>ra</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Decisively equal */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN190"><span class='Ref_To_Local'>ra</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a> <span class='Operator'>|| </span><a href="jsonb_util.c.html#LN190"><span class='Ref_To_Local'>ra</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * There is no array or object to compare at this stage of 
                 * processing.  jbvArray/jbvObject values are compared 
                 * initially, at the WJB_BEGIN_ARRAY and WJB_BEGIN_OBJECT 
                 * tokens. 
                 */ 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Operator'>: 
</span>                        <a href="jsonb_util.c.html#LN181"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN39"><span class='Ref_to_Proto'>compareJsonbScalarValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Operator'>: 
</span> 
                        <span class='Comment_Multi_Line'>/* 
                         * This could be a "raw scalar" pseudo array.  That's 
                         * a special case here though, since we still want the 
                         * general type-based comparisons to apply, and as far 
                         * as we're concerned a pseudo array is just a scalar. 
                         */ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar <span class='Operator'>!= </span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar<span class='Parentheses'>) 
</span>                            <a href="jsonb_util.c.html#LN181"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar<span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems <span class='Operator'>!= </span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems<span class='Parentheses'>) 
</span>                            <a href="jsonb_util.c.html#LN181"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems <span class='Operator'>&GT; </span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems<span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Operator'>: 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs <span class='Operator'>!= </span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Parentheses'>) 
</span>                            <a href="jsonb_util.c.html#LN181"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs <span class='Operator'>&GT; </span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Operator'>: 
</span>                        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected jbvBinary value"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch va.type &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if va.type==vb.type &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Type-defined order */ 
</span>                <a href="jsonb_util.c.html#LN181"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>&GT; </span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ra==rb &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * It's safe to assume that the types differed, and that the va 
             * and vb values passed were set. 
             * 
             * If the two values were of the same container type, then there'd 
             * have been a chance to observe the variation in the number of 
             * elements/pairs (when processing WJB_BEGIN_OBJECT, say). They're 
             * either two heterogeneously-typed containers, or a container and 
             * some scalar type. 
             * 
             * We don't have to consider the WJB_END_ARRAY and WJB_END_OBJECT 
             * cases here, because we would have seen the corresponding 
             * WJB_BEGIN_ARRAY and WJB_BEGIN_OBJECT tokens first, and 
             * concluded that they don't match. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN190"><span class='Ref_To_Local'>ra</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a> <span class='Operator'>&& </span><a href="jsonb_util.c.html#LN190"><span class='Ref_To_Local'>ra</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN191"><span class='Ref_To_Local'>rb</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a> <span class='Operator'>&& </span><a href="jsonb_util.c.html#LN191"><span class='Ref_To_Local'>rb</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Type-defined order */ 
</span>            <a href="jsonb_util.c.html#LN181"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN188"><span class='Ref_To_Local'>va</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>&GT; </span><a href="jsonb_util.c.html#LN189"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN181"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN179"><span class='Ref_To_Local'>ita</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN283"></a>        <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>i</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN179"><span class='Ref_To_Local'>ita</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN350"><span class='Ref_to_Member'>parent</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN179"><span class='Ref_To_Local'>ita</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN179"><span class='Ref_To_Local'>ita</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN283"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN180"><span class='Ref_To_Local'>itb</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN290"></a>        <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>i</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN180"><span class='Ref_To_Local'>itb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN350"><span class='Ref_to_Member'>parent</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN180"><span class='Ref_To_Local'>itb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN180"><span class='Ref_To_Local'>itb</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN290"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN181"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end compareJsonbContainers &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find value in object (i.e. the "value" part of some key/value pair in an 
 * object), or find a matching element if we're looking through an array.  Do 
 * so on the basis of equality of the object keys only, or alternatively 
 * element values only, with a caller-supplied value "key".  The "flags" 
 * argument allows the caller to specify which container types are of interest. 
 * 
 * This exported utility function exists to facilitate various cases concerned 
 * with "containment".  If asked to look through an object, the caller had 
 * better pass a Jsonb String, because their keys can only be strings. 
 * Otherwise, for an array, any type of JsonbValue will do. 
 * 
 * In order to proceed with the search, it is necessary for callers to have 
 * both specified an interest in exactly one particular container type with an 
 * appropriate flag, as well as having the pointed-to Jsonb container be of 
 * one of those same container types at the top level. (Actually, we just do 
 * whichever makes sense to save callers the trouble of figuring it out - at 
 * most one can make sense, because the container either points to an array 
 * (possibly a "raw scalar" pseudo array) or an object.) 
 * 
 * Note that we can return a jbvBinary JsonbValue if this is called on an 
 * object, but we never do so on an array.  If the caller asks to look through 
 * a container type that is not of the type pointed to by the container, 
 * immediately fall through and return NULL.  If we cannot find the value, 
 * return NULL.  Otherwise, return palloc()'d copy of value. 
 */ 
</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>* 
</span><a name="LN326"></a><span class='Declare_Function'>findJsonbValueFromContainer</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>container</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>flags</span><span class='Delimiter'>, 
</span><a name="LN327"></a>                            <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN329"></a>    <a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>children</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>container</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN196"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>; 
</span><a name="LN330"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN208"><span class='Ref_to_Macro'>JsonContainerSize</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>container</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN331"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>((</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& ~</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN205"><span class='Ref_to_Const'>JB_FARRAY</span></a> <span class='Operator'>| </span><a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Quick out without a palloc cycle if object/array is empty */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN330"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN331"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/jsonb.h.html#LN205"><span class='Ref_to_Const'>JB_FARRAY</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/utils/jsonb.h.html#LN211"><span class='Ref_to_Macro'>JsonContainerIsArray</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>container</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN343"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>base_addr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="jsonb_util.c.html#LN329"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN330"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN344"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>offset</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN345"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN345"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN330"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN345"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="jsonb_util.c.html#LN35"><span class='Ref_to_Proto'>fillJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN345"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN343"><span class='Ref_To_Local'>base_addr</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN344"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN331"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN327"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="jsonb_util.c.html#LN331"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN38"><span class='Ref_to_Proto'>equalsJsonbScalarValue</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN327"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN331"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN331"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="../../../include/utils/jsonb.h.html#LN164"><span class='Ref_to_Macro'>JBE_ADVANCE_OFFSET</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN344"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN329"><span class='Ref_To_Local'>children</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN345"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/utils/jsonb.h.html#LN210"><span class='Ref_to_Macro'>JsonContainerIsObject</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>container</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Since this is an object, account for *Pairs* of Jentrys */ 
</span><a name="LN363"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>base_addr</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="jsonb_util.c.html#LN329"><span class='Ref_To_Local'>children</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN330"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN364"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>stopLow</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN365"></a>                    <span class='Declare_Local'>stopHigh</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN330"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Object key passed by caller must be a string */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN327"><span class='Ref_to_Parameter'>key</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Binary search on object/pair keys *only* */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN364"><span class='Ref_To_Local'>stopLow</span></a> <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN365"><span class='Ref_To_Local'>stopHigh</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN373"></a>            <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>stopMiddle</span><span class='Delimiter'>; 
</span><a name="LN374"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>difference</span><span class='Delimiter'>; 
</span><a name="LN375"></a>            <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>candidate</span><span class='Delimiter'>; 
</span> 
            <a href="jsonb_util.c.html#LN373"><span class='Ref_To_Local'>stopMiddle</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN364"><span class='Ref_To_Local'>stopLow</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN365"><span class='Ref_To_Local'>stopHigh</span></a> <span class='Operator'>- </span><a href="jsonb_util.c.html#LN364"><span class='Ref_To_Local'>stopLow</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
            <a href="jsonb_util.c.html#LN375"><span class='Ref_To_Local'>candidate</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN375"><span class='Ref_To_Local'>candidate</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val <span class='Operator'>= 
</span>                <a href="jsonb_util.c.html#LN363"><span class='Ref_To_Local'>base_addr</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN119"><span class='Ref_to_Func'>getJsonbOffset</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN373"><span class='Ref_To_Local'>stopMiddle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN375"><span class='Ref_To_Local'>candidate</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>= </span><a href="jsonb_util.c.html#LN144"><span class='Ref_to_Func'>getJsonbLength</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN373"><span class='Ref_To_Local'>stopMiddle</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="jsonb_util.c.html#LN374"><span class='Ref_To_Local'>difference</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN57"><span class='Ref_to_Proto'>lengthCompareJsonbStringValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN375"><span class='Ref_To_Local'>candidate</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN327"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN374"><span class='Ref_To_Local'>difference</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Found our key, return corresponding value */ 
</span><a name="LN389"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>index</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN373"><span class='Ref_To_Local'>stopMiddle</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN330"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; 
</span> 
                <a href="jsonb_util.c.html#LN35"><span class='Ref_to_Proto'>fillJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN389"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN363"><span class='Ref_To_Local'>base_addr</span></a><span class='Delimiter'>, 
</span>                               <a href="jsonb_util.c.html#LN119"><span class='Ref_to_Func'>getJsonbOffset</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN326"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN389"><span class='Ref_To_Local'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="jsonb_util.c.html#LN331"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>return</span> <a href="jsonb_util.c.html#LN331"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN374"><span class='Ref_To_Local'>difference</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="jsonb_util.c.html#LN364"><span class='Ref_To_Local'>stopLow</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN373"><span class='Ref_To_Local'>stopMiddle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="jsonb_util.c.html#LN365"><span class='Ref_To_Local'>stopHigh</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN373"><span class='Ref_To_Local'>stopMiddle</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while stopLow&LT;stopHigh &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (flags&JB_FOBJECT)&&J... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Not found */ 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN331"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findJsonbValueFromContainer &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get i-th value of a Jsonb array. 
 * 
 * Returns palloc()'d copy of the value, or NULL if it does not exist. 
 */ 
</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>* 
</span><a name="LN418"></a><span class='Declare_Function'>getIthJsonbValueFromContainer</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>container</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>i</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN420"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN421"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>base_addr</span><span class='Delimiter'>; 
</span><a name="LN422"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>nelements</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN211"><span class='Ref_to_Macro'>JsonContainerIsArray</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN418"><span class='Ref_to_Parameter'>container</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"not a jsonb array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN422"><span class='Ref_To_Local'>nelements</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN208"><span class='Ref_to_Macro'>JsonContainerSize</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN418"><span class='Ref_to_Parameter'>container</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonb_util.c.html#LN421"><span class='Ref_To_Local'>base_addr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN418"><span class='Ref_to_Parameter'>container</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN196"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN422"><span class='Ref_To_Local'>nelements</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN418"><span class='Ref_to_Parameter'>i</span></a> <span class='Operator'>&GT;= </span><a href="jsonb_util.c.html#LN422"><span class='Ref_To_Local'>nelements</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN420"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN35"><span class='Ref_to_Proto'>fillJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN418"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN418"><span class='Ref_to_Parameter'>i</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN421"><span class='Ref_To_Local'>base_addr</span></a><span class='Delimiter'>, 
</span>                   <a href="jsonb_util.c.html#LN119"><span class='Ref_to_Func'>getJsonbOffset</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN418"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN418"><span class='Ref_to_Parameter'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="jsonb_util.c.html#LN420"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN420"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end getIthJsonbValueFromContainer &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * A helper function to fill in a JsonbValue to represent an element of an 
 * array, or a key or value of an object. 
 * 
 * The node's JEntry is at container-&GT;children[index], and its variable-length 
 * data is at base_addr + offset.  We make the caller determine the offset 
 * since in many cases the caller can amortize that work across multiple 
 * children.  When it can't, it can just call getJsonbOffset(). 
 * 
 * A nested array or object will be returned as jbvBinary, ie. it won't be 
 * expanded. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN455"></a><span class='Declare_Function'>fillJsonbValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>container</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>index</span><span class='Delimiter'>, 
</span><a name="LN456"></a>               <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>base_addr</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>offset</span><span class='Delimiter'>, 
</span><a name="LN457"></a>               <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN459"></a>    <a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a>      <span class='Declare_Local'>entry</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN455"><span class='Ref_to_Parameter'>container</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN196"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN455"><span class='Ref_to_Parameter'>index</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN158"><span class='Ref_to_Macro'>JBE_ISNULL</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN459"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN155"><span class='Ref_to_Macro'>JBE_ISSTRING</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN459"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val <span class='Operator'>= </span><a href="jsonb_util.c.html#LN456"><span class='Ref_to_Parameter'>base_addr</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN456"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>= </span><a href="jsonb_util.c.html#LN144"><span class='Ref_to_Func'>getJsonbLength</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN455"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN455"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN156"><span class='Ref_to_Macro'>JBE_ISNUMERIC</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN459"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) (</span><a href="jsonb_util.c.html#LN456"><span class='Ref_to_Parameter'>base_addr</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN584"><span class='Ref_to_Macro'>INTALIGN</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN456"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN159"><span class='Ref_to_Macro'>JBE_ISBOOL_TRUE</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN459"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN160"><span class='Ref_to_Macro'>JBE_ISBOOL_FALSE</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN459"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN157"><span class='Ref_to_Macro'>JBE_ISCONTAINER</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN459"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Remove alignment padding from data pointer and length */ 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="jsonb_util.c.html#LN456"><span class='Ref_to_Parameter'>base_addr</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN584"><span class='Ref_to_Macro'>INTALIGN</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN456"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN457"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>len <span class='Operator'>= </span><a href="jsonb_util.c.html#LN144"><span class='Ref_to_Func'>getJsonbLength</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN455"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN455"><span class='Ref_to_Parameter'>index</span></a><span class='Parentheses'>) </span><span class='Operator'>- 
</span>            <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN584"><span class='Ref_to_Macro'>INTALIGN</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN456"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="jsonb_util.c.html#LN456"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end fillJsonbValue &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Push JsonbValue into JsonbParseState. 
 * 
 * Used when parsing JSON tokens to form Jsonb, or when converting an in-memory 
 * JsonbValue to a Jsonb. 
 * 
 * Initial state of *JsonbParseState is NULL, since it'll be allocated here 
 * originally (caller will get JsonbParseState back by reference). 
 * 
 * Only sequential tokens pertaining to non-container types should pass a 
 * JsonbValue.  There is one exception -- WJB_BEGIN_ARRAY callers may pass a 
 * "raw scalar" pseudo array to append it - the actual scalar should be passed 
 * next and it will be added as the only member of the array. 
 * 
 * Values of type jvbBinary, which are rolled up arrays and objects, 
 * are unpacked before being added to the result. 
 */ 
</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>* 
</span><a name="LN516"></a><span class='Declare_Function'>pushJsonbValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Parameter'>seq</span><span class='Delimiter'>, 
</span><a name="LN517"></a>               <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jbval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN519"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN520"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN521"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN522"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>tok</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonb_util.c.html#LN517"><span class='Ref_to_Parameter'>jbval</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN516"><span class='Ref_to_Parameter'>seq</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a> <span class='Operator'>&& </span><a href="jsonb_util.c.html#LN516"><span class='Ref_to_Parameter'>seq</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="jsonb_util.c.html#LN517"><span class='Ref_to_Parameter'>jbval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* drop through */ 
</span>        <span class='Control'>return</span> <a href="jsonb_util.c.html#LN60"><span class='Ref_to_Proto'>pushJsonbValueScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN516"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN516"><span class='Ref_to_Parameter'>seq</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN517"><span class='Ref_to_Parameter'>jbval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* unpack the binary and add each piece to the pstate */ 
</span>    <a href="jsonb_util.c.html#LN519"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN517"><span class='Ref_to_Parameter'>jbval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonb_util.c.html#LN522"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN519"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN521"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>)</span> 
        <a href="jsonb_util.c.html#LN520"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN60"><span class='Ref_to_Proto'>pushJsonbValueScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN516"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN522"><span class='Ref_To_Local'>tok</span></a><span class='Delimiter'>, 
</span>                                   <a href="jsonb_util.c.html#LN522"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonb_util.c.html#LN521"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN520"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pushJsonbValue &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Do the actual pushing, with only scalar or pseudo-scalar-array values 
 * accepted. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>* 
</span><a name="LN545"></a><span class='Declare_Function'>pushJsonbValueScalar</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Parameter'>seq</span><span class='Delimiter'>, 
</span><a name="LN546"></a>                     <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN548"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>seq</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a> <span class='Operator'>|| </span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN53"><span class='Ref_to_Proto'>pushState</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN548"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= &</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Operator'>.</span>type <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Operator'>.</span>val<span class='Operator'>.</span>array<span class='Operator'>.</span>nElems <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Operator'>.</span>val<span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a> <span class='Operator'>&& 
</span>                                             <a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a> <span class='Operator'>&& </span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Assume that this array is still really a scalar */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>size <span class='Operator'>= </span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems<span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>size <span class='Operator'>= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Operator'>.</span>val<span class='Operator'>.</span>array<span class='Operator'>.</span>elems <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                                                        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>size<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN53"><span class='Ref_to_Proto'>pushState</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN548"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= &</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Operator'>.</span>type <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Operator'>.</span>val<span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>size <span class='Operator'>= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Operator'>.</span>val<span class='Operator'>.</span>object<span class='Operator'>.</span>pairs <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                                                         <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>size<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN54"><span class='Ref_to_Proto'>appendKey</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN282"><span class='Ref_to_Macro'>IsAJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN55"><span class='Ref_to_Proto'>appendValue</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Operator'>: 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN282"><span class='Ref_to_Macro'>IsAJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN56"><span class='Ref_to_Proto'>appendElement</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Operator'>: 
</span>            <a href="jsonb_util.c.html#LN59"><span class='Ref_to_Proto'>uniqueifyJsonbObject</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* fall through! */ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Steps here common to WJB_END_OBJECT case */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonb_util.c.html#LN546"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN548"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= &</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Pop stack and push current array/object as value in parent 
             * array/object 
             */ 
</span>            <span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>next<span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Operator'>.</span>type<span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Operator'>: 
</span>                        <a href="jsonb_util.c.html#LN56"><span class='Ref_to_Proto'>appendElement</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN548"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Operator'>: 
</span>                        <a href="jsonb_util.c.html#LN55"><span class='Ref_to_Proto'>appendValue</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN545"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN548"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid jsonb container type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized jsonb sequential processing token"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch seq &raquo; </span> 
 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN548"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pushJsonbValueScalar &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pushJsonbValue() worker:  Iteration-like forming of Jsonb 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>* 
</span><a name="LN634"></a><span class='Declare_Function'>pushState</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>pstate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN636"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ns</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN636"><span class='Ref_To_Local'>ns</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN307"><span class='Ref_to_Member'>next</span></a> <span class='Operator'>= *</span><a href="jsonb_util.c.html#LN634"><span class='Ref_to_Parameter'>pstate</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN636"><span class='Ref_To_Local'>ns</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pushJsonbValue() worker:  Append a pair key to state when generating a Jsonb 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN646"></a><span class='Declare_Function'>appendKey</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN648"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>object</span> <span class='Operator'>= &</span><a href="jsonb_util.c.html#LN646"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN305"><span class='Ref_to_Member'>contVal</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN646"><span class='Ref_to_Parameter'>string</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs <span class='Operator'>&GT;= </span><a href="jsonb_util.c.html#LN33"><span class='Ref_to_Const'>JSONB_MAX_PAIRS</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of jsonb object pairs exceeds the maximum allowed (%zu)"</span><span class='Delimiter'>, 
</span>                        <a href="jsonb_util.c.html#LN33"><span class='Ref_to_Const'>JSONB_MAX_PAIRS</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs <span class='Operator'>&GT;= </span><a href="jsonb_util.c.html#LN646"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN306"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN646"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN306"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs<span class='Delimiter'>, 
</span>                                            <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonb_util.c.html#LN646"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN306"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs<span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Delimiter'>]</span><span class='Operator'>.</span>key <span class='Operator'>= *</span><a href="jsonb_util.c.html#LN646"><span class='Ref_to_Parameter'>string</span></a><span class='Delimiter'>; 
</span>    <a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs<span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Delimiter'>]</span><span class='Operator'>.</span>order <span class='Operator'>= </span><a href="jsonb_util.c.html#LN648"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end appendKey &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pushJsonbValue() worker:  Append a pair value to state when generating a 
 * Jsonb 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN675"></a><span class='Declare_Function'>appendValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN677"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>object</span> <span class='Operator'>= &</span><a href="jsonb_util.c.html#LN675"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN305"><span class='Ref_to_Member'>contVal</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN677"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN677"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs<span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN677"><span class='Ref_To_Local'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Operator'>++</span><span class='Delimiter'>]</span><span class='Operator'>.</span><span class='Keyword'>value </span><span class='Operator'>= *</span><a href="jsonb_util.c.html#LN675"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * pushJsonbValue() worker:  Append an element to state when generating a Jsonb 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN688"></a><span class='Declare_Function'>appendElement</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pstate</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN690"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>array</span> <span class='Operator'>= &</span><a href="jsonb_util.c.html#LN688"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN305"><span class='Ref_to_Member'>contVal</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN690"><span class='Ref_To_Local'>array</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN690"><span class='Ref_To_Local'>array</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems <span class='Operator'>&GT;= </span><a href="jsonb_util.c.html#LN32"><span class='Ref_to_Const'>JSONB_MAX_ELEMS</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number of jsonb array elements exceeds the maximum allowed (%zu)"</span><span class='Delimiter'>, 
</span>                        <a href="jsonb_util.c.html#LN32"><span class='Ref_to_Const'>JSONB_MAX_ELEMS</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN690"><span class='Ref_To_Local'>array</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems <span class='Operator'>&GT;= </span><a href="jsonb_util.c.html#LN688"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN306"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN688"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN306"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN690"><span class='Ref_To_Local'>array</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>elems <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN690"><span class='Ref_To_Local'>array</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>elems<span class='Delimiter'>, 
</span>                                          <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonb_util.c.html#LN688"><span class='Ref_to_Parameter'>pstate</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN306"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonb_util.c.html#LN690"><span class='Ref_To_Local'>array</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>elems<span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN690"><span class='Ref_To_Local'>array</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems<span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= *</span><a href="jsonb_util.c.html#LN688"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end appendElement &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given a JsonbContainer, expand to JsonbIterator to iterate over items 
 * fully expanded to in-memory representation for manipulation. 
 * 
 * See JsonbIteratorNext() for notes on memory management. 
 */ 
</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>* 
</span><a name="LN717"></a><span class='Declare_Function'>JsonbIteratorInit</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>container</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN51"><span class='Ref_to_Proto'>iteratorFromContainer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN717"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Get next JsonbValue while iterating 
 * 
 * Caller should initially pass their own, original iterator.  They may get 
 * back a child iterator palloc()'d here instead.  The function can be relied 
 * on to free those child iterators, lest the memory allocated for highly 
 * nested objects become unreasonable, but only if callers don't end iteration 
 * early (by breaking upon having found something in a search, for example). 
 * 
 * Callers in such a scenario, that are particularly sensitive to leaking 
 * memory in a long-lived context may walk the ancestral tree from the final 
 * iterator we left them with to its oldest ancestor, pfree()ing as they go. 
 * They do not have to free any other memory previously allocated for iterators 
 * but not accessible as direct ancestors of the iterator they're last passed 
 * back. 
 * 
 * Returns "Jsonb sequential processing" token value.  Iterator "state" 
 * reflects the current stage of the process in a less granular fashion, and is 
 * mostly used here to track things internally with respect to particular 
 * iterators. 
 * 
 * Clients of this function should not have to handle any jbvBinary values 
 * (since recursive calls will deal with this), provided skipNested is false. 
 * It is our job to expand the jbvBinary representation without bothering them 
 * with it.  However, clients should not take it upon themselves to touch array 
 * or Object element/pair buffers, since their element/pair pointers are 
 * garbage.  Also, *val will not be set when returning WJB_END_ARRAY or 
 * WJB_END_OBJECT, on the assumption that it's only useful to access values 
 * when recursing in. 
 */ 
</span><a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> 
<a name="LN753"></a><span class='Declare_Function'>JsonbIteratorNext</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>skipNested</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * When stepping into a nested container, we jump back here to start 
     * processing the child. We will not recurse further in one call, because 
     * processing the child will always begin in JBI_ARRAY_START or 
     * JBI_OBJECT_START state. 
     */ 
</span><a name="LN764"></a><span class='Label'>recurse</span><span class='Operator'>: 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>state<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN316"><span class='Ref_to_EnumConst'>JBI_ARRAY_START</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Set v to array on first array call */ 
</span>            <a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nElems<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * v-&GT;val.array.elems is not actually set, because we aren't doing 
             * a full conversion 
             */ 
</span>            <a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>isScalar<span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curDataOffset <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curValueOffset <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* not actually used */ 
</span>            <span class='Comment_Multi_Line'>/* Set state for next call */ 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>state <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN317"><span class='Ref_to_EnumConst'>JBI_ARRAY_ELEM</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN317"><span class='Ref_to_EnumConst'>JBI_ARRAY_ELEM</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nElems<span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * All elements within array already processed.  Report this 
                 * to caller, and give it back original parent iterator (which 
                 * independently tracks iteration progress at its level of 
                 * nesting). 
                 */ 
</span>                <span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN52"><span class='Ref_to_Proto'>freeAndGetParent</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="jsonb_util.c.html#LN35"><span class='Ref_to_Proto'>fillJsonbValue</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>container<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex<span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>dataProper<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curDataOffset<span class='Delimiter'>, 
</span>                           <a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/jsonb.h.html#LN164"><span class='Ref_to_Macro'>JBE_ADVANCE_OFFSET</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curDataOffset<span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>children<span class='Delimiter'>[</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex<span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN282"><span class='Ref_to_Macro'>IsAJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>skipNested</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Recurse into container. */ 
</span>                <span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN51"><span class='Ref_to_Proto'>iteratorFromContainer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>, </span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="jsonb_util.c.html#LN764"><span class='Ref_to_Label'>recurse</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Scalar item in array, or a container and caller didn't want 
                 * us to recurse into it. 
                 */ 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN318"><span class='Ref_to_EnumConst'>JBI_OBJECT_START</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Set v to object on first object call */ 
</span>            <a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nElems<span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * v-&GT;val.object.pairs is not actually set, because we aren't 
             * doing a full conversion 
             */ 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curDataOffset <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curValueOffset <span class='Operator'>= </span><a href="jsonb_util.c.html#LN119"><span class='Ref_to_Func'>getJsonbOffset</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>container<span class='Delimiter'>, 
</span>                                                   <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nElems<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Set state for next call */ 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>state <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN319"><span class='Ref_to_EnumConst'>JBI_OBJECT_KEY</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN319"><span class='Ref_to_EnumConst'>JBI_OBJECT_KEY</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nElems<span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * All pairs within object already processed.  Report this to 
                 * caller, and give it back original containing iterator 
                 * (which independently tracks iteration progress at its level 
                 * of nesting). 
                 */ 
</span>                <span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN52"><span class='Ref_to_Proto'>freeAndGetParent</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Return key of a key/value pair.  */ 
</span>                <a href="jsonb_util.c.html#LN35"><span class='Ref_to_Proto'>fillJsonbValue</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>container<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex<span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>dataProper<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curDataOffset<span class='Delimiter'>, 
</span>                               <a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>) 
</span>                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected jsonb type as object key"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Set state for next call */ 
</span>                <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>state <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN320"><span class='Ref_to_EnumConst'>JBI_OBJECT_VALUE</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN320"><span class='Ref_to_EnumConst'>JBI_OBJECT_VALUE</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Set state for next call */ 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>state <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN319"><span class='Ref_to_EnumConst'>JBI_OBJECT_KEY</span></a><span class='Delimiter'>; 
</span> 
            <a href="jsonb_util.c.html#LN35"><span class='Ref_to_Proto'>fillJsonbValue</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>container<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nElems<span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>dataProper<span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curValueOffset<span class='Delimiter'>, 
</span>                           <a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/jsonb.h.html#LN164"><span class='Ref_to_Macro'>JBE_ADVANCE_OFFSET</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curDataOffset<span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>children<span class='Delimiter'>[</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/jsonb.h.html#LN164"><span class='Ref_to_Macro'>JBE_ADVANCE_OFFSET</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curValueOffset<span class='Delimiter'>, 
</span>                           <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>children<span class='Delimiter'>[</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>nElems<span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>curIndex<span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Value may be a container, in which case we recurse with new, 
             * child iterator (unless the caller asked not to, by passing 
             * skipNested). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN282"><span class='Ref_to_Macro'>IsAJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>skipNested</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN51"><span class='Ref_to_Proto'>iteratorFromContainer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>, </span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN753"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>goto</span> <span class='Symbol_Characters'>&uarr;</span><a href="jsonb_util.c.html#LN764"><span class='Ref_to_Label'>recurse</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch (*it)-&GT;state &raquo; </span> 
 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid iterator state"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end JsonbIteratorNext &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Initialize an iterator for iterating all elements in a container. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>* 
</span><a name="LN899"></a><span class='Declare_Function'>iteratorFromContainer</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>container</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>parent</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN901"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN326"><span class='Ref_to_Member'>container</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN899"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>; 
</span>    <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN350"><span class='Ref_to_Member'>parent</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN899"><span class='Ref_to_Parameter'>parent</span></a><span class='Delimiter'>; 
</span>    <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN327"><span class='Ref_to_Member'>nElems</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN208"><span class='Ref_to_Macro'>JsonContainerSize</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN899"><span class='Ref_to_Parameter'>container</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Array starts just after header */ 
</span>    <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN330"><span class='Ref_to_Member'>children</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN899"><span class='Ref_to_Parameter'>container</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN196"><span class='Ref_to_Member'>children</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN899"><span class='Ref_to_Parameter'>container</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN194"><span class='Ref_to_Member'>header</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN205"><span class='Ref_to_Const'>JB_FARRAY</span></a> <span class='Operator'>| </span><a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN205"><span class='Ref_to_Const'>JB_FARRAY</span></a><span class='Operator'>: 
</span>            <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN332"><span class='Ref_to_Member'>dataProper</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN330"><span class='Ref_to_Member'>children</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN327"><span class='Ref_to_Member'>nElems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN329"><span class='Ref_to_Member'>isScalar</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN209"><span class='Ref_to_Macro'>JsonContainerIsScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN899"><span class='Ref_to_Parameter'>container</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* This is either a "raw scalar", or an array */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN329"><span class='Ref_to_Member'>isScalar</span></a> <span class='Operator'>|| </span><a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN327"><span class='Ref_to_Member'>nElems</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN348"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN316"><span class='Ref_to_EnumConst'>JBI_ARRAY_START</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Operator'>: 
</span>            <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN332"><span class='Ref_to_Member'>dataProper</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN330"><span class='Ref_to_Member'>children</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN327"><span class='Ref_to_Member'>nElems</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN348"><span class='Ref_to_Member'>state</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN318"><span class='Ref_to_EnumConst'>JBI_OBJECT_START</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unknown type of jsonb container"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch container-&GT;header&(JB... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN901"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end iteratorFromContainer &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * JsonbIteratorNext() worker:  Return parent, while freeing memory for current 
 * iterator 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>* 
</span><a name="LN941"></a><span class='Declare_Function'>freeAndGetParent</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>it</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN943"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN941"><span class='Ref_to_Parameter'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN350"><span class='Ref_to_Member'>parent</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN941"><span class='Ref_to_Parameter'>it</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN943"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Worker for "contains" operator's function 
 * 
 * Formally speaking, containment is top-down, unordered subtree isomorphism. 
 * 
 * Takes iterators that belong to some container type.  These iterators 
 * "belong" to those values in the sense that they've just been initialized in 
 * respect of them by the caller (perhaps in a nested fashion). 
 * 
 * "val" is lhs Jsonb, and mContained is rhs Jsonb when called from top level. 
 * We determine if mContained is contained within val. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN962"></a><span class='Declare_Function'>JsonbDeepContains</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>mContained</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN964"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>vval</span><span class='Delimiter'>, 
</span><a name="LN965"></a>                <span class='Declare_Local'>vcontained</span><span class='Delimiter'>; 
</span><a name="LN966"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>rval</span><span class='Delimiter'>, 
</span><a name="LN967"></a>                <span class='Declare_Local'>rcont</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Guard against stack overflow due to overly complex Jsonb. 
     * 
     * Functions called here independently take this precaution, but that 
     * might not be sufficient since this is also a recursive function. 
     */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN966"><span class='Ref_To_Local'>rval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN962"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN964"><span class='Ref_To_Local'>vval</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN962"><span class='Ref_to_Parameter'>mContained</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN966"><span class='Ref_To_Local'>rval</span></a> <span class='Operator'>!= </span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The differing return values can immediately be taken as indicating 
         * two differing container types at this nesting level, which is 
         * sufficient reason to give up entirely (but it should be the case 
         * that they're both some container type). 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN966"><span class='Ref_To_Local'>rval</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a> <span class='Operator'>|| </span><a href="jsonb_util.c.html#LN966"><span class='Ref_To_Local'>rval</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a> <span class='Operator'>|| </span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN964"><span class='Ref_To_Local'>vval</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If the lhs has fewer pairs than the rhs, it can't possibly contain 
         * the rhs.  (This conclusion is safe only because we de-duplicate 
         * keys in all Jsonb objects; thus there can be no corresponding 
         * optimization in the array case.)  The case probably won't arise 
         * often, but since it's such a cheap check we may as well make it. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN964"><span class='Ref_To_Local'>vval</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Work through rhs "is it contained within?" object */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1010"></a>            <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lhsVal</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* lhsVal is from pair in lhs object */ 
</span> 
            <a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN962"><span class='Ref_to_Parameter'>mContained</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * When we get through caller's rhs "is it contained within?" 
             * object without failing to find one of its values, it's 
             * contained. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* First, find value by key... */ 
</span>            <a href="jsonb_util.c.html#LN1010"><span class='Ref_To_Local'>lhsVal</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN325"><span class='Ref_to_Func'>findJsonbValueFromContainer</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN962"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN326"><span class='Ref_to_Member'>container</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonb_util.c.html#LN1010"><span class='Ref_To_Local'>lhsVal</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * ...at this stage it is apparent that there is at least a key 
             * match for this rhs pair. 
             */ 
</span>            <a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN962"><span class='Ref_to_Parameter'>mContained</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Compare rhs pair's value with lhs pair's value just found using 
             * key 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1010"><span class='Ref_To_Local'>lhsVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN282"><span class='Ref_to_Macro'>IsAJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1010"><span class='Ref_To_Local'>lhsVal</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonb_util.c.html#LN38"><span class='Ref_to_Proto'>equalsJsonbScalarValue</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1010"><span class='Ref_To_Local'>lhsVal</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Nested container value (object or array) */ 
</span><a name="LN1056"></a>                <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nestval</span><span class='Delimiter'>, 
</span><a name="LN1057"></a>                           <span class='Operator'>*</span><span class='Declare_Local'>nestContained</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1010"><span class='Ref_To_Local'>lhsVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="jsonb_util.c.html#LN1056"><span class='Ref_To_Local'>nestval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1010"><span class='Ref_To_Local'>lhsVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="jsonb_util.c.html#LN1057"><span class='Ref_To_Local'>nestContained</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Match "value" side of rhs datum object's pair recursively. 
                 * It's a nested structure. 
                 * 
                 * Note that nesting still has to "match up" at the right 
                 * nesting sub-levels.  However, there need only be zero or 
                 * more matching pairs (or elements) at each nesting level 
                 * (provided the *rhs* pairs/elements *all* match on each 
                 * level), which enables searching nested structures for a 
                 * single String or other primitive type sub-datum quite 
                 * effectively (provided the user constructed the rhs nested 
                 * structure such that we "know where to look"). 
                 * 
                 * In other words, the mapping of container nodes in the rhs 
                 * "vcontained" Jsonb to internal nodes on the lhs is 
                 * injective, and parent-child edges on the rhs must be mapped 
                 * to parent-child edges on the lhs to satisfy the condition 
                 * of containment (plus of course the mapped nodes must be 
                 * equal). 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN369"><span class='Ref_to_Proto'>JsonbDeepContains</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1056"><span class='Ref_To_Local'>nestval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1057"><span class='Ref_To_Local'>nestContained</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rcont==WJB_BEGIN_OBJE... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1092"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lhsConts</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1093"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>nLhsElems</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN964"><span class='Ref_To_Local'>vval</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems<span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN964"><span class='Ref_To_Local'>vval</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Handle distinction between "raw scalar" pseudo arrays, and real 
         * arrays. 
         * 
         * A raw scalar may contain another raw scalar, and an array may 
         * contain a raw scalar, but a raw scalar may not contain an array. We 
         * don't do something like this for the object case, since objects can 
         * only contain pairs, never raw scalars (a pair is represented by an 
         * rhs object argument with a single contained pair). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN964"><span class='Ref_To_Local'>vval</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar <span class='Operator'>&& !</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar<span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Work through rhs "is it contained within?" array */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN962"><span class='Ref_to_Parameter'>mContained</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * When we get through caller's rhs "is it contained within?" 
             * array without failing to find one of its values, it's 
             * contained. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN282"><span class='Ref_to_Macro'>IsAJsonbScalar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonb_util.c.html#LN325"><span class='Ref_to_Func'>findJsonbValueFromContainer</span></a><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN962"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN326"><span class='Ref_to_Member'>container</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/utils/jsonb.h.html#LN205"><span class='Ref_to_Const'>JB_FARRAY</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN1135"></a>                <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If this is first container found in rhs array (at this 
                 * depth), initialize temp lhs array of containers 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1092"><span class='Ref_To_Local'>lhsConts</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1143"></a>                    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* Make room for all possible values */ 
</span>                    <a href="jsonb_util.c.html#LN1092"><span class='Ref_To_Local'>lhsConts</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonb_util.c.html#LN1093"><span class='Ref_To_Local'>nLhsElems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1135"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1135"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN1093"><span class='Ref_To_Local'>nLhsElems</span></a><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1135"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Store all lhs elements in temp array */ 
</span>                        <a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN962"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN964"><span class='Ref_To_Local'>vval</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN967"><span class='Ref_To_Local'>rcont</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN964"><span class='Ref_To_Local'>vval</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>) 
</span>                            <a href="jsonb_util.c.html#LN1092"><span class='Ref_To_Local'>lhsConts</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN1143"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="jsonb_util.c.html#LN964"><span class='Ref_To_Local'>vval</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* No container elements in temp array, so give up now */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1143"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* We may have only partially filled array */ 
</span>                    <a href="jsonb_util.c.html#LN1093"><span class='Ref_To_Local'>nLhsElems</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1143"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if lhsConts==NULL &raquo; </span> 
 
                <span class='Comment_Multi_Line'>/* XXX: Nested array containment is O(N^2) */ 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1135"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1135"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN1093"><span class='Ref_To_Local'>nLhsElems</span></a><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1135"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Nested container value (object or array) */ 
</span><a name="LN1170"></a>                    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nestval</span><span class='Delimiter'>, 
</span><a name="LN1171"></a>                               <span class='Operator'>*</span><span class='Declare_Local'>nestContained</span><span class='Delimiter'>; 
</span><a name="LN1172"></a>                    <span class='Keyword'>bool</span>        <span class='Declare_Local'>contains</span><span class='Delimiter'>; 
</span> 
                    <a href="jsonb_util.c.html#LN1170"><span class='Ref_To_Local'>nestval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1092"><span class='Ref_To_Local'>lhsConts</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN1135"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="jsonb_util.c.html#LN1171"><span class='Ref_To_Local'>nestContained</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN965"><span class='Ref_To_Local'>vcontained</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="jsonb_util.c.html#LN1172"><span class='Ref_To_Local'>contains</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN369"><span class='Ref_to_Proto'>JsonbDeepContains</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1170"><span class='Ref_To_Local'>nestval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1171"><span class='Ref_To_Local'>nestContained</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1170"><span class='Ref_To_Local'>nestval</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1170"><span class='Ref_To_Local'>nestval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1171"><span class='Ref_To_Local'>nestContained</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1171"><span class='Ref_To_Local'>nestContained</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1172"><span class='Ref_To_Local'>contains</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Report rhs container value is not contained if couldn't 
                 * match rhs container to *some* lhs cont 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1135"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="jsonb_util.c.html#LN1093"><span class='Ref_To_Local'>nLhsElems</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rcont==WJB_BEGIN_ARRA... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid jsonb container type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpectedly fell off end of jsonb container"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end JsonbDeepContains &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Hash a JsonbValue scalar value, mixing the hash value into an existing 
 * hash provided by the caller. 
 * 
 * Some callers may wish to independently XOR in JB_FOBJECT and JB_FARRAY 
 * flags. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1213"></a><span class='Declare_Function'>JsonbHashScalarValue</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hash</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1215"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Compute hash value for scalarVal */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1213"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Operator'>: 
</span>            <a href="jsonb_util.c.html#LN1215"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='Number'>0x01</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Operator'>: 
</span>            <a href="jsonb_util.c.html#LN1215"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../access/hash/hashfunc.c.html#LN305"><span class='Ref_to_Func'>hash_any</span></a><span class='Parentheses'>((</span><span class='Keyword'>const unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN1213"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, 
</span>                                          <a href="jsonb_util.c.html#LN1213"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Must hash equal numerics to equal hash codes */ 
</span>            <a href="jsonb_util.c.html#LN1215"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2156"><span class='Ref_to_Func'>hash_numeric</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1213"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Operator'>: 
</span>            <a href="jsonb_util.c.html#LN1215"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1213"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean <span class='Operator'>? </span><span class='Number'>0x02</span> <span class='Operator'>: </span><span class='Number'>0x04</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid jsonb scalar type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN1215"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch scalarVal-&GT;type &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Combine hash values of successive keys, values and elements by rotating 
     * the previous value left 1 bit, then XOR'ing in the new 
     * key/value/element's hash value. 
     */ 
</span>    <span class='Operator'>*</span><a href="jsonb_util.c.html#LN1213"><span class='Ref_to_Parameter'>hash</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN1213"><span class='Ref_to_Parameter'>hash</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonb_util.c.html#LN1213"><span class='Ref_to_Parameter'>hash</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>31</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="jsonb_util.c.html#LN1213"><span class='Ref_to_Parameter'>hash</span></a> <span class='Operator'>^= </span><a href="jsonb_util.c.html#LN1215"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end JsonbHashScalarValue &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Are two scalar JsonbValues of the same type a and b equal? 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1255"></a><span class='Declare_Function'>equalsJsonbScalarValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>aScalar</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bScalar</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1255"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="jsonb_util.c.html#LN1255"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1255"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="jsonb_util.c.html#LN57"><span class='Ref_to_Proto'>lengthCompareJsonbStringValue</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1255"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1255"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2034"><span class='Ref_to_Func'>numeric_eq</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1255"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1255"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="jsonb_util.c.html#LN1255"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean <span class='Operator'>== </span><a href="jsonb_util.c.html#LN1255"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean<span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid jsonb scalar type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"jsonb scalar type mismatch"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end equalsJsonbScalarValue &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compare two scalar JsonbValues, returning -1, 0, or 1. 
 * 
 * Strings are compared using the default collation.  Used by B-tree 
 * operators, where a lexical sort order is generally expected. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1287"></a><span class='Declare_Function'>compareJsonbScalarValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>aScalar</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bScalar</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/varlena.h.html#LN18"><span class='Ref_to_Proto'>varstr_cmp</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, 
</span>                                  <a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Delimiter'>, 
</span>                                  <a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, 
</span>                                  <a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Delimiter'>, 
</span>                                  <a href="../../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Operator'>: 
</span>                <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2018"><span class='Ref_to_Func'>numeric_cmp</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean <span class='Operator'>== </span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean<span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>aScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean <span class='Operator'>&GT; </span><a href="jsonb_util.c.html#LN1287"><span class='Ref_to_Parameter'>bScalar</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean<span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid jsonb scalar type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch aScalar-&GT;type &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if aScalar-&GT;type==bScala... &raquo; </span> 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"jsonb scalar type mismatch"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end compareJsonbScalarValue &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Functions for manipulating the resizeable buffer used by convertJsonb and 
 * its subroutines. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Reserve 'len' bytes, at the end of the buffer, enlarging it if necessary. 
 * Returns the offset to the reserved area. The caller is expected to fill 
 * the reserved area later with copyToBuffer(). 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1332"></a><span class='Declare_Function'>reserveFromBuffer</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1334"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make more room if needed */ 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN149"><span class='Ref_to_Proto'>enlargeStringInfo</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1332"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1332"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* remember current offset */ 
</span>    <a href="jsonb_util.c.html#LN1334"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1332"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* reserve the space */ 
</span>    <a href="jsonb_util.c.html#LN1332"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>+= </span><a href="jsonb_util.c.html#LN1332"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Keep a trailing null in place, even though it's not useful for us; it 
     * seems best to preserve the invariants of StringInfos. 
     */ 
</span>    <a href="jsonb_util.c.html#LN1332"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN1332"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN1334"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end reserveFromBuffer &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Copy 'len' bytes to a previously reserved area in buffer. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1358"></a><span class='Declare_Function'>copyToBuffer</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>offset</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    memcpy<span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1358"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN1358"><span class='Ref_to_Parameter'>offset</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1358"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1358"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * A shorthand for reserveFromBuffer + copyToBuffer. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1367"></a><span class='Declare_Function'>appendToBuffer</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1369"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN1369"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN46"><span class='Ref_to_Proto'>reserveFromBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1367"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1367"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonb_util.c.html#LN48"><span class='Ref_to_Proto'>copyToBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1367"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1369"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1367"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1367"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Append padding, so that the length of the StringInfo is int-aligned. 
 * Returns the number of padding bytes appended. 
 */ 
</span><span class='Keyword'>static short 
</span><a name="LN1381"></a><span class='Declare_Function'>padBufferToInt</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1383"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>padlen</span><span class='Delimiter'>, 
</span><a name="LN1384"></a>                <span class='Declare_Local'>p</span><span class='Delimiter'>, 
</span><a name="LN1385"></a>                <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN1383"><span class='Ref_To_Local'>padlen</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN584"><span class='Ref_to_Macro'>INTALIGN</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1381"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="jsonb_util.c.html#LN1381"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN1385"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN46"><span class='Ref_to_Proto'>reserveFromBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1381"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1383"><span class='Ref_To_Local'>padlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* padlen must be small, so this is probably faster than a memset */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1384"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1384"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN1383"><span class='Ref_To_Local'>padlen</span></a><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1384"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="jsonb_util.c.html#LN1381"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN1385"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN1384"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN1383"><span class='Ref_To_Local'>padlen</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a JsonbValue, convert to Jsonb. The result is palloc'd. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>* 
</span><a name="LN1402"></a><span class='Declare_Function'>convertToJsonb</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1404"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buffer</span><span class='Delimiter'>; 
</span><a name="LN1405"></a>    <a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a>      <span class='Declare_Local'>jentry</span><span class='Delimiter'>; 
</span><a name="LN1406"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Should not already have binary representation */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1402"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate an output buffer. It will be enlarged as needed */ 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1404"><span class='Ref_To_Local'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make room for the varlena header */ 
</span>    <a href="jsonb_util.c.html#LN46"><span class='Ref_to_Proto'>reserveFromBuffer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1404"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN41"><span class='Ref_to_Proto'>convertJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1404"><span class='Ref_To_Local'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1405"><span class='Ref_To_Local'>jentry</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1402"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: the JEntry of the root is discarded. Therefore the root 
     * JsonbContainer struct must contain enough information to tell what kind 
     * of value it is. 
     */ 
</span> 
    <a href="jsonb_util.c.html#LN1406"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN1404"><span class='Ref_To_Local'>buffer</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1406"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1404"><span class='Ref_To_Local'>buffer</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN1406"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convertToJsonb &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Subroutine of convertJsonb: serialize a single JsonbValue into buffer. 
 * 
 * The JEntry header for this node is returned in *header.  It is filled in 
 * with the length of this value and appropriate type bits.  If we wish to 
 * store an end offset rather than a length, it is the caller's responsibility 
 * to adjust for that. 
 * 
 * If the value is an array or an object, this recurses. 'level' is only used 
 * for debugging purposes. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1444"></a><span class='Declare_Function'>convertJsonbValue</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>header</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * A JsonbValue passed as val should never have a type of jbvBinary, and 
     * neither should any of its sub-components. Those values will be produced 
     * by convertJsonbArray and convertJsonbObject, the results of which will 
     * not be passed back to this function as an argument. 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN282"><span class='Ref_to_Macro'>IsAJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>))</span> 
        <a href="jsonb_util.c.html#LN44"><span class='Ref_to_Proto'>convertJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>header</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Parentheses'>) 
</span>        <a href="jsonb_util.c.html#LN42"><span class='Ref_to_Proto'>convertJsonbArray</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>header</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Parentheses'>) 
</span>        <a href="jsonb_util.c.html#LN43"><span class='Ref_to_Proto'>convertJsonbObject</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>header</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1444"><span class='Ref_to_Parameter'>level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unknown type of jsonb container to convert"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convertJsonbValue &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1469"></a><span class='Declare_Function'>convertJsonbArray</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pheader</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1471"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>base_offset</span><span class='Delimiter'>; 
</span><a name="LN1472"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>jentry_offset</span><span class='Delimiter'>; 
</span><a name="LN1473"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1474"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>totallen</span><span class='Delimiter'>; 
</span><a name="LN1475"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>header</span><span class='Delimiter'>; 
</span><a name="LN1476"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nElems</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remember where in the buffer this array starts. */ 
</span>    <a href="jsonb_util.c.html#LN1471"><span class='Ref_To_Local'>base_offset</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Align to 4-byte boundary (any padding counts as part of my data) */ 
</span>    <a href="jsonb_util.c.html#LN49"><span class='Ref_to_Proto'>padBufferToInt</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct the header Jentry and store it in the beginning of the 
     * variable-length payload. 
     */ 
</span>    <a href="jsonb_util.c.html#LN1475"><span class='Ref_To_Local'>header</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1476"><span class='Ref_To_Local'>nElems</span></a> <span class='Operator'>| </span><a href="../../../include/utils/jsonb.h.html#LN205"><span class='Ref_to_Const'>JB_FARRAY</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1476"><span class='Ref_To_Local'>nElems</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN1475"><span class='Ref_To_Local'>header</span></a> <span class='Operator'>|= </span><a href="../../../include/utils/jsonb.h.html#LN203"><span class='Ref_to_Const'>JB_FSCALAR</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonb_util.c.html#LN47"><span class='Ref_to_Proto'>appendToBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1475"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reserve space for the JEntries of the elements. */ 
</span>    <a href="jsonb_util.c.html#LN1472"><span class='Ref_To_Local'>jentry_offset</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN46"><span class='Ref_to_Proto'>reserveFromBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonb_util.c.html#LN1476"><span class='Ref_To_Local'>nElems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN1474"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1473"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1473"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN1476"><span class='Ref_To_Local'>nElems</span></a><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1473"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1504"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>elem</span> <span class='Operator'>= &</span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>elems<span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN1473"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN1505"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1506"></a>        <a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a>      <span class='Declare_Local'>meta</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Convert element, producing a JEntry and appending its 
         * variable-length data to buffer 
         */ 
</span>        <a href="jsonb_util.c.html#LN41"><span class='Ref_to_Proto'>convertJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1506"><span class='Ref_To_Local'>meta</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1504"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonb_util.c.html#LN1505"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN153"><span class='Ref_to_Macro'>JBE_OFFLENFLD</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1506"><span class='Ref_To_Local'>meta</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN1474"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>+= </span><a href="jsonb_util.c.html#LN1505"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Bail out if total variable-length data exceeds what will fit in a 
         * JEntry length field.  We check this in each iteration, not just 
         * once at the end, to forestall possible integer overflow. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1474"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"total size of jsonb array elements exceeds the maximum of %u bytes"</span><span class='Delimiter'>, 
</span>                            <a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Convert each JB_OFFSET_STRIDE'th length to an offset. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonb_util.c.html#LN1473"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>% </span><a href="../../../include/utils/jsonb.h.html#LN180"><span class='Ref_to_Const'>JB_OFFSET_STRIDE</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="jsonb_util.c.html#LN1506"><span class='Ref_To_Local'>meta</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1506"><span class='Ref_To_Local'>meta</span></a> <span class='Operator'>& </span><a href="../../../include/utils/jsonb.h.html#LN141"><span class='Ref_to_Const'>JENTRY_TYPEMASK</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="jsonb_util.c.html#LN1474"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>| </span><a href="../../../include/utils/jsonb.h.html#LN142"><span class='Ref_to_Const'>JENTRY_HAS_OFF</span></a><span class='Delimiter'>; 
</span> 
        <a href="jsonb_util.c.html#LN48"><span class='Ref_to_Proto'>copyToBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1472"><span class='Ref_To_Local'>jentry_offset</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1506"><span class='Ref_To_Local'>meta</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN1472"><span class='Ref_To_Local'>jentry_offset</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nElems;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Total data size is everything we've appended to buffer */ 
</span>    <a href="jsonb_util.c.html#LN1474"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="jsonb_util.c.html#LN1471"><span class='Ref_To_Local'>base_offset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check length again, since we didn't include the metadata above */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1474"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"total size of jsonb array elements exceeds the maximum of %u bytes"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize the header of this node in the container's JEntry array */ 
</span>    <span class='Operator'>*</span><a href="jsonb_util.c.html#LN1469"><span class='Ref_to_Parameter'>pheader</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN150"><span class='Ref_to_Const'>JENTRY_ISCONTAINER</span></a> <span class='Operator'>| </span><a href="jsonb_util.c.html#LN1474"><span class='Ref_To_Local'>totallen</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convertJsonbArray &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1553"></a><span class='Declare_Function'>convertJsonbObject</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pheader</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1555"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>base_offset</span><span class='Delimiter'>; 
</span><a name="LN1556"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>jentry_offset</span><span class='Delimiter'>; 
</span><a name="LN1557"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1558"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>totallen</span><span class='Delimiter'>; 
</span><a name="LN1559"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>header</span><span class='Delimiter'>; 
</span><a name="LN1560"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nPairs</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remember where in the buffer this object starts. */ 
</span>    <a href="jsonb_util.c.html#LN1555"><span class='Ref_To_Local'>base_offset</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Align to 4-byte boundary (any padding counts as part of my data) */ 
</span>    <a href="jsonb_util.c.html#LN49"><span class='Ref_to_Proto'>padBufferToInt</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Construct the header Jentry and store it in the beginning of the 
     * variable-length payload. 
     */ 
</span>    <a href="jsonb_util.c.html#LN1559"><span class='Ref_To_Local'>header</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1560"><span class='Ref_To_Local'>nPairs</span></a> <span class='Operator'>| </span><a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Delimiter'>; 
</span>    <a href="jsonb_util.c.html#LN47"><span class='Ref_to_Proto'>appendToBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1559"><span class='Ref_To_Local'>header</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reserve space for the JEntries of the keys and values. */ 
</span>    <a href="jsonb_util.c.html#LN1556"><span class='Ref_To_Local'>jentry_offset</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN46"><span class='Ref_to_Proto'>reserveFromBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonb_util.c.html#LN1560"><span class='Ref_To_Local'>nPairs</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Iterate over the keys, then over the values, since that is the ordering 
     * we want in the on-disk representation. 
     */ 
</span>    <a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN1560"><span class='Ref_To_Local'>nPairs</span></a><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1585"></a>        <a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>pair</span> <span class='Operator'>= &</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs<span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN1586"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1587"></a>        <a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a>      <span class='Declare_Local'>meta</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Convert key, producing a JEntry and appending its variable-length 
         * data to buffer 
         */ 
</span>        <a href="jsonb_util.c.html#LN44"><span class='Ref_to_Proto'>convertJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1587"><span class='Ref_To_Local'>meta</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1585"><span class='Ref_To_Local'>pair</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN297"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonb_util.c.html#LN1586"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN153"><span class='Ref_to_Macro'>JBE_OFFLENFLD</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1587"><span class='Ref_To_Local'>meta</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>+= </span><a href="jsonb_util.c.html#LN1586"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Bail out if total variable-length data exceeds what will fit in a 
         * JEntry length field.  We check this in each iteration, not just 
         * once at the end, to forestall possible integer overflow. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"total size of jsonb object elements exceeds the maximum of %u bytes"</span><span class='Delimiter'>, 
</span>                            <a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Convert each JB_OFFSET_STRIDE'th length to an offset. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>% </span><a href="../../../include/utils/jsonb.h.html#LN180"><span class='Ref_to_Const'>JB_OFFSET_STRIDE</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="jsonb_util.c.html#LN1587"><span class='Ref_To_Local'>meta</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1587"><span class='Ref_To_Local'>meta</span></a> <span class='Operator'>& </span><a href="../../../include/utils/jsonb.h.html#LN141"><span class='Ref_to_Const'>JENTRY_TYPEMASK</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>| </span><a href="../../../include/utils/jsonb.h.html#LN142"><span class='Ref_to_Const'>JENTRY_HAS_OFF</span></a><span class='Delimiter'>; 
</span> 
        <a href="jsonb_util.c.html#LN48"><span class='Ref_to_Proto'>copyToBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1556"><span class='Ref_To_Local'>jentry_offset</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1587"><span class='Ref_To_Local'>meta</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN1556"><span class='Ref_To_Local'>jentry_offset</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nPairs;i++ &raquo; </span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN1560"><span class='Ref_To_Local'>nPairs</span></a><span class='Delimiter'>; </span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1620"></a>        <a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>pair</span> <span class='Operator'>= &</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs<span class='Delimiter'>[</span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN1621"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1622"></a>        <a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a>      <span class='Declare_Local'>meta</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Convert value, producing a JEntry and appending its variable-length 
         * data to buffer 
         */ 
</span>        <a href="jsonb_util.c.html#LN41"><span class='Ref_to_Proto'>convertJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1622"><span class='Ref_To_Local'>meta</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1620"><span class='Ref_To_Local'>pair</span></a><span class='Operator'>-&GT;</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonb_util.c.html#LN1621"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN153"><span class='Ref_to_Macro'>JBE_OFFLENFLD</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1622"><span class='Ref_To_Local'>meta</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>+= </span><a href="jsonb_util.c.html#LN1621"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Bail out if total variable-length data exceeds what will fit in a 
         * JEntry length field.  We check this in each iteration, not just 
         * once at the end, to forestall possible integer overflow. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"total size of jsonb object elements exceeds the maximum of %u bytes"</span><span class='Delimiter'>, 
</span>                            <a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Convert each JB_OFFSET_STRIDE'th length to an offset. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="jsonb_util.c.html#LN1557"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN1560"><span class='Ref_To_Local'>nPairs</span></a><span class='Parentheses'>) </span><span class='Operator'>% </span><a href="../../../include/utils/jsonb.h.html#LN180"><span class='Ref_to_Const'>JB_OFFSET_STRIDE</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="jsonb_util.c.html#LN1622"><span class='Ref_To_Local'>meta</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1622"><span class='Ref_To_Local'>meta</span></a> <span class='Operator'>& </span><a href="../../../include/utils/jsonb.h.html#LN141"><span class='Ref_to_Const'>JENTRY_TYPEMASK</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>| </span><a href="../../../include/utils/jsonb.h.html#LN142"><span class='Ref_to_Const'>JENTRY_HAS_OFF</span></a><span class='Delimiter'>; 
</span> 
        <a href="jsonb_util.c.html#LN48"><span class='Ref_to_Proto'>copyToBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1556"><span class='Ref_To_Local'>jentry_offset</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1622"><span class='Ref_To_Local'>meta</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonb_util.c.html#LN1556"><span class='Ref_To_Local'>jentry_offset</span></a> <span class='Operator'>+= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nPairs;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Total data size is everything we've appended to buffer */ 
</span>    <a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>buffer</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="jsonb_util.c.html#LN1555"><span class='Ref_To_Local'>base_offset</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check length again, since we didn't include the metadata above */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a> <span class='Operator'>&GT; </span><a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"total size of jsonb object elements exceeds the maximum of %u bytes"</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/utils/jsonb.h.html#LN140"><span class='Ref_to_Const'>JENTRY_OFFLENMASK</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize the header of this node in the container's JEntry array */ 
</span>    <span class='Operator'>*</span><a href="jsonb_util.c.html#LN1553"><span class='Ref_to_Parameter'>pheader</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN150"><span class='Ref_to_Const'>JENTRY_ISCONTAINER</span></a> <span class='Operator'>| </span><a href="jsonb_util.c.html#LN1558"><span class='Ref_To_Local'>totallen</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end convertJsonbObject &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1669"></a><span class='Declare_Function'>convertJsonbScalar</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buffer</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN138"><span class='Ref_to_Typedef'>JEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jentry</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>scalarVal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1671"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numlen</span><span class='Delimiter'>; 
</span><a name="LN1672"></a>    <span class='Keyword'>short</span>       <span class='Declare_Local'>padlen</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>jentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN149"><span class='Ref_to_Const'>JENTRY_ISNULL</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Operator'>: 
</span>            <a href="jsonb_util.c.html#LN47"><span class='Ref_to_Proto'>appendToBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>jentry</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Operator'>: 
</span>            <a href="jsonb_util.c.html#LN1671"><span class='Ref_To_Local'>numlen</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonb_util.c.html#LN1672"><span class='Ref_To_Local'>padlen</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN49"><span class='Ref_to_Proto'>padBufferToInt</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>buffer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="jsonb_util.c.html#LN47"><span class='Ref_to_Proto'>appendToBuffer</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>buffer</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1671"><span class='Ref_To_Local'>numlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>jentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN146"><span class='Ref_to_Const'>JENTRY_ISNUMERIC</span></a> <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1672"><span class='Ref_To_Local'>padlen</span></a> <span class='Operator'>+ </span><a href="jsonb_util.c.html#LN1671"><span class='Ref_To_Local'>numlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>jentry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1669"><span class='Ref_to_Parameter'>scalarVal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean<span class='Parentheses'>) </span><span class='Operator'>? 
</span>                <a href="../../../include/utils/jsonb.h.html#LN148"><span class='Ref_to_Const'>JENTRY_ISBOOL_TRUE</span></a> <span class='Operator'>: </span><a href="../../../include/utils/jsonb.h.html#LN147"><span class='Ref_to_Const'>JENTRY_ISBOOL_FALSE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid jsonb scalar type"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch scalarVal-&GT;type &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end convertJsonbScalar &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compare two jbvString JsonbValue values, a and b. 
 * 
 * This is a special qsort() comparator used to sort strings in certain 
 * internal contexts where it is sufficient to have a well-defined sort order. 
 * In particular, object pair keys are sorted according to this criteria to 
 * facilitate cheap binary searches where we don't care about lexical sort 
 * order. 
 * 
 * a and b are first sorted based on their length.  If a tie-breaker is 
 * required, only then do we consider string binary equality. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1718"></a><span class='Declare_Function'>lengthCompareJsonbStringValue</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1720"></a>    <span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>va</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN1718"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN1721"></a>    <span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>vb</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN1718"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span><a name="LN1722"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1720"><span class='Ref_To_Local'>va</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1721"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1720"><span class='Ref_To_Local'>va</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>== </span><a href="jsonb_util.c.html#LN1721"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN1722"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1720"><span class='Ref_To_Local'>va</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1721"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1720"><span class='Ref_To_Local'>va</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonb_util.c.html#LN1722"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1720"><span class='Ref_To_Local'>va</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>&GT; </span><a href="jsonb_util.c.html#LN1721"><span class='Ref_To_Local'>vb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN1722"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end lengthCompareJsonbStringValue &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * qsort_arg() comparator to compare JsonbPair values. 
 * 
 * Third argument 'binequal' may point to a bool. If it's set, *binequal is set 
 * to true iff a and b have full binary equality, since some callers have an 
 * interest in whether the two values are equal or merely equivalent. 
 * 
 * N.B: String comparisons here are "length-wise" 
 * 
 * Pairs with equals keys are ordered such that the order field is respected. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1751"></a><span class='Declare_Function'>lengthCompareJsonbPair</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>binequal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1753"></a>    <span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pa</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN1751"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN1754"></a>    <span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pb</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN1751"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span><a name="LN1755"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="jsonb_util.c.html#LN1755"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN57"><span class='Ref_to_Proto'>lengthCompareJsonbStringValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1753"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN297"><span class='Ref_to_Member'>key</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1754"><span class='Ref_To_Local'>pb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN297"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1755"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonb_util.c.html#LN1751"><span class='Ref_to_Parameter'>binequal</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonb_util.c.html#LN1751"><span class='Ref_to_Parameter'>binequal</span></a><span class='Parentheses'>)</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Guarantee keeping order of equal pair.  Unique algorithm will prefer 
     * first element as value. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1755"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="jsonb_util.c.html#LN1755"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1753"><span class='Ref_To_Local'>pa</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN299"><span class='Ref_to_Member'>order</span></a> <span class='Operator'>&GT; </span><a href="jsonb_util.c.html#LN1754"><span class='Ref_To_Local'>pb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN299"><span class='Ref_to_Member'>order</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN1755"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end lengthCompareJsonbPair &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Sort and unique-ify pairs in JsonbValue object 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1775"></a><span class='Declare_Function'>uniqueifyJsonbObject</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>object</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1777"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>hasNonUniq</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs<span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="jsonb_util.c.html#LN58"><span class='Ref_to_Proto'>lengthCompareJsonbPair</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonb_util.c.html#LN1777"><span class='Ref_To_Local'>hasNonUniq</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1777"><span class='Ref_To_Local'>hasNonUniq</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1787"></a>        <a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN1788"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs<span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1787"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs <span class='Operator'>&LT; </span><a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Avoid copying over duplicate */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN57"><span class='Ref_to_Proto'>lengthCompareJsonbStringValue</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1787"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1788"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="jsonb_util.c.html#LN1788"><span class='Ref_To_Local'>res</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1787"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>!= </span><a href="jsonb_util.c.html#LN1788"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>                    memcpy<span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN1788"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="jsonb_util.c.html#LN1787"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN295"><span class='Ref_to_Struct'>JsonbPair</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="jsonb_util.c.html#LN1787"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs <span class='Operator'>= </span><a href="jsonb_util.c.html#LN1788"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>- </span><a href="jsonb_util.c.html#LN1775"><span class='Ref_to_Parameter'>object</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>pairs<span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end uniqueifyJsonbObject &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>