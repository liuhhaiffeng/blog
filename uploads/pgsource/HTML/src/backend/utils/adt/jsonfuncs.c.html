<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\jsonfuncs.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\jsonfuncs.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:52 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * jsonfuncs.c 
 *      Functions to process JSON data types. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/jsonfuncs.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"fmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/stringinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/hsearch.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/json.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/jsonapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/jsonb.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
<span class='Comment_Multi_Line'>/* Operations available for setPath */ 
</span><a name="LN37"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>JB_PATH_CREATE</span>                  <span class='Number'>0x0001</span> 
<a name="LN38"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>JB_PATH_DELETE</span>                  <span class='Number'>0x0002</span> 
<a name="LN39"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>JB_PATH_REPLACE</span>                 <span class='Number'>0x0004</span> 
<a name="LN40"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>JB_PATH_INSERT_BEFORE</span>           <span class='Number'>0x0008</span> 
<a name="LN41"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>JB_PATH_INSERT_AFTER</span>            <span class='Number'>0x0010</span> 
<a name="LN42"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>JB_PATH_CREATE_OR_INSERT</span> <span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN40"><span class='Ref_to_Const'>JB_PATH_INSERT_BEFORE</span></a> <span class='Operator'>| </span><a href="jsonfuncs.c.html#LN41"><span class='Ref_to_Const'>JB_PATH_INSERT_AFTER</span></a> <span class='Operator'>| </span><a href="jsonfuncs.c.html#LN37"><span class='Ref_to_Const'>JB_PATH_CREATE</span></a><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* state for json_object_keys */ 
</span><a name="LN46"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>OkeysState</span> 
<span class='Delimiter'>{ 
</span><a name="LN48"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN49"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Member'>result</span><span class='Delimiter'>; 
</span><a name="LN50"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>result_size</span><span class='Delimiter'>; 
</span><a name="LN51"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>result_count</span><span class='Delimiter'>; 
</span><a name="LN52"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>sent_count</span><span class='Delimiter'>; 
</span><a name="LN53"></a>} <span class='Declare_Typedef'>OkeysState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* state for iterate_json_string_values function */ 
</span><a name="LN56"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>IterateJsonStringValuesState</span> 
<span class='Delimiter'>{ 
</span><a name="LN58"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN59"></a>    <a href="../../../include/utils/jsonapi.h.html#LN135"><span class='Ref_to_Typedef'>JsonIterateStringValuesAction</span></a> <span class='Declare_Member'>action</span><span class='Delimiter'>;</span>       <span class='Comment_Multi_Line'>/* an action that will be 
                                                 * applied to each json value */ 
</span><a name="LN61"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>action_state</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* any necessary context for iteration */ 
</span><a name="LN62"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>IterateJsonStringValuesState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* state for transform_json_string_values function */ 
</span><a name="LN65"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>TransformJsonStringValuesState</span> 
<span class='Delimiter'>{ 
</span><a name="LN67"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN68"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Member'>strval</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* resulting json */ 
</span><a name="LN69"></a>    <a href="../../../include/utils/jsonapi.h.html#LN138"><span class='Ref_to_Typedef'>JsonTransformStringValuesAction</span></a> <span class='Declare_Member'>action</span><span class='Delimiter'>;</span>     <span class='Comment_Multi_Line'>/* an action that will be 
                                                 * applied to each json value */ 
</span><a name="LN71"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>action_state</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* any necessary context for transformation */ 
</span><a name="LN72"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TransformJsonStringValuesState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* state for json_get* functions */ 
</span><a name="LN75"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>GetState</span> 
<span class='Delimiter'>{ 
</span><a name="LN77"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN78"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>tresult</span><span class='Delimiter'>; 
</span><a name="LN79"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>result_start</span><span class='Delimiter'>; 
</span><a name="LN80"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>normalize_results</span><span class='Delimiter'>; 
</span><a name="LN81"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>next_scalar</span><span class='Delimiter'>; 
</span><a name="LN82"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>npath</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* length of each path-related array */ 
</span><a name="LN83"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Member'>path_names</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* field name(s) being sought */ 
</span><a name="LN84"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>path_indexes</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* array index(es) being sought */ 
</span><a name="LN85"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>pathok</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* is path matched to current depth? */ 
</span><a name="LN86"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>array_cur_index</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* current element index at each path level */ 
</span><a name="LN87"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>GetState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* state for json_array_length */ 
</span><a name="LN90"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>AlenState</span> 
<span class='Delimiter'>{ 
</span><a name="LN92"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN93"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>count</span><span class='Delimiter'>; 
</span><a name="LN94"></a>} <span class='Declare_Typedef'>AlenState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* state for json_each */ 
</span><a name="LN97"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>EachState</span> 
<span class='Delimiter'>{ 
</span><a name="LN99"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN100"></a>    <a href="../sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Member'>tuple_store</span><span class='Delimiter'>; 
</span><a name="LN101"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Member'>ret_tdesc</span><span class='Delimiter'>; 
</span><a name="LN102"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>tmp_cxt</span><span class='Delimiter'>; 
</span><a name="LN103"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>result_start</span><span class='Delimiter'>; 
</span><a name="LN104"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>normalize_results</span><span class='Delimiter'>; 
</span><a name="LN105"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>next_scalar</span><span class='Delimiter'>; 
</span><a name="LN106"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>normalized_scalar</span><span class='Delimiter'>; 
</span><a name="LN107"></a>} <span class='Declare_Typedef'>EachState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* state for json_array_elements */ 
</span><a name="LN110"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ElementsState</span> 
<span class='Delimiter'>{ 
</span><a name="LN112"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN113"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>function_name</span><span class='Delimiter'>; 
</span><a name="LN114"></a>    <a href="../sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Member'>tuple_store</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Member'>ret_tdesc</span><span class='Delimiter'>; 
</span><a name="LN116"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>tmp_cxt</span><span class='Delimiter'>; 
</span><a name="LN117"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>result_start</span><span class='Delimiter'>; 
</span><a name="LN118"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>normalize_results</span><span class='Delimiter'>; 
</span><a name="LN119"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>next_scalar</span><span class='Delimiter'>; 
</span><a name="LN120"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>normalized_scalar</span><span class='Delimiter'>; 
</span><a name="LN121"></a>} <span class='Declare_Typedef'>ElementsState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* state for get_json_object_as_hash */ 
</span><a name="LN124"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>JHashState</span> 
<span class='Delimiter'>{ 
</span><a name="LN126"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN127"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>function_name</span><span class='Delimiter'>; 
</span><a name="LN128"></a>    <a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>hash</span><span class='Delimiter'>; 
</span><a name="LN129"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>saved_scalar</span><span class='Delimiter'>; 
</span><a name="LN130"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>save_json_start</span><span class='Delimiter'>; 
</span><a name="LN131"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Member'>saved_token_type</span><span class='Delimiter'>; 
</span><a name="LN132"></a>} <span class='Declare_Typedef'>JHashState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* hashtable element */ 
</span><a name="LN135"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>JsonHashEntry</span> 
<span class='Delimiter'>{ 
</span><a name="LN137"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>fname</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>];</span>     <span class='Comment_Single_Line'>/* hash key (MUST BE FIRST) */ 
</span><a name="LN138"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>val</span><span class='Delimiter'>; 
</span><a name="LN139"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Member'>type</span><span class='Delimiter'>; 
</span><a name="LN140"></a>} <span class='Declare_Typedef'>JsonHashEntry</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* structure to cache type I/O metadata needed for populate_scalar() */ 
</span><a name="LN143"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ScalarIOData</span> 
<span class='Delimiter'>{ 
</span><a name="LN145"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>typioparam</span><span class='Delimiter'>; 
</span><a name="LN146"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Member'>typiofunc</span><span class='Delimiter'>; 
</span><a name="LN147"></a>} <span class='Declare_Typedef'>ScalarIOData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* these two structures are used recursively */ 
</span><a name="LN150"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Declare_Typedef'>ColumnIOData</span><span class='Delimiter'>; 
</span><a name="LN151"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Declare_Typedef'>RecordIOData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* structure to cache metadata needed for populate_array() */ 
</span><a name="LN154"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>ArrayIOData</span> 
<span class='Delimiter'>{ 
</span><a name="LN156"></a>    <a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Operator'>*</span><span class='Declare_Member'>element_info</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* metadata cache */ 
</span><a name="LN157"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>element_type</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* array element type id */ 
</span><a name="LN158"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>element_typmod</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* array element type modifier */ 
</span><a name="LN159"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>ArrayIOData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* structure to cache metadata needed for populate_composite() */ 
</span><a name="LN162"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>CompositeIOData</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * We use pointer to a RecordIOData here because variable-length struct 
     * RecordIOData can't be used directly in ColumnIOData.io union 
     */ 
</span><a name="LN168"></a>    <a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Declare_Member'>record_io</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* metadata cache for populate_record() */ 
</span><a name="LN169"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Member'>tupdesc</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* cached tuple descriptor */ 
</span><a name="LN170"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>CompositeIOData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* structure to cache metadata needed for populate_domain() */ 
</span><a name="LN173"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>DomainIOData</span> 
<span class='Delimiter'>{ 
</span><a name="LN175"></a>    <a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Operator'>*</span><span class='Declare_Member'>base_io</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* metadata cache */ 
</span><a name="LN176"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>base_typid</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* base type id */ 
</span><a name="LN177"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>base_typmod</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* base type modifier */ 
</span><a name="LN178"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>domain_info</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* opaque cache for domain checks */ 
</span><a name="LN179"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>DomainIOData</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* enumeration type categories */ 
</span><a name="LN182"></a><span class='Control'>typedef</span> <span class='Control'>enum</span> <span class='Declare_Enum'>TypeCat</span> 
<span class='Delimiter'>{ 
</span><a name="LN184"></a>    <span class='Declare_Enum_Const'>TYPECAT_SCALAR</span> <span class='Operator'>= </span><span class='String'>'s'</span><span class='Delimiter'>, 
</span><a name="LN185"></a>    <span class='Declare_Enum_Const'>TYPECAT_ARRAY</span> <span class='Operator'>= </span><span class='String'>'a'</span><span class='Delimiter'>, 
</span><a name="LN186"></a>    <span class='Declare_Enum_Const'>TYPECAT_COMPOSITE</span> <span class='Operator'>= </span><span class='String'>'c'</span><span class='Delimiter'>, 
</span><a name="LN187"></a>    <span class='Declare_Enum_Const'>TYPECAT_DOMAIN</span> <span class='Operator'>= </span><span class='String'>'d'</span> 
<a name="LN188"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TypeCat</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* these two are stolen from hstore / record_out, used in populate_record* */ 
</span> 
<span class='Comment_Multi_Line'>/* structure to cache record metadata needed for populate_record_field() */ 
</span><a name="LN193"></a><span class='Control'>struct</span> <span class='Declare_Struct'>ColumnIOData</span> 
<span class='Delimiter'>{ 
</span><a name="LN195"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>typid</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* column type id */ 
</span><a name="LN196"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>typmod</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* column type modifier */ 
</span><a name="LN197"></a>    <a href="jsonfuncs.c.html#LN182"><span class='Ref_to_Enum'>TypeCat</span></a>     <span class='Declare_Member'>typcat</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* column type category */ 
</span><a name="LN198"></a>    <a href="jsonfuncs.c.html#LN143"><span class='Ref_to_Struct'>ScalarIOData</span></a> <span class='Declare_Member'>scalar_io</span><span class='Delimiter'>;</span>     <span class='Comment_Multi_Line'>/* metadata cache for directi conversion 
                                 * through input function */ 
</span>    <span class='Control'>union</span> 
    <span class='Delimiter'>{ 
</span><a name="LN202"></a>        <a href="jsonfuncs.c.html#LN154"><span class='Ref_to_Struct'>ArrayIOData</span></a> <span class='Declare_Member'>array</span><span class='Delimiter'>; 
</span><a name="LN203"></a>        <a href="jsonfuncs.c.html#LN162"><span class='Ref_to_Struct'>CompositeIOData</span></a> <span class='Declare_Member'>composite</span><span class='Delimiter'>; 
</span><a name="LN204"></a>        <a href="domains.c.html#LN46"><span class='Ref_to_Struct'>DomainIOData</span></a> <span class='Declare_Member'>domain</span><span class='Delimiter'>; 
</span><a name="LN205"></a>    <span class='Delimiter'>}</span>           <span class='Declare_Member'>io</span><span class='Delimiter'>;</span>             <span class='Comment_Multi_Line'>/* metadata cache for various column type 
                                 * categories */ 
</span><span class='Delimiter'>}; 
</span> 
<span class='Comment_Multi_Line'>/* structure to cache record metadata needed for populate_record() */ 
</span><a name="LN210"></a><span class='Control'>struct</span> <span class='Declare_Struct'>RecordIOData</span> 
<span class='Delimiter'>{ 
</span><a name="LN212"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>record_type</span><span class='Delimiter'>; 
</span><a name="LN213"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>record_typmod</span><span class='Delimiter'>; 
</span><a name="LN214"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>ncolumns</span><span class='Delimiter'>; 
</span><a name="LN215"></a>    <a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Declare_Member'>columns</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>]; 
}; 
</span> 
<span class='Comment_Multi_Line'>/* state for populate_recordset */ 
</span><a name="LN219"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PopulateRecordsetState</span> 
<span class='Delimiter'>{ 
</span><a name="LN221"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN222"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>function_name</span><span class='Delimiter'>; 
</span><a name="LN223"></a>    <a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>json_hash</span><span class='Delimiter'>; 
</span><a name="LN224"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>saved_scalar</span><span class='Delimiter'>; 
</span><a name="LN225"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>save_json_start</span><span class='Delimiter'>; 
</span><a name="LN226"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Member'>saved_token_type</span><span class='Delimiter'>; 
</span><a name="LN227"></a>    <a href="../sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Member'>tuple_store</span><span class='Delimiter'>; 
</span><a name="LN228"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Member'>ret_tdesc</span><span class='Delimiter'>; 
</span><a name="LN229"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Member'>rec</span><span class='Delimiter'>; 
</span><a name="LN230"></a>    <a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>**</span><span class='Declare_Member'>my_extra</span><span class='Delimiter'>; 
</span><a name="LN231"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>fn_mcxt</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* used to stash IO funcs */ 
</span><a name="LN232"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PopulateRecordsetState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* structure to cache metadata needed for populate_record_worker() */ 
</span><a name="LN235"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PopulateRecordCache</span> 
<span class='Delimiter'>{ 
</span><a name="LN237"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>argtype</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* verified row type of the first argument */ 
</span><a name="LN238"></a>    <a href="jsonfuncs.c.html#LN162"><span class='Ref_to_Struct'>CompositeIOData</span></a> <span class='Declare_Member'>io</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* metadata cache for populate_composite() */ 
</span><a name="LN239"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PopulateRecordCache</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* common data for populate_array_json() and populate_array_dim_jsonb() */ 
</span><a name="LN242"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PopulateArrayContext</span> 
<span class='Delimiter'>{ 
</span><a name="LN244"></a>    <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Member'>astate</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* array build state */ 
</span><a name="LN245"></a>    <a href="jsonfuncs.c.html#LN154"><span class='Ref_to_Struct'>ArrayIOData</span></a> <span class='Operator'>*</span><span class='Declare_Member'>aio</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* metadata cache */ 
</span><a name="LN246"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>acxt</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* array build memory context */ 
</span><a name="LN247"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>mcxt</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* cache memory context */ 
</span><a name="LN248"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Member'>colname</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* for diagnostics only */ 
</span><a name="LN249"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>dims</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* dimensions */ 
</span><a name="LN250"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>sizes</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* current dimension counters */ 
</span><a name="LN251"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>ndims</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* number of dimensions */ 
</span><a name="LN252"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PopulateArrayContext</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* state for populate_array_json() */ 
</span><a name="LN255"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>PopulateArrayState</span> 
<span class='Delimiter'>{ 
</span><a name="LN257"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* json lexer */ 
</span><a name="LN258"></a>    <a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>ctx</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* context */ 
</span><a name="LN259"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>element_start</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* start of the current array element */ 
</span><a name="LN260"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>element_scalar</span><span class='Delimiter'>; </span><span class='Comment_Multi_Line'>/* current array element token if it is a 
                                 * scalar */ 
</span><a name="LN262"></a>    <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Member'>element_type</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* current array element type */ 
</span><a name="LN263"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PopulateArrayState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* state for json_strip_nulls */ 
</span><a name="LN266"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>StripnullState</span> 
<span class='Delimiter'>{ 
</span><a name="LN268"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>lex</span><span class='Delimiter'>; 
</span><a name="LN269"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Member'>strval</span><span class='Delimiter'>; 
</span><a name="LN270"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>skip_next_null</span><span class='Delimiter'>; 
</span><a name="LN271"></a>} <span class='Declare_Typedef'>StripnullState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* structure for generalized json/jsonb value passing */ 
</span><a name="LN274"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>JsValue</span> 
<span class='Delimiter'>{ 
</span><a name="LN276"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>is_json</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* json/jsonb */ 
</span>    <span class='Control'>union</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>struct</span> 
        <span class='Delimiter'>{ 
</span><a name="LN281"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>str</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* json string */ 
</span><a name="LN282"></a>            <span class='Keyword'>int</span>         <span class='Declare_Member'>len</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* json string length or -1 if null-terminated */ 
</span><a name="LN283"></a>            <a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Member'>type</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* json type */ 
</span><a name="LN284"></a>        <span class='Delimiter'>}</span>           <span class='Declare_Member'>json</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* json value */ 
</span> 
<a name="LN286"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Member'>jsonb</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* jsonb value */ 
</span><a name="LN287"></a>    <span class='Delimiter'>}</span>           <span class='Declare_Member'>val</span><span class='Delimiter'>; 
</span><a name="LN288"></a>} <span class='Declare_Typedef'>JsValue</span><span class='Delimiter'>; 
</span> 
<a name="LN290"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>JsObject</span> 
<span class='Delimiter'>{ 
</span><a name="LN292"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>is_json</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* json/jsonb */ 
</span>    <span class='Control'>union</span> 
    <span class='Delimiter'>{ 
</span><a name="LN295"></a>        <a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>json_hash</span><span class='Delimiter'>; 
</span><a name="LN296"></a>        <a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Member'>jsonb_cont</span><span class='Delimiter'>; 
</span><a name="LN297"></a>    <span class='Delimiter'>}</span>           <span class='Declare_Member'>val</span><span class='Delimiter'>; 
</span><a name="LN298"></a>} <span class='Declare_Typedef'>JsObject</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* useful macros for testing JsValue properties */ 
</span><a name="LN301"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>JsValueIsNull</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN301"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>is_json <span class='Operator'>?</span>  <span class='Operator'>\ 
</span>        <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN301"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>json<span class='Operator'>.</span>str <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN301"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>json<span class='Operator'>.</span>type <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Parentheses'>)</span> <span class='Operator'>: \ 
</span>        <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN301"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>jsonb <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN301"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>jsonb<span class='Operator'>-&GT;</span>type <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Parentheses'>))</span> 
 
<a name="LN306"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>JsValueIsString</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN306"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>is_json <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN306"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>json<span class='Operator'>.</span>type <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a> <span class='Operator'>\ 
</span>        <span class='Operator'>: </span><span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN306"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>jsonb <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN306"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>jsonb<span class='Operator'>-&GT;</span>type <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>))</span> 
 
<a name="LN310"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>JsObjectIsEmpty</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>jso</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN310"><span class='Ref_to_Parameter'>jso</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>is_json <span class='Operator'>\ 
</span>        <span class='Operator'>? </span><a href="../../../include/utils/hsearch.h.html#LN133"><span class='Ref_to_Proto'>hash_get_num_entries</span></a><span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN310"><span class='Ref_to_Parameter'>jso</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>json_hash<span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>\ 
</span>        <span class='Operator'>: </span><span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN310"><span class='Ref_to_Parameter'>jso</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>jsonb_cont <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| \ 
</span>           <a href="../../../include/utils/jsonb.h.html#LN208"><span class='Ref_to_Macro'>JsonContainerSize</span></a><span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN310"><span class='Ref_to_Parameter'>jso</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>jsonb_cont<span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
 
<a name="LN316"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>JsObjectFree</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>jso</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN316"><span class='Ref_to_Parameter'>jso</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>is_json<span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>            <a href="../../../include/utils/hsearch.h.html#LN123"><span class='Ref_to_Proto'>hash_destroy</span></a><span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN316"><span class='Ref_to_Parameter'>jso</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>val<span class='Operator'>.</span>json_hash<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* semantic action functions for json_object_keys */ 
</span><a name="LN323"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>okeys_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN324"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>okeys_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN325"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>okeys_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* semantic action functions for json_get* functions */ 
</span><a name="LN328"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN329"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_object_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN330"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN331"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_object_field_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN332"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN333"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_array_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN334"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN335"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_array_element_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN336"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>get_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* common worker function for json getter functions */ 
</span><a name="LN339"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>get_path_all</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN340"></a><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_worker</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>tpath</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>ipath</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>npath</span><span class='Delimiter'>, 
</span><a name="LN341"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>normalize_results</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN342"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>get_jsonb_path_all</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* semantic action functions for json_array_length */ 
</span><a name="LN345"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>alen_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN346"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>alen_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN347"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>alen_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* common workers for json{b}_each* functions */ 
</span><a name="LN350"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>each_worker</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN351"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>each_worker_jsonb</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, 
</span><a name="LN352"></a>                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* semantic action functions for json_each */ 
</span><a name="LN355"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>each_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN356"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>each_object_field_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN357"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>each_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN358"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>each_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* common workers for json{b}_array_elements_* functions */ 
</span><a name="LN361"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>elements_worker</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, 
</span><a name="LN362"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN363"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>elements_worker_jsonb</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, 
</span><a name="LN364"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* semantic action functions for json_array_elements */ 
</span><a name="LN367"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>elements_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN368"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>elements_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN369"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>elements_array_element_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN370"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>elements_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* turn a json object into a hash table */ 
</span><a name="LN373"></a><span class='Keyword'>static </span><a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>get_json_object_as_hash</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* semantic actions for populate_array_json */ 
</span><a name="LN376"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN377"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_array_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN378"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN379"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_element_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN380"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* semantic action functions for get_json_object_as_hash */ 
</span><a name="LN383"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>hash_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN384"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>hash_object_field_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN385"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>hash_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN386"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>hash_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* semantic action functions for populate_recordset */ 
</span><a name="LN389"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_recordset_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN390"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_recordset_object_field_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN391"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_recordset_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN392"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_recordset_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN393"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_recordset_object_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN394"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_recordset_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN395"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_recordset_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* semantic action functions for json_strip_nulls */ 
</span><a name="LN398"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sn_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN399"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sn_object_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN400"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sn_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN401"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sn_array_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN402"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sn_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN403"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sn_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN404"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sn_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* worker functions for populate_record, to_record, populate_recordset and to_recordset */ 
</span><a name="LN407"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>populate_recordset_worker</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, 
</span><a name="LN408"></a>                          <span class='Keyword'>bool </span><span class='Declare_Parameter'>have_record_arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN409"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>populate_record_worker</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, 
</span><a name="LN410"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>have_record_arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* helper functions for populate_record[set] */ 
</span><a name="LN413"></a><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Prototype'>populate_record</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>record_p</span><span class='Delimiter'>, 
</span><a name="LN414"></a>                <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Parameter'>defaultval</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, 
</span><a name="LN415"></a>                <a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>obj</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN416"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>populate_record_field</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>col</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN417"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, 
</span><a name="LN418"></a>                      <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>defaultval</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN419"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>JsValueToJsObject</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jso</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN420"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>populate_composite</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN162"><span class='Ref_to_Struct'>CompositeIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>io</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN421"></a>                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, 
</span><a name="LN422"></a>                   <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Parameter'>defaultval</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN423"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>populate_scalar</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN143"><span class='Ref_to_Struct'>ScalarIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>io</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN424"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>prepare_column_cache</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>column</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN425"></a>                     <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>json</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN426"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>populate_record_field</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>col</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN427"></a>                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>defaultval</span><span class='Delimiter'>, 
</span><a name="LN428"></a>                      <a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN429"></a><span class='Keyword'>static </span><a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>allocate_record_info</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ncolumns</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN430"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>JsObjectGetField</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>obj</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN431"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_recordset_record</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>obj</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN432"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_json</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN433"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_dim_jsonb</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jbv</span><span class='Delimiter'>, 
</span><a name="LN434"></a>                         <span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN435"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_report_expected_array</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN436"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_assign_ndims</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndims</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN437"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_check_dimension</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN438"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>populate_array_element</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN439"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>populate_array</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN154"><span class='Ref_to_Struct'>ArrayIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>aio</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, 
</span><a name="LN440"></a>               <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN441"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>populate_domain</span><span class='Parentheses'>(</span><a href="domains.c.html#LN46"><span class='Ref_to_Struct'>DomainIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>io</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, 
</span><a name="LN442"></a>                <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Worker that takes care of common setup for us */ 
</span><a name="LN445"></a><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>findJsonbValueFromContainerLen</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>container</span><span class='Delimiter'>, 
</span><a name="LN446"></a>                               <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>flags</span><span class='Delimiter'>, 
</span><a name="LN447"></a>                               <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN448"></a>                               <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>keylen</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* functions supporting jsonb_delete, jsonb_set and jsonb_concat */ 
</span><a name="LN451"></a><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>IteratorConcat</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it1</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it2</span><span class='Delimiter'>, 
</span><a name="LN452"></a>               <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN453"></a><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>setPath</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path_elems</span><span class='Delimiter'>, 
</span><a name="LN454"></a>        <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>path_nulls</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>path_len</span><span class='Delimiter'>, 
</span><a name="LN455"></a>        <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, 
</span><a name="LN456"></a>        <span class='Keyword'>int </span><span class='Declare_Parameter'>op_type</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN457"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setPathObject</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path_elems</span><span class='Delimiter'>, 
</span><a name="LN458"></a>              <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>path_nulls</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>path_len</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, 
</span><a name="LN459"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, 
</span><a name="LN460"></a>              <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>npairs</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>op_type</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN461"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>setPathArray</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path_elems</span><span class='Delimiter'>, 
</span><a name="LN462"></a>             <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>path_nulls</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>path_len</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, 
</span><a name="LN463"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>nelems</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>op_type</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN464"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>addJsonbToParseState</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>jbps</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jb</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* function supporting iterate_json_string_values */ 
</span><a name="LN467"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>iterate_string_values_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* functions supporting transform_json_string_values */ 
</span><a name="LN470"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>transform_string_values_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN471"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>transform_string_values_object_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN472"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>transform_string_values_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN473"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>transform_string_values_array_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN474"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>transform_string_values_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN475"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>transform_string_values_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN476"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>transform_string_values_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_object_keys 
 * 
 * Returns the set of keys for the object argument. 
 * 
 * This SRF operates in value-per-call mode. It processes the 
 * object during the first call, and the keys are simply stashed 
 * in an array, whose size is expanded as necessary. This is probably 
 * safe enough for a list of keys of a single object, since they are 
 * limited in size to NAMEDATALEN and the number of keys is unlikely to 
 * be so huge that it has major memory implications. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN491"></a><span class='Declare_Function'>jsonb_object_keys</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN493"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN494"></a>    <a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN495"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN499"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN500"></a>        <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN501"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>skipNested</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN502"></a>        <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN503"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN504"></a>        <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN500"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on a scalar"</span><span class='Delimiter'>, 
</span>                            <span class='String'>"jsonb_object_keys"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN224"><span class='Ref_to_Macro'>JB_ROOT_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN500"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on an array"</span><span class='Delimiter'>, 
</span>                            <span class='String'>"jsonb_object_keys"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN493"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN499"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN493"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN50"><span class='Ref_to_Member'>result_size</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN500"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN51"><span class='Ref_to_Member'>result_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN52"><span class='Ref_to_Member'>sent_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN50"><span class='Ref_to_Member'>result_size</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN502"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN500"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN504"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN502"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN503"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN501"><span class='Ref_To_Local'>skipNested</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN501"><span class='Ref_To_Local'>skipNested</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN504"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN535"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cstr</span><span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN535"><span class='Ref_To_Local'>cstr</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN503"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN535"><span class='Ref_To_Local'>cstr</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN503"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN503"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="jsonfuncs.c.html#LN535"><span class='Ref_To_Local'>cstr</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN503"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>                <a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN51"><span class='Ref_to_Member'>result_count</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="jsonfuncs.c.html#LN535"><span class='Ref_To_Local'>cstr</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN499"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN493"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <a href="jsonfuncs.c.html#LN493"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN493"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN52"><span class='Ref_to_Member'>sent_count</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN51"><span class='Ref_to_Member'>result_count</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN553"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nxt</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN52"><span class='Ref_to_Member'>sent_count</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN493"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN553"><span class='Ref_To_Local'>nxt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* cleanup to reduce or eliminate memory leaks */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN495"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN495"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN51"><span class='Ref_to_Member'>result_count</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN495"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN495"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN494"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN493"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_object_keys &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN569"></a><span class='Declare_Function'>json_object_keys</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN571"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN572"></a>    <a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN573"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN577"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN578"></a>        <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN577"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN579"></a>        <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span><span class='Delimiter'>; 
</span><a name="LN580"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN571"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN580"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN571"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN579"><span class='Ref_To_Local'>sem</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN48"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN578"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN50"><span class='Ref_to_Member'>result_size</span></a> <span class='Operator'>= </span><span class='Number'>256</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN51"><span class='Ref_to_Member'>result_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN52"><span class='Ref_to_Member'>sent_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>256</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN579"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN579"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN86"><span class='Ref_to_Member'>array_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN324"><span class='Ref_to_Proto'>okeys_array_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN579"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN325"><span class='Ref_to_Proto'>okeys_scalar</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN579"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN88"><span class='Ref_to_Member'>object_field_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN323"><span class='Ref_to_Proto'>okeys_object_field_start</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* remainder are all NULL, courtesy of palloc0 above */ 
</span> 
        <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN578"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN579"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* keys are now in state-&GT;result */ 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN578"><span class='Ref_To_Local'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN578"><span class='Ref_To_Local'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN61"><span class='Ref_to_Member'>strval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN578"><span class='Ref_To_Local'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN579"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN580"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN571"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <a href="jsonfuncs.c.html#LN571"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN571"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN52"><span class='Ref_to_Member'>sent_count</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN51"><span class='Ref_to_Member'>result_count</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN617"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nxt</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN52"><span class='Ref_to_Member'>sent_count</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN571"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN617"><span class='Ref_To_Local'>nxt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* cleanup to reduce or eliminate memory leaks */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN573"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN573"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN51"><span class='Ref_to_Member'>result_count</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN573"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN573"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN572"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN571"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_object_keys &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN632"></a><span class='Declare_Function'>okeys_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN634"></a>    <a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN632"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* only collecting keys for the top level object */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN634"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN48"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* enlarge result array if necessary */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN634"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN51"><span class='Ref_to_Member'>result_count</span></a> <span class='Operator'>&GT;= </span><a href="jsonfuncs.c.html#LN634"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN50"><span class='Ref_to_Member'>result_size</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN634"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN50"><span class='Ref_to_Member'>result_size</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN634"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>**</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN634"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonfuncs.c.html#LN634"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN50"><span class='Ref_to_Member'>result_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* save a copy of the field name */ 
</span>    <a href="jsonfuncs.c.html#LN634"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN49"><span class='Ref_to_Member'>result</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN634"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN51"><span class='Ref_to_Member'>result_count</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN632"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end okeys_object_field_start &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN653"></a><span class='Declare_Function'>okeys_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN655"></a>    <a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN653"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* top level must be a json object */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN655"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN48"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on an array"</span><span class='Delimiter'>, 
</span>                        <span class='String'>"json_object_keys"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN666"></a><span class='Declare_Function'>okeys_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN668"></a>    <a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN46"><span class='Ref_to_Struct'>OkeysState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN666"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* top level must be a json object */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN668"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN48"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on a scalar"</span><span class='Delimiter'>, 
</span>                        <span class='String'>"json_object_keys"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * json and jsonb getter functions 
 * these implement the -&GT; -&GT;&GT; #&GT; and #&GT;&GT; operators 
 * and the json{b?}_extract_path*(json, text, ...) functions 
 */ 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN686"></a><span class='Declare_Function'>json_object_field</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN688"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN689"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN690"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fnamestr</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN689"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN691"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN691"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN340"><span class='Ref_to_Proto'>get_worker</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN688"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN690"><span class='Ref_To_Local'>fnamestr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN691"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN691"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN702"></a><span class='Declare_Function'>jsonb_object_field</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN704"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN705"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN706"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN223"><span class='Ref_to_Macro'>JB_ROOT_IS_OBJECT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN704"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN706"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN445"><span class='Ref_to_Proto'>findJsonbValueFromContainerLen</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN704"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN705"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN705"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN706"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN706"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN722"></a><span class='Declare_Function'>json_object_field_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN724"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN725"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fname</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN726"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fnamestr</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN725"><span class='Ref_To_Local'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN727"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN727"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN340"><span class='Ref_to_Proto'>get_worker</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN724"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN726"><span class='Ref_To_Local'>fnamestr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN727"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN727"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN738"></a><span class='Declare_Function'>jsonb_object_field_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN740"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN741"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN742"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN223"><span class='Ref_to_Macro'>JB_ROOT_IS_OBJECT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN740"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN742"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN445"><span class='Ref_to_Proto'>findJsonbValueFromContainerLen</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN740"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN741"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                       <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN741"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN742"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN753"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN742"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Operator'>: 
</span>                <a href="jsonfuncs.c.html#LN753"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN742"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean <span class='Operator'>? </span><span class='String'>"true"</span> <span class='Operator'>: </span><span class='String'>"false"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Operator'>: 
</span>                <a href="jsonfuncs.c.html#LN753"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN742"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN742"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Operator'>: 
</span>                <a href="jsonfuncs.c.html#LN753"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN639"><span class='Ref_to_Func'>numeric_out</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN742"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN771"></a>                    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>jtext</span> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN374"><span class='Ref_to_Proto'>JsonbToCString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN771"><span class='Ref_To_Local'>jtext</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN742"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="jsonfuncs.c.html#LN753"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN771"><span class='Ref_To_Local'>jtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN771"><span class='Ref_To_Local'>jtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized jsonb type: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN742"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch v-&GT;type &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN753"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if v!=NULL &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_object_field_text &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN789"></a><span class='Declare_Function'>json_array_element</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN791"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN792"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>element</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN793"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN793"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN340"><span class='Ref_to_Proto'>get_worker</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN791"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN792"><span class='Ref_To_Local'>element</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN793"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN793"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN804"></a><span class='Declare_Function'>jsonb_array_element</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN806"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN807"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>element</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN808"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN224"><span class='Ref_to_Macro'>JB_ROOT_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN806"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Handle negative subscript */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN807"><span class='Ref_To_Local'>element</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN816"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>nelements</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN806"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span><a href="jsonfuncs.c.html#LN807"><span class='Ref_To_Local'>element</span></a> <span class='Operator'>&GT; </span><a href="jsonfuncs.c.html#LN816"><span class='Ref_To_Local'>nelements</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="jsonfuncs.c.html#LN807"><span class='Ref_To_Local'>element</span></a> <span class='Operator'>+= </span><a href="jsonfuncs.c.html#LN816"><span class='Ref_To_Local'>nelements</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonfuncs.c.html#LN808"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN361"><span class='Ref_to_Proto'>getIthJsonbValueFromContainer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN806"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN807"><span class='Ref_To_Local'>element</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN808"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN808"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_array_element &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN832"></a><span class='Declare_Function'>json_array_element_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN834"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN835"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>element</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN836"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN836"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN340"><span class='Ref_to_Proto'>get_worker</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN834"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN835"><span class='Ref_To_Local'>element</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN836"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN836"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN847"></a><span class='Declare_Function'>jsonb_array_element_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN849"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN850"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>element</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN851"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN224"><span class='Ref_to_Macro'>JB_ROOT_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN849"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Handle negative subscript */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN850"><span class='Ref_To_Local'>element</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN859"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>nelements</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN849"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span><a href="jsonfuncs.c.html#LN850"><span class='Ref_To_Local'>element</span></a> <span class='Operator'>&GT; </span><a href="jsonfuncs.c.html#LN859"><span class='Ref_To_Local'>nelements</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="jsonfuncs.c.html#LN850"><span class='Ref_To_Local'>element</span></a> <span class='Operator'>+= </span><a href="jsonfuncs.c.html#LN859"><span class='Ref_To_Local'>nelements</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonfuncs.c.html#LN851"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN361"><span class='Ref_to_Proto'>getIthJsonbValueFromContainer</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN849"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN850"><span class='Ref_To_Local'>element</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN851"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN870"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN851"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Operator'>: 
</span>                <a href="jsonfuncs.c.html#LN870"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN851"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean <span class='Operator'>? </span><span class='String'>"true"</span> <span class='Operator'>: </span><span class='String'>"false"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Operator'>: 
</span>                <a href="jsonfuncs.c.html#LN870"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN851"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN851"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Operator'>: 
</span>                <a href="jsonfuncs.c.html#LN870"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN639"><span class='Ref_to_Func'>numeric_out</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN851"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN888"></a>                    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>jtext</span> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN374"><span class='Ref_to_Proto'>JsonbToCString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN888"><span class='Ref_To_Local'>jtext</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN851"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="jsonfuncs.c.html#LN870"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN888"><span class='Ref_To_Local'>jtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN888"><span class='Ref_To_Local'>jtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized jsonb type: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN851"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch v-&GT;type &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN870"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN870"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if v!=NULL &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_array_element_text &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN906"></a><span class='Declare_Function'>json_extract_path</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN339"><span class='Ref_to_Proto'>get_path_all</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN912"></a><span class='Declare_Function'>json_extract_path_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN339"><span class='Ref_to_Proto'>get_path_all</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * common routine for extract_path functions 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN921"></a><span class='Declare_Function'>get_path_all</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN923"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN924"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>path</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN925"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN926"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>pathtext</span><span class='Delimiter'>; 
</span><a name="LN927"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>pathnulls</span><span class='Delimiter'>; 
</span><a name="LN928"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>npath</span><span class='Delimiter'>; 
</span><a name="LN929"></a>    <span class='Keyword'>char</span>      <span class='Operator'>**</span><span class='Declare_Local'>tpath</span><span class='Delimiter'>; 
</span><a name="LN930"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>ipath</span><span class='Delimiter'>; 
</span><a name="LN931"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the array contains any null elements, return NULL, on the grounds 
     * that you'd have gotten NULL if any RHS value were NULL in a nested 
     * series of applications of the -&GT; operator.  (Note: because we also 
     * return NULL for error cases such as no-such-field, this is true 
     * regardless of the contents of the rest of the array.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN386"><span class='Ref_to_Proto'>array_contains_nulls</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN924"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN924"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN926"><span class='Ref_To_Local'>pathtext</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN927"><span class='Ref_To_Local'>pathnulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN928"><span class='Ref_To_Local'>npath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN929"><span class='Ref_To_Local'>tpath</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN928"><span class='Ref_To_Local'>npath</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN930"><span class='Ref_To_Local'>ipath</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN928"><span class='Ref_To_Local'>npath</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN928"><span class='Ref_To_Local'>npath</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN927"><span class='Ref_To_Local'>pathnulls</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN929"><span class='Ref_To_Local'>tpath</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN926"><span class='Ref_To_Local'>pathtext</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * we have no idea at this stage what structure the document is so 
         * just convert anything in the path that we can to an integer and set 
         * all the other integers to INT_MIN which will never match. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN929"><span class='Ref_To_Local'>tpath</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN961"></a>            <span class='Keyword'>long</span>        <span class='Declare_Local'>ind</span><span class='Delimiter'>; 
</span><a name="LN962"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span> 
            errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN961"><span class='Ref_To_Local'>ind</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN929"><span class='Ref_To_Local'>tpath</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN962"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN962"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span> <span class='Operator'>&& </span>errno <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN961"><span class='Ref_To_Local'>ind</span></a> <span class='Operator'>&LT;= </span>INT_MAX <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN961"><span class='Ref_To_Local'>ind</span></a> <span class='Operator'>&GT;= </span>INT_MIN<span class='Parentheses'>) 
</span>                <a href="jsonfuncs.c.html#LN930"><span class='Ref_To_Local'>ipath</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN961"><span class='Ref_To_Local'>ind</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="jsonfuncs.c.html#LN930"><span class='Ref_To_Local'>ipath</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span>INT_MIN<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="jsonfuncs.c.html#LN930"><span class='Ref_To_Local'>ipath</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN931"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span>INT_MIN<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;npath;i++ &raquo; </span> 
 
    <a href="jsonfuncs.c.html#LN925"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN340"><span class='Ref_to_Proto'>get_worker</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN923"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN929"><span class='Ref_To_Local'>tpath</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN930"><span class='Ref_To_Local'>ipath</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN928"><span class='Ref_To_Local'>npath</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN921"><span class='Ref_to_Parameter'>as_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN925"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN925"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_path_all &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_worker 
 * 
 * common worker for all the json getter functions 
 * 
 * json: JSON object (in text form) 
 * tpath[]: field name(s) to extract 
 * ipath[]: array index(es) (zero-based) to extract, accepts negatives 
 * npath: length of tpath[] and/or ipath[] 
 * normalize_results: true to de-escape string and null scalars 
 * 
 * tpath can be NULL, or any one tpath[] entry can be NULL, if an object 
 * field is not to be matched at that nesting level.  Similarly, ipath can 
 * be NULL, or any one ipath[] entry can be INT_MIN if an array element is 
 * not to be matched at that nesting level (a json datum should never be 
 * large enough to have -INT_MIN elements due to MaxAllocSize restriction). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN1001"></a><span class='Declare_Function'>get_worker</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, 
</span><a name="LN1002"></a>           <span class='Keyword'>char </span><span class='Operator'>**</span><span class='Declare_Parameter'>tpath</span><span class='Delimiter'>, 
</span><a name="LN1003"></a>           <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>ipath</span><span class='Delimiter'>, 
</span><a name="LN1004"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>npath</span><span class='Delimiter'>, 
</span><a name="LN1005"></a>           <span class='Keyword'>bool </span><span class='Declare_Parameter'>normalize_results</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1007"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1001"><span class='Ref_to_Parameter'>json</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1008"></a>    <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1009"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1004"><span class='Ref_to_Parameter'>npath</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1007"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* is it "_as_text" variant? */ 
</span>    <a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN80"><span class='Ref_to_Member'>normalize_results</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1005"><span class='Ref_to_Parameter'>normalize_results</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1004"><span class='Ref_to_Parameter'>npath</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN83"><span class='Ref_to_Member'>path_names</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1002"><span class='Ref_to_Parameter'>tpath</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN84"><span class='Ref_to_Member'>path_indexes</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1003"><span class='Ref_to_Parameter'>ipath</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonfuncs.c.html#LN1004"><span class='Ref_to_Parameter'>npath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN86"><span class='Ref_to_Member'>array_cur_index</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonfuncs.c.html#LN1004"><span class='Ref_to_Parameter'>npath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1004"><span class='Ref_to_Parameter'>npath</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Not all variants need all the semantic routines. Only set the ones that 
     * are actually needed for maximum efficiency. 
     */ 
</span>    <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN336"><span class='Ref_to_Proto'>get_scalar</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1004"><span class='Ref_to_Parameter'>npath</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN84"><span class='Ref_to_Member'>object_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN328"><span class='Ref_to_Proto'>get_object_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN85"><span class='Ref_to_Member'>object_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN329"><span class='Ref_to_Proto'>get_object_end</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN86"><span class='Ref_to_Member'>array_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN332"><span class='Ref_to_Proto'>get_array_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN87"><span class='Ref_to_Member'>array_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN333"><span class='Ref_to_Proto'>get_array_end</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1002"><span class='Ref_to_Parameter'>tpath</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN88"><span class='Ref_to_Member'>object_field_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN330"><span class='Ref_to_Proto'>get_object_field_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN89"><span class='Ref_to_Member'>object_field_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN331"><span class='Ref_to_Proto'>get_object_field_end</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1003"><span class='Ref_to_Parameter'>ipath</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN86"><span class='Ref_to_Member'>array_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN332"><span class='Ref_to_Proto'>get_array_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN90"><span class='Ref_to_Member'>array_element_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN334"><span class='Ref_to_Proto'>get_array_element_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN91"><span class='Ref_to_Member'>array_element_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN335"><span class='Ref_to_Proto'>get_array_element_end</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1007"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1008"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN1009"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_worker &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1057"></a><span class='Declare_Function'>get_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1059"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1057"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1060"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1059"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1060"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1059"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Special case: we should match the entire object.  We only need this 
         * at outermost level because at nested levels the match will have 
         * been started by the outer field or array element callback. 
         */ 
</span>        <a href="jsonfuncs.c.html#LN1059"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1059"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1074"></a><span class='Declare_Function'>get_object_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1076"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1074"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1077"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1076"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1077"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1076"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Special case: return the entire object */ 
</span><a name="LN1082"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1076"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a><span class='Delimiter'>; 
</span><a name="LN1083"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1076"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- </span><a href="jsonfuncs.c.html#LN1082"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN1076"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1082"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1083"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1090"></a><span class='Declare_Function'>get_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1092"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1090"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1093"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>get_next</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1094"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1094"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT;= </span><a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1094"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN83"><span class='Ref_to_Member'>path_names</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN83"><span class='Ref_to_Member'>path_names</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1094"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1090"><span class='Ref_to_Parameter'>fname</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN83"><span class='Ref_to_Member'>path_names</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1094"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1094"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* if not at end of path just mark path ok */ 
</span>            <a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1094"><span class='Ref_To_Local'>lex_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* end of path, so we want this value */ 
</span>            <a href="jsonfuncs.c.html#LN1093"><span class='Ref_To_Local'>get_next</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1093"><span class='Ref_To_Local'>get_next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* this object overrides any previous matching object */ 
</span>        <a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN80"><span class='Ref_to_Member'>normalize_results</span></a> <span class='Operator'>&& 
</span>            <a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* for as_text variants, tell get_scalar to set it for us */ 
</span>            <a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN81"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* for non-as_text variants, just note the json starting point */ 
</span>            <a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1092"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_object_field_start &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1135"></a><span class='Declare_Function'>get_object_field_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1137"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1135"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1138"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>get_last</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1139"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* same tests as in get_object_field_start */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1139"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT;= </span><a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1139"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN83"><span class='Ref_to_Member'>path_names</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN83"><span class='Ref_to_Member'>path_names</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1139"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        strcmp<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1135"><span class='Ref_to_Parameter'>fname</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN83"><span class='Ref_to_Member'>path_names</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1139"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1139"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* done with this field so reset pathok */ 
</span>            <a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1139"><span class='Ref_To_Local'>lex_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* end of path, so we want this value */ 
</span>            <a href="jsonfuncs.c.html#LN1138"><span class='Ref_To_Local'>get_last</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* for as_text scalar case, our work is already done */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1138"><span class='Ref_To_Local'>get_last</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * make a text object from the string from the prevously noted json 
         * start up to the end of the previous token (the lexer is by now 
         * ahead of us on whatever came after what we're interested in). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1135"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN80"><span class='Ref_to_Member'>normalize_results</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1172"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a><span class='Delimiter'>; 
</span><a name="LN1173"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- </span><a href="jsonfuncs.c.html#LN1172"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1172"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1173"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* this should be unnecessary but let's do it for cleanliness: */ 
</span>        <a href="jsonfuncs.c.html#LN1137"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if get_last&&_state-&GT;res... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end get_object_field_end &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1184"></a><span class='Declare_Function'>get_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1186"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1184"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1187"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1187"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Initialize counting of elements in this array */ 
</span>        <a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN86"><span class='Ref_to_Member'>array_cur_index</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1187"><span class='Ref_To_Local'>lex_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* INT_MIN value is reserved to represent invalid subscript */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN84"><span class='Ref_to_Member'>path_indexes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1187"><span class='Ref_To_Local'>lex_level</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>            <a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN84"><span class='Ref_to_Member'>path_indexes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1187"><span class='Ref_To_Local'>lex_level</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span>INT_MIN<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Negative subscript -- convert to positive-wise subscript */ 
</span><a name="LN1199"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>nelements</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN111"><span class='Ref_to_Proto'>json_count_array_elements</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span><a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN84"><span class='Ref_to_Member'>path_indexes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1187"><span class='Ref_To_Local'>lex_level</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><a href="jsonfuncs.c.html#LN1199"><span class='Ref_To_Local'>nelements</span></a><span class='Parentheses'>) 
</span>                <a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN84"><span class='Ref_to_Member'>path_indexes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1187"><span class='Ref_To_Local'>lex_level</span></a><span class='Delimiter'>] </span><span class='Operator'>+= </span><a href="jsonfuncs.c.html#LN1199"><span class='Ref_To_Local'>nelements</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1187"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Special case: we should match the entire array.  We only need this 
         * at the outermost level because at nested levels the match will have 
         * been started by the outer field or array element callback. 
         */ 
</span>        <a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1186"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_array_start &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1217"></a><span class='Declare_Function'>get_array_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1219"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1217"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1220"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1219"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1220"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1219"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Special case: return the entire array */ 
</span><a name="LN1225"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1219"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a><span class='Delimiter'>; 
</span><a name="LN1226"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1219"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- </span><a href="jsonfuncs.c.html#LN1225"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN1219"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1225"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1226"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1233"></a><span class='Declare_Function'>get_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1235"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1233"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1236"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>get_next</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1237"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Update array element counter */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1237"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT;= </span><a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN86"><span class='Ref_to_Member'>array_cur_index</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1237"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1237"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT;= </span><a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1237"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN84"><span class='Ref_to_Member'>path_indexes</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN86"><span class='Ref_to_Member'>array_cur_index</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1237"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN84"><span class='Ref_to_Member'>path_indexes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1237"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1237"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* if not at end of path just mark path ok */ 
</span>            <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1237"><span class='Ref_To_Local'>lex_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* end of path, so we want this value */ 
</span>            <a href="jsonfuncs.c.html#LN1236"><span class='Ref_To_Local'>get_next</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* same logic as for objects */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1236"><span class='Ref_To_Local'>get_next</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN80"><span class='Ref_to_Member'>normalize_results</span></a> <span class='Operator'>&& 
</span>            <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN81"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1235"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_array_element_start &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1279"></a><span class='Declare_Function'>get_array_element_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1281"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1279"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1282"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>get_last</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1283"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* same tests as in get_array_element_start */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1283"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT;= </span><a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1283"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN84"><span class='Ref_to_Member'>path_indexes</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN86"><span class='Ref_to_Member'>array_cur_index</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1283"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN84"><span class='Ref_to_Member'>path_indexes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1283"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1283"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* done with this element so reset pathok */ 
</span>            <a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN85"><span class='Ref_to_Member'>pathok</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1283"><span class='Ref_To_Local'>lex_level</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* end of path, so we want this value */ 
</span>            <a href="jsonfuncs.c.html#LN1282"><span class='Ref_To_Local'>get_last</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* same logic as for objects */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1282"><span class='Ref_To_Local'>get_last</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1279"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN80"><span class='Ref_to_Member'>normalize_results</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1310"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a><span class='Delimiter'>; 
</span><a name="LN1311"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- </span><a href="jsonfuncs.c.html#LN1310"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1310"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1311"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="jsonfuncs.c.html#LN1281"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN79"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_array_element_end &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1321"></a><span class='Declare_Function'>get_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1323"></a>    <a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN75"><span class='Ref_to_Struct'>GetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1321"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1324"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for whole-object match */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1324"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN82"><span class='Ref_to_Member'>npath</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN80"><span class='Ref_to_Member'>normalize_results</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1321"><span class='Ref_to_Parameter'>tokentype</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* we want the de-escaped string */ 
</span>            <a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN81"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN80"><span class='Ref_to_Member'>normalize_results</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1321"><span class='Ref_to_Parameter'>tokentype</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * This is a bit hokey: we will suppress whitespace after the 
             * scalar token, but not whitespace before it.  Probably not worth 
             * doing our own space-skipping to avoid that. 
             */ 
</span><a name="LN1345"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN52"><span class='Ref_to_Member'>input</span></a><span class='Delimiter'>; 
</span><a name="LN1346"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN77"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- </span><a href="jsonfuncs.c.html#LN1345"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1345"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1346"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if lex_level==0&&_state-... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN81"><span class='Ref_to_Member'>next_scalar</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* a de-escaped text value is wanted, so supply it */ 
</span>        <a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN78"><span class='Ref_to_Member'>tresult</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1321"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* make sure the next call to get_scalar doesn't overwrite it */ 
</span>        <a href="jsonfuncs.c.html#LN1323"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN81"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_scalar &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1362"></a><span class='Declare_Function'>jsonb_extract_path</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN342"><span class='Ref_to_Proto'>get_jsonb_path_all</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1368"></a><span class='Declare_Function'>jsonb_extract_path_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN342"><span class='Ref_to_Proto'>get_jsonb_path_all</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1374"></a><span class='Declare_Function'>get_jsonb_path_all</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1376"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1377"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>path</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1378"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1379"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>pathtext</span><span class='Delimiter'>; 
</span><a name="LN1380"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>pathnulls</span><span class='Delimiter'>; 
</span><a name="LN1381"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>npath</span><span class='Delimiter'>; 
</span><a name="LN1382"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN1383"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_object</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN1384"></a>                <span class='Declare_Local'>have_array</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1385"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>jbvp</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1386"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>tv</span><span class='Delimiter'>; 
</span><a name="LN1387"></a>    <a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>container</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the array contains any null elements, return NULL, on the grounds 
     * that you'd have gotten NULL if any RHS value were NULL in a nested 
     * series of applications of the -&GT; operator.  (Note: because we also 
     * return NULL for error cases such as no-such-field, this is true 
     * regardless of the contents of the rest of the array.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN386"><span class='Ref_to_Proto'>array_contains_nulls</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1377"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1377"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1379"><span class='Ref_To_Local'>pathtext</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1380"><span class='Ref_To_Local'>pathnulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1381"><span class='Ref_To_Local'>npath</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Identify whether we have object, array, or scalar at top-level */ 
</span>    <a href="jsonfuncs.c.html#LN1387"><span class='Ref_To_Local'>container</span></a> <span class='Operator'>= &</span><a href="jsonfuncs.c.html#LN1376"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN223"><span class='Ref_to_Macro'>JB_ROOT_IS_OBJECT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1376"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="jsonfuncs.c.html#LN1383"><span class='Ref_To_Local'>have_object</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN224"><span class='Ref_to_Macro'>JB_ROOT_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1376"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1376"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="jsonfuncs.c.html#LN1384"><span class='Ref_To_Local'>have_array</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN224"><span class='Ref_to_Macro'>JB_ROOT_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1376"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1376"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Extract the scalar value, if it is what we'll return */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1381"><span class='Ref_To_Local'>npath</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN361"><span class='Ref_to_Proto'>getIthJsonbValueFromContainer</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1387"><span class='Ref_To_Local'>container</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the array is empty, return the entire LHS object, on the grounds 
     * that we should do zero field or element extractions.  For the 
     * non-scalar case we can just hand back the object without much work. For 
     * the scalar case, fall through and deal with the value below the loop. 
     * (This inconsistency arises because there's no easy way to generate a 
     * JsonbValue directly for root-level containers.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1381"><span class='Ref_To_Local'>npath</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1374"><span class='Ref_to_Parameter'>as_text</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN374"><span class='Ref_to_Proto'>JsonbToCString</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                            <a href="jsonfuncs.c.html#LN1387"><span class='Ref_To_Local'>container</span></a><span class='Delimiter'>, 
</span>                                                            <a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1376"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* not text mode - just hand back the jsonb */ 
</span>            <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1376"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1382"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN1382"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN1381"><span class='Ref_To_Local'>npath</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN1382"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1383"><span class='Ref_To_Local'>have_object</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN445"><span class='Ref_to_Proto'>findJsonbValueFromContainerLen</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1387"><span class='Ref_To_Local'>container</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1379"><span class='Ref_To_Local'>pathtext</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1382"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1379"><span class='Ref_To_Local'>pathtext</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1382"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1384"><span class='Ref_To_Local'>have_array</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1451"></a>            <span class='Keyword'>long</span>        <span class='Declare_Local'>lindex</span><span class='Delimiter'>; 
</span><a name="LN1452"></a>            <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>index</span><span class='Delimiter'>; 
</span><a name="LN1453"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>indextext</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1379"><span class='Ref_To_Local'>pathtext</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN1382"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1454"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span> 
            errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN1451"><span class='Ref_To_Local'>lindex</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1453"><span class='Ref_To_Local'>indextext</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1454"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1454"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN1453"><span class='Ref_To_Local'>indextext</span></a> <span class='Operator'>|| *</span><a href="jsonfuncs.c.html#LN1454"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>|| </span>errno <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <a href="jsonfuncs.c.html#LN1451"><span class='Ref_To_Local'>lindex</span></a> <span class='Operator'>&GT; </span>INT_MAX <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN1451"><span class='Ref_To_Local'>lindex</span></a> <span class='Operator'>&LT; </span>INT_MIN<span class='Parentheses'>) 
</span>                <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1451"><span class='Ref_To_Local'>lindex</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="jsonfuncs.c.html#LN1452"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1451"><span class='Ref_To_Local'>lindex</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Handle negative subscript */ 
</span><a name="LN1469"></a>                <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>nelements</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Container must be array, but make sure */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN211"><span class='Ref_to_Macro'>JsonContainerIsArray</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1387"><span class='Ref_To_Local'>container</span></a><span class='Parentheses'>))</span> 
                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"not a jsonb array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN1469"><span class='Ref_To_Local'>nelements</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN208"><span class='Ref_to_Macro'>JsonContainerSize</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1387"><span class='Ref_To_Local'>container</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span><a href="jsonfuncs.c.html#LN1451"><span class='Ref_To_Local'>lindex</span></a> <span class='Operator'>&GT; </span><a href="jsonfuncs.c.html#LN1469"><span class='Ref_To_Local'>nelements</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="jsonfuncs.c.html#LN1452"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1469"><span class='Ref_To_Local'>nelements</span></a> <span class='Operator'>+ </span><a href="jsonfuncs.c.html#LN1451"><span class='Ref_To_Local'>lindex</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN361"><span class='Ref_to_Proto'>getIthJsonbValueFromContainer</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1387"><span class='Ref_To_Local'>container</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1452"><span class='Ref_To_Local'>index</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if have_array &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* scalar, extraction yields a null */ 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1382"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN1381"><span class='Ref_To_Local'>npath</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1498"></a>            <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>((</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1499"></a>            <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN1499"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1498"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1386"><span class='Ref_To_Local'>tv</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN1387"><span class='Ref_To_Local'>container</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN1383"><span class='Ref_To_Local'>have_object</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1499"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN1384"><span class='Ref_To_Local'>have_array</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1499"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN1383"><span class='Ref_To_Local'>have_object</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN1384"><span class='Ref_To_Local'>have_array</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;npath;i++ &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1374"><span class='Ref_to_Parameter'>as_text</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* special-case outputs for string and null values */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, 
</span>                                                      <a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonfuncs.c.html#LN1378"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1385"><span class='Ref_To_Local'>jbvp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1374"><span class='Ref_to_Parameter'>as_text</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN374"><span class='Ref_to_Proto'>JsonbToCString</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                        <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1378"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, 
</span>                                                        <a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1378"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* not text mode - just hand back the jsonb */ 
</span>        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1378"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_jsonb_path_all &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_array_length(json) -&GT; int 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1542"></a><span class='Declare_Function'>json_array_length</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1544"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1545"></a>    <a href="jsonfuncs.c.html#LN90"><span class='Ref_to_Struct'>AlenState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN1546"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span><span class='Delimiter'>; 
</span><a name="LN1547"></a>    <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1546"><span class='Ref_To_Local'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1544"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1545"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN90"><span class='Ref_to_Struct'>AlenState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1547"><span class='Ref_To_Local'>sem</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* palloc0 does this for us */ 
</span><span class='Directive'>#if</span> <span class='Number'>0</span> 
<span class='Inactive_Code'>    state-&GT;count = 0; 
</span><span class='Directive'>#endif</span> 
    <a href="jsonfuncs.c.html#LN1545"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN92"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1546"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1547"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1545"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1547"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN84"><span class='Ref_to_Member'>object_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN345"><span class='Ref_to_Proto'>alen_object_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1547"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN346"><span class='Ref_to_Proto'>alen_scalar</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1547"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN90"><span class='Ref_to_Member'>array_element_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN347"><span class='Ref_to_Proto'>alen_array_element_start</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1546"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1547"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1545"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN93"><span class='Ref_to_Member'>count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end json_array_length &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1570"></a><span class='Declare_Function'>jsonb_array_length</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1572"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1572"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot get array length of a scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN224"><span class='Ref_to_Macro'>JB_ROOT_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1572"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot get array length of a non-array"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1572"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * These next two checks ensure that the json is an array (since it can't be 
 * a scalar or an object). 
 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1592"></a><span class='Declare_Function'>alen_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1594"></a>    <a href="jsonfuncs.c.html#LN90"><span class='Ref_to_Struct'>AlenState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN90"><span class='Ref_to_Struct'>AlenState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1592"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* json structure check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1594"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN92"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot get array length of a non-array"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1604"></a><span class='Declare_Function'>alen_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1606"></a>    <a href="jsonfuncs.c.html#LN90"><span class='Ref_to_Struct'>AlenState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN90"><span class='Ref_to_Struct'>AlenState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1604"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* json structure check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1606"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN92"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot get array length of a scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1616"></a><span class='Declare_Function'>alen_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1618"></a>    <a href="jsonfuncs.c.html#LN90"><span class='Ref_to_Struct'>AlenState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN90"><span class='Ref_to_Struct'>AlenState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1616"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* just count up all the level 1 elements */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1618"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN92"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN1618"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN93"><span class='Ref_to_Member'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_each and json_each_text 
 * 
 * decompose a json object into key value pairs. 
 * 
 * Unlike json_object_keys() these SRFs operate in materialize mode, 
 * stashing results into a Tuplestore object as they go. 
 * The construction of tuples is done using a temporary memory context 
 * that is cleared out after each tuple is built. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1636"></a><span class='Declare_Function'>json_each</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN350"><span class='Ref_to_Proto'>each_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1642"></a><span class='Declare_Function'>jsonb_each</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN351"><span class='Ref_to_Proto'>each_worker_jsonb</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"jsonb_each"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1648"></a><span class='Declare_Function'>json_each_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN350"><span class='Ref_to_Proto'>each_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1654"></a><span class='Declare_Function'>jsonb_each_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN351"><span class='Ref_to_Proto'>each_worker_jsonb</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"jsonb_each_text"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1660"></a><span class='Declare_Function'>each_worker_jsonb</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1662"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1663"></a>    <a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span><span class='Delimiter'>; 
</span><a name="LN1664"></a>    <a href="../sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuple_store</span><span class='Delimiter'>; 
</span><a name="LN1665"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1666"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>ret_tdesc</span><span class='Delimiter'>; 
</span><a name="LN1667"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_cxt</span><span class='Delimiter'>, 
</span><a name="LN1668"></a>                <span class='Declare_Local'>tmp_cxt</span><span class='Delimiter'>; 
</span><a name="LN1669"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skipNested</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1670"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN1671"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN1672"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN223"><span class='Ref_to_Macro'>JB_ROOT_IS_OBJECT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1662"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on a non-object"</span><span class='Delimiter'>, 
</span>                        <a href="jsonfuncs.c.html#LN1660"><span class='Ref_to_Parameter'>funcname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1660"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN80"><span class='Ref_to_Member'>resultinfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>|| !</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN266"><span class='Ref_to_Member'>expectedDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that "</span> 
                        <span class='String'>"cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1660"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1665"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function returning record called in context "</span> 
                        <span class='String'>"that cannot accept type record"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1667"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1666"><span class='Ref_To_Local'>ret_tdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1665"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1666"><span class='Ref_To_Local'>ret_tdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1664"><span class='Ref_To_Local'>tuple_store</span></a> <span class='Operator'>= 
</span>        <a href="../../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN251"><span class='Ref_to_EnumConst'>SFRM_Materialize_Random</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1667"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1668"><span class='Ref_To_Local'>tmp_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"jsonb_each temporary cxt"</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1670"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1662"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN1672"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1670"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1669"><span class='Ref_To_Local'>skipNested</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN1669"><span class='Ref_To_Local'>skipNested</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1672"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1720"></a>            <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>key</span><span class='Delimiter'>; 
</span><a name="LN1721"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1722"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN1723"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}; 
</span> 
            <span class='Comment_Multi_Line'>/* Use the tmp context so we can clean up after each tuple is done */ 
</span>            <a href="jsonfuncs.c.html#LN1667"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1668"><span class='Ref_To_Local'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN1720"><span class='Ref_To_Local'>key</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The next thing the iterator fetches should be the value, no 
             * matter what shape it is. 
             */ 
</span>            <a href="jsonfuncs.c.html#LN1672"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1670"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1669"><span class='Ref_To_Local'>skipNested</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN1722"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1720"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1660"><span class='Ref_to_Parameter'>as_text</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* a json null is an sql null in text mode */ 
</span>                    <a href="jsonfuncs.c.html#LN1723"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="jsonfuncs.c.html#LN1722"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span><a name="LN1748"></a>                    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>sv</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* In text mode, scalar strings should be dequoted */ 
</span>                        <a href="jsonfuncs.c.html#LN1748"><span class='Ref_To_Local'>sv</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* Turn anything else into a json string */ 
</span><a name="LN1758"></a>                        <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>jtext</span> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN1759"></a>                        <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN374"><span class='Ref_to_Proto'>JsonbToCString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1758"><span class='Ref_To_Local'>jtext</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1759"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="jsonfuncs.c.html#LN1748"><span class='Ref_To_Local'>sv</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1758"><span class='Ref_To_Local'>jtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1758"><span class='Ref_To_Local'>jtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <a href="jsonfuncs.c.html#LN1722"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1748"><span class='Ref_To_Local'>sv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if as_text &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Not in text mode, just return the Jsonb */ 
</span><a name="LN1771"></a>                <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1671"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN1722"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1771"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="jsonfuncs.c.html#LN1721"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1666"><span class='Ref_To_Local'>ret_tdesc</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1722"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1723"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1664"><span class='Ref_To_Local'>tuple_store</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1721"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* clean up and switch back */ 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1667"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1668"><span class='Ref_To_Local'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if r==WJB_KEY &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (r=JsonbIteratorNext(... &raquo; </span> 
 
    <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1668"><span class='Ref_To_Local'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1664"><span class='Ref_To_Local'>tuple_store</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1663"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1666"><span class='Ref_To_Local'>ret_tdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end each_worker_jsonb &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1796"></a><span class='Declare_Function'>each_worker</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1798"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1799"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span><span class='Delimiter'>; 
</span><a name="LN1800"></a>    <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span><span class='Delimiter'>; 
</span><a name="LN1801"></a>    <a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span><span class='Delimiter'>; 
</span><a name="LN1802"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_cxt</span><span class='Delimiter'>; 
</span><a name="LN1803"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1804"></a>    <a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1799"><span class='Ref_To_Local'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1798"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1800"><span class='Ref_To_Local'>sem</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1796"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN80"><span class='Ref_to_Member'>resultinfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>|| !</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN266"><span class='Ref_to_Member'>expectedDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that "</span> 
                        <span class='String'>"cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1796"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1803"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make these in a sufficiently long-lived memory context */ 
</span>    <a href="jsonfuncs.c.html#LN1802"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN101"><span class='Ref_to_Member'>ret_tdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1803"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN101"><span class='Ref_to_Member'>ret_tdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN100"><span class='Ref_to_Member'>tuple_store</span></a> <span class='Operator'>= 
</span>        <a href="../../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN251"><span class='Ref_to_EnumConst'>SFRM_Materialize_Random</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1802"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1800"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1800"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN86"><span class='Ref_to_Member'>array_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN357"><span class='Ref_to_Proto'>each_array_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1800"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN358"><span class='Ref_to_Proto'>each_scalar</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1800"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN88"><span class='Ref_to_Member'>object_field_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN355"><span class='Ref_to_Proto'>each_object_field_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1800"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN89"><span class='Ref_to_Member'>object_field_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN356"><span class='Ref_to_Proto'>each_object_field_end</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN104"><span class='Ref_to_Member'>normalize_results</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1796"><span class='Ref_to_Parameter'>as_text</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN105"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN99"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1799"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN102"><span class='Ref_to_Member'>tmp_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                           <span class='String'>"json_each temporary cxt"</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1799"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1800"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN102"><span class='Ref_to_Member'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN100"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1801"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1804"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN101"><span class='Ref_to_Member'>ret_tdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end each_worker &raquo; </span> 
 
 
<span class='Keyword'>static void 
</span><a name="LN1860"></a><span class='Declare_Function'>each_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1862"></a>    <a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1860"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* save a pointer to where the value starts */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1862"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN99"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * next_scalar will be reset in the object_field_end handler, and 
         * since we know the value is a scalar there is no danger of it being 
         * on while recursing down the tree. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1862"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN104"><span class='Ref_to_Member'>normalize_results</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1862"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN99"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN1862"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN105"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="jsonfuncs.c.html#LN1862"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN103"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1862"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN99"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1880"></a><span class='Declare_Function'>each_object_field_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1882"></a>    <a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1880"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN1883"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_cxt</span><span class='Delimiter'>; 
</span><a name="LN1884"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1885"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN1886"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN1887"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN1888"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}; 
</span> 
    <span class='Comment_Multi_Line'>/* skip over nested objects */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN99"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* use the tmp context so we can clean up after each tuple is done */ 
</span>    <a href="jsonfuncs.c.html#LN1883"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN102"><span class='Ref_to_Member'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1887"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1880"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1880"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN104"><span class='Ref_to_Member'>normalize_results</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN1888"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1887"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN105"><span class='Ref_to_Member'>next_scalar</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN1887"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN106"><span class='Ref_to_Member'>normalized_scalar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN105"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN1884"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN99"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- </span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN103"><span class='Ref_to_Member'>result_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1885"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN103"><span class='Ref_to_Member'>result_start</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1884"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN1887"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1885"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonfuncs.c.html#LN1886"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN101"><span class='Ref_to_Member'>ret_tdesc</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1887"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1888"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN100"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1886"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* clean up and switch back */ 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1883"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1882"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN102"><span class='Ref_to_Member'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end each_object_field_end &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1926"></a><span class='Declare_Function'>each_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1928"></a>    <a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1926"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* json structure check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1928"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN99"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot deconstruct an array as an object"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1938"></a><span class='Declare_Function'>each_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1940"></a>    <a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN97"><span class='Ref_to_Struct'>EachState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1938"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* json structure check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1940"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN99"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot deconstruct a scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* supply de-escaped value if required */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1940"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN105"><span class='Ref_to_Member'>next_scalar</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN1940"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN106"><span class='Ref_to_Member'>normalized_scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1938"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL functions json_array_elements and json_array_elements_text 
 * 
 * get the elements from a json array 
 * 
 * a lot of this processing is similar to the json_each* functions 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1962"></a><span class='Declare_Function'>jsonb_array_elements</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN363"><span class='Ref_to_Proto'>elements_worker_jsonb</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"jsonb_array_elements"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1968"></a><span class='Declare_Function'>jsonb_array_elements_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN363"><span class='Ref_to_Proto'>elements_worker_jsonb</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"jsonb_array_elements_text"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1974"></a><span class='Declare_Function'>elements_worker_jsonb</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, 
</span><a name="LN1975"></a>                      <span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1977"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1978"></a>    <a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span><span class='Delimiter'>; 
</span><a name="LN1979"></a>    <a href="../sort/tuplestore.c.html#LN102"><span class='Ref_to_Struct'>Tuplestorestate</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tuple_store</span><span class='Delimiter'>; 
</span><a name="LN1980"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN1981"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>ret_tdesc</span><span class='Delimiter'>; 
</span><a name="LN1982"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_cxt</span><span class='Delimiter'>, 
</span><a name="LN1983"></a>                <span class='Declare_Local'>tmp_cxt</span><span class='Delimiter'>; 
</span><a name="LN1984"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skipNested</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1985"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN1986"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN1987"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1977"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot extract elements from a scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN224"><span class='Ref_to_Macro'>JB_ROOT_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1977"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot extract elements from an object"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN1974"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN80"><span class='Ref_to_Member'>resultinfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>|| !</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN266"><span class='Ref_to_Member'>expectedDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that "</span> 
                        <span class='String'>"cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* it's a simple type, so don't use get_call_result_type() */ 
</span>    <a href="jsonfuncs.c.html#LN1980"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN266"><span class='Ref_to_Member'>expectedDesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1982"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1981"><span class='Ref_To_Local'>ret_tdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1980"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1981"><span class='Ref_To_Local'>ret_tdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1979"><span class='Ref_To_Local'>tuple_store</span></a> <span class='Operator'>= 
</span>        <a href="../../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN251"><span class='Ref_to_EnumConst'>SFRM_Materialize_Random</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1982"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1983"><span class='Ref_To_Local'>tmp_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"jsonb_array_elements temporary cxt"</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1985"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1977"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN1987"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1985"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1986"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1984"><span class='Ref_To_Local'>skipNested</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN1984"><span class='Ref_To_Local'>skipNested</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1987"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2035"></a>            <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2036"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN2037"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Boolean'>false</span><span class='Delimiter'>}; 
</span> 
            <span class='Comment_Multi_Line'>/* use the tmp context so we can clean up after each tuple is done */ 
</span>            <a href="jsonfuncs.c.html#LN1982"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1983"><span class='Ref_To_Local'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN1975"><span class='Ref_to_Parameter'>as_text</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN2044"></a>                <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1986"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN2036"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2044"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1986"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* a json null is an sql null in text mode */ 
</span>                    <a href="jsonfuncs.c.html#LN2037"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="jsonfuncs.c.html#LN2036"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span><a name="LN2058"></a>                    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>sv</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1986"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* in text mode scalar strings should be dequoted */ 
</span>                        <a href="jsonfuncs.c.html#LN2058"><span class='Ref_To_Local'>sv</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1986"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN1986"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* turn anything else into a json string */ 
</span><a name="LN2068"></a>                        <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>jtext</span> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN2069"></a>                        <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN1986"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN374"><span class='Ref_to_Proto'>JsonbToCString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2068"><span class='Ref_To_Local'>jtext</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2069"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="jsonfuncs.c.html#LN2058"><span class='Ref_To_Local'>sv</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2068"><span class='Ref_To_Local'>jtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2068"><span class='Ref_To_Local'>jtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <a href="jsonfuncs.c.html#LN2036"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2058"><span class='Ref_To_Local'>sv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
            <a href="jsonfuncs.c.html#LN2035"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1981"><span class='Ref_To_Local'>ret_tdesc</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2036"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2037"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1979"><span class='Ref_To_Local'>tuple_store</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2035"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* clean up and switch back */ 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1982"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1983"><span class='Ref_To_Local'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if r==WJB_ELEM &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (r=JsonbIteratorNext(... &raquo; </span> 
 
    <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN1983"><span class='Ref_To_Local'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1979"><span class='Ref_To_Local'>tuple_store</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN1978"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN1981"><span class='Ref_To_Local'>ret_tdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end elements_worker_jsonb &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2098"></a><span class='Declare_Function'>json_array_elements</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN361"><span class='Ref_to_Proto'>elements_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"json_array_elements"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2104"></a><span class='Declare_Function'>json_array_elements_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN361"><span class='Ref_to_Proto'>elements_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"json_array_elements_text"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2110"></a><span class='Declare_Function'>elements_worker</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>as_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2112"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* elements only needs escaped strings when as_text */ 
</span><a name="LN2115"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2112"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2110"><span class='Ref_to_Parameter'>as_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2116"></a>    <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span><span class='Delimiter'>; 
</span><a name="LN2117"></a>    <a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span><span class='Delimiter'>; 
</span><a name="LN2118"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_cxt</span><span class='Delimiter'>; 
</span><a name="LN2119"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN2120"></a>    <a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2116"><span class='Ref_To_Local'>sem</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2110"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN80"><span class='Ref_to_Member'>resultinfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>|| !</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN266"><span class='Ref_to_Member'>expectedDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that "</span> 
                        <span class='String'>"cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* it's a simple type, so don't use get_call_result_type() */ 
</span>    <a href="jsonfuncs.c.html#LN2119"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN266"><span class='Ref_to_Member'>expectedDesc</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make these in a sufficiently long-lived memory context */ 
</span>    <a href="jsonfuncs.c.html#LN2118"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN115"><span class='Ref_to_Member'>ret_tdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2119"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN115"><span class='Ref_to_Member'>ret_tdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN114"><span class='Ref_to_Member'>tuple_store</span></a> <span class='Operator'>= 
</span>        <a href="../../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN251"><span class='Ref_to_EnumConst'>SFRM_Materialize_Random</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2118"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2116"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2116"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN84"><span class='Ref_to_Member'>object_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN367"><span class='Ref_to_Proto'>elements_object_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2116"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN370"><span class='Ref_to_Proto'>elements_scalar</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2116"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN90"><span class='Ref_to_Member'>array_element_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN368"><span class='Ref_to_Proto'>elements_array_element_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2116"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN91"><span class='Ref_to_Member'>array_element_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN369"><span class='Ref_to_Proto'>elements_array_element_end</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN113"><span class='Ref_to_Member'>function_name</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2110"><span class='Ref_to_Parameter'>funcname</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN118"><span class='Ref_to_Member'>normalize_results</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2110"><span class='Ref_to_Parameter'>as_text</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN119"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN112"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2115"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN116"><span class='Ref_to_Member'>tmp_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, 
</span>                                         <span class='String'>"json_array_elements temporary cxt"</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2115"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2116"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/memutils.h.html#LN74"><span class='Ref_to_Proto'>MemoryContextDelete</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN116"><span class='Ref_to_Member'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN114"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2117"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2120"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN115"><span class='Ref_to_Member'>ret_tdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end elements_worker &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2176"></a><span class='Declare_Function'>elements_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2178"></a>    <a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2176"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* save a pointer to where the value starts */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2178"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN112"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * next_scalar will be reset in the array_element_end handler, and 
         * since we know the value is a scalar there is no danger of it being 
         * on while recursing down the tree. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2178"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN118"><span class='Ref_to_Member'>normalize_results</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN2178"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN112"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN2178"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN119"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="jsonfuncs.c.html#LN2178"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN117"><span class='Ref_to_Member'>result_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2178"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN112"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2196"></a><span class='Declare_Function'>elements_array_element_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2198"></a>    <a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2196"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN2199"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_cxt</span><span class='Delimiter'>; 
</span><a name="LN2200"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN2201"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN2202"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2203"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN2204"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Boolean'>false</span><span class='Delimiter'>}; 
</span> 
    <span class='Comment_Multi_Line'>/* skip over nested objects */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN112"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* use the tmp context so we can clean up after each tuple is done */ 
</span>    <a href="jsonfuncs.c.html#LN2199"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN116"><span class='Ref_to_Member'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2196"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN118"><span class='Ref_to_Member'>normalize_results</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN2204"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2203"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN119"><span class='Ref_to_Member'>next_scalar</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN2203"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN90"><span class='Ref_to_Macro'>CStringGetTextDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN120"><span class='Ref_to_Member'>normalized_scalar</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN119"><span class='Ref_to_Member'>next_scalar</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN2200"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN112"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- </span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN117"><span class='Ref_to_Member'>result_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2201"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN117"><span class='Ref_to_Member'>result_start</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2200"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2203"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2201"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonfuncs.c.html#LN2202"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN115"><span class='Ref_to_Member'>ret_tdesc</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2203"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2204"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN114"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2202"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* clean up and switch back */ 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2199"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/memutils.h.html#LN73"><span class='Ref_to_Proto'>MemoryContextReset</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2198"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN116"><span class='Ref_to_Member'>tmp_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end elements_array_element_end &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2240"></a><span class='Declare_Function'>elements_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2242"></a>    <a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2240"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* json structure check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2242"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN112"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on a non-array"</span><span class='Delimiter'>, 
</span>                        <a href="jsonfuncs.c.html#LN2242"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN113"><span class='Ref_to_Member'>function_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN2253"></a><span class='Declare_Function'>elements_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2255"></a>    <a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN110"><span class='Ref_to_Struct'>ElementsState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2253"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* json structure check */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2255"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN112"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on a scalar"</span><span class='Delimiter'>, 
</span>                        <a href="jsonfuncs.c.html#LN2255"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN113"><span class='Ref_to_Member'>function_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* supply de-escaped value if required */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2255"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN119"><span class='Ref_to_Member'>next_scalar</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN2255"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN120"><span class='Ref_to_Member'>normalized_scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2253"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_populate_record 
 * 
 * set fields in a record from the argument json 
 * 
 * Code adapted shamelessly from hstore's populate_record 
 * which is in turn partly adapted from record_out. 
 * 
 * The json is decomposed into a hash table, in which each 
 * field in the record is then looked up by name. For jsonb 
 * we fetch the values direct from the object. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2282"></a><span class='Declare_Function'>jsonb_populate_record</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN409"><span class='Ref_to_Proto'>populate_record_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"jsonb_populate_record"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2288"></a><span class='Declare_Function'>jsonb_to_record</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN409"><span class='Ref_to_Proto'>populate_record_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"jsonb_to_record"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2294"></a><span class='Declare_Function'>json_populate_record</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN409"><span class='Ref_to_Proto'>populate_record_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"json_populate_record"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2300"></a><span class='Declare_Function'>json_to_record</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN409"><span class='Ref_to_Proto'>populate_record_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"json_to_record"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* helper function for diagnostics */ 
</span><span class='Keyword'>static void 
</span><a name="LN2307"></a><span class='Declare_Function'>populate_array_report_expected_array</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN248"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"expected json array"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"see the value of key \"%s\""</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN248"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"expected json array"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2323"></a>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>indices</span><span class='Delimiter'>; 
</span><a name="LN2324"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2323"><span class='Ref_To_Local'>indices</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2324"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN2324"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN2324"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2323"><span class='Ref_To_Local'>indices</span></a><span class='Delimiter'>, </span><span class='String'>"[%d]"</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN250"><span class='Ref_to_Member'>sizes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2324"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN248"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"expected json array"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"see the array element %s of key \"%s\""</span><span class='Delimiter'>, 
</span>                             <a href="jsonfuncs.c.html#LN2323"><span class='Ref_To_Local'>indices</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2307"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN248"><span class='Ref_to_Member'>colname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"expected json array"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"see the array element %s"</span><span class='Delimiter'>, 
</span>                             <a href="jsonfuncs.c.html#LN2323"><span class='Ref_To_Local'>indices</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end populate_array_report_expected_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* set the number of dimensions of the populated array when it becomes known */ 
</span><span class='Keyword'>static void 
</span><a name="LN2350"></a><span class='Declare_Function'>populate_array_assign_ndims</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndims</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2352"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ndims</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN435"><span class='Ref_to_Proto'>populate_array_report_expected_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ndims</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN250"><span class='Ref_to_Member'>sizes</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2352"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN2352"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ndims</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN2352"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN2350"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2352"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* dimensions are unknown yet */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* check the populated subarray dimension */ 
</span><span class='Keyword'>static void 
</span><a name="LN2369"></a><span class='Declare_Function'>populate_array_check_dimension</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2371"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dim</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN250"><span class='Ref_to_Member'>sizes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* current dimension counter */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2371"><span class='Ref_To_Local'>dim</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* assign dimension if not yet known */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN2371"><span class='Ref_To_Local'>dim</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"malformed json array"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"Multidimensional arrays must have "</span> 
                           <span class='String'>"sub-arrays with matching dimensions."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* reset the current array dimension size counter */ 
</span>    <a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN250"><span class='Ref_to_Member'>sizes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* increment the parent dimension counter if it is a nested sub-array */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN250"><span class='Ref_to_Member'>sizes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2369"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_array_check_dimension &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2391"></a><span class='Declare_Function'>populate_array_element</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2393"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>element</span><span class='Delimiter'>; 
</span><a name="LN2394"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>element_isnull</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* populate the array element */ 
</span>    <a href="jsonfuncs.c.html#LN2393"><span class='Ref_To_Local'>element</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN416"><span class='Ref_to_Proto'>populate_record_field</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN245"><span class='Ref_to_Member'>aio</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN156"><span class='Ref_to_Member'>element_info</span></a><span class='Delimiter'>, 
</span>                                    <a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN245"><span class='Ref_to_Member'>aio</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN157"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>, 
</span>                                    <a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN245"><span class='Ref_to_Member'>aio</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN158"><span class='Ref_to_Member'>element_typmod</span></a><span class='Delimiter'>, 
</span>                                    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN247"><span class='Ref_to_Member'>mcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>jsv</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2394"><span class='Ref_To_Local'>element_isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN244"><span class='Ref_to_Member'>astate</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2393"><span class='Ref_To_Local'>element</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2394"><span class='Ref_To_Local'>element_isnull</span></a><span class='Delimiter'>, 
</span>                     <a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN245"><span class='Ref_to_Member'>aio</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN157"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN246"><span class='Ref_to_Member'>acxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN250"><span class='Ref_to_Member'>sizes</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2391"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* increment current dimension counter */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* json object start handler for populate_array_json() */ 
</span><span class='Keyword'>static void 
</span><a name="LN2412"></a><span class='Declare_Function'>populate_array_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2414"></a>    <a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2412"><span class='Ref_to_Parameter'>_state</span></a><span class='Delimiter'>; 
</span><a name="LN2415"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2414"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2414"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN436"><span class='Ref_to_Proto'>populate_array_assign_ndims</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2414"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2415"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2415"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN2414"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN435"><span class='Ref_to_Proto'>populate_array_report_expected_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2414"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2415"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* json array end handler for populate_array_json() */ 
</span><span class='Keyword'>static void 
</span><a name="LN2425"></a><span class='Declare_Function'>populate_array_array_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2427"></a>    <a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2425"><span class='Ref_to_Parameter'>_state</span></a><span class='Delimiter'>; 
</span><a name="LN2428"></a>    <a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2427"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a><span class='Delimiter'>; 
</span><a name="LN2429"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2427"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2428"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN436"><span class='Ref_to_Proto'>populate_array_assign_ndims</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2428"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2429"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2429"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN2428"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN437"><span class='Ref_to_Proto'>populate_array_check_dimension</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2428"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2429"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* json array element start handler for populate_array_json() */ 
</span><span class='Keyword'>static void 
</span><a name="LN2440"></a><span class='Declare_Function'>populate_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2442"></a>    <a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2440"><span class='Ref_to_Parameter'>_state</span></a><span class='Delimiter'>; 
</span><a name="LN2443"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2442"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2442"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN2443"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN2442"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* remember current array element start */ 
</span>        <a href="jsonfuncs.c.html#LN2442"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN259"><span class='Ref_to_Member'>element_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2442"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2442"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN262"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2442"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2442"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN260"><span class='Ref_to_Member'>element_scalar</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* json array element end handler for populate_array_json() */ 
</span><span class='Keyword'>static void 
</span><a name="LN2456"></a><span class='Declare_Function'>populate_array_element_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2458"></a>    <a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2456"><span class='Ref_to_Parameter'>_state</span></a><span class='Delimiter'>; 
</span><a name="LN2459"></a>    <a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2458"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a><span class='Delimiter'>; 
</span><a name="LN2460"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2458"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2459"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2460"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN2459"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2466"></a>        <a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a>     <span class='Declare_Local'>jsv</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN283"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2458"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN262"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2456"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN283"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2458"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN260"><span class='Ref_to_Member'>element_scalar</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2458"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN260"><span class='Ref_to_Member'>element_scalar</span></a><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* null-terminated */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2458"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN259"><span class='Ref_to_Member'>element_start</span></a><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2458"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- 
</span>                                <a href="jsonfuncs.c.html#LN2458"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN259"><span class='Ref_to_Member'>element_start</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="jsonfuncs.c.html#LN438"><span class='Ref_to_Proto'>populate_array_element</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2459"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2460"><span class='Ref_To_Local'>ndim</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2466"><span class='Ref_To_Local'>jsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndim==ctx-&GT;ndims &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end populate_array_element_end &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* json scalar handler for populate_array_json() */ 
</span><span class='Keyword'>static void 
</span><a name="LN2495"></a><span class='Declare_Function'>populate_array_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>_state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2497"></a>    <a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2495"><span class='Ref_to_Parameter'>_state</span></a><span class='Delimiter'>; 
</span><a name="LN2498"></a>    <a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ctx</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2497"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a><span class='Delimiter'>; 
</span><a name="LN2499"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2497"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2498"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN436"><span class='Ref_to_Proto'>populate_array_assign_ndims</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2498"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2499"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2499"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN2498"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN435"><span class='Ref_to_Proto'>populate_array_report_expected_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2498"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2499"><span class='Ref_To_Local'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2499"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN2498"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* remember the scalar element token */ 
</span>        <a href="jsonfuncs.c.html#LN2497"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN260"><span class='Ref_to_Member'>element_scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2495"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* element_type must already be set in populate_array_element_start() */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2497"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN262"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN2495"><span class='Ref_to_Parameter'>tokentype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end populate_array_scalar &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* parse a json array and populate array */ 
</span><span class='Keyword'>static void 
</span><a name="LN2517"></a><span class='Declare_Function'>populate_array_json</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2519"></a>    <a href="jsonfuncs.c.html#LN255"><span class='Ref_to_Struct'>PopulateArrayState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN2520"></a>    <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Declare_Local'>sem</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2519"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN123"><span class='Ref_to_Proto'>makeJsonLexContextCstringLen</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2517"><span class='Ref_to_Parameter'>json</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2517"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2519"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN258"><span class='Ref_to_Member'>ctx</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2517"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2520"><span class='Ref_To_Local'>sem</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2520"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2520"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2519"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2520"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN84"><span class='Ref_to_Member'>object_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN376"><span class='Ref_to_Proto'>populate_array_object_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2520"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN87"><span class='Ref_to_Member'>array_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN377"><span class='Ref_to_Proto'>populate_array_array_end</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2520"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN90"><span class='Ref_to_Member'>array_element_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN378"><span class='Ref_to_Proto'>populate_array_element_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2520"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN91"><span class='Ref_to_Member'>array_element_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN379"><span class='Ref_to_Proto'>populate_array_element_end</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2520"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN380"><span class='Ref_to_Proto'>populate_array_scalar</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2519"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2520"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* number of dimensions should be already known */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2517"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN2517"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2519"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN257"><span class='Ref_to_Member'>lex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_array_json &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * populate_array_dim_jsonb() -- Iterate recursively through jsonb sub-array 
 *      elements and accumulate result using given ArrayBuildState. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2546"></a><span class='Declare_Function'>populate_array_dim_jsonb</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ctx</span><span class='Delimiter'>,</span>     <span class='Comment_Single_Line'>/* context */ 
</span><a name="LN2547"></a>                         <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jbv</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* jsonb sub-array */ 
</span><a name="LN2548"></a>                         <span class='Keyword'>int </span><span class='Declare_Parameter'>ndim</span><span class='Parentheses'>)</span>      <span class='Comment_Single_Line'>/* current dimension */ 
</span><span class='Delimiter'>{ 
</span><a name="LN2550"></a>    <a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Local'>jbc</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2547"><span class='Ref_to_Parameter'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>; 
</span><a name="LN2551"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN2552"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>tok</span><span class='Delimiter'>; 
</span><a name="LN2553"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN2554"></a>    <a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a>     <span class='Declare_Local'>jsv</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2547"><span class='Ref_to_Parameter'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a> <span class='Operator'>|| !</span><a href="../../../include/utils/jsonb.h.html#LN211"><span class='Ref_to_Macro'>JsonContainerIsArray</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2550"><span class='Ref_To_Local'>jbc</span></a><span class='Parentheses'>))</span> 
        <a href="jsonfuncs.c.html#LN435"><span class='Ref_to_Proto'>populate_array_report_expected_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2548"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN209"><span class='Ref_to_Macro'>JsonContainerIsScalar</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2550"><span class='Ref_To_Local'>jbc</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2551"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2550"><span class='Ref_To_Local'>jbc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2551"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2553"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2551"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2553"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the number of dimensions is not yet known and we have found end of 
     * the array, or the first child element is not an array, then assign the 
     * number of dimensions now. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a> <span class='Operator'>|| 
</span>         <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a> <span class='Operator'>&& 
</span>          <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2553"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a> <span class='Operator'>|| 
</span>           <span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN211"><span class='Ref_to_Macro'>JsonContainerIsArray</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2553"><span class='Ref_To_Local'>val</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>)))))</span> 
        <a href="jsonfuncs.c.html#LN436"><span class='Ref_to_Proto'>populate_array_assign_ndims</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2548"><span class='Ref_to_Parameter'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2554"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2554"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN286"><span class='Ref_to_Member'>jsonb</span></a> <span class='Operator'>= &</span><a href="jsonfuncs.c.html#LN2553"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* process all the array elements */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Recurse only if the dimensions of dimensions is still unknown or if 
         * it is not the innermost dimension. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN2548"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>&GT;= </span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN438"><span class='Ref_to_Proto'>populate_array_element</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2548"><span class='Ref_to_Parameter'>ndim</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2554"><span class='Ref_To_Local'>jsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* populate child sub-array */ 
</span>            <a href="jsonfuncs.c.html#LN433"><span class='Ref_to_Proto'>populate_array_dim_jsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2553"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2548"><span class='Ref_to_Parameter'>ndim</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* number of dimensions should be already known */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN437"><span class='Ref_to_Proto'>populate_array_check_dimension</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2546"><span class='Ref_to_Parameter'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2548"><span class='Ref_to_Parameter'>ndim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2551"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2553"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while tok==WJB_ELEM &raquo; </span> 
 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* free iterator, iterating until WJB_DONE */ 
</span>    <a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2551"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2553"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2552"><span class='Ref_To_Local'>tok</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a> <span class='Operator'>&& !</span><a href="jsonfuncs.c.html#LN2551"><span class='Ref_To_Local'>it</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_array_dim_jsonb &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* recursively populate an array from json/jsonb */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2617"></a><span class='Declare_Function'>populate_array</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN154"><span class='Ref_to_Struct'>ArrayIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>aio</span><span class='Delimiter'>, 
</span><a name="LN2618"></a>               <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, 
</span><a name="LN2619"></a>               <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, 
</span><a name="LN2620"></a>               <a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2622"></a>    <a href="jsonfuncs.c.html#LN242"><span class='Ref_to_Struct'>PopulateArrayContext</span></a> <span class='Declare_Local'>ctx</span><span class='Delimiter'>; 
</span><a name="LN2623"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2624"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>lbs</span><span class='Delimiter'>; 
</span><a name="LN2625"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN245"><span class='Ref_to_Member'>aio</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2617"><span class='Ref_to_Parameter'>aio</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN247"><span class='Ref_to_Member'>mcxt</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2619"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN246"><span class='Ref_to_Member'>acxt</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN244"><span class='Ref_to_Member'>astate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN388"><span class='Ref_to_Proto'>initArrayResult</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2617"><span class='Ref_to_Parameter'>aio</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN157"><span class='Ref_to_Member'>element_type</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN246"><span class='Ref_to_Member'>acxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN248"><span class='Ref_to_Member'>colname</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2618"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* unknown yet */ 
</span>    <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN250"><span class='Ref_to_Member'>sizes</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2620"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN432"><span class='Ref_to_Proto'>populate_array_json</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2620"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, 
</span>                            <a href="jsonfuncs.c.html#LN2620"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="jsonfuncs.c.html#LN2620"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a> 
                            <span class='Operator'>: </span>strlen<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2620"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN433"><span class='Ref_to_Proto'>populate_array_dim_jsonb</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2620"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN286"><span class='Ref_to_Member'>jsonb</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN250"><span class='Ref_to_Member'>sizes</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2624"><span class='Ref_To_Local'>lbs</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2625"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN2625"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN2625"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN2624"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2625"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2623"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN396"><span class='Ref_to_Proto'>makeMdArrayResult</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN244"><span class='Ref_to_Member'>astate</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN251"><span class='Ref_to_Member'>ndims</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2624"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, 
</span>                               <a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN246"><span class='Ref_to_Member'>acxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN249"><span class='Ref_to_Member'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2622"><span class='Ref_To_Local'>ctx</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN250"><span class='Ref_to_Member'>sizes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2624"><span class='Ref_To_Local'>lbs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN2623"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_array &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2664"></a><span class='Declare_Function'>JsValueToJsObject</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jso</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jso</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN292"><span class='Ref_to_Member'>is_json</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* convert plain-text json into a hash table */ 
</span>        <a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jso</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN297"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN295"><span class='Ref_to_Member'>json_hash</span></a> <span class='Operator'>= 
</span>            <a href="jsonfuncs.c.html#LN373"><span class='Ref_to_Proto'>get_json_object_as_hash</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>, 
</span>                                    <a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> 
                                    <span class='Operator'>? </span><a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a> 
                                    <span class='Operator'>: </span>strlen<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <span class='String'>"populate_composite"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2680"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>jbv</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN286"><span class='Ref_to_Member'>jsonb</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2680"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/utils/jsonb.h.html#LN210"><span class='Ref_to_Macro'>JsonContainerIsObject</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2680"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN2664"><span class='Ref_to_Parameter'>jso</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN297"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN296"><span class='Ref_to_Member'>jsonb_cont</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2680"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2689"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_scalar</span><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN2689"><span class='Ref_To_Local'>is_scalar</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN282"><span class='Ref_to_Macro'>IsAJsonbScalar</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2680"><span class='Ref_To_Local'>jbv</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2680"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a> <span class='Operator'>&& 
</span>                 <a href="../../../include/utils/jsonb.h.html#LN209"><span class='Ref_to_Macro'>JsonContainerIsScalar</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2680"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="jsonfuncs.c.html#LN2689"><span class='Ref_To_Local'>is_scalar</span></a> 
                     <span class='Operator'>? </span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on a scalar"</span><span class='Delimiter'>, 
</span>                              <span class='String'>"populate_composite"</span><span class='Parentheses'>) 
</span>                     <span class='Operator'>: </span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on an array"</span><span class='Delimiter'>, 
</span>                              <span class='String'>"populate_composite"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end JsValueToJsObject &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* recursively populate a composite (row type) value from json/jsonb */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2707"></a><span class='Declare_Function'>populate_composite</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN162"><span class='Ref_to_Struct'>CompositeIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>io</span><span class='Delimiter'>, 
</span><a name="LN2708"></a>                   <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, 
</span><a name="LN2709"></a>                   <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN2710"></a>                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, 
</span><a name="LN2711"></a>                   <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, 
</span><a name="LN2712"></a>                   <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Parameter'>defaultval</span><span class='Delimiter'>, 
</span><a name="LN2713"></a>                   <a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2715"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN2716"></a>    <a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a>    <span class='Declare_Local'>jso</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* acquire cached tuple descriptor */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN2707"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN2707"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN2708"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN2707"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN2709"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2723"></a>        <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><a href="../../../include/utils/typcache.h.html#LN151"><span class='Ref_to_Proto'>lookup_rowtype_tupdesc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2708"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2709"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2724"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2707"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/access/tupdesc.h.html#LN95"><span class='Ref_to_Proto'>FreeTupleDesc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2707"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* copy tuple desc without constraints into cache memory context */ 
</span>        <a href="jsonfuncs.c.html#LN2724"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2711"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2707"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2723"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2724"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2723"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* prepare input value */ 
</span>    <a href="jsonfuncs.c.html#LN419"><span class='Ref_to_Proto'>JsValueToJsObject</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2713"><span class='Ref_to_Parameter'>jsv</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2716"><span class='Ref_To_Local'>jso</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* populate resulting record tuple */ 
</span>    <a href="jsonfuncs.c.html#LN2715"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN413"><span class='Ref_to_Proto'>populate_record</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2707"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2707"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN168"><span class='Ref_to_Member'>record_io</span></a><span class='Delimiter'>, 
</span>                            <a href="jsonfuncs.c.html#LN2712"><span class='Ref_to_Parameter'>defaultval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2711"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2716"><span class='Ref_To_Local'>jso</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN316"><span class='Ref_to_Macro'>JsObjectFree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2716"><span class='Ref_To_Local'>jso</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/funcapi.h.html#LN232"><span class='Ref_to_Proto'>HeapTupleHeaderGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2715"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_composite &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* populate non-null scalar value from json/jsonb value */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2751"></a><span class='Declare_Function'>populate_scalar</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN143"><span class='Ref_to_Struct'>ScalarIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>io</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2753"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2754"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2755"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2759"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN2755"><span class='Ref_To_Local'>json</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2755"><span class='Ref_To_Local'>json</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* already done the hard work in the json case */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN355"><span class='Ref_to_Const'>JSONOID</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN75"><span class='Ref_to_Const'>JSONBOID</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>            <a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN283"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Add quotes around string value (should be already escaped) if 
             * converting to json/jsonb. 
             */ 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2755"><span class='Ref_To_Local'>json</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="jsonfuncs.c.html#LN2755"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'"'</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Need to copy non-null-terminated string */ 
</span>            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2755"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN2759"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2755"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* null-terminated string */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if jsv-&GT;is_json &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2794"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>jbv</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN286"><span class='Ref_to_Member'>jsonb</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN75"><span class='Ref_to_Const'>JSONBOID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2798"></a>            <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jsonb</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* directly use jsonb */ 
</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/jsonb.h.html#LN68"><span class='Ref_to_Macro'>JsonbGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2798"><span class='Ref_To_Local'>jsonb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* convert jsonb to string for typio call */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN355"><span class='Ref_to_Const'>JSONOID</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Convert scalar jsonb (non-scalars are passed here as jbvBinary) 
             * to json string, preserving quotes around top-level strings. 
             */ 
</span><a name="LN2809"></a>            <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jsonb</span> <span class='Operator'>= </span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN374"><span class='Ref_to_Proto'>JsonbToCString</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2809"><span class='Ref_To_Local'>jsonb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2809"><span class='Ref_To_Local'>jsonb</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* quotes are stripped */ 
</span>            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN127"><span class='Ref_to_Proto'>pnstrdup</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN233"><span class='Ref_to_EnumConst'>jbvBool</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>boolean <span class='Operator'>? </span><span class='String'>"true"</span> <span class='Operator'>: </span><span class='String'>"false"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN232"><span class='Ref_to_EnumConst'>jbvNumeric</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN639"><span class='Ref_to_Func'>numeric_out</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>numeric<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN374"><span class='Ref_to_Proto'>JsonbToCString</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>, 
</span>                                 <a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized jsonb type: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN2794"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="jsonfuncs.c.html#LN2753"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN642"><span class='Ref_to_Proto'>InputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN146"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN145"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2751"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* free temporary buffer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN2755"><span class='Ref_To_Local'>json</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2754"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN2753"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_scalar &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2837"></a><span class='Declare_Function'>populate_domain</span><span class='Parentheses'>(</span><a href="domains.c.html#LN46"><span class='Ref_to_Struct'>DomainIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>io</span><span class='Delimiter'>, 
</span><a name="LN2838"></a>                <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, 
</span><a name="LN2839"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, 
</span><a name="LN2840"></a>                <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, 
</span><a name="LN2841"></a>                <a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Delimiter'>, 
</span><a name="LN2842"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2844"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2842"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN2844"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN2844"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN416"><span class='Ref_to_Proto'>populate_record_field</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2837"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN175"><span class='Ref_to_Member'>base_io</span></a><span class='Delimiter'>, 
</span>                                    <a href="jsonfuncs.c.html#LN2837"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN176"><span class='Ref_to_Member'>base_typid</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2837"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN177"><span class='Ref_to_Member'>base_typmod</span></a><span class='Delimiter'>, 
</span>                                    <a href="jsonfuncs.c.html#LN2839"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2840"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="jsonfuncs.c.html#LN2841"><span class='Ref_to_Parameter'>jsv</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2842"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN2842"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/builtins.h.html#LN26"><span class='Ref_to_Proto'>domain_check</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2844"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2842"><span class='Ref_to_Parameter'>isnull</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2838"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2837"><span class='Ref_to_Parameter'>io</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN178"><span class='Ref_to_Member'>domain_info</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2840"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN2844"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_domain &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* prepare column metadata cache for the given type */ 
</span><span class='Keyword'>static void 
</span><a name="LN2864"></a><span class='Declare_Function'>prepare_column_cache</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>column</span><span class='Delimiter'>, 
</span><a name="LN2865"></a>                     <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, 
</span><a name="LN2866"></a>                     <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN2867"></a>                     <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, 
</span><a name="LN2868"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>json</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2870"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tup</span><span class='Delimiter'>; 
</span><a name="LN2871"></a>    <a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN195"><span class='Ref_to_Member'>typid</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2865"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN196"><span class='Ref_to_Member'>typmod</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2866"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2870"><span class='Ref_To_Local'>tup</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2865"><span class='Ref_to_Parameter'>typid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2870"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2865"><span class='Ref_to_Parameter'>typid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2871"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2870"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2871"><span class='Ref_To_Local'>type</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN197"><span class='Ref_to_Member'>typcat</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN187"><span class='Ref_to_EnumConst'>TYPECAT_DOMAIN</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN204"><span class='Ref_to_Member'>domain</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN176"><span class='Ref_to_Member'>base_typid</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2871"><span class='Ref_To_Local'>type</span></a><span class='Operator'>-&GT;</span>typbasetype<span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN204"><span class='Ref_to_Member'>domain</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN177"><span class='Ref_to_Member'>base_typmod</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2871"><span class='Ref_To_Local'>type</span></a><span class='Operator'>-&GT;</span>typtypmod<span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN204"><span class='Ref_to_Member'>domain</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN175"><span class='Ref_to_Member'>base_io</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2867"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN204"><span class='Ref_to_Member'>domain</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN178"><span class='Ref_to_Member'>domain_info</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2871"><span class='Ref_To_Local'>type</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN720"><span class='Ref_to_Const'>TYPTYPE_COMPOSITE</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN2865"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN679"><span class='Ref_to_Const'>RECORDOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN197"><span class='Ref_to_Member'>typcat</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN186"><span class='Ref_to_EnumConst'>TYPECAT_COMPOSITE</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN203"><span class='Ref_to_Member'>composite</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN168"><span class='Ref_to_Member'>record_io</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN203"><span class='Ref_to_Member'>composite</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2871"><span class='Ref_To_Local'>type</span></a><span class='Operator'>-&GT;</span>typlen <span class='Operator'>== -</span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2871"><span class='Ref_To_Local'>type</span></a><span class='Operator'>-&GT;</span>typelem<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN197"><span class='Ref_to_Member'>typcat</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN185"><span class='Ref_to_EnumConst'>TYPECAT_ARRAY</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN202"><span class='Ref_to_Member'>array</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN156"><span class='Ref_to_Member'>element_info</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2867"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, 
</span>                                                       <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN202"><span class='Ref_to_Member'>array</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN157"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2871"><span class='Ref_To_Local'>type</span></a><span class='Operator'>-&GT;</span>typelem<span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* array element typemod stored in attribute's typmod */ 
</span>        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN202"><span class='Ref_to_Member'>array</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN158"><span class='Ref_to_Member'>element_typmod</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2866"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN197"><span class='Ref_to_Member'>typcat</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN184"><span class='Ref_to_EnumConst'>TYPECAT_SCALAR</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* don't need input function when converting from jsonb to jsonb */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2868"><span class='Ref_to_Parameter'>json</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN2865"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN75"><span class='Ref_to_Const'>JSONBOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2912"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typioproc</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/lsyscache.h.html#LN161"><span class='Ref_to_Proto'>getTypeInputInfo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2865"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2912"><span class='Ref_To_Local'>typioproc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN198"><span class='Ref_to_Member'>scalar_io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN145"><span class='Ref_to_Member'>typioparam</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2912"><span class='Ref_To_Local'>typioproc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2864"><span class='Ref_to_Parameter'>column</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN198"><span class='Ref_to_Member'>scalar_io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN146"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2867"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2870"><span class='Ref_To_Local'>tup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end prepare_column_cache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* recursively populate a record field or an array element from a json/jsonb value */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2923"></a><span class='Declare_Function'>populate_record_field</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>col</span><span class='Delimiter'>, 
</span><a name="LN2924"></a>                      <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, 
</span><a name="LN2925"></a>                      <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, 
</span><a name="LN2926"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>colname</span><span class='Delimiter'>, 
</span><a name="LN2927"></a>                      <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, 
</span><a name="LN2928"></a>                      <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>defaultval</span><span class='Delimiter'>, 
</span><a name="LN2929"></a>                      <a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Delimiter'>, 
</span><a name="LN2930"></a>                      <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2932"></a>    <a href="jsonfuncs.c.html#LN182"><span class='Ref_to_Enum'>TypeCat</span></a>     <span class='Declare_Local'>typcat</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* prepare column metadata cache for the given type */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2923"><span class='Ref_to_Parameter'>col</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN195"><span class='Ref_to_Member'>typid</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN2924"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN2923"><span class='Ref_to_Parameter'>col</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN196"><span class='Ref_to_Member'>typmod</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN2925"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN424"><span class='Ref_to_Proto'>prepare_column_cache</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2923"><span class='Ref_to_Parameter'>col</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2924"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2925"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2927"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2929"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="jsonfuncs.c.html#LN2930"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN301"><span class='Ref_to_Macro'>JsValueIsNull</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2929"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2932"><span class='Ref_To_Local'>typcat</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2923"><span class='Ref_to_Parameter'>col</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN197"><span class='Ref_to_Member'>typcat</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* try to convert json string to a non-scalar type through input function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN306"><span class='Ref_to_Macro'>JsValueIsString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2929"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2932"><span class='Ref_To_Local'>typcat</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN185"><span class='Ref_to_EnumConst'>TYPECAT_ARRAY</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN2932"><span class='Ref_To_Local'>typcat</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN186"><span class='Ref_to_EnumConst'>TYPECAT_COMPOSITE</span></a><span class='Parentheses'>))</span> 
        <a href="jsonfuncs.c.html#LN2932"><span class='Ref_To_Local'>typcat</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN184"><span class='Ref_to_EnumConst'>TYPECAT_SCALAR</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* we must perform domain checks for NULLs */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN2930"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN2932"><span class='Ref_To_Local'>typcat</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN187"><span class='Ref_to_EnumConst'>TYPECAT_DOMAIN</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2932"><span class='Ref_To_Local'>typcat</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="jsonfuncs.c.html#LN184"><span class='Ref_to_EnumConst'>TYPECAT_SCALAR</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN423"><span class='Ref_to_Proto'>populate_scalar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2923"><span class='Ref_to_Parameter'>col</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN198"><span class='Ref_to_Member'>scalar_io</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2924"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2925"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2929"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="jsonfuncs.c.html#LN185"><span class='Ref_to_EnumConst'>TYPECAT_ARRAY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN439"><span class='Ref_to_Proto'>populate_array</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2923"><span class='Ref_to_Parameter'>col</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN202"><span class='Ref_to_Member'>array</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2926"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2927"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2929"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="jsonfuncs.c.html#LN186"><span class='Ref_to_EnumConst'>TYPECAT_COMPOSITE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN420"><span class='Ref_to_Proto'>populate_composite</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2923"><span class='Ref_to_Parameter'>col</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN203"><span class='Ref_to_Member'>composite</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2924"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2925"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, 
</span>                                      <a href="jsonfuncs.c.html#LN2926"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2927"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2928"><span class='Ref_to_Parameter'>defaultval</span></a><span class='Parentheses'>) 
</span>                                      <span class='Operator'>? </span><a href="../../../include/fmgr.h.html#LN258"><span class='Ref_to_Macro'>DatumGetHeapTupleHeader</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2928"><span class='Ref_to_Parameter'>defaultval</span></a><span class='Parentheses'>) 
</span>                                      <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                      <a href="jsonfuncs.c.html#LN2929"><span class='Ref_to_Parameter'>jsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="jsonfuncs.c.html#LN187"><span class='Ref_to_EnumConst'>TYPECAT_DOMAIN</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN441"><span class='Ref_to_Proto'>populate_domain</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN2923"><span class='Ref_to_Parameter'>col</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN205"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN204"><span class='Ref_to_Member'>domain</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2924"><span class='Ref_to_Parameter'>typid</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2926"><span class='Ref_to_Parameter'>colname</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2927"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, 
</span>                                   <a href="jsonfuncs.c.html#LN2929"><span class='Ref_to_Parameter'>jsv</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN2930"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized type category '%c'"</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2932"><span class='Ref_To_Local'>typcat</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch typcat &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end populate_record_field &raquo; </span> 
 
<span class='Keyword'>static </span><a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>* 
</span><a name="LN2980"></a><span class='Declare_Function'>allocate_record_info</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ncolumns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2982"></a>    <a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>    <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2980"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, 
</span>                       <a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a><span class='Delimiter'>, </span>columns<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>                       <a href="jsonfuncs.c.html#LN2980"><span class='Ref_to_Parameter'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN2982"><span class='Ref_To_Local'>data</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN43"><span class='Ref_to_Member'>record_type</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2982"><span class='Ref_To_Local'>data</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN44"><span class='Ref_to_Member'>record_typmod</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN2982"><span class='Ref_To_Local'>data</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN45"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2980"><span class='Ref_to_Parameter'>ncolumns</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2982"><span class='Ref_To_Local'>data</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN46"><span class='Ref_to_Member'>columns</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="jsonfuncs.c.html#LN2980"><span class='Ref_to_Parameter'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN2982"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN2996"></a><span class='Declare_Function'>JsObjectGetField</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>obj</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>field</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsv</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>obj</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN292"><span class='Ref_to_Member'>is_json</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3002"></a>        <a href="jsonfuncs.c.html#LN135"><span class='Ref_to_Struct'>JsonHashEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hashentry</span> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>obj</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN297"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN295"><span class='Ref_to_Member'>json_hash</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/utils/hsearch.h.html#LN104"><span class='Ref_to_EnumConst'>HASH_FIND</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN283"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3002"><span class='Ref_To_Local'>hashentry</span></a> <span class='Operator'>? </span><a href="jsonfuncs.c.html#LN3002"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN139"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>: </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN283"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a> <span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>            <a href="jsonfuncs.c.html#LN3002"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN138"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a> <span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* null-terminated */ 
</span> 
        <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN3002"><span class='Ref_To_Local'>hashentry</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN286"><span class='Ref_to_Member'>jsonb</span></a> <span class='Operator'>= !</span><a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>obj</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN297"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN296"><span class='Ref_to_Member'>jsonb_cont</span></a> <span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: 
</span>            <a href="jsonfuncs.c.html#LN445"><span class='Ref_to_Proto'>findJsonbValueFromContainerLen</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>obj</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN297"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN296"><span class='Ref_to_Member'>jsonb_cont</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN204"><span class='Ref_to_Const'>JB_FOBJECT</span></a><span class='Delimiter'>, 
</span>                                           <a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>field</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>field</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN2996"><span class='Ref_to_Parameter'>jsv</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN286"><span class='Ref_to_Member'>jsonb</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end JsObjectGetField &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* populate a record tuple from json/jsonb value */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> 
<a name="LN3024"></a><span class='Declare_Function'>populate_record</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, 
</span><a name="LN3025"></a>                <a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>record_p</span><span class='Delimiter'>, 
</span><a name="LN3026"></a>                <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Parameter'>defaultval</span><span class='Delimiter'>, 
</span><a name="LN3027"></a>                <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>mcxt</span><span class='Delimiter'>, 
</span><a name="LN3028"></a>                <a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>obj</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3030"></a>    <a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>record</span> <span class='Operator'>= *</span><a href="jsonfuncs.c.html#LN3025"><span class='Ref_to_Parameter'>record_p</span></a><span class='Delimiter'>; 
</span><a name="LN3031"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN3032"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN3033"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN3034"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ncolumns</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3024"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; 
</span><a name="LN3035"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if the input json is empty, we can only skip the rest if we were passed 
     * in a non-null record, since otherwise there may be issues with domain 
     * nulls. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3026"><span class='Ref_to_Parameter'>defaultval</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN310"><span class='Ref_to_Macro'>JsObjectIsEmpty</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3028"><span class='Ref_to_Parameter'>obj</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN3026"><span class='Ref_to_Parameter'>defaultval</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* (re)allocate metadata cache */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN45"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN3034"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="jsonfuncs.c.html#LN3025"><span class='Ref_to_Parameter'>record_p</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN429"><span class='Ref_to_Proto'>allocate_record_info</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3027"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3034"><span class='Ref_To_Local'>ncolumns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* invalidate metadata cache if the record type has changed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN43"><span class='Ref_to_Member'>record_type</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN3024"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN44"><span class='Ref_to_Member'>record_typmod</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN3024"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a><span class='Delimiter'>, </span>columns<span class='Parentheses'>) </span><span class='Operator'>+ 
</span>               <a href="jsonfuncs.c.html#LN3034"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN193"><span class='Ref_to_Struct'>ColumnIOData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN43"><span class='Ref_to_Member'>record_type</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3024"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN44"><span class='Ref_to_Member'>record_typmod</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3024"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN45"><span class='Ref_to_Member'>ncolumns</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3034"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonfuncs.c.html#LN3031"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3034"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3032"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3034"><span class='Ref_To_Local'>ncolumns</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3026"><span class='Ref_to_Parameter'>defaultval</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3066"></a>        <a href="../../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Build a temporary HeapTuple control structure */ 
</span>        <a href="jsonfuncs.c.html#LN3066"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3026"><span class='Ref_to_Parameter'>defaultval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3066"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3066"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3066"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3026"><span class='Ref_to_Parameter'>defaultval</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Break down the tuple into fields */ 
</span>        <a href="../../../include/access/htup_details.h.html#LN813"><span class='Ref_to_Proto'>heap_deform_tuple</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3066"><span class='Ref_To_Local'>tuple</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3024"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3031"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3032"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN3034"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN3031"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN3032"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN3034"><span class='Ref_To_Local'>ncolumns</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3088"></a>        <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>att</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3024"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN3089"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colname</span> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3088"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3090"></a>        <a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a>     <span class='Declare_Local'>field</span> <span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>0</span><span class='Delimiter'>}; 
</span><a name="LN3091"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Ignore dropped columns in datatype */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3088"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN3032"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="jsonfuncs.c.html#LN3091"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN430"><span class='Ref_to_Proto'>JsObjectGetField</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3028"><span class='Ref_to_Parameter'>obj</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3089"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3090"><span class='Ref_To_Local'>field</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * we can't just skip here if the key wasn't found since we might have 
         * a domain to deal with. If we were passed in a non-null record 
         * datum, we assume that the existing values are valid (if they're 
         * not, then it's not our fault), but if we were passed in a null, 
         * then every field which we don't populate needs to be run through 
         * the input function just in case it's a domain type. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3026"><span class='Ref_to_Parameter'>defaultval</span></a> <span class='Operator'>&& !</span><a href="jsonfuncs.c.html#LN3091"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN3031"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="jsonfuncs.c.html#LN416"><span class='Ref_to_Proto'>populate_record_field</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3030"><span class='Ref_To_Local'>record</span></a><span class='Operator'>-&GT;</span><a href="rowtypes.c.html#LN46"><span class='Ref_to_Member'>columns</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                          <a href="jsonfuncs.c.html#LN3088"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, 
</span>                                          <a href="jsonfuncs.c.html#LN3088"><span class='Ref_To_Local'>att</span></a><span class='Operator'>-&GT;</span>atttypmod<span class='Delimiter'>, 
</span>                                          <a href="jsonfuncs.c.html#LN3089"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, 
</span>                                          <a href="jsonfuncs.c.html#LN3027"><span class='Ref_to_Parameter'>mcxt</span></a><span class='Delimiter'>, 
</span>                                          <a href="jsonfuncs.c.html#LN3032"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>? </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="jsonfuncs.c.html#LN3031"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                          <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3090"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3032"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3035"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;ncolumns;++i &raquo; </span> 
 
    <a href="jsonfuncs.c.html#LN3033"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3024"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3031"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3032"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3031"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3032"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN3033"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_record &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3132"></a><span class='Declare_Function'>populate_record_worker</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, 
</span><a name="LN3133"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>have_record_arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3135"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>json_arg_num</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3133"><span class='Ref_to_Parameter'>have_record_arg</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3136"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>jtype</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3132"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3135"><span class='Ref_To_Local'>json_arg_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3137"></a>    <a href="jsonfuncs.c.html#LN274"><span class='Ref_to_Struct'>JsValue</span></a>     <span class='Declare_Local'>jsv</span> <span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>0</span><span class='Delimiter'>}; 
</span><a name="LN3138"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>rec</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3139"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tupType</span><span class='Delimiter'>; 
</span><a name="LN3140"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tupTypmod</span><span class='Delimiter'>; 
</span><a name="LN3141"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3142"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>rettuple</span><span class='Delimiter'>; 
</span><a name="LN3143"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>jbv</span><span class='Delimiter'>; 
</span><a name="LN3144"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>fnmcxt</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3132"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Delimiter'>; 
</span><a name="LN3145"></a>    <a href="jsonfuncs.c.html#LN235"><span class='Ref_to_Struct'>PopulateRecordCache</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cache</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3132"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3136"><span class='Ref_To_Local'>jtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN355"><span class='Ref_to_Const'>JSONOID</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN3136"><span class='Ref_To_Local'>jtype</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN75"><span class='Ref_to_Const'>JSONBOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up the needed I/O info just once per series of 
     * calls, assuming the record type doesn't change underneath us. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN3145"><span class='Ref_To_Local'>cache</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN3132"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3145"><span class='Ref_To_Local'>cache</span></a> <span class='Operator'>= 
</span>            <a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3144"><span class='Ref_To_Local'>fnmcxt</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN3145"><span class='Ref_To_Local'>cache</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3133"><span class='Ref_to_Parameter'>have_record_arg</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3159"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argtype</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3132"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3145"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN237"><span class='Ref_to_Member'>argtype</span></a> <span class='Operator'>!= </span><a href="jsonfuncs.c.html#LN3159"><span class='Ref_To_Local'>argtype</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3159"><span class='Ref_To_Local'>argtype</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"first argument of %s must be a row type"</span><span class='Delimiter'>, 
</span>                                <a href="jsonfuncs.c.html#LN3132"><span class='Ref_to_Parameter'>funcname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN3145"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN237"><span class='Ref_to_Member'>argtype</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3159"><span class='Ref_To_Local'>argtype</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
                <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * We have no tuple to look at, so the only source of type info is 
             * the argtype. The lookup_rowtype_tupdesc call below will error 
             * out if we don't have a known composite type oid here. 
             */ 
</span>            <a href="jsonfuncs.c.html#LN3139"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3159"><span class='Ref_To_Local'>argtype</span></a><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN3140"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN3138"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN275"><span class='Ref_to_Macro'>PG_GETARG_HEAPTUPLEHEADER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
                <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3138"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Extract type info from the tuple itself */ 
</span>            <a href="jsonfuncs.c.html#LN3139"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN444"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypeId</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3138"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN3140"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN454"><span class='Ref_to_Macro'>HeapTupleHeaderGetTypMod</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3138"><span class='Ref_To_Local'>rec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if have_record_arg &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* json{b}_to_record case */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3132"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3141"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function returning record called in context "</span> 
                            <span class='String'>"that cannot accept type record"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Try calling the function in the FROM clause "</span> 
                             <span class='String'>"using a column definition list."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3141"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add tupdesc to the cache and set the appropriate values of 
         * tupType/tupTypmod for proper cache usage in populate_composite(). 
         */ 
</span>        <a href="jsonfuncs.c.html#LN3145"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN238"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3141"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN3139"><span class='Ref_To_Local'>tupType</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3141"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN76"><span class='Ref_to_Member'>tdtypeid</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3140"><span class='Ref_To_Local'>tupTypmod</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3141"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN77"><span class='Ref_to_Member'>tdtypmod</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="jsonfuncs.c.html#LN3137"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3136"><span class='Ref_To_Local'>jtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN355"><span class='Ref_to_Const'>JSONOID</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3137"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN276"><span class='Ref_to_Member'>is_json</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3227"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3135"><span class='Ref_To_Local'>json_arg_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN3137"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN281"><span class='Ref_to_Member'>str</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3227"><span class='Ref_To_Local'>json</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3137"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN282"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3227"><span class='Ref_To_Local'>json</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3137"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN284"><span class='Ref_to_Member'>json</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN283"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN21"><span class='Ref_to_EnumConst'>JSON_TOKEN_INVALID</span></a><span class='Delimiter'>; </span><span class='Comment_Multi_Line'>/* not used in 
                                                 * populate_composite() */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3236"></a>        <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3135"><span class='Ref_To_Local'>json_arg_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN3137"><span class='Ref_To_Local'>jsv</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN287"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN286"><span class='Ref_to_Member'>jsonb</span></a> <span class='Operator'>= &</span><a href="jsonfuncs.c.html#LN3143"><span class='Ref_To_Local'>jbv</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* fill binary jsonb value pointing to jb */ 
</span>        <a href="jsonfuncs.c.html#LN3143"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3143"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data <span class='Operator'>= &</span><a href="jsonfuncs.c.html#LN3236"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3143"><span class='Ref_To_Local'>jbv</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>len <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3236"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonfuncs.c.html#LN3142"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN420"><span class='Ref_to_Proto'>populate_composite</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3145"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN238"><span class='Ref_to_Member'>io</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3139"><span class='Ref_To_Local'>tupType</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3140"><span class='Ref_To_Local'>tupTypmod</span></a><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3144"><span class='Ref_To_Local'>fnmcxt</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3138"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3137"><span class='Ref_To_Local'>jsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3141"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN3145"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN238"><span class='Ref_to_Member'>io</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN169"><span class='Ref_to_Member'>tupdesc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN106"><span class='Ref_to_Macro'>ReleaseTupleDesc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3141"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3142"><span class='Ref_To_Local'>rettuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_record_worker &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_json_object_as_hash 
 * 
 * decompose a json object into a hash table. 
 */ 
</span><span class='Keyword'>static </span><a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a> <span class='Operator'>* 
</span><a name="LN3264"></a><span class='Declare_Function'>get_json_object_as_hash</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3266"></a>    <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span><a name="LN3267"></a>    <a href="../hash/dynahash.c.html#LN192"><span class='Ref_to_Struct'>HTAB</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tab</span><span class='Delimiter'>; 
</span><a name="LN3268"></a>    <a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN3269"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN123"><span class='Ref_to_Proto'>makeJsonLexContextCstringLen</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3264"><span class='Ref_to_Parameter'>json</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3264"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3270"></a>    <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3266"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3266"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3266"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3266"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN135"><span class='Ref_to_Struct'>JsonHashEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3266"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN77"><span class='Ref_to_Member'>hcxt</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3267"><span class='Ref_To_Local'>tab</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"json object hashtable"</span><span class='Delimiter'>, 
</span>                      <span class='Number'>100</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3266"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN92"><span class='Ref_to_Const'>HASH_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3268"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3270"><span class='Ref_To_Local'>sem</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3268"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN127"><span class='Ref_to_Member'>function_name</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3264"><span class='Ref_to_Parameter'>funcname</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3268"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN128"><span class='Ref_to_Member'>hash</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3267"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3268"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3269"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3270"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3268"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3270"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN86"><span class='Ref_to_Member'>array_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN385"><span class='Ref_to_Proto'>hash_array_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3270"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN386"><span class='Ref_to_Proto'>hash_scalar</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3270"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN88"><span class='Ref_to_Member'>object_field_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN383"><span class='Ref_to_Proto'>hash_object_field_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3270"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN89"><span class='Ref_to_Member'>object_field_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN384"><span class='Ref_to_Proto'>hash_object_field_end</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3269"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3270"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN3267"><span class='Ref_To_Local'>tab</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_json_object_as_hash &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3300"></a><span class='Declare_Function'>hash_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3302"></a>    <a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3300"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3302"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* remember token type */ 
</span>    <a href="jsonfuncs.c.html#LN3302"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN131"><span class='Ref_to_Member'>saved_token_type</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3302"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3302"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN26"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_START</span></a> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN3302"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN24"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_START</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* remember start position of the whole text of the subobject */ 
</span>        <a href="jsonfuncs.c.html#LN3302"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN130"><span class='Ref_to_Member'>save_json_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3302"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* must be a scalar */ 
</span>        <a href="jsonfuncs.c.html#LN3302"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN130"><span class='Ref_to_Member'>save_json_start</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end hash_object_field_start &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3324"></a><span class='Declare_Function'>hash_object_field_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3326"></a>    <a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3324"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN3327"></a>    <a href="jsonfuncs.c.html#LN135"><span class='Ref_to_Struct'>JsonHashEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hashentry</span><span class='Delimiter'>; 
</span><a name="LN3328"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ignore nested fields. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3326"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ignore field names &GT;= NAMEDATALEN - they can't match a record field. 
     * (Note: without this test, the hash code would truncate the string at 
     * NAMEDATALEN-1, and could then match against a similarly-truncated 
     * record field name.  That would be a reasonable behavior, but this code 
     * has previously insisted on exact equality, so we keep this behavior.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3324"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3327"><span class='Ref_To_Local'>hashentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3326"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN128"><span class='Ref_to_Member'>hash</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3324"><span class='Ref_to_Parameter'>fname</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3328"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * found being true indicates a duplicate. We don't do anything about 
     * that, a later field with the same name overrides the earlier field. 
     */ 
</span> 
    <a href="jsonfuncs.c.html#LN3327"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN139"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3326"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN131"><span class='Ref_to_Member'>saved_token_type</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3324"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3327"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN139"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3326"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN130"><span class='Ref_to_Member'>save_json_start</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3358"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3326"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- </span><a href="jsonfuncs.c.html#LN3326"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN130"><span class='Ref_to_Member'>save_json_start</span></a><span class='Delimiter'>; 
</span><a name="LN3359"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN3358"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3359"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3326"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN130"><span class='Ref_to_Member'>save_json_start</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3358"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3359"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3358"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3327"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN138"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3359"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* must have had a scalar instead */ 
</span>        <a href="jsonfuncs.c.html#LN3327"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN138"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3326"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN129"><span class='Ref_to_Member'>saved_scalar</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end hash_object_field_end &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3373"></a><span class='Declare_Function'>hash_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3375"></a>    <a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3373"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3375"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on an array"</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3375"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN127"><span class='Ref_to_Member'>function_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3384"></a><span class='Declare_Function'>hash_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3386"></a>    <a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN124"><span class='Ref_to_Struct'>JHashState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3384"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3386"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on a scalar"</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3386"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN127"><span class='Ref_to_Member'>function_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3386"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN126"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN3386"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN129"><span class='Ref_to_Member'>saved_scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3384"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* saved_token_type must already be set in hash_object_field_start() */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3386"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN131"><span class='Ref_to_Member'>saved_token_type</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN3384"><span class='Ref_to_Parameter'>tokentype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_populate_recordset 
 * 
 * set fields in a set of records from the argument json, 
 * which must be an array of objects. 
 * 
 * similar to json_populate_record, but the tuple-building code 
 * is pushed down into the semantic action handlers so it's done 
 * per object in the array. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3413"></a><span class='Declare_Function'>jsonb_populate_recordset</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN407"><span class='Ref_to_Proto'>populate_recordset_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"jsonb_populate_recordset"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3419"></a><span class='Declare_Function'>jsonb_to_recordset</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN407"><span class='Ref_to_Proto'>populate_recordset_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"jsonb_to_recordset"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3425"></a><span class='Declare_Function'>json_populate_recordset</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN407"><span class='Ref_to_Proto'>populate_recordset_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"json_populate_recordset"</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3431"></a><span class='Declare_Function'>json_to_recordset</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN407"><span class='Ref_to_Proto'>populate_recordset_worker</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='String'>"json_to_recordset"</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3437"></a><span class='Declare_Function'>populate_recordset_record</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>obj</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3439"></a>    <a href="../../../include/access/htup.h.html#LN61"><span class='Ref_to_Struct'>HeapTupleData</span></a> <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3440"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>tuphead</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN413"><span class='Ref_to_Proto'>populate_record</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3437"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN228"><span class='Ref_to_Member'>ret_tdesc</span></a><span class='Delimiter'>, 
</span>                                              <a href="jsonfuncs.c.html#LN3437"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN230"><span class='Ref_to_Member'>my_extra</span></a><span class='Delimiter'>, 
</span>                                              <a href="jsonfuncs.c.html#LN3437"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN229"><span class='Ref_to_Member'>rec</span></a><span class='Delimiter'>, 
</span>                                              <a href="jsonfuncs.c.html#LN3437"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN231"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Delimiter'>, 
</span>                                              <a href="jsonfuncs.c.html#LN3437"><span class='Ref_to_Parameter'>obj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3439"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN63"><span class='Ref_to_Member'>t_len</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN438"><span class='Ref_to_Macro'>HeapTupleHeaderGetDatumLength</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3440"><span class='Ref_To_Local'>tuphead</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/storage/itemptr.h.html#LN148"><span class='Ref_to_Macro'>ItemPointerSetInvalid</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3439"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3439"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN65"><span class='Ref_to_Member'>t_tableOid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3439"><span class='Ref_To_Local'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3440"><span class='Ref_To_Local'>tuphead</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/tuplestore.h.html#LN54"><span class='Ref_to_Proto'>tuplestore_puttuple</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3437"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN227"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3439"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * common worker for json_populate_recordset() and json_to_recordset() 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3458"></a><span class='Declare_Function'>populate_recordset_worker</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>funcname</span><span class='Delimiter'>, 
</span><a name="LN3459"></a>                          <span class='Keyword'>bool </span><span class='Declare_Parameter'>have_record_arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3461"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>json_arg_num</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3459"><span class='Ref_to_Parameter'>have_record_arg</span></a> <span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3462"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>jtype</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3461"><span class='Ref_To_Local'>json_arg_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3463"></a>    <a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>rsi</span><span class='Delimiter'>; 
</span><a name="LN3464"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_cxt</span><span class='Delimiter'>; 
</span><a name="LN3465"></a>    <a href="../../../include/access/htup.h.html#LN22"><span class='Ref_to_Typedef'>HeapTupleHeader</span></a> <span class='Declare_Local'>rec</span><span class='Delimiter'>; 
</span><a name="LN3466"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN3467"></a>    <a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3459"><span class='Ref_to_Parameter'>have_record_arg</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3471"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argtype</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/lsyscache.h.html#LN150"><span class='Ref_to_Proto'>type_is_rowtype</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3471"><span class='Ref_To_Local'>argtype</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"first argument of %s must be a row type"</span><span class='Delimiter'>, 
</span>                            <a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>funcname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN80"><span class='Ref_to_Member'>resultinfo</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a> <span class='Operator'>|| !</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/execnodes.h.html#LN261"><span class='Ref_to_Struct'>ReturnSetInfo</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN266"><span class='Ref_to_Member'>expectedDesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"set-valued function called in context that "</span> 
                        <span class='String'>"cannot accept a set"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN269"><span class='Ref_to_Member'>returnMode</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/execnodes.h.html#LN250"><span class='Ref_to_EnumConst'>SFRM_Materialize</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the tupdesc from the result set info - it must be a record type 
     * because we already checked that arg1 is a record type, or we're in a 
     * to_record function which returns a setof record. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN157"><span class='Ref_to_Proto'>get_call_result_type</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3466"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/funcapi.h.html#LN152"><span class='Ref_to_EnumConst'>TYPEFUNC_COMPOSITE</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"function returning record called in context "</span> 
                        <span class='String'>"that cannot accept type record"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if the json is null send back an empty set */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3461"><span class='Ref_To_Local'>json_arg_num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN3459"><span class='Ref_to_Parameter'>have_record_arg</span></a> <span class='Operator'>|| </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="jsonfuncs.c.html#LN3465"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="jsonfuncs.c.html#LN3465"><span class='Ref_To_Local'>rec</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN275"><span class='Ref_to_Macro'>PG_GETARG_HEAPTUPLEHEADER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* make these in a sufficiently long-lived memory context */ 
</span>    <a href="jsonfuncs.c.html#LN3464"><span class='Ref_To_Local'>old_cxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN265"><span class='Ref_to_Member'>econtext</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN201"><span class='Ref_to_Member'>ecxt_per_query_memory</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN228"><span class='Ref_to_Member'>ret_tdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3466"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN228"><span class='Ref_to_Member'>ret_tdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN227"><span class='Ref_to_Member'>tuple_store</span></a> <span class='Operator'>= </span><a href="../../../include/utils/tuplestore.h.html#LN46"><span class='Ref_to_Proto'>tuplestore_begin_heap</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN267"><span class='Ref_to_Member'>allowedModes</span></a> <span class='Operator'>& 
</span>                                               <a href="../../../include/nodes/execnodes.h.html#LN251"><span class='Ref_to_EnumConst'>SFRM_Materialize_Random</span></a><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN112"><span class='Ref_to_Global_Var'>work_mem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3464"><span class='Ref_To_Local'>old_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN222"><span class='Ref_to_Member'>function_name</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>funcname</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN230"><span class='Ref_to_Member'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN210"><span class='Ref_to_Struct'>RecordIOData</span></a> <span class='Operator'>**</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN229"><span class='Ref_to_Member'>rec</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3465"><span class='Ref_To_Local'>rec</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN231"><span class='Ref_to_Member'>fn_mcxt</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3462"><span class='Ref_To_Local'>jtype</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN355"><span class='Ref_to_Const'>JSONOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3530"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3461"><span class='Ref_To_Local'>json_arg_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3531"></a>        <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span><span class='Delimiter'>; 
</span><a name="LN3532"></a>        <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN3531"><span class='Ref_To_Local'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3530"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN86"><span class='Ref_to_Member'>array_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN394"><span class='Ref_to_Proto'>populate_recordset_array_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN90"><span class='Ref_to_Member'>array_element_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN395"><span class='Ref_to_Proto'>populate_recordset_array_element_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN391"><span class='Ref_to_Proto'>populate_recordset_scalar</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN88"><span class='Ref_to_Member'>object_field_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN389"><span class='Ref_to_Proto'>populate_recordset_object_field_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN89"><span class='Ref_to_Member'>object_field_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN390"><span class='Ref_to_Proto'>populate_recordset_object_field_end</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN84"><span class='Ref_to_Member'>object_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN392"><span class='Ref_to_Proto'>populate_recordset_object_start</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN85"><span class='Ref_to_Member'>object_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN393"><span class='Ref_to_Proto'>populate_recordset_object_end</span></a><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3531"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3531"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3532"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if jtype==JSONOID &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3553"></a>        <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3461"><span class='Ref_To_Local'>json_arg_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3554"></a>        <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN3555"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN3556"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>skipNested</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3557"></a>        <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3462"><span class='Ref_To_Local'>jtype</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN75"><span class='Ref_to_Const'>JSONBOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3553"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>) </span><span class='Operator'>|| !</span><a href="../../../include/utils/jsonb.h.html#LN224"><span class='Ref_to_Macro'>JB_ROOT_IS_ARRAY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3553"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on a non-array"</span><span class='Delimiter'>, 
</span>                            <a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>funcname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN3554"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3553"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN3557"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3554"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3555"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3556"><span class='Ref_To_Local'>skipNested</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN3556"><span class='Ref_To_Local'>skipNested</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3557"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3575"></a>                <a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a>    <span class='Declare_Local'>obj</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3555"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN238"><span class='Ref_to_EnumConst'>jbvBinary</span></a> <span class='Operator'>|| 
</span>                    <span class='Operator'>!</span><a href="../../../include/utils/jsonb.h.html#LN210"><span class='Ref_to_Macro'>JsonContainerIsObject</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3555"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Parentheses'>))</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument of %s must be an array of objects"</span><span class='Delimiter'>, 
</span>                                <a href="jsonfuncs.c.html#LN3458"><span class='Ref_to_Parameter'>funcname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN3575"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN292"><span class='Ref_to_Member'>is_json</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="jsonfuncs.c.html#LN3575"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN297"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN296"><span class='Ref_to_Member'>jsonb_cont</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3555"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>binary<span class='Operator'>.</span>data<span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN431"><span class='Ref_to_Proto'>populate_recordset_record</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3575"><span class='Ref_To_Local'>obj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (r=JsonbIteratorNext(... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN272"><span class='Ref_to_Member'>setResult</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN227"><span class='Ref_to_Member'>tuple_store</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3463"><span class='Ref_To_Local'>rsi</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN273"><span class='Ref_to_Member'>setDesc</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3467"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN228"><span class='Ref_to_Member'>ret_tdesc</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_recordset_worker &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3599"></a><span class='Declare_Function'>populate_recordset_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3601"></a>    <a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3599"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN3602"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_level</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3601"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a><span class='Delimiter'>; 
</span><a name="LN3603"></a>    <a href="../../../include/utils/hsearch.h.html#LN64"><span class='Ref_to_Struct'>HASHCTL</span></a>     <span class='Declare_Local'>ctl</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reject object at top level: we must have an array at level 0 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3602"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on an object"</span><span class='Delimiter'>, 
</span>                        <a href="jsonfuncs.c.html#LN3601"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN222"><span class='Ref_to_Member'>function_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nested objects require no special processing */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3602"><span class='Ref_To_Local'>lex_level</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Object at level 1: set up a new hash table for this object */ 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3603"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3603"><span class='Ref_To_Local'>ctl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3603"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN71"><span class='Ref_to_Member'>keysize</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3603"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN72"><span class='Ref_to_Member'>entrysize</span></a> <span class='Operator'>= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN135"><span class='Ref_to_Struct'>JsonHashEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3603"><span class='Ref_To_Local'>ctl</span></a><span class='Operator'>.</span><a href="../../../include/utils/hsearch.h.html#LN77"><span class='Ref_to_Member'>hcxt</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3601"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN223"><span class='Ref_to_Member'>json_hash</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN121"><span class='Ref_to_Proto'>hash_create</span></a><span class='Parentheses'>(</span><span class='String'>"json object hashtable"</span><span class='Delimiter'>, 
</span>                                    <span class='Number'>100</span><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3603"><span class='Ref_To_Local'>ctl</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/utils/hsearch.h.html#LN86"><span class='Ref_to_Const'>HASH_ELEM</span></a> <span class='Operator'>| </span><a href="../../../include/utils/hsearch.h.html#LN92"><span class='Ref_to_Const'>HASH_CONTEXT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_recordset_object_start &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3628"></a><span class='Declare_Function'>populate_recordset_object_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3630"></a>    <a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3628"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN3631"></a>    <a href="jsonfuncs.c.html#LN290"><span class='Ref_to_Struct'>JsObject</span></a>    <span class='Declare_Local'>obj</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Nested objects require no special processing */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3630"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3631"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN292"><span class='Ref_to_Member'>is_json</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3631"><span class='Ref_To_Local'>obj</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN297"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span><a href="jsonfuncs.c.html#LN295"><span class='Ref_to_Member'>json_hash</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3630"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN223"><span class='Ref_to_Member'>json_hash</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Otherwise, construct and return a tuple based on this level-1 object */ 
</span>    <a href="jsonfuncs.c.html#LN431"><span class='Ref_to_Proto'>populate_recordset_record</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3630"><span class='Ref_To_Local'>_state</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3631"><span class='Ref_To_Local'>obj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Done with hash for this object */ 
</span>    <a href="../../../include/utils/hsearch.h.html#LN123"><span class='Ref_to_Proto'>hash_destroy</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3630"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN223"><span class='Ref_to_Member'>json_hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3630"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN223"><span class='Ref_to_Member'>json_hash</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end populate_recordset_object_end &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3649"></a><span class='Declare_Function'>populate_recordset_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3651"></a>    <a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3649"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3651"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& 
</span>        <a href="jsonfuncs.c.html#LN3651"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonapi.h.html#LN24"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_START</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"argument of %s must be an array of objects"</span><span class='Delimiter'>, 
</span>                        <a href="jsonfuncs.c.html#LN3651"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN222"><span class='Ref_to_Member'>function_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3662"></a><span class='Declare_Function'>populate_recordset_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* nothing to do */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3668"></a><span class='Declare_Function'>populate_recordset_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3670"></a>    <a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3668"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3670"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot call %s on a scalar"</span><span class='Delimiter'>, 
</span>                        <a href="jsonfuncs.c.html#LN3670"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN222"><span class='Ref_to_Member'>function_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3670"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN3670"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN224"><span class='Ref_to_Member'>saved_scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3668"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3683"></a><span class='Declare_Function'>populate_recordset_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3685"></a>    <a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3683"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3685"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3685"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN226"><span class='Ref_to_Member'>saved_token_type</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3685"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3685"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN26"><span class='Ref_to_EnumConst'>JSON_TOKEN_ARRAY_START</span></a> <span class='Operator'>|| 
</span>        <a href="jsonfuncs.c.html#LN3685"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN57"><span class='Ref_to_Member'>token_type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN24"><span class='Ref_to_EnumConst'>JSON_TOKEN_OBJECT_START</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN3685"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN225"><span class='Ref_to_Member'>save_json_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3685"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN54"><span class='Ref_to_Member'>token_start</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN3685"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN225"><span class='Ref_to_Member'>save_json_start</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end populate_recordset_object_field_start &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3704"></a><span class='Declare_Function'>populate_recordset_object_field_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3706"></a>    <a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN219"><span class='Ref_to_Struct'>PopulateRecordsetState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3704"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span><a name="LN3707"></a>    <a href="jsonfuncs.c.html#LN135"><span class='Ref_to_Struct'>JsonHashEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hashentry</span><span class='Delimiter'>; 
</span><a name="LN3708"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ignore nested fields. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3706"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN58"><span class='Ref_to_Member'>lex_level</span></a> <span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ignore field names &GT;= NAMEDATALEN - they can't match a record field. 
     * (Note: without this test, the hash code would truncate the string at 
     * NAMEDATALEN-1, and could then match against a similarly-truncated 
     * record field name.  That would be a reasonable behavior, but this code 
     * has previously insisted on exact equality, so we keep this behavior.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3704"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3707"><span class='Ref_To_Local'>hashentry</span></a> <span class='Operator'>= </span><a href="../../../include/utils/hsearch.h.html#LN125"><span class='Ref_to_Proto'>hash_search</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3706"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN223"><span class='Ref_to_Member'>json_hash</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3704"><span class='Ref_to_Parameter'>fname</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/hsearch.h.html#LN105"><span class='Ref_to_EnumConst'>HASH_ENTER</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3708"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * found being true indicates a duplicate. We don't do anything about 
     * that, a later field with the same name overrides the earlier field. 
     */ 
</span> 
    <a href="jsonfuncs.c.html#LN3707"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN139"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3706"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN226"><span class='Ref_to_Member'>saved_token_type</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3704"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3707"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN139"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3706"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN225"><span class='Ref_to_Member'>save_json_start</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3738"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3706"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN221"><span class='Ref_to_Member'>lex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN56"><span class='Ref_to_Member'>prev_token_terminator</span></a> <span class='Operator'>- </span><a href="jsonfuncs.c.html#LN3706"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN225"><span class='Ref_to_Member'>save_json_start</span></a><span class='Delimiter'>; 
</span><a name="LN3739"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN3738"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3739"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3706"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN225"><span class='Ref_to_Member'>save_json_start</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3738"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3739"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3738"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3707"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN138"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3739"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* must have had a scalar instead */ 
</span>        <a href="jsonfuncs.c.html#LN3707"><span class='Ref_To_Local'>hashentry</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN138"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3706"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN224"><span class='Ref_to_Member'>saved_scalar</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end populate_recordset_object_field_end &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * findJsonbValueFromContainer() wrapper that sets up JsonbValue key string. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>* 
</span><a name="LN3756"></a><span class='Declare_Function'>findJsonbValueFromContainerLen</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN192"><span class='Ref_to_Struct'>JsonbContainer</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>container</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>flags</span><span class='Delimiter'>, 
</span><a name="LN3757"></a>                               <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>keylen</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3759"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3759"><span class='Ref_To_Local'>k</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3759"><span class='Ref_To_Local'>k</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3757"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3759"><span class='Ref_To_Local'>k</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3757"><span class='Ref_to_Parameter'>keylen</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN325"><span class='Ref_to_Func'>findJsonbValueFromContainer</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3756"><span class='Ref_to_Parameter'>container</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3756"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3759"><span class='Ref_To_Local'>k</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Semantic actions for json_strip_nulls. 
 * 
 * Simply repeat the input on the output unless we encounter 
 * a null object field. State for this is set when the field 
 * is started and reset when the scalar action (which must be next) 
 * is called. 
 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3778"></a><span class='Declare_Function'>sn_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3780"></a>    <a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3778"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3780"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3786"></a><span class='Declare_Function'>sn_object_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3788"></a>    <a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3786"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3788"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3794"></a><span class='Declare_Function'>sn_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3796"></a>    <a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3794"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3796"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'['</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3802"></a><span class='Declare_Function'>sn_array_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3804"></a>    <a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3802"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3804"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>']'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3810"></a><span class='Declare_Function'>sn_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3812"></a>    <a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3810"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3810"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The next thing must be a scalar or isnull couldn't be true, so 
         * there is no danger of this state being carried down into a nested 
         * object or array. The flag will be reset in the scalar action. 
         */ 
</span>        <a href="jsonfuncs.c.html#LN3812"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN270"><span class='Ref_to_Member'>skip_next_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3812"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3812"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'{'</span><span class='Parentheses'>) 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3812"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unfortunately we don't have the quoted and escaped string any more, so 
     * we have to re-escape it. 
     */ 
</span>    <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3812"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3810"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3812"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sn_object_field_start &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN3838"></a><span class='Declare_Function'>sn_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3840"></a>    <a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3838"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3840"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN3840"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'['</span><span class='Parentheses'>) 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3840"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN3847"></a><span class='Declare_Function'>sn_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3849"></a>    <a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3847"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3849"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN270"><span class='Ref_to_Member'>skip_next_null</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3847"><span class='Ref_to_Parameter'>tokentype</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN32"><span class='Ref_to_EnumConst'>JSON_TOKEN_NULL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN3849"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN270"><span class='Ref_to_Member'>skip_next_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3847"><span class='Ref_to_Parameter'>tokentype</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3849"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3847"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3849"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3847"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function json_strip_nulls(json) -&GT; json 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3868"></a><span class='Declare_Function'>json_strip_nulls</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3870"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>json</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3871"></a>    <a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN3872"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span><span class='Delimiter'>; 
</span><a name="LN3873"></a>    <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3872"><span class='Ref_To_Local'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3870"><span class='Ref_To_Local'>json</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3871"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN266"><span class='Ref_to_Struct'>StripnullState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3871"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3871"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN270"><span class='Ref_to_Member'>skip_next_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3871"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN268"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3872"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN3871"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN84"><span class='Ref_to_Member'>object_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN398"><span class='Ref_to_Proto'>sn_object_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN85"><span class='Ref_to_Member'>object_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN399"><span class='Ref_to_Proto'>sn_object_end</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN86"><span class='Ref_to_Member'>array_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN400"><span class='Ref_to_Proto'>sn_array_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN87"><span class='Ref_to_Member'>array_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN401"><span class='Ref_to_Proto'>sn_array_end</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN404"><span class='Ref_to_Proto'>sn_scalar</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN90"><span class='Ref_to_Member'>array_element_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN403"><span class='Ref_to_Proto'>sn_array_element_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN88"><span class='Ref_to_Member'>object_field_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN402"><span class='Ref_to_Proto'>sn_object_field_start</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3872"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3873"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3871"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                                              <a href="jsonfuncs.c.html#LN3871"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN269"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end json_strip_nulls &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function jsonb_strip_nulls(jsonb) -&GT; jsonb 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3903"></a><span class='Declare_Function'>jsonb_strip_nulls</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3905"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3906"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN3907"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>parseState</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3908"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3909"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>, 
</span><a name="LN3910"></a>                <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span><a name="LN3911"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN3912"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>last_was_key</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3905"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3905"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3906"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3905"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN3911"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3906"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3909"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3911"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN3912"><span class='Ref_To_Local'>last_was_key</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3911"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* stash the key until we know if it has a null value */ 
</span>            <a href="jsonfuncs.c.html#LN3910"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN3909"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN3912"><span class='Ref_To_Local'>last_was_key</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3912"><span class='Ref_To_Local'>last_was_key</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* if the last element was a key this one can't be */ 
</span>            <a href="jsonfuncs.c.html#LN3912"><span class='Ref_To_Local'>last_was_key</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* skip this field if value is null */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3911"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN3909"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN230"><span class='Ref_to_EnumConst'>jbvNull</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* otherwise, do a delayed push of the key */ 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3907"><span class='Ref_To_Local'>parseState</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3910"><span class='Ref_To_Local'>k</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3911"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN3911"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN3908"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3907"><span class='Ref_To_Local'>parseState</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3911"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3909"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="jsonfuncs.c.html#LN3908"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3907"><span class='Ref_To_Local'>parseState</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3911"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (type=JsonbIteratorNe... &raquo; </span> 
 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3908"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3908"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_strip_nulls &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add values from the jsonb to the parse state. 
 * 
 * If the parse state container is an object, the jsonb is pushed as 
 * a value, not a key. 
 * 
 * This needs to be done using an iterator because pushJsonbValue doesn't 
 * like getting jbvBinary values, so we can't just push jb as a whole. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3965"></a><span class='Declare_Function'>addJsonbToParseState</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>jbps</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jb</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3967"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN3968"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>o</span> <span class='Operator'>= &</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN3965"><span class='Ref_to_Parameter'>jbps</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>contVal<span class='Delimiter'>; 
</span><a name="LN3969"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN3970"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN3967"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3965"><span class='Ref_to_Parameter'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3968"><span class='Ref_To_Local'>o</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN3968"><span class='Ref_To_Local'>o</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3965"><span class='Ref_to_Parameter'>jb</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3967"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3969"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* skip array header */ 
</span>        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3967"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3969"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* fetch scalar value */ 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3968"><span class='Ref_To_Local'>o</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Operator'>: 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3965"><span class='Ref_to_Parameter'>jbps</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3969"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN236"><span class='Ref_to_EnumConst'>jbvObject</span></a><span class='Operator'>: 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3965"><span class='Ref_to_Parameter'>jbps</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3969"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected parent of nested structure"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN3970"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3967"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3969"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3970"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN3970"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN3970"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>) 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3965"><span class='Ref_to_Parameter'>jbps</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3970"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN3969"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN3965"><span class='Ref_to_Parameter'>jbps</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN3970"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end addJsonbToParseState &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function jsonb_pretty (jsonb) 
 * 
 * Pretty-printed text for the jsonb 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4012"></a><span class='Declare_Function'>jsonb_pretty</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4014"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4015"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonb.h.html#LN376"><span class='Ref_to_Proto'>JsonbToCStringIndent</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4015"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4014"><span class='Ref_To_Local'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4014"><span class='Ref_To_Local'>jb</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4015"><span class='Ref_To_Local'>str</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4015"><span class='Ref_To_Local'>str</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SQL function jsonb_concat (jsonb, jsonb) 
 * 
 * function for || operator 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4028"></a><span class='Declare_Function'>jsonb_concat</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4030"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb1</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4031"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>jb2</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4032"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4033"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4034"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it1</span><span class='Delimiter'>, 
</span><a name="LN4035"></a>               <span class='Operator'>*</span><span class='Declare_Local'>it2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If one of the jsonb is empty, just return the other if it's not scalar 
     * and both are of the same kind.  If it's a scalar or they are of 
     * different kinds we need to perform the concatenation even if one is 
     * empty. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN223"><span class='Ref_to_Macro'>JB_ROOT_IS_OBJECT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4030"><span class='Ref_To_Local'>jb1</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN223"><span class='Ref_to_Macro'>JB_ROOT_IS_OBJECT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4031"><span class='Ref_To_Local'>jb2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4030"><span class='Ref_To_Local'>jb1</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4031"><span class='Ref_To_Local'>jb2</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4031"><span class='Ref_To_Local'>jb2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4031"><span class='Ref_To_Local'>jb2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4030"><span class='Ref_To_Local'>jb1</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4030"><span class='Ref_To_Local'>jb1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="jsonfuncs.c.html#LN4034"><span class='Ref_To_Local'>it1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4030"><span class='Ref_To_Local'>jb1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4035"><span class='Ref_To_Local'>it2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4031"><span class='Ref_To_Local'>jb2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4033"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN451"><span class='Ref_to_Proto'>IteratorConcat</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4034"><span class='Ref_To_Local'>it1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4035"><span class='Ref_To_Local'>it2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4032"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4033"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4033"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_concat &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function jsonb_delete (jsonb, text) 
 * 
 * return a copy of the jsonb with the indicated item 
 * removed. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4069"></a><span class='Declare_Function'>jsonb_delete</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4071"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4072"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4073"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>keyptr</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4072"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4074"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>keylen</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4072"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4075"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4076"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN4077"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>, 
</span><a name="LN4078"></a>               <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4079"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skipNested</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4080"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4071"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot delete from scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4071"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4071"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4076"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4071"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4080"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4076"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4077"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4079"><span class='Ref_To_Local'>skipNested</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN4079"><span class='Ref_To_Local'>skipNested</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4080"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4080"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4077"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4074"><span class='Ref_To_Local'>keylen</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4077"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>&& 
</span>             memcmp<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4073"><span class='Ref_To_Local'>keyptr</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4077"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4074"><span class='Ref_To_Local'>keylen</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* skip corresponding value as well */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4080"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4076"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4077"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="jsonfuncs.c.html#LN4078"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4075"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4080"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4080"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4077"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4078"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4078"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_delete &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function jsonb_delete (jsonb, variadic text[]) 
 * 
 * return a copy of the jsonb with the indicated items 
 * removed. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4122"></a><span class='Declare_Function'>jsonb_delete_array</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4124"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4125"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>keys</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4126"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>keys_elems</span><span class='Delimiter'>; 
</span><a name="LN4127"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>keys_nulls</span><span class='Delimiter'>; 
</span><a name="LN4128"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>keys_len</span><span class='Delimiter'>; 
</span><a name="LN4129"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4130"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN4131"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>, 
</span><a name="LN4132"></a>               <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4133"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>skipNested</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4134"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4125"><span class='Ref_To_Local'>keys</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4124"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot delete from scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4124"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4124"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4125"><span class='Ref_To_Local'>keys</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4126"><span class='Ref_To_Local'>keys_elems</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4127"><span class='Ref_To_Local'>keys_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4128"><span class='Ref_To_Local'>keys_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4128"><span class='Ref_To_Local'>keys_len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4124"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4130"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4124"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4134"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4130"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4131"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4133"><span class='Ref_To_Local'>skipNested</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="jsonfuncs.c.html#LN4133"><span class='Ref_To_Local'>skipNested</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4134"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4134"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4131"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN4163"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4164"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4163"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN4163"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN4128"><span class='Ref_To_Local'>keys_len</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN4163"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4168"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>keyptr</span><span class='Delimiter'>; 
</span><a name="LN4169"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>keylen</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4127"><span class='Ref_To_Local'>keys_nulls</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4163"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN4168"><span class='Ref_To_Local'>keyptr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4126"><span class='Ref_To_Local'>keys_elems</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4163"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="jsonfuncs.c.html#LN4169"><span class='Ref_To_Local'>keylen</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4126"><span class='Ref_To_Local'>keys_elems</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4163"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4169"><span class='Ref_To_Local'>keylen</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4131"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>&& 
</span>                    memcmp<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4168"><span class='Ref_To_Local'>keyptr</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4131"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4169"><span class='Ref_To_Local'>keylen</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="jsonfuncs.c.html#LN4164"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4164"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* skip corresponding value as well */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4134"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4130"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4131"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (r==WJB_ELEM||r==WJB_... &raquo; </span> 
 
        <a href="jsonfuncs.c.html#LN4132"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4129"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4134"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4134"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4131"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (r=JsonbIteratorNext(... &raquo; </span> 
 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4132"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4132"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_delete_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function jsonb_delete (jsonb, int) 
 * 
 * return a copy of the jsonb with the indicated item 
 * removed. Negative int means count back from the 
 * end of the items. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4209"></a><span class='Declare_Function'>jsonb_delete_idx</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4211"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4212"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4213"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4214"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN4215"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN4216"></a>                <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span><a name="LN4217"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>, 
</span><a name="LN4218"></a>               <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4219"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4211"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot delete from scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN223"><span class='Ref_to_Macro'>JB_ROOT_IS_OBJECT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4211"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot delete from object using integer index"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4211"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4211"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4214"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4211"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4219"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4214"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4217"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4219"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4216"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4217"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4212"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span><a href="jsonfuncs.c.html#LN4212"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&GT; </span><a href="jsonfuncs.c.html#LN4216"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN4212"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4216"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="jsonfuncs.c.html#LN4212"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4216"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>+ </span><a href="jsonfuncs.c.html#LN4212"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4212"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&GT;= </span><a href="jsonfuncs.c.html#LN4216"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4211"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4213"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4219"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4219"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4214"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4217"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4219"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4215"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++ == </span><a href="jsonfuncs.c.html#LN4212"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="jsonfuncs.c.html#LN4218"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4213"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4219"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4219"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4217"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4218"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4218"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_delete_idx &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function jsonb_set(jsonb, text[], jsonb, boolean) 
 * 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4274"></a><span class='Declare_Function'>jsonb_set</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4276"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4277"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>path</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4278"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4279"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>create</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4280"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4281"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>path_elems</span><span class='Delimiter'>; 
</span><a name="LN4282"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>path_nulls</span><span class='Delimiter'>; 
</span><a name="LN4283"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>path_len</span><span class='Delimiter'>; 
</span><a name="LN4284"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN4285"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>st</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4277"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4276"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot set path in scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4276"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="jsonfuncs.c.html#LN4279"><span class='Ref_To_Local'>create</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4276"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4277"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4281"><span class='Ref_To_Local'>path_elems</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4282"><span class='Ref_To_Local'>path_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4283"><span class='Ref_To_Local'>path_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4283"><span class='Ref_To_Local'>path_len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4276"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4284"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4276"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4280"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN453"><span class='Ref_to_Proto'>setPath</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4284"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4281"><span class='Ref_To_Local'>path_elems</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4282"><span class='Ref_To_Local'>path_nulls</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4283"><span class='Ref_To_Local'>path_len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4285"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, 
</span>                  <span class='Number'>0</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4278"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4279"><span class='Ref_To_Local'>create</span></a> <span class='Operator'>? </span><a href="jsonfuncs.c.html#LN37"><span class='Ref_to_Const'>JB_PATH_CREATE</span></a> <span class='Operator'>: </span><a href="jsonfuncs.c.html#LN39"><span class='Ref_to_Const'>JB_PATH_REPLACE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4280"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4280"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_set &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function jsonb_delete_path(jsonb, text[]) 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4321"></a><span class='Declare_Function'>jsonb_delete_path</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4323"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4324"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>path</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4325"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4326"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>path_elems</span><span class='Delimiter'>; 
</span><a name="LN4327"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>path_nulls</span><span class='Delimiter'>; 
</span><a name="LN4328"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>path_len</span><span class='Delimiter'>; 
</span><a name="LN4329"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN4330"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>st</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4324"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4323"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot delete path in scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN221"><span class='Ref_to_Macro'>JB_ROOT_COUNT</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4323"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4323"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4324"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4326"><span class='Ref_To_Local'>path_elems</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4327"><span class='Ref_To_Local'>path_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4328"><span class='Ref_To_Local'>path_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4328"><span class='Ref_To_Local'>path_len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4323"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4329"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4323"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4325"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN453"><span class='Ref_to_Proto'>setPath</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4329"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4326"><span class='Ref_To_Local'>path_elems</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4327"><span class='Ref_To_Local'>path_nulls</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4328"><span class='Ref_To_Local'>path_len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4330"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, 
</span>                  <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN38"><span class='Ref_to_Const'>JB_PATH_DELETE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4325"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4325"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_delete_path &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL function jsonb_insert(jsonb, text[], jsonb, boolean) 
 * 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4366"></a><span class='Declare_Function'>jsonb_insert</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4368"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4369"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>path</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4370"></a>    <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN69"><span class='Ref_to_Macro'>PG_GETARG_JSONB</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4371"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>after</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4372"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4373"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>path_elems</span><span class='Delimiter'>; 
</span><a name="LN4374"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>path_nulls</span><span class='Delimiter'>; 
</span><a name="LN4375"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>path_len</span><span class='Delimiter'>; 
</span><a name="LN4376"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN4377"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>st</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4369"><span class='Ref_To_Local'>path</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"wrong number of array subscripts"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN222"><span class='Ref_to_Macro'>JB_ROOT_IS_SCALAR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4368"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot set path in scalar"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4369"><span class='Ref_To_Local'>path</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4373"><span class='Ref_To_Local'>path_elems</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4374"><span class='Ref_To_Local'>path_nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4375"><span class='Ref_To_Local'>path_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4375"><span class='Ref_To_Local'>path_len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4368"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4376"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4368"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4372"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN453"><span class='Ref_to_Proto'>setPath</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4376"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4373"><span class='Ref_To_Local'>path_elems</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4374"><span class='Ref_To_Local'>path_nulls</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4375"><span class='Ref_To_Local'>path_len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4377"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4370"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>, 
</span>                  <a href="jsonfuncs.c.html#LN4371"><span class='Ref_To_Local'>after</span></a> <span class='Operator'>? </span><a href="jsonfuncs.c.html#LN41"><span class='Ref_to_Const'>JB_PATH_INSERT_AFTER</span></a> <span class='Operator'>: </span><a href="jsonfuncs.c.html#LN40"><span class='Ref_to_Const'>JB_PATH_INSERT_BEFORE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4372"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonb.h.html#LN70"><span class='Ref_to_Macro'>PG_RETURN_JSONB</span></a><span class='Parentheses'>(</span><a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4372"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end jsonb_insert &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Iterate over all jsonb objects and merge them into one. 
 * The logic of this function copied from the same hstore function, 
 * except the case, when it1 & it2 represents jbvObject. 
 * In that case we just append the content of it2 to it1 without any 
 * verifications. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>* 
</span><a name="LN4413"></a><span class='Declare_Function'>IteratorConcat</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it1</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it2</span><span class='Delimiter'>, 
</span><a name="LN4414"></a>               <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4416"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v1</span><span class='Delimiter'>, 
</span><a name="LN4417"></a>                <span class='Declare_Local'>v2</span><span class='Delimiter'>, 
</span><a name="LN4418"></a>               <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4419"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r1</span><span class='Delimiter'>, 
</span><a name="LN4420"></a>                <span class='Declare_Local'>r2</span><span class='Delimiter'>, 
</span><a name="LN4421"></a>                <span class='Declare_Local'>rk1</span><span class='Delimiter'>, 
</span><a name="LN4422"></a>                <span class='Declare_Local'>rk2</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4421"><span class='Ref_To_Local'>rk1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4416"><span class='Ref_To_Local'>v1</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4422"><span class='Ref_To_Local'>rk2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4417"><span class='Ref_To_Local'>v2</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Both elements are objects. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4421"><span class='Ref_To_Local'>rk1</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4422"><span class='Ref_To_Local'>rk2</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Append the all tokens from v1 to res, except last WJB_END_OBJECT 
         * (because res will not be finished yet). 
         */ 
</span>        <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4416"><span class='Ref_To_Local'>v1</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4416"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Append the all tokens from v2 to res, include last WJB_END_OBJECT 
         * (the concatenation will be completed). 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4417"><span class='Ref_To_Local'>v2</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="jsonfuncs.c.html#LN4418"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4417"><span class='Ref_To_Local'>v2</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Both elements are arrays (either can be scalar). 
     */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4421"><span class='Ref_To_Local'>rk1</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4422"><span class='Ref_To_Local'>rk2</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4416"><span class='Ref_To_Local'>v1</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4416"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4417"><span class='Ref_To_Local'>v2</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4417"><span class='Ref_To_Local'>v2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="jsonfuncs.c.html#LN4418"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL </span><span class='Comment_Multi_Line'>/* signal to sort */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* have we got array || object or object || array? */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="jsonfuncs.c.html#LN4421"><span class='Ref_To_Local'>rk1</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>&& !</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>isScalar<span class='Parentheses'>)</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4422"><span class='Ref_To_Local'>rk2</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>             <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4421"><span class='Ref_To_Local'>rk1</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4422"><span class='Ref_To_Local'>rk2</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>&& !</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>isScalar<span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span> 
<a name="LN4474"></a>        <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Local'>it_array</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4421"><span class='Ref_To_Local'>rk1</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? </span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it1</span></a> <span class='Operator'>: </span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it2</span></a><span class='Delimiter'>; 
</span><a name="LN4475"></a>        <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Local'>it_object</span> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4421"><span class='Ref_To_Local'>rk1</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a> <span class='Operator'>? </span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it1</span></a> <span class='Operator'>: </span><a href="jsonfuncs.c.html#LN4413"><span class='Ref_to_Parameter'>it2</span></a><span class='Delimiter'>; 
</span> 
<a name="LN4477"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>prepend</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4421"><span class='Ref_To_Local'>rk1</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4477"><span class='Ref_To_Local'>prepend</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4475"><span class='Ref_To_Local'>it_object</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4416"><span class='Ref_To_Local'>v1</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4416"><span class='Ref_To_Local'>v1</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4474"><span class='Ref_To_Local'>it_array</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4417"><span class='Ref_To_Local'>v2</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="jsonfuncs.c.html#LN4418"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4417"><span class='Ref_To_Local'>v2</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4474"><span class='Ref_To_Local'>it_array</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4416"><span class='Ref_To_Local'>v1</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4419"><span class='Ref_To_Local'>r1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4416"><span class='Ref_To_Local'>v1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4475"><span class='Ref_To_Local'>it_object</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4417"><span class='Ref_To_Local'>v2</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4420"><span class='Ref_To_Local'>r2</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4417"><span class='Ref_To_Local'>v2</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="jsonfuncs.c.html#LN4418"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4414"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ((rk1==WJB_BEGIN_ARRA... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * This must be scalar || object or object || scalar, as that's all 
         * that's left. Both of these make no sense, so error out. 
         */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid concatenation of jsonb objects"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN4418"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end IteratorConcat &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Do most of the heavy work for jsonb_set/jsonb_insert 
 * 
 * If JB_PATH_DELETE bit is set in op_type, the element is to be removed. 
 * 
 * If any bit mentioned in JB_PATH_CREATE_OR_INSERT is set in op_type, 
 * we create the new value if the key or array index does not exist. 
 * 
 * Bits JB_PATH_INSERT_BEFORE and JB_PATH_INSERT_AFTER in op_type 
 * behave as JB_PATH_CREATE if new value is inserted in JsonbObject. 
 * 
 * All path elements before the last must already exist 
 * whatever bits in op_type are set, or nothing is done. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>* 
</span><a name="LN4531"></a><span class='Declare_Function'>setPath</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path_elems</span><span class='Delimiter'>, 
</span><a name="LN4532"></a>        <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>path_nulls</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>path_len</span><span class='Delimiter'>, 
</span><a name="LN4533"></a>        <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>op_type</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4535"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN4536"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span><a name="LN4537"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4532"><span class='Ref_to_Parameter'>path_nulls</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"path element at position %d is null"</span><span class='Delimiter'>, 
</span>                        <a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4531"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4535"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a><span class='Operator'>: 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN461"><span class='Ref_to_Proto'>setPathArray</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4531"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4531"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4532"><span class='Ref_to_Parameter'>path_nulls</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4532"><span class='Ref_to_Parameter'>path_len</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, 
</span>                         <a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4535"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>nElems<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>op_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4531"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4535"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN4537"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Operator'>: 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN457"><span class='Ref_to_Proto'>setPathObject</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4531"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4531"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4532"><span class='Ref_to_Parameter'>path_nulls</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4532"><span class='Ref_to_Parameter'>path_len</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, 
</span>                          <a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4535"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>object<span class='Operator'>.</span>nPairs<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>op_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4531"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4535"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN4537"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a><span class='Operator'>: 
</span>            <a href="jsonfuncs.c.html#LN4537"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4533"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4535"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized iterator result: %d"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4536"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN4537"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch r &raquo; </span> 
 
    <span class='Control'>return</span> <a href="jsonfuncs.c.html#LN4537"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setPath &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Object walker for setPath 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4584"></a><span class='Declare_Function'>setPathObject</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path_elems</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>path_nulls</span><span class='Delimiter'>, 
</span><a name="LN4585"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>path_len</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, 
</span><a name="LN4586"></a>              <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>npairs</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>op_type</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4588"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN4589"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4590"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span><a name="LN4591"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>done</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>&GT;= </span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>path_len</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>path_nulls</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN4591"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* empty object is a special case for create */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>npairs</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>op_type</span></a> <span class='Operator'>& </span><a href="jsonfuncs.c.html#LN42"><span class='Ref_to_Const'>JB_PATH_CREATE_OR_INSERT</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>path_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4600"></a>        <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>newkey</span><span class='Delimiter'>; 
</span> 
        <a href="jsonfuncs.c.html#LN4600"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN4600"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN4600"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4600"><span class='Ref_To_Local'>newkey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN464"><span class='Ref_to_Proto'>addJsonbToParseState</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4589"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN4589"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>npairs</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN4589"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4612"></a>        <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4590"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="jsonfuncs.c.html#LN4591"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>&& 
</span>            <a href="jsonfuncs.c.html#LN4590"><span class='Ref_To_Local'>k</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>== </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>&& 
</span>            memcmp<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4590"><span class='Ref_To_Local'>k</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="jsonfuncs.c.html#LN4590"><span class='Ref_To_Local'>k</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>path_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * called from jsonb_insert(), it forbids redefining an 
                 * existing value 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>op_type</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN40"><span class='Ref_to_Const'>JB_PATH_INSERT_BEFORE</span></a> <span class='Operator'>| </span><a href="jsonfuncs.c.html#LN41"><span class='Ref_to_Const'>JB_PATH_INSERT_AFTER</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot replace existing key"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Try using the function jsonb_set "</span> 
                                     <span class='String'>"to replace key value."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4588"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* skip value */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>op_type</span></a> <span class='Operator'>& </span><a href="jsonfuncs.c.html#LN38"><span class='Ref_to_Const'>JB_PATH_DELETE</span></a><span class='Parentheses'>))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4590"><span class='Ref_To_Local'>k</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="jsonfuncs.c.html#LN464"><span class='Ref_to_Proto'>addJsonbToParseState</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="jsonfuncs.c.html#LN4591"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if level==path_len-1 &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4590"><span class='Ref_To_Local'>k</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="jsonfuncs.c.html#LN453"><span class='Ref_to_Proto'>setPath</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>path_nulls</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>path_len</span></a><span class='Delimiter'>, 
</span>                        <a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>op_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !done&&k.val.string.l... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>op_type</span></a> <span class='Operator'>& </span><a href="jsonfuncs.c.html#LN42"><span class='Ref_to_Const'>JB_PATH_CREATE_OR_INSERT</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="jsonfuncs.c.html#LN4591"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>&& 
</span>                <a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>path_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4589"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>npairs</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN4654"></a>                <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>newkey</span><span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN4654"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Delimiter'>; 
</span>                <a href="jsonfuncs.c.html#LN4654"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="jsonfuncs.c.html#LN4654"><span class='Ref_To_Local'>newkey</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4654"><span class='Ref_To_Local'>newkey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="jsonfuncs.c.html#LN464"><span class='Ref_to_Proto'>addJsonbToParseState</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4586"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4590"><span class='Ref_To_Local'>k</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4588"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4588"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4669"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>walking_level</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4669"><span class='Ref_To_Local'>walking_level</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4584"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4588"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>++</span><a href="jsonfuncs.c.html#LN4669"><span class='Ref_To_Local'>walking_level</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>--</span><a href="jsonfuncs.c.html#LN4669"><span class='Ref_To_Local'>walking_level</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4585"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4612"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4588"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;npairs;i++ &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end setPathObject &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Array walker for setPath 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4691"></a><span class='Declare_Function'>setPathArray</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>it</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>path_elems</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>path_nulls</span><span class='Delimiter'>, 
</span><a name="LN4692"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>path_len</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>st</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, 
</span><a name="LN4693"></a>             <a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>newval</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>nelems</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>op_type</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4695"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN4696"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span><span class='Delimiter'>, 
</span><a name="LN4697"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4698"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>done</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* pick correct index */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>path_len</span></a> <span class='Operator'>&& !</span><a href="jsonfuncs.c.html#LN4691"><span class='Ref_to_Parameter'>path_nulls</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4703"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>c</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4691"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4704"></a>        <span class='Keyword'>long</span>        <span class='Declare_Local'>lindex</span><span class='Delimiter'>; 
</span><a name="LN4705"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>badp</span><span class='Delimiter'>; 
</span> 
        errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN4704"><span class='Ref_To_Local'>lindex</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4703"><span class='Ref_To_Local'>c</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4705"><span class='Ref_To_Local'>badp</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>errno <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4705"><span class='Ref_To_Local'>badp</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4703"><span class='Ref_To_Local'>c</span></a> <span class='Operator'>|| *</span><a href="jsonfuncs.c.html#LN4705"><span class='Ref_To_Local'>badp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4704"><span class='Ref_To_Local'>lindex</span></a> <span class='Operator'>&GT; </span>INT_MAX <span class='Operator'>|| 
</span>            <a href="jsonfuncs.c.html#LN4704"><span class='Ref_To_Local'>lindex</span></a> <span class='Operator'>&LT; </span>INT_MIN<span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"path element at position %d is not an integer: \"%s\""</span><span class='Delimiter'>, 
</span>                     <a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4703"><span class='Ref_To_Local'>c</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4704"><span class='Ref_To_Local'>lindex</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>nelems</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>-</span><a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&GT; </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>nelems</span></a><span class='Parentheses'>) 
</span>            <a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span>INT_MIN<span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>nelems</span></a> <span class='Operator'>+ </span><a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&GT; </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>nelems</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>nelems</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if we're creating, and idx == INT_MIN, we prepend the new value to the 
     * array also if the array is empty - in which case we don't really care 
     * what the idx value is 
     */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>== </span>INT_MIN <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>nelems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>path_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>op_type</span></a> <span class='Operator'>& </span><a href="jsonfuncs.c.html#LN42"><span class='Ref_to_Const'>JB_PATH_CREATE_OR_INSERT</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN464"><span class='Ref_to_Proto'>addJsonbToParseState</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="jsonfuncs.c.html#LN4698"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* iterate over the array elements */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4697"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN4697"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>nelems</span></a><span class='Delimiter'>; </span><a href="jsonfuncs.c.html#LN4697"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4748"></a>        <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4697"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4696"><span class='Ref_To_Local'>idx</span></a> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>&LT; </span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>path_len</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>path_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4691"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4695"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* skip */ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>op_type</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN40"><span class='Ref_to_Const'>JB_PATH_INSERT_BEFORE</span></a> <span class='Operator'>| </span><a href="jsonfuncs.c.html#LN37"><span class='Ref_to_Const'>JB_PATH_CREATE</span></a><span class='Parentheses'>))</span> 
                    <a href="jsonfuncs.c.html#LN464"><span class='Ref_to_Proto'>addJsonbToParseState</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We should keep current value only in case of 
                 * JB_PATH_INSERT_BEFORE or JB_PATH_INSERT_AFTER because 
                 * otherwise it should be deleted or replaced 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>op_type</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN41"><span class='Ref_to_Const'>JB_PATH_INSERT_AFTER</span></a> <span class='Operator'>| </span><a href="jsonfuncs.c.html#LN40"><span class='Ref_to_Const'>JB_PATH_INSERT_BEFORE</span></a><span class='Parentheses'>))</span> 
                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4695"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>op_type</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN41"><span class='Ref_to_Const'>JB_PATH_INSERT_AFTER</span></a> <span class='Operator'>| </span><a href="jsonfuncs.c.html#LN39"><span class='Ref_to_Const'>JB_PATH_REPLACE</span></a><span class='Parentheses'>))</span> 
                    <a href="jsonfuncs.c.html#LN464"><span class='Ref_to_Proto'>addJsonbToParseState</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="jsonfuncs.c.html#LN4698"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if level==path_len-1 &raquo; </span> 
            <span class='Control'>else</span> 
                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN453"><span class='Ref_to_Proto'>setPath</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4691"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4691"><span class='Ref_to_Parameter'>path_elems</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4691"><span class='Ref_to_Parameter'>path_nulls</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>path_len</span></a><span class='Delimiter'>, 
</span>                               <a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>op_type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if i==idx&&level&LT;path_le... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4691"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4695"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4695"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4784"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>walking_level</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4784"><span class='Ref_To_Local'>walking_level</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4691"><span class='Ref_to_Parameter'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4695"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN27"><span class='Ref_to_EnumConst'>WJB_BEGIN_OBJECT</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>++</span><a href="jsonfuncs.c.html#LN4784"><span class='Ref_To_Local'>walking_level</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN26"><span class='Ref_to_EnumConst'>WJB_END_ARRAY</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN28"><span class='Ref_to_EnumConst'>WJB_END_OBJECT</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>--</span><a href="jsonfuncs.c.html#LN4784"><span class='Ref_To_Local'>walking_level</span></a><span class='Delimiter'>; 
</span> 
                    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4748"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4695"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>op_type</span></a> <span class='Operator'>& </span><a href="jsonfuncs.c.html#LN42"><span class='Ref_to_Const'>JB_PATH_CREATE_OR_INSERT</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="jsonfuncs.c.html#LN4698"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>&& 
</span>                <a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>level</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>path_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4697"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>nelems</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="jsonfuncs.c.html#LN464"><span class='Ref_to_Proto'>addJsonbToParseState</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4692"><span class='Ref_to_Parameter'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4693"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nelems;i++ &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end setPathArray &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Iterate over jsonb string values or elements, and pass them together with an 
 * iteration state to a specified JsonIterateStringValuesAction. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4813"></a><span class='Declare_Function'>iterate_jsonb_string_values</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jb</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN135"><span class='Ref_to_Typedef'>JsonIterateStringValuesAction</span></a> <span class='Declare_Parameter'>action</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4815"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN4816"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN4817"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4815"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4813"><span class='Ref_to_Parameter'>jb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4817"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4815"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4816"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4817"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4817"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4816"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN4813"><span class='Ref_to_Parameter'>action</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4813"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4816"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4816"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Iterate over json string values or elements, and pass them together with an 
 * iteration state to a specified JsonIterateStringValuesAction. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4835"></a><span class='Declare_Function'>iterate_json_string_values</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>action_state</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN135"><span class='Ref_to_Typedef'>JsonIterateStringValuesAction</span></a> <span class='Declare_Parameter'>action</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4837"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4835"><span class='Ref_to_Parameter'>json</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4838"></a>    <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN4839"></a>    <a href="jsonfuncs.c.html#LN56"><span class='Ref_to_Struct'>IterateJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN56"><span class='Ref_to_Struct'>IterateJsonStringValuesState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4839"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN58"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4837"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4839"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN59"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4835"><span class='Ref_to_Parameter'>action</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4839"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN61"><span class='Ref_to_Member'>action_state</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4835"><span class='Ref_to_Parameter'>action_state</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4838"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4839"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4838"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN467"><span class='Ref_to_Proto'>iterate_string_values_scalar</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4837"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4838"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * An auxiliary function for iterate_json_string_values to invoke a specified 
 * JsonIterateStringValuesAction. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4856"></a><span class='Declare_Function'>iterate_string_values_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4858"></a>    <a href="jsonfuncs.c.html#LN56"><span class='Ref_to_Struct'>IterateJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN56"><span class='Ref_to_Struct'>IterateJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4856"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4856"><span class='Ref_to_Parameter'>tokentype</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>) 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN4858"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN59"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>) (</span><a href="jsonfuncs.c.html#LN4858"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN61"><span class='Ref_to_Member'>action_state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4856"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4856"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Iterate over a jsonb, and apply a specified JsonTransformStringValuesAction 
 * to every string value or element. Any necessary context for a 
 * JsonTransformStringValuesAction can be passed in the action_state variable. 
 * Function returns a copy of an original jsonb object with transformed values. 
 */ 
</span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>* 
</span><a name="LN4871"></a><span class='Declare_Function'>transform_jsonb_string_values</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonb.h.html#LN214"><span class='Ref_to_Typedef'>Jsonb</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>jsonb</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>action_state</span><span class='Delimiter'>, 
</span><a name="LN4872"></a>                            <a href="../../../include/utils/jsonapi.h.html#LN138"><span class='Ref_to_Typedef'>JsonTransformStringValuesAction</span></a> <span class='Declare_Parameter'>transform_action</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4874"></a>    <a href="../../../include/utils/jsonb.h.html#LN323"><span class='Ref_to_Struct'>JsonbIterator</span></a> <span class='Operator'>*</span><span class='Declare_Local'>it</span><span class='Delimiter'>; 
</span><a name="LN4875"></a>    <a href="../../../include/utils/jsonb.h.html#LN247"><span class='Ref_to_Struct'>JsonbValue</span></a>  <span class='Declare_Local'>v</span><span class='Delimiter'>, 
</span><a name="LN4876"></a>               <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4877"></a>    <a href="../../../include/utils/jsonb.h.html#LN19"><span class='Ref_to_Typedef'>JsonbIteratorToken</span></a> <span class='Declare_Local'>type</span><span class='Delimiter'>; 
</span><a name="LN4878"></a>    <a href="../../../include/utils/jsonb.h.html#LN303"><span class='Ref_to_Struct'>JsonbParseState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>st</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4879"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN4880"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_scalar</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4874"><span class='Ref_To_Local'>it</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN365"><span class='Ref_to_Proto'>JsonbIteratorInit</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4871"><span class='Ref_to_Parameter'>jsonb</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN217"><span class='Ref_to_Member'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4880"><span class='Ref_To_Local'>is_scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4874"><span class='Ref_To_Local'>it</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN329"><span class='Ref_to_Member'>isScalar</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4877"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN366"><span class='Ref_to_Proto'>JsonbIteratorNext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4874"><span class='Ref_To_Local'>it</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4875"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><a href="../../../include/utils/jsonb.h.html#LN21"><span class='Ref_to_EnumConst'>WJB_DONE</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="jsonfuncs.c.html#LN4877"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a> <span class='Operator'>|| </span><a href="jsonfuncs.c.html#LN4877"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="jsonfuncs.c.html#LN4875"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN231"><span class='Ref_to_EnumConst'>jbvString</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN4879"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4872"><span class='Ref_to_Parameter'>transform_action</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4871"><span class='Ref_to_Parameter'>action_state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4875"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val<span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4875"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN4875"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>val <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4879"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN4875"><span class='Ref_To_Local'>v</span></a><span class='Operator'>.</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>string<span class='Operator'>.</span>len <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4879"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="jsonfuncs.c.html#LN4876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4878"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4877"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4877"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>&LT; </span><a href="../../../include/utils/jsonb.h.html#LN25"><span class='Ref_to_EnumConst'>WJB_BEGIN_ARRAY</span></a> <span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4875"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="jsonfuncs.c.html#LN4876"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/jsonb.h.html#LN363"><span class='Ref_to_Proto'>pushJsonbValue</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="jsonfuncs.c.html#LN4878"><span class='Ref_To_Local'>st</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4877"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4877"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN22"><span class='Ref_to_EnumConst'>WJB_KEY</span></a> <span class='Operator'>|| 
</span>                                             <a href="jsonfuncs.c.html#LN4877"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN23"><span class='Ref_to_EnumConst'>WJB_VALUE</span></a> <span class='Operator'>|| 
</span>                                             <a href="jsonfuncs.c.html#LN4877"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN24"><span class='Ref_to_EnumConst'>WJB_ELEM</span></a><span class='Parentheses'>) </span><span class='Operator'>? &</span><a href="jsonfuncs.c.html#LN4875"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4876"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN249"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonb.h.html#LN235"><span class='Ref_to_EnumConst'>jbvArray</span></a><span class='Parentheses'>) 
</span>        <a href="jsonfuncs.c.html#LN4876"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonb.h.html#LN279"><span class='Ref_to_Member'>val</span></a><span class='Operator'>.</span>array<span class='Operator'>.</span>rawScalar <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4880"><span class='Ref_To_Local'>is_scalar</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="jsonb_util.c.html#LN77"><span class='Ref_to_Func'>JsonbValueToJsonb</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4876"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end transform_jsonb_string_values &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Iterate over a json, and apply a specified JsonTransformStringValuesAction 
 * to every string value or element. Any necessary context for a 
 * JsonTransformStringValuesAction can be passed in the action_state variable. 
 * Function returns a StringInfo, which is a copy of an original json with 
 * transformed values. 
 */ 
</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN4916"></a><span class='Declare_Function'>transform_json_string_values</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>json</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>action_state</span><span class='Delimiter'>, 
</span><a name="LN4917"></a>                             <a href="../../../include/utils/jsonapi.h.html#LN138"><span class='Ref_to_Typedef'>JsonTransformStringValuesAction</span></a> <span class='Declare_Parameter'>transform_action</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4919"></a>    <a href="../../../include/utils/jsonapi.h.html#LN50"><span class='Ref_to_Struct'>JsonLexContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lex</span> <span class='Operator'>= </span><a href="../../../include/utils/jsonapi.h.html#LN122"><span class='Ref_to_Proto'>makeJsonLexContext</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4916"><span class='Ref_to_Parameter'>json</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4920"></a>    <a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sem</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/jsonapi.h.html#LN81"><span class='Ref_to_Struct'>JsonSemAction</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN4921"></a>    <a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4921"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN67"><span class='Ref_to_Member'>lex</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4919"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4921"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4921"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN69"><span class='Ref_to_Member'>action</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4917"><span class='Ref_to_Parameter'>transform_action</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4921"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN71"><span class='Ref_to_Member'>action_state</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN4916"><span class='Ref_to_Parameter'>action_state</span></a><span class='Delimiter'>; 
</span> 
    <a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN83"><span class='Ref_to_Member'>semstate</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4921"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN476"><span class='Ref_to_Proto'>transform_string_values_scalar</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN84"><span class='Ref_to_Member'>object_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN470"><span class='Ref_to_Proto'>transform_string_values_object_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN85"><span class='Ref_to_Member'>object_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN471"><span class='Ref_to_Proto'>transform_string_values_object_end</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN86"><span class='Ref_to_Member'>array_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN472"><span class='Ref_to_Proto'>transform_string_values_array_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN87"><span class='Ref_to_Member'>array_end</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN473"><span class='Ref_to_Proto'>transform_string_values_array_end</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN92"><span class='Ref_to_Member'>scalar</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN476"><span class='Ref_to_Proto'>transform_string_values_scalar</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN90"><span class='Ref_to_Member'>array_element_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN475"><span class='Ref_to_Proto'>transform_string_values_array_element_start</span></a><span class='Delimiter'>; 
</span>    <a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/jsonapi.h.html#LN88"><span class='Ref_to_Member'>object_field_start</span></a> <span class='Operator'>= </span><a href="jsonfuncs.c.html#LN474"><span class='Ref_to_Proto'>transform_string_values_object_field_start</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/jsonapi.h.html#LN104"><span class='Ref_to_Proto'>pg_parse_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4919"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4920"><span class='Ref_To_Local'>sem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4921"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4921"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end transform_json_string_values &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Set of auxiliary functions for transform_json_string_values to invoke a 
 * specified JsonTransformStringValuesAction for all values and left everything 
 * else untouched. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4949"></a><span class='Declare_Function'>transform_string_values_object_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4951"></a>    <a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4949"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4951"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'{'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN4957"></a><span class='Declare_Function'>transform_string_values_object_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4959"></a>    <a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4957"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4959"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'}'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN4965"></a><span class='Declare_Function'>transform_string_values_array_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4967"></a>    <a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4965"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4967"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>'['</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN4973"></a><span class='Declare_Function'>transform_string_values_array_end</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4975"></a>    <a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4973"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4975"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>']'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN4981"></a><span class='Declare_Function'>transform_string_values_object_field_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4983"></a>    <a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4981"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4983"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4983"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'{'</span><span class='Parentheses'>) 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4983"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unfortunately we don't have the quoted and escaped string any more, so 
     * we have to re-escape it. 
     */ 
</span>    <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4983"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN4981"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4983"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>':'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN4997"></a><span class='Declare_Function'>transform_string_values_array_element_start</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4999"></a>    <a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN4997"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4999"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="jsonfuncs.c.html#LN4999"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'['</span><span class='Parentheses'>) 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN4999"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><span class='String'>','</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN5006"></a><span class='Declare_Function'>transform_string_values_scalar</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>token</span><span class='Delimiter'>, </span><a href="../../../include/utils/jsonapi.h.html#LN19"><span class='Ref_to_Typedef'>JsonTokenType</span></a> <span class='Declare_Parameter'>tokentype</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5008"></a>    <a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>_state</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN65"><span class='Ref_to_Struct'>TransformJsonStringValuesState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="jsonfuncs.c.html#LN5006"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN5006"><span class='Ref_to_Parameter'>tokentype</span></a> <span class='Operator'>== </span><a href="../../../include/utils/jsonapi.h.html#LN22"><span class='Ref_to_EnumConst'>JSON_TOKEN_STRING</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5012"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="jsonfuncs.c.html#LN5008"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN69"><span class='Ref_to_Member'>action</span></a><span class='Parentheses'>) (</span><a href="jsonfuncs.c.html#LN5008"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN71"><span class='Ref_to_Member'>action_state</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN5006"><span class='Ref_to_Parameter'>token</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN5006"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/json.h.html#LN19"><span class='Ref_to_Proto'>escape_json</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN5008"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN5012"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="jsonfuncs.c.html#LN5008"><span class='Ref_To_Local'>_state</span></a><span class='Operator'>-&GT;</span><a href="jsonfuncs.c.html#LN68"><span class='Ref_to_Member'>strval</span></a><span class='Delimiter'>, </span><a href="jsonfuncs.c.html#LN5006"><span class='Ref_to_Parameter'>token</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>