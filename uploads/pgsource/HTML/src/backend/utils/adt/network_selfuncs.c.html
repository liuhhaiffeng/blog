<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\network_selfuncs.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\network_selfuncs.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:52 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * network_selfuncs.c 
 *    Functions for selectivity estimation of inet/cidr operators 
 * 
 * This module provides estimators for the subnet inclusion and overlap 
 * operators.  Estimates are based on null fraction, most common values, 
 * and histogram of inet/cidr columns. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/network_selfuncs.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_statistic.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inet.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/selfuncs.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* Default selectivity for the inet overlap operator */ 
</span><a name="LN32"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFAULT_OVERLAP_SEL</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>01</span> 
 
<span class='Comment_Multi_Line'>/* Default selectivity for the various inclusion operators */ 
</span><a name="LN35"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFAULT_INCLUSION_SEL</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>005</span> 
 
<span class='Comment_Multi_Line'>/* Default selectivity for specified operator */ 
</span><a name="LN38"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DEFAULT_SEL</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>operator</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><span class='Keyword'>operator</span><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN1190"><span class='Ref_to_Const'>OID_INET_OVERLAP_OP</span></a> <span class='Operator'>? \ 
</span>     <a href="network_selfuncs.c.html#LN32"><span class='Ref_to_Const'>DEFAULT_OVERLAP_SEL</span></a> <span class='Operator'>: </span><a href="network_selfuncs.c.html#LN35"><span class='Ref_to_Const'>DEFAULT_INCLUSION_SEL</span></a><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* Maximum number of items to consider in join selectivity calculations */ 
</span><a name="LN43"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_CONSIDERED_ELEMS</span> <span class='Number'>1024</span> 
 
<a name="LN45"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Prototype'>networkjoinsel_inner</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Delimiter'>, 
</span><a name="LN46"></a>                     <a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata1</span><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Prototype'>networkjoinsel_semi</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Delimiter'>, 
</span><a name="LN48"></a>                    <a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata1</span><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN49"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Prototype'>mcv_population</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv_numbers</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mcv_nvalues</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN50"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Prototype'>inet_hist_value_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nvalues</span><span class='Delimiter'>, 
</span><a name="LN51"></a>                    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>constvalue</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN52"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Prototype'>inet_mcv_join_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv1_values</span><span class='Delimiter'>, 
</span><a name="LN53"></a>                  <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv1_numbers</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mcv1_nvalues</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv2_values</span><span class='Delimiter'>, 
</span><a name="LN54"></a>                  <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv2_numbers</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mcv2_nvalues</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN55"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Prototype'>inet_mcv_hist_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv_values</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv_numbers</span><span class='Delimiter'>, 
</span><a name="LN56"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>mcv_nvalues</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN58"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Prototype'>inet_hist_inclusion_join_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist1_values</span><span class='Delimiter'>, 
</span><a name="LN59"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>hist1_nvalues</span><span class='Delimiter'>, 
</span><a name="LN60"></a>                             <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist2_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist2_nvalues</span><span class='Delimiter'>, 
</span><a name="LN61"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN62"></a><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Prototype'>inet_semi_join_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>lhs_value</span><span class='Delimiter'>, 
</span><a name="LN63"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>mcv_exists</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mcv_nvalues</span><span class='Delimiter'>, 
</span><a name="LN64"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>hist_exists</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN65"></a>                   <span class='Keyword'>double </span><span class='Declare_Parameter'>hist_weight</span><span class='Delimiter'>, 
</span><a name="LN66"></a>                   <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>proc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN67"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>inet_opr_codenum</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN68"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>inet_inclusion_cmp</span><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>left</span><span class='Delimiter'>, </span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>right</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN69"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>inet_masklen_inclusion_cmp</span><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>left</span><span class='Delimiter'>, </span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>right</span><span class='Delimiter'>, 
</span><a name="LN70"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>inet_hist_match_divider</span><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>boundary</span><span class='Delimiter'>, </span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, 
</span><a name="LN72"></a>                        <span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Selectivity estimation for the subnet inclusion/overlap operators 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN78"></a><span class='Declare_Function'>networksel</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN80"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>root</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN81"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Keyword'>operator </span><span class='Operator'>= </span><span class='Declare_Local'>PG_GETARG_OID</span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN82"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>args</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN83"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>varRelid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a>    <a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Declare_Local'>vardata</span><span class='Delimiter'>; 
</span><a name="LN85"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>other</span><span class='Delimiter'>; 
</span><a name="LN86"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>varonleft</span><span class='Delimiter'>; 
</span><a name="LN87"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>selec</span><span class='Delimiter'>, 
</span><a name="LN88"></a>                <span class='Declare_Local'>mcv_selec</span><span class='Delimiter'>, 
</span><a name="LN89"></a>                <span class='Declare_Local'>non_mcv_selec</span><span class='Delimiter'>; 
</span><a name="LN90"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>constvalue</span><span class='Delimiter'>; 
</span><a name="LN91"></a>    <a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a> <span class='Declare_Local'>stats</span><span class='Delimiter'>; 
</span><a name="LN92"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>hslot</span><span class='Delimiter'>; 
</span><a name="LN93"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>sumcommon</span><span class='Delimiter'>, 
</span><a name="LN94"></a>                <span class='Declare_Local'>nullfrac</span><span class='Delimiter'>; 
</span><a name="LN95"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Local'>proc</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If expression is not (variable op something) or (something op 
     * variable), then punt and return a default estimate. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/selfuncs.h.html#LN157"><span class='Ref_to_Proto'>get_restriction_variable</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN80"><span class='Ref_To_Local'>root</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN82"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN83"><span class='Ref_To_Local'>varRelid</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="network_selfuncs.c.html#LN84"><span class='Ref_To_Local'>vardata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN85"><span class='Ref_To_Local'>other</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN86"><span class='Ref_To_Local'>varonleft</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="array_selfuncs.c.html#LN37"><span class='Ref_to_Macro'>DEFAULT_SEL</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Can't do anything useful if the something is not a constant, either. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN85"><span class='Ref_To_Local'>other</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN84"><span class='Ref_To_Local'>vardata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="array_selfuncs.c.html#LN37"><span class='Ref_to_Macro'>DEFAULT_SEL</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* All of the operators handled here are strict. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="network_selfuncs.c.html#LN85"><span class='Ref_To_Local'>other</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN84"><span class='Ref_To_Local'>vardata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="network_selfuncs.c.html#LN90"><span class='Ref_To_Local'>constvalue</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="network_selfuncs.c.html#LN85"><span class='Ref_To_Local'>other</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constvalue<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Otherwise, we need stats in order to produce a non-default estimate. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN84"><span class='Ref_To_Local'>vardata</span></a><span class='Operator'>.</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN84"><span class='Ref_To_Local'>vardata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="array_selfuncs.c.html#LN37"><span class='Ref_to_Macro'>DEFAULT_SEL</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="network_selfuncs.c.html#LN91"><span class='Ref_To_Local'>stats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN84"><span class='Ref_To_Local'>vardata</span></a><span class='Operator'>.</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="network_selfuncs.c.html#LN94"><span class='Ref_To_Local'>nullfrac</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN91"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span>stanullfrac<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have most-common-values info, add up the fractions of the MCV 
     * entries that satisfy MCV OP CONST.  These fractions contribute directly 
     * to the result selectivity.  Also add up the total fraction represented 
     * by MCV entries. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN95"><span class='Ref_To_Local'>proc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="network_selfuncs.c.html#LN88"><span class='Ref_To_Local'>mcv_selec</span></a> <span class='Operator'>= </span><a href="../../../include/utils/selfuncs.h.html#LN168"><span class='Ref_to_Proto'>mcv_selectivity</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN84"><span class='Ref_To_Local'>vardata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN95"><span class='Ref_To_Local'>proc</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN90"><span class='Ref_To_Local'>constvalue</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN86"><span class='Ref_To_Local'>varonleft</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="network_selfuncs.c.html#LN93"><span class='Ref_To_Local'>sumcommon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have a histogram, use it to estimate the proportion of the 
     * non-MCV population that satisfies the clause.  If we don't, apply the 
     * default selectivity to that population. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN92"><span class='Ref_To_Local'>hslot</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN84"><span class='Ref_To_Local'>vardata</span></a><span class='Operator'>.</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                         <a href="../../../include/catalog/pg_statistic.h.html#LN221"><span class='Ref_to_Const'>STATISTIC_KIND_HISTOGRAM</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                         <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN151"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>opr_codenum</span> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN67"><span class='Ref_to_Proto'>inet_opr_codenum</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Commute if needed, so we can consider histogram to be on the left */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="network_selfuncs.c.html#LN86"><span class='Ref_To_Local'>varonleft</span></a><span class='Parentheses'>) 
</span>            <a href="network_selfuncs.c.html#LN151"><span class='Ref_To_Local'>opr_codenum</span></a> <span class='Operator'>= -</span><a href="network_selfuncs.c.html#LN151"><span class='Ref_To_Local'>opr_codenum</span></a><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN89"><span class='Ref_To_Local'>non_mcv_selec</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN50"><span class='Ref_to_Proto'>inet_hist_value_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN92"><span class='Ref_To_Local'>hslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN92"><span class='Ref_To_Local'>hslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, 
</span>                                            <a href="network_selfuncs.c.html#LN90"><span class='Ref_To_Local'>constvalue</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN151"><span class='Ref_To_Local'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN92"><span class='Ref_To_Local'>hslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="network_selfuncs.c.html#LN89"><span class='Ref_To_Local'>non_mcv_selec</span></a> <span class='Operator'>= </span><a href="array_selfuncs.c.html#LN37"><span class='Ref_to_Macro'>DEFAULT_SEL</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Combine selectivities for MCV and non-MCV populations */ 
</span>    <a href="network_selfuncs.c.html#LN87"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN88"><span class='Ref_To_Local'>mcv_selec</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN94"><span class='Ref_To_Local'>nullfrac</span></a> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN93"><span class='Ref_To_Local'>sumcommon</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="network_selfuncs.c.html#LN89"><span class='Ref_To_Local'>non_mcv_selec</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Result should be in range, but make sure... */ 
</span>    <a href="../../../include/utils/selfuncs.h.html#LN56"><span class='Ref_to_Macro'>CLAMP_PROBABILITY</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN87"><span class='Ref_To_Local'>selec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN84"><span class='Ref_To_Local'>vardata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN87"><span class='Ref_To_Local'>selec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end networksel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Join selectivity estimation for the subnet inclusion/overlap operators 
 * 
 * This function has the same structure as eqjoinsel() in selfuncs.c. 
 * 
 * Throughout networkjoinsel and its subroutines, we have a performance issue 
 * in that the amount of work to be done is O(N^2) in the length of the MCV 
 * and histogram arrays.  To keep the runtime from getting out of hand when 
 * large statistics targets have been set, we arbitrarily limit the number of 
 * values considered to 1024 (MAX_CONSIDERED_ELEMS).  For the MCV arrays, this 
 * is easy: just consider at most the first N elements.  (Since the MCVs are 
 * sorted by decreasing frequency, this correctly gets us the first N MCVs.) 
 * For the histogram arrays, we decimate; that is consider only every k'th 
 * element, where k is chosen so that no more than MAX_CONSIDERED_ELEMS 
 * elements are considered.  This should still give us a good random sample of 
 * the non-MCV population.  Decimation is done on-the-fly in the loops that 
 * iterate over the histogram arrays. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN194"></a><span class='Declare_Function'>networkjoinsel</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN196"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>root</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN197"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Keyword'>operator </span><span class='Operator'>= </span><span class='Declare_Local'>PG_GETARG_OID</span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN198"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>args</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> NOT_USED 
<a name="LN200"></a>    <a href="../../../include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a>    <span class='Declare_Local'>jointype</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN671"><span class='Ref_to_Enum'>JoinType</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN202"></a>    <a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sjinfo</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN1913"><span class='Ref_to_Struct'>SpecialJoinInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN203"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>selec</span><span class='Delimiter'>; 
</span><a name="LN204"></a>    <a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Declare_Local'>vardata1</span><span class='Delimiter'>; 
</span><a name="LN205"></a>    <a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Declare_Local'>vardata2</span><span class='Delimiter'>; 
</span><a name="LN206"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>join_is_reversed</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/selfuncs.h.html#LN161"><span class='Ref_to_Proto'>get_join_variables</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN196"><span class='Ref_To_Local'>root</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN198"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN202"><span class='Ref_To_Local'>sjinfo</span></a><span class='Delimiter'>, 
</span>                       <span class='Operator'>&</span><a href="network_selfuncs.c.html#LN204"><span class='Ref_To_Local'>vardata1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN205"><span class='Ref_To_Local'>vardata2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN206"><span class='Ref_To_Local'>join_is_reversed</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN202"><span class='Ref_To_Local'>sjinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1920"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN677"><span class='Ref_to_EnumConst'>JOIN_INNER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN678"><span class='Ref_to_EnumConst'>JOIN_LEFT</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN679"><span class='Ref_to_EnumConst'>JOIN_FULL</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Selectivity for left/full join is not exactly the same as inner 
             * join, but we neglect the difference, as eqjoinsel does. 
             */ 
</span>            <a href="network_selfuncs.c.html#LN203"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN45"><span class='Ref_to_Proto'>networkjoinsel_inner</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN204"><span class='Ref_To_Local'>vardata1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN205"><span class='Ref_To_Local'>vardata2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN691"><span class='Ref_to_EnumConst'>JOIN_SEMI</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/nodes/nodes.h.html#LN692"><span class='Ref_to_EnumConst'>JOIN_ANTI</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Here, it's important that we pass the outer var on the left. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="network_selfuncs.c.html#LN206"><span class='Ref_To_Local'>join_is_reversed</span></a><span class='Parentheses'>) 
</span>                <a href="network_selfuncs.c.html#LN203"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN47"><span class='Ref_to_Proto'>networkjoinsel_semi</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN204"><span class='Ref_To_Local'>vardata1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN205"><span class='Ref_To_Local'>vardata2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="network_selfuncs.c.html#LN203"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN47"><span class='Ref_to_Proto'>networkjoinsel_semi</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN106"><span class='Ref_to_Proto'>get_commutator</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Operator'>&</span><a href="network_selfuncs.c.html#LN205"><span class='Ref_To_Local'>vardata2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN204"><span class='Ref_To_Local'>vardata1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* other values not expected here */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized join type: %d"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="network_selfuncs.c.html#LN202"><span class='Ref_To_Local'>sjinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN1920"><span class='Ref_to_Member'>jointype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="network_selfuncs.c.html#LN203"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch sjinfo-&GT;jointype &raquo; </span> 
 
    <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN204"><span class='Ref_To_Local'>vardata1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN205"><span class='Ref_To_Local'>vardata2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/selfuncs.h.html#LN56"><span class='Ref_to_Macro'>CLAMP_PROBABILITY</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN203"><span class='Ref_To_Local'>selec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a><span class='Parentheses'>) </span><a href="network_selfuncs.c.html#LN203"><span class='Ref_To_Local'>selec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end networkjoinsel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Inner join selectivity estimation for subnet inclusion/overlap operators 
 * 
 * Calculates MCV vs MCV, MCV vs histogram and histogram vs histogram 
 * selectivity for join using the subnet inclusion operators.  Unlike the 
 * join selectivity function for the equality operator, eqjoinsel_inner(), 
 * one to one matching of the values is not enough.  Network inclusion 
 * operators are likely to match many to many, so we must check all pairs. 
 * (Note: it might be possible to exploit understanding of the histogram's 
 * btree ordering to reduce the work needed, but we don't currently try.) 
 * Also, MCV vs histogram selectivity is not neglected as in eqjoinsel_inner(). 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN261"></a><span class='Declare_Function'>networkjoinsel_inner</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Delimiter'>, 
</span><a name="LN262"></a>                     <a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata1</span><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN264"></a>    <a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a> <span class='Declare_Local'>stats</span><span class='Delimiter'>; 
</span><a name="LN265"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>nullfrac1</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN266"></a>                <span class='Declare_Local'>nullfrac2</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN267"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>selec</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN268"></a>                <span class='Declare_Local'>sumcommon1</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN269"></a>                <span class='Declare_Local'>sumcommon2</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN270"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>mcv1_exists</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN271"></a>                <span class='Declare_Local'>mcv2_exists</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN272"></a>                <span class='Declare_Local'>hist1_exists</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN273"></a>                <span class='Declare_Local'>hist2_exists</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN274"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>opr_codenum</span><span class='Delimiter'>; 
</span><a name="LN275"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>mcv1_length</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN276"></a>                <span class='Declare_Local'>mcv2_length</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN277"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>mcv1_slot</span><span class='Delimiter'>; 
</span><a name="LN278"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>mcv2_slot</span><span class='Delimiter'>; 
</span><a name="LN279"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>hist1_slot</span><span class='Delimiter'>; 
</span><a name="LN280"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>hist2_slot</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN262"><span class='Ref_to_Parameter'>vardata1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="network_selfuncs.c.html#LN264"><span class='Ref_To_Local'>stats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN262"><span class='Ref_to_Parameter'>vardata1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN265"><span class='Ref_To_Local'>nullfrac1</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN264"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span>stanullfrac<span class='Delimiter'>; 
</span> 
        <a href="network_selfuncs.c.html#LN270"><span class='Ref_To_Local'>mcv1_exists</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN262"><span class='Ref_to_Parameter'>vardata1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/catalog/pg_statistic.h.html#LN203"><span class='Ref_to_Const'>STATISTIC_KIND_MCV</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a> <span class='Operator'>| </span><a href="../../../include/utils/lsyscache.h.html#LN39"><span class='Ref_to_Const'>ATTSTATSSLOT_NUMBERS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN272"><span class='Ref_To_Local'>hist1_exists</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN279"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN262"><span class='Ref_to_Parameter'>vardata1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/catalog/pg_statistic.h.html#LN221"><span class='Ref_to_Const'>STATISTIC_KIND_HISTOGRAM</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Arbitrarily limit number of MCVs considered */ 
</span>        <a href="network_selfuncs.c.html#LN275"><span class='Ref_To_Local'>mcv1_length</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN43"><span class='Ref_to_Const'>MAX_CONSIDERED_ELEMS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN270"><span class='Ref_To_Local'>mcv1_exists</span></a><span class='Parentheses'>) 
</span>            <a href="network_selfuncs.c.html#LN268"><span class='Ref_To_Local'>sumcommon1</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN49"><span class='Ref_to_Proto'>mcv_population</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN275"><span class='Ref_To_Local'>mcv1_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN279"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN279"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN262"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="network_selfuncs.c.html#LN264"><span class='Ref_To_Local'>stats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN262"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN266"><span class='Ref_To_Local'>nullfrac2</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN264"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span>stanullfrac<span class='Delimiter'>; 
</span> 
        <a href="network_selfuncs.c.html#LN271"><span class='Ref_To_Local'>mcv2_exists</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN262"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/catalog/pg_statistic.h.html#LN203"><span class='Ref_to_Const'>STATISTIC_KIND_MCV</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a> <span class='Operator'>| </span><a href="../../../include/utils/lsyscache.h.html#LN39"><span class='Ref_to_Const'>ATTSTATSSLOT_NUMBERS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN273"><span class='Ref_To_Local'>hist2_exists</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN280"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN262"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/catalog/pg_statistic.h.html#LN221"><span class='Ref_to_Const'>STATISTIC_KIND_HISTOGRAM</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Arbitrarily limit number of MCVs considered */ 
</span>        <a href="network_selfuncs.c.html#LN276"><span class='Ref_To_Local'>mcv2_length</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN43"><span class='Ref_to_Const'>MAX_CONSIDERED_ELEMS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN271"><span class='Ref_To_Local'>mcv2_exists</span></a><span class='Parentheses'>) 
</span>            <a href="network_selfuncs.c.html#LN269"><span class='Ref_To_Local'>sumcommon2</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN49"><span class='Ref_to_Proto'>mcv_population</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN276"><span class='Ref_To_Local'>mcv2_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN280"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN280"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="network_selfuncs.c.html#LN274"><span class='Ref_To_Local'>opr_codenum</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN67"><span class='Ref_to_Proto'>inet_opr_codenum</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate selectivity for MCV vs MCV matches. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN270"><span class='Ref_To_Local'>mcv1_exists</span></a> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN271"><span class='Ref_To_Local'>mcv2_exists</span></a><span class='Parentheses'>) 
</span>        <a href="network_selfuncs.c.html#LN267"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>+= </span><a href="network_selfuncs.c.html#LN52"><span class='Ref_to_Proto'>inet_mcv_join_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>, 
</span>                                   <a href="network_selfuncs.c.html#LN275"><span class='Ref_To_Local'>mcv1_length</span></a><span class='Delimiter'>, 
</span>                                   <a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>, 
</span>                                   <a href="network_selfuncs.c.html#LN276"><span class='Ref_To_Local'>mcv2_length</span></a><span class='Delimiter'>, 
</span>                                   <span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add in selectivities for MCV vs histogram matches, scaling according to 
     * the fractions of the populations represented by the histograms. Note 
     * that the second case needs to commute the operator. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN270"><span class='Ref_To_Local'>mcv1_exists</span></a> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN273"><span class='Ref_To_Local'>hist2_exists</span></a><span class='Parentheses'>) 
</span>        <a href="network_selfuncs.c.html#LN267"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN266"><span class='Ref_To_Local'>nullfrac2</span></a> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN269"><span class='Ref_To_Local'>sumcommon2</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>            <a href="network_selfuncs.c.html#LN55"><span class='Ref_to_Proto'>inet_mcv_hist_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN275"><span class='Ref_To_Local'>mcv1_length</span></a><span class='Delimiter'>, 
</span>                              <a href="network_selfuncs.c.html#LN280"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN280"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, 
</span>                              <a href="network_selfuncs.c.html#LN274"><span class='Ref_To_Local'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN271"><span class='Ref_To_Local'>mcv2_exists</span></a> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN272"><span class='Ref_To_Local'>hist1_exists</span></a><span class='Parentheses'>) 
</span>        <a href="network_selfuncs.c.html#LN267"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN265"><span class='Ref_To_Local'>nullfrac1</span></a> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN268"><span class='Ref_To_Local'>sumcommon1</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>            <a href="network_selfuncs.c.html#LN55"><span class='Ref_to_Proto'>inet_mcv_hist_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN276"><span class='Ref_To_Local'>mcv2_length</span></a><span class='Delimiter'>, 
</span>                              <a href="network_selfuncs.c.html#LN279"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN279"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>-</span><a href="network_selfuncs.c.html#LN274"><span class='Ref_To_Local'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Add in selectivity for histogram vs histogram matches, again scaling 
     * appropriately. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN272"><span class='Ref_To_Local'>hist1_exists</span></a> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN273"><span class='Ref_To_Local'>hist2_exists</span></a><span class='Parentheses'>) 
</span>        <a href="network_selfuncs.c.html#LN267"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN265"><span class='Ref_To_Local'>nullfrac1</span></a> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN268"><span class='Ref_To_Local'>sumcommon1</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>            <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN266"><span class='Ref_To_Local'>nullfrac2</span></a> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN269"><span class='Ref_To_Local'>sumcommon2</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>            <a href="network_selfuncs.c.html#LN58"><span class='Ref_to_Proto'>inet_hist_inclusion_join_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN279"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN279"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, 
</span>                                       <a href="network_selfuncs.c.html#LN280"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN280"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, 
</span>                                         <a href="network_selfuncs.c.html#LN274"><span class='Ref_To_Local'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If useful statistics are not available then use the default estimate. 
     * We can apply null fractions if known, though. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="network_selfuncs.c.html#LN270"><span class='Ref_To_Local'>mcv1_exists</span></a> <span class='Operator'>&& !</span><a href="network_selfuncs.c.html#LN272"><span class='Ref_To_Local'>hist1_exists</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="network_selfuncs.c.html#LN271"><span class='Ref_To_Local'>mcv2_exists</span></a> <span class='Operator'>&& !</span><a href="network_selfuncs.c.html#LN273"><span class='Ref_To_Local'>hist2_exists</span></a><span class='Parentheses'>))</span> 
        <a href="network_selfuncs.c.html#LN267"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN265"><span class='Ref_To_Local'>nullfrac1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN266"><span class='Ref_To_Local'>nullfrac2</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="array_selfuncs.c.html#LN37"><span class='Ref_to_Macro'>DEFAULT_SEL</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release stats. */ 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN277"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN278"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN279"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN280"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN267"><span class='Ref_To_Local'>selec</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end networkjoinsel_inner &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Semi join selectivity estimation for subnet inclusion/overlap operators 
 * 
 * Calculates MCV vs MCV, MCV vs histogram, histogram vs MCV, and histogram vs 
 * histogram selectivity for semi/anti join cases. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN388"></a><span class='Declare_Function'>networkjoinsel_semi</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Delimiter'>, 
</span><a name="LN389"></a>                    <a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata1</span><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN391"></a>    <a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a> <span class='Declare_Local'>stats</span><span class='Delimiter'>; 
</span><a name="LN392"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>selec</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN393"></a>                <span class='Declare_Local'>sumcommon1</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN394"></a>                <span class='Declare_Local'>sumcommon2</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN395"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>nullfrac1</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN396"></a>                <span class='Declare_Local'>nullfrac2</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN397"></a>                <span class='Declare_Local'>hist2_weight</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN398"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>mcv1_exists</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN399"></a>                <span class='Declare_Local'>mcv2_exists</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN400"></a>                <span class='Declare_Local'>hist1_exists</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span><a name="LN401"></a>                <span class='Declare_Local'>hist2_exists</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN402"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>opr_codenum</span><span class='Delimiter'>; 
</span><a name="LN403"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Local'>proc</span><span class='Delimiter'>; 
</span><a name="LN404"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN405"></a>                <span class='Declare_Local'>mcv1_length</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN406"></a>                <span class='Declare_Local'>mcv2_length</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN407"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>mcv1_slot</span><span class='Delimiter'>; 
</span><a name="LN408"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>mcv2_slot</span><span class='Delimiter'>; 
</span><a name="LN409"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>hist1_slot</span><span class='Delimiter'>; 
</span><a name="LN410"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>hist2_slot</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="network_selfuncs.c.html#LN391"><span class='Ref_To_Local'>stats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN395"><span class='Ref_To_Local'>nullfrac1</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN391"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span>stanullfrac<span class='Delimiter'>; 
</span> 
        <a href="network_selfuncs.c.html#LN398"><span class='Ref_To_Local'>mcv1_exists</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN407"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/catalog/pg_statistic.h.html#LN203"><span class='Ref_to_Const'>STATISTIC_KIND_MCV</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a> <span class='Operator'>| </span><a href="../../../include/utils/lsyscache.h.html#LN39"><span class='Ref_to_Const'>ATTSTATSSLOT_NUMBERS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN400"><span class='Ref_To_Local'>hist1_exists</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN409"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/catalog/pg_statistic.h.html#LN221"><span class='Ref_to_Const'>STATISTIC_KIND_HISTOGRAM</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Arbitrarily limit number of MCVs considered */ 
</span>        <a href="network_selfuncs.c.html#LN405"><span class='Ref_To_Local'>mcv1_length</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN407"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN43"><span class='Ref_to_Const'>MAX_CONSIDERED_ELEMS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN398"><span class='Ref_To_Local'>mcv1_exists</span></a><span class='Parentheses'>) 
</span>            <a href="network_selfuncs.c.html#LN393"><span class='Ref_To_Local'>sumcommon1</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN49"><span class='Ref_to_Proto'>mcv_population</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN407"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN405"><span class='Ref_To_Local'>mcv1_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN407"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN407"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN409"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN409"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="network_selfuncs.c.html#LN391"><span class='Ref_To_Local'>stats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN396"><span class='Ref_To_Local'>nullfrac2</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN391"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span>stanullfrac<span class='Delimiter'>; 
</span> 
        <a href="network_selfuncs.c.html#LN399"><span class='Ref_To_Local'>mcv2_exists</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN408"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                                       <a href="../../../include/catalog/pg_statistic.h.html#LN203"><span class='Ref_to_Const'>STATISTIC_KIND_MCV</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a> <span class='Operator'>| </span><a href="../../../include/utils/lsyscache.h.html#LN39"><span class='Ref_to_Const'>ATTSTATSSLOT_NUMBERS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN401"><span class='Ref_To_Local'>hist2_exists</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN410"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/catalog/pg_statistic.h.html#LN221"><span class='Ref_to_Const'>STATISTIC_KIND_HISTOGRAM</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Arbitrarily limit number of MCVs considered */ 
</span>        <a href="network_selfuncs.c.html#LN406"><span class='Ref_To_Local'>mcv2_length</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN408"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN43"><span class='Ref_to_Const'>MAX_CONSIDERED_ELEMS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN399"><span class='Ref_To_Local'>mcv2_exists</span></a><span class='Parentheses'>) 
</span>            <a href="network_selfuncs.c.html#LN394"><span class='Ref_To_Local'>sumcommon2</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN49"><span class='Ref_to_Proto'>mcv_population</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN408"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN406"><span class='Ref_To_Local'>mcv2_length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN408"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN408"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN410"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN410"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="network_selfuncs.c.html#LN402"><span class='Ref_To_Local'>opr_codenum</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN67"><span class='Ref_to_Proto'>inet_opr_codenum</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN403"><span class='Ref_To_Local'>proc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Estimate number of input rows represented by RHS histogram. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN401"><span class='Ref_To_Local'>hist2_exists</span></a> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN69"><span class='Ref_to_Member'>rel</span></a><span class='Parentheses'>) 
</span>        <a href="network_selfuncs.c.html#LN397"><span class='Ref_To_Local'>hist2_weight</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN396"><span class='Ref_To_Local'>nullfrac2</span></a> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN394"><span class='Ref_To_Local'>sumcommon2</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="network_selfuncs.c.html#LN389"><span class='Ref_to_Parameter'>vardata2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN69"><span class='Ref_to_Member'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/relation.h.html#LN527"><span class='Ref_to_Member'>rows</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Consider each element of the LHS MCV list, matching it to whatever RHS 
     * stats we have.  Scale according to the known frequency of the MCV. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN398"><span class='Ref_To_Local'>mcv1_exists</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN399"><span class='Ref_To_Local'>mcv2_exists</span></a> <span class='Operator'>|| </span><a href="network_selfuncs.c.html#LN401"><span class='Ref_To_Local'>hist2_exists</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN404"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN404"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="network_selfuncs.c.html#LN405"><span class='Ref_To_Local'>mcv1_length</span></a><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN404"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="network_selfuncs.c.html#LN392"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>+= </span><a href="network_selfuncs.c.html#LN407"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN404"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>* 
</span>                <a href="network_selfuncs.c.html#LN62"><span class='Ref_to_Proto'>inet_semi_join_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN407"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN404"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                   <a href="network_selfuncs.c.html#LN399"><span class='Ref_To_Local'>mcv2_exists</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN408"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN406"><span class='Ref_To_Local'>mcv2_length</span></a><span class='Delimiter'>, 
</span>                                   <a href="network_selfuncs.c.html#LN401"><span class='Ref_To_Local'>hist2_exists</span></a><span class='Delimiter'>, 
</span>                                   <a href="network_selfuncs.c.html#LN410"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN410"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, 
</span>                                   <a href="network_selfuncs.c.html#LN397"><span class='Ref_To_Local'>hist2_weight</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="network_selfuncs.c.html#LN403"><span class='Ref_To_Local'>proc</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN402"><span class='Ref_To_Local'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Consider each element of the LHS histogram, except for the first and 
     * last elements, which we exclude on the grounds that they're outliers 
     * and thus not very representative.  Scale on the assumption that each 
     * such histogram element represents an equal share of the LHS histogram 
     * population (which is a bit bogus, because the members of its bucket may 
     * not all act the same with respect to the join clause, but it's hard to 
     * do better). 
     * 
     * If there are too many histogram elements, decimate to limit runtime. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN400"><span class='Ref_To_Local'>hist1_exists</span></a> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN409"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a> <span class='Operator'>&GT; </span><span class='Number'>2</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN399"><span class='Ref_To_Local'>mcv2_exists</span></a> <span class='Operator'>|| </span><a href="network_selfuncs.c.html#LN401"><span class='Ref_To_Local'>hist2_exists</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN494"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>hist_selec_sum</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN495"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>k</span><span class='Delimiter'>, 
</span><a name="LN496"></a>                    <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span> 
        <a href="network_selfuncs.c.html#LN495"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN409"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a> <span class='Operator'>- </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="network_selfuncs.c.html#LN43"><span class='Ref_to_Const'>MAX_CONSIDERED_ELEMS</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <a href="network_selfuncs.c.html#LN496"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN404"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN404"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="network_selfuncs.c.html#LN409"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN404"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+= </span><a href="network_selfuncs.c.html#LN495"><span class='Ref_To_Local'>k</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="network_selfuncs.c.html#LN494"><span class='Ref_To_Local'>hist_selec_sum</span></a> <span class='Operator'>+= 
</span>                <a href="network_selfuncs.c.html#LN62"><span class='Ref_to_Proto'>inet_semi_join_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN409"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN404"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                   <a href="network_selfuncs.c.html#LN399"><span class='Ref_To_Local'>mcv2_exists</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN408"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN406"><span class='Ref_To_Local'>mcv2_length</span></a><span class='Delimiter'>, 
</span>                                   <a href="network_selfuncs.c.html#LN401"><span class='Ref_To_Local'>hist2_exists</span></a><span class='Delimiter'>, 
</span>                                   <a href="network_selfuncs.c.html#LN410"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN410"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>, 
</span>                                   <a href="network_selfuncs.c.html#LN397"><span class='Ref_To_Local'>hist2_weight</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="network_selfuncs.c.html#LN403"><span class='Ref_To_Local'>proc</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN402"><span class='Ref_To_Local'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="network_selfuncs.c.html#LN496"><span class='Ref_To_Local'>n</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="network_selfuncs.c.html#LN392"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN395"><span class='Ref_To_Local'>nullfrac1</span></a> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN393"><span class='Ref_To_Local'>sumcommon1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="network_selfuncs.c.html#LN494"><span class='Ref_To_Local'>hist_selec_sum</span></a> <span class='Operator'>/ </span><a href="network_selfuncs.c.html#LN496"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if hist1_exists&&hist1_s... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If useful statistics are not available then use the default estimate. 
     * We can apply null fractions if known, though. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="network_selfuncs.c.html#LN398"><span class='Ref_To_Local'>mcv1_exists</span></a> <span class='Operator'>&& !</span><a href="network_selfuncs.c.html#LN400"><span class='Ref_To_Local'>hist1_exists</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="network_selfuncs.c.html#LN399"><span class='Ref_To_Local'>mcv2_exists</span></a> <span class='Operator'>&& !</span><a href="network_selfuncs.c.html#LN401"><span class='Ref_To_Local'>hist2_exists</span></a><span class='Parentheses'>))</span> 
        <a href="network_selfuncs.c.html#LN392"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN395"><span class='Ref_To_Local'>nullfrac1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="network_selfuncs.c.html#LN396"><span class='Ref_To_Local'>nullfrac2</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="array_selfuncs.c.html#LN37"><span class='Ref_to_Macro'>DEFAULT_SEL</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release stats. */ 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN407"><span class='Ref_To_Local'>mcv1_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN408"><span class='Ref_To_Local'>mcv2_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN409"><span class='Ref_To_Local'>hist1_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN410"><span class='Ref_To_Local'>hist2_slot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN392"><span class='Ref_To_Local'>selec</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end networkjoinsel_semi &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compute the fraction of a relation's population that is represented 
 * by the MCV list. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN537"></a><span class='Declare_Function'>mcv_population</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv_numbers</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mcv_nvalues</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN539"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>sumcommon</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN540"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN540"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN540"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="network_selfuncs.c.html#LN537"><span class='Ref_to_Parameter'>mcv_nvalues</span></a><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN540"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="network_selfuncs.c.html#LN539"><span class='Ref_To_Local'>sumcommon</span></a> <span class='Operator'>+= </span><a href="network_selfuncs.c.html#LN537"><span class='Ref_to_Parameter'>mcv_numbers</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN540"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN539"><span class='Ref_To_Local'>sumcommon</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Inet histogram vs single value selectivity estimation 
 * 
 * Estimate the fraction of the histogram population that satisfies 
 * "value OPR CONST".  (The result needs to be scaled to reflect the 
 * proportion of the total population represented by the histogram.) 
 * 
 * The histogram is originally for the inet btree comparison operators. 
 * Only the common bits of the network part and the length of the network part 
 * (masklen) are interesting for the subnet inclusion operators.  Fortunately, 
 * btree comparison treats the network part as the major sort key.  Even so, 
 * the length of the network part would not really be significant in the 
 * histogram.  This would lead to big mistakes for data sets with uneven 
 * masklen distribution.  To reduce this problem, comparisons with the left 
 * and the right sides of the buckets are used together. 
 * 
 * Histogram bucket matches are calculated in two forms.  If the constant 
 * matches both bucket endpoints the bucket is considered as fully matched. 
 * The second form is to match the bucket partially; we recognize this when 
 * the constant matches just one endpoint, or the two endpoints fall on 
 * opposite sides of the constant.  (Note that when the constant matches an 
 * interior histogram element, it gets credit for partial matches to the 
 * buckets on both sides, while a match to a histogram endpoint gets credit 
 * for only one partial match.  This is desirable.) 
 * 
 * The divider in the partial bucket match is imagined as the distance 
 * between the decisive bits and the common bits of the addresses.  It will 
 * be used as a power of two as it is the natural scale for the IP network 
 * inclusion.  This partial bucket match divider calculation is an empirical 
 * formula and subject to change with more experiment. 
 * 
 * For a partial match, we try to calculate dividers for both of the 
 * boundaries.  If the address family of a boundary value does not match the 
 * constant or comparison of the length of the network parts is not correct 
 * for the operator, the divider for that boundary will not be taken into 
 * account.  If both of the dividers are valid, the greater one will be used 
 * to minimize the mistake in buckets that have disparate masklens.  This 
 * calculation is unfair when dividers can be calculated for both of the 
 * boundaries but they are far from each other; but it is not a common 
 * situation as the boundaries are expected to share most of their significant 
 * bits of their masklens.  The mistake would be greater, if we would use the 
 * minimum instead of the maximum, and we don't know a sensible way to combine 
 * them. 
 * 
 * For partial match in buckets that have different address families on the 
 * left and right sides, only the boundary with the same address family is 
 * taken into consideration.  This can cause more mistakes for these buckets 
 * if the masklens of their boundaries are also disparate.  But this can only 
 * happen in one bucket, since only two address families exist.  It seems a 
 * better option than not considering these buckets at all. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN602"></a><span class='Declare_Function'>inet_hist_value_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nvalues</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>constvalue</span><span class='Delimiter'>, 
</span><a name="LN603"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN605"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>match</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN606"></a>    <a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>query</span><span class='Delimiter'>, 
</span><a name="LN607"></a>               <span class='Operator'>*</span><span class='Declare_Local'>left</span><span class='Delimiter'>, 
</span><a name="LN608"></a>               <span class='Operator'>*</span><span class='Declare_Local'>right</span><span class='Delimiter'>; 
</span><a name="LN609"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN610"></a>                <span class='Declare_Local'>k</span><span class='Delimiter'>, 
</span><a name="LN611"></a>                <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span><a name="LN612"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>left_order</span><span class='Delimiter'>, 
</span><a name="LN613"></a>                <span class='Declare_Local'>right_order</span><span class='Delimiter'>, 
</span><a name="LN614"></a>                <span class='Declare_Local'>left_divider</span><span class='Delimiter'>, 
</span><a name="LN615"></a>                <span class='Declare_Local'>right_divider</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* guard against zero-divide below */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN602"><span class='Ref_to_Parameter'>nvalues</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if there are too many histogram elements, decimate to limit runtime */ 
</span>    <a href="network_selfuncs.c.html#LN610"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN602"><span class='Ref_to_Parameter'>nvalues</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="network_selfuncs.c.html#LN43"><span class='Ref_to_Const'>MAX_CONSIDERED_ELEMS</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="network_selfuncs.c.html#LN606"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../../include/utils/inet.h.html#LN121"><span class='Ref_to_Macro'>DatumGetInetPP</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN602"><span class='Ref_to_Parameter'>constvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* "left" is the left boundary value of the current bucket ... */ 
</span>    <a href="network_selfuncs.c.html#LN607"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>= </span><a href="../../../include/utils/inet.h.html#LN121"><span class='Ref_to_Macro'>DatumGetInetPP</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN602"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="network_selfuncs.c.html#LN612"><span class='Ref_To_Local'>left_order</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN68"><span class='Ref_to_Proto'>inet_inclusion_cmp</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN607"><span class='Ref_To_Local'>left</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN606"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN603"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="network_selfuncs.c.html#LN611"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN609"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN610"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN609"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="network_selfuncs.c.html#LN602"><span class='Ref_to_Parameter'>nvalues</span></a><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN609"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+= </span><a href="network_selfuncs.c.html#LN610"><span class='Ref_To_Local'>k</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* ... and "right" is the right boundary value */ 
</span>        <a href="network_selfuncs.c.html#LN608"><span class='Ref_To_Local'>right</span></a> <span class='Operator'>= </span><a href="../../../include/utils/inet.h.html#LN121"><span class='Ref_to_Macro'>DatumGetInetPP</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN602"><span class='Ref_to_Parameter'>values</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN609"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN613"><span class='Ref_To_Local'>right_order</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN68"><span class='Ref_to_Proto'>inet_inclusion_cmp</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN608"><span class='Ref_To_Local'>right</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN606"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN603"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN612"><span class='Ref_To_Local'>left_order</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN613"><span class='Ref_To_Local'>right_order</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* The whole bucket matches, since both endpoints do. */ 
</span>            <a href="network_selfuncs.c.html#LN605"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="network_selfuncs.c.html#LN612"><span class='Ref_To_Local'>left_order</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN613"><span class='Ref_To_Local'>right_order</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                 <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN612"><span class='Ref_To_Local'>left_order</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN613"><span class='Ref_To_Local'>right_order</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Partial bucket match. */ 
</span>            <a href="network_selfuncs.c.html#LN614"><span class='Ref_To_Local'>left_divider</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN71"><span class='Ref_to_Proto'>inet_hist_match_divider</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN607"><span class='Ref_To_Local'>left</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN606"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN603"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="network_selfuncs.c.html#LN615"><span class='Ref_To_Local'>right_divider</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN71"><span class='Ref_to_Proto'>inet_hist_match_divider</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN608"><span class='Ref_To_Local'>right</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN606"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN603"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN614"><span class='Ref_To_Local'>left_divider</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="network_selfuncs.c.html#LN615"><span class='Ref_To_Local'>right_divider</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="network_selfuncs.c.html#LN605"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>/ </span>pow<span class='Parentheses'>(</span><span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN614"><span class='Ref_To_Local'>left_divider</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN615"><span class='Ref_To_Local'>right_divider</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Shift the variables. */ 
</span>        <a href="network_selfuncs.c.html#LN607"><span class='Ref_To_Local'>left</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN608"><span class='Ref_To_Local'>right</span></a><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN612"><span class='Ref_To_Local'>left_order</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN613"><span class='Ref_To_Local'>right_order</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Count the number of buckets considered. */ 
</span>        <a href="network_selfuncs.c.html#LN611"><span class='Ref_To_Local'>n</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=k;i&LT;nvalues;i+=k &raquo; </span> 
 
    <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN605"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>/ </span><a href="network_selfuncs.c.html#LN611"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end inet_hist_value_sel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Inet MCV vs MCV join selectivity estimation 
 * 
 * We simply add up the fractions of the populations that satisfy the clause. 
 * The result is exact and does not need to be scaled further. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN671"></a><span class='Declare_Function'>inet_mcv_join_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv1_values</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv1_numbers</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mcv1_nvalues</span><span class='Delimiter'>, 
</span><a name="LN672"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv2_values</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv2_numbers</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mcv2_nvalues</span><span class='Delimiter'>, 
</span><a name="LN673"></a>                  <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN675"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>selec</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN676"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Local'>proc</span><span class='Delimiter'>; 
</span><a name="LN677"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN678"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN98"><span class='Ref_to_Proto'>get_opcode</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN676"><span class='Ref_To_Local'>proc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN677"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN677"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="network_selfuncs.c.html#LN671"><span class='Ref_to_Parameter'>mcv1_nvalues</span></a><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN677"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN678"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN678"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="network_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>mcv2_nvalues</span></a><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN678"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN603"><span class='Ref_to_Macro'>FunctionCall2</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="network_selfuncs.c.html#LN676"><span class='Ref_To_Local'>proc</span></a><span class='Delimiter'>, 
</span>                                           <a href="network_selfuncs.c.html#LN671"><span class='Ref_to_Parameter'>mcv1_values</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN677"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                           <a href="network_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>mcv2_values</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN678"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span> 
                <a href="network_selfuncs.c.html#LN675"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>+= </span><a href="network_selfuncs.c.html#LN671"><span class='Ref_to_Parameter'>mcv1_numbers</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN677"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>* </span><a href="network_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>mcv2_numbers</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN678"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN675"><span class='Ref_To_Local'>selec</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end inet_mcv_join_sel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Inet MCV vs histogram join selectivity estimation 
 * 
 * For each MCV on the lefthand side, estimate the fraction of the righthand's 
 * histogram population that satisfies the join clause, and add those up, 
 * scaling by the MCV's frequency.  The result still needs to be scaled 
 * according to the fraction of the righthand's population represented by 
 * the histogram. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN703"></a><span class='Declare_Function'>inet_mcv_hist_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv_values</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv_numbers</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mcv_nvalues</span><span class='Delimiter'>, 
</span><a name="LN704"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN705"></a>                  <span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN707"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>selec</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN708"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We'll call inet_hist_value_selec with the histogram on the left, so we 
     * must commute the operator. 
     */ 
</span>    <a href="network_selfuncs.c.html#LN705"><span class='Ref_to_Parameter'>opr_codenum</span></a> <span class='Operator'>= -</span><a href="network_selfuncs.c.html#LN705"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN708"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN708"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="network_selfuncs.c.html#LN703"><span class='Ref_to_Parameter'>mcv_nvalues</span></a><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN708"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="network_selfuncs.c.html#LN707"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>+= </span><a href="network_selfuncs.c.html#LN703"><span class='Ref_to_Parameter'>mcv_numbers</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN708"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>* 
</span>            <a href="network_selfuncs.c.html#LN50"><span class='Ref_to_Proto'>inet_hist_value_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN704"><span class='Ref_to_Parameter'>hist_values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN704"><span class='Ref_to_Parameter'>hist_nvalues</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN703"><span class='Ref_to_Parameter'>mcv_values</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN708"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                <a href="network_selfuncs.c.html#LN705"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN707"><span class='Ref_To_Local'>selec</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end inet_mcv_hist_sel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Inet histogram vs histogram join selectivity estimation 
 * 
 * Here, we take all values listed in the second histogram (except for the 
 * first and last elements, which are excluded on the grounds of possibly 
 * not being very representative) and treat them as a uniform sample of 
 * the non-MCV population for that relation.  For each one, we apply 
 * inet_hist_value_selec to see what fraction of the first histogram 
 * it matches. 
 * 
 * We could alternatively do this the other way around using the operator's 
 * commutator.  XXX would it be worthwhile to do it both ways and take the 
 * average?  That would at least avoid non-commutative estimation results. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN740"></a><span class='Declare_Function'>inet_hist_inclusion_join_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist1_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist1_nvalues</span><span class='Delimiter'>, 
</span><a name="LN741"></a>                             <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist2_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist2_nvalues</span><span class='Delimiter'>, 
</span><a name="LN742"></a>                             <span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN744"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>match</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN745"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN746"></a>                <span class='Declare_Local'>k</span><span class='Delimiter'>, 
</span><a name="LN747"></a>                <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN741"><span class='Ref_to_Parameter'>hist2_nvalues</span></a> <span class='Operator'>&LT;= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* no interior histogram elements */ 
</span> 
    <span class='Comment_Multi_Line'>/* if there are too many histogram elements, decimate to limit runtime */ 
</span>    <a href="network_selfuncs.c.html#LN746"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN741"><span class='Ref_to_Parameter'>hist2_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="network_selfuncs.c.html#LN43"><span class='Ref_to_Const'>MAX_CONSIDERED_ELEMS</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="network_selfuncs.c.html#LN747"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN745"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN745"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="network_selfuncs.c.html#LN741"><span class='Ref_to_Parameter'>hist2_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN745"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+= </span><a href="network_selfuncs.c.html#LN746"><span class='Ref_To_Local'>k</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="network_selfuncs.c.html#LN744"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>+= </span><a href="network_selfuncs.c.html#LN50"><span class='Ref_to_Proto'>inet_hist_value_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN740"><span class='Ref_to_Parameter'>hist1_values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN740"><span class='Ref_to_Parameter'>hist1_nvalues</span></a><span class='Delimiter'>, 
</span>                                     <a href="network_selfuncs.c.html#LN741"><span class='Ref_to_Parameter'>hist2_values</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN745"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="network_selfuncs.c.html#LN742"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="network_selfuncs.c.html#LN747"><span class='Ref_To_Local'>n</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN744"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>/ </span><a href="network_selfuncs.c.html#LN747"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end inet_hist_inclusion_join_sel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Inet semi join selectivity estimation for one value 
 * 
 * The function calculates the probability that there is at least one row 
 * in the RHS table that satisfies the "lhs_value op column" condition. 
 * It is used in semi join estimation to check a sample from the left hand 
 * side table. 
 * 
 * The MCV and histogram from the right hand side table should be provided as 
 * arguments with the lhs_value from the left hand side table for the join. 
 * hist_weight is the total number of rows represented by the histogram. 
 * For example, if the table has 1000 rows, and 10% of the rows are in the MCV 
 * list, and another 10% are NULLs, hist_weight would be 800. 
 * 
 * First, the lhs_value will be matched to the most common values.  If it 
 * matches any of them, 1.0 will be returned, because then there is surely 
 * a match. 
 * 
 * Otherwise, the histogram will be used to estimate the number of rows in 
 * the second table that match the condition.  If the estimate is greater 
 * than 1.0, 1.0 will be returned, because it means there is a greater chance 
 * that the lhs_value will match more than one row in the table.  If it is 
 * between 0.0 and 1.0, it will be returned as the probability. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> 
<a name="LN791"></a><span class='Declare_Function'>inet_semi_join_sel</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>lhs_value</span><span class='Delimiter'>, 
</span><a name="LN792"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>mcv_exists</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>mcv_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mcv_nvalues</span><span class='Delimiter'>, 
</span><a name="LN793"></a>                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>hist_exists</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN794"></a>                   <span class='Keyword'>double </span><span class='Declare_Parameter'>hist_weight</span><span class='Delimiter'>, 
</span><a name="LN795"></a>                   <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>proc</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN792"><span class='Ref_to_Parameter'>mcv_exists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN799"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN799"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN799"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="network_selfuncs.c.html#LN792"><span class='Ref_to_Parameter'>mcv_nvalues</span></a><span class='Delimiter'>; </span><a href="network_selfuncs.c.html#LN799"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN603"><span class='Ref_to_Macro'>FunctionCall2</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN795"><span class='Ref_to_Parameter'>proc</span></a><span class='Delimiter'>, 
</span>                                           <a href="network_selfuncs.c.html#LN791"><span class='Ref_to_Parameter'>lhs_value</span></a><span class='Delimiter'>, 
</span>                                           <a href="network_selfuncs.c.html#LN792"><span class='Ref_to_Parameter'>mcv_values</span></a><span class='Delimiter'>[</span><a href="network_selfuncs.c.html#LN799"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span> 
                <span class='Control'>return</span> <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN793"><span class='Ref_to_Parameter'>hist_exists</span></a> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>hist_weight</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN812"></a>        <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>hist_selec</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Commute operator, since we're passing lhs_value on the right */ 
</span>        <a href="network_selfuncs.c.html#LN812"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN50"><span class='Ref_to_Proto'>inet_hist_value_sel</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN793"><span class='Ref_to_Parameter'>hist_values</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN793"><span class='Ref_to_Parameter'>hist_nvalues</span></a><span class='Delimiter'>, 
</span>                                         <a href="network_selfuncs.c.html#LN791"><span class='Ref_to_Parameter'>lhs_value</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="network_selfuncs.c.html#LN795"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN812"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>hist_weight</span></a> <span class='Operator'>* </span><a href="network_selfuncs.c.html#LN812"><span class='Ref_To_Local'>hist_selec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end inet_semi_join_sel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Assign useful code numbers for the subnet inclusion/overlap operators 
 * 
 * Only inet_masklen_inclusion_cmp() and inet_hist_match_divider() depend 
 * on the exact codes assigned here; but many other places in this file 
 * know that they can negate a code to obtain the code for the commutator 
 * operator. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN834"></a><span class='Declare_Function'>inet_opr_codenum</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1184"><span class='Ref_to_Const'>OID_INET_SUP_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1187"><span class='Ref_to_Const'>OID_INET_SUPEQ_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1190"><span class='Ref_to_Const'>OID_INET_OVERLAP_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1181"><span class='Ref_to_Const'>OID_INET_SUBEQ_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1178"><span class='Ref_to_Const'>OID_INET_SUB_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized operator %u for inet selectivity"</span><span class='Delimiter'>, 
</span>                 <span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* unreached, but keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end inet_opr_codenum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Comparison function for the subnet inclusion/overlap operators 
 * 
 * If the comparison is okay for the specified inclusion operator, the return 
 * value will be 0.  Otherwise the return value will be less than or greater 
 * than 0 as appropriate for the operator. 
 * 
 * Comparison is compatible with the basic comparison function for the inet 
 * type.  See network_cmp_internal() in network.c for the original.  Basic 
 * comparison operators are implemented with the network_cmp_internal() 
 * function.  It is possible to implement the subnet inclusion operators with 
 * this function. 
 * 
 * Comparison is first on the common bits of the network part, then on the 
 * length of the network part (masklen) as in the network_cmp_internal() 
 * function.  Only the first part is in this function.  The second part is 
 * separated to another function for reusability.  The difference between the 
 * second part and the original network_cmp_internal() is that the inclusion 
 * operator is considered while comparing the lengths of the network parts. 
 * See the inet_masklen_inclusion_cmp() function below. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN877"></a><span class='Declare_Function'>inet_inclusion_cmp</span><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>left</span><span class='Delimiter'>, </span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>right</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN70"><span class='Ref_to_Macro'>ip_family</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>left</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/utils/inet.h.html#LN70"><span class='Ref_to_Macro'>ip_family</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>right</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN881"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>order</span><span class='Delimiter'>; 
</span> 
        <a href="network_selfuncs.c.html#LN881"><span class='Ref_To_Local'>order</span></a> <span class='Operator'>= </span><a href="../../../include/utils/inet.h.html#LN145"><span class='Ref_to_Proto'>bitncmp</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN76"><span class='Ref_to_Macro'>ip_addr</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>left</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/inet.h.html#LN76"><span class='Ref_to_Macro'>ip_addr</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>right</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN73"><span class='Ref_to_Macro'>ip_bits</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>left</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/inet.h.html#LN73"><span class='Ref_to_Macro'>ip_bits</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>right</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN881"><span class='Ref_To_Local'>order</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN881"><span class='Ref_To_Local'>order</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN69"><span class='Ref_to_Proto'>inet_masklen_inclusion_cmp</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>left</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>right</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/inet.h.html#LN70"><span class='Ref_to_Macro'>ip_family</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>left</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/utils/inet.h.html#LN70"><span class='Ref_to_Macro'>ip_family</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN877"><span class='Ref_to_Parameter'>right</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Masklen comparison function for the subnet inclusion/overlap operators 
 * 
 * Compares the lengths of the network parts of the inputs.  If the comparison 
 * is okay for the specified inclusion operator, the return value will be 0. 
 * Otherwise the return value will be less than or greater than 0 as 
 * appropriate for the operator. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN903"></a><span class='Declare_Function'>inet_masklen_inclusion_cmp</span><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>left</span><span class='Delimiter'>, </span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>right</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN905"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>order</span><span class='Delimiter'>; 
</span> 
    <a href="network_selfuncs.c.html#LN905"><span class='Ref_To_Local'>order</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/utils/inet.h.html#LN73"><span class='Ref_to_Macro'>ip_bits</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN903"><span class='Ref_to_Parameter'>left</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="../../../include/utils/inet.h.html#LN73"><span class='Ref_to_Macro'>ip_bits</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN903"><span class='Ref_to_Parameter'>right</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return 0 if the operator would accept this combination of masklens. 
     * Note that opr_codenum zero (overlaps) will accept all cases. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="network_selfuncs.c.html#LN905"><span class='Ref_To_Local'>order</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN903"><span class='Ref_to_Parameter'>opr_codenum</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN905"><span class='Ref_To_Local'>order</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN903"><span class='Ref_to_Parameter'>opr_codenum</span></a> <span class='Operator'>&GT;= -</span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN903"><span class='Ref_to_Parameter'>opr_codenum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN905"><span class='Ref_To_Local'>order</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="network_selfuncs.c.html#LN903"><span class='Ref_to_Parameter'>opr_codenum</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Otherwise, return a negative value for sup/supeq (notionally, the RHS 
     * needs to have a larger masklen than it has, which would make it sort 
     * later), or a positive value for sub/subeq (vice versa). 
     */ 
</span>    <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN903"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end inet_masklen_inclusion_cmp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Inet histogram partial match divider calculation 
 * 
 * First the families and the lengths of the network parts are compared using 
 * the subnet inclusion operator.  If those are acceptable for the operator, 
 * the divider will be calculated using the masklens and the common bits of 
 * the addresses.  -1 will be returned if it cannot be calculated. 
 * 
 * See commentary for inet_hist_value_sel() for some rationale for this. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN937"></a><span class='Declare_Function'>inet_hist_match_divider</span><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>boundary</span><span class='Delimiter'>, </span><a href="../../../include/utils/inet.h.html#LN51"><span class='Ref_to_Typedef'>inet</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>opr_codenum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN70"><span class='Ref_to_Macro'>ip_family</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>boundary</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/utils/inet.h.html#LN70"><span class='Ref_to_Macro'>ip_family</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <a href="network_selfuncs.c.html#LN69"><span class='Ref_to_Proto'>inet_masklen_inclusion_cmp</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>boundary</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>opr_codenum</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN942"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>min_bits</span><span class='Delimiter'>, 
</span><a name="LN943"></a>                    <span class='Declare_Local'>decisive_bits</span><span class='Delimiter'>; 
</span> 
        <a href="network_selfuncs.c.html#LN942"><span class='Ref_To_Local'>min_bits</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN73"><span class='Ref_to_Macro'>ip_bits</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>boundary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/utils/inet.h.html#LN73"><span class='Ref_to_Macro'>ip_bits</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Set decisive_bits to the masklen of the one that should contain the 
         * other according to the operator. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>opr_codenum</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="network_selfuncs.c.html#LN943"><span class='Ref_To_Local'>decisive_bits</span></a> <span class='Operator'>= </span><a href="../../../include/utils/inet.h.html#LN73"><span class='Ref_to_Macro'>ip_bits</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>boundary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>opr_codenum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="network_selfuncs.c.html#LN943"><span class='Ref_To_Local'>decisive_bits</span></a> <span class='Operator'>= </span><a href="../../../include/utils/inet.h.html#LN73"><span class='Ref_to_Macro'>ip_bits</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="network_selfuncs.c.html#LN943"><span class='Ref_To_Local'>decisive_bits</span></a> <span class='Operator'>= </span><a href="network_selfuncs.c.html#LN942"><span class='Ref_To_Local'>min_bits</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now return the number of non-common decisive bits.  (This will be 
         * zero if the boundary and query in fact match, else positive.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN942"><span class='Ref_To_Local'>min_bits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN943"><span class='Ref_To_Local'>decisive_bits</span></a> <span class='Operator'>- </span><a href="../../../include/utils/inet.h.html#LN146"><span class='Ref_to_Proto'>bitncommon</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/inet.h.html#LN76"><span class='Ref_to_Macro'>ip_addr</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>boundary</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/inet.h.html#LN76"><span class='Ref_to_Macro'>ip_addr</span></a><span class='Parentheses'>(</span><a href="network_selfuncs.c.html#LN937"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="network_selfuncs.c.html#LN942"><span class='Ref_To_Local'>min_bits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="network_selfuncs.c.html#LN943"><span class='Ref_To_Local'>decisive_bits</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ip_family(boundary)==... &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end inet_hist_match_divider &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>