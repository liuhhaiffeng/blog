<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\numeric.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\numeric.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:52 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * numeric.c 
 *    An exact numeric data type for the Postgres database system 
 * 
 * Original coding 1998, Jan Wieck.  Heavily revised 2003, Tom Lane. 
 * 
 * Many of the algorithmic ideas are borrowed from David M. Smith's "FM" 
 * multiple-precision math library, most recently published as Algorithm 
 * 786: Multiple-Precision Complex Arithmetic and Functions, ACM 
 * Transactions on Mathematical Software, Vol. 24, No. 4, December 1998, 
 * pages 359-367. 
 * 
 * Copyright (c) 1998-2017, PostgreSQL Global Development Group 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/numeric.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;float.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/hyperloglog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/guc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/int8.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/numeric.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/sortsupport.h"</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Uncomment the following to enable compilation of dump_numeric() 
 * and dump_var() and to get a dump of any result produced by make_result(). 
 * ---------- 
#define NUMERIC_DEBUG 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Local data types 
 * 
 * Numeric values are represented in a base-NBASE floating point format. 
 * Each "digit" ranges from 0 to NBASE-1.  The type NumericDigit is signed 
 * and wide enough to store a digit.  We assume that NBASE*NBASE can fit in 
 * an int.  Although the purely calculational routines could handle any even 
 * NBASE that's less than sqrt(INT_MAX), in practice we are only interested 
 * in NBASE a power of ten, so that I/O conversions and decimal rounding 
 * are easy.  Also, it's actually more efficient if NBASE is rather less than 
 * sqrt(INT_MAX), so that there is "headroom" for mul_var and div_var_fast to 
 * postpone processing carries. 
 * 
 * Values of NBASE other than 10000 are considered of historical interest only 
 * and are no longer supported in any sense; no mechanism exists for the client 
 * to discover the base, so every client supporting binary mode expects the 
 * base-10000 format.  If you plan to change this, also note the numeric 
 * abbreviation code, which assumes NBASE=10000. 
 * ---------- 
 */ 
</span> 
<span class='Directive'>#if</span> <span class='Number'>0</span> 
<span class='Inactive_Code'>#define NBASE       10 
#define HALF_NBASE  5 
#define DEC_DIGITS  1           /* decimal digits per NBASE digit */ 
#define MUL_GUARD_DIGITS    4   /* these are measured in NBASE digits */ 
#define DIV_GUARD_DIGITS    8 
 
typedef signed char NumericDigit; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Number'>0</span> 
<span class='Inactive_Code'>#define NBASE       100 
#define HALF_NBASE  50 
#define DEC_DIGITS  2           /* decimal digits per NBASE digit */ 
#define MUL_GUARD_DIGITS    3   /* these are measured in NBASE digits */ 
#define DIV_GUARD_DIGITS    6 
 
typedef signed char NumericDigit; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <span class='Number'>1</span> 
<a name="LN92"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NBASE</span>       <span class='Number'>10000</span> 
<a name="LN93"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HALF_NBASE</span>  <span class='Number'>5000</span> 
<a name="LN94"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEC_DIGITS</span>  <span class='Number'>4</span>           <span class='Comment_Single_Line'>/* decimal digits per NBASE digit */ 
</span><a name="LN95"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MUL_GUARD_DIGITS</span>    <span class='Number'>2</span>   <span class='Comment_Single_Line'>/* these are measured in NBASE digits */ 
</span><a name="LN96"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DIV_GUARD_DIGITS</span>    <span class='Number'>4</span> 
 
<a name="LN98"></a><span class='Control'>typedef</span> <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Declare_Typedef'>NumericDigit</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * The Numeric type as stored on disk. 
 * 
 * If the high bits of the first word of a NumericChoice (n_header, or 
 * n_short.n_header, or n_long.n_sign_dscale) are NUMERIC_SHORT, then the 
 * numeric follows the NumericShort format; if they are NUMERIC_POS or 
 * NUMERIC_NEG, it follows the NumericLong format.  If they are NUMERIC_NAN, 
 * it is a NaN.  We currently always store a NaN using just two bytes (i.e. 
 * only n_header), but previous releases used only the NumericLong format, 
 * so we might find 4-byte NaNs on disk if a database has been migrated using 
 * pg_upgrade.  In either case, when the high bits indicate a NaN, the 
 * remaining bits are never examined.  Currently, we always initialize these 
 * to zero, but it might be possible to use them for some other purpose in 
 * the future. 
 * 
 * In the NumericShort format, the remaining 14 bits of the header word 
 * (n_short.n_header) are allocated as follows: 1 for sign (positive or 
 * negative), 6 for dynamic scale, and 7 for weight.  In practice, most 
 * commonly-encountered values can be represented this way. 
 * 
 * In the NumericLong format, the remaining 14 bits of the header word 
 * (n_long.n_sign_dscale) represent the display scale; and the weight is 
 * stored separately in n_weight. 
 * 
 * NOTE: by convention, values in the packed form have been stripped of 
 * all leading and trailing zero digits (where a "digit" is of base NBASE). 
 * In particular, if the value is zero, there will be no digits at all! 
 * The weight is arbitrary in that case, but we normally set it to zero. 
 */ 
</span> 
<a name="LN131"></a><span class='Control'>struct</span> <span class='Declare_Struct'>NumericShort</span> 
<span class='Delimiter'>{ 
</span><a name="LN133"></a>    <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Member'>n_header</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Sign + display scale + weight */ 
</span><a name="LN134"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Member'>n_data</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* Digits */ 
</span><span class='Delimiter'>}; 
</span> 
<a name="LN137"></a><span class='Control'>struct</span> <span class='Declare_Struct'>NumericLong</span> 
<span class='Delimiter'>{ 
</span><a name="LN139"></a>    <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Member'>n_sign_dscale</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Sign + display scale */ 
</span><a name="LN140"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Member'>n_weight</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Weight of 1st digit  */ 
</span><a name="LN141"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Member'>n_data</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* Digits */ 
</span><span class='Delimiter'>}; 
</span> 
<a name="LN144"></a><span class='Control'>union</span> <span class='Declare_Union'>NumericChoice</span> 
<span class='Delimiter'>{ 
</span><a name="LN146"></a>    <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Member'>n_header</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* Header word */ 
</span><a name="LN147"></a>    <span class='Control'>struct</span> <a href="numeric.c.html#LN137"><span class='Ref_to_Struct'>NumericLong</span></a> <span class='Declare_Member'>n_long</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Long form (4-byte header) */ 
</span><a name="LN148"></a>    <span class='Control'>struct</span> <a href="numeric.c.html#LN131"><span class='Ref_to_Struct'>NumericShort</span></a> <span class='Declare_Member'>n_short</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* Short form (2-byte header) */ 
</span><span class='Delimiter'>}; 
</span> 
<a name="LN151"></a><span class='Control'>struct</span> <span class='Declare_Struct'>NumericData</span> 
<span class='Delimiter'>{ 
</span><a name="LN153"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>vl_len_</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* varlena header (do not touch directly!) */ 
</span><a name="LN154"></a>    <span class='Control'>union</span> <a href="numeric.c.html#LN144"><span class='Ref_to_Union'>NumericChoice</span></a> <span class='Declare_Member'>choice</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* choice of format */ 
</span><span class='Delimiter'>}; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Interpretation of high bits. 
 */ 
</span> 
<a name="LN162"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SIGN_MASK</span>   <span class='Number'>0xC000</span> 
<a name="LN163"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_POS</span>         <span class='Number'>0x0000</span> 
<a name="LN164"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_NEG</span>         <span class='Number'>0x4000</span> 
<a name="LN165"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SHORT</span>       <span class='Number'>0x8000</span> 
<a name="LN166"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_NAN</span>         <span class='Number'>0xC000</span> 
 
<a name="LN168"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_FLAGBITS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) ((</span><a href="numeric.c.html#LN168"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_header <span class='Operator'>& </span><a href="numeric.c.html#LN162"><span class='Ref_to_Const'>NUMERIC_SIGN_MASK</span></a><span class='Parentheses'>)</span> 
<a name="LN169"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_IS_NAN</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>       <span class='Parentheses'>(</span><a href="numeric.c.html#LN168"><span class='Ref_to_Macro'>NUMERIC_FLAGBITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN5"><span class='Ref_to_Const'>NUMERIC_NAN</span></a><span class='Parentheses'>)</span> 
<a name="LN170"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_IS_SHORT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>     <span class='Parentheses'>(</span><a href="numeric.c.html#LN168"><span class='Ref_to_Macro'>NUMERIC_FLAGBITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN170"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="numeric.c.html#LN165"><span class='Ref_to_Const'>NUMERIC_SHORT</span></a><span class='Parentheses'>)</span> 
 
<a name="LN172"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_HDRSZ</span>   <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span> 
<a name="LN173"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_HDRSZ_SHORT</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * If the flag bits are NUMERIC_SHORT or NUMERIC_NAN, we want the short header; 
 * otherwise, we want the long one.  Instead of testing against each value, we 
 * can just look at the high bit, for a slight efficiency gain. 
 */ 
</span><a name="LN180"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_HEADER_IS_SHORT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>  <span class='Parentheses'>(((</span><a href="numeric.c.html#LN180"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_header <span class='Operator'>& </span><span class='Number'>0x8000</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
<a name="LN181"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_HEADER_SIZE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ \ 
</span>     <span class='Parentheses'>(</span><a href="numeric.c.html#LN180"><span class='Ref_to_Macro'>NUMERIC_HEADER_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN181"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>)))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Short format definitions. 
 */ 
</span> 
<a name="LN189"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SHORT_SIGN_MASK</span>         <span class='Number'>0x2000</span> 
<a name="LN190"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SHORT_DSCALE_MASK</span>       <span class='Number'>0x1F80</span> 
<a name="LN191"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SHORT_DSCALE_SHIFT</span>      <span class='Number'>7</span> 
<a name="LN192"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SHORT_DSCALE_MAX</span>        <span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="numeric.c.html#LN190"><span class='Ref_to_Const'>NUMERIC_SHORT_DSCALE_MASK</span></a> <span class='Operator'>&GT;&GT; </span><a href="numeric.c.html#LN191"><span class='Ref_to_Const'>NUMERIC_SHORT_DSCALE_SHIFT</span></a><span class='Parentheses'>) 
</span><a name="LN194"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SHORT_WEIGHT_SIGN_MASK</span>  <span class='Number'>0x0040</span> 
<a name="LN195"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SHORT_WEIGHT_MASK</span>       <span class='Number'>0x003F</span> 
<a name="LN196"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SHORT_WEIGHT_MAX</span>        <a href="numeric.c.html#LN195"><span class='Ref_to_Const'>NUMERIC_SHORT_WEIGHT_MASK</span></a> 
<a name="LN197"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_SHORT_WEIGHT_MIN</span>        <span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN195"><span class='Ref_to_Const'>NUMERIC_SHORT_WEIGHT_MASK</span></a><span class='Operator'>+</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Extract sign, display scale, weight. 
 */ 
</span> 
<a name="LN203"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_DSCALE_MASK</span>         <span class='Number'>0x3FFF</span> 
 
<a name="LN205"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_SIGN</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="numeric.c.html#LN170"><span class='Ref_to_Macro'>NUMERIC_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN205"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>        <span class='Parentheses'>(((</span><a href="numeric.c.html#LN205"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_short<span class='Operator'>.</span>n_header <span class='Operator'>& </span><a href="numeric.c.html#LN189"><span class='Ref_to_Const'>NUMERIC_SHORT_SIGN_MASK</span></a><span class='Parentheses'>)</span> <span class='Operator'>? \ 
</span>        <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a> <span class='Operator'>: </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>)</span> <span class='Operator'>: </span><a href="numeric.c.html#LN168"><span class='Ref_to_Macro'>NUMERIC_FLAGBITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN205"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> 
<a name="LN209"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_DSCALE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>   <span class='Parentheses'>(</span><a href="numeric.c.html#LN180"><span class='Ref_to_Macro'>NUMERIC_HEADER_IS_SHORT</span></a><span class='Parentheses'>((</span><a href="numeric.c.html#LN209"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> <span class='Operator'>? \ 
</span>    <span class='Parentheses'>((</span><a href="numeric.c.html#LN209"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_short<span class='Operator'>.</span>n_header <span class='Operator'>& </span><a href="numeric.c.html#LN190"><span class='Ref_to_Const'>NUMERIC_SHORT_DSCALE_MASK</span></a><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>        <span class='Operator'>&GT;&GT; </span><a href="numeric.c.html#LN191"><span class='Ref_to_Const'>NUMERIC_SHORT_DSCALE_SHIFT</span></a> <span class='Operator'>\ 
</span>    <span class='Operator'>: </span><span class='Parentheses'>((</span><a href="numeric.c.html#LN209"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_long<span class='Operator'>.</span>n_sign_dscale <span class='Operator'>& </span><a href="numeric.c.html#LN203"><span class='Ref_to_Const'>NUMERIC_DSCALE_MASK</span></a><span class='Parentheses'>))</span> 
<a name="LN213"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_WEIGHT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>   <span class='Parentheses'>(</span><a href="numeric.c.html#LN180"><span class='Ref_to_Macro'>NUMERIC_HEADER_IS_SHORT</span></a><span class='Parentheses'>((</span><a href="numeric.c.html#LN213"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> <span class='Operator'>? \ 
</span>    <span class='Parentheses'>(((</span><a href="numeric.c.html#LN213"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_short<span class='Operator'>.</span>n_header <span class='Operator'>& </span><a href="numeric.c.html#LN194"><span class='Ref_to_Const'>NUMERIC_SHORT_WEIGHT_SIGN_MASK</span></a> <span class='Operator'>? \ 
</span>        <span class='Operator'>~</span><a href="numeric.c.html#LN195"><span class='Ref_to_Const'>NUMERIC_SHORT_WEIGHT_MASK</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>     <span class='Operator'>| </span><span class='Parentheses'>((</span><a href="numeric.c.html#LN213"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_short<span class='Operator'>.</span>n_header <span class='Operator'>& </span><a href="numeric.c.html#LN195"><span class='Ref_to_Const'>NUMERIC_SHORT_WEIGHT_MASK</span></a><span class='Parentheses'>))</span> <span class='Operator'>\ 
</span>    <span class='Operator'>: </span><span class='Parentheses'>((</span><a href="numeric.c.html#LN213"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_long<span class='Operator'>.</span>n_weight<span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * NumericVar is the format we use for arithmetic.  The digit-array part 
 * is the same as the NumericData storage format, but the header is more 
 * complex. 
 * 
 * The value represented by a NumericVar is determined by the sign, weight, 
 * ndigits, and digits[] array. 
 * 
 * Note: the first digit of a NumericVar's value is assumed to be multiplied 
 * by NBASE ** weight.  Another way to say it is that there are weight+1 
 * digits before the decimal point.  It is possible to have weight &LT; 0. 
 * 
 * buf points at the physical start of the palloc'd digit buffer for the 
 * NumericVar.  digits points at the first digit in actual use (the one 
 * with the specified weight).  We normally leave an unused digit or two 
 * (preset to zeroes) between buf and digits, so that there is room to store 
 * a carry out of the top digit without reallocating space.  We just need to 
 * decrement digits (and increment weight) to make room for the carry digit. 
 * (There is no such extra space in a numeric value stored in the database, 
 * only in a NumericVar in memory.) 
 * 
 * If buf is NULL then the digit buffer isn't actually palloc'd and should 
 * not be freed --- see the constants below for an example. 
 * 
 * dscale, or display scale, is the nominal precision expressed as number 
 * of digits after the decimal point (it must always be &GT;= 0 at present). 
 * dscale may be more than the number of physically stored fractional digits, 
 * implying that we have suppressed storage of significant trailing zeroes. 
 * It should never be less than the number of stored digits, since that would 
 * imply hiding digits that are present.  NOTE that dscale is always expressed 
 * in *decimal* digits, and so it may correspond to a fractional number of 
 * base-NBASE digits --- divide by DEC_DIGITS to convert to NBASE digits. 
 * 
 * rscale, or result scale, is the target precision for a computation. 
 * Like dscale it is expressed as number of *decimal* digits after the decimal 
 * point, and is always &GT;= 0 at present. 
 * Note that rscale is not stored in variables --- it's figured on-the-fly 
 * from the dscales of the inputs. 
 * 
 * While we consistently use "weight" to refer to the base-NBASE weight of 
 * a numeric value, it is convenient in some scale-related calculations to 
 * make use of the base-10 weight (ie, the approximate log10 of the value). 
 * To avoid confusion, such a decimal-units weight is called a "dweight". 
 * 
 * NB: All the variable-level functions are written in a style that makes it 
 * possible to give one and the same variable as argument and destination. 
 * This is feasible because the digit buffer is separate from the variable. 
 * ---------- 
 */ 
</span><a name="LN268"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>NumericVar</span> 
<span class='Delimiter'>{ 
</span><a name="LN270"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>ndigits</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* # of digits in digits[] - can be 0! */ 
</span><a name="LN271"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>weight</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* weight of first digit */ 
</span><a name="LN272"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>sign</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* NUMERIC_POS, NUMERIC_NEG, or NUMERIC_NAN */ 
</span><a name="LN273"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>dscale</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* display scale */ 
</span><a name="LN274"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Member'>buf</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* start of palloc'd space for digits[] */ 
</span><a name="LN275"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Member'>digits</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* base-NBASE digits */ 
</span><a name="LN276"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>NumericVar</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Data for generate_series 
 * ---------- 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN285"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Member'>current</span><span class='Delimiter'>; 
</span><a name="LN286"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Member'>stop</span><span class='Delimiter'>; 
</span><a name="LN287"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Member'>step</span><span class='Delimiter'>; 
</span><a name="LN288"></a>} <span class='Declare_Typedef'>generate_series_numeric_fctx</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Sort support. 
 * ---------- 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN297"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>buf</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* buffer for short varlenas */ 
</span><a name="LN298"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>input_count</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* number of non-null values seen */ 
</span><a name="LN299"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>estimating</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* true if estimating cardinality */ 
</span> 
<a name="LN301"></a>    <a href="../../../include/lib/hyperloglog.h.html#LN52"><span class='Ref_to_Struct'>hyperLogLogState</span></a> <span class='Declare_Member'>abbr_card</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* cardinality estimator */ 
</span><a name="LN302"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>NumericSortSupport</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Fast sum accumulator. 
 * 
 * NumericSumAccum is used to implement SUM(), and other standard aggregates 
 * that track the sum of input values.  It uses 32-bit integers to store the 
 * digits, instead of the normal 16-bit integers (with NBASE=10000).  This 
 * way, we can safely accumulate up to NBASE - 1 values without propagating 
 * carry, before risking overflow of any of the digits.  'num_uncarried' 
 * tracks how many values have been accumulated without propagating carry. 
 * 
 * Positive and negative values are accumulated separately, in 'pos_digits' 
 * and 'neg_digits'.  This is simpler and faster than deciding whether to add 
 * or subtract from the current value, for each new value (see sub_var() for 
 * the logic we avoid by doing this).  Both buffers are of same size, and 
 * have the same weight and scale.  In accum_sum_final(), the positive and 
 * negative sums are added together to produce the final result. 
 * 
 * When a new value has a larger ndigits or weight than the accumulator 
 * currently does, the accumulator is enlarged to accommodate the new value. 
 * We normally have one zero digit reserved for carry propagation, and that 
 * is indicated by the 'have_carry_space' flag.  When accum_sum_carry() uses 
 * up the reserved digit, it clears the 'have_carry_space' flag.  The next 
 * call to accum_sum_add() will enlarge the buffer, to make room for the 
 * extra digit, and set the flag again. 
 * 
 * To initialize a new accumulator, simply reset all fields to zeros. 
 * 
 * The accumulator does not handle NaNs. 
 * ---------- 
 */ 
</span><a name="LN335"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>NumericSumAccum</span> 
<span class='Delimiter'>{ 
</span><a name="LN337"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>ndigits</span><span class='Delimiter'>; 
</span><a name="LN338"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>weight</span><span class='Delimiter'>; 
</span><a name="LN339"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>dscale</span><span class='Delimiter'>; 
</span><a name="LN340"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>num_uncarried</span><span class='Delimiter'>; 
</span><a name="LN341"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>have_carry_space</span><span class='Delimiter'>; 
</span><a name="LN342"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>pos_digits</span><span class='Delimiter'>; 
</span><a name="LN343"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>neg_digits</span><span class='Delimiter'>; 
</span><a name="LN344"></a>} <span class='Declare_Typedef'>NumericSumAccum</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * We define our own macros for packing and unpacking abbreviated-key 
 * representations for numeric values in order to avoid depending on 
 * USE_FLOAT8_BYVAL.  The type of abbreviation we use is based only on 
 * the size of a datum, not the argument-passing convention for float8. 
 */ 
</span><a name="LN353"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_ABBREV_BITS</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN373"><span class='Ref_to_Const'>SIZEOF_DATUM</span></a> <span class='Operator'>* </span><a href="../../../include/pg_config_manual.h.html#LN105"><span class='Ref_to_Const'>BITS_PER_BYTE</span></a><span class='Parentheses'>) 
</span><span class='Directive'>#if</span> <a href="../../../include/postgres.h.html#LN373"><span class='Ref_to_Const'>SIZEOF_DATUM</span></a> <span class='Operator'>== </span><span class='Number'>8</span> 
<a name="LN355"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NumericAbbrevGetDatum</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>) ((</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN387"><span class='Ref_to_Macro'>SET_8_BYTES</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN355"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN356"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetNumericAbbrev</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>) ((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN381"><span class='Ref_to_Macro'>GET_8_BYTES</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN356"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN357"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_ABBREV_NAN</span>       <a href="numeric.c.html#LN355"><span class='Ref_to_Macro'>NumericAbbrevGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN341"><span class='Ref_to_Const'>PG_INT64_MIN</span></a><span class='Parentheses'>) 
</span><span class='Directive'>#else</span> 
<a name="LN359"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NumericAbbrevGetDatum</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>) ((</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN385"><span class='Ref_to_Macro'>SET_4_BYTES</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN359"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN360"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetNumericAbbrev</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>) ((</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN379"><span class='Ref_to_Macro'>GET_4_BYTES</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN360"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN361"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NUMERIC_ABBREV_NAN</span>       <a href="numeric.c.html#LN355"><span class='Ref_to_Macro'>NumericAbbrevGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN338"><span class='Ref_to_Const'>PG_INT32_MIN</span></a><span class='Parentheses'>) 
</span><span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Some preinitialized constants 
 * ---------- 
 */ 
</span><a name="LN369"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_zero_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>0</span><span class='Delimiter'>}; 
</span><a name="LN370"></a><span class='Keyword'>static </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Declare_Var'>const_zero</span> <span class='Operator'>= 
</span><span class='Delimiter'>{</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN369"><span class='Ref_to_Global_Var'>const_zero_data</span></a><span class='Delimiter'>}; 
</span> 
<a name="LN373"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_one_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>}; 
</span><a name="LN374"></a><span class='Keyword'>static </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Declare_Var'>const_one</span> <span class='Operator'>= 
</span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN373"><span class='Ref_to_Global_Var'>const_one_data</span></a><span class='Delimiter'>}; 
</span> 
<a name="LN377"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_two_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>2</span><span class='Delimiter'>}; 
</span><a name="LN378"></a><span class='Keyword'>static </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Declare_Var'>const_two</span> <span class='Operator'>= 
</span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN377"><span class='Ref_to_Global_Var'>const_two_data</span></a><span class='Delimiter'>}; 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
<a name="LN382"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_ten_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>10</span><span class='Delimiter'>}; 
</span><a name="LN383"></a><span class='Keyword'>static </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Declare_Var'>const_ten</span> <span class='Operator'>= 
</span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN382"><span class='Ref_to_Global_Var'>const_ten_data</span></a><span class='Delimiter'>}; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
<a name="LN386"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_ten_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>}; 
</span><a name="LN387"></a><span class='Keyword'>static </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Declare_Var'>const_ten</span> <span class='Operator'>= 
</span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN382"><span class='Ref_to_Global_Var'>const_ten_data</span></a><span class='Delimiter'>}; 
</span><span class='Directive'>#endif</span> 
 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
<a name="LN392"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_zero_point_five_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>5000</span><span class='Delimiter'>}; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
<a name="LN394"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_zero_point_five_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>50</span><span class='Delimiter'>}; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
<a name="LN396"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_zero_point_five_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>5</span><span class='Delimiter'>}; 
</span><span class='Directive'>#endif</span> 
<a name="LN398"></a><span class='Keyword'>static </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Declare_Var'>const_zero_point_five</span> <span class='Operator'>= 
</span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN392"><span class='Ref_to_Global_Var'>const_zero_point_five_data</span></a><span class='Delimiter'>}; 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
<a name="LN402"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_zero_point_nine_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>9000</span><span class='Delimiter'>}; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
<a name="LN404"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_zero_point_nine_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>90</span><span class='Delimiter'>}; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
<a name="LN406"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_zero_point_nine_data</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>9</span><span class='Delimiter'>}; 
</span><span class='Directive'>#endif</span> 
<a name="LN408"></a><span class='Keyword'>static </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Declare_Var'>const_zero_point_nine</span> <span class='Operator'>= 
</span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN402"><span class='Ref_to_Global_Var'>const_zero_point_nine_data</span></a><span class='Delimiter'>}; 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
<a name="LN412"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_one_point_one_data</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1000</span><span class='Delimiter'>}; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
<a name="LN414"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_one_point_one_data</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>}; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
<a name="LN416"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Var'>const_one_point_one_data</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>}; 
</span><span class='Directive'>#endif</span> 
<a name="LN418"></a><span class='Keyword'>static </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Declare_Var'>const_one_point_one</span> <span class='Operator'>= 
</span><span class='Delimiter'>{</span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN412"><span class='Ref_to_Global_Var'>const_one_point_one_data</span></a><span class='Delimiter'>}; 
</span> 
<a name="LN421"></a><span class='Keyword'>static </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Declare_Var'>const_nan</span> <span class='Operator'>= 
</span><span class='Delimiter'>{</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN5"><span class='Ref_to_Const'>NUMERIC_NAN</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>}; 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
<a name="LN425"></a><span class='Keyword'>static const int </span><span class='Declare_Var'>round_powers</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>1000</span><span class='Delimiter'>, </span><span class='Number'>100</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Delimiter'>}; 
</span><span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * Local functions 
 * ---------- 
 */ 
</span> 
<span class='Directive'>#ifdef</span> NUMERIC_DEBUG 
<a name="LN435"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dump_numeric</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN436"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>dump_var</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN438"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>dump_numeric</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><a name="LN439"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>dump_var</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>v</span><span class='Parentheses'>) 
</span><span class='Directive'>#endif</span> 
 
<a name="LN442"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>digitbuf_alloc</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>ndigits</span><span class='Parentheses'>)</span>  <span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="numeric.c.html#LN442"><span class='Ref_to_Parameter'>ndigits</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>)))</span> 
<a name="LN444"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>digitbuf_free</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>buf</span><span class='Parentheses'>)</span>  <span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>         <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="numeric.c.html#LN444"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> <span class='Operator'>\ 
</span>             <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN444"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN450"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>init_var</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>v</span><span class='Parentheses'>)</span>     <a href="../../../include/c.h.html#LN889"><span class='Ref_to_Macro'>MemSetAligned</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN450"><span class='Ref_to_Parameter'>v</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a><span class='Parentheses'>))</span> 
 
<a name="LN452"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_DIGITS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>num</span><span class='Parentheses'>) (</span><a href="numeric.c.html#LN180"><span class='Ref_to_Macro'>NUMERIC_HEADER_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN452"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>) </span><span class='Operator'>? \ 
</span>    <span class='Parentheses'>(</span><a href="numeric.c.html#LN452"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_short<span class='Operator'>.</span>n_data <span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN452"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>choice<span class='Operator'>.</span>n_long<span class='Operator'>.</span>n_data<span class='Parentheses'>)</span> 
<a name="LN454"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_NDIGITS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>num</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN454"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="numeric.c.html#LN181"><span class='Ref_to_Macro'>NUMERIC_HEADER_SIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN454"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span> 
<a name="LN456"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NUMERIC_CAN_BE_SHORT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>scale</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>weight</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="numeric.c.html#LN456"><span class='Ref_to_Parameter'>scale</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="numeric.c.html#LN192"><span class='Ref_to_Const'>NUMERIC_SHORT_DSCALE_MAX</span></a> <span class='Operator'>&& \ 
</span>    <span class='Parentheses'>(</span><a href="numeric.c.html#LN456"><span class='Ref_to_Parameter'>weight</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="numeric.c.html#LN196"><span class='Ref_to_Const'>NUMERIC_SHORT_WEIGHT_MAX</span></a> <span class='Operator'>&& \ 
</span>    <span class='Parentheses'>(</span><a href="numeric.c.html#LN456"><span class='Ref_to_Parameter'>weight</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="numeric.c.html#LN197"><span class='Ref_to_Const'>NUMERIC_SHORT_WEIGHT_MIN</span></a><span class='Parentheses'>)</span> 
 
<a name="LN461"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>alloc_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndigits</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN462"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>free_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN463"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>zero_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN465"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>set_var_from_str</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Delimiter'>, 
</span><a name="LN466"></a>                 <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN467"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_var_from_num</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN468"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>init_var_from_num</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN469"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>set_var_from_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN470"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>get_str_from_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN471"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>get_str_from_var_sci</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN473"></a><span class='Keyword'>static </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Prototype'>make_result</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN475"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>apply_typmod</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN477"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Prototype'>numericvar_to_int32</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN478"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>numericvar_to_int64</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN479"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>int64_to_numericvar</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<a name="LN481"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>numericvar_to_int128</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN482"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>int128_to_numericvar</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a> <span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN484"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>numeric_to_double_no_overflow</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN485"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>numericvar_to_double_no_overflow</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN487"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>numeric_abbrev_convert</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>original_datum</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN488"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>numeric_abbrev_abort</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>memtupcount</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN489"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>numeric_fast_cmp</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN490"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>numeric_cmp_abbrev</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN492"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>numeric_abbrev_convert_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN295"><span class='Ref_to_Typedef'>NumericSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nss</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN494"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>cmp_numerics</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num1</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN495"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>cmp_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN496"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>cmp_var_common</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1digits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var1ndigits</span><span class='Delimiter'>, 
</span><a name="LN497"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>var1weight</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var1sign</span><span class='Delimiter'>, 
</span><a name="LN498"></a>               <span class='Keyword'>const </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2digits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var2ndigits</span><span class='Delimiter'>, 
</span><a name="LN499"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>var2weight</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var2sign</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN500"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN501"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sub_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN502"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>mul_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN503"></a>        <span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN504"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>div_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN505"></a>        <span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>round</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN506"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>div_var_fast</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN507"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>round</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN508"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>select_div_scale</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN509"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>mod_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN510"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ceil_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN511"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>floor_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN513"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sqrt_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN514"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>exp_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN515"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>estimate_ln_dweight</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN516"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>ln_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN517"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>log_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>base</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>num</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN518"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>power_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>base</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>exp</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN519"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>power_var_int</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>base</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>exp</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN520"></a>              <span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN522"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>cmp_abs</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN523"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>cmp_abs_common</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1digits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var1ndigits</span><span class='Delimiter'>, 
</span><a name="LN524"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>var1weight</span><span class='Delimiter'>, 
</span><a name="LN525"></a>               <span class='Keyword'>const </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2digits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var2ndigits</span><span class='Delimiter'>, 
</span><a name="LN526"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>var2weight</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN527"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>add_abs</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN528"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>sub_abs</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN529"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>round_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN530"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>trunc_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN531"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>strip_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN532"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>compute_bucket</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>operand</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>bound1</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>bound2</span><span class='Delimiter'>, 
</span><a name="LN533"></a>               <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>count_var</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result_var</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN535"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>accum_sum_add</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN536"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>accum_sum_rescale</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN537"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>accum_sum_carry</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN538"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>accum_sum_reset</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN539"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>accum_sum_final</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN540"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>accum_sum_copy</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN541"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>accum_sum_combine</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Input-, output- and rounding-functions 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_in() - 
 * 
 *  Input function for numeric data type 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN558"></a><span class='Declare_Function'>numeric_in</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN560"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
<a name="LN563"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typelem</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN565"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN566"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN567"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Skip leading spaces */ 
</span>    <a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN560"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='String'>"NaN"</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN566"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Should be nothing left but spaces */ 
</span>        <a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s: \"%s\""</span><span class='Delimiter'>, 
</span>                                <span class='String'>"numeric"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN560"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Use set_var_from_str() to parse a normal numeric value 
         */ 
</span><a name="LN602"></a>        <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN161"><span class='Ref_to_Func'>set_var_from_str</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN560"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We duplicate a few lines of code here because we would like to 
         * throw any trailing-junk syntax error before any semantic error 
         * resulting from apply_typmod.  We can't easily fold the two cases 
         * together because we mustn't apply apply_typmod to a NaN. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isspace<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s: \"%s\""</span><span class='Delimiter'>, 
</span>                                <span class='String'>"numeric"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN560"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN567"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="numeric.c.html#LN475"><span class='Ref_to_Proto'>apply_typmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN565"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN566"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN566"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_in &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_out() - 
 * 
 *  Output function for numeric data type 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN640"></a><span class='Declare_Function'>numeric_out</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN642"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN643"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span><a name="LN644"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN642"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"NaN"</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the number in the variable format. 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN642"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN643"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN644"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN309"><span class='Ref_to_Func'>get_str_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN643"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN644"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_out &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_is_nan() - 
 * 
 *  Is Numeric value a NaN? 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN668"></a><span class='Declare_Function'>numeric_is_nan</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN668"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * numeric_maximum_size() - 
 * 
 *  Maximum size of a numeric with given typmod, or -1 if unlimited/unknown. 
 */ 
</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN679"></a><span class='Declare_Function'>numeric_maximum_size</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN681"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>precision</span><span class='Delimiter'>; 
</span><a name="LN682"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>numeric_digits</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN679"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* precision (ie, max # of digits) is in upper bits of typmod */ 
</span>    <a href="numeric.c.html#LN681"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="numeric.c.html#LN679"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>16</span><span class='Parentheses'>)</span> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This formula computes the maximum number of NumericDigits we could need 
     * in order to store the specified number of decimal digits. Because the 
     * weight is stored as a number of NumericDigits rather than a number of 
     * decimal digits, it's possible that the first NumericDigit will contain 
     * only a single decimal digit.  Thus, the first two decimal digits can 
     * require two NumericDigits to store, but it isn't until we reach 
     * DEC_DIGITS + 2 decimal digits that we potentially need a third 
     * NumericDigit. 
     */ 
</span>    <a href="numeric.c.html#LN682"><span class='Ref_To_Local'>numeric_digits</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN681"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>+ </span><span class='Number'>2</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In most cases, the size of a numeric will be smaller than the value 
     * computed below, because the varlena header will typically get toasted 
     * down to a single byte before being stored on disk, and it may also be 
     * possible to use a short numeric header.  But our job here is to compute 
     * the worst case. 
     */ 
</span>    <span class='Control'>return</span> <a href="numeric.c.html#LN172"><span class='Ref_to_Const'>NUMERIC_HDRSZ</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN682"><span class='Ref_To_Local'>numeric_digits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_maximum_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_out_sci() - 
 * 
 *  Output function for numeric data type in scientific notation. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN718"></a><span class='Declare_Function'>numeric_out_sci</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>scale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN720"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span><a name="LN721"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN718"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"NaN"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN718"><span class='Ref_to_Parameter'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN720"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN721"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN471"><span class='Ref_to_Proto'>get_str_from_var_sci</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN720"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN718"><span class='Ref_to_Parameter'>scale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN721"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * numeric_normalize() - 
 * 
 *  Output function for numeric data type, suppressing insignificant trailing 
 *  zeroes and then any trailing decimal point.  The intent of this is to 
 *  produce strings that are equal if and only if the input numeric values 
 *  compare equal. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN745"></a><span class='Declare_Function'>numeric_normalize</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN747"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span><a name="LN748"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN749"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>last</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN745"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><span class='String'>"NaN"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN745"><span class='Ref_to_Parameter'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN747"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN748"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN309"><span class='Ref_to_Func'>get_str_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN747"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there's no decimal point, there's certainly nothing to remove. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><a href="numeric.c.html#LN748"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Back up over trailing fractional zeroes.  Since there is a decimal 
         * point, this loop will terminate safely. 
         */ 
</span>        <a href="numeric.c.html#LN749"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="numeric.c.html#LN748"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN748"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN749"><span class='Ref_To_Local'>last</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'0'</span><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN749"><span class='Ref_To_Local'>last</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* We want to get rid of the decimal point too, if it's now last. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN748"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN749"><span class='Ref_To_Local'>last</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN749"><span class='Ref_To_Local'>last</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Delete whatever we backed up over. */ 
</span>        <a href="numeric.c.html#LN748"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN749"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN748"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_normalize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      numeric_recv            - converts external binary format to numeric 
 * 
 * External format is a sequence of int16's: 
 * ndigits, weight, sign, dscale, NumericDigits. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN790"></a><span class='Declare_Function'>numeric_recv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN792"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
<a name="LN795"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typelem</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN797"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN798"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN799"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN800"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>, 
</span><a name="LN801"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN800"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN792"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN112"><span class='Ref_to_Func'>alloc_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN800"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN792"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* we allow any int16 for weight --- OK? */ 
</span> 
    <span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN792"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a> <span class='Operator'>|| 
</span>          <span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a> <span class='Operator'>|| 
</span>          <span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN5"><span class='Ref_to_Const'>NUMERIC_NAN</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_BINARY_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid sign in external \"numeric\" value"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN792"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>& </span><a href="numeric.c.html#LN203"><span class='Ref_to_Const'>NUMERIC_DSCALE_MASK</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_BINARY_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid scale in external \"numeric\" value"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN801"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN801"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN800"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN801"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN828"></a>        <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Local'>d</span> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN792"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN828"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN828"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_BINARY_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid digit in external \"numeric\" value"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN801"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN828"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the given dscale would hide any digits, truncate those digits away. 
     * We could alternatively throw an error, but that would take a bunch of 
     * extra code (about as much as trunc_var involves), and it might cause 
     * client compatibility issues. 
     */ 
</span>    <a href="numeric.c.html#LN530"><span class='Ref_to_Proto'>trunc_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN475"><span class='Ref_to_Proto'>apply_typmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN797"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN799"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN799"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_recv &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      numeric_send            - converts numeric to binary format 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN857"></a><span class='Declare_Function'>numeric_send</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN859"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN860"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span><a name="LN861"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN862"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN859"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN860"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN861"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN861"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN860"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN861"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN860"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN861"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN860"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN861"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN860"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN862"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN862"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN860"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN862"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN861"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN860"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN862"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN861"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_send &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_transform() - 
 * 
 * Flatten calls to numeric's length coercion function that solely represent 
 * increases in allowable precision.  Scale changes mutate every datum, so 
 * they are unoptimizable.  Some values, e.g. 1E-1001, can only fit into an 
 * unconstrained numeric, so a change from an unconstrained numeric to any 
 * constrained numeric is also unoptimizable. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN889"></a><span class='Declare_Function'>numeric_transform</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN891"></a>    <a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN892"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN893"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>typmod</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN891"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN893"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN891"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN893"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>)</span> <span class='Operator'>&&!</span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN893"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN901"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>source</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN891"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN902"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>old_typmod</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN901"><span class='Ref_To_Local'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN903"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>new_typmod</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN893"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constvalue<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN904"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>old_scale</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN902"><span class='Ref_To_Local'>old_typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>; 
</span><a name="LN905"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>new_scale</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN903"><span class='Ref_To_Local'>new_typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>; 
</span><a name="LN906"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>old_precision</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN902"><span class='Ref_To_Local'>old_typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>16</span> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>; 
</span><a name="LN907"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>new_precision</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN903"><span class='Ref_To_Local'>new_typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>16</span> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If new_typmod &LT; VARHDRSZ, the destination is unconstrained; that's 
         * always OK.  If old_typmod &GT;= VARHDRSZ, the source is constrained, 
         * and we're OK if the scale is unchanged and the precision is not 
         * decreasing.  See further notes in function header comment. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN903"><span class='Ref_To_Local'>new_typmod</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>)</span> <a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="numeric.c.html#LN902"><span class='Ref_To_Local'>old_typmod</span></a> <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>&& 
</span>             <a href="numeric.c.html#LN905"><span class='Ref_To_Local'>new_scale</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN904"><span class='Ref_To_Local'>old_scale</span></a> <span class='Operator'>&& </span><a href="numeric.c.html#LN907"><span class='Ref_To_Local'>new_precision</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN906"><span class='Ref_To_Local'>old_precision</span></a><span class='Parentheses'>))</span> 
            <a href="numeric.c.html#LN892"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN34"><span class='Ref_to_Proto'>relabel_to_typmod</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN901"><span class='Ref_To_Local'>source</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN903"><span class='Ref_To_Local'>new_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(typmod,Const)&&!(... &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN892"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_transform &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric() - 
 * 
 *  This is a special function called by the Postgres database system 
 *  before a value is stored in a tuple's attribute. The precision and 
 *  scale of the attribute have to be applied on the value. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN932"></a><span class='Declare_Function'>numeric     </span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN934"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN935"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN936"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>new</span><span class='Delimiter'>; 
</span><a name="LN937"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>tmp_typmod</span><span class='Delimiter'>; 
</span><a name="LN938"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>precision</span><span class='Delimiter'>; 
</span><a name="LN939"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>scale</span><span class='Delimiter'>; 
</span><a name="LN940"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ddigits</span><span class='Delimiter'>; 
</span><a name="LN941"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxdigits</span><span class='Delimiter'>; 
</span><a name="LN942"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the value isn't a valid type modifier, simply return a copy of the 
     * input value 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN935"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>new</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Control'>new</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Control'>new</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the precision and scale out of the typmod value 
     */ 
</span>    <a href="numeric.c.html#LN937"><span class='Ref_To_Local'>tmp_typmod</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN935"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN938"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN937"><span class='Ref_To_Local'>tmp_typmod</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>16</span><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN939"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN937"><span class='Ref_To_Local'>tmp_typmod</span></a> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN941"><span class='Ref_To_Local'>maxdigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN938"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN939"><span class='Ref_To_Local'>scale</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the number is certainly in bounds and due to the target scale no 
     * rounding could be necessary, just make a copy of the input and modify 
     * its scale fields, unless the larger scale forces us to abandon the 
     * short representation.  (Note we assume the existing dscale is 
     * honest...) 
     */ 
</span>    <a href="numeric.c.html#LN940"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN213"><span class='Ref_to_Macro'>NUMERIC_WEIGHT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN940"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN941"><span class='Ref_To_Local'>maxdigits</span></a> <span class='Operator'>&& </span><a href="numeric.c.html#LN939"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN209"><span class='Ref_to_Macro'>NUMERIC_DSCALE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span> 
        <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN456"><span class='Ref_to_Macro'>NUMERIC_CAN_BE_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN939"><span class='Ref_To_Local'>scale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN213"><span class='Ref_to_Macro'>NUMERIC_WEIGHT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
            <span class='Operator'>|| !</span><a href="numeric.c.html#LN170"><span class='Ref_to_Macro'>NUMERIC_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>new</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><span class='Control'>new</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN170"><span class='Ref_to_Macro'>NUMERIC_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN148"><span class='Ref_to_Member'>n_short</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN133"><span class='Ref_to_Member'>n_header</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN148"><span class='Ref_to_Member'>n_short</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN133"><span class='Ref_to_Member'>n_header</span></a> <span class='Operator'>& ~</span><a href="numeric.c.html#LN190"><span class='Ref_to_Const'>NUMERIC_SHORT_DSCALE_MASK</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN939"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>&LT;&LT; </span><a href="numeric.c.html#LN191"><span class='Ref_to_Const'>NUMERIC_SHORT_DSCALE_SHIFT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>new</span><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN147"><span class='Ref_to_Member'>n_long</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN139"><span class='Ref_to_Member'>n_sign_dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN205"><span class='Ref_to_Macro'>NUMERIC_SIGN</span></a><span class='Parentheses'>(</span><span class='Control'>new</span><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN939"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>& </span><a href="numeric.c.html#LN203"><span class='Ref_to_Const'>NUMERIC_DSCALE_MASK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Control'>new</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We really need to fiddle with things - unpack the number into a 
     * variable and let apply_typmod() do it. 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN942"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN467"><span class='Ref_to_Proto'>set_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN934"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN942"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN475"><span class='Ref_to_Proto'>apply_typmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN942"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN935"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>new</span> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN942"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN942"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Control'>new</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1009"></a><span class='Declare_Function'>numerictypmodin</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1011"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ta</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1012"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tl</span><span class='Delimiter'>; 
</span><a name="LN1013"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span><a name="LN1014"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN198"><span class='Ref_to_Func'>ArrayGetIntegerTypmods</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1011"><span class='Ref_To_Local'>ta</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1013"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1013"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN7"><span class='Ref_to_Const'>NUMERIC_MAX_PRECISION</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"NUMERIC precision %d must be between 1 and %d"</span><span class='Delimiter'>, 
</span>                            <a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN7"><span class='Ref_to_Const'>NUMERIC_MAX_PRECISION</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"NUMERIC scale %d must be between 0 and precision %d"</span><span class='Delimiter'>, 
</span>                       <a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN1014"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT;&LT; </span><span class='Number'>16</span><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1013"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN7"><span class='Ref_to_Const'>NUMERIC_MAX_PRECISION</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"NUMERIC precision %d must be between 1 and %d"</span><span class='Delimiter'>, 
</span>                            <a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN7"><span class='Ref_to_Const'>NUMERIC_MAX_PRECISION</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* scale defaults to zero */ 
</span>        <a href="numeric.c.html#LN1014"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1012"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>&LT;&LT; </span><span class='Number'>16</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid NUMERIC type modifier"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN1014"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1014"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numerictypmodin &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1054"></a><span class='Declare_Function'>numerictypmodout</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1056"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1057"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>64</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1056"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1057"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, </span><span class='String'>"(%d,%d)"</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>((</span><a href="numeric.c.html#LN1056"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>16</span><span class='Parentheses'>)</span> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>, 
</span>                 <span class='Parentheses'>(</span><a href="numeric.c.html#LN1056"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Operator'>*</span><a href="numeric.c.html#LN1057"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1057"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Sign manipulation, rounding and the like 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1078"></a><span class='Declare_Function'>numeric_abs</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1080"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1081"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1080"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do it the easy way directly on the packed format 
     */ 
</span>    <a href="numeric.c.html#LN1081"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1080"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN1081"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1080"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1080"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN170"><span class='Ref_to_Macro'>NUMERIC_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1080"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="numeric.c.html#LN1081"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN148"><span class='Ref_to_Member'>n_short</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN133"><span class='Ref_to_Member'>n_header</span></a> <span class='Operator'>= 
</span>            <a href="numeric.c.html#LN1080"><span class='Ref_To_Local'>num</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN148"><span class='Ref_to_Member'>n_short</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN133"><span class='Ref_to_Member'>n_header</span></a> <span class='Operator'>& ~</span><a href="numeric.c.html#LN189"><span class='Ref_to_Const'>NUMERIC_SHORT_SIGN_MASK</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN1081"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN147"><span class='Ref_to_Member'>n_long</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN139"><span class='Ref_to_Member'>n_sign_dscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a> <span class='Operator'>| </span><a href="numeric.c.html#LN209"><span class='Ref_to_Macro'>NUMERIC_DSCALE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1080"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1081"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_abs &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1106"></a><span class='Declare_Function'>numeric_uminus</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1108"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1109"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do it the easy way directly on the packed format 
     */ 
</span>    <a href="numeric.c.html#LN1109"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN1109"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The packed format is known to be totally zero digit trimmed always. So 
     * we can identify a ZERO by the fact that there are no digits at all.  Do 
     * nothing to a zero. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Else, flip the sign */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN170"><span class='Ref_to_Macro'>NUMERIC_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
            <a href="numeric.c.html#LN1109"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN148"><span class='Ref_to_Member'>n_short</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN133"><span class='Ref_to_Member'>n_header</span></a> <span class='Operator'>= 
</span>                <a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN148"><span class='Ref_to_Member'>n_short</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN133"><span class='Ref_to_Member'>n_header</span></a> <span class='Operator'>^ </span><a href="numeric.c.html#LN189"><span class='Ref_to_Const'>NUMERIC_SHORT_SIGN_MASK</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN205"><span class='Ref_to_Macro'>NUMERIC_SIGN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>)</span> 
            <a href="numeric.c.html#LN1109"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN147"><span class='Ref_to_Member'>n_long</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN139"><span class='Ref_to_Member'>n_sign_dscale</span></a> <span class='Operator'>= 
</span>                <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a> <span class='Operator'>| </span><a href="numeric.c.html#LN209"><span class='Ref_to_Macro'>NUMERIC_DSCALE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="numeric.c.html#LN1109"><span class='Ref_To_Local'>res</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN147"><span class='Ref_to_Member'>n_long</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN139"><span class='Ref_to_Member'>n_sign_dscale</span></a> <span class='Operator'>= 
</span>                <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a> <span class='Operator'>| </span><a href="numeric.c.html#LN209"><span class='Ref_to_Macro'>NUMERIC_DSCALE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1108"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1109"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_uminus &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1147"></a><span class='Declare_Function'>numeric_uplus</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1149"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1150"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN1150"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1149"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN1150"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1149"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1149"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1150"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * numeric_sign() - 
 * 
 * returns -1 if the argument is less than 0, 0 if the argument is equal 
 * to 0, and 1 if the argument is greater than zero. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1165"></a><span class='Declare_Function'>numeric_sign</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1167"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1168"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1169"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1167"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1169"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The packed format is known to be totally zero digit trimmed always. So 
     * we can identify a ZERO by the fact that there are no digits at all. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1167"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1169"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * And if there are some, we return a copy of ONE with the sign of our 
         * argument 
         */ 
</span>        <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1169"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN1169"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN205"><span class='Ref_to_Macro'>NUMERIC_SIGN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1167"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN1168"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1169"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1169"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1168"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_sign &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_round() - 
 * 
 *  Round a value to have 'scale' digits after the decimal point. 
 *  We allow negative 'scale', implying rounding before the decimal 
 *  point --- Oracle interprets rounding that way. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1210"></a><span class='Declare_Function'>numeric_round</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1212"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1213"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>scale</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1214"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1215"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1212"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Limit the scale value to avoid possible overflow in calculations 
     */ 
</span>    <a href="numeric.c.html#LN1213"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1213"><span class='Ref_To_Local'>scale</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="../../../include/utils/numeric.h.html#LN31"><span class='Ref_to_Const'>NUMERIC_MAX_RESULT_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN1213"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1213"><span class='Ref_To_Local'>scale</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN31"><span class='Ref_to_Const'>NUMERIC_MAX_RESULT_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unpack the argument and round it at the proper digit position 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1215"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN467"><span class='Ref_to_Proto'>set_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1212"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1215"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1215"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1213"><span class='Ref_To_Local'>scale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We don't allow negative output dscale */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1213"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN1215"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return the rounded result 
     */ 
</span>    <a href="numeric.c.html#LN1214"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1215"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1215"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1214"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_round &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_trunc() - 
 * 
 *  Truncate a value to have 'scale' digits after the decimal point. 
 *  We allow negative 'scale', implying a truncation before the decimal 
 *  point --- Oracle interprets truncation that way. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1259"></a><span class='Declare_Function'>numeric_trunc</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1261"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1262"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>scale</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1263"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1264"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1261"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Limit the scale value to avoid possible overflow in calculations 
     */ 
</span>    <a href="numeric.c.html#LN1262"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1262"><span class='Ref_To_Local'>scale</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="../../../include/utils/numeric.h.html#LN31"><span class='Ref_to_Const'>NUMERIC_MAX_RESULT_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN1262"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1262"><span class='Ref_To_Local'>scale</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN31"><span class='Ref_to_Const'>NUMERIC_MAX_RESULT_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unpack the argument and truncate it at the proper digit position 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1264"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN467"><span class='Ref_to_Proto'>set_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1261"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1264"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN530"><span class='Ref_to_Proto'>trunc_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1264"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1262"><span class='Ref_To_Local'>scale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We don't allow negative output dscale */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1262"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN1264"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Return the truncated result 
     */ 
</span>    <a href="numeric.c.html#LN1263"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1264"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1264"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1263"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_trunc &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_ceil() - 
 * 
 *  Return the smallest integer greater than or equal to the argument 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1306"></a><span class='Declare_Function'>numeric_ceil</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1308"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1309"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1310"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1308"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1308"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1310"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN510"><span class='Ref_to_Proto'>ceil_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1310"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1310"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN1309"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1310"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1310"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1309"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_floor() - 
 * 
 *  Return the largest integer equal to or less than the argument 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1331"></a><span class='Declare_Function'>numeric_floor</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1333"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1334"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN1335"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1333"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1333"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1335"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN511"><span class='Ref_to_Proto'>floor_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1335"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1335"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN1334"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1335"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1335"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1334"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * generate_series_numeric() - 
 * 
 *  Generate series of numeric. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1356"></a><span class='Declare_Function'>generate_series_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="numeric.c.html#LN1361"><span class='Ref_to_Func'>generate_series_step_numeric</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1362"></a><span class='Declare_Function'>generate_series_step_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1364"></a>    <a href="numeric.c.html#LN283"><span class='Ref_to_Typedef'>generate_series_numeric_fctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fctx</span><span class='Delimiter'>; 
</span><a name="LN1365"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN1366"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1370"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>start_num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1371"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>stop_num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1372"></a>        <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>steploc</span> <span class='Operator'>= </span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* handle NaN in start and stop values */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1370"><span class='Ref_To_Local'>start_num</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"start value cannot be NaN"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1371"><span class='Ref_To_Local'>stop_num</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"stop value cannot be NaN"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* see if we were given an explicit step size */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1388"></a>            <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>step_num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1388"><span class='Ref_To_Local'>step_num</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"step size cannot be NaN"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1388"><span class='Ref_To_Local'>step_num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1372"><span class='Ref_To_Local'>steploc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1372"><span class='Ref_To_Local'>steploc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"step size cannot equal zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* create a function context for cross-call persistence */ 
</span>        <a href="numeric.c.html#LN1365"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Switch to memory context appropriate for multiple function calls. 
         */ 
</span>        <a href="numeric.c.html#LN1366"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1365"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* allocate memory for user context */ 
</span>        <a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN283"><span class='Ref_to_Typedef'>generate_series_numeric_fctx</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN283"><span class='Ref_to_Typedef'>generate_series_numeric_fctx</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Use fctx to keep state from call to call. Seed current with the 
         * original start value. We must copy the start_num and stop_num 
         * values rather than pointing to them, since we may have detoasted 
         * them in the per-call context. 
         */ 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN285"><span class='Ref_to_Member'>current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN286"><span class='Ref_to_Member'>stop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN287"><span class='Ref_to_Member'>step</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN467"><span class='Ref_to_Proto'>set_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1370"><span class='Ref_To_Local'>start_num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN285"><span class='Ref_to_Member'>current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN467"><span class='Ref_to_Proto'>set_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1371"><span class='Ref_To_Local'>stop_num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN286"><span class='Ref_to_Member'>stop</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1372"><span class='Ref_To_Local'>steploc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN287"><span class='Ref_to_Member'>step</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN1365"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1366"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* stuff done on every call of the function */ 
</span>    <a href="numeric.c.html#LN1365"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get the saved state and use current state as the result of this 
     * iteration. 
     */ 
</span>    <a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN1365"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN287"><span class='Ref_to_Member'>step</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a> <span class='Operator'>&& 
</span>         <a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN285"><span class='Ref_to_Member'>current</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN286"><span class='Ref_to_Member'>stop</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN287"><span class='Ref_to_Member'>step</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a> <span class='Operator'>&& 
</span>         <a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN285"><span class='Ref_to_Member'>current</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN286"><span class='Ref_to_Member'>stop</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1447"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN285"><span class='Ref_to_Member'>current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* switch to memory context appropriate for iteration calculation */ 
</span>        <a href="numeric.c.html#LN1366"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1365"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* increment current in preparation for next iteration */ 
</span>        <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN285"><span class='Ref_to_Member'>current</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN287"><span class='Ref_to_Member'>step</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1364"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN285"><span class='Ref_to_Member'>current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1366"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* do when there is more left to send */ 
</span>        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1365"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1447"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Comment_Multi_Line'>/* do when there is no more left */ 
</span>        <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1365"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end generate_series_step_numeric &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Implements the numeric version of the width_bucket() function 
 * defined by SQL2003. See also width_bucket_float8(). 
 * 
 * 'bound1' and 'bound2' are the lower and upper bounds of the 
 * histogram's range, respectively. 'count' is the number of buckets 
 * in the histogram. width_bucket() returns an integer indicating the 
 * bucket number that 'operand' belongs to in an equiwidth histogram 
 * with the specified characteristics. An operand smaller than the 
 * lower bound is assigned to bucket 0. An operand greater than the 
 * upper bound is assigned to an additional bucket (with number 
 * count+1). We don't allow "NaN" for any of the numeric arguments. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1479"></a><span class='Declare_Function'>width_bucket_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1481"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>operand</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1482"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>bound1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1483"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>bound2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1484"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>count</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1485"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>count_var</span><span class='Delimiter'>; 
</span><a name="LN1486"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result_var</span><span class='Delimiter'>; 
</span><a name="LN1487"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1484"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_ARGUMENT_FOR_WIDTH_BUCKET_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"count must be greater than zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1481"><span class='Ref_To_Local'>operand</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1482"><span class='Ref_To_Local'>bound1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1483"><span class='Ref_To_Local'>bound2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_ARGUMENT_FOR_WIDTH_BUCKET_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"operand, lower bound, and upper bound cannot be NaN"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1486"><span class='Ref_To_Local'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1485"><span class='Ref_To_Local'>count_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert 'count' to a numeric, for ease of use later */ 
</span>    <a href="numeric.c.html#LN479"><span class='Ref_to_Proto'>int64_to_numericvar</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1484"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1485"><span class='Ref_To_Local'>count_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1482"><span class='Ref_To_Local'>bound1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1483"><span class='Ref_To_Local'>bound2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_ARGUMENT_FOR_WIDTH_BUCKET_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"lower bound cannot equal upper bound"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* bound1 &LT; bound2 */ 
</span>        <span class='Control'>case</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1481"><span class='Ref_To_Local'>operand</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1482"><span class='Ref_To_Local'>bound1</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1486"><span class='Ref_To_Local'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1481"><span class='Ref_To_Local'>operand</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1483"><span class='Ref_To_Local'>bound2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1485"><span class='Ref_To_Local'>count_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1486"><span class='Ref_To_Local'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="numeric.c.html#LN532"><span class='Ref_to_Proto'>compute_bucket</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1481"><span class='Ref_To_Local'>operand</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1482"><span class='Ref_To_Local'>bound1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1483"><span class='Ref_To_Local'>bound2</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="numeric.c.html#LN1485"><span class='Ref_To_Local'>count_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1486"><span class='Ref_To_Local'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* bound1 &GT; bound2 */ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1481"><span class='Ref_To_Local'>operand</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1482"><span class='Ref_To_Local'>bound1</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1486"><span class='Ref_To_Local'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1481"><span class='Ref_To_Local'>operand</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1483"><span class='Ref_To_Local'>bound2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1485"><span class='Ref_To_Local'>count_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1486"><span class='Ref_To_Local'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="numeric.c.html#LN532"><span class='Ref_to_Proto'>compute_bucket</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1481"><span class='Ref_To_Local'>operand</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1482"><span class='Ref_To_Local'>bound1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1483"><span class='Ref_To_Local'>bound2</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="numeric.c.html#LN1485"><span class='Ref_To_Local'>count_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1486"><span class='Ref_To_Local'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cmp_numerics(bound1,b... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* if result exceeds the range of a legal int4, we ereport here */ 
</span>    <a href="numeric.c.html#LN1487"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN477"><span class='Ref_to_Proto'>numericvar_to_int32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1486"><span class='Ref_To_Local'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1485"><span class='Ref_To_Local'>count_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1486"><span class='Ref_To_Local'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1487"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end width_bucket_numeric &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * If 'operand' is not outside the bucket range, determine the correct 
 * bucket for it to go. The calculations performed by this function 
 * are derived directly from the SQL2003 spec. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1552"></a><span class='Declare_Function'>compute_bucket</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>operand</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>bound1</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>bound2</span><span class='Delimiter'>, 
</span><a name="LN1553"></a>               <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>count_var</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result_var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1555"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>bound1_var</span><span class='Delimiter'>; 
</span><a name="LN1556"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>bound2_var</span><span class='Delimiter'>; 
</span><a name="LN1557"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>operand_var</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1552"><span class='Ref_to_Parameter'>bound1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1552"><span class='Ref_to_Parameter'>bound2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1556"><span class='Ref_To_Local'>bound2_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1552"><span class='Ref_to_Parameter'>operand</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1556"><span class='Ref_To_Local'>bound2_var</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1556"><span class='Ref_To_Local'>bound2_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1556"><span class='Ref_To_Local'>bound2_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN504"><span class='Ref_to_Proto'>div_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1556"><span class='Ref_To_Local'>bound2_var</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>result_var</span></a><span class='Delimiter'>, 
</span>                <a href="numeric.c.html#LN508"><span class='Ref_to_Proto'>select_div_scale</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1556"><span class='Ref_To_Local'>bound2_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1556"><span class='Ref_To_Local'>bound2_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN504"><span class='Ref_to_Proto'>div_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>result_var</span></a><span class='Delimiter'>, 
</span>                <a href="numeric.c.html#LN508"><span class='Ref_to_Proto'>select_div_scale</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>result_var</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>count_var</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>result_var</span></a><span class='Delimiter'>, 
</span>            <a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>result_var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>count_var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>result_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN511"><span class='Ref_to_Proto'>floor_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>result_var</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1553"><span class='Ref_to_Parameter'>result_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1555"><span class='Ref_To_Local'>bound1_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1556"><span class='Ref_To_Local'>bound2_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1557"><span class='Ref_To_Local'>operand_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end compute_bucket &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Comparison functions 
 * 
 * Note: btree indexes need these routines not to leak memory; therefore, 
 * be careful to free working copies of toasted datums.  Most places don't 
 * need to be so careful. 
 * 
 * Sort support: 
 * 
 * We implement the sortsupport strategy routine in order to get the benefit of 
 * abbreviation. The ordinary numeric comparison can be quite slow as a result 
 * of palloc/pfree cycles (due to detoasting packed values for alignment); 
 * while this could be worked on itself, the abbreviation strategy gives more 
 * speedup in many common cases. 
 * 
 * Two different representations are used for the abbreviated form, one in 
 * int32 and one in int64, whichever fits into a by-value Datum.  In both cases 
 * the representation is negated relative to the original value, because we use 
 * the largest negative value for NaN, which sorts higher than other values. We 
 * convert the absolute value of the numeric to a 31-bit or 63-bit positive 
 * value, and then negate it if the original number was positive. 
 * 
 * We abort the abbreviation process if the abbreviation cardinality is below 
 * 0.01% of the row count (1 per 10k non-null rows).  The actual break-even 
 * point is somewhat below that, perhaps 1 per 30k (at 1 per 100k there's a 
 * very small penalty), but we don't want to build up too many abbreviated 
 * values before first testing for abort, so we take the slightly pessimistic 
 * number.  We make no attempt to estimate the cardinality of the real values, 
 * since it plays no part in the cost model here (if the abbreviation is equal, 
 * the cost of comparing equal and unequal underlying values is comparable). 
 * We discontinue even checking for abort (saving us the hashing overhead) if 
 * the estimated cardinality gets to 100k; that would be enough to support many 
 * billions of rows while doing no worse than breaking even. 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Sort support strategy routine. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1630"></a><span class='Declare_Function'>numeric_sortsupport</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1632"></a>    <a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Local'>ssup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN1632"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN106"><span class='Ref_to_Member'>comparator</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN489"><span class='Ref_to_Proto'>numeric_fast_cmp</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1632"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN155"><span class='Ref_to_Member'>abbreviate</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1638"></a>        <a href="numeric.c.html#LN295"><span class='Ref_to_Typedef'>NumericSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nss</span><span class='Delimiter'>; 
</span><a name="LN1639"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1632"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN65"><span class='Ref_to_Member'>ssup_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN1638"><span class='Ref_To_Local'>nss</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN295"><span class='Ref_to_Typedef'>NumericSortSupport</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * palloc a buffer for handling unaligned packed values in addition to 
         * the support struct 
         */ 
</span>        <a href="numeric.c.html#LN1638"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN297"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN269"><span class='Ref_to_Const'>VARATT_SHORT_MAX</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN1638"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN298"><span class='Ref_to_Member'>input_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN1638"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN299"><span class='Ref_to_Member'>estimating</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="../../../include/lib/hyperloglog.h.html#LN61"><span class='Ref_to_Proto'>initHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1638"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN301"><span class='Ref_to_Member'>abbr_card</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN1632"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN86"><span class='Ref_to_Member'>ssup_extra</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN1638"><span class='Ref_To_Local'>nss</span></a><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN1632"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN191"><span class='Ref_to_Member'>abbrev_full_comparator</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN1632"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN106"><span class='Ref_to_Member'>comparator</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN1632"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN106"><span class='Ref_to_Member'>comparator</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN490"><span class='Ref_to_Proto'>numeric_cmp_abbrev</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN1632"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN172"><span class='Ref_to_Member'>abbrev_converter</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN487"><span class='Ref_to_Proto'>numeric_abbrev_convert</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN1632"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN182"><span class='Ref_to_Member'>abbrev_abort</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN488"><span class='Ref_to_Proto'>numeric_abbrev_abort</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1639"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ssup-&GT;abbreviate &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_sortsupport &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Abbreviate a numeric datum, handling NaNs and detoasting 
 * (must not leak memory!) 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1671"></a><span class='Declare_Function'>numeric_abbrev_convert</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>original_datum</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1673"></a>    <a href="numeric.c.html#LN295"><span class='Ref_to_Typedef'>NumericSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nss</span> <span class='Operator'>= </span><a href="numeric.c.html#LN1671"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN86"><span class='Ref_to_Member'>ssup_extra</span></a><span class='Delimiter'>; 
</span><a name="LN1674"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>original_varatt</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN212"><span class='Ref_to_Macro'>PG_DETOAST_DATUM_PACKED</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1671"><span class='Ref_to_Parameter'>original_datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1675"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN1676"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN1673"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN298"><span class='Ref_to_Member'>input_count</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This is to handle packed datums without needing a palloc/pfree cycle; 
     * we keep and reuse a buffer large enough to handle any short datum. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN324"><span class='Ref_to_Macro'>VARATT_IS_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1674"><span class='Ref_To_Local'>original_varatt</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1686"></a>        <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span> <span class='Operator'>= </span><a href="numeric.c.html#LN1673"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN297"><span class='Ref_to_Member'>buf</span></a><span class='Delimiter'>; 
</span><a name="LN1687"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>sz</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN305"><span class='Ref_to_Macro'>VARSIZE_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1674"><span class='Ref_To_Local'>original_varatt</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/postgres.h.html#LN268"><span class='Ref_to_Const'>VARHDRSZ_SHORT</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1687"><span class='Ref_To_Local'>sz</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/postgres.h.html#LN269"><span class='Ref_to_Const'>VARATT_SHORT_MAX</span></a> <span class='Operator'>- </span><a href="../../../include/postgres.h.html#LN268"><span class='Ref_to_Const'>VARHDRSZ_SHORT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1686"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN1687"><span class='Ref_To_Local'>sz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1686"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN306"><span class='Ref_to_Macro'>VARDATA_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1674"><span class='Ref_To_Local'>original_varatt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN1687"><span class='Ref_To_Local'>sz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1686"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Keyword'>value </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1674"><span class='Ref_To_Local'>original_varatt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN1676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN357"><span class='Ref_to_Const'>NUMERIC_ABBREV_NAN</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1705"></a>        <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>var</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN1705"><span class='Ref_To_Local'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN1676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN492"><span class='Ref_to_Proto'>numeric_abbrev_convert_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1705"><span class='Ref_To_Local'>var</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1673"><span class='Ref_To_Local'>nss</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* should happen only for external/compressed toasts */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1674"><span class='Ref_To_Local'>original_varatt</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1671"><span class='Ref_to_Parameter'>original_datum</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1674"><span class='Ref_To_Local'>original_varatt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN1676"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_abbrev_convert &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Consider whether to abort abbreviation. 
 * 
 * We pay no attention to the cardinality of the non-abbreviated data. There is 
 * no reason to do so: unlike text, we have no fast check for equal values, so 
 * we pay the full overhead whenever the abbreviations are equal regardless of 
 * whether the underlying values are also equal. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1728"></a><span class='Declare_Function'>numeric_abbrev_abort</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>memtupcount</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1730"></a>    <a href="numeric.c.html#LN295"><span class='Ref_to_Typedef'>NumericSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nss</span> <span class='Operator'>= </span><a href="numeric.c.html#LN1728"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN86"><span class='Ref_to_Member'>ssup_extra</span></a><span class='Delimiter'>; 
</span><a name="LN1731"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>abbr_card</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1728"><span class='Ref_to_Parameter'>memtupcount</span></a> <span class='Operator'>&LT; </span><span class='Number'>10000</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN1730"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN298"><span class='Ref_to_Member'>input_count</span></a> <span class='Operator'>&LT; </span><span class='Number'>10000</span> <span class='Operator'>|| !</span><a href="numeric.c.html#LN1730"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN299"><span class='Ref_to_Member'>estimating</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN1731"><span class='Ref_To_Local'>abbr_card</span></a> <span class='Operator'>= </span><a href="../../../include/lib/hyperloglog.h.html#LN64"><span class='Ref_to_Proto'>estimateHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1730"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN301"><span class='Ref_to_Member'>abbr_card</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have &GT;100k distinct values, then even if we were sorting many 
     * billion rows we'd likely still break even, and the penalty of undoing 
     * that many rows of abbrevs would probably not be worth it. Stop even 
     * counting at that point. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1731"><span class='Ref_To_Local'>abbr_card</span></a> <span class='Operator'>&GT; </span><span class='Number'>100000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/pg_config_manual.h.html#LN314"><span class='Ref_to_Const'>TRACE_SORT</span></a> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../sort/tuplesort.c.html#LN154"><span class='Ref_to_Global_Var'>trace_sort</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                 <span class='String'>"numeric_abbrev: estimation ends at cardinality %f"</span> 
                 <span class='String'>" after "</span> <a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" values (%d rows)"</span><span class='Delimiter'>, 
</span>                 <a href="numeric.c.html#LN1731"><span class='Ref_To_Local'>abbr_card</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1730"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN298"><span class='Ref_to_Member'>input_count</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1728"><span class='Ref_to_Parameter'>memtupcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="numeric.c.html#LN1730"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN299"><span class='Ref_to_Member'>estimating</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Target minimum cardinality is 1 per ~10k of non-null inputs.  (The 
     * break even point is somewhere between one per 100k rows, where 
     * abbreviation has a very slight penalty, and 1 per 10k where it wins by 
     * a measurable percentage.)  We use the relatively pessimistic 10k 
     * threshold, and add a 0.5 row fudge factor, because it allows us to 
     * abort earlier on genuinely pathological data where we've had exactly 
     * one abbreviated value in the first 10k (non-null) rows. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1731"><span class='Ref_To_Local'>abbr_card</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN1730"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN298"><span class='Ref_to_Member'>input_count</span></a> <span class='Operator'>/ </span><span class='Number'>10000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>+ </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/pg_config_manual.h.html#LN314"><span class='Ref_to_Const'>TRACE_SORT</span></a> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../sort/tuplesort.c.html#LN154"><span class='Ref_to_Global_Var'>trace_sort</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>                 <span class='String'>"numeric_abbrev: aborting abbreviation at cardinality %f"</span> 
               <span class='String'>" below threshold %f after "</span> <a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" values (%d rows)"</span><span class='Delimiter'>, 
</span>                 <a href="numeric.c.html#LN1731"><span class='Ref_To_Local'>abbr_card</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1730"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN298"><span class='Ref_to_Member'>input_count</span></a> <span class='Operator'>/ </span><span class='Number'>10000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>+ </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>, 
</span>                 <a href="numeric.c.html#LN1730"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN298"><span class='Ref_to_Member'>input_count</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1728"><span class='Ref_to_Parameter'>memtupcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/pg_config_manual.h.html#LN314"><span class='Ref_to_Const'>TRACE_SORT</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../sort/tuplesort.c.html#LN154"><span class='Ref_to_Global_Var'>trace_sort</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, 
</span>             <span class='String'>"numeric_abbrev: cardinality %f"</span> 
             <span class='String'>" after "</span> <a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>" values (%d rows)"</span><span class='Delimiter'>, 
</span>             <a href="numeric.c.html#LN1731"><span class='Ref_To_Local'>abbr_card</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1730"><span class='Ref_To_Local'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN298"><span class='Ref_to_Member'>input_count</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1728"><span class='Ref_to_Parameter'>memtupcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_abbrev_abort &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Non-fmgr interface to the comparison routine to allow sortsupport to elide 
 * the fmgr call.  The saving here is small given how slow numeric comparisons 
 * are, but it is a required part of the sort support API when abbreviations 
 * are performed. 
 * 
 * Two palloc/pfree cycles could be saved here by using persistent buffers for 
 * aligning short-varlena inputs, but this has not so far been considered to 
 * be worth the effort. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1801"></a><span class='Declare_Function'>numeric_fast_cmp</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1803"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>nx</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1801"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1804"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>ny</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1801"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1805"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN1805"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1803"><span class='Ref_To_Local'>nx</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN1804"><span class='Ref_To_Local'>ny</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1803"><span class='Ref_To_Local'>nx</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1801"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1803"><span class='Ref_To_Local'>nx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN244"><span class='Ref_to_Typedef'>Pointer</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1804"><span class='Ref_To_Local'>ny</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1801"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1804"><span class='Ref_To_Local'>ny</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN1805"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Compare abbreviations of values. (Abbreviations may be equal where the true 
 * values differ, but if the abbreviations differ, they must reflect the 
 * ordering of the true values.) 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1823"></a><span class='Declare_Function'>numeric_cmp_abbrev</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * NOTE WELL: this is intentionally backwards, because the abbreviation is 
     * negated relative to the original value, to handle NaN. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN356"><span class='Ref_to_Macro'>DatumGetNumericAbbrev</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1823"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="numeric.c.html#LN356"><span class='Ref_to_Macro'>DatumGetNumericAbbrev</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1823"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN356"><span class='Ref_to_Macro'>DatumGetNumericAbbrev</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1823"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="numeric.c.html#LN356"><span class='Ref_to_Macro'>DatumGetNumericAbbrev</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1823"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Abbreviate a NumericVar according to the available bit size. 
 * 
 * The 31-bit value is constructed as: 
 * 
 *  0 + 7bits digit weight + 24 bits digit value 
 * 
 * where the digit weight is in single decimal digits, not digit words, and 
 * stored in excess-44 representation[1]. The 24-bit digit value is the 7 most 
 * significant decimal digits of the value converted to binary. Values whose 
 * weights would fall outside the representable range are rounded off to zero 
 * (which is also used to represent actual zeros) or to 0x7FFFFFFF (which 
 * otherwise cannot occur). Abbreviation therefore fails to gain any advantage 
 * where values are outside the range 10^-44 to 10^83, which is not considered 
 * to be a serious limitation, or when values are of the same magnitude and 
 * equal in the first 7 decimal digits, which is considered to be an 
 * unavoidable limitation given the available bits. (Stealing three more bits 
 * to compare another digit would narrow the range of representable weights by 
 * a factor of 8, which starts to look like a real limiting factor.) 
 * 
 * (The value 44 for the excess is essentially arbitrary) 
 * 
 * The 63-bit value is constructed as: 
 * 
 *  0 + 7bits weight + 4 x 14-bit packed digit words 
 * 
 * The weight in this case is again stored in excess-44, but this time it is 
 * the original weight in digit words (i.e. powers of 10000). The first four 
 * digit words of the value (if present; trailing zeros are assumed as needed) 
 * are packed into 14 bits each to form the rest of the value. Again, 
 * out-of-range values are rounded off to 0 or 0x7FFFFFFFFFFFFFFF. The 
 * representable range in this case is 10^-176 to 10^332, which is considered 
 * to be good enough for all practical purposes, and comparison of 4 words 
 * means that at least 13 decimal digits are compared, which is considered to 
 * be a reasonable compromise between effectiveness and efficiency in computing 
 * the abbreviation. 
 * 
 * (The value 44 for the excess is even more arbitrary here, it was chosen just 
 * to match the value used in the 31-bit case) 
 * 
 * [1] - Excess-k representation means that the value is offset by adding 'k' 
 * and then treated as unsigned, so the smallest representable value is stored 
 * with all bits zero. This allows simple comparisons to work on the composite 
 * value. 
 */ 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN353"><span class='Ref_to_Const'>NUMERIC_ABBREV_BITS</span></a> <span class='Operator'>== </span><span class='Number'>64</span> 
 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1885"></a><span class='Declare_Function'>numeric_abbrev_convert_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN295"><span class='Ref_to_Typedef'>NumericSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nss</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1887"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN1885"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN1888"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight</span> <span class='Operator'>= </span><a href="numeric.c.html#LN1885"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span><a name="LN1889"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1887"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN1888"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>&LT; -</span><span class='Number'>44</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1888"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>&GT; </span><span class='Number'>83</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) (</span><a href="numeric.c.html#LN1888"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>44</span><span class='Parentheses'>) </span><span class='Operator'>&LT;&LT; </span><span class='Number'>56</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1887"><span class='Ref_To_Local'>ndigits</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1885"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALLTHROUGH */ 
</span>            <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>                <a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1885"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>14</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALLTHROUGH */ 
</span>            <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>                <a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1885"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>28</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALLTHROUGH */ 
</span>            <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>                <a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>|= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1885"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>42</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* the abbrev is negated relative to the original */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1885"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1885"><span class='Ref_to_Parameter'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN299"><span class='Ref_to_Member'>estimating</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1926"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>tmp</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>)</span> <a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> 
                           <span class='Operator'>^ </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/lib/hyperloglog.h.html#LN63"><span class='Ref_to_Proto'>addHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1885"><span class='Ref_to_Parameter'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN301"><span class='Ref_to_Member'>abbr_card</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/access/hash.h.html#LN326"><span class='Ref_to_Proto'>hash_uint32</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1926"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN355"><span class='Ref_to_Macro'>NumericAbbrevGetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1889"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_abbrev_convert_var &raquo; </span> 
 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* NUMERIC_ABBREV_BITS == 64 */ 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN353"><span class='Ref_to_Const'>NUMERIC_ABBREV_BITS</span></a> <span class='Operator'>== </span><span class='Number'>32</span> 
 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1940"></a><span class='Declare_Function'>numeric_abbrev_convert_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN295"><span class='Ref_to_Typedef'>NumericSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nss</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1942"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN1940"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN1943"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight</span> <span class='Operator'>= </span><a href="numeric.c.html#LN1940"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span><a name="LN1944"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1942"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN1943"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>&LT; -</span><span class='Number'>11</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1943"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>&GT; </span><span class='Number'>20</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN339"><span class='Ref_to_Const'>PG_INT32_MAX</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1956"></a>        <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Local'>nxt1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1942"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="numeric.c.html#LN1940"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN1943"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1943"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>11</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>4</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN1940"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * "result" now has 1 to 4 nonzero decimal digits. We pack in more 
         * digits to make 7 in total (largest we can fit in 24 bits) 
         */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>999</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* already have 4 digits, add 3 more */ 
</span>            <a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1956"><span class='Ref_To_Local'>nxt1</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN1943"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>+= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>99</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* already have 3 digits, add 4 more */ 
</span>            <a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>* </span><span class='Number'>10000</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="numeric.c.html#LN1956"><span class='Ref_To_Local'>nxt1</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN1943"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>9</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1981"></a>            <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Local'>nxt2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1942"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="numeric.c.html#LN1940"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* already have 2 digits, add 5 more */ 
</span>            <a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>* </span><span class='Number'>100000</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1956"><span class='Ref_To_Local'>nxt1</span></a> <span class='Operator'>* </span><span class='Number'>10</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1981"><span class='Ref_To_Local'>nxt2</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN1943"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1989"></a>            <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Local'>nxt2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1942"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="numeric.c.html#LN1940"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* already have 1 digit, add 6 more */ 
</span>            <a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1956"><span class='Ref_To_Local'>nxt1</span></a> <span class='Operator'>* </span><span class='Number'>100</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1989"><span class='Ref_To_Local'>nxt2</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN1943"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>24</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* the abbrev is negated relative to the original */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1940"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN1940"><span class='Ref_to_Parameter'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN299"><span class='Ref_to_Member'>estimating</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2004"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>tmp</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../include/lib/hyperloglog.h.html#LN63"><span class='Ref_to_Proto'>addHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN1940"><span class='Ref_to_Parameter'>nss</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN301"><span class='Ref_to_Member'>abbr_card</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/access/hash.h.html#LN326"><span class='Ref_to_Proto'>hash_uint32</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2004"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN355"><span class='Ref_to_Macro'>NumericAbbrevGetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN1944"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_abbrev_convert_var &raquo; </span> 
 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* NUMERIC_ABBREV_BITS == 32 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Ordinary (non-sortsupport) comparisons follow. 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2019"></a><span class='Declare_Function'>numeric_cmp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2021"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2022"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2023"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2023"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2021"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2022"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2021"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2022"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2023"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2035"></a><span class='Declare_Function'>numeric_eq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2037"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2038"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2039"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2039"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2037"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2038"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2037"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2038"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2039"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2050"></a><span class='Declare_Function'>numeric_ne</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2052"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2053"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2054"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2054"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2052"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2053"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2052"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2053"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2054"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2065"></a><span class='Declare_Function'>numeric_gt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2067"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2068"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2069"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2069"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2067"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2068"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2067"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2068"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2069"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2080"></a><span class='Declare_Function'>numeric_ge</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2082"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2083"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2084"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2084"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2082"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2083"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2082"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2083"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2084"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2095"></a><span class='Declare_Function'>numeric_lt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2097"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2098"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2099"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2099"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2097"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2098"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2097"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2098"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2099"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2110"></a><span class='Declare_Function'>numeric_le</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2112"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2113"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2114"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2114"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2112"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2113"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2112"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2113"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2114"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN2125"></a><span class='Declare_Function'>cmp_numerics</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num1</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2127"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We consider all NANs to be equal and larger than any non-NAN. This is 
     * somewhat arbitrary; the important thing is to have a consistent sort 
     * order. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num1</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num2</span></a><span class='Parentheses'>))</span> 
            <a href="numeric.c.html#LN2127"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* NAN = NAN */ 
</span>        <span class='Control'>else</span> 
            <a href="numeric.c.html#LN2127"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* NAN &GT; non-NAN */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN2127"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* non-NAN &LT; NAN */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN2127"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN496"><span class='Ref_to_Proto'>cmp_var_common</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN452"><span class='Ref_to_Macro'>NUMERIC_DIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="numeric.c.html#LN213"><span class='Ref_to_Macro'>NUMERIC_WEIGHT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN205"><span class='Ref_to_Macro'>NUMERIC_SIGN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="numeric.c.html#LN452"><span class='Ref_to_Macro'>NUMERIC_DIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="numeric.c.html#LN213"><span class='Ref_to_Macro'>NUMERIC_WEIGHT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN205"><span class='Ref_to_Macro'>NUMERIC_SIGN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2125"><span class='Ref_to_Parameter'>num2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN2127"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end cmp_numerics &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2157"></a><span class='Declare_Function'>hash_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2159"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2160"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>digit_hash</span><span class='Delimiter'>; 
</span><a name="LN2161"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2162"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight</span><span class='Delimiter'>; 
</span><a name="LN2163"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>start_offset</span><span class='Delimiter'>; 
</span><a name="LN2164"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>end_offset</span><span class='Delimiter'>; 
</span><a name="LN2165"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2166"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>hash_len</span><span class='Delimiter'>; 
</span><a name="LN2167"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>digits</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it's NaN, don't try to hash the rest of the fields */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2159"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN314"><span class='Ref_to_Macro'>PG_RETURN_UINT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2162"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN213"><span class='Ref_to_Macro'>NUMERIC_WEIGHT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2159"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2163"><span class='Ref_To_Local'>start_offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2164"><span class='Ref_To_Local'>end_offset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Omit any leading or trailing zeros from the input to the hash. The 
     * numeric implementation *should* guarantee that leading and trailing 
     * zeros are suppressed, but we're paranoid. Note that we measure the 
     * starting and ending offsets in units of NumericDigits, not bytes. 
     */ 
</span>    <a href="numeric.c.html#LN2167"><span class='Ref_To_Local'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN452"><span class='Ref_to_Macro'>NUMERIC_DIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2159"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN2165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN2165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2159"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN2165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN2167"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN2165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN2163"><span class='Ref_To_Local'>start_offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The weight is effectively the # of digits before the decimal point, 
         * so decrement it for each leading zero we skip. 
         */ 
</span>        <a href="numeric.c.html#LN2162"><span class='Ref_To_Local'>weight</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there are no non-zero digits, then the value of the number is zero, 
     * regardless of any other fields. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2159"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="numeric.c.html#LN2163"><span class='Ref_To_Local'>start_offset</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN314"><span class='Ref_to_Macro'>PG_RETURN_UINT32</span></a><span class='Parentheses'>(</span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN2165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2159"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN2165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN2165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN2167"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN2165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN2164"><span class='Ref_To_Local'>end_offset</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* If we get here, there should be at least one non-zero digit */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN2163"><span class='Ref_To_Local'>start_offset</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN2164"><span class='Ref_To_Local'>end_offset</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2159"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note that we don't hash on the Numeric's scale, since two numerics can 
     * compare equal but have different scales. We also don't hash on the 
     * sign, although we could: since a sign difference implies inequality, 
     * this shouldn't affect correctness. 
     */ 
</span>    <a href="numeric.c.html#LN2166"><span class='Ref_To_Local'>hash_len</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2159"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="numeric.c.html#LN2163"><span class='Ref_To_Local'>start_offset</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN2164"><span class='Ref_To_Local'>end_offset</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2160"><span class='Ref_To_Local'>digit_hash</span></a> <span class='Operator'>= </span><a href="../../access/hash/hashfunc.c.html#LN305"><span class='Ref_to_Func'>hash_any</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>)</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN452"><span class='Ref_to_Macro'>NUMERIC_DIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2159"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="numeric.c.html#LN2163"><span class='Ref_To_Local'>start_offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="numeric.c.html#LN2166"><span class='Ref_To_Local'>hash_len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Mix in the weight, via XOR */ 
</span>    <a href="numeric.c.html#LN2161"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN2160"><span class='Ref_To_Local'>digit_hash</span></a> <span class='Operator'>^ </span><a href="numeric.c.html#LN2162"><span class='Ref_To_Local'>weight</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2161"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end hash_numeric &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Basic arithmetic functions 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_add() - 
 * 
 *  Add two numerics 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2247"></a><span class='Declare_Function'>numeric_add</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2249"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2250"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2251"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg1</span><span class='Delimiter'>; 
</span><a name="LN2252"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg2</span><span class='Delimiter'>; 
</span><a name="LN2253"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2254"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2249"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2250"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unpack the values, let add_var() compute the result and return it. 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2249"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2251"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2250"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2252"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2253"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2251"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2252"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2253"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2254"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2253"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2253"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2254"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_add &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_sub() - 
 * 
 *  Subtract one numeric from another 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2285"></a><span class='Declare_Function'>numeric_sub</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2287"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2288"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2289"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg1</span><span class='Delimiter'>; 
</span><a name="LN2290"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg2</span><span class='Delimiter'>; 
</span><a name="LN2291"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2292"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2287"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2288"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unpack the values, let sub_var() compute the result and return it. 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2287"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2289"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2288"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2290"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2291"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2289"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2290"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2291"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2292"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2291"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2291"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2292"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_sub &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_mul() - 
 * 
 *  Calculate the product of two numerics 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2323"></a><span class='Declare_Function'>numeric_mul</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2325"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2326"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2327"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg1</span><span class='Delimiter'>; 
</span><a name="LN2328"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg2</span><span class='Delimiter'>; 
</span><a name="LN2329"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2330"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2325"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2326"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unpack the values, let mul_var() compute the result and return it. 
     * Unlike add_var() and sub_var(), mul_var() will round its result. In the 
     * case of numeric_mul(), which is invoked for the * operator on numerics, 
     * we request exact representation for the product (rscale = sum(dscale of 
     * arg1, dscale of arg2)). 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2325"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2327"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2326"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2328"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2329"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2327"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2328"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2329"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2327"><span class='Ref_To_Local'>arg1</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN2328"><span class='Ref_To_Local'>arg2</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2330"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2329"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2329"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2330"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_mul &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_div() - 
 * 
 *  Divide one numeric into another 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2365"></a><span class='Declare_Function'>numeric_div</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2367"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2368"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2369"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg1</span><span class='Delimiter'>; 
</span><a name="LN2370"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg2</span><span class='Delimiter'>; 
</span><a name="LN2371"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2372"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2373"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rscale</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2367"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2368"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unpack the arguments 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2367"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2369"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2368"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2370"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2371"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Select scale for division result 
     */ 
</span>    <a href="numeric.c.html#LN2373"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN508"><span class='Ref_to_Proto'>select_div_scale</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2369"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2370"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do the divide and return the result 
     */ 
</span>    <a href="numeric.c.html#LN504"><span class='Ref_to_Proto'>div_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2369"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2370"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2371"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2373"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2372"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2371"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2371"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2372"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_div &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_div_trunc() - 
 * 
 *  Divide one numeric into another, truncating the result to an integer 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2413"></a><span class='Declare_Function'>numeric_div_trunc</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2415"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2416"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2417"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg1</span><span class='Delimiter'>; 
</span><a name="LN2418"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg2</span><span class='Delimiter'>; 
</span><a name="LN2419"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2420"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2415"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2416"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unpack the arguments 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2415"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2417"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2416"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2418"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2419"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Do the divide and return the result 
     */ 
</span>    <a href="numeric.c.html#LN504"><span class='Ref_to_Proto'>div_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2417"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2418"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2419"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2420"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2419"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2419"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2420"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_div_trunc &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_mod() - 
 * 
 *  Calculate the modulo of two numerics 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2455"></a><span class='Declare_Function'>numeric_mod</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2457"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2458"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2459"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2460"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg1</span><span class='Delimiter'>; 
</span><a name="LN2461"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg2</span><span class='Delimiter'>; 
</span><a name="LN2462"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2457"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2458"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2457"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2460"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2458"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2461"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2462"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN509"><span class='Ref_to_Proto'>mod_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2460"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2461"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2462"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2459"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2462"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2462"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2459"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_mod &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_inc() - 
 * 
 *  Increment a number by one 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2488"></a><span class='Declare_Function'>numeric_inc</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2490"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2491"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN2492"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2490"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compute the result and return it 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2490"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2491"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2491"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2491"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2492"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2491"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2491"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2492"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_inc &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_smaller() - 
 * 
 *  Return the smaller of two numbers 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2521"></a><span class='Declare_Function'>numeric_smaller</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2523"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2524"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use cmp_numerics so that this will agree with the comparison operators, 
     * particularly as regards comparisons involving NaN. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2523"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2524"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2523"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2524"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_larger() - 
 * 
 *  Return the larger of two numbers 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2543"></a><span class='Declare_Function'>numeric_larger</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2545"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2546"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use cmp_numerics so that this will agree with the comparison operators, 
     * particularly as regards comparisons involving NaN. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN494"><span class='Ref_to_Proto'>cmp_numerics</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2545"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2546"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2545"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2546"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Advanced math functions 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * numeric_fac() 
 * 
 * Compute factorial 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2572"></a><span class='Declare_Function'>numeric_fac</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2574"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2575"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2576"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>fact</span><span class='Delimiter'>; 
</span><a name="LN2577"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN2574"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN2575"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2575"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Fail immediately if the result would overflow */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN2574"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>&GT; </span><span class='Number'>32177</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value overflows numeric format"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2576"><span class='Ref_To_Local'>fact</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2577"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN479"><span class='Ref_to_Proto'>int64_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2574"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2577"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN2574"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN2574"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN2574"><span class='Ref_To_Local'>num</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN2574"><span class='Ref_To_Local'>num</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* this loop can take awhile, so allow it to be interrupted */ 
</span>        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN479"><span class='Ref_to_Proto'>int64_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2574"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2576"><span class='Ref_To_Local'>fact</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2577"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2576"><span class='Ref_To_Local'>fact</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2577"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN2575"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2577"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2576"><span class='Ref_To_Local'>fact</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2577"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2575"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_fac &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_sqrt() - 
 * 
 *  Compute the square root of a numeric. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2620"></a><span class='Declare_Function'>numeric_sqrt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2622"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2623"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2624"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN2625"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2626"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sweight</span><span class='Delimiter'>; 
</span><a name="LN2627"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rscale</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2622"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unpack the argument and determine the result scale.  We choose a scale 
     * to give at least NUMERIC_MIN_SIG_DIGITS significant digits; but in any 
     * case not less than the input's dscale. 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2622"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2624"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2625"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assume the input was normalized, so arg.weight is accurate */ 
</span>    <a href="numeric.c.html#LN2626"><span class='Ref_To_Local'>sweight</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN2624"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>/ </span><span class='Number'>2</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2627"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN10"><span class='Ref_to_Const'>NUMERIC_MIN_SIG_DIGITS</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN2626"><span class='Ref_To_Local'>sweight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2627"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2627"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2624"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2627"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2627"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2627"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2627"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN8"><span class='Ref_to_Const'>NUMERIC_MAX_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let sqrt_var() do the calculation and return the result. 
     */ 
</span>    <a href="numeric.c.html#LN513"><span class='Ref_to_Proto'>sqrt_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2624"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2625"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2627"><span class='Ref_To_Local'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2623"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2625"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2625"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2623"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_sqrt &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_exp() - 
 * 
 *  Raise e to the power of x 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2671"></a><span class='Declare_Function'>numeric_exp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2673"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2674"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2675"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN2676"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2677"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rscale</span><span class='Delimiter'>; 
</span><a name="LN2678"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2673"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unpack the argument and determine the result scale.  We choose a scale 
     * to give at least NUMERIC_MIN_SIG_DIGITS significant digits; but in any 
     * case not less than the input's dscale. 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2673"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2675"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2676"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* convert input to float8, ignoring overflow */ 
</span>    <a href="numeric.c.html#LN2678"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN485"><span class='Ref_to_Proto'>numericvar_to_double_no_overflow</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2675"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * log10(result) = num * log10(e), so this is approximately the decimal 
     * weight of the result: 
     */ 
</span>    <a href="numeric.c.html#LN2678"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>*= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>434294481903252</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* limit to something that won't cause integer overflow */ 
</span>    <a href="numeric.c.html#LN2678"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2678"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="../../../include/utils/numeric.h.html#LN31"><span class='Ref_to_Const'>NUMERIC_MAX_RESULT_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2678"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2678"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN31"><span class='Ref_to_Const'>NUMERIC_MAX_RESULT_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2677"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN10"><span class='Ref_to_Const'>NUMERIC_MIN_SIG_DIGITS</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN2678"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2677"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2677"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2675"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2677"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2677"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2677"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2677"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN8"><span class='Ref_to_Const'>NUMERIC_MAX_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Let exp_var() do the calculation and return the result. 
     */ 
</span>    <a href="numeric.c.html#LN514"><span class='Ref_to_Proto'>exp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2675"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2676"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2677"><span class='Ref_To_Local'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2674"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2676"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2676"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2674"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_exp &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_ln() - 
 * 
 *  Compute the natural logarithm of x 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2732"></a><span class='Declare_Function'>numeric_ln</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2734"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2735"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2736"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN2737"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2738"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ln_dweight</span><span class='Delimiter'>; 
</span><a name="LN2739"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rscale</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2734"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2734"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2736"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2737"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Estimated dweight of logarithm */ 
</span>    <a href="numeric.c.html#LN2738"><span class='Ref_To_Local'>ln_dweight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN515"><span class='Ref_to_Proto'>estimate_ln_dweight</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2736"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2739"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN10"><span class='Ref_to_Const'>NUMERIC_MIN_SIG_DIGITS</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN2738"><span class='Ref_To_Local'>ln_dweight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2739"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2739"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2736"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2739"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2739"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2739"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2739"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN8"><span class='Ref_to_Const'>NUMERIC_MAX_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN516"><span class='Ref_to_Proto'>ln_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2736"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2737"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN2739"><span class='Ref_To_Local'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2735"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2737"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2737"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2735"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_ln &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_log() - 
 * 
 *  Compute the logarithm of x in a given base 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2774"></a><span class='Declare_Function'>numeric_log</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2776"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2777"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2778"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2779"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg1</span><span class='Delimiter'>; 
</span><a name="LN2780"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg2</span><span class='Delimiter'>; 
</span><a name="LN2781"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2776"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2777"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize things 
     */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2776"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2779"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2777"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2780"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2781"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call log_var() to compute and return the result; note it handles scale 
     * selection itself. 
     */ 
</span>    <a href="numeric.c.html#LN517"><span class='Ref_to_Proto'>log_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2779"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2780"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2781"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2778"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2781"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2781"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2778"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_log &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_power() - 
 * 
 *  Raise b to the power of x 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2816"></a><span class='Declare_Function'>numeric_power</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2818"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num1</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2819"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num2</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2820"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2821"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg1</span><span class='Delimiter'>; 
</span><a name="LN2822"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg2</span><span class='Delimiter'>; 
</span><a name="LN2823"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>arg2_trunc</span><span class='Delimiter'>; 
</span><a name="LN2824"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Handle NaN 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2818"><span class='Ref_To_Local'>num1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2819"><span class='Ref_To_Local'>num2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize things 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2823"><span class='Ref_To_Local'>arg2_trunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2824"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2818"><span class='Ref_To_Local'>num1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2821"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2819"><span class='Ref_To_Local'>num2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2822"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2822"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2823"><span class='Ref_To_Local'>arg2_trunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN530"><span class='Ref_to_Proto'>trunc_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2823"><span class='Ref_To_Local'>arg2_trunc</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The SQL spec requires that we emit a particular SQLSTATE error code for 
     * certain error conditions.  Specifically, we don't return a 
     * divide-by-zero error code for 0 ^ -1. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2821"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2822"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_ARGUMENT_FOR_POWER_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"zero raised to a negative power is undefined"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2821"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2822"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2823"><span class='Ref_To_Local'>arg2_trunc</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_ARGUMENT_FOR_POWER_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"a negative number raised to a non-integer power yields a complex result"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Call power_var() to compute and return the result; note it handles 
     * scale selection itself. 
     */ 
</span>    <a href="numeric.c.html#LN518"><span class='Ref_to_Proto'>power_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2821"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2822"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2824"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2820"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2824"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2824"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2823"><span class='Ref_To_Local'>arg2_trunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2820"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_power &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_scale() - 
 * 
 *  Returns the scale, i.e. the count of decimal digits in the fractional part 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2880"></a><span class='Declare_Function'>numeric_scale</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2882"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2882"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN209"><span class='Ref_to_Macro'>NUMERIC_DSCALE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2882"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Type conversion functions 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2901"></a><span class='Declare_Function'>int4_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2903"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2904"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2905"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2905"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN479"><span class='Ref_to_Proto'>int64_to_numericvar</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN2903"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2905"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2904"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2905"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2905"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2904"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2920"></a><span class='Declare_Function'>numeric_int4</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2922"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2923"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span><a name="LN2924"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XXX would it be better to return NULL? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2922"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot convert NaN to integer"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert to variable format, then convert to int4 */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2922"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2923"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN2924"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN477"><span class='Ref_to_Proto'>numericvar_to_int32</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2923"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2924"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a NumericVar, convert it to an int32. If the NumericVar 
 * exceeds the range of an int32, raise the appropriate error via 
 * ereport(). The input NumericVar is *not* free'd. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN2944"></a><span class='Declare_Function'>numericvar_to_int32</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2946"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2947"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN478"><span class='Ref_to_Proto'>numericvar_to_int64</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2944"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2947"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"integer out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Down-convert to int4 */ 
</span>    <a href="numeric.c.html#LN2946"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN2947"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Test for overflow by reverse-conversion. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN2946"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><a href="numeric.c.html#LN2947"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"integer out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN2946"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numericvar_to_int32 &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2967"></a><span class='Declare_Function'>int8_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2969"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2970"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2971"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2971"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN479"><span class='Ref_to_Proto'>int64_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2969"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2971"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN2970"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2971"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2971"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2970"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2986"></a><span class='Declare_Function'>numeric_int8</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2988"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2989"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span><a name="LN2990"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XXX would it be better to return NULL? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2988"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot convert NaN to bigint"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert to variable format and thence to int8 */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2988"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2989"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN478"><span class='Ref_to_Proto'>numericvar_to_int64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN2989"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN2990"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"bigint out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2990"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_int8 &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3011"></a><span class='Declare_Function'>int2_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3013"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3014"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN3015"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3015"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN479"><span class='Ref_to_Proto'>int64_to_numericvar</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN3013"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3015"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3014"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3015"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3015"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3014"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3030"></a><span class='Declare_Function'>numeric_int2</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3032"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3033"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span><a name="LN3034"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN3035"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* XXX would it be better to return NULL? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3032"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot convert NaN to smallint"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert to variable format and thence to int8 */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3032"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3033"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN478"><span class='Ref_to_Proto'>numericvar_to_int64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3033"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3034"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"smallint out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Down-convert to int2 */ 
</span>    <a href="numeric.c.html#LN3035"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN3034"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Test for overflow by reverse-conversion. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN3035"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><a href="numeric.c.html#LN3034"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"smallint out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN315"><span class='Ref_to_Macro'>PG_RETURN_INT16</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3035"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_int2 &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3065"></a><span class='Declare_Function'>float8_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3067"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN245"><span class='Ref_to_Macro'>PG_GETARG_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3068"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN3069"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3070"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span>DBL_DIG <span class='Operator'>+ </span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3067"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3070"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%.*g"</span><span class='Delimiter'>, </span>DBL_DIG<span class='Delimiter'>, </span><a href="numeric.c.html#LN3067"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3069"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assume we need not worry about leading/trailing spaces */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN161"><span class='Ref_to_Func'>set_var_from_str</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3070"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3070"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3069"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3068"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3069"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3069"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3068"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end float8_numeric &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3091"></a><span class='Declare_Function'>numeric_float8</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3093"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3094"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN3095"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3093"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN57"><span class='Ref_to_Proto'>get_float8_nan</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3094"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN639"><span class='Ref_to_Func'>numeric_out</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3093"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3095"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="float.c.html#LN416"><span class='Ref_to_Func'>float8in</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3094"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3094"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3095"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert numeric to float8; if out of range, return +/- HUGE_VAL 
 * 
 * (internal helper function, not directly callable from SQL) 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3117"></a><span class='Declare_Function'>numeric_float8_no_overflow</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3119"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3120"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3119"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN57"><span class='Ref_to_Proto'>get_float8_nan</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3120"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN484"><span class='Ref_to_Proto'>numeric_to_double_no_overflow</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3119"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3120"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3131"></a><span class='Declare_Function'>float4_numeric</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3133"></a>    <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN244"><span class='Ref_to_Macro'>PG_GETARG_FLOAT4</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3134"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN3135"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3136"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span>FLT_DIG <span class='Operator'>+ </span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3133"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3136"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%.*g"</span><span class='Delimiter'>, </span>FLT_DIG<span class='Delimiter'>, </span><a href="numeric.c.html#LN3133"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3135"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Assume we need not worry about leading/trailing spaces */ 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN161"><span class='Ref_to_Func'>set_var_from_str</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3136"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3136"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3135"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3134"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3135"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3135"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3134"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end float4_numeric &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3157"></a><span class='Declare_Function'>numeric_float4</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3159"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>num</span> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3160"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN3161"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3159"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN324"><span class='Ref_to_Macro'>PG_RETURN_FLOAT4</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN58"><span class='Ref_to_Proto'>get_float4_nan</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3160"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN639"><span class='Ref_to_Func'>numeric_out</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3159"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3161"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="float.c.html#LN217"><span class='Ref_to_Func'>float4in</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3160"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3160"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3161"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Aggregate functions 
 * 
 * The transition datatype for all these aggregates is declared as INTERNAL. 
 * Actually, it's a pointer to a NumericAggState allocated in the aggregate 
 * context.  The digit buffers for the NumericVars will be there too. 
 * 
 * On platforms which support 128-bit integers some aggregates instead use a 
 * 128-bit integer based transition datatype to speed up calculations. 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
<a name="LN3191"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>NumericAggState</span> 
<span class='Delimiter'>{ 
</span><a name="LN3193"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>calcSumX2</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* if true, calculate sumX2 */ 
</span><a name="LN3194"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Member'>agg_context</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* context we're calculating in */ 
</span><a name="LN3195"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>N</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* count of processed numbers */ 
</span><a name="LN3196"></a>    <a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Declare_Member'>sumX</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* sum of processed numbers */ 
</span><a name="LN3197"></a>    <a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Declare_Member'>sumX2</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* sum of squares of processed numbers */ 
</span><a name="LN3198"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>maxScale</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* maximum scale seen so far */ 
</span><a name="LN3199"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>maxScaleCount</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* number of values seen with maximum scale */ 
</span><a name="LN3200"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>NaNcount</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* count of NaN values (not included in N!) */ 
</span><a name="LN3201"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>NumericAggState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Prepare state data for a numeric aggregate function that needs to compute 
 * sum, count and optionally sum of squares of the input. 
 */ 
</span><span class='Keyword'>static </span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>* 
</span><a name="LN3208"></a><span class='Declare_Function'>makeNumericAggState</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>calcSumX2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3210"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN3211"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>agg_context</span><span class='Delimiter'>; 
</span><a name="LN3212"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3208"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3211"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3212"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3211"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3210"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3210"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3193"><span class='Ref_to_Member'>calcSumX2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3208"><span class='Ref_to_Parameter'>calcSumX2</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3210"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3194"><span class='Ref_to_Member'>agg_context</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3211"><span class='Ref_To_Local'>agg_context</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3212"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN3210"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeNumericAggState &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Like makeNumericAggState(), but allocate the state in the current memory 
 * context. 
 */ 
</span><span class='Keyword'>static </span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>* 
</span><a name="LN3233"></a><span class='Declare_Function'>makeNumericAggStateCurrentContext</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>calcSumX2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3235"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3235"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3235"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3193"><span class='Ref_to_Member'>calcSumX2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3233"><span class='Ref_to_Parameter'>calcSumX2</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3235"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3194"><span class='Ref_to_Member'>agg_context</span></a> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN3235"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Accumulate a new input value for numeric aggregate functions. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3248"></a><span class='Declare_Function'>do_numeric_accum</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>newval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3250"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>X</span><span class='Delimiter'>; 
</span><a name="LN3251"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>X2</span><span class='Delimiter'>; 
</span><a name="LN3252"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Count NaN inputs separately from all else */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* load processed number in short-lived context */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3250"><span class='Ref_To_Local'>X</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Track the highest input dscale that we've seen, to support inverse 
     * transitions (see do_numeric_discard). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3250"><span class='Ref_To_Local'>X</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3250"><span class='Ref_To_Local'>X</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3250"><span class='Ref_To_Local'>X</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if we need X^2, calculate that in short-lived context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3193"><span class='Ref_to_Member'>calcSumX2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3251"><span class='Ref_To_Local'>X2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3250"><span class='Ref_To_Local'>X</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3250"><span class='Ref_To_Local'>X</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3251"><span class='Ref_To_Local'>X2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3250"><span class='Ref_To_Local'>X</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* The rest of this needs to work in the aggregate context */ 
</span>    <a href="numeric.c.html#LN3252"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3194"><span class='Ref_to_Member'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Accumulate sums */ 
</span>    <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3250"><span class='Ref_To_Local'>X</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3193"><span class='Ref_to_Member'>calcSumX2</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3248"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3251"><span class='Ref_To_Local'>X2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3252"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_numeric_accum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Attempt to remove an input value from the aggregated state. 
 * 
 * If the value cannot be removed then the function will return false; the 
 * possible reasons for failing are described below. 
 * 
 * If we aggregate the values 1.01 and 2 then the result will be 3.01. 
 * If we are then asked to un-aggregate the 1.01 then we must fail as we 
 * won't be able to tell what the new aggregated value's dscale should be. 
 * We don't want to return 2.00 (dscale = 2), since the sum's dscale would 
 * have been zero if we'd really aggregated only 2. 
 * 
 * Note: alternatively, we could count the number of inputs with each possible 
 * dscale (up to some sane limit).  Not yet clear if it's worth the trouble. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3313"></a><span class='Declare_Function'>do_numeric_discard</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>newval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3315"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>X</span><span class='Delimiter'>; 
</span><a name="LN3316"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>X2</span><span class='Delimiter'>; 
</span><a name="LN3317"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Count NaN inputs separately from all else */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN169"><span class='Ref_to_Macro'>NUMERIC_IS_NAN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>newval</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* load processed number in short-lived context */ 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3315"><span class='Ref_To_Local'>X</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * state-&GT;sumX's dscale is the maximum dscale of any of the inputs. 
     * Removing the last input with that dscale would require us to recompute 
     * the maximum dscale of the *remaining* inputs, which we cannot do unless 
     * no more non-NaN inputs remain at all.  So we report a failure instead, 
     * and force the aggregation to be redone from scratch. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3315"><span class='Ref_To_Local'>X</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Some remaining inputs have same dscale, or dscale hasn't gotten 
             * above zero anyway 
             */ 
</span>            <a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No remaining non-NaN inputs at all, so reset maxScale */ 
</span>            <a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Correct new maxScale is uncertain, must fail */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if X.dscale==state-&GT;maxS... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* if we need X^2, calculate that in short-lived context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3193"><span class='Ref_to_Member'>calcSumX2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3316"><span class='Ref_To_Local'>X2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3315"><span class='Ref_To_Local'>X</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3315"><span class='Ref_To_Local'>X</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3316"><span class='Ref_To_Local'>X2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3315"><span class='Ref_To_Local'>X</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* The rest of this needs to work in the aggregate context */ 
</span>    <a href="numeric.c.html#LN3317"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3194"><span class='Ref_to_Member'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Operator'>-- &GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Negate X, to subtract it from the sum */ 
</span>        <a href="numeric.c.html#LN3315"><span class='Ref_To_Local'>X</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3315"><span class='Ref_To_Local'>X</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a> <span class='Operator'>? </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a> <span class='Operator'>: </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3315"><span class='Ref_To_Local'>X</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3193"><span class='Ref_to_Member'>calcSumX2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Negate X^2. X^2 is always positive */ 
</span>            <a href="numeric.c.html#LN3316"><span class='Ref_To_Local'>X2</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3316"><span class='Ref_To_Local'>X2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Zero the sums */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN538"><span class='Ref_to_Proto'>accum_sum_reset</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3193"><span class='Ref_to_Member'>calcSumX2</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN538"><span class='Ref_to_Proto'>accum_sum_reset</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3313"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3317"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end do_numeric_discard &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generic transition function for numeric aggregates that require sumX2. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3401"></a><span class='Declare_Function'>numeric_accum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3403"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3403"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the state data on the first call */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3403"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN3403"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3207"><span class='Ref_to_Func'>makeNumericAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="numeric.c.html#LN3247"><span class='Ref_to_Func'>do_numeric_accum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3403"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3403"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Generic combine function for numeric aggregates which require sumX2 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3421"></a><span class='Declare_Function'>numeric_combine</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3423"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state1</span><span class='Delimiter'>; 
</span><a name="LN3424"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state2</span><span class='Delimiter'>; 
</span><a name="LN3425"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>agg_context</span><span class='Delimiter'>; 
</span><a name="LN3426"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3425"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* manually copy all fields from state2 to state1 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN3426"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3425"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3232"><span class='Ref_to_Func'>makeNumericAggStateCurrentContext</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN540"><span class='Ref_to_Proto'>accum_sum_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN540"><span class='Ref_to_Proto'>accum_sum_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3426"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * These are currently only needed for moving aggregates, but let's do 
         * the right thing anyway... 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* The rest of this needs to work in the aggregate context */ 
</span>        <a href="numeric.c.html#LN3426"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3425"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Accumulate sums */ 
</span>        <a href="numeric.c.html#LN541"><span class='Ref_to_Proto'>accum_sum_combine</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN541"><span class='Ref_to_Proto'>accum_sum_combine</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3424"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3426"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if state2-&GT;N&GT;0 &raquo; </span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3423"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_combine &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generic transition function for numeric aggregates that don't require sumX2. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3489"></a><span class='Declare_Function'>numeric_avg_accum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3491"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3491"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the state data on the first call */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3491"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN3491"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3207"><span class='Ref_to_Func'>makeNumericAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="numeric.c.html#LN3247"><span class='Ref_to_Func'>do_numeric_accum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3491"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3491"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Combine function for numeric aggregates which don't require sumX2 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3509"></a><span class='Declare_Function'>numeric_avg_combine</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3511"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state1</span><span class='Delimiter'>; 
</span><a name="LN3512"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state2</span><span class='Delimiter'>; 
</span><a name="LN3513"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>agg_context</span><span class='Delimiter'>; 
</span><a name="LN3514"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3513"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* manually copy all fields from state2 to state1 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN3514"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3513"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3232"><span class='Ref_to_Func'>makeNumericAggStateCurrentContext</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN540"><span class='Ref_to_Proto'>accum_sum_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3514"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * These are currently only needed for moving aggregates, but let's do 
         * the right thing anyway... 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* The rest of this needs to work in the aggregate context */ 
</span>        <a href="numeric.c.html#LN3514"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3513"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Accumulate sums */ 
</span>        <a href="numeric.c.html#LN541"><span class='Ref_to_Proto'>accum_sum_combine</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3512"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3514"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if state2-&GT;N&GT;0 &raquo; </span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3511"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_avg_combine &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_avg_serialize 
 *      Serialize NumericAggState for numeric aggregates that don't require 
 *      sumX2. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3577"></a><span class='Declare_Function'>numeric_avg_serialize</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3579"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN3580"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN3581"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span><a name="LN3582"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sumX</span><span class='Delimiter'>; 
</span><a name="LN3583"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3584"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp_var</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ensure we disallow calling when not in aggregate context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3579"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This is a little wasteful since make_result converts the NumericVar 
     * into a Numeric and numeric_send converts it back again. Is it worth 
     * splitting the tasks in numeric_send into separate functions to stop 
     * this? Doing so would also remove the fmgr call overhead. 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3584"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3579"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3584"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3581"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN856"><span class='Ref_to_Func'>numeric_send</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3584"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3582"><span class='Ref_To_Local'>sumX</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3581"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3584"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3580"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* N */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3580"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3579"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN19"><span class='Ref_to_Proto'>pq_sendbytes</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3580"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3582"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3582"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* maxScale */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3580"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3579"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* maxScaleCount */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3580"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3579"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* NaNcount */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3580"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3579"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3583"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3580"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3583"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_avg_serialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_avg_deserialize 
 *      Deserialize bytea into NumericAggState for numeric aggregates that 
 *      don't require sumX2. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3634"></a><span class='Declare_Function'>numeric_avg_deserialize</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3636"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sstate</span><span class='Delimiter'>; 
</span><a name="LN3637"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3638"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span><a name="LN3639"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp_var</span><span class='Delimiter'>; 
</span><a name="LN3640"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3636"><span class='Ref_To_Local'>sstate</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the bytea into a StringInfo so that we can "receive" it using the 
     * standard recv-function infrastructure. 
     */ 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3640"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3640"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3636"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3636"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3637"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3232"><span class='Ref_to_Func'>makeNumericAggStateCurrentContext</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* N */ 
</span>    <a href="numeric.c.html#LN3637"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3640"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX */ 
</span>    <a href="numeric.c.html#LN3638"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN789"><span class='Ref_to_Func'>numeric_recv</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3640"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3638"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3639"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3637"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3639"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* maxScale */ 
</span>    <a href="numeric.c.html#LN3637"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3640"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* maxScaleCount */ 
</span>    <a href="numeric.c.html#LN3637"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3640"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* NaNcount */ 
</span>    <a href="numeric.c.html#LN3637"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3640"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3640"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3640"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3637"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_avg_deserialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_serialize 
 *      Serialization function for NumericAggState for numeric aggregates that 
 *      require sumX2. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3689"></a><span class='Declare_Function'>numeric_serialize</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3691"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN3692"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN3693"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span><a name="LN3694"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sumX</span><span class='Delimiter'>; 
</span><a name="LN3695"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp_var</span><span class='Delimiter'>; 
</span><a name="LN3696"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sumX2</span><span class='Delimiter'>; 
</span><a name="LN3697"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ensure we disallow calling when not in aggregate context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3691"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This is a little wasteful since make_result converts the NumericVar 
     * into a Numeric and numeric_send converts it back again. Is it worth 
     * splitting the tasks in numeric_send into separate functions to stop 
     * this? Doing so would also remove the fmgr call overhead. 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3695"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3691"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3695"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3693"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN856"><span class='Ref_to_Func'>numeric_send</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3695"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3694"><span class='Ref_To_Local'>sumX</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3693"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3691"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3695"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3693"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN856"><span class='Ref_to_Func'>numeric_send</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3695"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3696"><span class='Ref_To_Local'>sumX2</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3693"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3695"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3692"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* N */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3692"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3691"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN19"><span class='Ref_to_Proto'>pq_sendbytes</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3692"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3694"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3694"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX2 */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN19"><span class='Ref_to_Proto'>pq_sendbytes</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3692"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3696"><span class='Ref_To_Local'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3696"><span class='Ref_To_Local'>sumX2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* maxScale */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3692"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3691"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* maxScaleCount */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3692"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3691"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* NaNcount */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3692"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3691"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3697"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3692"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3697"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_serialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_deserialize 
 *      Deserialization function for NumericAggState for numeric aggregates that 
 *      require sumX2. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3756"></a><span class='Declare_Function'>numeric_deserialize</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3758"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sstate</span><span class='Delimiter'>; 
</span><a name="LN3759"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3760"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span><a name="LN3761"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>sumX_var</span><span class='Delimiter'>; 
</span><a name="LN3762"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>sumX2_var</span><span class='Delimiter'>; 
</span><a name="LN3763"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3758"><span class='Ref_To_Local'>sstate</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the bytea into a StringInfo so that we can "receive" it using the 
     * standard recv-function infrastructure. 
     */ 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3758"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3758"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3759"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3232"><span class='Ref_to_Func'>makeNumericAggStateCurrentContext</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* N */ 
</span>    <a href="numeric.c.html#LN3759"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX */ 
</span>    <a href="numeric.c.html#LN3760"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN789"><span class='Ref_to_Func'>numeric_recv</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3760"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3761"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3759"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3761"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX2 */ 
</span>    <a href="numeric.c.html#LN3760"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN789"><span class='Ref_to_Func'>numeric_recv</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3760"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3762"><span class='Ref_To_Local'>sumX2_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3759"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3762"><span class='Ref_To_Local'>sumX2_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* maxScale */ 
</span>    <a href="numeric.c.html#LN3759"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3198"><span class='Ref_to_Member'>maxScale</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* maxScaleCount */ 
</span>    <a href="numeric.c.html#LN3759"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3199"><span class='Ref_to_Member'>maxScaleCount</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* NaNcount */ 
</span>    <a href="numeric.c.html#LN3759"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3763"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3759"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_deserialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Generic inverse transition function for numeric aggregates 
 * (with or without requirement for X^2). 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3819"></a><span class='Declare_Function'>numeric_accum_inv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3821"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3821"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Should not get here with no state */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3821"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"numeric_accum_inv called with NULL state"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* If we fail to perform the inverse transition, return NULL */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN3312"><span class='Ref_to_Func'>do_numeric_discard</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3821"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3821"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_accum_inv &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Integer data types in general use Numeric accumulators to share code 
 * and avoid risk of overflow. 
 * 
 * However for performance reasons optimized special-purpose accumulator 
 * routines are used when possible. 
 * 
 * On platforms with 128-bit integer support, the 128-bit routines will be 
 * used when sum(X) or sum(X*X) fit into 128-bit. 
 * 
 * For 16 and 32 bit inputs, the N and sum(X) fit into 64-bit so the 64-bit 
 * accumulators will be used for SUM and AVG of these data types. 
 */ 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<a name="LN3855"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>Int128AggState</span> 
<span class='Delimiter'>{ 
</span><a name="LN3857"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>calcSumX2</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* if true, calculate sumX2 */ 
</span><a name="LN3858"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>N</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* count of processed numbers */ 
</span><a name="LN3859"></a>    <a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a>      <span class='Declare_Member'>sumX</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* sum of processed numbers */ 
</span><a name="LN3860"></a>    <a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a>      <span class='Declare_Member'>sumX2</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* sum of squares of processed numbers */ 
</span><a name="LN3861"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>Int128AggState</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Prepare state data for a 128-bit aggregate function that needs to compute 
 * sum, count and optionally sum of squares of the input. 
 */ 
</span><span class='Keyword'>static </span><a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Operator'>* 
</span><a name="LN3868"></a><span class='Declare_Function'>makeInt128AggState</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>calcSumX2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3870"></a>    <a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN3871"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>agg_context</span><span class='Delimiter'>; 
</span><a name="LN3872"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3868"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN3871"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3872"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3871"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3870"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3870"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3857"><span class='Ref_to_Member'>calcSumX2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3868"><span class='Ref_to_Parameter'>calcSumX2</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3872"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN3870"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Like makeInt128AggState(), but allocate the state in the current memory 
 * context. 
 */ 
</span><span class='Keyword'>static </span><a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Operator'>* 
</span><a name="LN3892"></a><span class='Declare_Function'>makeInt128AggStateCurrentContext</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>calcSumX2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3894"></a>    <a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3894"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3894"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3857"><span class='Ref_to_Member'>calcSumX2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3892"><span class='Ref_to_Parameter'>calcSumX2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN3894"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Accumulate a new input value for 128-bit aggregate functions. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3906"></a><span class='Declare_Function'>do_int128_accum</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a> <span class='Declare_Parameter'>newval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3906"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3857"><span class='Ref_to_Member'>calcSumX2</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN3906"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3860"><span class='Ref_to_Member'>sumX2</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN3906"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN3906"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3906"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3859"><span class='Ref_to_Member'>sumX</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN3906"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3906"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3858"><span class='Ref_to_Member'>N</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Remove an input value from the aggregated state. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3919"></a><span class='Declare_Function'>do_int128_discard</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a> <span class='Declare_Parameter'>newval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3919"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3857"><span class='Ref_to_Member'>calcSumX2</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN3919"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3860"><span class='Ref_to_Member'>sumX2</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN3919"><span class='Ref_to_Parameter'>newval</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN3919"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3919"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3859"><span class='Ref_to_Member'>sumX</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN3919"><span class='Ref_to_Parameter'>newval</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN3919"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3858"><span class='Ref_to_Member'>N</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
} 
</span> 
<a name="LN3928"></a><span class='Control'>typedef</span> <a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Declare_Typedef'>PolyNumAggState</span><span class='Delimiter'>; 
</span><a name="LN3929"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>makePolyNumAggState</span> <a href="numeric.c.html#LN3867"><span class='Ref_to_Func'>makeInt128AggState</span></a> 
<a name="LN3930"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>makePolyNumAggStateCurrentContext</span> <a href="numeric.c.html#LN3891"><span class='Ref_to_Func'>makeInt128AggStateCurrentContext</span></a> 
<span class='Directive'>#else</span> 
<a name="LN3932"></a><span class='Control'>typedef</span> <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Declare_Typedef'>PolyNumAggState</span><span class='Delimiter'>; 
</span><a name="LN3933"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>makePolyNumAggState</span> <a href="numeric.c.html#LN3207"><span class='Ref_to_Func'>makeNumericAggState</span></a> 
<a name="LN3934"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>makePolyNumAggStateCurrentContext</span> <a href="numeric.c.html#LN3232"><span class='Ref_to_Func'>makeNumericAggStateCurrentContext</span></a> 
<span class='Directive'>#endif</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3938"></a><span class='Declare_Function'>int2_accum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3940"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3940"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the state data on the first call */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3940"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN3940"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3929"><span class='Ref_to_Const'>makePolyNumAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN3905"><span class='Ref_to_Func'>do_int128_accum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3940"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN3953"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN3953"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3010"><span class='Ref_to_Func'>int2_numeric</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3247"><span class='Ref_to_Func'>do_numeric_accum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3940"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3953"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3940"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int2_accum &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3965"></a><span class='Declare_Function'>int4_accum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3967"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3967"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the state data on the first call */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3967"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN3967"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3929"><span class='Ref_to_Const'>makePolyNumAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN3905"><span class='Ref_to_Func'>do_int128_accum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3967"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN3980"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN3980"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2900"><span class='Ref_to_Func'>int4_numeric</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3247"><span class='Ref_to_Func'>do_numeric_accum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3967"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN3980"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3967"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int4_accum &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3992"></a><span class='Declare_Function'>int8_accum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3994"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN3994"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the state data on the first call */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN3994"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN3994"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3207"><span class='Ref_to_Func'>makeNumericAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4004"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN4004"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3247"><span class='Ref_to_Func'>do_numeric_accum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3994"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4004"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3994"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int8_accum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Combine function for numeric aggregates which require sumX2 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4018"></a><span class='Declare_Function'>numeric_poly_combine</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4020"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state1</span><span class='Delimiter'>; 
</span><a name="LN4021"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state2</span><span class='Delimiter'>; 
</span><a name="LN4022"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>agg_context</span><span class='Delimiter'>; 
</span><a name="LN4023"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4022"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* manually copy all fields from state2 to state1 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN4023"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4022"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3929"><span class='Ref_to_Const'>makePolyNumAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="numeric.c.html#LN540"><span class='Ref_to_Proto'>accum_sum_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN540"><span class='Ref_to_Proto'>accum_sum_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4023"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <span class='Comment_Multi_Line'>/* The rest of this needs to work in the aggregate context */ 
</span>        <a href="numeric.c.html#LN4023"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4022"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Accumulate sums */ 
</span>        <a href="numeric.c.html#LN541"><span class='Ref_to_Proto'>accum_sum_combine</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN541"><span class='Ref_to_Proto'>accum_sum_combine</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4021"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4023"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Delimiter'>} 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4020"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_combine &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_poly_serialize 
 *      Serialize PolyNumAggState into bytea for aggregate functions which 
 *      require sumX2. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4083"></a><span class='Declare_Function'>numeric_poly_serialize</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4085"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4086"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN4087"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sumX</span><span class='Delimiter'>; 
</span><a name="LN4088"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sumX2</span><span class='Delimiter'>; 
</span><a name="LN4089"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ensure we disallow calling when not in aggregate context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4085"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the platform supports int128 then sumX and sumX2 will be a 128 bit 
     * integer type. Here we'll convert that into a numeric type so that the 
     * combine state is in the same format for both int128 enabled machines 
     * and machines which don't support that type. The logic here is that one 
     * day we might like to send these over to another server for further 
     * processing and we want a standard format to work with. 
     */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4106"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span><a name="LN4107"></a>        <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4107"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN482"><span class='Ref_to_Proto'>int128_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4085"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4107"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4085"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4107"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="numeric.c.html#LN4106"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN856"><span class='Ref_to_Func'>numeric_send</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4107"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN4087"><span class='Ref_To_Local'>sumX</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4106"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN482"><span class='Ref_to_Proto'>int128_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4085"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4107"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4085"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4107"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="numeric.c.html#LN4106"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN856"><span class='Ref_to_Func'>numeric_send</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4107"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN4088"><span class='Ref_To_Local'>sumX2</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4106"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4107"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4086"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* N */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4086"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4085"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN19"><span class='Ref_to_Proto'>pq_sendbytes</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4086"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4087"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4087"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX2 */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN19"><span class='Ref_to_Proto'>pq_sendbytes</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4086"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4088"><span class='Ref_To_Local'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4088"><span class='Ref_To_Local'>sumX2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4089"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4086"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4089"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_serialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * numeric_poly_deserialize 
 *      Deserialize PolyNumAggState from bytea for aggregate functions which 
 *      require sumX2. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4154"></a><span class='Declare_Function'>numeric_poly_deserialize</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4156"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sstate</span><span class='Delimiter'>; 
</span><a name="LN4157"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4158"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>sumX</span><span class='Delimiter'>; 
</span><a name="LN4159"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>sumX_var</span><span class='Delimiter'>; 
</span><a name="LN4160"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>sumX2</span><span class='Delimiter'>; 
</span><a name="LN4161"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>sumX2_var</span><span class='Delimiter'>; 
</span><a name="LN4162"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4156"><span class='Ref_To_Local'>sstate</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the bytea into a StringInfo so that we can "receive" it using the 
     * standard recv-function infrastructure. 
     */ 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4162"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4162"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4156"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4156"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4157"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3930"><span class='Ref_to_Const'>makePolyNumAggStateCurrentContext</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* N */ 
</span>    <a href="numeric.c.html#LN4157"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4162"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX */ 
</span>    <a href="numeric.c.html#LN4158"><span class='Ref_To_Local'>sumX</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN789"><span class='Ref_to_Func'>numeric_recv</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4162"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX2 */ 
</span>    <a href="numeric.c.html#LN4160"><span class='Ref_To_Local'>sumX2</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN789"><span class='Ref_to_Func'>numeric_recv</span></a><span class='Delimiter'>, 
</span>                                <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4162"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4158"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4159"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
    <a href="numeric.c.html#LN481"><span class='Ref_to_Proto'>numericvar_to_int128</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4159"><span class='Ref_To_Local'>sumX_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4157"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4157"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4159"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4160"><span class='Ref_To_Local'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4161"><span class='Ref_To_Local'>sumX2_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
    <a href="numeric.c.html#LN481"><span class='Ref_to_Proto'>numericvar_to_int128</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4161"><span class='Ref_To_Local'>sumX2_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4157"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4157"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4161"><span class='Ref_To_Local'>sumX2_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="../../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4162"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4162"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4157"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_deserialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Transition function for int8 input when we don't need sumX2. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4218"></a><span class='Declare_Function'>int8_avg_accum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4220"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4220"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create the state data on the first call */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4220"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN4220"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3929"><span class='Ref_to_Const'>makePolyNumAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN3905"><span class='Ref_to_Func'>do_int128_accum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4220"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN4233"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN4233"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN3247"><span class='Ref_to_Func'>do_numeric_accum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4220"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4233"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4220"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int8_avg_accum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Combine function for PolyNumAggState for aggregates which don't require 
 * sumX2 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4249"></a><span class='Declare_Function'>int8_avg_combine</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4251"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state1</span><span class='Delimiter'>; 
</span><a name="LN4252"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state2</span><span class='Delimiter'>; 
</span><a name="LN4253"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>agg_context</span><span class='Delimiter'>; 
</span><a name="LN4254"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>old_context</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4253"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN4252"><span class='Ref_To_Local'>state2</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4252"><span class='Ref_To_Local'>state2</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* manually copy all fields from state2 to state1 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN4254"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4253"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3929"><span class='Ref_to_Const'>makePolyNumAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4252"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4252"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="numeric.c.html#LN540"><span class='Ref_to_Proto'>accum_sum_copy</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4252"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4254"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4252"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN4252"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN4252"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <span class='Comment_Multi_Line'>/* The rest of this needs to work in the aggregate context */ 
</span>        <a href="numeric.c.html#LN4254"><span class='Ref_To_Local'>old_context</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4253"><span class='Ref_To_Local'>agg_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Accumulate sums */ 
</span>        <a href="numeric.c.html#LN541"><span class='Ref_to_Proto'>accum_sum_combine</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4252"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4254"><span class='Ref_To_Local'>old_context</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Delimiter'>} 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4251"><span class='Ref_To_Local'>state1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int8_avg_combine &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * int8_avg_serialize 
 *      Serialize PolyNumAggState into bytea using the standard 
 *      recv-function infrastructure. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4309"></a><span class='Declare_Function'>int8_avg_serialize</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4311"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4312"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN4313"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sumX</span><span class='Delimiter'>; 
</span><a name="LN4314"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ensure we disallow calling when not in aggregate context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4311"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the platform supports int128 then sumX will be a 128 integer type. 
     * Here we'll convert that into a numeric type so that the combine state 
     * is in the same format for both int128 enabled machines and machines 
     * which don't support that type. The logic here is that one day we might 
     * like to send these over to another server for further processing and we 
     * want a standard format to work with. 
     */ 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4331"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span><a name="LN4332"></a>        <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4332"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN482"><span class='Ref_to_Proto'>int128_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4311"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4332"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
        <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4311"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4332"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <a href="numeric.c.html#LN4331"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN856"><span class='Ref_to_Func'>numeric_send</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4332"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN4313"><span class='Ref_To_Local'>sumX</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4331"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4332"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4312"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* N */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4312"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4311"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX */ 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN19"><span class='Ref_to_Proto'>pq_sendbytes</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4312"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4313"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4313"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4314"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4312"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4314"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int8_avg_serialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * int8_avg_deserialize 
 *      Deserialize bytea back into PolyNumAggState. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4366"></a><span class='Declare_Function'>int8_avg_deserialize</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4368"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>sstate</span><span class='Delimiter'>; 
</span><a name="LN4369"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4370"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN4371"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>temp</span><span class='Delimiter'>; 
</span><a name="LN4372"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>num</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4368"><span class='Ref_To_Local'>sstate</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy the bytea into a StringInfo so that we can "receive" it using the 
     * standard recv-function infrastructure. 
     */ 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4370"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4370"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4368"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4368"><span class='Ref_To_Local'>sstate</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4369"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN3930"><span class='Ref_to_Const'>makePolyNumAggStateCurrentContext</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* N */ 
</span>    <a href="numeric.c.html#LN4369"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4370"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* sumX */ 
</span>    <a href="numeric.c.html#LN4371"><span class='Ref_To_Local'>temp</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN789"><span class='Ref_to_Func'>numeric_recv</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4370"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN468"><span class='Ref_to_Proto'>init_var_from_num</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4371"><span class='Ref_To_Local'>temp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4372"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
    <a href="numeric.c.html#LN481"><span class='Ref_to_Proto'>numericvar_to_int128</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4372"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4369"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4369"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4372"><span class='Ref_To_Local'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="../../../include/libpq/pqformat.h.html#LN47"><span class='Ref_to_Proto'>pq_getmsgend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4370"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4370"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4369"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int8_avg_deserialize &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Inverse transition functions to go with the above. 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4415"></a><span class='Declare_Function'>int2_accum_inv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4417"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4417"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Should not get here with no state */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4417"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"int2_accum_inv called with NULL state"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN3918"><span class='Ref_to_Func'>do_int128_discard</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4417"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN4430"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN4430"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN3010"><span class='Ref_to_Func'>int2_numeric</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Should never fail, all inputs have dscale 0 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN3312"><span class='Ref_to_Func'>do_numeric_discard</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4417"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4430"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"do_numeric_discard failed unexpectedly"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4417"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int2_accum_inv &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4445"></a><span class='Declare_Function'>int4_accum_inv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4447"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4447"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Should not get here with no state */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4447"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"int4_accum_inv called with NULL state"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN3918"><span class='Ref_to_Func'>do_int128_discard</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4447"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN4460"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN4460"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2900"><span class='Ref_to_Func'>int4_numeric</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Should never fail, all inputs have dscale 0 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN3312"><span class='Ref_to_Func'>do_numeric_discard</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4447"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4460"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"do_numeric_discard failed unexpectedly"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4447"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int4_accum_inv &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4475"></a><span class='Declare_Function'>int8_accum_inv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4477"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4477"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Should not get here with no state */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4477"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"int8_accum_inv called with NULL state"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4487"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN4487"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Should never fail, all inputs have dscale 0 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN3312"><span class='Ref_to_Func'>do_numeric_discard</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4477"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4487"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"do_numeric_discard failed unexpectedly"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4477"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int8_accum_inv &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4501"></a><span class='Declare_Function'>int8_avg_accum_inv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4503"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4503"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Should not get here with no state */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4503"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"int8_avg_accum_inv called with NULL state"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
        <a href="numeric.c.html#LN3918"><span class='Ref_to_Func'>do_int128_discard</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4503"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
<a name="LN4516"></a>        <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN4516"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN48"><span class='Ref_to_Macro'>DatumGetNumeric</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, 
</span>                                                     <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Should never fail, all inputs have dscale 0 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN3312"><span class='Ref_to_Func'>do_numeric_discard</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4503"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4516"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"do_numeric_discard failed unexpectedly"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4503"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int8_avg_accum_inv &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4531"></a><span class='Declare_Function'>numeric_poly_sum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<a name="LN4534"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4535"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4536"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4534"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there were no non-null inputs, return NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4534"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="numeric.c.html#LN4534"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4536"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN482"><span class='Ref_to_Proto'>int128_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4534"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4536"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4535"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4536"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4536"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4535"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN4616"><span class='Ref_to_Func'>numeric_sum</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_sum &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4559"></a><span class='Declare_Function'>numeric_poly_avg</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<a name="LN4562"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4563"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4564"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>countd</span><span class='Delimiter'>, 
</span><a name="LN4565"></a>                <span class='Declare_Local'>sumd</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4562"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there were no non-null inputs, return NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4562"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="numeric.c.html#LN4562"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4563"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN482"><span class='Ref_to_Proto'>int128_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4562"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4563"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4564"><span class='Ref_To_Local'>countd</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4562"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN4565"><span class='Ref_To_Local'>sumd</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4563"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4563"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2364"><span class='Ref_to_Func'>numeric_div</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4565"><span class='Ref_To_Local'>sumd</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4564"><span class='Ref_To_Local'>countd</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN4589"><span class='Ref_to_Func'>numeric_avg</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_avg &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4590"></a><span class='Declare_Function'>numeric_avg</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4592"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4593"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>N_datum</span><span class='Delimiter'>; 
</span><a name="LN4594"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>sumX_datum</span><span class='Delimiter'>; 
</span><a name="LN4595"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>sumX_var</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4592"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there were no non-null inputs, return NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4592"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN4592"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN4592"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4592"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* there was at least one NaN input */ 
</span>        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4593"><span class='Ref_To_Local'>N_datum</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN624"><span class='Ref_to_Macro'>Int64GetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4592"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4595"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4592"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4595"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN4594"><span class='Ref_To_Local'>sumX_datum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4595"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4595"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2364"><span class='Ref_to_Func'>numeric_div</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4594"><span class='Ref_To_Local'>sumX_datum</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4593"><span class='Ref_To_Local'>N_datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_avg &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4617"></a><span class='Declare_Function'>numeric_sum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4619"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4620"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>sumX_var</span><span class='Delimiter'>; 
</span><a name="LN4621"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4619"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If there were no non-null inputs, return NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4619"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN4619"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN4619"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4619"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* there was at least one NaN input */ 
</span>        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4620"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4619"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4620"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN4621"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4620"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4620"><span class='Ref_To_Local'>sumX_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4621"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_sum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Workhorse routine for the standard deviance and variance 
 * aggregates. 'state' is aggregate's transition state. 
 * 'variance' specifies whether we should calculate the 
 * variance or the standard deviation. 'sample' indicates whether the 
 * caller is interested in the sample or the population 
 * variance/stddev. 
 * 
 * If appropriate variance statistic is undefined for the input, 
 * *is_null is set to true and NULL is returned. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> 
<a name="LN4652"></a><span class='Declare_Function'>numeric_stddev_internal</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, 
</span><a name="LN4653"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>variance</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>sample</span><span class='Delimiter'>, 
</span><a name="LN4654"></a>                        <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_null</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4656"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4657"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>vN</span><span class='Delimiter'>, 
</span><a name="LN4658"></a>                <span class='Declare_Local'>vsumX</span><span class='Delimiter'>, 
</span><a name="LN4659"></a>                <span class='Declare_Local'>vsumX2</span><span class='Delimiter'>, 
</span><a name="LN4660"></a>                <span class='Declare_Local'>vNminus1</span><span class='Delimiter'>; 
</span><a name="LN4661"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>comp</span><span class='Delimiter'>; 
</span><a name="LN4662"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rscale</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deal with empty input and NaN-input cases */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4652"><span class='Ref_to_Parameter'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN4652"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN4652"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="numeric.c.html#LN4654"><span class='Ref_to_Parameter'>is_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="numeric.c.html#LN4654"><span class='Ref_to_Parameter'>is_null</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4652"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3200"><span class='Ref_to_Member'>NaNcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN421"><span class='Ref_to_Global_Var'>const_nan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4657"><span class='Ref_To_Local'>vN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN479"><span class='Ref_to_Proto'>int64_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4652"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4657"><span class='Ref_To_Local'>vN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN4652"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN4652"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sample stddev and variance are undefined when N &LT;= 1; population stddev 
     * is undefined when N == 0. Return NULL in either case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4653"><span class='Ref_to_Parameter'>sample</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN4661"><span class='Ref_To_Local'>comp</span></a> <span class='Operator'>= &</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN4661"><span class='Ref_To_Local'>comp</span></a> <span class='Operator'>= &</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4657"><span class='Ref_To_Local'>vN</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4661"><span class='Ref_To_Local'>comp</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="numeric.c.html#LN4654"><span class='Ref_to_Parameter'>is_null</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4660"><span class='Ref_To_Local'>vNminus1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4657"><span class='Ref_To_Local'>vN</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4660"><span class='Ref_To_Local'>vNminus1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* compute rscale for mul_var calls */ 
</span>    <a href="numeric.c.html#LN4662"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4662"><span class='Ref_To_Local'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* vsumX = sumX * sumX */ 
</span>    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4657"><span class='Ref_To_Local'>vN</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4662"><span class='Ref_To_Local'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* vsumX2 = N * sumX2 */ 
</span>    <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* N * sumX2 - sumX * sumX */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Watch out for roundoff error producing a negative numerator */ 
</span>        <a href="numeric.c.html#LN4656"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4653"><span class='Ref_to_Parameter'>sample</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4657"><span class='Ref_To_Local'>vN</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4660"><span class='Ref_To_Local'>vNminus1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4660"><span class='Ref_To_Local'>vNminus1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* N * (N - 1) */ 
</span>        <span class='Control'>else</span> 
            <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4657"><span class='Ref_To_Local'>vN</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4657"><span class='Ref_To_Local'>vN</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4660"><span class='Ref_To_Local'>vNminus1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* N * N */ 
</span>        <a href="numeric.c.html#LN4662"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN508"><span class='Ref_to_Proto'>select_div_scale</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4660"><span class='Ref_To_Local'>vNminus1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN504"><span class='Ref_to_Proto'>div_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4660"><span class='Ref_To_Local'>vNminus1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4662"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* variance */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN4653"><span class='Ref_to_Parameter'>variance</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN513"><span class='Ref_to_Proto'>sqrt_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4662"><span class='Ref_To_Local'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* stddev */ 
</span> 
        <a href="numeric.c.html#LN4656"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../optimizer/plan/createplan.c.html#LN274"><span class='Ref_to_Proto'>make_result</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4660"><span class='Ref_To_Local'>vNminus1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4658"><span class='Ref_To_Local'>vsumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4659"><span class='Ref_To_Local'>vsumX2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN4656"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_stddev_internal &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4736"></a><span class='Declare_Function'>numeric_var_samp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4738"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4739"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4740"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4738"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4739"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4651"><span class='Ref_to_Func'>numeric_stddev_internal</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4738"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4740"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4740"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4739"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4753"></a><span class='Declare_Function'>numeric_stddev_samp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4755"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4756"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4757"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4755"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4756"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4651"><span class='Ref_to_Func'>numeric_stddev_internal</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4755"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4757"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4757"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4756"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4770"></a><span class='Declare_Function'>numeric_var_pop</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4772"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4773"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4774"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4772"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4773"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4651"><span class='Ref_to_Func'>numeric_stddev_internal</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4772"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4774"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4774"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4773"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4787"></a><span class='Declare_Function'>numeric_stddev_pop</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4789"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4790"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4791"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4789"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4790"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4651"><span class='Ref_to_Func'>numeric_stddev_internal</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4789"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4791"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4791"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4790"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<span class='Keyword'>static </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> 
<a name="LN4805"></a><span class='Declare_Function'>numeric_poly_stddev_internal</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3855"><span class='Ref_to_Struct'>Int128AggState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, 
</span><a name="LN4806"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>variance</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>sample</span><span class='Delimiter'>, 
</span><a name="LN4807"></a>                             <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>is_null</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4809"></a>    <a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a> <span class='Declare_Local'>numstate</span><span class='Delimiter'>; 
</span><a name="LN4810"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize an empty agg state */ 
</span>    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3191"><span class='Ref_to_Struct'>NumericAggState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4805"><span class='Ref_to_Parameter'>state</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4817"></a>        <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp_var</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN3195"><span class='Ref_to_Member'>N</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4805"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3858"><span class='Ref_to_Member'>N</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4817"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN482"><span class='Ref_to_Proto'>int128_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4805"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3859"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4817"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4817"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN482"><span class='Ref_to_Proto'>int128_to_numericvar</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4805"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN3860"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4817"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4817"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4817"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN4810"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4651"><span class='Ref_to_Func'>numeric_stddev_internal</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4806"><span class='Ref_to_Parameter'>variance</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4806"><span class='Ref_to_Parameter'>sample</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN4807"><span class='Ref_to_Parameter'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN3196"><span class='Ref_to_Member'>sumX</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4809"><span class='Ref_To_Local'>numstate</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN3197"><span class='Ref_to_Member'>sumX2</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN4810"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_stddev_internal &raquo; </span> 
<span class='Directive'>#endif</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4850"></a><span class='Declare_Function'>numeric_poly_var_samp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<a name="LN4853"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4854"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4855"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4853"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4854"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4804"><span class='Ref_to_Func'>numeric_poly_stddev_internal</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4853"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4855"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4855"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4854"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN4735"><span class='Ref_to_Func'>numeric_var_samp</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_var_samp &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4871"></a><span class='Declare_Function'>numeric_poly_stddev_samp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<a name="LN4874"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4875"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4876"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4874"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4875"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4804"><span class='Ref_to_Func'>numeric_poly_stddev_internal</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4874"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4876"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4876"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4875"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN4752"><span class='Ref_to_Func'>numeric_stddev_samp</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_stddev_samp &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4892"></a><span class='Declare_Function'>numeric_poly_var_pop</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<a name="LN4895"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4896"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4897"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4895"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4896"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4804"><span class='Ref_to_Func'>numeric_poly_stddev_internal</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4895"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4897"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4897"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4896"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN4769"><span class='Ref_to_Func'>numeric_var_pop</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_var_pop &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4913"></a><span class='Declare_Function'>numeric_poly_stddev_pop</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<a name="LN4916"></a>    <a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4917"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN4918"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4916"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN3932"><span class='Ref_to_Typedef'>PolyNumAggState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN4917"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4804"><span class='Ref_to_Func'>numeric_poly_stddev_internal</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4916"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN4918"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN4918"><span class='Ref_To_Local'>is_null</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4917"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN4786"><span class='Ref_to_Func'>numeric_stddev_pop</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end numeric_poly_stddev_pop &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SUM transition functions for integer datatypes. 
 * 
 * To avoid overflow, we use accumulators wider than the input datatype. 
 * A Numeric accumulator is needed for int8 input; for int4 and int2 
 * inputs, we use int8 accumulators which should be sufficient for practical 
 * purposes.  (The latter two therefore don't really belong in this file, 
 * but we keep them here anyway.) 
 * 
 * Because SQL defines the SUM() of no values to be NULL, not zero, 
 * the initial condition of the transition data value needs to be NULL. This 
 * means we can't rely on ExecAgg to automatically insert the first non-null 
 * data value into the transition data: it doesn't know how to do the type 
 * conversion.  The upshot is that these routines have to be marked non-strict 
 * and handle substitution of the first non-null input themselves. 
 * 
 * Note: these functions are used only in plain aggregation mode. 
 * In moving-aggregate mode, we use intX_avg_accum and intX_avg_accum_inv. 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4954"></a><span class='Declare_Function'>int2_sum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4956"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No non-null input seen so far... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* still no non-null */ 
</span>        <span class='Comment_Multi_Line'>/* This is the first non-null input. */ 
</span>        <a href="numeric.c.html#LN4956"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4956"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're invoked as an aggregate, we can cheat and modify our first 
     * parameter in-place to avoid palloc overhead. If not, we need to return 
     * the new value of the transition variable. (If int8 is pass-by-value, 
     * then of course this is useless as well as incorrect, so just ifdef it 
     * out.) 
     */ 
</span><span class='Directive'>#ifndef</span> USE_FLOAT8_BYVAL        <span class='Comment_Single_Line'>/* controls int8 too */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4978"></a>        <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>oldsum</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Leave the running sum unchanged in the new input is null */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="numeric.c.html#LN4978"><span class='Ref_To_Local'>oldsum</span></a> <span class='Operator'>= *</span><a href="numeric.c.html#LN4978"><span class='Ref_To_Local'>oldsum</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4978"><span class='Ref_To_Local'>oldsum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4989"></a>        <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>oldsum</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Leave sum unchanged if new input is null. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4989"><span class='Ref_To_Local'>oldsum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* OK to do the addition. */ 
</span>        <a href="numeric.c.html#LN4956"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN4989"><span class='Ref_To_Local'>oldsum</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN4956"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end int2_sum &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5003"></a><span class='Declare_Function'>int4_sum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5005"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No non-null input seen so far... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* still no non-null */ 
</span>        <span class='Comment_Multi_Line'>/* This is the first non-null input. */ 
</span>        <a href="numeric.c.html#LN5005"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5005"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're invoked as an aggregate, we can cheat and modify our first 
     * parameter in-place to avoid palloc overhead. If not, we need to return 
     * the new value of the transition variable. (If int8 is pass-by-value, 
     * then of course this is useless as well as incorrect, so just ifdef it 
     * out.) 
     */ 
</span><span class='Directive'>#ifndef</span> USE_FLOAT8_BYVAL        <span class='Comment_Single_Line'>/* controls int8 too */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5027"></a>        <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>oldsum</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Leave the running sum unchanged in the new input is null */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="numeric.c.html#LN5027"><span class='Ref_To_Local'>oldsum</span></a> <span class='Operator'>= *</span><a href="numeric.c.html#LN5027"><span class='Ref_To_Local'>oldsum</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5027"><span class='Ref_To_Local'>oldsum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5038"></a>        <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>oldsum</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Leave sum unchanged if new input is null. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5038"><span class='Ref_To_Local'>oldsum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* OK to do the addition. */ 
</span>        <a href="numeric.c.html#LN5005"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5038"><span class='Ref_To_Local'>oldsum</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN326"><span class='Ref_to_Macro'>PG_RETURN_INT64</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5005"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end int4_sum &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Note: this function is obsolete, it's no longer used for SUM(int8). 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5055"></a><span class='Declare_Function'>int8_sum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5057"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>oldsum</span><span class='Delimiter'>; 
</span><a name="LN5058"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>newval</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No non-null input seen so far... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* still no non-null */ 
</span>        <span class='Comment_Multi_Line'>/* This is the first non-null input. */ 
</span>        <a href="numeric.c.html#LN5058"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5058"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note that we cannot special-case the aggregate case here, as we do for 
     * int2_sum and int4_sum: numeric is of variable size, so we cannot modify 
     * our first parameter in-place. 
     */ 
</span> 
    <a href="numeric.c.html#LN5057"><span class='Ref_To_Local'>oldsum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/numeric.h.html#LN51"><span class='Ref_to_Macro'>PG_GETARG_NUMERIC</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Leave sum unchanged if new input is null. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/numeric.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_NUMERIC</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5057"><span class='Ref_To_Local'>oldsum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* OK to do the addition. */ 
</span>    <a href="numeric.c.html#LN5058"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2246"><span class='Ref_to_Func'>numeric_add</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5057"><span class='Ref_To_Local'>oldsum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5058"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int8_sum &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Routines for avg(int2) and avg(int4).  The transition datatype 
 * is a two-element int8 array, holding count and sum. 
 * 
 * These functions are also used for sum(int2) and sum(int4) when 
 * operating in moving-aggregate mode, since for correct inverse transitions 
 * we need to count the inputs. 
 */ 
</span> 
<a name="LN5099"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>Int8TransTypeData</span> 
<span class='Delimiter'>{ 
</span><a name="LN5101"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>count</span><span class='Delimiter'>; 
</span><a name="LN5102"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Member'>sum</span><span class='Delimiter'>; 
</span><a name="LN5103"></a>} <span class='Declare_Typedef'>Int8TransTypeData</span><span class='Delimiter'>; 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5106"></a><span class='Declare_Function'>int2_avg_accum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5108"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray</span><span class='Delimiter'>; 
</span><a name="LN5109"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5110"></a>    <a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>transdata</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're invoked as an aggregate, we can cheat and modify our first 
     * parameter in-place to reduce palloc overhead. Otherwise we need to make 
     * a copy of it before scribbling on it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="numeric.c.html#LN5108"><span class='Ref_To_Local'>transarray</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN5108"><span class='Ref_To_Local'>transarray</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN244"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5108"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5108"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element int8 array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5110"><span class='Ref_To_Local'>transdata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5108"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5110"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5101"><span class='Ref_to_Member'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5110"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5102"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN5109"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5108"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int2_avg_accum &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5134"></a><span class='Declare_Function'>int4_avg_accum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5136"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray</span><span class='Delimiter'>; 
</span><a name="LN5137"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5138"></a>    <a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>transdata</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're invoked as an aggregate, we can cheat and modify our first 
     * parameter in-place to reduce palloc overhead. Otherwise we need to make 
     * a copy of it before scribbling on it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="numeric.c.html#LN5136"><span class='Ref_To_Local'>transarray</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN5136"><span class='Ref_To_Local'>transarray</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN244"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5136"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5136"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element int8 array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5138"><span class='Ref_To_Local'>transdata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5136"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5138"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5101"><span class='Ref_to_Member'>count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5138"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5102"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN5137"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5136"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int4_avg_accum &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5162"></a><span class='Declare_Function'>int4_avg_combine</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5164"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray1</span><span class='Delimiter'>; 
</span><a name="LN5165"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray2</span><span class='Delimiter'>; 
</span><a name="LN5166"></a>    <a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state1</span><span class='Delimiter'>; 
</span><a name="LN5167"></a>    <a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>state2</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"aggregate function called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5164"><span class='Ref_To_Local'>transarray1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5165"><span class='Ref_To_Local'>transarray2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5164"><span class='Ref_To_Local'>transarray1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5164"><span class='Ref_To_Local'>transarray1</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element int8 array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5165"><span class='Ref_To_Local'>transarray2</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5165"><span class='Ref_To_Local'>transarray2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element int8 array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5166"><span class='Ref_To_Local'>state1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5164"><span class='Ref_To_Local'>transarray1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5167"><span class='Ref_To_Local'>state2</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5165"><span class='Ref_To_Local'>transarray2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5166"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5101"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN5167"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5101"><span class='Ref_to_Member'>count</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5166"><span class='Ref_To_Local'>state1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5102"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN5167"><span class='Ref_To_Local'>state2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5102"><span class='Ref_to_Member'>sum</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5164"><span class='Ref_To_Local'>transarray1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int4_avg_combine &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5193"></a><span class='Declare_Function'>int2_avg_accum_inv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5195"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray</span><span class='Delimiter'>; 
</span><a name="LN5196"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN235"><span class='Ref_to_Macro'>PG_GETARG_INT16</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5197"></a>    <a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>transdata</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're invoked as an aggregate, we can cheat and modify our first 
     * parameter in-place to reduce palloc overhead. Otherwise we need to make 
     * a copy of it before scribbling on it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="numeric.c.html#LN5195"><span class='Ref_To_Local'>transarray</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN5195"><span class='Ref_To_Local'>transarray</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN244"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5195"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5195"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element int8 array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5197"><span class='Ref_To_Local'>transdata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5195"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5197"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5101"><span class='Ref_to_Member'>count</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5197"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5102"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5196"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5195"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int2_avg_accum_inv &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5221"></a><span class='Declare_Function'>int4_avg_accum_inv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5223"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray</span><span class='Delimiter'>; 
</span><a name="LN5224"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5225"></a>    <a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>transdata</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're invoked as an aggregate, we can cheat and modify our first 
     * parameter in-place to reduce palloc overhead. Otherwise we need to make 
     * a copy of it before scribbling on it. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> 
        <a href="numeric.c.html#LN5223"><span class='Ref_To_Local'>transarray</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN5223"><span class='Ref_To_Local'>transarray</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN244"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5223"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5223"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element int8 array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5225"><span class='Ref_To_Local'>transdata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5223"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5225"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5101"><span class='Ref_to_Member'>count</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5225"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5102"><span class='Ref_to_Member'>sum</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5224"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5223"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int4_avg_accum_inv &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5249"></a><span class='Declare_Function'>int8_avg</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5251"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5252"></a>    <a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>transdata</span><span class='Delimiter'>; 
</span><a name="LN5253"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>countd</span><span class='Delimiter'>, 
</span><a name="LN5254"></a>                <span class='Declare_Local'>sumd</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5251"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5251"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element int8 array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5252"><span class='Ref_To_Local'>transdata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5251"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* SQL defines AVG of no values to be NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5252"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5101"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5253"><span class='Ref_To_Local'>countd</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, 
</span>                                 <a href="../../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5252"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5101"><span class='Ref_to_Member'>count</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5254"><span class='Ref_To_Local'>sumd</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2966"><span class='Ref_to_Func'>int8_numeric</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5252"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5102"><span class='Ref_to_Member'>sum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN2364"><span class='Ref_to_Func'>numeric_div</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5254"><span class='Ref_To_Local'>sumd</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5253"><span class='Ref_To_Local'>countd</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int8_avg &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SUM(int2) and SUM(int4) both return int8, so we can use this 
 * final function for both. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5278"></a><span class='Declare_Function'>int2int4_sum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5280"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5281"></a>    <a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>transdata</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN271"><span class='Ref_to_Macro'>ARR_HASNULL</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5280"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="../../../include/utils/array.h.html#LN269"><span class='Ref_to_Macro'>ARR_SIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5280"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/array.h.html#LN290"><span class='Ref_to_Macro'>ARR_OVERHEAD_NONULLS</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element int8 array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5281"><span class='Ref_To_Local'>transdata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5099"><span class='Ref_to_Struct'>Int8TransTypeData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5280"><span class='Ref_To_Local'>transarray</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* SQL defines SUM of no values to be NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5281"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5101"><span class='Ref_to_Member'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5281"><span class='Ref_To_Local'>transdata</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN5102"><span class='Ref_to_Member'>sum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Debug support 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
<span class='Directive'>#ifdef</span> NUMERIC_DEBUG 
 
<span class='Comment_Multi_Line'>/* 
 * dump_numeric() - Dump a value in the db storage format for debugging 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5309"></a><span class='Declare_Function'>dump_numeric</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5311"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN452"><span class='Ref_to_Macro'>NUMERIC_DIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5309"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5312"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span><a name="LN5313"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5312"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5309"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%s: NUMERIC w=%d d=%d "</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5309"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, 
</span>           <a href="numeric.c.html#LN213"><span class='Ref_to_Macro'>NUMERIC_WEIGHT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5309"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN209"><span class='Ref_to_Macro'>NUMERIC_DSCALE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5309"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN205"><span class='Ref_to_Macro'>NUMERIC_SIGN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5309"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Operator'>: 
</span>            <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"POS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Operator'>: 
</span>            <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"NEG"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN5"><span class='Ref_to_Const'>NUMERIC_NAN</span></a><span class='Operator'>: 
</span>            <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"NaN"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"SIGN=0x%x"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN205"><span class='Ref_to_Macro'>NUMERIC_SIGN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5309"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5313"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN5313"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN5312"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN5313"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>" %0*d"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5311"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5313"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dump_numeric &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * dump_var() - Dump a value in the variable format for debugging 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5345"></a><span class='Declare_Function'>dump_var</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5347"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"%s: VAR w=%d d=%d "</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5345"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5345"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5345"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5345"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Operator'>: 
</span>            <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"POS"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Operator'>: 
</span>            <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"NEG"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN5"><span class='Ref_to_Const'>NUMERIC_NAN</span></a><span class='Operator'>: 
</span>            <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"NaN"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"SIGN=0x%x"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5345"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5347"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN5347"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN5345"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN5347"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>" %0*d"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5345"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5347"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/port.h.html#LN173"><span class='Ref_to_Macro'>printf</span></a><span class='Parentheses'>(</span><span class='String'>"\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dump_var &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* NUMERIC_DEBUG */ 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Local functions follow 
 * 
 * In general, these do not support NaNs --- callers must eliminate 
 * the possibility of NaN first.  (make_result() is an exception.) 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * alloc_var() - 
 * 
 *  Allocate a digit buffer of ndigits digits (plus a spare digit for rounding) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5391"></a><span class='Declare_Function'>alloc_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>ndigits</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN16"><span class='Ref_to_Macro'>digitbuf_free</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5391"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5391"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN15"><span class='Ref_to_Macro'>digitbuf_alloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5391"><span class='Ref_to_Parameter'>ndigits</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5391"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* spare digit for rounding */ 
</span>    <a href="numeric.c.html#LN5391"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5391"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5391"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5391"><span class='Ref_to_Parameter'>ndigits</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * free_var() - 
 * 
 *  Return the digit buffer of a variable to the free pool 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5407"></a><span class='Declare_Function'>free_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN16"><span class='Ref_to_Macro'>digitbuf_free</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5407"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5407"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5407"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5407"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN5"><span class='Ref_to_Const'>NUMERIC_NAN</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * zero_var() - 
 * 
 *  Set a variable to ZERO. 
 *  Note: its dscale is not touched. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5423"></a><span class='Declare_Function'>zero_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN16"><span class='Ref_to_Macro'>digitbuf_free</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5423"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5423"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5423"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5423"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5423"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* by convention; doesn't really matter */ 
</span>    <a href="numeric.c.html#LN5423"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* anything but NAN... */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_var_from_str() 
 * 
 *  Parse a string and put the number into a variable 
 * 
 * This function does not handle leading or trailing spaces, and it doesn't 
 * accept "NaN" either.  It returns the end+1 position so that caller can 
 * check for trailing spaces/garbage if deemed necessary. 
 * 
 * cp is the place to actually start parsing; str is what to use in error 
 * reports.  (Typically cp would be the same except advanced over spaces.) 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN5447"></a><span class='Declare_Function'>set_var_from_str</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5449"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_dp</span> <span class='Operator'>= </span><span class='Boolean'>FALSE</span><span class='Delimiter'>; 
</span><a name="LN5450"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN5451"></a>    <span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Declare_Local'>decdigits</span><span class='Delimiter'>; 
</span><a name="LN5452"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sign</span> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span><a name="LN5453"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dweight</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN5454"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ddigits</span><span class='Delimiter'>; 
</span><a name="LN5455"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dscale</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN5456"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight</span><span class='Delimiter'>; 
</span><a name="LN5457"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span><a name="LN5458"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span><a name="LN5459"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>digits</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We first parse the string to extract decimal digits and determine the 
     * correct decimal weight.  Then convert to NBASE representation. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='String'>'+'</span><span class='Operator'>: 
</span>            <a href="numeric.c.html#LN5452"><span class='Ref_To_Local'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <span class='String'>'-'</span><span class='Operator'>: 
</span>            <a href="numeric.c.html#LN5452"><span class='Ref_To_Local'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN5449"><span class='Ref_To_Local'>have_dp</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s: \"%s\""</span><span class='Delimiter'>, 
</span>                        <span class='String'>"numeric"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* leading padding for digit alignment later */ 
</span>    memset<span class='Parentheses'>(</span><a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= *</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>++ - </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN5449"><span class='Ref_To_Local'>have_dp</span></a><span class='Parentheses'>) 
</span>                <a href="numeric.c.html#LN5453"><span class='Ref_To_Local'>dweight</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="numeric.c.html#LN5455"><span class='Ref_To_Local'>dscale</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5449"><span class='Ref_To_Local'>have_dp</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s: \"%s\""</span><span class='Delimiter'>, 
</span>                                <span class='String'>"numeric"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5449"><span class='Ref_To_Local'>have_dp</span></a> <span class='Operator'>= </span><span class='Boolean'>TRUE</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *cp &raquo; </span> 
 
    <a href="numeric.c.html#LN5454"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* trailing padding for digit alignment later */ 
</span>    memset<span class='Parentheses'>(</span><a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Handle exponent, if any */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>== </span><span class='String'>'e'</span> <span class='Operator'>|| *</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>== </span><span class='String'>'E'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5527"></a>        <span class='Keyword'>long</span>        <span class='Declare_Local'>exponent</span><span class='Delimiter'>; 
</span><a name="LN5528"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5527"><span class='Ref_To_Local'>exponent</span></a> <span class='Operator'>= </span>strtol<span class='Parentheses'>(</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN5528"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5528"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s: \"%s\""</span><span class='Delimiter'>, 
</span>                            <span class='String'>"numeric"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5528"><span class='Ref_To_Local'>endptr</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * At this point, dweight and dscale can't be more than about 
         * INT_MAX/2 due to the MaxAllocSize limit on string length, so 
         * constraining the exponent similarly should be enough to prevent 
         * integer overflow in this function.  If the value is too large to 
         * fit in storage format, make_result() will complain about it later; 
         * for consistency use the same ereport errcode/text as make_result(). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5527"><span class='Ref_To_Local'>exponent</span></a> <span class='Operator'>&GT;= </span>INT_MAX <span class='Operator'>/ </span><span class='Number'>2</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN5527"><span class='Ref_To_Local'>exponent</span></a> <span class='Operator'>&LT;= -</span><span class='Parentheses'>(</span>INT_MAX <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value overflows numeric format"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5453"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN5527"><span class='Ref_To_Local'>exponent</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5455"><span class='Ref_To_Local'>dscale</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN5527"><span class='Ref_To_Local'>exponent</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5455"><span class='Ref_To_Local'>dscale</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN5455"><span class='Ref_To_Local'>dscale</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *cp=='e'||*cp=='E' &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Okay, convert pure-decimal representation to base NBASE.  First we need 
     * to determine the converted weight and ndigits.  offset is the number of 
     * decimal zeroes to insert before the first given digit to have a 
     * correctly aligned first NBASE digit. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5453"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN5456"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5453"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN5456"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Operator'>-</span><a href="numeric.c.html#LN5453"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5458"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5456"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5453"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5457"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5454"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN5458"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN112"><span class='Ref_to_Func'>alloc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5457"><span class='Ref_To_Local'>ndigits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5452"><span class='Ref_To_Local'>sign</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5456"><span class='Ref_To_Local'>weight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5455"><span class='Ref_To_Local'>dscale</span></a><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN5458"><span class='Ref_To_Local'>offset</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5459"><span class='Ref_To_Local'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5457"><span class='Ref_To_Local'>ndigits</span></a><span class='Operator'>-- &GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
        <span class='Operator'>*</span><a href="numeric.c.html#LN5459"><span class='Ref_To_Local'>digits</span></a><span class='Operator'>++ = </span><span class='Parentheses'>((</span><a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>* </span><span class='Number'>10</span> <span class='Operator'>+ </span><a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>10</span> <span class='Operator'>+ 
</span>                     <a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>10</span> <span class='Operator'>+ </span><a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
        <span class='Operator'>*</span><a href="numeric.c.html#LN5459"><span class='Ref_To_Local'>digits</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>* </span><span class='Number'>10</span> <span class='Operator'>+ </span><a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
        <span class='Operator'>*</span><a href="numeric.c.html#LN5459"><span class='Ref_To_Local'>digits</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><span class='Directive'>#else</span> 
#error unsupported <a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> 
<span class='Directive'>#endif</span> 
        <a href="numeric.c.html#LN5450"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5451"><span class='Ref_To_Local'>decdigits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Strip any leading/trailing zeroes, and normalize weight if zero */ 
</span>    <a href="numeric.c.html#LN531"><span class='Ref_to_Proto'>strip_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>dest</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return end+1 position for caller */ 
</span>    <span class='Control'>return</span> <a href="numeric.c.html#LN5447"><span class='Ref_to_Parameter'>cp</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end set_var_from_str &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * set_var_from_num() - 
 * 
 *  Convert the packed db format into a variable 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5609"></a><span class='Declare_Function'>set_var_from_num</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5611"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5611"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN112"><span class='Ref_to_Func'>alloc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5611"><span class='Ref_To_Local'>ndigits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN213"><span class='Ref_to_Macro'>NUMERIC_WEIGHT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN205"><span class='Ref_to_Macro'>NUMERIC_SIGN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN209"><span class='Ref_to_Macro'>NUMERIC_DSCALE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN452"><span class='Ref_to_Macro'>NUMERIC_DIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5609"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5611"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * init_var_from_num() - 
 * 
 *  Initialize a variable from packed db format. The digits array is not 
 *  copied, which saves some cycles when the resulting var is not modified. 
 *  Also, there's no need to call free_var(), as long as you don't assign any 
 *  other value to it (with set_var_* functions, or by using the var as the 
 *  destination of a function like add_var()) 
 * 
 *  CAUTION: Do not modify the digits buffer of a var initialized with this 
 *  function, e.g by calling round_var() or trunc_var(), as the changes will 
 *  propagate to the original Numeric! It's OK to use it as the destination 
 *  argument of one of the calculational functions, though. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5640"></a><span class='Declare_Function'>init_var_from_num</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN213"><span class='Ref_to_Macro'>NUMERIC_WEIGHT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN205"><span class='Ref_to_Macro'>NUMERIC_SIGN</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN209"><span class='Ref_to_Macro'>NUMERIC_DSCALE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN452"><span class='Ref_to_Macro'>NUMERIC_DIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5640"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* digits array is not palloc'd */ 
</span><span class='Delimiter'>} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * set_var_from_var() - 
 * 
 *  Copy one variable into another 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5657"></a><span class='Declare_Function'>set_var_from_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dest</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5659"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newbuf</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5659"><span class='Ref_To_Local'>newbuf</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN15"><span class='Ref_to_Macro'>digitbuf_alloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5659"><span class='Ref_To_Local'>newbuf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>              <span class='Comment_Single_Line'>/* spare digit for rounding */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* else value-&GT;digits might be null */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN5659"><span class='Ref_To_Local'>newbuf</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>, 
</span>               <span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN16"><span class='Ref_to_Macro'>digitbuf_free</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5657"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5657"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5657"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5659"><span class='Ref_To_Local'>newbuf</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5657"><span class='Ref_to_Parameter'>dest</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5659"><span class='Ref_To_Local'>newbuf</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_str_from_var() - 
 * 
 *  Convert a var to text representation (guts of numeric_out). 
 *  The var is displayed to the number of digits indicated by its dscale. 
 *  Returns a palloc'd string. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN5683"></a><span class='Declare_Function'>get_str_from_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5685"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dscale</span><span class='Delimiter'>; 
</span><a name="LN5686"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN5687"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN5688"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endcp</span><span class='Delimiter'>; 
</span><a name="LN5689"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN5690"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>d</span><span class='Delimiter'>; 
</span><a name="LN5691"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Local'>dig</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span> 
<a name="LN5694"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Local'>d1</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="numeric.c.html#LN5685"><span class='Ref_To_Local'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate space for the result. 
     * 
     * i is set to the # of decimal digits before decimal point. dscale is the 
     * # of decimal digits we will print after decimal point. We may generate 
     * as many as DEC_DIGITS-1 excess digits at the end, and in addition we 
     * need room for sign, decimal point, null terminator. 
     */ 
</span>    <a href="numeric.c.html#LN5689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN5689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN5686"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN5685"><span class='Ref_To_Local'>dscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5686"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Output a dash for negative values 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'-'</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Output all digits before the decimal point 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* In the first digit, suppress extra leading decimal zeroes */ 
</span><span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
            <span class='Delimiter'>{ 
</span><a name="LN5736"></a>                <span class='Keyword'>bool</span>        <span class='Declare_Local'>putit</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN5736"><span class='Ref_To_Local'>putit</span></a> <span class='Operator'>|= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5736"><span class='Ref_To_Local'>putit</span></a><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>* </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN5736"><span class='Ref_To_Local'>putit</span></a> <span class='Operator'>|= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5736"><span class='Ref_To_Local'>putit</span></a><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN5736"><span class='Ref_To_Local'>putit</span></a> <span class='Operator'>|= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5736"><span class='Ref_To_Local'>putit</span></a><span class='Parentheses'>) 
</span>                    <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
            <a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
            <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
#error unsupported <a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> 
<span class='Directive'>#endif</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for d=0;d&LT;=var-&GT;weight;d+... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If requested, output a decimal point and all the digits that follow it. 
     * We initially put out a multiple of DEC_DIGITS digits, then truncate if 
     * needed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5685"><span class='Ref_To_Local'>dscale</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5688"><span class='Ref_To_Local'>endcp</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN5685"><span class='Ref_To_Local'>dscale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN5689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN5685"><span class='Ref_To_Local'>dscale</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5689"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="numeric.c.html#LN5683"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5690"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>] </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
            <a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>* </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
            <a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5694"><span class='Ref_To_Local'>d1</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
            <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++ = </span><a href="numeric.c.html#LN5691"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>+ </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
#error unsupported <a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> 
<span class='Directive'>#endif</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;dscale;d++,i+=D... &raquo; </span> 
        <a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5688"><span class='Ref_To_Local'>endcp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if dscale&GT;0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * terminate the string and return it 
     */ 
</span>    <span class='Operator'>*</span><a href="numeric.c.html#LN5687"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="numeric.c.html#LN5686"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_str_from_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * get_str_from_var_sci() - 
 * 
 *  Convert a var to a normalised scientific notation text representation. 
 *  This function does the heavy lifting for numeric_out_sci(). 
 * 
 *  This notation has the general form a * 10^b, where a is known as the 
 *  "significand" and b is known as the "exponent". 
 * 
 *  Because we can't do superscript in ASCII (and because we want to copy 
 *  printf's behaviour) we display the exponent using E notation, with a 
 *  minimum of two exponent digits. 
 * 
 *  For example, the value 1234 could be output as 1.2e+03. 
 * 
 *  We assume that the exponent can fit into an int32. 
 * 
 *  rscale is the number of decimal digits desired after the decimal point in 
 *  the output, negative values will be treated as meaning zero. 
 * 
 *  Returns a palloc'd string. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN5836"></a><span class='Declare_Function'>get_str_from_var_sci</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5838"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>exponent</span><span class='Delimiter'>; 
</span><a name="LN5839"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>denominator</span><span class='Delimiter'>; 
</span><a name="LN5840"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>significand</span><span class='Delimiter'>; 
</span><a name="LN5841"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>denom_scale</span><span class='Delimiter'>; 
</span><a name="LN5842"></a>    size_t      <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN5843"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN5844"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sig_out</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5836"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN5836"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the exponent of this number in normalised form. 
     * 
     * This is the exponent required to represent the number with only one 
     * significant digit before the decimal place. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5836"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN5838"><span class='Ref_To_Local'>exponent</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5836"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Compensate for leading decimal zeroes in the first numeric digit by 
         * decrementing the exponent. 
         */ 
</span>        <a href="numeric.c.html#LN5838"><span class='Ref_To_Local'>exponent</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>log10<span class='Parentheses'>(</span><a href="numeric.c.html#LN5836"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If var has no digits, then it must be zero. 
         * 
         * Zero doesn't technically have a meaningful exponent in normalised 
         * notation, but we just display the exponent as zero for consistency 
         * of output. 
         */ 
</span>        <a href="numeric.c.html#LN5838"><span class='Ref_To_Local'>exponent</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The denominator is set to 10 raised to the power of the exponent. 
     * 
     * We then divide var by the denominator to get the significand, rounding 
     * to rscale decimal digits in the process. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5838"><span class='Ref_To_Local'>exponent</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN5841"><span class='Ref_To_Local'>denom_scale</span></a> <span class='Operator'>= -</span><a href="numeric.c.html#LN5838"><span class='Ref_To_Local'>exponent</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN5841"><span class='Ref_To_Local'>denom_scale</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN5839"><span class='Ref_To_Local'>denominator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN5840"><span class='Ref_To_Local'>significand</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN519"><span class='Ref_to_Proto'>power_var_int</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN383"><span class='Ref_to_Global_Var'>const_ten</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5838"><span class='Ref_To_Local'>exponent</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN5839"><span class='Ref_To_Local'>denominator</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5841"><span class='Ref_To_Local'>denom_scale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN504"><span class='Ref_to_Proto'>div_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5836"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN5839"><span class='Ref_To_Local'>denominator</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN5840"><span class='Ref_To_Local'>significand</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5836"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5844"><span class='Ref_To_Local'>sig_out</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN309"><span class='Ref_to_Func'>get_str_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN5840"><span class='Ref_To_Local'>significand</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN5839"><span class='Ref_To_Local'>denominator</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN5840"><span class='Ref_To_Local'>significand</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate space for the result. 
     * 
     * In addition to the significand, we need room for the exponent 
     * decoration ("e"), the sign of the exponent, up to 10 digits for the 
     * exponent itself, and of course the null terminator. 
     */ 
</span>    <a href="numeric.c.html#LN5842"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="numeric.c.html#LN5844"><span class='Ref_To_Local'>sig_out</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>13</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN5843"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5842"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5843"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5842"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='String'>"%se%+03d"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5844"><span class='Ref_To_Local'>sig_out</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5838"><span class='Ref_To_Local'>exponent</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5844"><span class='Ref_To_Local'>sig_out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN5843"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_str_from_var_sci &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * make_result() - 
 * 
 *  Create the packed db numeric format in palloc()'d memory from 
 *  a variable. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> 
<a name="LN5922"></a><span class='Declare_Function'>make_result</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5924"></a>    <a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a>     <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5925"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN5922"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span><a name="LN5926"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight</span> <span class='Operator'>= </span><a href="numeric.c.html#LN5922"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span><a name="LN5927"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sign</span> <span class='Operator'>= </span><a href="numeric.c.html#LN5922"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a><span class='Delimiter'>; 
</span><a name="LN5928"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span><a name="LN5929"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5927"><span class='Ref_To_Local'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN5"><span class='Ref_to_Const'>NUMERIC_NAN</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN173"><span class='Ref_to_Const'>NUMERIC_HDRSZ_SHORT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN173"><span class='Ref_to_Const'>NUMERIC_HDRSZ_SHORT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN146"><span class='Ref_to_Member'>n_header</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN5"><span class='Ref_to_Const'>NUMERIC_NAN</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* the header word is all we need */ 
</span> 
        <a href="numeric.c.html#LN435"><span class='Ref_to_Proto'>dump_numeric</span></a><span class='Parentheses'>(</span><span class='String'>"make_result()"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5922"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* truncate leading zeroes */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& *</span><a href="numeric.c.html#LN5925"><span class='Ref_To_Local'>digits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN5925"><span class='Ref_To_Local'>digits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5926"><span class='Ref_To_Local'>weight</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* truncate trailing zeroes */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN5925"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If zero result, force to weight=0 and positive sign */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN5926"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5927"><span class='Ref_To_Local'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Build the result */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN456"><span class='Ref_to_Macro'>NUMERIC_CAN_BE_SHORT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5922"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5926"><span class='Ref_To_Local'>weight</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN5929"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN173"><span class='Ref_to_Const'>NUMERIC_HDRSZ_SHORT</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5929"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5929"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN148"><span class='Ref_to_Member'>n_short</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN133"><span class='Ref_to_Member'>n_header</span></a> <span class='Operator'>= 
</span>            <span class='Parentheses'>(</span><a href="numeric.c.html#LN5927"><span class='Ref_To_Local'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN165"><span class='Ref_to_Const'>NUMERIC_SHORT</span></a> <span class='Operator'>| </span><a href="numeric.c.html#LN189"><span class='Ref_to_Const'>NUMERIC_SHORT_SIGN_MASK</span></a><span class='Parentheses'>) 
</span>             <span class='Operator'>: </span><a href="numeric.c.html#LN165"><span class='Ref_to_Const'>NUMERIC_SHORT</span></a><span class='Parentheses'>)</span> 
            <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5922"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>&LT;&LT; </span><a href="numeric.c.html#LN191"><span class='Ref_to_Const'>NUMERIC_SHORT_DSCALE_SHIFT</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5926"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>? </span><a href="numeric.c.html#LN194"><span class='Ref_to_Const'>NUMERIC_SHORT_WEIGHT_SIGN_MASK</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5926"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>& </span><a href="numeric.c.html#LN195"><span class='Ref_to_Const'>NUMERIC_SHORT_WEIGHT_MASK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN5929"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN172"><span class='Ref_to_Const'>NUMERIC_HDRSZ</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5929"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5929"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN147"><span class='Ref_to_Member'>n_long</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN139"><span class='Ref_to_Member'>n_sign_dscale</span></a> <span class='Operator'>= 
</span>            <a href="numeric.c.html#LN5927"><span class='Ref_To_Local'>sign</span></a> <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN5922"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>& </span><a href="numeric.c.html#LN203"><span class='Ref_to_Const'>NUMERIC_DSCALE_MASK</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN154"><span class='Ref_to_Member'>choice</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN147"><span class='Ref_to_Member'>n_long</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN140"><span class='Ref_to_Member'>n_weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN5926"><span class='Ref_To_Local'>weight</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN454"><span class='Ref_to_Macro'>NUMERIC_NDIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN452"><span class='Ref_to_Macro'>NUMERIC_DIGITS</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5925"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN5928"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for overflow of int16 fields */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN213"><span class='Ref_to_Macro'>NUMERIC_WEIGHT</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="numeric.c.html#LN5926"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>|| 
</span>        <a href="numeric.c.html#LN209"><span class='Ref_to_Macro'>NUMERIC_DSCALE</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="numeric.c.html#LN5922"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value overflows numeric format"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN435"><span class='Ref_to_Proto'>dump_numeric</span></a><span class='Parentheses'>(</span><span class='String'>"make_result()"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="numeric.c.html#LN5924"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_result &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * apply_typmod() - 
 * 
 *  Do bounds checking and rounding according to the attributes 
 *  typmod field. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6009"></a><span class='Declare_Function'>apply_typmod</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6011"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>precision</span><span class='Delimiter'>; 
</span><a name="LN6012"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>scale</span><span class='Delimiter'>; 
</span><a name="LN6013"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxdigits</span><span class='Delimiter'>; 
</span><a name="LN6014"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ddigits</span><span class='Delimiter'>; 
</span><a name="LN6015"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do nothing if we have a default typmod (-1) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6009"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN6009"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>-= </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6011"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6009"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>16</span><span class='Parentheses'>) </span><span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6012"><span class='Ref_To_Local'>scale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6009"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6013"><span class='Ref_To_Local'>maxdigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6011"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN6012"><span class='Ref_To_Local'>scale</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Round to target scale (and set var-&GT;dscale) */ 
</span>    <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6009"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6012"><span class='Ref_To_Local'>scale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for overflow - note we can't do this before rounding, because 
     * rounding could raise the weight.  Also note that the var's weight could 
     * be inflated by leading zeroes, which will be stripped before storage 
     * but perhaps might not have been yet. In any case, we must recognize a 
     * true zero, whose weight doesn't mean anything. 
     */ 
</span>    <a href="numeric.c.html#LN6014"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6009"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6014"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN6013"><span class='Ref_To_Local'>maxdigits</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Determine true weight; and check for all-zero result */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6015"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6015"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN6009"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN6015"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN6042"></a>            <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Local'>dig</span> <span class='Operator'>= </span><a href="numeric.c.html#LN6009"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6015"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6042"><span class='Ref_To_Local'>dig</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Adjust for any high-order decimal zero digits */ 
</span><span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6042"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>&LT; </span><span class='Number'>10</span><span class='Parentheses'>) 
</span>                    <a href="numeric.c.html#LN6014"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>-= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6042"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>&LT; </span><span class='Number'>100</span><span class='Parentheses'>) 
</span>                    <a href="numeric.c.html#LN6014"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>-= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6042"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>&LT; </span><span class='Number'>1000</span><span class='Parentheses'>) 
</span>                    <a href="numeric.c.html#LN6014"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>-= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6042"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>&LT; </span><span class='Number'>10</span><span class='Parentheses'>) 
</span>                    <a href="numeric.c.html#LN6014"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>-= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
                <span class='Comment_Multi_Line'>/* no adjustment */ 
</span><span class='Directive'>#else</span> 
#error unsupported <a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> 
<span class='Directive'>#endif</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6014"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN6013"><span class='Ref_To_Local'>maxdigits</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"numeric field overflow"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"A field with precision %d, scale %d must round to an absolute value less than %s%d."</span><span class='Delimiter'>, 
</span>                                       <a href="numeric.c.html#LN6011"><span class='Ref_To_Local'>precision</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6012"><span class='Ref_To_Local'>scale</span></a><span class='Delimiter'>, 
</span>                    <span class='Comment_Multi_Line'>/* Display 10^0 as 1 */ 
</span>                                       <a href="numeric.c.html#LN6013"><span class='Ref_To_Local'>maxdigits</span></a> <span class='Operator'>? </span><span class='String'>"10^"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Delimiter'>, 
</span>                                       <a href="numeric.c.html#LN6013"><span class='Ref_To_Local'>maxdigits</span></a> <span class='Operator'>? </span><a href="numeric.c.html#LN6013"><span class='Ref_To_Local'>maxdigits</span></a> <span class='Operator'>: </span><span class='Number'>1</span> 
                                       <span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if dig &raquo; </span> 
            <a href="numeric.c.html#LN6014"><span class='Ref_To_Local'>ddigits</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;var-&GT;ndigits;i+... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ddigits&GT;maxdigits &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end apply_typmod &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert numeric to int8, rounding if needed. 
 * 
 * If overflow, return FALSE (no error is raised).  Return TRUE if okay. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN6085"></a><span class='Declare_Function'>numericvar_to_int64</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6087"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>digits</span><span class='Delimiter'>; 
</span><a name="LN6088"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span><a name="LN6089"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight</span><span class='Delimiter'>; 
</span><a name="LN6090"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN6091"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>val</span><span class='Delimiter'>, 
</span><a name="LN6092"></a>                <span class='Declare_Local'>oldval</span><span class='Delimiter'>; 
</span><a name="LN6093"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>neg</span><span class='Delimiter'>; 
</span><a name="LN6094"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>rounded</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Round to nearest integer */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6085"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for zero input */ 
</span>    <a href="numeric.c.html#LN531"><span class='Ref_to_Proto'>strip_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6088"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6088"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="numeric.c.html#LN6085"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For input like 10000000000, we must treat stripped digits as real. So 
     * the loop assumes there are weight+1 digits before the decimal point. 
     */ 
</span>    <a href="numeric.c.html#LN6089"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6089"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN6088"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN6089"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Construct the result */ 
</span>    <a href="numeric.c.html#LN6087"><span class='Ref_To_Local'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6093"><span class='Ref_To_Local'>neg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6087"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6090"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6090"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN6089"><span class='Ref_To_Local'>weight</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN6090"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6092"><span class='Ref_To_Local'>oldval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>*= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6090"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN6088"><span class='Ref_To_Local'>ndigits</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN6087"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6090"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The overflow check is a bit tricky because we want to accept 
         * INT64_MIN, which will overflow the positive accumulator.  We can 
         * detect this case easily though because INT64_MIN is the only 
         * nonzero value for which -val == val (on a two's complement machine, 
         * anyway). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="numeric.c.html#LN6092"><span class='Ref_To_Local'>oldval</span></a><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* possible overflow? */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN6093"><span class='Ref_To_Local'>neg</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>-</span><a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>|| </span><a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN6092"><span class='Ref_To_Local'>oldval</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=weight;i++ &raquo; </span> 
 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6094"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="numeric.c.html#LN6085"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6093"><span class='Ref_To_Local'>neg</span></a> <span class='Operator'>? -</span><a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>: </span><a href="numeric.c.html#LN6091"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numericvar_to_int64 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert int8 value to numeric. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6156"></a><span class='Declare_Function'>int64_to_numericvar</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6158"></a>    <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>uval</span><span class='Delimiter'>, 
</span><a name="LN6159"></a>                <span class='Declare_Local'>newuval</span><span class='Delimiter'>; 
</span><a name="LN6160"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN6161"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* int64 can require at most 19 decimal digits; add one for safety */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN112"><span class='Ref_to_Func'>alloc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Number'>20</span> <span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6158"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>= -</span><a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6158"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="numeric.c.html#LN6160"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6161"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6160"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6161"><span class='Ref_To_Local'>ndigits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6159"><span class='Ref_To_Local'>newuval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6158"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="numeric.c.html#LN6160"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6158"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN6159"><span class='Ref_To_Local'>newuval</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6158"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6159"><span class='Ref_To_Local'>newuval</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6158"><span class='Ref_To_Local'>uval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6160"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6161"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6156"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6161"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int64_to_numericvar &raquo; </span> 
 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN323"><span class='Ref_to_Const'>HAVE_INT128</span></a> 
<span class='Comment_Multi_Line'>/* 
 * Convert numeric to int128, rounding if needed. 
 * 
 * If overflow, return FALSE (no error is raised).  Return TRUE if okay. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN6204"></a><span class='Declare_Function'>numericvar_to_int128</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6206"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>digits</span><span class='Delimiter'>; 
</span><a name="LN6207"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span><a name="LN6208"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight</span><span class='Delimiter'>; 
</span><a name="LN6209"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN6210"></a>    <a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a>      <span class='Declare_Local'>val</span><span class='Delimiter'>, 
</span><a name="LN6211"></a>                <span class='Declare_Local'>oldval</span><span class='Delimiter'>; 
</span><a name="LN6212"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>neg</span><span class='Delimiter'>; 
</span><a name="LN6213"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>rounded</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Round to nearest integer */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6204"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check for zero input */ 
</span>    <a href="numeric.c.html#LN531"><span class='Ref_to_Proto'>strip_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6207"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6207"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="numeric.c.html#LN6204"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For input like 10000000000, we must treat stripped digits as real. So 
     * the loop assumes there are weight+1 digits before the decimal point. 
     */ 
</span>    <a href="numeric.c.html#LN6208"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6208"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN6207"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN6208"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Construct the result */ 
</span>    <a href="numeric.c.html#LN6206"><span class='Ref_To_Local'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6212"><span class='Ref_To_Local'>neg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6206"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6209"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6209"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN6208"><span class='Ref_To_Local'>weight</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN6209"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6211"><span class='Ref_To_Local'>oldval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>*= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6209"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN6207"><span class='Ref_To_Local'>ndigits</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN6206"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6209"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The overflow check is a bit tricky because we want to accept 
         * INT128_MIN, which will overflow the positive accumulator.  We can 
         * detect this case easily though because INT128_MIN is the only 
         * nonzero value for which -val == val (on a two's complement machine, 
         * anyway). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="numeric.c.html#LN6211"><span class='Ref_To_Local'>oldval</span></a><span class='Parentheses'>)</span>    <span class='Comment_Single_Line'>/* possible overflow? */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN6212"><span class='Ref_To_Local'>neg</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>-</span><a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>|| </span><a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN6211"><span class='Ref_To_Local'>oldval</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=weight;i++ &raquo; </span> 
 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN6213"><span class='Ref_To_Local'>rounded</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="numeric.c.html#LN6204"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6212"><span class='Ref_To_Local'>neg</span></a> <span class='Operator'>? -</span><a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>: </span><a href="numeric.c.html#LN6210"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numericvar_to_int128 &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert 128 bit integer to numeric. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6275"></a><span class='Declare_Function'>int128_to_numericvar</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN324"><span class='Ref_to_Typedef'>int128</span></a> <span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6277"></a>    <a href="../../../include/c.h.html#LN325"><span class='Ref_to_Typedef'>uint128</span></a>     <span class='Declare_Local'>uval</span><span class='Delimiter'>, 
</span><a name="LN6278"></a>                <span class='Declare_Local'>newuval</span><span class='Delimiter'>; 
</span><a name="LN6279"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN6280"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* int128 can require at most 39 decimal digits; add one for safety */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN112"><span class='Ref_to_Func'>alloc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Number'>40</span> <span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6277"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>= -</span><a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6277"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>val</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="numeric.c.html#LN6279"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6280"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6279"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6280"><span class='Ref_To_Local'>ndigits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6278"><span class='Ref_To_Local'>newuval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6277"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="numeric.c.html#LN6279"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6277"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN6278"><span class='Ref_To_Local'>newuval</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6277"><span class='Ref_To_Local'>uval</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6278"><span class='Ref_To_Local'>newuval</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6277"><span class='Ref_To_Local'>uval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6279"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6280"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6275"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6280"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end int128_to_numericvar &raquo; </span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert numeric to float8; if out of range, return +/- HUGE_VAL 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN6321"></a><span class='Declare_Function'>numeric_to_double_no_overflow</span><span class='Parentheses'>(</span><a href="../../../include/utils/numeric.h.html#LN42"><span class='Ref_to_Typedef'>Numeric</span></a> <span class='Declare_Parameter'>num</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6323"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN6324"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN6325"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN6323"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN639"><span class='Ref_to_Func'>numeric_out</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/numeric.h.html#LN50"><span class='Ref_to_Macro'>NumericGetDatum</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6321"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* unlike float8in, we ignore ERANGE from strtod */ 
</span>    <a href="numeric.c.html#LN6324"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="numeric.c.html#LN6323"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN6325"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN6325"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* shouldn't happen ... */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s: \"%s\""</span><span class='Delimiter'>, 
</span>                        <span class='String'>"double precision"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN6323"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6323"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN6324"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numeric_to_double_no_overflow &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* As above, but work from a NumericVar */ 
</span><span class='Keyword'>static double 
</span><a name="LN6348"></a><span class='Declare_Function'>numericvar_to_double_no_overflow</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6350"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span><a name="LN6351"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN6352"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endptr</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN6350"><span class='Ref_To_Local'>tmp</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN309"><span class='Ref_to_Func'>get_str_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6348"><span class='Ref_to_Parameter'>var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* unlike float8in, we ignore ERANGE from strtod */ 
</span>    <a href="numeric.c.html#LN6351"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span>strtod<span class='Parentheses'>(</span><a href="numeric.c.html#LN6350"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN6352"><span class='Ref_To_Local'>endptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="numeric.c.html#LN6352"><span class='Ref_To_Local'>endptr</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* shouldn't happen ... */ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s: \"%s\""</span><span class='Delimiter'>, 
</span>                        <span class='String'>"double precision"</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN6350"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6350"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN6351"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end numericvar_to_double_no_overflow &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * cmp_var() - 
 * 
 *  Compare two values on variable level.  We assume zeroes have been 
 *  truncated to no digits. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN6380"></a><span class='Declare_Function'>cmp_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="numeric.c.html#LN496"><span class='Ref_to_Proto'>cmp_var_common</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6380"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6380"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>, 
</span>                          <a href="numeric.c.html#LN6380"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6380"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a><span class='Delimiter'>, 
</span>                          <a href="numeric.c.html#LN6380"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6380"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>, 
</span>                          <a href="numeric.c.html#LN6380"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6380"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * cmp_var_common() - 
 * 
 *  Main routine of cmp_var(). This function can be used by both 
 *  NumericVar and Numeric. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN6395"></a><span class='Declare_Function'>cmp_var_common</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1digits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var1ndigits</span><span class='Delimiter'>, 
</span><a name="LN6396"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>var1weight</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var1sign</span><span class='Delimiter'>, 
</span><a name="LN6397"></a>               <span class='Keyword'>const </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2digits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var2ndigits</span><span class='Delimiter'>, 
</span><a name="LN6398"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>var2weight</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var2sign</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6395"><span class='Ref_to_Parameter'>var1ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6397"><span class='Ref_to_Parameter'>var2ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6398"><span class='Ref_to_Parameter'>var2sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6397"><span class='Ref_to_Parameter'>var2ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6396"><span class='Ref_to_Parameter'>var1sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6396"><span class='Ref_to_Parameter'>var1sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6398"><span class='Ref_to_Parameter'>var2sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="numeric.c.html#LN523"><span class='Ref_to_Proto'>cmp_abs_common</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6395"><span class='Ref_to_Parameter'>var1digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6395"><span class='Ref_to_Parameter'>var1ndigits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6396"><span class='Ref_to_Parameter'>var1weight</span></a><span class='Delimiter'>, 
</span>                              <a href="numeric.c.html#LN6397"><span class='Ref_to_Parameter'>var2digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6397"><span class='Ref_to_Parameter'>var2ndigits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6398"><span class='Ref_to_Parameter'>var2weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6398"><span class='Ref_to_Parameter'>var2sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN523"><span class='Ref_to_Proto'>cmp_abs_common</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6397"><span class='Ref_to_Parameter'>var2digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6397"><span class='Ref_to_Parameter'>var2ndigits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6398"><span class='Ref_to_Parameter'>var2weight</span></a><span class='Delimiter'>, 
</span>                          <a href="numeric.c.html#LN6395"><span class='Ref_to_Parameter'>var1digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6395"><span class='Ref_to_Parameter'>var1ndigits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6396"><span class='Ref_to_Parameter'>var1weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end cmp_var_common &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * add_var() - 
 * 
 *  Full version of add functionality on variable level (handling signs). 
 *  result might point to one of the operands too without danger. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6438"></a><span class='Declare_Function'>add_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Decide on the signs of the two variables what to do 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Both are positive result = +(ABS(var1) + ABS(var2)) 
             */ 
</span>            <a href="numeric.c.html#LN527"><span class='Ref_to_Proto'>add_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * var1 is positive, var2 is negative Must compare absolute values 
             */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN490"><span class='Ref_to_Func'>cmp_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) == ABS(var2) 
                     * result = ZERO 
                     * ---------- 
                     */ 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) &GT; ABS(var2) 
                     * result = +(ABS(var1) - ABS(var2)) 
                     * ---------- 
                     */ 
</span>                    <a href="numeric.c.html#LN528"><span class='Ref_to_Proto'>sub_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) &LT; ABS(var2) 
                     * result = -(ABS(var2) - ABS(var1)) 
                     * ---------- 
                     */ 
</span>                    <a href="numeric.c.html#LN528"><span class='Ref_to_Proto'>sub_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cmp_abs(var1,var2) &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var1-&GT;sign==NUMERIC_P... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ---------- 
             * var1 is negative, var2 is positive 
             * Must compare absolute values 
             * ---------- 
             */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN490"><span class='Ref_to_Func'>cmp_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) == ABS(var2) 
                     * result = ZERO 
                     * ---------- 
                     */ 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) &GT; ABS(var2) 
                     * result = -(ABS(var1) - ABS(var2)) 
                     * ---------- 
                     */ 
</span>                    <a href="numeric.c.html#LN528"><span class='Ref_to_Proto'>sub_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) &LT; ABS(var2) 
                     * result = +(ABS(var2) - ABS(var1)) 
                     * ---------- 
                     */ 
</span>                    <a href="numeric.c.html#LN528"><span class='Ref_to_Proto'>sub_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cmp_abs(var1,var2) &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var2-&GT;sign==NUMERIC_P... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ---------- 
             * Both are negative 
             * result = -(ABS(var1) + ABS(var2)) 
             * ---------- 
             */ 
</span>            <a href="numeric.c.html#LN527"><span class='Ref_to_Proto'>add_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN6438"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end add_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * sub_var() - 
 * 
 *  Full version of sub functionality on variable level (handling signs). 
 *  result might point to one of the operands too without danger. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6555"></a><span class='Declare_Function'>sub_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Decide on the signs of the two variables what to do 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ---------- 
             * var1 is positive, var2 is negative 
             * result = +(ABS(var1) + ABS(var2)) 
             * ---------- 
             */ 
</span>            <a href="numeric.c.html#LN527"><span class='Ref_to_Proto'>add_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ---------- 
             * Both are positive 
             * Must compare absolute values 
             * ---------- 
             */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN490"><span class='Ref_to_Func'>cmp_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) == ABS(var2) 
                     * result = ZERO 
                     * ---------- 
                     */ 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) &GT; ABS(var2) 
                     * result = +(ABS(var1) - ABS(var2)) 
                     * ---------- 
                     */ 
</span>                    <a href="numeric.c.html#LN528"><span class='Ref_to_Proto'>sub_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) &LT; ABS(var2) 
                     * result = -(ABS(var2) - ABS(var1)) 
                     * ---------- 
                     */ 
</span>                    <a href="numeric.c.html#LN528"><span class='Ref_to_Proto'>sub_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cmp_abs(var1,var2) &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var1-&GT;sign==NUMERIC_P... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ---------- 
             * Both are negative 
             * Must compare absolute values 
             * ---------- 
             */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN490"><span class='Ref_to_Func'>cmp_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) == ABS(var2) 
                     * result = ZERO 
                     * ---------- 
                     */ 
</span>                    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) &GT; ABS(var2) 
                     * result = -(ABS(var1) - ABS(var2)) 
                     * ---------- 
                     */ 
</span>                    <a href="numeric.c.html#LN528"><span class='Ref_to_Proto'>sub_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* ---------- 
                     * ABS(var1) &LT; ABS(var2) 
                     * result = +(ABS(var2) - ABS(var1)) 
                     * ---------- 
                     */ 
</span>                    <a href="numeric.c.html#LN528"><span class='Ref_to_Proto'>sub_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cmp_abs(var1,var2) &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var2-&GT;sign==NUMERIC_N... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* ---------- 
             * var1 is negative, var2 is positive 
             * result = -(ABS(var1) + ABS(var2)) 
             * ---------- 
             */ 
</span>            <a href="numeric.c.html#LN527"><span class='Ref_to_Proto'>add_abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN6555"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end sub_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * mul_var() - 
 * 
 *  Multiplication on variable level. Product of var1 * var2 is stored 
 *  in result.  Result is rounded to no more than rscale fractional digits. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6676"></a><span class='Declare_Function'>mul_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN6677"></a>        <span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6679"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_ndigits</span><span class='Delimiter'>; 
</span><a name="LN6680"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_sign</span><span class='Delimiter'>; 
</span><a name="LN6681"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_weight</span><span class='Delimiter'>; 
</span><a name="LN6682"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxdigits</span><span class='Delimiter'>; 
</span><a name="LN6683"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dig</span><span class='Delimiter'>; 
</span><a name="LN6684"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>carry</span><span class='Delimiter'>; 
</span><a name="LN6685"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxdig</span><span class='Delimiter'>; 
</span><a name="LN6686"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newdig</span><span class='Delimiter'>; 
</span><a name="LN6687"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var1ndigits</span><span class='Delimiter'>; 
</span><a name="LN6688"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var2ndigits</span><span class='Delimiter'>; 
</span><a name="LN6689"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var1digits</span><span class='Delimiter'>; 
</span><a name="LN6690"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var2digits</span><span class='Delimiter'>; 
</span><a name="LN6691"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res_digits</span><span class='Delimiter'>; 
</span><a name="LN6692"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN6693"></a>                <span class='Declare_Local'>i1</span><span class='Delimiter'>, 
</span><a name="LN6694"></a>                <span class='Declare_Local'>i2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Arrange for var1 to be the shorter of the two numbers.  This improves 
     * performance because the inner multiplication loop is much simpler than 
     * the outer loop, so it's better to have a smaller number of iterations 
     * of the outer loop.  This also reduces the number of times that the 
     * accumulator array needs to be normalized. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN6705"></a>        <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tmp</span> <span class='Operator'>= </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6705"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* copy these values into local vars for speed in inner loop */ 
</span>    <a href="numeric.c.html#LN6687"><span class='Ref_To_Local'>var1ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6688"><span class='Ref_To_Local'>var2ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6689"><span class='Ref_To_Local'>var1digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6690"><span class='Ref_To_Local'>var2digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6687"><span class='Ref_To_Local'>var1ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN6688"><span class='Ref_To_Local'>var2ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* one or both inputs is zero; so is result */ 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6677"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Determine result sign and (maximum possible) weight */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN6680"><span class='Ref_To_Local'>res_sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN6680"><span class='Ref_To_Local'>res_sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6681"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the number of result digits to compute.  If the exact result 
     * would have more than rscale fractional digits, truncate the computation 
     * with MUL_GUARD_DIGITS guard digits, i.e., ignore input digits that 
     * would only contribute to the right of that.  (This will give the exact 
     * rounded-to-rscale answer unless carries out of the ignored positions 
     * would have propagated through more than MUL_GUARD_DIGITS digits.) 
     * 
     * Note: an exact computation could not produce more than var1ndigits + 
     * var2ndigits digits, but we allocate one extra output digit in case 
     * rscale-driven rounding produces a carry out of the highest exact digit. 
     */ 
</span>    <a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6687"><span class='Ref_To_Local'>var1ndigits</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6688"><span class='Ref_To_Local'>var2ndigits</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6682"><span class='Ref_To_Local'>maxdigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6681"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6677"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>+ 
</span>        <a href="numeric.c.html#LN95"><span class='Ref_to_Const'>MUL_GUARD_DIGITS</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6682"><span class='Ref_To_Local'>maxdigits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* All input digits will be ignored; so result is zero */ 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6677"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We do the arithmetic in an array "dig[]" of signed int's.  Since 
     * INT_MAX is noticeably larger than NBASE*NBASE, this gives us headroom 
     * to avoid normalizing carries immediately. 
     * 
     * maxdig tracks the maximum possible value of any dig[] entry; when this 
     * threatens to exceed INT_MAX, we take the time to propagate carries. 
     * Furthermore, we need to ensure that overflow doesn't occur during the 
     * carry propagation passes either.  The carry values could be as much as 
     * INT_MAX/NBASE, so really we must normalize when digits threaten to 
     * exceed INT_MAX - INT_MAX/NBASE. 
     * 
     * To avoid overflow in maxdig itself, it actually represents the max 
     * possible value divided by NBASE-1, ie, at the top of the loop it is 
     * known that no dig[] entry exceeds maxdig * (NBASE-1). 
     */ 
</span>    <a href="numeric.c.html#LN6683"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6685"><span class='Ref_To_Local'>maxdig</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The least significant digits of var1 should be ignored if they don't 
     * contribute directly to the first res_ndigits digits of the result that 
     * we are computing. 
     * 
     * Digit i1 of var1 and digit i2 of var2 are multiplied and added to digit 
     * i1+i2+2 of the accumulator array, so we need only consider digits of 
     * var1 for which i1 &LT;= res_ndigits - 3. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6693"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6687"><span class='Ref_To_Local'>var1ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>- </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6693"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6693"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>--</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN6787"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>var1digit</span> <span class='Operator'>= </span><a href="numeric.c.html#LN6689"><span class='Ref_To_Local'>var1digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6693"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6787"><span class='Ref_To_Local'>var1digit</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Time to normalize? */ 
</span>        <a href="numeric.c.html#LN6685"><span class='Ref_To_Local'>maxdig</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN6787"><span class='Ref_To_Local'>var1digit</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6685"><span class='Ref_To_Local'>maxdig</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span>INT_MAX <span class='Operator'>- </span>INT_MAX <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Yes, do it */ 
</span>            <a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6683"><span class='Ref_To_Local'>dig</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN6683"><span class='Ref_To_Local'>dig</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Reset maxdig to indicate new worst-case */ 
</span>            <a href="numeric.c.html#LN6685"><span class='Ref_To_Local'>maxdig</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="numeric.c.html#LN6787"><span class='Ref_To_Local'>var1digit</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if maxdig&GT;(INT_MAX-INT_M... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Add the appropriate multiple of var2 into the accumulator. 
         * 
         * As above, digits of var2 can be ignored if they don't contribute, 
         * so we only include digits for which i1+i2+2 &LT;= res_ndigits - 1. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6694"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6688"><span class='Ref_To_Local'>var2ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN6693"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>- </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6693"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6694"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>             <a href="numeric.c.html#LN6694"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6694"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>--</span><span class='Parentheses'>)</span> 
            <a href="numeric.c.html#LN6683"><span class='Ref_To_Local'>dig</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><a href="numeric.c.html#LN6787"><span class='Ref_To_Local'>var1digit</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN6690"><span class='Ref_To_Local'>var2digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6694"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i1=Min(var1ndigits-1,... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Now we do a final carry propagation pass to normalize the result, which 
     * we combine with storing the result digits into the output. Note that 
     * this is still done at full precision w/guard digits. 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN112"><span class='Ref_to_Func'>alloc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6691"><span class='Ref_To_Local'>res_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6679"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6683"><span class='Ref_To_Local'>dig</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6691"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6692"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN6686"><span class='Ref_To_Local'>newdig</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6684"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6683"><span class='Ref_To_Local'>dig</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally, round the result to the requested precision. 
     */ 
</span>    <a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6681"><span class='Ref_To_Local'>res_weight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6680"><span class='Ref_To_Local'>res_sign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Round to target rscale (and set result-&GT;dscale) */ 
</span>    <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6677"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Strip leading and trailing zeroes */ 
</span>    <a href="numeric.c.html#LN531"><span class='Ref_to_Proto'>strip_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6676"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end mul_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * div_var() - 
 * 
 *  Division on variable level. Quotient of var1 / var2 is stored in result. 
 *  The quotient is figured to exactly rscale fractional digits. 
 *  If round is true, it is rounded at the rscale'th digit; if false, it 
 *  is truncated (towards zero) at that digit. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN6873"></a><span class='Declare_Function'>div_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN6874"></a>        <span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>round</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN6876"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>div_ndigits</span><span class='Delimiter'>; 
</span><a name="LN6877"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_ndigits</span><span class='Delimiter'>; 
</span><a name="LN6878"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_sign</span><span class='Delimiter'>; 
</span><a name="LN6879"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_weight</span><span class='Delimiter'>; 
</span><a name="LN6880"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>carry</span><span class='Delimiter'>; 
</span><a name="LN6881"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>borrow</span><span class='Delimiter'>; 
</span><a name="LN6882"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>divisor1</span><span class='Delimiter'>; 
</span><a name="LN6883"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>divisor2</span><span class='Delimiter'>; 
</span><a name="LN6884"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dividend</span><span class='Delimiter'>; 
</span><a name="LN6885"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>divisor</span><span class='Delimiter'>; 
</span><a name="LN6886"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res_digits</span><span class='Delimiter'>; 
</span><a name="LN6887"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN6888"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy these values into local vars for speed in inner loop */ 
</span><a name="LN6891"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var1ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN6892"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var2ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First of all division by zero check; we must not be handed an 
     * unnormalized divisor. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6892"><span class='Ref_To_Local'>var2ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DIVISION_BY_ZERO<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"division by zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now result zero check 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6891"><span class='Ref_To_Local'>var1ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6874"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the result sign, weight and number of digits to calculate. 
     * The weight figured here is correct if the emitted quotient has no 
     * leading zero digits; otherwise strip_var() will fix things up. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN6878"><span class='Ref_To_Local'>res_sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN6878"><span class='Ref_To_Local'>res_sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6879"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* The number of accurate result digits we need to produce: */ 
</span>    <a href="numeric.c.html#LN6877"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6879"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6874"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* ... but always at least 1 */ 
</span>    <a href="numeric.c.html#LN6877"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6877"><span class='Ref_To_Local'>res_ndigits</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* If rounding needed, figure one more digit to ensure correct result */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6874"><span class='Ref_to_Parameter'>round</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN6877"><span class='Ref_To_Local'>res_ndigits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The working dividend normally requires res_ndigits + var2ndigits 
     * digits, but make it at least var1ndigits so we can load all of var1 
     * into it.  (There will be an additional digit dividend[0] in the 
     * dividend space, but for consistency with Knuth's notation we don't 
     * count that in div_ndigits.) 
     */ 
</span>    <a href="numeric.c.html#LN6876"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6877"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6892"><span class='Ref_To_Local'>var2ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6876"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6876"><span class='Ref_To_Local'>div_ndigits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6891"><span class='Ref_To_Local'>var1ndigits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need a workspace with room for the working dividend (div_ndigits+1 
     * digits) plus room for the possibly-normalized divisor (var2ndigits 
     * digits).  It is convenient also to have a zero at divisor[0] with the 
     * actual divisor data in divisor[1 .. var2ndigits].  Transferring the 
     * digits into the workspace also allows us to realloc the result (which 
     * might be the same as either input var) before we begin the main loop. 
     * Note that we use palloc0 to ensure that divisor[0], dividend[0], and 
     * any additional dividend positions beyond var1ndigits, start out 0. 
     */ 
</span>    <a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>((</span><a href="numeric.c.html#LN6876"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6892"><span class='Ref_To_Local'>var2ndigits</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6876"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6891"><span class='Ref_To_Local'>var1ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6892"><span class='Ref_To_Local'>var2ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can realloc the result to hold the generated quotient digits. 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN112"><span class='Ref_to_Func'>alloc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6877"><span class='Ref_To_Local'>res_ndigits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6886"><span class='Ref_To_Local'>res_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6892"><span class='Ref_To_Local'>var2ndigits</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If there's only a single divisor digit, we can use a fast path (cf. 
         * Knuth section 4.3.1 exercise 16). 
         */ 
</span>        <a href="numeric.c.html#LN6882"><span class='Ref_To_Local'>divisor1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN6877"><span class='Ref_To_Local'>res_ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <a href="numeric.c.html#LN6886"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN6882"><span class='Ref_To_Local'>divisor1</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>% </span><a href="numeric.c.html#LN6882"><span class='Ref_To_Local'>divisor1</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The full multiple-place algorithm is taken from Knuth volume 2, 
         * Algorithm 4.3.1D. 
         * 
         * We need the first divisor digit to be &GT;= NBASE/2.  If it isn't, 
         * make it so by scaling up both the divisor and dividend by the 
         * factor "d".  (The reason for allocating dividend[0] above is to 
         * leave room for possible carry here.) 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="numeric.c.html#LN93"><span class='Ref_to_Const'>HALF_NBASE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN6991"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>d</span> <span class='Operator'>= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6892"><span class='Ref_To_Local'>var2ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>* </span><a href="numeric.c.html#LN6991"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>% </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* at this point only var1ndigits of dividend can be nonzero */ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6891"><span class='Ref_To_Local'>var1ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>* </span><a href="numeric.c.html#LN6991"><span class='Ref_To_Local'>d</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>% </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><a href="numeric.c.html#LN93"><span class='Ref_to_Const'>HALF_NBASE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if divisor[1]&LT;HALF_NBASE &raquo; </span> 
        <span class='Comment_Multi_Line'>/* First 2 divisor digits are used repeatedly in main loop */ 
</span>        <a href="numeric.c.html#LN6882"><span class='Ref_To_Local'>divisor1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>        <a href="numeric.c.html#LN6883"><span class='Ref_To_Local'>divisor2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Begin the main loop.  Each iteration of this loop produces the j'th 
         * quotient digit by dividing dividend[j .. j + var2ndigits] by the 
         * divisor; this is essentially the same as the common manual 
         * procedure for long division. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN6877"><span class='Ref_To_Local'>res_ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Estimate quotient digit from the first two dividend digits */ 
</span><a name="LN7025"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>next2digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN7026"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>qhat</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If next2digits are 0, then quotient digit must be 0 and there's 
             * no need to adjust the working dividend.  It's worth testing 
             * here to fall out ASAP when processing trailing zeroes in a 
             * dividend. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7025"><span class='Ref_To_Local'>next2digits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="numeric.c.html#LN6886"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="numeric.c.html#LN6882"><span class='Ref_To_Local'>divisor1</span></a><span class='Parentheses'>) 
</span>                <a href="numeric.c.html#LN7026"><span class='Ref_To_Local'>qhat</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="numeric.c.html#LN7026"><span class='Ref_To_Local'>qhat</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7025"><span class='Ref_To_Local'>next2digits</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN6882"><span class='Ref_To_Local'>divisor1</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Adjust quotient digit if it's too large.  Knuth proves that 
             * after this step, the quotient digit will be either correct or 
             * just one too large.  (Note: it's OK to use dividend[j+2] here 
             * because we know the divisor length is at least 2.) 
             */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6883"><span class='Ref_To_Local'>divisor2</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN7026"><span class='Ref_To_Local'>qhat</span></a> <span class='Operator'>&GT; 
</span>                   <span class='Parentheses'>(</span><a href="numeric.c.html#LN7025"><span class='Ref_To_Local'>next2digits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7026"><span class='Ref_To_Local'>qhat</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN6882"><span class='Ref_To_Local'>divisor1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
                <a href="numeric.c.html#LN7026"><span class='Ref_To_Local'>qhat</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* As above, need do nothing more when quotient digit is 0 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7026"><span class='Ref_To_Local'>qhat</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Multiply the divisor by qhat, and subtract that from the 
                 * working dividend.  "carry" tracks the multiplication, 
                 * "borrow" the subtraction (could we fold these together?) 
                 */ 
</span>                <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN6881"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6892"><span class='Ref_To_Local'>var2ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>* </span><a href="numeric.c.html#LN7026"><span class='Ref_To_Local'>qhat</span></a><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6881"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>% </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6881"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6881"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN6881"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                        <a href="numeric.c.html#LN6881"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN6881"><span class='Ref_To_Local'>borrow</span></a><span class='Delimiter'>; 
</span>                        <a href="numeric.c.html#LN6881"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * If we got a borrow out of the top dividend digit, then 
                 * indeed qhat was one too large.  Fix it, and add back the 
                 * divisor to correct the working dividend.  (Knuth proves 
                 * that this will occur only about 3/NBASE of the time; hence, 
                 * it's a good idea to test this code with small NBASE to be 
                 * sure this section gets exercised.) 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6881"><span class='Ref_To_Local'>borrow</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="numeric.c.html#LN7026"><span class='Ref_To_Local'>qhat</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6892"><span class='Ref_To_Local'>var2ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="numeric.c.html#LN6885"><span class='Ref_To_Local'>divisor</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                            <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN6887"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>                            <a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Comment_Multi_Line'>/* A carry should occur here to cancel the borrow above */ 
</span>                    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN6880"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if borrow &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if qhat&GT;0 &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* And we're done with this quotient digit */ 
</span>            <a href="numeric.c.html#LN6886"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN6888"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN7026"><span class='Ref_To_Local'>qhat</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for j=0;j&LT;res_ndigits;j++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6884"><span class='Ref_To_Local'>dividend</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally, round or truncate the result to the requested precision. 
     */ 
</span>    <a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6879"><span class='Ref_To_Local'>res_weight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN6878"><span class='Ref_To_Local'>res_sign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Round or truncate to target rscale (and set result-&GT;dscale) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN6874"><span class='Ref_to_Parameter'>round</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6874"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN530"><span class='Ref_to_Proto'>trunc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN6874"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Strip leading and trailing zeroes */ 
</span>    <a href="numeric.c.html#LN531"><span class='Ref_to_Proto'>strip_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN6873"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end div_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * div_var_fast() - 
 * 
 *  This has the same API as div_var, but is implemented using the division 
 *  algorithm from the "FM" library, rather than Knuth's schoolbook-division 
 *  approach.  This is significantly faster but can produce inaccurate 
 *  results, because it sometimes has to propagate rounding to the left, 
 *  and so we can never be entirely sure that we know the requested digits 
 *  exactly.  We compute DIV_GUARD_DIGITS extra digits, but there is 
 *  no certainty that that's enough.  We use this only in the transcendental 
 *  function calculation routines, where everything is approximate anyway. 
 * 
 *  Although we provide a "round" argument for consistency with div_var, 
 *  it is unwise to use this function with round=false.  In truncation mode 
 *  it is possible to get a result with no significant digits, for example 
 *  with rscale=0 we might compute 0.99999... and truncate that to 0 when 
 *  the correct answer is 1. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7158"></a><span class='Declare_Function'>div_var_fast</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN7159"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>round</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7161"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>div_ndigits</span><span class='Delimiter'>; 
</span><a name="LN7162"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_sign</span><span class='Delimiter'>; 
</span><a name="LN7163"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_weight</span><span class='Delimiter'>; 
</span><a name="LN7164"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>div</span><span class='Delimiter'>; 
</span><a name="LN7165"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>qdigit</span><span class='Delimiter'>; 
</span><a name="LN7166"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>carry</span><span class='Delimiter'>; 
</span><a name="LN7167"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxdiv</span><span class='Delimiter'>; 
</span><a name="LN7168"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newdig</span><span class='Delimiter'>; 
</span><a name="LN7169"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res_digits</span><span class='Delimiter'>; 
</span><a name="LN7170"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>fdividend</span><span class='Delimiter'>, 
</span><a name="LN7171"></a>                <span class='Declare_Local'>fdivisor</span><span class='Delimiter'>, 
</span><a name="LN7172"></a>                <span class='Declare_Local'>fdivisorinverse</span><span class='Delimiter'>, 
</span><a name="LN7173"></a>                <span class='Declare_Local'>fquotient</span><span class='Delimiter'>; 
</span><a name="LN7174"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>qi</span><span class='Delimiter'>; 
</span><a name="LN7175"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy these values into local vars for speed in inner loop */ 
</span><a name="LN7178"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var1ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN7179"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var2ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN7180"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var1digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span><a name="LN7181"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var2digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First of all division by zero check; we must not be handed an 
     * unnormalized divisor. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7179"><span class='Ref_To_Local'>var2ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN7181"><span class='Ref_To_Local'>var2digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DIVISION_BY_ZERO<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"division by zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now result zero check 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7178"><span class='Ref_To_Local'>var1ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7159"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Determine the result sign, weight and number of digits to calculate 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN7162"><span class='Ref_To_Local'>res_sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN7162"><span class='Ref_To_Local'>res_sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7163"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* The number of accurate result digits we need to produce: */ 
</span>    <a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7163"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN7159"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Add guard digits for roundoff error */ 
</span>    <a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN96"><span class='Ref_to_Const'>DIV_GUARD_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN96"><span class='Ref_to_Const'>DIV_GUARD_DIGITS</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN96"><span class='Ref_to_Const'>DIV_GUARD_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Must be at least var1ndigits, too, to simplify data-loading loop */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN7178"><span class='Ref_To_Local'>var1ndigits</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7178"><span class='Ref_To_Local'>var1ndigits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We do the arithmetic in an array "div[]" of signed int's.  Since 
     * INT_MAX is noticeably larger than NBASE*NBASE, this gives us headroom 
     * to avoid normalizing carries immediately. 
     * 
     * We start with div[] containing one zero digit followed by the 
     * dividend's digits (plus appended zeroes to reach the desired precision 
     * including guard digits).  Each step of the main loop computes an 
     * (approximate) quotient digit and stores it into div[], removing one 
     * position of dividend space.  A final pass of carry propagation takes 
     * care of any mistaken quotient digits. 
     */ 
</span>    <a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>((</span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN7178"><span class='Ref_To_Local'>var1ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN7180"><span class='Ref_To_Local'>var1digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We estimate each quotient digit using floating-point arithmetic, taking 
     * the first four digits of the (current) dividend and divisor.  This must 
     * be float to avoid overflow.  The quotient digits will generally be off 
     * by no more than one from the exact answer. 
     */ 
</span>    <a href="numeric.c.html#LN7171"><span class='Ref_To_Local'>fdivisor</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7181"><span class='Ref_To_Local'>var2digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN7171"><span class='Ref_To_Local'>fdivisor</span></a> <span class='Operator'>*= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN7179"><span class='Ref_To_Local'>var2ndigits</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN7171"><span class='Ref_To_Local'>fdivisor</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7181"><span class='Ref_To_Local'>var2digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span>    <a href="numeric.c.html#LN7172"><span class='Ref_To_Local'>fdivisorinverse</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>/ </span><a href="numeric.c.html#LN7171"><span class='Ref_To_Local'>fdivisor</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * maxdiv tracks the maximum possible absolute value of any div[] entry; 
     * when this threatens to exceed INT_MAX, we take the time to propagate 
     * carries.  Furthermore, we need to ensure that overflow doesn't occur 
     * during the carry propagation passes either.  The carry values may have 
     * an absolute value as high as INT_MAX/NBASE + 1, so really we must 
     * normalize when digits threaten to exceed INT_MAX - INT_MAX/NBASE - 1. 
     * 
     * To avoid overflow in maxdiv itself, it represents the max absolute 
     * value divided by NBASE-1, ie, at the top of the loop it is known that 
     * no div[] entry has an absolute value exceeding maxdiv * (NBASE-1). 
     * 
     * Actually, though, that holds good only for div[] entries after div[qi]; 
     * the adjustment done at the bottom of the loop may cause div[qi + 1] to 
     * exceed the maxdiv limit, so that div[qi] in the next iteration is 
     * beyond the limit.  This does not cause problems, as explained below. 
     */ 
</span>    <a href="numeric.c.html#LN7167"><span class='Ref_To_Local'>maxdiv</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Outer loop computes next quotient digit, which will go into div[qi] 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Approximate the current dividend value */ 
</span>        <a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>*= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a><span class='Parentheses'>) 
</span>                <a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* Compute the (approximate) quotient digit */ 
</span>        <a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN7172"><span class='Ref_To_Local'>fdivisorinverse</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a><span class='Parentheses'>)</span> <span class='Operator'>: 
</span>            <span class='Parentheses'>(((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* truncate towards -infinity */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Do we need to normalize now? */ 
</span>            <a href="numeric.c.html#LN7167"><span class='Ref_To_Local'>maxdiv</span></a> <span class='Operator'>+= </span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7167"><span class='Ref_To_Local'>maxdiv</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span>INT_MAX <span class='Operator'>- </span>INT_MAX <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Yes, do it */ 
</span>                <a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Operator'>-</span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                        <a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                        <a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * All the div[] digits except possibly div[qi] are now in the 
                 * range 0..NBASE-1.  We do not need to consider div[qi] in 
                 * the maxdiv value anymore, so we can reset maxdiv to 1. 
                 */ 
</span>                <a href="numeric.c.html#LN7167"><span class='Ref_To_Local'>maxdiv</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Recompute the quotient digit since new info may have 
                 * propagated into the top four dividend digits 
                 */ 
</span>                <a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Delimiter'>]; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>*= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a><span class='Parentheses'>) 
</span>                        <a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* Compute the (approximate) quotient digit */ 
</span>                <a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN7172"><span class='Ref_To_Local'>fdivisorinverse</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a><span class='Parentheses'>)</span> <span class='Operator'>: 
</span>                    <span class='Parentheses'>(((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* truncate towards -infinity */ 
</span>                <a href="numeric.c.html#LN7167"><span class='Ref_To_Local'>maxdiv</span></a> <span class='Operator'>+= </span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if maxdiv&GT;(INT_MAX-INT_M... &raquo; </span> 
 
            <span class='Comment_Multi_Line'>/* 
             * Subtract off the appropriate multiple of the divisor. 
             * 
             * The digits beyond div[qi] cannot overflow, because we know they 
             * will fall within the maxdiv limit.  As for div[qi] itself, note 
             * that qdigit is approximately trunc(div[qi] / vardigits[0]), 
             * which would make the new value simply div[qi] mod vardigits[0]. 
             * The lower-order terms in qdigit can change this result by not 
             * more than about twice INT_MAX/NBASE, so overflow is impossible. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN7353"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>istop</span> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7179"><span class='Ref_To_Local'>var2ndigits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN7353"><span class='Ref_To_Local'>istop</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>-= </span><a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN7181"><span class='Ref_To_Local'>var2digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if qdigit!=0 &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * The dividend digit we are about to replace might still be nonzero. 
         * Fold it into the next digit position. 
         * 
         * There is no risk of overflow here, although proving that requires 
         * some care.  Much as with the argument for div[qi] not overflowing, 
         * if we consider the first two terms in the numerator and denominator 
         * of qdigit, we can see that the final value of div[qi + 1] will be 
         * approximately a remainder mod (vardigits[0]*NBASE + vardigits[1]). 
         * Accounting for the lower-order terms is a bit complicated but ends 
         * up adding not much more than INT_MAX/NBASE to the possible range. 
         * Thus, div[qi + 1] cannot overflow here, and in its role as div[qi] 
         * in the next loop iteration, it can't be large enough to cause 
         * overflow in the carry propagation step (if any), either. 
         * 
         * But having said that: div[qi] can be more than INT_MAX/NBASE, as 
         * noted above, which means that the product div[qi] * NBASE *can* 
         * overflow.  When that happens, adding it to div[qi + 1] will always 
         * cause a canceling overflow so that the end result is correct.  We 
         * could avoid the intermediate overflow by doing the multiplication 
         * and addition in int64 arithmetic, but so far there appears no need. 
         */ 
</span>        <a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>+= </span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Delimiter'>] </span><span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for qi=0;qi&LT;div_ndigits;q... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Approximate and store the last quotient digit (div[div_ndigits]) 
     */ 
</span>    <a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Delimiter'>]; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>4</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>*= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7170"><span class='Ref_To_Local'>fdividend</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN7172"><span class='Ref_To_Local'>fdivisorinverse</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Parentheses'>((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a><span class='Parentheses'>)</span> <span class='Operator'>: 
</span>        <span class='Parentheses'>(((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7173"><span class='Ref_To_Local'>fquotient</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* truncate towards -infinity */ 
</span>    <a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7174"><span class='Ref_To_Local'>qi</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN7165"><span class='Ref_To_Local'>qdigit</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Because the quotient digits might be off by one, some of them might be 
     * -1 or NBASE at this point.  The represented value is correct in a 
     * mathematical sense, but it doesn't look right.  We do a final carry 
     * propagation pass to normalize the digits, which we combine with storing 
     * the result digits into the output.  Note that this is still done at 
     * full precision w/guard digits. 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN112"><span class='Ref_to_Func'>alloc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7169"><span class='Ref_To_Local'>res_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7161"><span class='Ref_To_Local'>div_ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Operator'>-</span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>)</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN7169"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7175"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN7168"><span class='Ref_To_Local'>newdig</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN7166"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7164"><span class='Ref_To_Local'>div</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finally, round the result to the requested precision. 
     */ 
</span>    <a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7163"><span class='Ref_To_Local'>res_weight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7162"><span class='Ref_To_Local'>res_sign</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Round to target rscale (and set result-&GT;dscale) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7159"><span class='Ref_to_Parameter'>round</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7159"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN530"><span class='Ref_to_Proto'>trunc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7159"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Strip leading and trailing zeroes */ 
</span>    <a href="numeric.c.html#LN531"><span class='Ref_to_Proto'>strip_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7158"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end div_var_fast &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Default scale selection for division 
 * 
 * Returns the appropriate result scale for the division result. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN7453"></a><span class='Declare_Function'>select_div_scale</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7455"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>weight1</span><span class='Delimiter'>, 
</span><a name="LN7456"></a>                <span class='Declare_Local'>weight2</span><span class='Delimiter'>, 
</span><a name="LN7457"></a>                <span class='Declare_Local'>qweight</span><span class='Delimiter'>, 
</span><a name="LN7458"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN7459"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Declare_Local'>firstdigit1</span><span class='Delimiter'>, 
</span><a name="LN7460"></a>                <span class='Declare_Local'>firstdigit2</span><span class='Delimiter'>; 
</span><a name="LN7461"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rscale</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The result scale of a division isn't specified in any SQL standard. For 
     * PostgreSQL we select a result scale that will give at least 
     * NUMERIC_MIN_SIG_DIGITS significant digits, so that numeric gives a 
     * result no less accurate than float8; but use a scale not less than 
     * either input's display scale. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Get the actual (normalized) weight and first digit of each input */ 
</span> 
    <a href="numeric.c.html#LN7455"><span class='Ref_To_Local'>weight1</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* values to use if var1 is zero */ 
</span>    <a href="numeric.c.html#LN7459"><span class='Ref_To_Local'>firstdigit1</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN7453"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN7459"><span class='Ref_To_Local'>firstdigit1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7453"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7459"><span class='Ref_To_Local'>firstdigit1</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN7455"><span class='Ref_To_Local'>weight1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7453"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN7456"><span class='Ref_To_Local'>weight2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* values to use if var2 is zero */ 
</span>    <a href="numeric.c.html#LN7460"><span class='Ref_To_Local'>firstdigit2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN7453"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN7460"><span class='Ref_To_Local'>firstdigit2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7453"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7460"><span class='Ref_To_Local'>firstdigit2</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN7456"><span class='Ref_To_Local'>weight2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7453"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7458"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Estimate weight of quotient.  If the two first digits are equal, we 
     * can't be sure, but assume that var1 is less than var2. 
     */ 
</span>    <a href="numeric.c.html#LN7457"><span class='Ref_To_Local'>qweight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7455"><span class='Ref_To_Local'>weight1</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7456"><span class='Ref_To_Local'>weight2</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7459"><span class='Ref_To_Local'>firstdigit1</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN7460"><span class='Ref_To_Local'>firstdigit2</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN7457"><span class='Ref_To_Local'>qweight</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Select result scale */ 
</span>    <a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN10"><span class='Ref_to_Const'>NUMERIC_MIN_SIG_DIGITS</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7457"><span class='Ref_To_Local'>qweight</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7453"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7453"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN8"><span class='Ref_to_Const'>NUMERIC_MAX_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="numeric.c.html#LN7461"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end select_div_scale &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * mod_var() - 
 * 
 *  Calculate the modulo of two numerics at variable level 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7522"></a><span class='Declare_Function'>mod_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7524"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7524"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* --------- 
     * We do this using the equation 
     *      mod(x,y) = x - trunc(x/y)*y 
     * div_var can be persuaded to give us trunc(x/y) directly. 
     * ---------- 
     */ 
</span>    <a href="numeric.c.html#LN504"><span class='Ref_to_Proto'>div_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7522"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7522"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7524"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7522"><span class='Ref_to_Parameter'>var2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7524"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7524"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7522"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7522"><span class='Ref_to_Parameter'>var1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7524"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7522"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7524"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end mod_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ceil_var() - 
 * 
 *  Return the smallest integer greater than or equal to the argument 
 *  on variable level 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7551"></a><span class='Declare_Function'>ceil_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7553"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7553"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7551"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7553"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN530"><span class='Ref_to_Proto'>trunc_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7553"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7551"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a> <span class='Operator'>&& </span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7551"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7553"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7553"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7553"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7553"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7551"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7553"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * floor_var() - 
 * 
 *  Return the largest integer equal to or less than the argument 
 *  on variable level 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7575"></a><span class='Declare_Function'>floor_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7577"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7577"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7575"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7577"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN530"><span class='Ref_to_Proto'>trunc_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7577"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7575"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a> <span class='Operator'>&& </span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7575"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7577"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7577"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7577"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7577"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7575"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7577"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * sqrt_var() - 
 * 
 *  Compute the square root of x using Newton's algorithm 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7598"></a><span class='Declare_Function'>sqrt_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7600"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp_arg</span><span class='Delimiter'>; 
</span><a name="LN7601"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp_val</span><span class='Delimiter'>; 
</span><a name="LN7602"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>last_val</span><span class='Delimiter'>; 
</span><a name="LN7603"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>local_rscale</span><span class='Delimiter'>; 
</span><a name="LN7604"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>stat</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN7603"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN7604"><span class='Ref_To_Local'>stat</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7604"><span class='Ref_To_Local'>stat</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * SQL2003 defines sqrt() in terms of power, so we need to emit the right 
     * SQLSTATE error code if the operand is negative. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7604"><span class='Ref_To_Local'>stat</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_ARGUMENT_FOR_POWER_FUNCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot take square root of a negative number"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7600"><span class='Ref_To_Local'>tmp_arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7601"><span class='Ref_To_Local'>tmp_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7602"><span class='Ref_To_Local'>last_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy arg in case it is the same var as result */ 
</span>    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7600"><span class='Ref_To_Local'>tmp_arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Initialize the result to the first guess 
     */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN112"><span class='Ref_to_Func'>alloc_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN7600"><span class='Ref_To_Local'>tmp_arg</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7600"><span class='Ref_To_Local'>tmp_arg</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7602"><span class='Ref_To_Local'>last_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN506"><span class='Ref_to_Proto'>div_var_fast</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7600"><span class='Ref_To_Local'>tmp_arg</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7601"><span class='Ref_To_Local'>tmp_val</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7603"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7601"><span class='Ref_To_Local'>tmp_val</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN398"><span class='Ref_to_Global_Var'>const_zero_point_five</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7603"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7602"><span class='Ref_To_Local'>last_val</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7602"><span class='Ref_To_Local'>last_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7602"><span class='Ref_To_Local'>last_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7601"><span class='Ref_To_Local'>tmp_val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7600"><span class='Ref_To_Local'>tmp_arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Round to requested precision */ 
</span>    <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7598"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sqrt_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * exp_var() - 
 * 
 *  Raise e to the power of x, computed to rscale fractional digits 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7671"></a><span class='Declare_Function'>exp_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7673"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span><a name="LN7674"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>elem</span><span class='Delimiter'>; 
</span><a name="LN7675"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>ni</span><span class='Delimiter'>; 
</span><a name="LN7676"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN7677"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dweight</span><span class='Delimiter'>; 
</span><a name="LN7678"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndiv2</span><span class='Delimiter'>; 
</span><a name="LN7679"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sig_digits</span><span class='Delimiter'>; 
</span><a name="LN7680"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>local_rscale</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7675"><span class='Ref_To_Local'>ni</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Estimate the dweight of the result using floating point arithmetic, so 
     * that we can choose an appropriate local rscale for the calculation. 
     */ 
</span>    <a href="numeric.c.html#LN7676"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN485"><span class='Ref_to_Proto'>numericvar_to_double_no_overflow</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Guard against overflow */ 
</span>    <span class='Comment_Multi_Line'>/* If you change this limit, see also power_var()'s limit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7676"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../../include/utils/numeric.h.html#LN31"><span class='Ref_to_Const'>NUMERIC_MAX_RESULT_SCALE</span></a> <span class='Operator'>* </span><span class='Number'>3</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value overflows numeric format"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* decimal weight = log10(e^x) = x * log10(e) */ 
</span>    <a href="numeric.c.html#LN7677"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="numeric.c.html#LN7676"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>434294481903252</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reduce x to the range -0.01 &LT;= x &LT;= 0.01 (approximately) by dividing by 
     * 2^n, to improve the convergence rate of the Taylor series. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7676"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>01</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN7710"></a>        <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp</span><span class='Delimiter'>; 
</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7710"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN378"><span class='Ref_to_Global_Var'>const_two</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7710"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN7678"><span class='Ref_To_Local'>ndiv2</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN7676"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7676"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>01</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN7678"><span class='Ref_To_Local'>ndiv2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN7676"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>/= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7710"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7710"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7710"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7678"><span class='Ref_To_Local'>ndiv2</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN506"><span class='Ref_to_Proto'>div_var_fast</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7710"><span class='Ref_To_Local'>tmp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7710"><span class='Ref_To_Local'>tmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if Abs(val)&GT;0.01 &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN7678"><span class='Ref_To_Local'>ndiv2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the scale for the Taylor series expansion.  The final result has 
     * (dweight + rscale + 1) significant digits.  In addition, we have to 
     * raise the Taylor series result to the power 2^ndiv2, which introduces 
     * an error of up to around log10(2^ndiv2) digits, so work with this many 
     * extra digits of precision (plus a few more for good measure). 
     */ 
</span>    <a href="numeric.c.html#LN7679"><span class='Ref_To_Local'>sig_digits</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="numeric.c.html#LN7677"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="numeric.c.html#LN7678"><span class='Ref_To_Local'>ndiv2</span></a> <span class='Operator'>* </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>301029995663981</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7679"><span class='Ref_To_Local'>sig_digits</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7679"><span class='Ref_To_Local'>sig_digits</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7679"><span class='Ref_To_Local'>sig_digits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use the Taylor series 
     * 
     * exp(x) = 1 + x + x^2/2! + x^3/3! + ... 
     * 
     * Given the limited range of x, this should converge reasonably quickly. 
     * We run the series until the terms fall below the local_rscale limit. 
     */ 
</span>    <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN378"><span class='Ref_to_Global_Var'>const_two</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7675"><span class='Ref_To_Local'>ni</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN506"><span class='Ref_to_Proto'>div_var_fast</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7675"><span class='Ref_To_Local'>ni</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7675"><span class='Ref_To_Local'>ni</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7675"><span class='Ref_To_Local'>ni</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN506"><span class='Ref_to_Proto'>div_var_fast</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7675"><span class='Ref_To_Local'>ni</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Compensate for the argument range reduction.  Since the weight of the 
     * result doubles with each multiplication, we can reduce the local rscale 
     * as we proceed. 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7678"><span class='Ref_To_Local'>ndiv2</span></a><span class='Operator'>-- &GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7679"><span class='Ref_To_Local'>sig_digits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7680"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Round to requested rscale */ 
</span>    <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7671"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7673"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7674"><span class='Ref_To_Local'>elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7675"><span class='Ref_To_Local'>ni</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end exp_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Estimate the dweight of the most significant decimal digit of the natural 
 * logarithm of a number. 
 * 
 * Essentially, we're approximating log10(abs(ln(var))).  This is used to 
 * determine the appropriate rscale when computing natural logarithms. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN7797"></a><span class='Declare_Function'>estimate_ln_dweight</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7799"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ln_dweight</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7797"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN408"><span class='Ref_to_Global_Var'>const_zero_point_nine</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7797"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN418"><span class='Ref_to_Global_Var'>const_one_point_one</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * 0.9 &LT;= var &LT;= 1.1 
         * 
         * ln(var) has a negative weight (possibly very large).  To get a 
         * reasonably accurate result, estimate it using ln(1+x) ~= x. 
         */ 
</span><a name="LN7810"></a>        <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7810"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7797"><span class='Ref_to_Parameter'>var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7810"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7810"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Use weight of most significant decimal digit of x */ 
</span>            <a href="numeric.c.html#LN7799"><span class='Ref_To_Local'>ln_dweight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7810"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>log10<span class='Parentheses'>(</span><a href="numeric.c.html#LN7810"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* x = 0.  Since ln(1) = 0 exactly, we don't need extra digits */ 
</span>            <a href="numeric.c.html#LN7799"><span class='Ref_To_Local'>ln_dweight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7810"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cmp_var(var,&const_ze... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Estimate the logarithm using the first couple of digits from the 
         * input number.  This will give an accurate result whenever the input 
         * is not too close to 1. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7797"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN7837"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>digits</span><span class='Delimiter'>; 
</span><a name="LN7838"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>dweight</span><span class='Delimiter'>; 
</span><a name="LN7839"></a>            <span class='Keyword'>double</span>      <span class='Declare_Local'>ln_var</span><span class='Delimiter'>; 
</span> 
            <a href="numeric.c.html#LN7837"><span class='Ref_To_Local'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7797"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <a href="numeric.c.html#LN7838"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7797"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7797"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="numeric.c.html#LN7837"><span class='Ref_To_Local'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7837"><span class='Ref_To_Local'>digits</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7797"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <a href="numeric.c.html#LN7838"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/*---------- 
             * We have var ~= digits * 10^dweight 
             * so ln(var) ~= ln(digits) + dweight * ln(10) 
             *---------- 
             */ 
</span>            <a href="numeric.c.html#LN7839"><span class='Ref_To_Local'>ln_var</span></a> <span class='Operator'>= </span>log<span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN7837"><span class='Ref_To_Local'>digits</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="numeric.c.html#LN7838"><span class='Ref_To_Local'>dweight</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>302585092994046</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN7799"><span class='Ref_To_Local'>ln_dweight</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>log10<span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7839"><span class='Ref_To_Local'>ln_var</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if var-&GT;ndigits&GT;0 &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Caller should fail on ln(0), but for the moment return zero */ 
</span>            <a href="numeric.c.html#LN7799"><span class='Ref_To_Local'>ln_dweight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="numeric.c.html#LN7799"><span class='Ref_To_Local'>ln_dweight</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end estimate_ln_dweight &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * ln_var() - 
 * 
 *  Compute the natural log of x 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7875"></a><span class='Declare_Function'>ln_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7877"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>x</span><span class='Delimiter'>; 
</span><a name="LN7878"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>xx</span><span class='Delimiter'>; 
</span><a name="LN7879"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>ni</span><span class='Delimiter'>; 
</span><a name="LN7880"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>elem</span><span class='Delimiter'>; 
</span><a name="LN7881"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>fact</span><span class='Delimiter'>; 
</span><a name="LN7882"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>local_rscale</span><span class='Delimiter'>; 
</span><a name="LN7883"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN7883"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7883"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_ARGUMENT_FOR_LOG<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot take logarithm of zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7883"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_ARGUMENT_FOR_LOG<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot take logarithm of a negative number"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7878"><span class='Ref_To_Local'>xx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7879"><span class='Ref_To_Local'>ni</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7880"><span class='Ref_To_Local'>elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7881"><span class='Ref_To_Local'>fact</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN378"><span class='Ref_to_Global_Var'>const_two</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7881"><span class='Ref_To_Local'>fact</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reduce input into range 0.9 &LT; x &LT; 1.1 with repeated sqrt() operations. 
     * 
     * The final logarithm will have up to around rscale+6 significant digits. 
     * Each sqrt() will roughly halve the weight of x, so adjust the local 
     * rscale as we work so that we keep this many significant digits at each 
     * step (plus a few more for good measure). 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN408"><span class='Ref_to_Global_Var'>const_zero_point_nine</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>/ </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN513"><span class='Ref_to_Proto'>sqrt_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7881"><span class='Ref_To_Local'>fact</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN378"><span class='Ref_to_Global_Var'>const_two</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7881"><span class='Ref_To_Local'>fact</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN418"><span class='Ref_to_Global_Var'>const_one_point_one</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>/ </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN513"><span class='Ref_to_Proto'>sqrt_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7881"><span class='Ref_To_Local'>fact</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN378"><span class='Ref_to_Global_Var'>const_two</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7881"><span class='Ref_To_Local'>fact</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use the Taylor series for 0.5 * ln((1+z)/(1-z)), 
     * 
     * z + z^3/3 + z^5/5 + ... 
     * 
     * where z = (x-1)/(x+1) is in the range (approximately) -0.053 .. 0.048 
     * due to the above range-reduction of x. 
     * 
     * The convergence of this is not as fast as one would like, but is 
     * tolerable given that z is small. 
     */ 
</span>    <a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN501"><span class='Ref_to_Proto'>sub_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7880"><span class='Ref_To_Local'>elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN506"><span class='Ref_to_Proto'>div_var_fast</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7880"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7878"><span class='Ref_To_Local'>xx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7879"><span class='Ref_To_Local'>ni</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7879"><span class='Ref_To_Local'>ni</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN378"><span class='Ref_to_Global_Var'>const_two</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7879"><span class='Ref_To_Local'>ni</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7878"><span class='Ref_To_Local'>xx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7878"><span class='Ref_To_Local'>xx</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN506"><span class='Ref_to_Proto'>div_var_fast</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7878"><span class='Ref_To_Local'>xx</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7879"><span class='Ref_To_Local'>ni</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7880"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7880"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7880"><span class='Ref_To_Local'>elem</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN7880"><span class='Ref_To_Local'>elem</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7882"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Compensate for argument range reduction, round to requested rscale */ 
</span>    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7881"><span class='Ref_To_Local'>fact</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7875"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7877"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7878"><span class='Ref_To_Local'>xx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7879"><span class='Ref_To_Local'>ni</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7880"><span class='Ref_To_Local'>elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7881"><span class='Ref_To_Local'>fact</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ln_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * log_var() - 
 * 
 *  Compute the logarithm of num in a given base. 
 * 
 *  Note: this routine chooses dscale of the result. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN7982"></a><span class='Declare_Function'>log_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>base</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>num</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN7984"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>ln_base</span><span class='Delimiter'>; 
</span><a name="LN7985"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>ln_num</span><span class='Delimiter'>; 
</span><a name="LN7986"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ln_base_dweight</span><span class='Delimiter'>; 
</span><a name="LN7987"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ln_num_dweight</span><span class='Delimiter'>; 
</span><a name="LN7988"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result_dweight</span><span class='Delimiter'>; 
</span><a name="LN7989"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rscale</span><span class='Delimiter'>; 
</span><a name="LN7990"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ln_base_rscale</span><span class='Delimiter'>; 
</span><a name="LN7991"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ln_num_rscale</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7984"><span class='Ref_To_Local'>ln_base</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7985"><span class='Ref_To_Local'>ln_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Estimated dweights of ln(base), ln(num) and the final result */ 
</span>    <a href="numeric.c.html#LN7986"><span class='Ref_To_Local'>ln_base_dweight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN515"><span class='Ref_to_Proto'>estimate_ln_dweight</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7982"><span class='Ref_to_Parameter'>base</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7987"><span class='Ref_To_Local'>ln_num_dweight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN515"><span class='Ref_to_Proto'>estimate_ln_dweight</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7982"><span class='Ref_to_Parameter'>num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7988"><span class='Ref_To_Local'>result_dweight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7987"><span class='Ref_To_Local'>ln_num_dweight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7986"><span class='Ref_To_Local'>ln_base_dweight</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Select the scale of the result so that it will have at least 
     * NUMERIC_MIN_SIG_DIGITS significant digits and is not less than either 
     * input's display scale. 
     */ 
</span>    <a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN10"><span class='Ref_to_Const'>NUMERIC_MIN_SIG_DIGITS</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7988"><span class='Ref_To_Local'>result_dweight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7982"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7982"><span class='Ref_to_Parameter'>num</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN8"><span class='Ref_to_Const'>NUMERIC_MAX_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Set the scales for ln(base) and ln(num) so that they each have more 
     * significant digits than the final result. 
     */ 
</span>    <a href="numeric.c.html#LN7990"><span class='Ref_To_Local'>ln_base_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7988"><span class='Ref_To_Local'>result_dweight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7986"><span class='Ref_To_Local'>ln_base_dweight</span></a> <span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7990"><span class='Ref_To_Local'>ln_base_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7990"><span class='Ref_To_Local'>ln_base_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN7991"><span class='Ref_To_Local'>ln_num_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN7988"><span class='Ref_To_Local'>result_dweight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN7987"><span class='Ref_To_Local'>ln_num_dweight</span></a> <span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN7991"><span class='Ref_To_Local'>ln_num_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7991"><span class='Ref_To_Local'>ln_num_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Form natural logarithms */ 
</span>    <a href="numeric.c.html#LN516"><span class='Ref_to_Proto'>ln_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7982"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7984"><span class='Ref_To_Local'>ln_base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7990"><span class='Ref_To_Local'>ln_base_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN516"><span class='Ref_to_Proto'>ln_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN7982"><span class='Ref_to_Parameter'>num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7985"><span class='Ref_To_Local'>ln_num</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7991"><span class='Ref_To_Local'>ln_num_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Divide and round to the required scale */ 
</span>    <a href="numeric.c.html#LN506"><span class='Ref_to_Proto'>div_var_fast</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7985"><span class='Ref_To_Local'>ln_num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN7984"><span class='Ref_To_Local'>ln_base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7982"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN7989"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7985"><span class='Ref_To_Local'>ln_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN7984"><span class='Ref_To_Local'>ln_base</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end log_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * power_var() - 
 * 
 *  Raise base to the power of exp 
 * 
 *  Note: this routine chooses dscale of the result. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8042"></a><span class='Declare_Function'>power_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>base</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>exp</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8044"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>ln_base</span><span class='Delimiter'>; 
</span><a name="LN8045"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>ln_num</span><span class='Delimiter'>; 
</span><a name="LN8046"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ln_dweight</span><span class='Delimiter'>; 
</span><a name="LN8047"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rscale</span><span class='Delimiter'>; 
</span><a name="LN8048"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>local_rscale</span><span class='Delimiter'>; 
</span><a name="LN8049"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If exp can be represented as an integer, use power_var_int */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>exp</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>exp</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>exp</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* exact integer, but does it fit in int? */ 
</span><a name="LN8055"></a>        <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>expval64</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN478"><span class='Ref_to_Proto'>numericvar_to_int64</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>exp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN8055"><span class='Ref_To_Local'>expval64</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN8059"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>expval</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN8055"><span class='Ref_To_Local'>expval64</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Test for overflow by reverse-conversion. */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN8059"><span class='Ref_To_Local'>expval</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN8055"><span class='Ref_To_Local'>expval64</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Okay, select rscale */ 
</span>                <a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN10"><span class='Ref_to_Const'>NUMERIC_MIN_SIG_DIGITS</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN8"><span class='Ref_to_Const'>NUMERIC_MAX_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="numeric.c.html#LN519"><span class='Ref_to_Proto'>power_var_int</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8059"><span class='Ref_To_Local'>expval</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if exp-&GT;ndigits==0||exp-... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * This avoids log(0) for cases of 0 raised to a non-integer.  0 ^ 0 is 
     * handled by power_var_int(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN495"><span class='Ref_to_Proto'>cmp_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN10"><span class='Ref_to_Const'>NUMERIC_MIN_SIG_DIGITS</span></a><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* no need to round */ 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8044"><span class='Ref_To_Local'>ln_base</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8045"><span class='Ref_To_Local'>ln_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * Decide on the scale for the ln() calculation.  For this we need an 
     * estimate of the weight of the result, which we obtain by doing an 
     * initial low-precision calculation of exp * ln(base). 
     * 
     * We want result = e ^ (exp * ln(base)) 
     * so result dweight = log10(result) = exp * ln(base) * log10(e) 
     * 
     * We also perform a crude overflow test here so that we can exit early if 
     * the full-precision result is sure to overflow, and to guard against 
     * integer overflow when determining the scale for the real calculation. 
     * exp_var() supports inputs up to NUMERIC_MAX_RESULT_SCALE * 3, so the 
     * result will overflow if exp * ln(base) &GT;= NUMERIC_MAX_RESULT_SCALE * 3. 
     * Since the values here are only approximations, we apply a small fuzz 
     * factor to this overflow test and let exp_var() determine the exact 
     * overflow threshold so that it is consistent for all inputs. 
     *---------- 
     */ 
</span>    <a href="numeric.c.html#LN8046"><span class='Ref_To_Local'>ln_dweight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN515"><span class='Ref_to_Proto'>estimate_ln_dweight</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>base</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><span class='Number'>8</span> <span class='Operator'>- </span><a href="numeric.c.html#LN8046"><span class='Ref_To_Local'>ln_dweight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN8"><span class='Ref_to_Const'>NUMERIC_MAX_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN516"><span class='Ref_to_Proto'>ln_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN8044"><span class='Ref_To_Local'>ln_base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8044"><span class='Ref_To_Local'>ln_base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>exp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN8045"><span class='Ref_To_Local'>ln_num</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8049"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN485"><span class='Ref_to_Proto'>numericvar_to_double_no_overflow</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8045"><span class='Ref_To_Local'>ln_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* initial overflow test with fuzz factor */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8049"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/utils/numeric.h.html#LN31"><span class='Ref_to_Const'>NUMERIC_MAX_RESULT_SCALE</span></a> <span class='Operator'>* </span><span class='Number'>3</span><span class='Operator'>.</span><span class='Number'>01</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value overflows numeric format"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8049"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>*= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>434294481903252</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* approximate decimal result weight */ 
</span> 
    <span class='Comment_Multi_Line'>/* choose the result scale */ 
</span>    <a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN10"><span class='Ref_to_Const'>NUMERIC_MIN_SIG_DIGITS</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN8049"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>exp</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN8"><span class='Ref_to_Const'>NUMERIC_MAX_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set the scale for the real exp * ln(base) calculation */ 
</span>    <a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN8049"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8046"><span class='Ref_To_Local'>ln_dweight</span></a> <span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* and do the real calculation */ 
</span> 
    <a href="numeric.c.html#LN516"><span class='Ref_to_Proto'>ln_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN8044"><span class='Ref_To_Local'>ln_base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8044"><span class='Ref_To_Local'>ln_base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>exp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN8045"><span class='Ref_To_Local'>ln_num</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8048"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN514"><span class='Ref_to_Proto'>exp_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8045"><span class='Ref_To_Local'>ln_num</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8042"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8047"><span class='Ref_To_Local'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8045"><span class='Ref_To_Local'>ln_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8044"><span class='Ref_To_Local'>ln_base</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end power_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * power_var_int() - 
 * 
 *  Raise base to the power of exp, where exp is an integer. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8157"></a><span class='Declare_Function'>power_var_int</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>base</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>exp</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8159"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>f</span><span class='Delimiter'>; 
</span><a name="LN8160"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN8161"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN8162"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sig_digits</span><span class='Delimiter'>; 
</span><a name="LN8163"></a>    <span class='Keyword'>unsigned int </span><span class='Declare_Local'>mask</span><span class='Delimiter'>; 
</span><a name="LN8164"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>neg</span><span class='Delimiter'>; 
</span><a name="LN8165"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>base_prod</span><span class='Delimiter'>; 
</span><a name="LN8166"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>local_rscale</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Handle some common special cases, as well as corner cases */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>exp</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>0</span><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * While 0 ^ 0 can be either 1 or indeterminate (error), we treat 
             * it as 1 because most programming languages do this. SQL:2003 
             * also requires a return value of 1. 
             * http://en.wikipedia.org/wiki/Exponentiation#Zero_to_the_zero_pow 
             * er 
             */ 
</span>            <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* no need to round */ 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="numeric.c.html#LN504"><span class='Ref_to_Proto'>div_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch exp &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Handle the special case where the base is zero */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>exp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DIVISION_BY_ZERO<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"division by zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The general case repeatedly multiplies base according to the bit 
     * pattern of exp. 
     * 
     * First we need to estimate the weight of the result so that we know how 
     * many significant digits are needed. 
     */ 
</span>    <a href="numeric.c.html#LN8159"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>    <a href="numeric.c.html#LN8160"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8161"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8161"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&& </span><a href="numeric.c.html#LN8161"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>&LT; </span><span class='Number'>16</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8161"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8159"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8159"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8161"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <a href="numeric.c.html#LN8160"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * We have base ~= f * 10^p 
     * so log10(result) = log10(base^exp) ~= exp * (log10(f) + p) 
     *---------- 
     */ 
</span>    <a href="numeric.c.html#LN8159"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>exp</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span>log10<span class='Parentheses'>(</span><a href="numeric.c.html#LN8159"><span class='Ref_To_Local'>f</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="numeric.c.html#LN8160"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Apply crude overflow/underflow tests so we can exit early if the result 
     * certainly will overflow/underflow. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8159"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>&GT; </span><span class='Number'>3</span> <span class='Operator'>* </span>SHRT_MAX <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value overflows numeric format"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8159"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; -</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>|| </span><a href="numeric.c.html#LN8159"><span class='Ref_To_Local'>f</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>&LT; -</span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN8"><span class='Ref_to_Const'>NUMERIC_MAX_DISPLAY_SCALE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Approximate number of significant digits in the result.  Note that the 
     * underflow test above means that this is necessarily &GT;= 0. 
     */ 
</span>    <a href="numeric.c.html#LN8162"><span class='Ref_To_Local'>sig_digits</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="numeric.c.html#LN8159"><span class='Ref_To_Local'>f</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The multiplications to produce the result may introduce an error of up 
     * to around log10(abs(exp)) digits, so work with this many extra digits 
     * of precision (plus a few more for good measure). 
     */ 
</span>    <a href="numeric.c.html#LN8162"><span class='Ref_To_Local'>sig_digits</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span>log<span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>exp</span></a><span class='Parentheses'>))</span> <span class='Operator'>+ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now we can proceed with the multiplications. 
     */ 
</span>    <a href="numeric.c.html#LN8164"><span class='Ref_To_Local'>neg</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>exp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8163"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>exp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8163"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>base</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>((</span><a href="numeric.c.html#LN8163"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Do the multiplications using rscales large enough to hold the 
         * results to the required number of significant digits, but don't 
         * waste time by exceeding the scales of the numbers themselves. 
         */ 
</span>        <a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8162"><span class='Ref_To_Local'>sig_digits</span></a> <span class='Operator'>- </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8163"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>& </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8162"><span class='Ref_To_Local'>sig_digits</span></a> <span class='Operator'>- 
</span>                <span class='Parentheses'>(</span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, 
</span>                               <a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN9"><span class='Ref_to_Const'>NUMERIC_MIN_DISPLAY_SCALE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="numeric.c.html#LN502"><span class='Ref_to_Proto'>mul_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8166"><span class='Ref_To_Local'>local_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * When abs(base) &GT; 1, the number of digits to the left of the decimal 
         * point in base_prod doubles at each iteration, so if exp is large we 
         * could easily spend large amounts of time and memory space doing the 
         * multiplications.  But once the weight exceeds what will fit in 
         * int16, the final result is guaranteed to overflow (or underflow, if 
         * exp &LT; 0), so we can give up before wasting too many cycles. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>&GT; </span>SHRT_MAX <span class='Operator'>|| </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>&GT; </span>SHRT_MAX<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* overflow, unless neg, in which case result should be 0 */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN8164"><span class='Ref_To_Local'>neg</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"value overflows numeric format"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN457"><span class='Ref_to_Func'>zero_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8164"><span class='Ref_To_Local'>neg</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (mask&GT;&GT;=1)&GT;0 &raquo; </span> 
 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8165"><span class='Ref_To_Local'>base_prod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Compensate for input sign, and round to requested rscale */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8164"><span class='Ref_To_Local'>neg</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN506"><span class='Ref_to_Proto'>div_var_fast</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN374"><span class='Ref_to_Global_Var'>const_one</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN529"><span class='Ref_to_Proto'>round_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8157"><span class='Ref_to_Parameter'>rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end power_var_int &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Following are the lowest level functions that operate unsigned 
 * on the variable level 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* ---------- 
 * cmp_abs() - 
 * 
 *  Compare the absolute values of var1 and var2 
 *  Returns:    -1 for ABS(var1) &LT; ABS(var2) 
 *              0  for ABS(var1) == ABS(var2) 
 *              1  for ABS(var1) &GT; ABS(var2) 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN8348"></a><span class='Declare_Function'>cmp_abs</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="numeric.c.html#LN523"><span class='Ref_to_Proto'>cmp_abs_common</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8348"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8348"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8348"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>, 
</span>                          <a href="numeric.c.html#LN8348"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8348"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8348"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* ---------- 
 * cmp_abs_common() - 
 * 
 *  Main routine of cmp_abs(). This function can be used by both 
 *  NumericVar and Numeric. 
 * ---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN8362"></a><span class='Declare_Function'>cmp_abs_common</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1digits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var1ndigits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var1weight</span><span class='Delimiter'>, 
</span><a name="LN8363"></a>             <span class='Keyword'>const </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2digits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var2ndigits</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>var2weight</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8365"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i1</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN8366"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i2</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check any digits before the first common digit */ 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1weight</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2weight</span></a> <span class='Operator'>&& </span><a href="numeric.c.html#LN8365"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1ndigits</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8365"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1weight</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2weight</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1weight</span></a> <span class='Operator'>&& </span><a href="numeric.c.html#LN8366"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2ndigits</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8366"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2weight</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* At this point, either w1 == w2 or we've run out of digits */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1weight</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2weight</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8365"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1ndigits</span></a> <span class='Operator'>&& </span><a href="numeric.c.html#LN8366"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2ndigits</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN8389"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>stat</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8365"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>- </span><a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8366"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8389"><span class='Ref_To_Local'>stat</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8389"><span class='Ref_To_Local'>stat</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * At this point, we've run out of digits on one side or the other; so any 
     * remaining nonzero digits imply that side is larger 
     */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8365"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1ndigits</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8362"><span class='Ref_to_Parameter'>var1digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8365"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8366"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2ndigits</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8363"><span class='Ref_to_Parameter'>var2digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8366"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end cmp_abs_common &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * add_abs() - 
 * 
 *  Add the absolute values of two variables into result. 
 *  result might point to one of the operands without danger. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8426"></a><span class='Declare_Function'>add_abs</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8428"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res_buf</span><span class='Delimiter'>; 
</span><a name="LN8429"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res_digits</span><span class='Delimiter'>; 
</span><a name="LN8430"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_ndigits</span><span class='Delimiter'>; 
</span><a name="LN8431"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_weight</span><span class='Delimiter'>; 
</span><a name="LN8432"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_rscale</span><span class='Delimiter'>, 
</span><a name="LN8433"></a>                <span class='Declare_Local'>rscale1</span><span class='Delimiter'>, 
</span><a name="LN8434"></a>                <span class='Declare_Local'>rscale2</span><span class='Delimiter'>; 
</span><a name="LN8435"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_dscale</span><span class='Delimiter'>; 
</span><a name="LN8436"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN8437"></a>                <span class='Declare_Local'>i1</span><span class='Delimiter'>, 
</span><a name="LN8438"></a>                <span class='Declare_Local'>i2</span><span class='Delimiter'>; 
</span><a name="LN8439"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>carry</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy these values into local vars for speed in inner loop */ 
</span><a name="LN8442"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var1ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN8443"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var2ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN8444"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var1digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span><a name="LN8445"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var2digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8431"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8435"><span class='Ref_To_Local'>res_dscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Note: here we are figuring rscale in base-NBASE digits */ 
</span>    <a href="numeric.c.html#LN8433"><span class='Ref_To_Local'>rscale1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8434"><span class='Ref_To_Local'>rscale2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8432"><span class='Ref_To_Local'>res_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8433"><span class='Ref_To_Local'>rscale1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8434"><span class='Ref_To_Local'>rscale2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8430"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8432"><span class='Ref_To_Local'>res_rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8431"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8430"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN8430"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8428"><span class='Ref_To_Local'>res_buf</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN15"><span class='Ref_to_Macro'>digitbuf_alloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8430"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8428"><span class='Ref_To_Local'>res_buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* spare digit for later rounding */ 
</span>    <a href="numeric.c.html#LN8429"><span class='Ref_To_Local'>res_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8428"><span class='Ref_To_Local'>res_buf</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8437"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8432"><span class='Ref_To_Local'>res_rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8438"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8432"><span class='Ref_To_Local'>res_rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8436"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8430"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8436"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8436"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8437"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8438"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8437"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN8437"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8442"><span class='Ref_To_Local'>var1ndigits</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN8439"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN8444"><span class='Ref_To_Local'>var1digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8437"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8438"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN8438"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8443"><span class='Ref_To_Local'>var2ndigits</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN8439"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN8445"><span class='Ref_To_Local'>var2digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8438"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8439"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN8429"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8436"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN8439"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8439"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN8429"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8436"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN8439"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8439"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=res_ndigits-1;i&GT;=0;... &raquo; </span> 
 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8439"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* else we failed to allow for carry out */ 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN16"><span class='Ref_to_Macro'>digitbuf_free</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8430"><span class='Ref_To_Local'>res_ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8428"><span class='Ref_To_Local'>res_buf</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8429"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8431"><span class='Ref_To_Local'>res_weight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8435"><span class='Ref_To_Local'>res_dscale</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove leading/trailing zeroes */ 
</span>    <a href="numeric.c.html#LN531"><span class='Ref_to_Proto'>strip_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8426"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end add_abs &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * sub_abs() 
 * 
 *  Subtract the absolute value of var2 from the absolute value of var1 
 *  and store in result. result might point to one of the operands 
 *  without danger. 
 * 
 *  ABS(var1) MUST BE GREATER OR EQUAL ABS(var2) !!! 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8511"></a><span class='Declare_Function'>sub_abs</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var1</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var2</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8513"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res_buf</span><span class='Delimiter'>; 
</span><a name="LN8514"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>res_digits</span><span class='Delimiter'>; 
</span><a name="LN8515"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_ndigits</span><span class='Delimiter'>; 
</span><a name="LN8516"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_weight</span><span class='Delimiter'>; 
</span><a name="LN8517"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_rscale</span><span class='Delimiter'>, 
</span><a name="LN8518"></a>                <span class='Declare_Local'>rscale1</span><span class='Delimiter'>, 
</span><a name="LN8519"></a>                <span class='Declare_Local'>rscale2</span><span class='Delimiter'>; 
</span><a name="LN8520"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_dscale</span><span class='Delimiter'>; 
</span><a name="LN8521"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN8522"></a>                <span class='Declare_Local'>i1</span><span class='Delimiter'>, 
</span><a name="LN8523"></a>                <span class='Declare_Local'>i2</span><span class='Delimiter'>; 
</span><a name="LN8524"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>borrow</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy these values into local vars for speed in inner loop */ 
</span><a name="LN8527"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var1ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN8528"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>var2ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN8529"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var1digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span><a name="LN8530"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>var2digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8516"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8520"><span class='Ref_To_Local'>res_dscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Note: here we are figuring rscale in base-NBASE digits */ 
</span>    <a href="numeric.c.html#LN8518"><span class='Ref_To_Local'>rscale1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8519"><span class='Ref_To_Local'>rscale2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8517"><span class='Ref_To_Local'>res_rscale</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8518"><span class='Ref_To_Local'>rscale1</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8519"><span class='Ref_To_Local'>rscale2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8515"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8517"><span class='Ref_To_Local'>res_rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8516"><span class='Ref_To_Local'>res_weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8515"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN8515"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8513"><span class='Ref_To_Local'>res_buf</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN15"><span class='Ref_to_Macro'>digitbuf_alloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8515"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8513"><span class='Ref_To_Local'>res_buf</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* spare digit for later rounding */ 
</span>    <a href="numeric.c.html#LN8514"><span class='Ref_To_Local'>res_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8513"><span class='Ref_To_Local'>res_buf</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8522"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8517"><span class='Ref_To_Local'>res_rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var1</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8523"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8517"><span class='Ref_To_Local'>res_rscale</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>var2</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8521"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8515"><span class='Ref_To_Local'>res_ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8521"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8521"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8522"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8523"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8522"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN8522"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8527"><span class='Ref_To_Local'>var1ndigits</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN8524"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN8529"><span class='Ref_To_Local'>var1digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8522"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8523"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN8523"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8528"><span class='Ref_To_Local'>var2ndigits</span></a><span class='Parentheses'>) 
</span>            <a href="numeric.c.html#LN8524"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN8530"><span class='Ref_To_Local'>var2digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8523"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8524"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN8514"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8521"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN8524"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8524"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN8514"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8521"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN8524"><span class='Ref_To_Local'>borrow</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8524"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=res_ndigits-1;i&GT;=0;... &raquo; </span> 
 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8524"><span class='Ref_To_Local'>borrow</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* else caller gave us var1 &LT; var2 */ 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN16"><span class='Ref_to_Macro'>digitbuf_free</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8515"><span class='Ref_To_Local'>res_ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8513"><span class='Ref_To_Local'>res_buf</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8514"><span class='Ref_To_Local'>res_digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8516"><span class='Ref_To_Local'>res_weight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>result</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8520"><span class='Ref_To_Local'>res_dscale</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove leading/trailing zeroes */ 
</span>    <a href="numeric.c.html#LN531"><span class='Ref_to_Proto'>strip_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8511"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end sub_abs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * round_var 
 * 
 * Round the value of a variable to no more than rscale decimal digits 
 * after the decimal point.  NOTE: we allow rscale &LT; 0 here, implying 
 * rounding before the decimal point. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8593"></a><span class='Declare_Function'>round_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8595"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span><a name="LN8596"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>di</span><span class='Delimiter'>; 
</span><a name="LN8597"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span><a name="LN8598"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>carry</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* decimal digits wanted */ 
</span>    <a href="numeric.c.html#LN8596"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If di = 0, the value loses all digits, but could round up to 1 if its 
     * first extra digit is &GT;= 5.  If di &LT; 0 the result must be 0. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8596"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* NBASE digits wanted */ 
</span>        <a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8596"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 0, or number of decimal digits to keep in last NBASE digit */ 
</span>        <a href="numeric.c.html#LN8596"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>%= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>&& </span><a href="numeric.c.html#LN8596"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
            <span class='Comment_Multi_Line'>/* di must be zero */ 
</span>            <a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8595"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><a href="numeric.c.html#LN93"><span class='Ref_to_Const'>HALF_NBASE</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8596"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8595"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><a href="numeric.c.html#LN93"><span class='Ref_to_Const'>HALF_NBASE</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Must round within last NBASE digit */ 
</span><a name="LN8637"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>extra</span><span class='Delimiter'>, 
</span><a name="LN8638"></a>                            <span class='Declare_Local'>pow10</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
                <a href="numeric.c.html#LN8638"><span class='Ref_To_Local'>pow10</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN425"><span class='Ref_to_Global_Var'>round_powers</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8596"><span class='Ref_To_Local'>di</span></a><span class='Delimiter'>]; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
                <a href="numeric.c.html#LN8638"><span class='Ref_To_Local'>pow10</span></a> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
#error unsupported <a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> 
<span class='Directive'>#endif</span> 
                <a href="numeric.c.html#LN8637"><span class='Ref_To_Local'>extra</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8595"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>] </span><span class='Operator'>% </span><a href="numeric.c.html#LN8638"><span class='Ref_To_Local'>pow10</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN8595"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>] </span><span class='Operator'>-= </span><a href="numeric.c.html#LN8637"><span class='Ref_To_Local'>extra</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8637"><span class='Ref_To_Local'>extra</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN8638"><span class='Ref_To_Local'>pow10</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="numeric.c.html#LN8638"><span class='Ref_To_Local'>pow10</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN8595"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>]; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8638"><span class='Ref_To_Local'>pow10</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="numeric.c.html#LN8638"><span class='Ref_To_Local'>pow10</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                        <a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="numeric.c.html#LN8595"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN8638"><span class='Ref_To_Local'>pow10</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Directive'>#endif</span> 
 
            <span class='Comment_Multi_Line'>/* Propagate carry if needed */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>+= </span><a href="numeric.c.html#LN8595"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>]; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="numeric.c.html#LN8595"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="numeric.c.html#LN8595"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>                    <a href="numeric.c.html#LN8598"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8597"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* better not have added &GT; 1 digit */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN8593"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndigits&LT;var-&GT;ndigits|... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end round_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * trunc_var 
 * 
 * Truncate (towards zero) the value of a variable at rscale decimal digits 
 * after the decimal point.  NOTE: we allow rscale &LT; 0 here, implying 
 * truncation before the decimal point. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8699"></a><span class='Declare_Function'>trunc_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>rscale</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8701"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>di</span><span class='Delimiter'>; 
</span><a name="LN8702"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* decimal digits wanted */ 
</span>    <a href="numeric.c.html#LN8701"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>rscale</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If di &LT;= 0, the value loses all digits. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8701"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* NBASE digits wanted */ 
</span>        <a href="numeric.c.html#LN8702"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8701"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>+ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8702"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&LT;= </span><a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8702"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>1</span> 
            <span class='Comment_Multi_Line'>/* no within-digit stuff to worry about */ 
</span><span class='Directive'>#else</span> 
            <span class='Comment_Multi_Line'>/* 0, or number of decimal digits to keep in last NBASE digit */ 
</span>            <a href="numeric.c.html#LN8701"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>%= </span><a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8701"><span class='Ref_To_Local'>di</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Must truncate within last NBASE digit */ 
</span><a name="LN8736"></a>                <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8699"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span><a name="LN8737"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>extra</span><span class='Delimiter'>, 
</span><a name="LN8738"></a>                            <span class='Declare_Local'>pow10</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#if</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>4</span> 
                <a href="numeric.c.html#LN8738"><span class='Ref_To_Local'>pow10</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN425"><span class='Ref_to_Global_Var'>round_powers</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8701"><span class='Ref_To_Local'>di</span></a><span class='Delimiter'>]; 
</span><span class='Directive'>#elif</span> <a href="numeric.c.html#LN94"><span class='Ref_to_Const'>DEC_DIGITS</span></a> <span class='Operator'>== </span><span class='Number'>2</span> 
                <a href="numeric.c.html#LN8738"><span class='Ref_To_Local'>pow10</span></a> <span class='Operator'>= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
#error unsupported <a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> 
<span class='Directive'>#endif</span> 
                <a href="numeric.c.html#LN8737"><span class='Ref_To_Local'>extra</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8736"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="numeric.c.html#LN8702"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>] </span><span class='Operator'>% </span><a href="numeric.c.html#LN8738"><span class='Ref_To_Local'>pow10</span></a><span class='Delimiter'>; 
</span>                <a href="numeric.c.html#LN8736"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8702"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>] </span><span class='Operator'>-= </span><a href="numeric.c.html#LN8737"><span class='Ref_To_Local'>extra</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndigits&LT;=var-&GT;ndigits &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end trunc_var &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * strip_var 
 * 
 * Strip any leading and trailing zeroes from a numeric variable 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8761"></a><span class='Declare_Function'>strip_var</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>var</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8763"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>digits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8761"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span><a name="LN8764"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8761"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Strip leading zeroes */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8764"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& *</span><a href="numeric.c.html#LN8763"><span class='Ref_To_Local'>digits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8763"><span class='Ref_To_Local'>digits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8761"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8764"><span class='Ref_To_Local'>ndigits</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Strip trailing zeroes */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8764"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN8763"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8764"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN8764"><span class='Ref_To_Local'>ndigits</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If it's zero, normalize the sign and weight */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8764"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8761"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8761"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN8761"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8763"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8761"><span class='Ref_to_Parameter'>var</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8764"><span class='Ref_To_Local'>ndigits</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end strip_var &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------------- 
 * 
 * Fast sum accumulator functions 
 * 
 * ---------------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Reset the accumulator's value to zero.  The buffers to hold the digits 
 * are not free'd. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8802"></a><span class='Declare_Function'>accum_sum_reset</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8804"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8802"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN339"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8804"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8804"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8802"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN8804"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8802"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8804"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8802"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8804"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Accumulate a new value. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8818"></a><span class='Declare_Function'>accum_sum_add</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8820"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>accum_digits</span><span class='Delimiter'>; 
</span><a name="LN8821"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN8822"></a>                <span class='Declare_Local'>val_i</span><span class='Delimiter'>; 
</span><a name="LN8823"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>val_ndigits</span><span class='Delimiter'>; 
</span><a name="LN8824"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN14"><span class='Ref_to_Typedef'>NumericDigit</span></a> <span class='Operator'>*</span><span class='Declare_Local'>val_digits</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we have accumulated too many values since the last carry 
     * propagation, do it now, to avoid overflowing.  (We could allow more 
     * than NBASE - 1, if we reserved two extra digits, rather than one, for 
     * carry propagation.  But even with NBASE - 1, this needs to be done so 
     * seldom, that the performance difference is negligible.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN340"><span class='Ref_to_Member'>num_uncarried</span></a> <span class='Operator'>== </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN537"><span class='Ref_to_Proto'>accum_sum_carry</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>accum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Adjust the weight or scale of the old value, so that it can accommodate 
     * the new value. 
     */ 
</span>    <a href="numeric.c.html#LN536"><span class='Ref_to_Proto'>accum_sum_rescale</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>accum</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN8820"><span class='Ref_To_Local'>accum_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="numeric.c.html#LN8820"><span class='Ref_To_Local'>accum_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy these values into local vars for speed in loop */ 
</span>    <a href="numeric.c.html#LN8823"><span class='Ref_To_Local'>val_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8824"><span class='Ref_To_Local'>val_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8821"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN338"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8822"><span class='Ref_To_Local'>val_i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8822"><span class='Ref_To_Local'>val_i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN8823"><span class='Ref_To_Local'>val_ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN8822"><span class='Ref_To_Local'>val_i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8820"><span class='Ref_To_Local'>accum_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8821"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN8824"><span class='Ref_To_Local'>val_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8822"><span class='Ref_To_Local'>val_i</span></a><span class='Delimiter'>]; 
</span>        <a href="numeric.c.html#LN8821"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="numeric.c.html#LN8818"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN340"><span class='Ref_to_Member'>num_uncarried</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end accum_sum_add &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Propagate carries. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8866"></a><span class='Declare_Function'>accum_sum_carry</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8868"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN8869"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndigits</span><span class='Delimiter'>; 
</span><a name="LN8870"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dig</span><span class='Delimiter'>; 
</span><a name="LN8871"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>carry</span><span class='Delimiter'>; 
</span><a name="LN8872"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>newdig</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If no new values have been added since last carry propagation, nothing 
     * to do. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8866"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN340"><span class='Ref_to_Member'>num_uncarried</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We maintain that the weight of the accumulator is always one larger 
     * than needed to hold the current value, before carrying, to make sure 
     * there is enough space for the possible extra digit when carry is 
     * propagated.  We cannot expand the buffer here, unless we require 
     * callers of accum_sum_final() to switch to the right memory context. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8866"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN8866"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8869"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8866"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Propagate carry in the positive sum */ 
</span>    <a href="numeric.c.html#LN8870"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8866"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8869"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8870"><span class='Ref_To_Local'>dig</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8870"><span class='Ref_To_Local'>dig</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* Did we use up the digit reserved for carry propagation? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN8866"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN341"><span class='Ref_to_Member'>have_carry_space</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* And the same for the negative sum */ 
</span>    <a href="numeric.c.html#LN8870"><span class='Ref_To_Local'>dig</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8866"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8869"><span class='Ref_To_Local'>ndigits</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8870"><span class='Ref_To_Local'>dig</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>+ </span><a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>/ </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>            <a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>-= </span><a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>* </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="numeric.c.html#LN8871"><span class='Ref_To_Local'>carry</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8870"><span class='Ref_To_Local'>dig</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8868"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8872"><span class='Ref_To_Local'>newdig</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN8866"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN341"><span class='Ref_to_Member'>have_carry_space</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8866"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN340"><span class='Ref_to_Member'>num_uncarried</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end accum_sum_carry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Re-scale accumulator to accommodate new value. 
 * 
 * If the new value has more digits than the current digit buffers in the 
 * accumulator, enlarge the buffers. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN8939"></a><span class='Declare_Function'>accum_sum_rescale</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN8941"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>old_weight</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN338"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span><a name="LN8942"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>old_ndigits</span> <span class='Operator'>= </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span><a name="LN8943"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>accum_ndigits</span><span class='Delimiter'>; 
</span><a name="LN8944"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>accum_weight</span><span class='Delimiter'>; 
</span><a name="LN8945"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>accum_rscale</span><span class='Delimiter'>; 
</span><a name="LN8946"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>val_rscale</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN8944"><span class='Ref_To_Local'>accum_weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8941"><span class='Ref_To_Local'>old_weight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8942"><span class='Ref_To_Local'>old_ndigits</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Does the new value have a larger weight? If so, enlarge the buffers, 
     * and shift the existing value to the new weight, by adding leading 
     * zeros. 
     * 
     * We enforce that the accumulator always has a weight one larger than 
     * needed for the inputs, so that we have space for an extra digit at the 
     * final carry-propagation phase, if necessary. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>&GT;= </span><a href="numeric.c.html#LN8944"><span class='Ref_To_Local'>accum_weight</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8944"><span class='Ref_To_Local'>accum_weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8944"><span class='Ref_To_Local'>accum_weight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8941"><span class='Ref_To_Local'>old_weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Even though the new value is small, we might've used up the space 
     * reserved for the carry digit in the last call to accum_sum_carry().  If 
     * so, enlarge to make room for another one. 
     */ 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN341"><span class='Ref_to_Member'>have_carry_space</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN8944"><span class='Ref_To_Local'>accum_weight</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Is the new value wider on the right side? */ 
</span>    <a href="numeric.c.html#LN8945"><span class='Ref_To_Local'>accum_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8944"><span class='Ref_To_Local'>accum_weight</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN8946"><span class='Ref_To_Local'>val_rscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8946"><span class='Ref_To_Local'>val_rscale</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN8945"><span class='Ref_To_Local'>accum_rscale</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8946"><span class='Ref_To_Local'>val_rscale</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8945"><span class='Ref_To_Local'>accum_rscale</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a> <span class='Operator'>!= </span><a href="numeric.c.html#LN8942"><span class='Ref_To_Local'>old_ndigits</span></a> <span class='Operator'>|| 
</span>        <a href="numeric.c.html#LN8944"><span class='Ref_To_Local'>accum_weight</span></a> <span class='Operator'>!= </span><a href="numeric.c.html#LN8941"><span class='Ref_To_Local'>old_weight</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN8986"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>new_pos_digits</span><span class='Delimiter'>; 
</span><a name="LN8987"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>new_neg_digits</span><span class='Delimiter'>; 
</span><a name="LN8988"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>weightdiff</span><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN8988"><span class='Ref_To_Local'>weightdiff</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8944"><span class='Ref_To_Local'>accum_weight</span></a> <span class='Operator'>- </span><a href="numeric.c.html#LN8941"><span class='Ref_To_Local'>old_weight</span></a><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN8986"><span class='Ref_To_Local'>new_pos_digits</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8987"><span class='Ref_To_Local'>new_neg_digits</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8986"><span class='Ref_To_Local'>new_pos_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8988"><span class='Ref_To_Local'>weightdiff</span></a><span class='Delimiter'>], </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>, 
</span>                   <a href="numeric.c.html#LN8942"><span class='Ref_To_Local'>old_ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            memcpy<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN8987"><span class='Ref_To_Local'>new_neg_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN8988"><span class='Ref_To_Local'>weightdiff</span></a><span class='Delimiter'>], </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>, 
</span>                   <a href="numeric.c.html#LN8942"><span class='Ref_To_Local'>old_ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8986"><span class='Ref_To_Local'>new_pos_digits</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8987"><span class='Ref_To_Local'>new_neg_digits</span></a><span class='Delimiter'>; 
</span> 
        <a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN338"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8944"><span class='Ref_To_Local'>accum_weight</span></a><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8943"><span class='Ref_To_Local'>accum_ndigits</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN341"><span class='Ref_to_Member'>have_carry_space</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if accum_ndigits!=old_nd... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>&GT; </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN339"><span class='Ref_to_Member'>dscale</span></a><span class='Parentheses'>) 
</span>        <a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN339"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN8939"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end accum_sum_rescale &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Return the current value of the accumulator.  This perform final carry 
 * propagation, and adds together the positive and negative sums. 
 * 
 * Unlike all the other routines, the caller is not required to switch to 
 * the memory context that holds the accumulator. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN9028"></a><span class='Declare_Function'>accum_sum_final</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN9030"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN9031"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>pos_var</span><span class='Delimiter'>; 
</span><a name="LN9032"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>neg_var</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="numeric.c.html#LN469"><span class='Ref_to_Proto'>set_var_from_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN370"><span class='Ref_to_Global_Var'>const_zero</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Perform final carry */ 
</span>    <a href="numeric.c.html#LN537"><span class='Ref_to_Proto'>accum_sum_carry</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create NumericVars representing the positive and negative sums */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN9031"><span class='Ref_To_Local'>pos_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN9032"><span class='Ref_To_Local'>neg_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN9031"><span class='Ref_To_Local'>pos_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9032"><span class='Ref_To_Local'>neg_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN270"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9031"><span class='Ref_To_Local'>pos_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9032"><span class='Ref_To_Local'>neg_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN271"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN338"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9031"><span class='Ref_To_Local'>pos_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9032"><span class='Ref_To_Local'>neg_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN273"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN339"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9031"><span class='Ref_To_Local'>pos_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN3"><span class='Ref_to_Const'>NUMERIC_POS</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9032"><span class='Ref_To_Local'>neg_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN272"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/include/pgtypes_numeric.h.html#LN4"><span class='Ref_to_Const'>NUMERIC_NEG</span></a><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN9031"><span class='Ref_To_Local'>pos_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9031"><span class='Ref_To_Local'>pos_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN15"><span class='Ref_to_Macro'>digitbuf_alloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9032"><span class='Ref_To_Local'>neg_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN274"><span class='Ref_to_Member'>buf</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9032"><span class='Ref_To_Local'>neg_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN15"><span class='Ref_to_Macro'>digitbuf_alloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="numeric.c.html#LN9030"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="numeric.c.html#LN9030"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; </span><a href="numeric.c.html#LN9030"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN9030"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN9031"><span class='Ref_To_Local'>pos_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN9030"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN9030"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN9030"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><a href="numeric.c.html#LN92"><span class='Ref_to_Const'>NBASE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="numeric.c.html#LN9032"><span class='Ref_To_Local'>neg_var</span></a><span class='Operator'>.</span><a href="numeric.c.html#LN275"><span class='Ref_to_Member'>digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN9030"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a><span class='Parentheses'>) </span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>accum</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>[</span><a href="numeric.c.html#LN9030"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* And add them together */ 
</span>    <a href="numeric.c.html#LN500"><span class='Ref_to_Proto'>add_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN9031"><span class='Ref_To_Local'>pos_var</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN9032"><span class='Ref_To_Local'>neg_var</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove leading/trailing zeroes */ 
</span>    <a href="numeric.c.html#LN531"><span class='Ref_to_Proto'>strip_var</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN9028"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end accum_sum_final &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Copy an accumulator's state. 
 * 
 * 'dst' is assumed to be uninitialized beforehand.  No attempt is made at 
 * freeing old values. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN9079"></a><span class='Declare_Function'>accum_sum_copy</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN342"><span class='Ref_to_Member'>pos_digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN343"><span class='Ref_to_Member'>neg_digits</span></a><span class='Delimiter'>, </span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN340"><span class='Ref_to_Member'>num_uncarried</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN340"><span class='Ref_to_Member'>num_uncarried</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN337"><span class='Ref_to_Member'>ndigits</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN338"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN338"><span class='Ref_to_Member'>weight</span></a><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>dst</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN339"><span class='Ref_to_Member'>dscale</span></a> <span class='Operator'>= </span><a href="numeric.c.html#LN9079"><span class='Ref_to_Parameter'>src</span></a><span class='Operator'>-&GT;</span><a href="numeric.c.html#LN339"><span class='Ref_to_Member'>dscale</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Add the current value of 'accum2' into 'accum'. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN9096"></a><span class='Declare_Function'>accum_sum_combine</span><span class='Parentheses'>(</span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum</span><span class='Delimiter'>, </span><a href="numeric.c.html#LN335"><span class='Ref_to_Struct'>NumericSumAccum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>accum2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN9098"></a>    <a href="numeric.c.html#LN268"><span class='Ref_to_Struct'>NumericVar</span></a>  <span class='Declare_Local'>tmp_var</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN13"><span class='Ref_to_Macro'>init_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN9098"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN539"><span class='Ref_to_Proto'>accum_sum_final</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN9096"><span class='Ref_to_Parameter'>accum2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN9098"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="numeric.c.html#LN535"><span class='Ref_to_Proto'>accum_sum_add</span></a><span class='Parentheses'>(</span><a href="numeric.c.html#LN9096"><span class='Ref_to_Parameter'>accum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="numeric.c.html#LN9098"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="numeric.c.html#LN462"><span class='Ref_to_Proto'>free_var</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="numeric.c.html#LN9098"><span class='Ref_To_Local'>tmp_var</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>