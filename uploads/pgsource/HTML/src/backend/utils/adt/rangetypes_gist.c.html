<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\rangetypes_gist.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\rangetypes_gist.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:53 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * rangetypes_gist.c 
 *    GiST support for range types. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/rangetypes_gist.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/gist.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/stratnum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rangetypes.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Range class properties used to segregate different classes of ranges in 
 * GiST.  Each unique combination of properties is a class.  CLS_EMPTY cannot 
 * be combined with anything else. 
 */ 
</span><a name="LN28"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CLS_NORMAL</span>          <span class='Number'>0</span>   <span class='Comment_Single_Line'>/* Ordinary finite range (no bits set) */ 
</span><a name="LN29"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CLS_LOWER_INF</span>       <span class='Number'>1</span>   <span class='Comment_Single_Line'>/* Lower bound is infinity */ 
</span><a name="LN30"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CLS_UPPER_INF</span>       <span class='Number'>2</span>   <span class='Comment_Single_Line'>/* Upper bound is infinity */ 
</span><a name="LN31"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CLS_CONTAIN_EMPTY</span>   <span class='Number'>4</span>   <span class='Comment_Single_Line'>/* Contains underlying empty ranges */ 
</span><a name="LN32"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CLS_EMPTY</span>           <span class='Number'>8</span>   <span class='Comment_Single_Line'>/* Special class for empty ranges */ 
</span> 
<a name="LN34"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CLS_COUNT</span>           <span class='Number'>9</span>   <span class='Comment_Multi_Line'>/* # of classes; includes all combinations of 
                                 * properties. CLS_EMPTY doesn't combine with 
                                 * anything else, so it's only 2^3 + 1. */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Minimum accepted ratio of split for items of the same class.  If the items 
 * are of different classes, we will separate along those lines regardless of 
 * the ratio. 
 */ 
</span><a name="LN43"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LIMIT_RATIO</span>  <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>3</span> 
 
<span class='Comment_Multi_Line'>/* Constants for fixed penalty values */ 
</span><a name="LN46"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>INFINITE_BOUND_PENALTY</span>  <span class='Number'>2</span><span class='Operator'>.</span><span class='Number'>0</span> 
<a name="LN47"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CONTAIN_EMPTY_PENALTY</span>  <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> 
<a name="LN48"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>DEFAULT_SUBTYPE_DIFF_PENALTY</span>  <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Per-item data for range_gist_single_sorting_split. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN55"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>index</span><span class='Delimiter'>; 
</span><a name="LN56"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Member'>bound</span><span class='Delimiter'>; 
</span><a name="LN57"></a>} <span class='Declare_Typedef'>SingleBoundSortItem</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* place on left or right side of split? */ 
</span><span class='Control'>typedef</span> <span class='Control'>enum</span> 
<span class='Delimiter'>{ 
</span><a name="LN62"></a>    <span class='Declare_Enum_Const'>SPLIT_LEFT</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>,</span>             <span class='Comment_Single_Line'>/* makes initialization to SPLIT_LEFT easier */ 
</span><a name="LN63"></a>    <span class='Declare_Enum_Const'>SPLIT_RIGHT</span> 
<a name="LN64"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>SplitLR</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Context for range_gist_consider_split. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN71"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Member'>typcache</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* typcache for range type */ 
</span><a name="LN72"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>has_subtype_diff</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* does it have subtype_diff? */ 
</span><a name="LN73"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>entries_count</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* total number of entries being split */ 
</span> 
    <span class='Comment_Multi_Line'>/* Information about currently selected split follows */ 
</span> 
<a name="LN77"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>first</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* true if no split was selected yet */ 
</span> 
<a name="LN79"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Member'>left_upper</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* upper bound of left interval */ 
</span><a name="LN80"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Member'>right_lower</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* lower bound of right interval */ 
</span> 
<a name="LN82"></a>    <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Member'>ratio</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* split ratio */ 
</span><a name="LN83"></a>    <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Member'>overlap</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* overlap between left and right predicate */ 
</span><a name="LN84"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>common_left</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* # common entries destined for each side */ 
</span><a name="LN85"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>common_right</span><span class='Delimiter'>; 
</span><a name="LN86"></a>} <span class='Declare_Typedef'>ConsiderSplitContext</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Bounds extracted from a non-empty range, for use in 
 * range_gist_double_sorting_split. 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN94"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Member'>lower</span><span class='Delimiter'>; 
</span><a name="LN95"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Member'>upper</span><span class='Delimiter'>; 
</span><a name="LN96"></a>} <span class='Declare_Typedef'>NonEmptyRange</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Represents information about an entry that can be placed in either group 
 * without affecting overlap over selected axis ("common entry"). 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Index of entry in the initial array */ 
</span><a name="LN105"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>index</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Delta between closeness of range to each of the two groups */ 
</span><a name="LN107"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>delta</span><span class='Delimiter'>; 
</span><a name="LN108"></a>} <span class='Declare_Typedef'>CommonEntry</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Helper macros to place an entry in the left or right group during split */ 
/* Note direct access to variables v, typcache, left_range, right_range */ 
</span><a name="LN112"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PLACE_LEFT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>range</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>off</span><span class='Parentheses'>)</span>                  <span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{</span>                                        <span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>v<span class='Operator'>-&GT;</span>spl_nleft <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>                   <span class='Operator'>\ 
</span>            left_range <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN135"><span class='Ref_to_Proto'>range_super_union</span></a><span class='Parentheses'>(</span>typcache<span class='Delimiter'>, </span>left_range<span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN112"><span class='Ref_to_Parameter'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>else</span>                                    <span class='Operator'>\ 
</span>            left_range <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN112"><span class='Ref_to_Parameter'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>               <span class='Operator'>\ 
</span>        v<span class='Operator'>-&GT;</span>spl_left<span class='Delimiter'>[</span>v<span class='Operator'>-&GT;</span>spl_nleft<span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN112"><span class='Ref_to_Parameter'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN121"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PLACE_RIGHT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>range</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>off</span><span class='Parentheses'>)</span>                 <span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{</span>                                        <span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>v<span class='Operator'>-&GT;</span>spl_nright <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span>                  <span class='Operator'>\ 
</span>            right_range <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN135"><span class='Ref_to_Proto'>range_super_union</span></a><span class='Parentheses'>(</span>typcache<span class='Delimiter'>, </span>right_range<span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN121"><span class='Ref_to_Parameter'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Control'>else</span>                                    <span class='Operator'>\ 
</span>            right_range <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN121"><span class='Ref_to_Parameter'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>              <span class='Operator'>\ 
</span>        v<span class='Operator'>-&GT;</span>spl_right<span class='Delimiter'>[</span>v<span class='Operator'>-&GT;</span>spl_nright<span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN121"><span class='Ref_to_Parameter'>off</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>  <span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* Copy a RangeType datum (hardwires typbyval and typlen for ranges...) */ 
</span><a name="LN131"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>rangeCopy</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>r</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>((</span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN131"><span class='Ref_to_Parameter'>r</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                                             <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)))</span> 
 
<a name="LN135"></a><span class='Keyword'>static </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>range_super_union</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>r1</span><span class='Delimiter'>, 
</span><a name="LN136"></a>                  <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>r2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN137"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>range_gist_consistent_int</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN138"></a>                          <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN139"></a>                          <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>query</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN140"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>range_gist_consistent_leaf</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN141"></a>                           <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN142"></a>                           <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>query</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN143"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>range_gist_fallback_split</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN144"></a>                          <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, 
</span><a name="LN145"></a>                          <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN146"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>range_gist_class_split</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN147"></a>                       <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, 
</span><a name="LN148"></a>                       <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, 
</span><a name="LN149"></a>                       <a href="rangetypes_gist.c.html#LN60"><span class='Ref_to_Typedef'>SplitLR</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>classes_groups</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN150"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>range_gist_single_sorting_split</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN151"></a>                                <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, 
</span><a name="LN152"></a>                                <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, 
</span><a name="LN153"></a>                                <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_upper_bound</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN154"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>range_gist_double_sorting_split</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN155"></a>                                <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, 
</span><a name="LN156"></a>                                <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN157"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>range_gist_consider_split</span><span class='Parentheses'>(</span><a href="../../access/gist/gistproc.c.html#LN309"><span class='Ref_to_Typedef'>ConsiderSplitContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, 
</span><a name="LN158"></a>                          <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>right_lower</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>min_left_count</span><span class='Delimiter'>, 
</span><a name="LN159"></a>                          <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>left_upper</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>max_left_count</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>get_gist_range_class</span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>range</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN161"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>single_bound_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN162"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>interval_cmp_lower</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN163"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>interval_cmp_upper</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN164"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>common_entry_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN165"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> <span class='Declare_Prototype'>call_subtype_diff</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN166"></a>                  <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>val1</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>val2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* GiST query consistency check */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN171"></a><span class='Declare_Function'>range_gist_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN173"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN174"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN175"></a>    <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN236"><span class='Ref_to_Macro'>PG_GETARG_UINT16</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Oid subtype = PG_GETARG_OID(3); */ 
</span><a name="LN178"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>recheck</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN179"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>key</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN173"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN180"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* All operators served by this function are exact */ 
</span>    <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN178"><span class='Ref_To_Local'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN180"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN179"><span class='Ref_To_Local'>key</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN132"><span class='Ref_to_Macro'>GIST_LEAF</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN173"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN140"><span class='Ref_to_Proto'>range_gist_consistent_leaf</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN180"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN175"><span class='Ref_To_Local'>strategy</span></a><span class='Delimiter'>, 
</span>                                                  <a href="rangetypes_gist.c.html#LN179"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN174"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN137"><span class='Ref_to_Proto'>range_gist_consistent_int</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN180"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN175"><span class='Ref_To_Local'>strategy</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_gist.c.html#LN179"><span class='Ref_To_Local'>key</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN174"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_gist_consistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* form union range */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN197"></a><span class='Declare_Function'>range_gist_union</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN199"></a>    <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>entryvec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN200"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ent</span> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN199"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>; 
</span><a name="LN201"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result_range</span><span class='Delimiter'>; 
</span><a name="LN202"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span><a name="LN203"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN201"><span class='Ref_To_Local'>result_range</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN200"><span class='Ref_To_Local'>ent</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN202"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN201"><span class='Ref_To_Local'>result_range</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN199"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_gist.c.html#LN201"><span class='Ref_To_Local'>result_range</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN135"><span class='Ref_to_Proto'>range_super_union</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN202"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN201"><span class='Ref_To_Local'>result_range</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN200"><span class='Ref_To_Local'>ent</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/rangetypes.h.html#LN75"><span class='Ref_to_Macro'>PG_RETURN_RANGE</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN201"><span class='Ref_To_Local'>result_range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_gist_union &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* compress, decompress, fetch are no-ops */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN220"></a><span class='Declare_Function'>range_gist_compress</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN222"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN222"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN228"></a><span class='Declare_Function'>range_gist_decompress</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN230"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN230"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN236"></a><span class='Declare_Function'>range_gist_fetch</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN238"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN238"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GiST page split penalty function. 
 * 
 * The penalty function has the following goals (in order from most to least 
 * important): 
 * - Keep normal ranges separate 
 * - Avoid broadening the class of the original predicate 
 * - Avoid broadening (as determined by subtype_diff) the original predicate 
 * - Favor adding ranges to narrower original predicates 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN254"></a><span class='Declare_Function'>range_gist_penalty</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN256"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>origentry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN257"></a>    <a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>newentry</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN120"><span class='Ref_to_Struct'>GISTENTRY</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN258"></a>    <span class='Keyword'>float</span>      <span class='Operator'>*</span><span class='Declare_Local'>penalty</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>float </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN259"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>orig</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN256"><span class='Ref_To_Local'>origentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN260"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>new</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN257"><span class='Ref_To_Local'>newentry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN261"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span><a name="LN262"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_subtype_diff</span><span class='Delimiter'>; 
</span><a name="LN263"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>orig_lower</span><span class='Delimiter'>, 
</span><a name="LN264"></a>                <span class='Declare_Local'>new_lower</span><span class='Delimiter'>, 
</span><a name="LN265"></a>                <span class='Declare_Local'>orig_upper</span><span class='Delimiter'>, 
</span><a name="LN266"></a>                <span class='Declare_Local'>new_upper</span><span class='Delimiter'>; 
</span><a name="LN267"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>orig_empty</span><span class='Delimiter'>, 
</span><a name="LN268"></a>                <span class='Declare_Local'>new_empty</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN259"><span class='Ref_To_Local'>orig</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><span class='Control'>new</span><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"range types do not match"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN259"><span class='Ref_To_Local'>orig</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN262"><span class='Ref_To_Local'>has_subtype_diff</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN259"><span class='Ref_To_Local'>orig</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN267"><span class='Ref_To_Local'>orig_empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Control'>new</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN264"><span class='Ref_To_Local'>new_lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN266"><span class='Ref_To_Local'>new_upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN268"><span class='Ref_To_Local'>new_empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Distinct branches for handling distinct classes of ranges.  Note that 
     * penalty values only need to be commensurate within the same class of 
     * new range. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN268"><span class='Ref_To_Local'>new_empty</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Handle insertion of empty range */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN267"><span class='Ref_To_Local'>orig_empty</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * The best case is to insert it to empty original range. 
             * Insertion here means no broadening of original range. Also 
             * original range is the most narrow. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN54"><span class='Ref_to_Macro'>RangeIsOrContainsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN259"><span class='Ref_To_Local'>orig</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * The second case is to insert empty range into range which 
             * contains at least one underlying empty range.  There is still 
             * no broadening of original range, but original range is not as 
             * narrow as possible. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN47"><span class='Ref_to_Const'>CONTAIN_EMPTY_PENALTY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Original range requires broadening.  (-inf; +inf) is most far 
             * from normal range in this case. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="rangetypes_gist.c.html#LN47"><span class='Ref_to_Const'>CONTAIN_EMPTY_PENALTY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>|| </span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * (-inf, x) or (x, +inf) original ranges are closer to normal 
             * ranges, so it's worse to mix it with empty ranges. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>3</span> <span class='Operator'>* </span><a href="rangetypes_gist.c.html#LN47"><span class='Ref_to_Const'>CONTAIN_EMPTY_PENALTY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * The least preferred case is broadening of normal range. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>4</span> <span class='Operator'>* </span><a href="rangetypes_gist.c.html#LN47"><span class='Ref_to_Const'>CONTAIN_EMPTY_PENALTY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if new_empty &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN264"><span class='Ref_To_Local'>new_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN266"><span class='Ref_To_Local'>new_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Handle insertion of (-inf, +inf) range */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Best case is inserting to (-inf, +inf) original range. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>|| </span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * When original range is (-inf, x) or (x, +inf) it requires 
             * broadening of original range (extension of one bound to 
             * infinity). 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN46"><span class='Ref_to_Const'>INFINITE_BOUND_PENALTY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Insertion to normal original range is least preferred. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>2</span> <span class='Operator'>* </span><a href="rangetypes_gist.c.html#LN46"><span class='Ref_to_Const'>INFINITE_BOUND_PENALTY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN54"><span class='Ref_to_Macro'>RangeIsOrContainsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN259"><span class='Ref_To_Local'>orig</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Original range is narrower when it doesn't contain empty 
             * ranges. Add additional penalty otherwise. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>+= </span><a href="rangetypes_gist.c.html#LN47"><span class='Ref_to_Const'>CONTAIN_EMPTY_PENALTY</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if new_lower.infinite&&n... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN264"><span class='Ref_To_Local'>new_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Handle insertion of (-inf, x) range */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_gist.c.html#LN267"><span class='Ref_To_Local'>orig_empty</span></a> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * (-inf, +inf) range won't be extended by insertion of (-inf, 
                 * x) range. It's a less desirable case than insertion to 
                 * (-inf, y) original range without extension, because in that 
                 * case original range is narrower. But we can't express that 
                 * in single float value. 
                 */ 
</span>                <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN266"><span class='Ref_To_Local'>new_upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Get extension of original range using subtype_diff. Use 
                     * constant if subtype_diff unavailable. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN262"><span class='Ref_To_Local'>has_subtype_diff</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN165"><span class='Ref_to_Proto'>call_subtype_diff</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, 
</span>                                                     <a href="rangetypes_gist.c.html#LN266"><span class='Ref_To_Local'>new_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                                     <a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN48"><span class='Ref_to_Const'>DEFAULT_SUBTYPE_DIFF_PENALTY</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* No extension of original range */ 
</span>                    <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !orig_empty&&orig_low... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If lower bound of original range is not -inf, then extension of 
             * it is infinity. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN56"><span class='Ref_to_Proto'>get_float4_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if new_lower.infinite &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN266"><span class='Ref_To_Local'>new_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Handle insertion of (x, +inf) range */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_gist.c.html#LN267"><span class='Ref_To_Local'>orig_empty</span></a> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * (-inf, +inf) range won't be extended by insertion of (x, 
                 * +inf) range. It's a less desirable case than insertion to 
                 * (y, +inf) original range without extension, because in that 
                 * case original range is narrower. But we can't express that 
                 * in single float value. 
                 */ 
</span>                <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN264"><span class='Ref_To_Local'>new_lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * Get extension of original range using subtype_diff. Use 
                     * constant if subtype_diff unavailable. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN262"><span class='Ref_To_Local'>has_subtype_diff</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN165"><span class='Ref_to_Proto'>call_subtype_diff</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, 
</span>                                                     <a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                                     <a href="rangetypes_gist.c.html#LN264"><span class='Ref_To_Local'>new_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN48"><span class='Ref_to_Const'>DEFAULT_SUBTYPE_DIFF_PENALTY</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* No extension of original range */ 
</span>                    <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !orig_empty&&orig_upp... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If upper bound of original range is not +inf, then extension of 
             * it is infinity. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN56"><span class='Ref_to_Proto'>get_float4_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if new_upper.infinite &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Handle insertion of normal (non-empty, non-infinite) range */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN267"><span class='Ref_To_Local'>orig_empty</span></a> <span class='Operator'>|| </span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>|| </span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Avoid mixing normal ranges with infinite and empty ranges. 
             */ 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN56"><span class='Ref_to_Proto'>get_float4_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Calculate extension of original range by calling subtype_diff. 
             * Use constant if subtype_diff unavailable. 
             */ 
</span><a name="LN477"></a>            <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>diff</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN264"><span class='Ref_To_Local'>new_lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN262"><span class='Ref_To_Local'>has_subtype_diff</span></a><span class='Parentheses'>) 
</span>                    <a href="rangetypes_gist.c.html#LN477"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>+= </span><a href="rangetypes_gist.c.html#LN165"><span class='Ref_to_Proto'>call_subtype_diff</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, 
</span>                                              <a href="rangetypes_gist.c.html#LN263"><span class='Ref_To_Local'>orig_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                              <a href="rangetypes_gist.c.html#LN264"><span class='Ref_To_Local'>new_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="rangetypes_gist.c.html#LN477"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>+= </span><a href="rangetypes_gist.c.html#LN48"><span class='Ref_to_Const'>DEFAULT_SUBTYPE_DIFF_PENALTY</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN266"><span class='Ref_To_Local'>new_upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN262"><span class='Ref_To_Local'>has_subtype_diff</span></a><span class='Parentheses'>) 
</span>                    <a href="rangetypes_gist.c.html#LN477"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>+= </span><a href="rangetypes_gist.c.html#LN165"><span class='Ref_to_Proto'>call_subtype_diff</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN261"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, 
</span>                                              <a href="rangetypes_gist.c.html#LN266"><span class='Ref_To_Local'>new_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                              <a href="rangetypes_gist.c.html#LN265"><span class='Ref_To_Local'>orig_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="rangetypes_gist.c.html#LN477"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>+= </span><a href="rangetypes_gist.c.html#LN48"><span class='Ref_to_Const'>DEFAULT_SUBTYPE_DIFF_PENALTY</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN477"><span class='Ref_To_Local'>diff</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN258"><span class='Ref_To_Local'>penalty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_gist_penalty &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * The GiST PickSplit method for ranges 
 * 
 * Primarily, we try to segregate ranges of different classes.  If splitting 
 * ranges of the same class, use the appropriate split method for that class. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN511"></a><span class='Declare_Function'>range_gist_picksplit</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN513"></a>    <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>entryvec</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN514"></a>    <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN515"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span><a name="LN516"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN517"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>pred_left</span><span class='Delimiter'>; 
</span><a name="LN518"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN519"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>maxoff</span><span class='Delimiter'>; 
</span><a name="LN520"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>count_in_classes</span><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN34"><span class='Ref_to_Const'>CLS_COUNT</span></a><span class='Delimiter'>]; 
</span><a name="LN521"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN522"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>non_empty_classes_count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN523"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>biggest_class</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN524"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>biggest_class_count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN525"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>total_count</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* use first item to look up range type's info */ 
</span>    <a href="rangetypes_gist.c.html#LN517"><span class='Ref_To_Local'>pred_left</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN513"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN515"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN517"><span class='Ref_To_Local'>pred_left</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN519"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN513"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN518"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN519"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN514"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN518"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN514"><span class='Ref_To_Local'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN518"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Get count distribution of range classes. 
     */ 
</span>    memset<span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN516"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN516"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_gist.c.html#LN519"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN516"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN516"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN542"></a>        <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN513"><span class='Ref_To_Local'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN516"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN160"><span class='Ref_to_Proto'>get_gist_range_class</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN542"><span class='Ref_To_Local'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>]</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Count non-empty classes and find biggest class. 
     */ 
</span>    <a href="rangetypes_gist.c.html#LN525"><span class='Ref_To_Local'>total_count</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN519"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN521"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN521"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN34"><span class='Ref_to_Const'>CLS_COUNT</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="rangetypes_gist.c.html#LN524"><span class='Ref_To_Local'>biggest_class_count</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="rangetypes_gist.c.html#LN524"><span class='Ref_To_Local'>biggest_class_count</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]; 
</span>                <a href="rangetypes_gist.c.html#LN523"><span class='Ref_To_Local'>biggest_class</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN521"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="rangetypes_gist.c.html#LN522"><span class='Ref_To_Local'>non_empty_classes_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN522"><span class='Ref_To_Local'>non_empty_classes_count</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN522"><span class='Ref_To_Local'>non_empty_classes_count</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* One non-empty class, so split inside class */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="rangetypes_gist.c.html#LN523"><span class='Ref_To_Local'>biggest_class</span></a> <span class='Operator'>& ~</span><a href="rangetypes_gist.c.html#LN31"><span class='Ref_to_Const'>CLS_CONTAIN_EMPTY</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="rangetypes_gist.c.html#LN28"><span class='Ref_to_Const'>CLS_NORMAL</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* double sorting split for normal ranges */ 
</span>            <a href="rangetypes_gist.c.html#LN154"><span class='Ref_to_Proto'>range_gist_double_sorting_split</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN515"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN513"><span class='Ref_To_Local'>entryvec</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN514"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="rangetypes_gist.c.html#LN523"><span class='Ref_To_Local'>biggest_class</span></a> <span class='Operator'>& ~</span><a href="rangetypes_gist.c.html#LN31"><span class='Ref_to_Const'>CLS_CONTAIN_EMPTY</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="rangetypes_gist.c.html#LN29"><span class='Ref_to_Const'>CLS_LOWER_INF</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* upper bound sorting split for (-inf, x) ranges */ 
</span>            <a href="rangetypes_gist.c.html#LN150"><span class='Ref_to_Proto'>range_gist_single_sorting_split</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN515"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN513"><span class='Ref_To_Local'>entryvec</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN514"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="rangetypes_gist.c.html#LN523"><span class='Ref_To_Local'>biggest_class</span></a> <span class='Operator'>& ~</span><a href="rangetypes_gist.c.html#LN31"><span class='Ref_to_Const'>CLS_CONTAIN_EMPTY</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="rangetypes_gist.c.html#LN30"><span class='Ref_to_Const'>CLS_UPPER_INF</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* lower bound sorting split for (x, +inf) ranges */ 
</span>            <a href="rangetypes_gist.c.html#LN150"><span class='Ref_to_Proto'>range_gist_single_sorting_split</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN515"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN513"><span class='Ref_To_Local'>entryvec</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN514"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* trivial split for all (-inf, +inf) or all empty ranges */ 
</span>            <a href="rangetypes_gist.c.html#LN143"><span class='Ref_to_Proto'>range_gist_fallback_split</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN515"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN513"><span class='Ref_To_Local'>entryvec</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN514"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if non_empty_classes_cou... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Class based split. 
         * 
         * To which side of the split should each class go?  Initialize them 
         * all to go to the left side. 
         */ 
</span><a name="LN598"></a>        <a href="rangetypes_gist.c.html#LN60"><span class='Ref_to_Typedef'>SplitLR</span></a>     <span class='Declare_Local'>classes_groups</span><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN34"><span class='Ref_to_Const'>CLS_COUNT</span></a><span class='Delimiter'>]; 
</span> 
        memset<span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN28"><span class='Ref_to_Const'>CLS_NORMAL</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* separate normal ranges if any */ 
</span>            <a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN28"><span class='Ref_to_Const'>CLS_NORMAL</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/*---------- 
             * Try to split classes in one of two ways: 
             *  1) containing infinities - not containing infinities 
             *  2) containing empty - not containing empty 
             * 
             * Select the way which balances the ranges between left and right 
             * the best. If split in these ways is not possible, there are at 
             * most 3 classes, so just separate biggest class. 
             *---------- 
             */ 
</span><a name="LN619"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>infCount</span><span class='Delimiter'>, 
</span><a name="LN620"></a>                        <span class='Declare_Local'>nonInfCount</span><span class='Delimiter'>; 
</span><a name="LN621"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>emptyCount</span><span class='Delimiter'>, 
</span><a name="LN622"></a>                        <span class='Declare_Local'>nonEmptyCount</span><span class='Delimiter'>; 
</span> 
            <a href="rangetypes_gist.c.html#LN620"><span class='Ref_To_Local'>nonInfCount</span></a> <span class='Operator'>= 
</span>                <a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN28"><span class='Ref_to_Const'>CLS_NORMAL</span></a><span class='Delimiter'>] </span><span class='Operator'>+ 
</span>                <a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN31"><span class='Ref_to_Const'>CLS_CONTAIN_EMPTY</span></a><span class='Delimiter'>] </span><span class='Operator'>+ 
</span>                <a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN32"><span class='Ref_to_Const'>CLS_EMPTY</span></a><span class='Delimiter'>]; 
</span>            <a href="rangetypes_gist.c.html#LN619"><span class='Ref_To_Local'>infCount</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN525"><span class='Ref_To_Local'>total_count</span></a> <span class='Operator'>- </span><a href="rangetypes_gist.c.html#LN620"><span class='Ref_To_Local'>nonInfCount</span></a><span class='Delimiter'>; 
</span> 
            <a href="rangetypes_gist.c.html#LN622"><span class='Ref_To_Local'>nonEmptyCount</span></a> <span class='Operator'>= 
</span>                <a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN28"><span class='Ref_to_Const'>CLS_NORMAL</span></a><span class='Delimiter'>] </span><span class='Operator'>+ 
</span>                <a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN29"><span class='Ref_to_Const'>CLS_LOWER_INF</span></a><span class='Delimiter'>] </span><span class='Operator'>+ 
</span>                <a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN30"><span class='Ref_to_Const'>CLS_UPPER_INF</span></a><span class='Delimiter'>] </span><span class='Operator'>+ 
</span>                <a href="rangetypes_gist.c.html#LN520"><span class='Ref_To_Local'>count_in_classes</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN29"><span class='Ref_to_Const'>CLS_LOWER_INF</span></a> <span class='Operator'>| </span><a href="rangetypes_gist.c.html#LN30"><span class='Ref_to_Const'>CLS_UPPER_INF</span></a><span class='Delimiter'>]; 
</span>            <a href="rangetypes_gist.c.html#LN621"><span class='Ref_To_Local'>emptyCount</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN525"><span class='Ref_To_Local'>total_count</span></a> <span class='Operator'>- </span><a href="rangetypes_gist.c.html#LN622"><span class='Ref_To_Local'>nonEmptyCount</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN619"><span class='Ref_To_Local'>infCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN620"><span class='Ref_To_Local'>nonInfCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN619"><span class='Ref_To_Local'>infCount</span></a> <span class='Operator'>- </span><a href="rangetypes_gist.c.html#LN620"><span class='Ref_To_Local'>nonInfCount</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= 
</span>                 <a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN621"><span class='Ref_To_Local'>emptyCount</span></a> <span class='Operator'>- </span><a href="rangetypes_gist.c.html#LN622"><span class='Ref_To_Local'>nonEmptyCount</span></a><span class='Parentheses'>)))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN28"><span class='Ref_to_Const'>CLS_NORMAL</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Delimiter'>; 
</span>                <a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN31"><span class='Ref_to_Const'>CLS_CONTAIN_EMPTY</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Delimiter'>; 
</span>                <a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN32"><span class='Ref_to_Const'>CLS_EMPTY</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN621"><span class='Ref_To_Local'>emptyCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN622"><span class='Ref_To_Local'>nonEmptyCount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN28"><span class='Ref_to_Const'>CLS_NORMAL</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Delimiter'>; 
</span>                <a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN29"><span class='Ref_to_Const'>CLS_LOWER_INF</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Delimiter'>; 
</span>                <a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN30"><span class='Ref_to_Const'>CLS_UPPER_INF</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Delimiter'>; 
</span>                <a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN29"><span class='Ref_to_Const'>CLS_LOWER_INF</span></a> <span class='Operator'>| </span><a href="rangetypes_gist.c.html#LN30"><span class='Ref_to_Const'>CLS_UPPER_INF</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Either total_count == emptyCount or total_count == 
                 * infCount. 
                 */ 
</span>                <a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN523"><span class='Ref_To_Local'>biggest_class</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="rangetypes_gist.c.html#LN146"><span class='Ref_to_Proto'>range_gist_class_split</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN515"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN513"><span class='Ref_To_Local'>entryvec</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN514"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN598"><span class='Ref_To_Local'>classes_groups</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN514"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_gist_picksplit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* equality comparator for GiST */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN670"></a><span class='Declare_Function'>range_gist_same</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN672"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>r1</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN73"><span class='Ref_to_Macro'>PG_GETARG_RANGE</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN673"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>r2</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN73"><span class='Ref_to_Macro'>PG_GETARG_RANGE</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN674"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * range_eq will ignore the RANGE_CONTAIN_EMPTY flag, so we have to check 
     * that for ourselves.  More generally, if the entries have been properly 
     * normalized, then unequal flags bytes must mean unequal ranges ... so 
     * let's just test all the flag bits at once. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN126"><span class='Ref_to_Proto'>range_get_flags</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN672"><span class='Ref_To_Local'>r1</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/utils/rangetypes.h.html#LN126"><span class='Ref_to_Proto'>range_get_flags</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN673"><span class='Ref_To_Local'>r2</span></a><span class='Parentheses'>))</span> 
        <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN674"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN686"></a>        <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_gist.c.html#LN686"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN672"><span class='Ref_To_Local'>r1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Operator'>*</span><a href="rangetypes_gist.c.html#LN674"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN97"><span class='Ref_to_Proto'>range_eq_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN686"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN672"><span class='Ref_To_Local'>r1</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN673"><span class='Ref_To_Local'>r2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN674"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_gist_same &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *---------------------------------------------------------- 
 * STATIC FUNCTIONS 
 *---------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Return the smallest range that contains r1 and r2 
 * 
 * This differs from regular range_union in two critical ways: 
 * 1. It won't throw an error for non-adjacent r1 and r2, but just absorb 
 * the intervening values into the result range. 
 * 2. We track whether any empty range has been union'd into the result, 
 * so that contained_by searches can be indexed.  Note that this means 
 * that *all* unions formed within the GiST index must go through here. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>* 
</span><a name="LN713"></a><span class='Declare_Function'>range_super_union</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>r1</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>r2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN715"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN716"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>lower1</span><span class='Delimiter'>, 
</span><a name="LN717"></a>                <span class='Declare_Local'>lower2</span><span class='Delimiter'>; 
</span><a name="LN718"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>upper1</span><span class='Delimiter'>, 
</span><a name="LN719"></a>                <span class='Declare_Local'>upper2</span><span class='Delimiter'>; 
</span><a name="LN720"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty1</span><span class='Delimiter'>, 
</span><a name="LN721"></a>                <span class='Declare_Local'>empty2</span><span class='Delimiter'>; 
</span><a name="LN722"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>flags1</span><span class='Delimiter'>, 
</span><a name="LN723"></a>                <span class='Declare_Local'>flags2</span><span class='Delimiter'>; 
</span><a name="LN724"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result_lower</span><span class='Delimiter'>; 
</span><a name="LN725"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result_upper</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN716"><span class='Ref_To_Local'>lower1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN718"><span class='Ref_To_Local'>upper1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN720"><span class='Ref_To_Local'>empty1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN717"><span class='Ref_To_Local'>lower2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN719"><span class='Ref_To_Local'>upper2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN721"><span class='Ref_To_Local'>empty2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN722"><span class='Ref_To_Local'>flags1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN126"><span class='Ref_to_Proto'>range_get_flags</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN723"><span class='Ref_To_Local'>flags2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN126"><span class='Ref_to_Proto'>range_get_flags</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN720"><span class='Ref_To_Local'>empty1</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We can return r2 as-is if it already is or contains empty */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN723"><span class='Ref_To_Local'>flags2</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN35"><span class='Ref_to_Const'>RANGE_EMPTY</span></a> <span class='Operator'>| </span><a href="../../../include/utils/rangetypes.h.html#LN42"><span class='Ref_to_Const'>RANGE_CONTAIN_EMPTY</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r2</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Else we'd better copy it (modify-in-place isn't safe) */ 
</span>        <a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r2</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN131"><span class='Ref_to_Macro'>rangeCopy</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/rangetypes.h.html#LN127"><span class='Ref_to_Proto'>range_set_contain_empty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN721"><span class='Ref_To_Local'>empty2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* We can return r1 as-is if it already is or contains empty */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN722"><span class='Ref_To_Local'>flags1</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN35"><span class='Ref_to_Const'>RANGE_EMPTY</span></a> <span class='Operator'>| </span><a href="../../../include/utils/rangetypes.h.html#LN42"><span class='Ref_to_Const'>RANGE_CONTAIN_EMPTY</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r1</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Else we'd better copy it (modify-in-place isn't safe) */ 
</span>        <a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r1</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN131"><span class='Ref_to_Macro'>rangeCopy</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/rangetypes.h.html#LN127"><span class='Ref_to_Proto'>range_set_contain_empty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r1</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN716"><span class='Ref_To_Local'>lower1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN717"><span class='Ref_To_Local'>lower2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="rangetypes_gist.c.html#LN724"><span class='Ref_To_Local'>result_lower</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN716"><span class='Ref_To_Local'>lower1</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="rangetypes_gist.c.html#LN724"><span class='Ref_To_Local'>result_lower</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN717"><span class='Ref_To_Local'>lower2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN718"><span class='Ref_To_Local'>upper1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN719"><span class='Ref_To_Local'>upper2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="rangetypes_gist.c.html#LN725"><span class='Ref_To_Local'>result_upper</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN718"><span class='Ref_To_Local'>upper1</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="rangetypes_gist.c.html#LN725"><span class='Ref_To_Local'>result_upper</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN719"><span class='Ref_To_Local'>upper2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* optimization to avoid constructing a new range */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN724"><span class='Ref_To_Local'>result_lower</span></a> <span class='Operator'>== &</span><a href="rangetypes_gist.c.html#LN716"><span class='Ref_To_Local'>lower1</span></a> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN725"><span class='Ref_To_Local'>result_upper</span></a> <span class='Operator'>== &</span><a href="rangetypes_gist.c.html#LN718"><span class='Ref_To_Local'>upper1</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>((</span><a href="rangetypes_gist.c.html#LN722"><span class='Ref_To_Local'>flags1</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN42"><span class='Ref_to_Const'>RANGE_CONTAIN_EMPTY</span></a><span class='Parentheses'>) </span><span class='Operator'>|| !</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN723"><span class='Ref_To_Local'>flags2</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN42"><span class='Ref_to_Const'>RANGE_CONTAIN_EMPTY</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r1</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN724"><span class='Ref_To_Local'>result_lower</span></a> <span class='Operator'>== &</span><a href="rangetypes_gist.c.html#LN717"><span class='Ref_To_Local'>lower2</span></a> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN725"><span class='Ref_To_Local'>result_upper</span></a> <span class='Operator'>== &</span><a href="rangetypes_gist.c.html#LN719"><span class='Ref_To_Local'>upper2</span></a> <span class='Operator'>&& 
</span>        <span class='Parentheses'>((</span><a href="rangetypes_gist.c.html#LN723"><span class='Ref_To_Local'>flags2</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN42"><span class='Ref_to_Const'>RANGE_CONTAIN_EMPTY</span></a><span class='Parentheses'>) </span><span class='Operator'>|| !</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN722"><span class='Ref_To_Local'>flags1</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN42"><span class='Ref_to_Const'>RANGE_CONTAIN_EMPTY</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>r2</span></a><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN715"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN128"><span class='Ref_to_Proto'>make_range</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN713"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN724"><span class='Ref_To_Local'>result_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN725"><span class='Ref_To_Local'>result_upper</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="rangetypes_gist.c.html#LN722"><span class='Ref_To_Local'>flags1</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN42"><span class='Ref_to_Const'>RANGE_CONTAIN_EMPTY</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN723"><span class='Ref_To_Local'>flags2</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN42"><span class='Ref_to_Const'>RANGE_CONTAIN_EMPTY</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/rangetypes.h.html#LN127"><span class='Ref_to_Proto'>range_set_contain_empty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN715"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="rangetypes_gist.c.html#LN715"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_super_union &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GiST consistent test on an index internal page 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN783"></a><span class='Declare_Function'>range_gist_consistent_int</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, 
</span><a name="LN784"></a>                          <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN79"><span class='Ref_to_Const'>RANGESTRAT_BEFORE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| </span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/rangetypes.h.html#LN115"><span class='Ref_to_Proto'>range_overright_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN80"><span class='Ref_to_Const'>RANGESTRAT_OVERLEFT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| </span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/rangetypes.h.html#LN107"><span class='Ref_to_Proto'>range_after_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN81"><span class='Ref_to_Const'>RANGESTRAT_OVERLAPS</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN111"><span class='Ref_to_Proto'>range_overlaps_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN82"><span class='Ref_to_Const'>RANGESTRAT_OVERRIGHT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| </span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/rangetypes.h.html#LN105"><span class='Ref_to_Proto'>range_before_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN83"><span class='Ref_to_Const'>RANGESTRAT_AFTER</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| </span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/rangetypes.h.html#LN113"><span class='Ref_to_Proto'>range_overleft_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                             <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN84"><span class='Ref_to_Const'>RANGESTRAT_ADJACENT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| </span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN109"><span class='Ref_to_Proto'>range_adjacent_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN111"><span class='Ref_to_Proto'>range_overlaps_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN85"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN101"><span class='Ref_to_Proto'>range_contains_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN86"><span class='Ref_to_Const'>RANGESTRAT_CONTAINED_BY</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Empty ranges are contained by anything, so if key is or 
             * contains any empty ranges, we must descend into it.  Otherwise, 
             * descend only if key overlaps the query. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN54"><span class='Ref_to_Macro'>RangeIsOrContainsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN111"><span class='Ref_to_Proto'>range_overlaps_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN87"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS_ELEM</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN94"><span class='Ref_to_Proto'>range_contains_elem_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN88"><span class='Ref_to_Const'>RANGESTRAT_EQ</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If query is empty, descend only if the key is or contains any 
             * empty ranges.  Otherwise, descend if key contains query. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)))</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN54"><span class='Ref_to_Macro'>RangeIsOrContainsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN101"><span class='Ref_to_Proto'>range_contains_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN784"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized range strategy: %d"</span><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN783"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategy &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end range_gist_consistent_int &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * GiST consistent test on an index leaf page 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN855"></a><span class='Declare_Function'>range_gist_consistent_leaf</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Parameter'>strategy</span><span class='Delimiter'>, 
</span><a name="LN856"></a>                           <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN79"><span class='Ref_to_Const'>RANGESTRAT_BEFORE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN105"><span class='Ref_to_Proto'>range_before_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN80"><span class='Ref_to_Const'>RANGESTRAT_OVERLEFT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN113"><span class='Ref_to_Proto'>range_overleft_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN81"><span class='Ref_to_Const'>RANGESTRAT_OVERLAPS</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN111"><span class='Ref_to_Proto'>range_overlaps_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN82"><span class='Ref_to_Const'>RANGESTRAT_OVERRIGHT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN115"><span class='Ref_to_Proto'>range_overright_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN83"><span class='Ref_to_Const'>RANGESTRAT_AFTER</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN107"><span class='Ref_to_Proto'>range_after_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN84"><span class='Ref_to_Const'>RANGESTRAT_ADJACENT</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN109"><span class='Ref_to_Proto'>range_adjacent_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN85"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN101"><span class='Ref_to_Proto'>range_contains_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN86"><span class='Ref_to_Const'>RANGESTRAT_CONTAINED_BY</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN103"><span class='Ref_to_Proto'>range_contained_by_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN87"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS_ELEM</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN94"><span class='Ref_to_Proto'>range_contains_elem_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN88"><span class='Ref_to_Const'>RANGESTRAT_EQ</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN97"><span class='Ref_to_Proto'>range_eq_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN856"><span class='Ref_to_Parameter'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized range strategy: %d"</span><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN855"><span class='Ref_to_Parameter'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategy &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end range_gist_consistent_leaf &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Trivial split: half of entries will be placed on one page 
 * and the other half on the other page. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN899"></a><span class='Declare_Function'>range_gist_fallback_split</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN900"></a>                          <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, 
</span><a name="LN901"></a>                          <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN903"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>left_range</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN904"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>right_range</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN905"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN906"></a>                <span class='Declare_Local'>maxoff</span><span class='Delimiter'>, 
</span><a name="LN907"></a>                <span class='Declare_Local'>split_idx</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN906"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN900"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Split entries before this to left page, after to right: */ 
</span>    <a href="rangetypes_gist.c.html#LN907"><span class='Ref_To_Local'>split_idx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN906"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span> <span class='Operator'>+ </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN901"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN901"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN905"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN905"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_gist.c.html#LN906"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN905"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN917"></a>        <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN900"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN905"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN905"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN907"><span class='Ref_To_Local'>split_idx</span></a><span class='Parentheses'>) 
</span>            <a href="rangetypes_gist.c.html#LN112"><span class='Ref_to_Macro'>PLACE_LEFT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN917"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN905"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="rangetypes_gist.c.html#LN121"><span class='Ref_to_Macro'>PLACE_RIGHT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN917"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN905"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="rangetypes_gist.c.html#LN901"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN903"><span class='Ref_To_Local'>left_range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN901"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN904"><span class='Ref_To_Local'>right_range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_gist_fallback_split &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Split based on classes of ranges. 
 * 
 * See get_gist_range_class for class definitions. 
 * classes_groups is an array of length CLS_COUNT indicating the side of the 
 * split to which each class should go. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN937"></a><span class='Declare_Function'>range_gist_class_split</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN938"></a>                       <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, 
</span><a name="LN939"></a>                       <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, 
</span><a name="LN940"></a>                       <a href="rangetypes_gist.c.html#LN60"><span class='Ref_to_Typedef'>SplitLR</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>classes_groups</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN942"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>left_range</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN943"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>right_range</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN944"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN945"></a>                <span class='Declare_Local'>maxoff</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN945"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN938"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN939"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN939"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN944"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN944"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_gist.c.html#LN945"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN944"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN944"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN953"></a>        <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN938"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN944"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN954"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>class</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get class of range */ 
</span>        <span class='Control'>class</span> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN160"><span class='Ref_to_Proto'>get_gist_range_class</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN953"><span class='Ref_To_Local'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Place range to appropriate page */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN940"><span class='Ref_to_Parameter'>classes_groups</span></a><span class='Delimiter'>[</span><span class='Control'>class</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="rangetypes_gist.c.html#LN62"><span class='Ref_to_EnumConst'>SPLIT_LEFT</span></a><span class='Parentheses'>) 
</span>            <a href="rangetypes_gist.c.html#LN112"><span class='Ref_to_Macro'>PLACE_LEFT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN953"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN944"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN940"><span class='Ref_to_Parameter'>classes_groups</span></a><span class='Delimiter'>[</span><span class='Control'>class</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="rangetypes_gist.c.html#LN63"><span class='Ref_to_EnumConst'>SPLIT_RIGHT</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN121"><span class='Ref_to_Macro'>PLACE_RIGHT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN953"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN944"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="rangetypes_gist.c.html#LN939"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN942"><span class='Ref_To_Local'>left_range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN939"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN943"><span class='Ref_To_Local'>right_range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_gist_class_split &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Sorting based split. First half of entries according to the sort will be 
 * placed to one page, and second half of entries will be placed to other 
 * page. use_upper_bound parameter indicates whether to use upper or lower 
 * bound for sorting. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN980"></a><span class='Declare_Function'>range_gist_single_sorting_split</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN981"></a>                                <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, 
</span><a name="LN982"></a>                                <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, 
</span><a name="LN983"></a>                                <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_upper_bound</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN985"></a>    <a href="rangetypes_gist.c.html#LN53"><span class='Ref_to_Typedef'>SingleBoundSortItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sortItems</span><span class='Delimiter'>; 
</span><a name="LN986"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>left_range</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN987"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>right_range</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN988"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN989"></a>                <span class='Declare_Local'>maxoff</span><span class='Delimiter'>, 
</span><a name="LN990"></a>                <span class='Declare_Local'>split_idx</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN989"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN981"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN985"><span class='Ref_To_Local'>sortItems</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN53"><span class='Ref_to_Typedef'>SingleBoundSortItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN989"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN53"><span class='Ref_to_Typedef'>SingleBoundSortItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare auxiliary array and sort the values. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_gist.c.html#LN989"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1002"></a>        <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN981"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1003"></a>        <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>bound2</span><span class='Delimiter'>; 
</span><a name="LN1004"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_gist.c.html#LN985"><span class='Ref_To_Local'>sortItems</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN55"><span class='Ref_to_Member'>index</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Put appropriate bound into array */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN983"><span class='Ref_to_Parameter'>use_upper_bound</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN980"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1002"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1003"><span class='Ref_To_Local'>bound2</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN985"><span class='Ref_To_Local'>sortItems</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN56"><span class='Ref_to_Member'>bound</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1004"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN980"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1002"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN985"><span class='Ref_To_Local'>sortItems</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN56"><span class='Ref_to_Member'>bound</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1003"><span class='Ref_To_Local'>bound2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1004"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_gist.c.html#LN1004"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN985"><span class='Ref_To_Local'>sortItems</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN989"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN53"><span class='Ref_to_Typedef'>SingleBoundSortItem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="rangetypes_gist.c.html#LN161"><span class='Ref_to_Proto'>single_bound_cmp</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN980"><span class='Ref_to_Parameter'>typcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN990"><span class='Ref_To_Local'>split_idx</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN989"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN982"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN982"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN989"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1027"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN985"><span class='Ref_To_Local'>sortItems</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN55"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>; 
</span><a name="LN1028"></a>        <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN981"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1027"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN988"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN990"><span class='Ref_To_Local'>split_idx</span></a><span class='Parentheses'>) 
</span>            <a href="rangetypes_gist.c.html#LN112"><span class='Ref_to_Macro'>PLACE_LEFT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1028"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1027"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="rangetypes_gist.c.html#LN121"><span class='Ref_to_Macro'>PLACE_RIGHT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1028"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1027"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="rangetypes_gist.c.html#LN982"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN986"><span class='Ref_To_Local'>left_range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN982"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN987"><span class='Ref_To_Local'>right_range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_gist_single_sorting_split &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Double sorting split algorithm. 
 * 
 * The algorithm considers dividing ranges into two groups. The first (left) 
 * group contains general left bound. The second (right) group contains 
 * general right bound. The challenge is to find upper bound of left group 
 * and lower bound of right group so that overlap of groups is minimal and 
 * ratio of distribution is acceptable. Algorithm finds for each lower bound of 
 * right group minimal upper bound of left group, and for each upper bound of 
 * left group maximal lower bound of right group. For each found pair 
 * range_gist_consider_split considers replacement of currently selected 
 * split with the new one. 
 * 
 * After that, all the entries are divided into three groups: 
 * 1) Entries which should be placed to the left group 
 * 2) Entries which should be placed to the right group 
 * 3) "Common entries" which can be placed to either group without affecting 
 *    amount of overlap. 
 * 
 * The common ranges are distributed by difference of distance from lower 
 * bound of common range to lower bound of right group and distance from upper 
 * bound of common range to upper bound of left group. 
 * 
 * For details see: 
 * "A new double sorting-based node splitting algorithm for R-tree", 
 * A. Korotkov 
 * http://syrcose.ispras.ru/2011/files/SYRCoSE2011_Proceedings.pdf#page=36 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1069"></a><span class='Declare_Function'>range_gist_double_sorting_split</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN1070"></a>                                <a href="../../../include/access/gist.h.html#LN157"><span class='Ref_to_Typedef'>GistEntryVector</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entryvec</span><span class='Delimiter'>, 
</span><a name="LN1071"></a>                                <a href="../../../include/access/gist.h.html#LN102"><span class='Ref_to_Struct'>GIST_SPLITVEC</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1073"></a>    <a href="../../access/gist/gistproc.c.html#LN309"><span class='Ref_to_Typedef'>ConsiderSplitContext</span></a> <span class='Declare_Local'>context</span><span class='Delimiter'>; 
</span><a name="LN1074"></a>    <a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1075"></a>                <span class='Declare_Local'>maxoff</span><span class='Delimiter'>; 
</span><a name="LN1076"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span><span class='Delimiter'>, 
</span><a name="LN1077"></a>               <span class='Operator'>*</span><span class='Declare_Local'>left_range</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN1078"></a>               <span class='Operator'>*</span><span class='Declare_Local'>right_range</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1079"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>common_entries_count</span><span class='Delimiter'>; 
</span><a name="LN1080"></a>    <a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>by_lower</span><span class='Delimiter'>, 
</span><a name="LN1081"></a>               <span class='Operator'>*</span><span class='Declare_Local'>by_upper</span><span class='Delimiter'>; 
</span><a name="LN1082"></a>    <a href="../../access/gist/gistproc.c.html#LN297"><span class='Ref_to_Typedef'>CommonEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>common_entries</span><span class='Delimiter'>; 
</span><a name="LN1083"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nentries</span><span class='Delimiter'>, 
</span><a name="LN1084"></a>                <span class='Declare_Local'>i1</span><span class='Delimiter'>, 
</span><a name="LN1085"></a>                <span class='Declare_Local'>i2</span><span class='Delimiter'>; 
</span><a name="LN1086"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>right_lower</span><span class='Delimiter'>, 
</span><a name="LN1087"></a>               <span class='Operator'>*</span><span class='Declare_Local'>left_upper</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../access/gist/gistproc.c.html#LN309"><span class='Ref_to_Typedef'>ConsiderSplitContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN71"><span class='Ref_to_Member'>typcache</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN72"><span class='Ref_to_Member'>has_subtype_diff</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN1075"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1070"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN159"><span class='Ref_to_Member'>n</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN73"><span class='Ref_to_Member'>entries_count</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1075"><span class='Ref_To_Local'>maxoff</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN77"><span class='Ref_to_Member'>first</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate arrays for sorted range bounds */ 
</span>    <a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fill arrays of bounds */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_gist.c.html#LN1075"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1104"></a>        <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1070"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1105"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1104"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1105"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_gist.c.html#LN1105"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Make two arrays of range bounds: one sorted by lower bound and another 
     * sorted by upper bound. 
     */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="rangetypes_gist.c.html#LN162"><span class='Ref_to_Proto'>interval_cmp_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="rangetypes_gist.c.html#LN163"><span class='Ref_to_Proto'>interval_cmp_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * The goal is to form a left and right range, so that every entry 
     * range is contained by either left or right interval (or both). 
     * 
     * For example, with the ranges (0,1), (1,3), (2,3), (2,4): 
     * 
     * 0 1 2 3 4 
     * +-+ 
     *   +---+ 
     *     +-+ 
     *     +---+ 
     * 
     * The left and right ranges are of the form (0,a) and (b,4). 
     * We first consider splits where b is the lower bound of an entry. 
     * We iterate through all entries, and for each b, calculate the 
     * smallest possible a. Then we consider splits where a is the 
     * upper bound of an entry, and for each a, calculate the greatest 
     * possible b. 
     * 
     * In the above example, the first loop would consider splits: 
     * b=0: (0,1)-(0,4) 
     * b=1: (0,1)-(1,4) 
     * b=2: (0,3)-(2,4) 
     * 
     * And the second loop: 
     * a=1: (0,1)-(1,4) 
     * a=3: (0,3)-(2,4) 
     * a=4: (0,4)-(2,4) 
     *---------- 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Iterate over lower bound of right group, finding smallest possible 
     * upper bound of left group. 
     */ 
</span>    <a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1086"><span class='Ref_To_Local'>right_lower</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1087"><span class='Ref_To_Local'>left_upper</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Find next lower bound of right group. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>&& 
</span>               <a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1086"><span class='Ref_To_Local'>right_lower</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>, 
</span>                                 <a href="rangetypes_gist.c.html#LN1087"><span class='Ref_To_Local'>left_upper</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="rangetypes_gist.c.html#LN1087"><span class='Ref_To_Local'>left_upper</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&GT;= </span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_gist.c.html#LN1086"><span class='Ref_To_Local'>right_lower</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Find count of ranges which anyway should be placed to the left 
         * group. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>&& 
</span>               <a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>, 
</span>                                <a href="rangetypes_gist.c.html#LN1087"><span class='Ref_To_Local'>left_upper</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Consider found split to see if it's better than what we had. 
         */ 
</span>        <a href="rangetypes_gist.c.html#LN157"><span class='Ref_to_Proto'>range_gist_consider_split</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1086"><span class='Ref_To_Local'>right_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1087"><span class='Ref_To_Local'>left_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while true &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Iterate over upper bound of left group finding greatest possible lower 
     * bound of right group. 
     */ 
</span>    <a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1086"><span class='Ref_To_Local'>right_lower</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1087"><span class='Ref_To_Local'>left_upper</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Find next upper bound of left group. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>               <a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1087"><span class='Ref_To_Local'>left_upper</span></a><span class='Delimiter'>, 
</span>                                <span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>, 
</span>                                 <a href="rangetypes_gist.c.html#LN1086"><span class='Ref_To_Local'>right_lower</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="rangetypes_gist.c.html#LN1086"><span class='Ref_To_Local'>right_lower</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_gist.c.html#LN1087"><span class='Ref_To_Local'>left_upper</span></a> <span class='Operator'>= &</span><a href="rangetypes_gist.c.html#LN1081"><span class='Ref_To_Local'>by_upper</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Find count of intervals which anyway should be placed to the right 
         * group. 
         */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>               <a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1080"><span class='Ref_To_Local'>by_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>, 
</span>                                <a href="rangetypes_gist.c.html#LN1086"><span class='Ref_To_Local'>right_lower</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Consider found split to see if it's better than what we had. 
         */ 
</span>        <a href="rangetypes_gist.c.html#LN157"><span class='Ref_to_Proto'>range_gist_consider_split</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1086"><span class='Ref_To_Local'>right_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1084"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                  <a href="rangetypes_gist.c.html#LN1087"><span class='Ref_To_Local'>left_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1085"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while true &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we failed to find any acceptable splits, use trivial split. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN77"><span class='Ref_to_Member'>first</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_gist.c.html#LN143"><span class='Ref_to_Proto'>range_gist_fallback_split</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1070"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1071"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ok, we have now selected bounds of the groups. Now we have to 
     * distribute entries themselves. At first we distribute entries which can 
     * be placed unambiguously and collect "common entries" to array. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate vectors for results */ 
</span>    <a href="rangetypes_gist.c.html#LN1071"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN104"><span class='Ref_to_Member'>spl_left</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1071"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN109"><span class='Ref_to_Member'>spl_right</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/storage/off.h.html#LN23"><span class='Ref_to_Typedef'>OffsetNumber</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1071"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN105"><span class='Ref_to_Member'>spl_nleft</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1071"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN110"><span class='Ref_to_Member'>spl_nright</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate an array for "common entries" - entries which can be placed to 
     * either group without affecting overlap along selected axis. 
     */ 
</span>    <a href="rangetypes_gist.c.html#LN1079"><span class='Ref_To_Local'>common_entries_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1082"><span class='Ref_To_Local'>common_entries</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../access/gist/gistproc.c.html#LN297"><span class='Ref_to_Typedef'>CommonEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1083"><span class='Ref_To_Local'>nentries</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../access/gist/gistproc.c.html#LN297"><span class='Ref_to_Typedef'>CommonEntry</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Distribute entries which can be distributed unambiguously, and collect 
     * common entries. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN26"><span class='Ref_to_Const'>FirstOffsetNumber</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_gist.c.html#LN1075"><span class='Ref_To_Local'>maxoff</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/storage/off.h.html#LN52"><span class='Ref_to_Macro'>OffsetNumberNext</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1272"></a>        <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>lower</span><span class='Delimiter'>, 
</span><a name="LN1273"></a>                    <span class='Declare_Local'>upper</span><span class='Delimiter'>; 
</span><a name="LN1274"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get upper and lower bounds along selected axis. 
         */ 
</span>        <a href="rangetypes_gist.c.html#LN1076"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1070"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1076"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1272"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1273"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1274"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1273"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN79"><span class='Ref_to_Member'>left_upper</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Fits in the left group */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1272"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN80"><span class='Ref_to_Member'>right_lower</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Fits also in the right group, so "common entry" */ 
</span>                <a href="rangetypes_gist.c.html#LN1082"><span class='Ref_To_Local'>common_entries</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1079"><span class='Ref_To_Local'>common_entries_count</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN105"><span class='Ref_to_Member'>index</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN72"><span class='Ref_to_Member'>has_subtype_diff</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * delta = (lower - context.right_lower) - 
                     * (context.left_upper - upper) 
                     */ 
</span>                    <a href="rangetypes_gist.c.html#LN1082"><span class='Ref_To_Local'>common_entries</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1079"><span class='Ref_To_Local'>common_entries_count</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN107"><span class='Ref_to_Member'>delta</span></a> <span class='Operator'>= 
</span>                        <a href="rangetypes_gist.c.html#LN165"><span class='Ref_to_Proto'>call_subtype_diff</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, 
</span>                                          <a href="rangetypes_gist.c.html#LN1272"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                          <a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN80"><span class='Ref_to_Member'>right_lower</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>) </span><span class='Operator'>- 
</span>                        <a href="rangetypes_gist.c.html#LN165"><span class='Ref_to_Proto'>call_subtype_diff</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, 
</span>                                          <a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN79"><span class='Ref_to_Member'>left_upper</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                          <a href="rangetypes_gist.c.html#LN1273"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Without subtype_diff, take all deltas as zero */ 
</span>                    <a href="rangetypes_gist.c.html#LN1082"><span class='Ref_To_Local'>common_entries</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1079"><span class='Ref_To_Local'>common_entries_count</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN107"><span class='Ref_to_Member'>delta</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="rangetypes_gist.c.html#LN1079"><span class='Ref_To_Local'>common_entries_count</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if range_cmp_bounds(typc... &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Doesn't fit to the right group, so join to the left group */ 
</span>                <a href="rangetypes_gist.c.html#LN112"><span class='Ref_to_Macro'>PLACE_LEFT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1076"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if range_cmp_bounds(typc... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Each entry should fit on either left or right group. Since this 
             * entry didn't fit in the left group, it better fit in the right 
             * group. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1069"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1272"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, 
</span>                                    <a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN80"><span class='Ref_to_Member'>right_lower</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN121"><span class='Ref_to_Macro'>PLACE_RIGHT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1076"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=FirstOffsetNumber;i... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Distribute "common entries", if any. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1079"><span class='Ref_To_Local'>common_entries_count</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Sort "common entries" by calculated deltas in order to distribute 
         * the most ambiguous entries first. 
         */ 
</span>        <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1082"><span class='Ref_To_Local'>common_entries</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1079"><span class='Ref_To_Local'>common_entries_count</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../access/gist/gistproc.c.html#LN297"><span class='Ref_to_Typedef'>CommonEntry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="rangetypes_gist.c.html#LN164"><span class='Ref_to_Proto'>common_entry_cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Distribute "common entries" between groups according to sorting. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN1079"><span class='Ref_To_Local'>common_entries_count</span></a><span class='Delimiter'>; </span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1347"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1082"><span class='Ref_To_Local'>common_entries</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN105"><span class='Ref_to_Member'>index</span></a><span class='Delimiter'>; 
</span> 
            <a href="rangetypes_gist.c.html#LN1076"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1070"><span class='Ref_to_Parameter'>entryvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN160"><span class='Ref_to_Member'>vector</span></a><span class='Delimiter'>[</span><a href="rangetypes_gist.c.html#LN1347"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/gist.h.html#LN122"><span class='Ref_to_Member'>key</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Check if we have to place this entry in either group to achieve 
             * LIMIT_RATIO. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1074"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN1073"><span class='Ref_To_Local'>context</span></a><span class='Operator'>.</span><a href="rangetypes_gist.c.html#LN84"><span class='Ref_to_Member'>common_left</span></a><span class='Parentheses'>) 
</span>                <a href="rangetypes_gist.c.html#LN112"><span class='Ref_to_Macro'>PLACE_LEFT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1076"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1347"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="rangetypes_gist.c.html#LN121"><span class='Ref_to_Macro'>PLACE_RIGHT</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1076"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1347"><span class='Ref_To_Local'>idx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if common_entries_count&GT;... &raquo; </span> 
 
    <a href="rangetypes_gist.c.html#LN1071"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN106"><span class='Ref_to_Member'>spl_ldatum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1077"><span class='Ref_To_Local'>left_range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1071"><span class='Ref_to_Parameter'>v</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/gist.h.html#LN111"><span class='Ref_to_Member'>spl_rdatum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1078"><span class='Ref_To_Local'>right_range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end range_gist_double_sorting_split &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Consider replacement of currently selected split with a better one 
 * during range_gist_double_sorting_split. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1371"></a><span class='Declare_Function'>range_gist_consider_split</span><span class='Parentheses'>(</span><a href="../../access/gist/gistproc.c.html#LN309"><span class='Ref_to_Typedef'>ConsiderSplitContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>context</span><span class='Delimiter'>, 
</span><a name="LN1372"></a>                          <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>right_lower</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>min_left_count</span><span class='Delimiter'>, 
</span><a name="LN1373"></a>                          <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>left_upper</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>max_left_count</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1375"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>left_count</span><span class='Delimiter'>, 
</span><a name="LN1376"></a>                <span class='Declare_Local'>right_count</span><span class='Delimiter'>; 
</span><a name="LN1377"></a>    <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Local'>ratio</span><span class='Delimiter'>, 
</span><a name="LN1378"></a>                <span class='Declare_Local'>overlap</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate entries distribution ratio assuming most uniform distribution 
     * of common entries. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1372"><span class='Ref_to_Parameter'>min_left_count</span></a> <span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN73"><span class='Ref_to_Member'>entries_count</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
        <a href="rangetypes_gist.c.html#LN1375"><span class='Ref_To_Local'>left_count</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1372"><span class='Ref_to_Parameter'>min_left_count</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1373"><span class='Ref_to_Parameter'>max_left_count</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN73"><span class='Ref_to_Member'>entries_count</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="rangetypes_gist.c.html#LN1375"><span class='Ref_To_Local'>left_count</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1373"><span class='Ref_to_Parameter'>max_left_count</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="rangetypes_gist.c.html#LN1375"><span class='Ref_To_Local'>left_count</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN73"><span class='Ref_to_Member'>entries_count</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_gist.c.html#LN1376"><span class='Ref_To_Local'>right_count</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN73"><span class='Ref_to_Member'>entries_count</span></a> <span class='Operator'>- </span><a href="rangetypes_gist.c.html#LN1375"><span class='Ref_To_Local'>left_count</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ratio of split: quotient between size of smaller group and total 
     * entries count.  This is necessarily 0.5 or less; if it's less than 
     * LIMIT_RATIO then we will never accept the new split. 
     */ 
</span>    <a href="rangetypes_gist.c.html#LN1377"><span class='Ref_To_Local'>ratio</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a><span class='Parentheses'>) </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1375"><span class='Ref_To_Local'>left_count</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1376"><span class='Ref_To_Local'>right_count</span></a><span class='Parentheses'>))</span> <span class='Operator'>/ 
</span>        <span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN73"><span class='Ref_to_Member'>entries_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1377"><span class='Ref_To_Local'>ratio</span></a> <span class='Operator'>&GT; </span><a href="../../access/gist/gistproc.c.html#LN34"><span class='Ref_to_Const'>LIMIT_RATIO</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1402"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>selectthis</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The ratio is acceptable, so compare current split with previously 
         * selected one. We search for minimal overlap (allowing negative 
         * values) and minimal ratio secondarily.  If subtype_diff is 
         * available, it's used for overlap measure.  Without subtype_diff we 
         * use number of "common entries" as an overlap measure. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN72"><span class='Ref_to_Member'>has_subtype_diff</span></a><span class='Parentheses'>) 
</span>            <a href="rangetypes_gist.c.html#LN1378"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN165"><span class='Ref_to_Proto'>call_subtype_diff</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN71"><span class='Ref_to_Member'>typcache</span></a><span class='Delimiter'>, 
</span>                                        <a href="rangetypes_gist.c.html#LN1373"><span class='Ref_to_Parameter'>left_upper</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                        <a href="rangetypes_gist.c.html#LN1372"><span class='Ref_to_Parameter'>right_lower</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="rangetypes_gist.c.html#LN1378"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1373"><span class='Ref_to_Parameter'>max_left_count</span></a> <span class='Operator'>- </span><a href="rangetypes_gist.c.html#LN1372"><span class='Ref_to_Parameter'>min_left_count</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If there is no previous selection, select this split */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN77"><span class='Ref_to_Member'>first</span></a><span class='Parentheses'>) 
</span>            <a href="rangetypes_gist.c.html#LN1402"><span class='Ref_To_Local'>selectthis</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Choose the new split if it has a smaller overlap, or same 
             * overlap but better ratio. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1378"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN83"><span class='Ref_to_Member'>overlap</span></a> <span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1378"><span class='Ref_To_Local'>overlap</span></a> <span class='Operator'>== </span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN83"><span class='Ref_to_Member'>overlap</span></a> <span class='Operator'>&& </span><a href="rangetypes_gist.c.html#LN1377"><span class='Ref_To_Local'>ratio</span></a> <span class='Operator'>&GT; </span><a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN82"><span class='Ref_to_Member'>ratio</span></a><span class='Parentheses'>))</span> 
                <a href="rangetypes_gist.c.html#LN1402"><span class='Ref_To_Local'>selectthis</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1402"><span class='Ref_To_Local'>selectthis</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* save information about selected split */ 
</span>            <a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN77"><span class='Ref_to_Member'>first</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN82"><span class='Ref_to_Member'>ratio</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1377"><span class='Ref_To_Local'>ratio</span></a><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN83"><span class='Ref_to_Member'>overlap</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1378"><span class='Ref_To_Local'>overlap</span></a><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN80"><span class='Ref_to_Member'>right_lower</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1372"><span class='Ref_to_Parameter'>right_lower</span></a><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN79"><span class='Ref_to_Member'>left_upper</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1373"><span class='Ref_to_Parameter'>left_upper</span></a><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN84"><span class='Ref_to_Member'>common_left</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1373"><span class='Ref_to_Parameter'>max_left_count</span></a> <span class='Operator'>- </span><a href="rangetypes_gist.c.html#LN1375"><span class='Ref_To_Local'>left_count</span></a><span class='Delimiter'>; 
</span>            <a href="rangetypes_gist.c.html#LN1371"><span class='Ref_to_Parameter'>context</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN85"><span class='Ref_to_Member'>common_right</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN1375"><span class='Ref_To_Local'>left_count</span></a> <span class='Operator'>- </span><a href="rangetypes_gist.c.html#LN1372"><span class='Ref_to_Parameter'>min_left_count</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ratio&GT;LIMIT_RATIO &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end range_gist_consider_split &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Find class number for range. 
 * 
 * The class number is a valid combination of the properties of the 
 * range.  Note: the highest possible number is 8, because CLS_EMPTY 
 * can't be combined with anything else. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1454"></a><span class='Declare_Function'>get_gist_range_class</span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>range</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1456"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>classNumber</span><span class='Delimiter'>; 
</span><a name="LN1457"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>flags</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_gist.c.html#LN1457"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN126"><span class='Ref_to_Proto'>range_get_flags</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1454"><span class='Ref_to_Parameter'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1457"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN35"><span class='Ref_to_Const'>RANGE_EMPTY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_gist.c.html#LN1456"><span class='Ref_To_Local'>classNumber</span></a> <span class='Operator'>= </span><a href="rangetypes_gist.c.html#LN32"><span class='Ref_to_Const'>CLS_EMPTY</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_gist.c.html#LN1456"><span class='Ref_To_Local'>classNumber</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1457"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN38"><span class='Ref_to_Const'>RANGE_LB_INF</span></a><span class='Parentheses'>) 
</span>            <a href="rangetypes_gist.c.html#LN1456"><span class='Ref_To_Local'>classNumber</span></a> <span class='Operator'>|= </span><a href="rangetypes_gist.c.html#LN29"><span class='Ref_to_Const'>CLS_LOWER_INF</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1457"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN39"><span class='Ref_to_Const'>RANGE_UB_INF</span></a><span class='Parentheses'>) 
</span>            <a href="rangetypes_gist.c.html#LN1456"><span class='Ref_To_Local'>classNumber</span></a> <span class='Operator'>|= </span><a href="rangetypes_gist.c.html#LN30"><span class='Ref_to_Const'>CLS_UPPER_INF</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1457"><span class='Ref_To_Local'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/utils/rangetypes.h.html#LN42"><span class='Ref_to_Const'>RANGE_CONTAIN_EMPTY</span></a><span class='Parentheses'>) 
</span>            <a href="rangetypes_gist.c.html#LN1456"><span class='Ref_To_Local'>classNumber</span></a> <span class='Operator'>|= </span><a href="rangetypes_gist.c.html#LN31"><span class='Ref_to_Const'>CLS_CONTAIN_EMPTY</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="rangetypes_gist.c.html#LN1456"><span class='Ref_To_Local'>classNumber</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end get_gist_range_class &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Comparison function for range_gist_single_sorting_split. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1481"></a><span class='Declare_Function'>single_bound_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1483"></a>    <a href="rangetypes_gist.c.html#LN53"><span class='Ref_to_Typedef'>SingleBoundSortItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>i1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN53"><span class='Ref_to_Typedef'>SingleBoundSortItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1481"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN1484"></a>    <a href="rangetypes_gist.c.html#LN53"><span class='Ref_to_Typedef'>SingleBoundSortItem</span></a> <span class='Operator'>*</span><span class='Declare_Local'>i2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN53"><span class='Ref_to_Typedef'>SingleBoundSortItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1481"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span><a name="LN1485"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1481"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1485"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1483"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN56"><span class='Ref_to_Member'>bound</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1484"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN56"><span class='Ref_to_Member'>bound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Compare NonEmptyRanges by lower bound. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1494"></a><span class='Declare_Function'>interval_cmp_lower</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1496"></a>    <a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>i1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1494"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN1497"></a>    <a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>i2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1494"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span><a name="LN1498"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1494"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1498"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1496"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1497"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN94"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Compare NonEmptyRanges by upper bound. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1507"></a><span class='Declare_Function'>interval_cmp_upper</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1509"></a>    <a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>i1</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1507"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN1510"></a>    <a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Declare_Local'>i2</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN92"><span class='Ref_to_Typedef'>NonEmptyRange</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1507"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span><a name="LN1511"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1507"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1511"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1509"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1510"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>-&GT;</span><a href="rangetypes_gist.c.html#LN95"><span class='Ref_to_Member'>upper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Compare CommonEntrys by their deltas. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1520"></a><span class='Declare_Function'>common_entry_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i1</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>i2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1522"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>delta1</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../access/gist/gistproc.c.html#LN297"><span class='Ref_to_Typedef'>CommonEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1520"><span class='Ref_to_Parameter'>i1</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>delta<span class='Delimiter'>; 
</span><a name="LN1523"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>delta2</span> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../access/gist/gistproc.c.html#LN297"><span class='Ref_to_Typedef'>CommonEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_gist.c.html#LN1520"><span class='Ref_to_Parameter'>i2</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>delta<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1522"><span class='Ref_To_Local'>delta1</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_gist.c.html#LN1523"><span class='Ref_To_Local'>delta2</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_gist.c.html#LN1522"><span class='Ref_To_Local'>delta1</span></a> <span class='Operator'>&GT; </span><a href="rangetypes_gist.c.html#LN1523"><span class='Ref_To_Local'>delta2</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Convenience function to invoke type-specific subtype_diff function. 
 * Caller must have already checked that there is one for the range type. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> 
<a name="LN1538"></a><span class='Declare_Function'>call_subtype_diff</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>val1</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>val2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1540"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span> 
    <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_gist.c.html#LN1538"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Delimiter'>, 
</span>                                             <a href="rangetypes_gist.c.html#LN1538"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN84"><span class='Ref_to_Member'>rng_collation</span></a><span class='Delimiter'>, 
</span>                                             <a href="rangetypes_gist.c.html#LN1538"><span class='Ref_to_Parameter'>val1</span></a><span class='Delimiter'>, </span><a href="rangetypes_gist.c.html#LN1538"><span class='Ref_to_Parameter'>val2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Cope with buggy subtype_diff function by returning zero */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Keyword'>value</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>