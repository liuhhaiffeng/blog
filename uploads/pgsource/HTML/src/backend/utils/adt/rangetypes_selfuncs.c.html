<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\rangetypes_selfuncs.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\rangetypes_selfuncs.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:53 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * rangetypes_selfuncs.c 
 *    Functions for selectivity estimation of range operators 
 * 
 * Estimates are based on histograms of lower and upper bounds, and the 
 * fraction of empty ranges. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/rangetypes_selfuncs.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_statistic.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rangetypes.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/selfuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/typcache.h"</span> 
 
<a name="LN29"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>calc_rangesel</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata</span><span class='Delimiter'>, 
</span><a name="LN30"></a>              <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constval</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN31"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>default_range_selectivity</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN32"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>calc_hist_selectivity</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN33"></a>                      <a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constval</span><span class='Delimiter'>, 
</span><a name="LN34"></a>                      <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN35"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>calc_hist_selectivity_scalar</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN36"></a>                             <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constbound</span><span class='Delimiter'>, 
</span><a name="LN37"></a>                             <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN38"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>equal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN39"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>rbound_bsearch</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, 
</span><a name="LN40"></a>               <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_length</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>equal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN41"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> <span class='Declare_Prototype'>get_position</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, 
</span><a name="LN42"></a>             <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist1</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> <span class='Declare_Prototype'>get_len_position</span><span class='Parentheses'>(</span><span class='Keyword'>double </span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>hist1</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>hist2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN44"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> <span class='Declare_Prototype'>get_distance</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bound1</span><span class='Delimiter'>, 
</span><a name="LN45"></a>             <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bound2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN46"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>length_hist_bsearch</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>length_hist_values</span><span class='Delimiter'>, 
</span><a name="LN47"></a>                    <span class='Keyword'>int </span><span class='Declare_Parameter'>length_hist_nvalues</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>equal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN48"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>calc_length_hist_frac</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>length_hist_values</span><span class='Delimiter'>, 
</span><a name="LN49"></a>        <span class='Keyword'>int </span><span class='Declare_Parameter'>length_hist_nvalues</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>length1</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>length2</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>equal</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN50"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>calc_hist_selectivity_contained</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN51"></a>                                <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lower</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>upper</span><span class='Delimiter'>, 
</span><a name="LN52"></a>                                <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist_lower</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN53"></a>                         <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>length_hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>length_hist_nvalues</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN54"></a><span class='Keyword'>static double </span><span class='Declare_Prototype'>calc_hist_selectivity_contains</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN55"></a>                               <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lower</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>upper</span><span class='Delimiter'>, 
</span><a name="LN56"></a>                               <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist_lower</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN57"></a>                         <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>length_hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>length_hist_nvalues</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Returns a default selectivity estimate for given operator, when we don't 
 * have statistics or cannot use them for some reason. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN64"></a><span class='Declare_Function'>default_range_selectivity</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1766"><span class='Ref_to_Const'>OID_RANGE_OVERLAP_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>01</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1772"><span class='Ref_to_Const'>OID_RANGE_CONTAINS_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1778"><span class='Ref_to_Const'>OID_RANGE_CONTAINED_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>005</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1769"><span class='Ref_to_Const'>OID_RANGE_CONTAINS_ELEM_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1775"><span class='Ref_to_Const'>OID_RANGE_ELEM_CONTAINED_OP</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * "range @&GT; elem" is more or less identical to a scalar 
             * inequality "A &GT;= b AND A &LT;= c". 
             */ 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/selfuncs.h.html#LN39"><span class='Ref_to_Const'>DEFAULT_RANGE_INEQ_SEL</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1754"><span class='Ref_to_Const'>OID_RANGE_LESS_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1757"><span class='Ref_to_Const'>OID_RANGE_LESS_EQUAL_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1763"><span class='Ref_to_Const'>OID_RANGE_GREATER_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1760"><span class='Ref_to_Const'>OID_RANGE_GREATER_EQUAL_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1781"><span class='Ref_to_Const'>OID_RANGE_LEFT_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1784"><span class='Ref_to_Const'>OID_RANGE_RIGHT_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1787"><span class='Ref_to_Const'>OID_RANGE_OVERLAPS_LEFT_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1790"><span class='Ref_to_Const'>OID_RANGE_OVERLAPS_RIGHT_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* these are similar to regular scalar inequalities */ 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/selfuncs.h.html#LN36"><span class='Ref_to_Const'>DEFAULT_INEQ_SEL</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* all range operators should be handled above, but just in case */ 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>01</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch operator &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end default_range_selectivity &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * rangesel -- restriction selectivity for range operators 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN105"></a><span class='Declare_Function'>rangesel</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN107"></a>    <a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Declare_Local'>root</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/relation.h.html#LN150"><span class='Ref_to_Struct'>PlannerInfo</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN108"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Keyword'>operator </span><span class='Operator'>= </span><span class='Declare_Local'>PG_GETARG_OID</span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN109"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>args</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN110"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>varRelid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN111"></a>    <a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Declare_Local'>vardata</span><span class='Delimiter'>; 
</span><a name="LN112"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>other</span><span class='Delimiter'>; 
</span><a name="LN113"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>varonleft</span><span class='Delimiter'>; 
</span><a name="LN114"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>selec</span><span class='Delimiter'>; 
</span><a name="LN115"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN116"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>constrange</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If expression is not (variable op something) or (something op 
     * variable), then punt and return a default estimate. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/selfuncs.h.html#LN157"><span class='Ref_to_Proto'>get_restriction_variable</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN107"><span class='Ref_To_Local'>root</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN109"><span class='Ref_To_Local'>args</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN110"><span class='Ref_To_Local'>varRelid</span></a><span class='Delimiter'>, 
</span>                                  <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN111"><span class='Ref_To_Local'>vardata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN112"><span class='Ref_To_Local'>other</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN113"><span class='Ref_To_Local'>varonleft</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN31"><span class='Ref_to_Proto'>default_range_selectivity</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Can't do anything useful if the something is not a constant, either. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN112"><span class='Ref_To_Local'>other</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN111"><span class='Ref_To_Local'>vardata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN31"><span class='Ref_to_Proto'>default_range_selectivity</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * All the range operators are strict, so we can cope with a NULL constant 
     * right away. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN112"><span class='Ref_To_Local'>other</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN111"><span class='Ref_To_Local'>vardata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If var is on the right, commute the operator, so that we can assume the 
     * var is on the left in what follows. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_selfuncs.c.html#LN113"><span class='Ref_To_Local'>varonleft</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* we have other Op var, commute to make var Op other */ 
</span><a name="LN152"></a>        <span class='Keyword'>operator </span><span class='Operator'>= </span><span class='Declare_Local'>get_commutator</span><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Keyword'>operator</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Use default selectivity (should we raise an error instead?) */ 
</span>            <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN111"><span class='Ref_To_Local'>vardata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN31"><span class='Ref_to_Proto'>default_range_selectivity</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * OK, there's a Var and a Const we're dealing with here.  We need the 
     * Const to be of same range type as the column, else we can't do anything 
     * useful. (Such cases will likely fail at runtime, but here we'd rather 
     * just return a default estimate.) 
     * 
     * If the operator is "range @&GT; element", the constant should be of the 
     * element type of the range column. Convert it to a range that includes 
     * only that single point, so that we don't need special handling for that 
     * in what follows. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>operator </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN1769"><span class='Ref_to_Const'>OID_RANGE_CONTAINS_ELEM_OP</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_selfuncs.c.html#LN115"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN111"><span class='Ref_To_Local'>vardata</span></a><span class='Operator'>.</span><a href="../../../include/utils/selfuncs.h.html#LN73"><span class='Ref_to_Member'>vartype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN112"><span class='Ref_To_Local'>other</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>consttype <span class='Operator'>== </span><a href="rangetypes_selfuncs.c.html#LN115"><span class='Ref_To_Local'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN83"><span class='Ref_to_Member'>rngelemtype</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN31"><span class='Ref_to_Member'>type_id</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN178"></a>            <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>lower</span><span class='Delimiter'>, 
</span><a name="LN179"></a>                        <span class='Declare_Local'>upper</span><span class='Delimiter'>; 
</span> 
            <a href="rangetypes_selfuncs.c.html#LN178"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN63"><span class='Ref_to_Member'>inclusive</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN178"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN112"><span class='Ref_To_Local'>other</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constvalue<span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN178"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN178"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN179"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN63"><span class='Ref_to_Member'>inclusive</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN179"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN112"><span class='Ref_To_Local'>other</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constvalue<span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN179"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN179"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN116"><span class='Ref_To_Local'>constrange</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN121"><span class='Ref_to_Proto'>range_serialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN115"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN178"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN179"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if operator==OID_RANGE_C... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>operator </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN1775"><span class='Ref_to_Const'>OID_RANGE_ELEM_CONTAINED_OP</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Here, the Var is the elem, not the range.  For now we just punt and 
         * return the default estimate.  In future we could disassemble the 
         * range constant and apply scalarineqsel ... 
         */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN112"><span class='Ref_To_Local'>other</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>consttype <span class='Operator'>== </span><a href="rangetypes_selfuncs.c.html#LN111"><span class='Ref_To_Local'>vardata</span></a><span class='Operator'>.</span><a href="../../../include/utils/selfuncs.h.html#LN73"><span class='Ref_to_Member'>vartype</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Both sides are the same range type */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN115"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN111"><span class='Ref_To_Local'>vardata</span></a><span class='Operator'>.</span><a href="../../../include/utils/selfuncs.h.html#LN73"><span class='Ref_to_Member'>vartype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_selfuncs.c.html#LN116"><span class='Ref_To_Local'>constrange</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN112"><span class='Ref_To_Local'>other</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constvalue<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we got a valid constant on one side of the operator, proceed to 
     * estimate using statistics. Otherwise punt and return a default constant 
     * estimate.  Note that calc_rangesel need not handle 
     * OID_RANGE_ELEM_CONTAINED_OP. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN116"><span class='Ref_To_Local'>constrange</span></a><span class='Parentheses'>) 
</span>        <a href="rangetypes_selfuncs.c.html#LN114"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN29"><span class='Ref_to_Proto'>calc_rangesel</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN115"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN111"><span class='Ref_To_Local'>vardata</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN116"><span class='Ref_To_Local'>constrange</span></a><span class='Delimiter'>, </span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="rangetypes_selfuncs.c.html#LN114"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN31"><span class='Ref_to_Proto'>default_range_selectivity</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/selfuncs.h.html#LN80"><span class='Ref_to_Macro'>ReleaseVariableStats</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN111"><span class='Ref_To_Local'>vardata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/selfuncs.h.html#LN56"><span class='Ref_to_Macro'>CLAMP_PROBABILITY</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN114"><span class='Ref_To_Local'>selec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN114"><span class='Ref_To_Local'>selec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end rangesel &raquo; </span> 
 
<span class='Keyword'>static double 
</span><a name="LN227"></a><span class='Declare_Function'>calc_rangesel</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata</span><span class='Delimiter'>, 
</span><a name="LN228"></a>              <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constval</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN230"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>hist_selec</span><span class='Delimiter'>; 
</span><a name="LN231"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>selec</span><span class='Delimiter'>; 
</span><a name="LN232"></a>    <a href="../../../include/c.h.html#LN379"><span class='Ref_to_Typedef'>float4</span></a>      <span class='Declare_Local'>empty_frac</span><span class='Delimiter'>, 
</span><a name="LN233"></a>                <span class='Declare_Local'>null_frac</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * First look up the fraction of NULLs and empty ranges from pg_statistic. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN227"><span class='Ref_to_Parameter'>vardata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN240"></a>        <a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a> <span class='Declare_Local'>stats</span><span class='Delimiter'>; 
</span><a name="LN241"></a>        <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>sslot</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_selfuncs.c.html#LN240"><span class='Ref_To_Local'>stats</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_statistic.h.html#LN128"><span class='Ref_to_Typedef'>Form_pg_statistic</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN227"><span class='Ref_to_Parameter'>vardata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_selfuncs.c.html#LN233"><span class='Ref_To_Local'>null_frac</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN240"><span class='Ref_To_Local'>stats</span></a><span class='Operator'>-&GT;</span>stanullfrac<span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Try to get fraction of empty ranges */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN241"><span class='Ref_To_Local'>sslot</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN227"><span class='Ref_to_Parameter'>vardata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/catalog/pg_statistic.h.html#LN280"><span class='Ref_to_Const'>STATISTIC_KIND_RANGE_LENGTH_HISTOGRAM</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/utils/lsyscache.h.html#LN39"><span class='Ref_to_Const'>ATTSTATSSLOT_NUMBERS</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN241"><span class='Ref_To_Local'>sslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN52"><span class='Ref_to_Member'>nnumbers</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid empty fraction statistic"</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN232"><span class='Ref_To_Local'>empty_frac</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN241"><span class='Ref_To_Local'>sslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN51"><span class='Ref_to_Member'>numbers</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span>            <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN241"><span class='Ref_To_Local'>sslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No empty fraction statistic. Assume no empty ranges. */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN232"><span class='Ref_To_Local'>empty_frac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if HeapTupleIsValid(vard... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * No stats are available. Follow through the calculations below 
         * anyway, assuming no NULLs and no empty ranges. This still allows us 
         * to give a better-than-nothing estimate based on whether the 
         * constant is an empty range or not. 
         */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN233"><span class='Ref_To_Local'>null_frac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_selfuncs.c.html#LN232"><span class='Ref_To_Local'>empty_frac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN228"><span class='Ref_to_Parameter'>constval</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * An empty range matches all ranges, all empty ranges, or nothing, 
         * depending on the operator 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* these return false if either argument is empty */ 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1766"><span class='Ref_to_Const'>OID_RANGE_OVERLAP_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1787"><span class='Ref_to_Const'>OID_RANGE_OVERLAPS_LEFT_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1790"><span class='Ref_to_Const'>OID_RANGE_OVERLAPS_RIGHT_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1781"><span class='Ref_to_Const'>OID_RANGE_LEFT_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1784"><span class='Ref_to_Const'>OID_RANGE_RIGHT_OP</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* nothing is less than an empty range */ 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1754"><span class='Ref_to_Const'>OID_RANGE_LESS_OP</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* only empty ranges can be contained by an empty range */ 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1778"><span class='Ref_to_Const'>OID_RANGE_CONTAINED_OP</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* only empty ranges are &LT;= an empty range */ 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1757"><span class='Ref_to_Const'>OID_RANGE_LESS_EQUAL_OP</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN232"><span class='Ref_To_Local'>empty_frac</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* everything contains an empty range */ 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1772"><span class='Ref_to_Const'>OID_RANGE_CONTAINS_OP</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* everything is &GT;= an empty range */ 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1760"><span class='Ref_to_Const'>OID_RANGE_GREATER_EQUAL_OP</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* all non-empty ranges are &GT; an empty range */ 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1763"><span class='Ref_to_Const'>OID_RANGE_GREATER_OP</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN232"><span class='Ref_To_Local'>empty_frac</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* an element cannot be empty */ 
</span>            <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1769"><span class='Ref_to_Const'>OID_RANGE_CONTAINS_ELEM_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected operator %u"</span><span class='Delimiter'>, </span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch operator &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if RangeIsEmpty(constval... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Calculate selectivity using bound histograms. If that fails for 
         * some reason, e.g no histogram in pg_statistic, use the default 
         * constant estimate for the fraction of non-empty values. This is 
         * still somewhat better than just returning the default estimate, 
         * because this still takes into account the fraction of empty and 
         * NULL tuples, if we had statistics for them. 
         */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN230"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN32"><span class='Ref_to_Proto'>calc_hist_selectivity</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN227"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN227"><span class='Ref_to_Parameter'>vardata</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN228"><span class='Ref_to_Parameter'>constval</span></a><span class='Delimiter'>, 
</span>                                           <span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN230"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="rangetypes_selfuncs.c.html#LN230"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN31"><span class='Ref_to_Proto'>default_range_selectivity</span></a><span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now merge the results for the empty ranges and histogram 
         * calculations, realizing that the histogram covers only the 
         * non-null, non-empty values. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>operator </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN1778"><span class='Ref_to_Const'>OID_RANGE_CONTAINED_OP</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* empty is contained by anything non-empty */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN232"><span class='Ref_To_Local'>empty_frac</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_selfuncs.c.html#LN230"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>+ </span><a href="rangetypes_selfuncs.c.html#LN232"><span class='Ref_To_Local'>empty_frac</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* with any other operator, empty Op non-empty matches nothing */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN232"><span class='Ref_To_Local'>empty_frac</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_selfuncs.c.html#LN230"><span class='Ref_To_Local'>hist_selec</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* all range operators are strict */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>*= </span><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN233"><span class='Ref_To_Local'>null_frac</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* result should be in range, but make sure... */ 
</span>    <a href="../../../include/utils/selfuncs.h.html#LN56"><span class='Ref_to_Macro'>CLAMP_PROBABILITY</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN231"><span class='Ref_To_Local'>selec</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calc_rangesel &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate range operator selectivity using histograms of range bounds. 
 * 
 * This estimate is for the portion of values that are not empty and not 
 * NULL. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN369"></a><span class='Declare_Function'>calc_hist_selectivity</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/selfuncs.h.html#LN66"><span class='Ref_to_Struct'>VariableStatData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>vardata</span><span class='Delimiter'>, 
</span><a name="LN370"></a>                      <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constval</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>operator</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN372"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>hslot</span><span class='Delimiter'>; 
</span><a name="LN373"></a>    <a href="../../../include/utils/lsyscache.h.html#LN42"><span class='Ref_to_Struct'>AttStatsSlot</span></a> <span class='Declare_Local'>lslot</span><span class='Delimiter'>; 
</span><a name="LN374"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nhist</span><span class='Delimiter'>; 
</span><a name="LN375"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hist_lower</span><span class='Delimiter'>; 
</span><a name="LN376"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hist_upper</span><span class='Delimiter'>; 
</span><a name="LN377"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN378"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>const_lower</span><span class='Delimiter'>; 
</span><a name="LN379"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>const_upper</span><span class='Delimiter'>; 
</span><a name="LN380"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span><a name="LN381"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>hist_selec</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Can't use the histogram with insecure range support functions */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/selfuncs.h.html#LN156"><span class='Ref_to_Proto'>statistic_proc_security_check</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>vardata</span></a><span class='Delimiter'>, 
</span>                                       <a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN85"><span class='Ref_to_Member'>rng_cmp_proc_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="../../../include/utils/selfuncs.h.html#LN156"><span class='Ref_to_Proto'>statistic_proc_security_check</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>vardata</span></a><span class='Delimiter'>, 
</span>                                       <a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Try to get histogram of ranges */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>vardata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>          <a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN372"><span class='Ref_To_Local'>hslot</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>vardata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/catalog/pg_statistic.h.html#LN291"><span class='Ref_to_Const'>STATISTIC_KIND_BOUNDS_HISTOGRAM</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                           <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a><span class='Parentheses'>)))</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Convert histogram of ranges into histograms of its lower and upper 
     * bounds. 
     */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN372"><span class='Ref_To_Local'>hslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN376"><span class='Ref_To_Local'>hist_upper</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN377"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_selfuncs.c.html#LN377"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>; </span><a href="rangetypes_selfuncs.c.html#LN377"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN372"><span class='Ref_To_Local'>hslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN377"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN377"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN376"><span class='Ref_To_Local'>hist_upper</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN377"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN380"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* The histogram should not contain any empty ranges */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN380"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"bounds histogram contains an empty range"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* @&GT; and @&LT; also need a histogram of range lengths */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>operator </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN1772"><span class='Ref_to_Const'>OID_RANGE_CONTAINS_OP</span></a> <span class='Operator'>|| 
</span>        <span class='Keyword'>operator </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_operator.h.html#LN1778"><span class='Ref_to_Const'>OID_RANGE_CONTAINED_OP</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>vardata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>              <a href="../../../include/utils/lsyscache.h.html#LN172"><span class='Ref_to_Proto'>get_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>vardata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/selfuncs.h.html#LN70"><span class='Ref_to_Member'>statsTuple</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/catalog/pg_statistic.h.html#LN280"><span class='Ref_to_Const'>STATISTIC_KIND_RANGE_LENGTH_HISTOGRAM</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/lsyscache.h.html#LN38"><span class='Ref_to_Const'>ATTSTATSSLOT_VALUES</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN372"><span class='Ref_To_Local'>hslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* check that it's a histogram, not just a dummy entry */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a> <span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN372"><span class='Ref_To_Local'>hslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if operator==OID_RANGE_C... &raquo; </span> 
    <span class='Control'>else</span> 
        memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract the bounds of the constant value. */ 
</span>    <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN370"><span class='Ref_to_Parameter'>constval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN379"><span class='Ref_To_Local'>const_upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN380"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_selfuncs.c.html#LN380"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate selectivity comparing the lower or upper bound of the 
     * constant with the histogram of lower or upper bounds. 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Keyword'>operator</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1754"><span class='Ref_to_Const'>OID_RANGE_LESS_OP</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The regular b-tree comparison operators (&LT;, &LT;=, &GT;, &GT;=) compare 
             * the lower bounds first, and the upper bounds for values with 
             * equal lower bounds. Estimate that by comparing the lower bounds 
             * only. This gives a fairly accurate estimate assuming there 
             * aren't many rows with a lower bound equal to the constant's 
             * lower bound. 
             */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, 
</span>                                             <a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1757"><span class='Ref_to_Const'>OID_RANGE_LESS_EQUAL_OP</span></a><span class='Operator'>: 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, 
</span>                                             <a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1763"><span class='Ref_to_Const'>OID_RANGE_GREATER_OP</span></a><span class='Operator'>: 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <span class='Number'>1</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1760"><span class='Ref_to_Const'>OID_RANGE_GREATER_EQUAL_OP</span></a><span class='Operator'>: 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <span class='Number'>1</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1781"><span class='Ref_to_Const'>OID_RANGE_LEFT_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* var &LT;&LT; const when upper(var) &LT; lower(const) */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, 
</span>                                             <a href="rangetypes_selfuncs.c.html#LN376"><span class='Ref_To_Local'>hist_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1784"><span class='Ref_to_Const'>OID_RANGE_RIGHT_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* var &GT;&GT; const when lower(var) &GT; upper(const) */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <span class='Number'>1</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN379"><span class='Ref_To_Local'>const_upper</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1790"><span class='Ref_to_Const'>OID_RANGE_OVERLAPS_RIGHT_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* compare lower bounds */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <span class='Number'>1</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1787"><span class='Ref_to_Const'>OID_RANGE_OVERLAPS_LEFT_OP</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* compare upper bounds */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN379"><span class='Ref_To_Local'>const_upper</span></a><span class='Delimiter'>, 
</span>                                             <a href="rangetypes_selfuncs.c.html#LN376"><span class='Ref_To_Local'>hist_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1766"><span class='Ref_to_Const'>OID_RANGE_OVERLAP_OP</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1769"><span class='Ref_to_Const'>OID_RANGE_CONTAINS_ELEM_OP</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * A && B &LT;=&GT; NOT (A &LT;&LT; B OR A &GT;&GT; B). 
             * 
             * Since A &LT;&LT; B and A &GT;&GT; B are mutually exclusive events we can 
             * sum their probabilities to find probability of (A &LT;&LT; B OR A &GT;&GT; 
             * B). 
             * 
             * "range @&GT; elem" is equivalent to "range && [elem,elem]". The 
             * caller already constructed the singular range from the element 
             * constant, so just treat it the same as &&. 
             */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN376"><span class='Ref_To_Local'>hist_upper</span></a><span class='Delimiter'>, 
</span>                                             <a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>+= 
</span>                <span class='Parentheses'>(</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN379"><span class='Ref_To_Local'>const_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, 
</span>                                                    <a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1772"><span class='Ref_to_Const'>OID_RANGE_CONTAINS_OP</span></a><span class='Operator'>: 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                <a href="rangetypes_selfuncs.c.html#LN54"><span class='Ref_to_Proto'>calc_hist_selectivity_contains</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN379"><span class='Ref_To_Local'>const_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, 
</span>                                               <a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/catalog/pg_operator.h.html#LN1778"><span class='Ref_to_Const'>OID_RANGE_CONTAINED_OP</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Lower bound no longer matters. Just estimate the fraction 
                 * with an upper bound &LT;= const upper bound 
                 */ 
</span>                <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                    <a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN379"><span class='Ref_To_Local'>const_upper</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN376"><span class='Ref_To_Local'>hist_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN379"><span class='Ref_To_Local'>const_upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                    <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN35"><span class='Ref_to_Proto'>calc_hist_selectivity_scalar</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, 
</span>                                                   <a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= 
</span>                    <a href="rangetypes_selfuncs.c.html#LN50"><span class='Ref_to_Proto'>calc_hist_selectivity_contained</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN369"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN378"><span class='Ref_To_Local'>const_lower</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN379"><span class='Ref_To_Local'>const_upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN375"><span class='Ref_To_Local'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN374"><span class='Ref_To_Local'>nhist</span></a><span class='Delimiter'>, 
</span>                                                <a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN48"><span class='Ref_to_Member'>values</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Operator'>.</span><a href="../../../include/utils/lsyscache.h.html#LN49"><span class='Ref_to_Member'>nvalues</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unknown range operator %u"</span><span class='Delimiter'>, </span><span class='Keyword'>operator</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch operator &raquo; </span> 
 
    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN373"><span class='Ref_To_Local'>lslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/lsyscache.h.html#LN174"><span class='Ref_to_Proto'>free_attstatsslot</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN372"><span class='Ref_To_Local'>hslot</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN381"><span class='Ref_To_Local'>hist_selec</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calc_hist_selectivity &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Look up the fraction of values less than (or equal, if 'equal' argument 
 * is true) a given const in a histogram of range bounds. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN585"></a><span class='Declare_Function'>calc_hist_selectivity_scalar</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>constbound</span><span class='Delimiter'>, 
</span><a name="LN586"></a>                             <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>equal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN588"></a>    <a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a> <span class='Declare_Local'>selec</span><span class='Delimiter'>; 
</span><a name="LN589"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>index</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Find the histogram bin the given constant falls into. Estimate 
     * selectivity as the number of preceding whole bins. 
     */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN589"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN39"><span class='Ref_to_Proto'>rbound_bsearch</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN585"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN585"><span class='Ref_to_Parameter'>constbound</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN586"><span class='Ref_to_Parameter'>hist</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN586"><span class='Ref_to_Parameter'>hist_nvalues</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN586"><span class='Ref_to_Parameter'>equal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN588"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a><span class='Parentheses'>) (</span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN589"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a><span class='Parentheses'>) (</span><a href="rangetypes_selfuncs.c.html#LN586"><span class='Ref_to_Parameter'>hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Adjust using linear interpolation within the bin */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN589"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="rangetypes_selfuncs.c.html#LN589"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_selfuncs.c.html#LN586"><span class='Ref_to_Parameter'>hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="rangetypes_selfuncs.c.html#LN588"><span class='Ref_To_Local'>selec</span></a> <span class='Operator'>+= </span><a href="rangetypes_selfuncs.c.html#LN41"><span class='Ref_to_Proto'>get_position</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN585"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN585"><span class='Ref_to_Parameter'>constbound</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN586"><span class='Ref_to_Parameter'>hist</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN589"><span class='Ref_To_Local'>index</span></a><span class='Delimiter'>], 
</span>                        <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN586"><span class='Ref_to_Parameter'>hist</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN589"><span class='Ref_To_Local'>index</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN637"><span class='Ref_to_Typedef'>Selectivity</span></a><span class='Parentheses'>) (</span><a href="rangetypes_selfuncs.c.html#LN586"><span class='Ref_to_Parameter'>hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN588"><span class='Ref_To_Local'>selec</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calc_hist_selectivity_scalar &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Binary search on an array of range bounds. Returns greatest index of range 
 * bound in array which is less(less or equal) than given range bound. If all 
 * range bounds in array are greater or equal(greater) than given range bound, 
 * return -1. When "equal" flag is set conditions in brackets are used. 
 * 
 * This function is used in scalar operator selectivity estimation. Another 
 * goal of this function is to find a histogram bin where to stop 
 * interpolation of portion of bounds which are less or equal to given bound. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN617"></a><span class='Declare_Function'>rbound_bsearch</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist</span><span class='Delimiter'>, 
</span><a name="LN618"></a>               <span class='Keyword'>int </span><span class='Declare_Parameter'>hist_length</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>equal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN620"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lower</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN621"></a>                <span class='Declare_Local'>upper</span> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN618"><span class='Ref_to_Parameter'>hist_length</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN622"></a>                <span class='Declare_Local'>cmp</span><span class='Delimiter'>, 
</span><a name="LN623"></a>                <span class='Declare_Local'>middle</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN620"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_selfuncs.c.html#LN621"><span class='Ref_To_Local'>upper</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_selfuncs.c.html#LN623"><span class='Ref_To_Local'>middle</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN620"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>+ </span><a href="rangetypes_selfuncs.c.html#LN621"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_selfuncs.c.html#LN622"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN617"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN617"><span class='Ref_to_Parameter'>hist</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN623"><span class='Ref_To_Local'>middle</span></a><span class='Delimiter'>], </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN622"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN618"><span class='Ref_to_Parameter'>equal</span></a> <span class='Operator'>&& </span><a href="rangetypes_selfuncs.c.html#LN622"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <a href="rangetypes_selfuncs.c.html#LN620"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN623"><span class='Ref_To_Local'>middle</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="rangetypes_selfuncs.c.html#LN621"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN623"><span class='Ref_To_Local'>middle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN620"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end rbound_bsearch &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Binary search on length histogram. Returns greatest index of range length in 
 * histogram which is less than (less than or equal) the given length value. If 
 * all lengths in the histogram are greater than (greater than or equal) the 
 * given length, returns -1. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN646"></a><span class='Declare_Function'>length_hist_bsearch</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>length_hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>length_hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN647"></a>                    <span class='Keyword'>double </span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>equal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN649"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lower</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN650"></a>                <span class='Declare_Local'>upper</span> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN646"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span><a name="LN651"></a>                <span class='Declare_Local'>middle</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN649"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_selfuncs.c.html#LN650"><span class='Ref_To_Local'>upper</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN655"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>middleval</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_selfuncs.c.html#LN651"><span class='Ref_To_Local'>middle</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN649"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>+ </span><a href="rangetypes_selfuncs.c.html#LN650"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_selfuncs.c.html#LN655"><span class='Ref_To_Local'>middleval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN646"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN651"><span class='Ref_To_Local'>middle</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN655"><span class='Ref_To_Local'>middleval</span></a> <span class='Operator'>&LT; </span><span class='Keyword'>value </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN647"><span class='Ref_to_Parameter'>equal</span></a> <span class='Operator'>&& </span><a href="rangetypes_selfuncs.c.html#LN655"><span class='Ref_To_Local'>middleval</span></a> <span class='Operator'>&LT;= </span><span class='Keyword'>value</span><span class='Parentheses'>))</span> 
            <a href="rangetypes_selfuncs.c.html#LN649"><span class='Ref_To_Local'>lower</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN651"><span class='Ref_To_Local'>middle</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="rangetypes_selfuncs.c.html#LN650"><span class='Ref_To_Local'>upper</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN651"><span class='Ref_To_Local'>middle</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN649"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end length_hist_bsearch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Get relative position of value in histogram bin in [0,1] range. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> 
<a name="LN672"></a><span class='Declare_Function'>get_position</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist1</span><span class='Delimiter'>, 
</span><a name="LN673"></a>             <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN675"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_subdiff</span> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN676"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>position</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>hist1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& !</span><a href="rangetypes_selfuncs.c.html#LN673"><span class='Ref_to_Parameter'>hist2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN680"></a>        <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>bin_width</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Both bounds are finite. Assuming the subtype's comparison function 
         * works sanely, the value must be finite, too, because it lies 
         * somewhere between the bounds. If it doesn't, just return something. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Can't interpolate without subdiff function */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_selfuncs.c.html#LN675"><span class='Ref_To_Local'>has_subdiff</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Calculate relative position using subdiff function. */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN680"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>( 
</span>                                                <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Delimiter'>, 
</span>                                                     <a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN84"><span class='Ref_to_Member'>rng_collation</span></a><span class='Delimiter'>, 
</span>                                                     <a href="rangetypes_selfuncs.c.html#LN673"><span class='Ref_to_Parameter'>hist2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                                     <a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>hist1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN680"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* zero width bin */ 
</span> 
        <a href="rangetypes_selfuncs.c.html#LN676"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>( 
</span>                                                <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Delimiter'>, 
</span>                                                    <a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN84"><span class='Ref_to_Member'>rng_collation</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                                    <a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>hist1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>))</span> 
            <span class='Operator'>/ </span><a href="rangetypes_selfuncs.c.html#LN680"><span class='Ref_To_Local'>bin_width</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Relative position must be in [0,1] range */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN676"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN676"><span class='Ref_To_Local'>position</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_selfuncs.c.html#LN676"><span class='Ref_To_Local'>position</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN676"><span class='Ref_To_Local'>position</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN676"><span class='Ref_To_Local'>position</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !hist1-&GT;infinite&&!hi... &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>hist1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& !</span><a href="rangetypes_selfuncs.c.html#LN673"><span class='Ref_to_Parameter'>hist2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Lower bin boundary is -infinite, upper is finite. If the value is 
         * -infinite, return 0.0 to indicate it's equal to the lower bound. 
         * Otherwise return 1.0 to indicate it's infinitely far from the lower 
         * bound. 
         */ 
</span>        <span class='Control'>return</span> <span class='Parentheses'>((</span><span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& </span><span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_selfuncs.c.html#LN672"><span class='Ref_to_Parameter'>hist1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& </span><a href="rangetypes_selfuncs.c.html#LN673"><span class='Ref_to_Parameter'>hist2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* same as above, but in reverse */ 
</span>        <span class='Control'>return</span> <span class='Parentheses'>((</span><span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& !</span><span class='Keyword'>value</span><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If both bin boundaries are infinite, they should be equal to each 
         * other, and the value should also be infinite and equal to both 
         * bounds. (But don't Assert that, to avoid crashing if a user creates 
         * a datatype with a broken comparison function). 
         * 
         * Assume the value to lie in the middle of the infinite bounds. 
         */ 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_position &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Get relative position of value in a length histogram bin in [0,1] range. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN749"></a><span class='Declare_Function'>get_len_position</span><span class='Parentheses'>(</span><span class='Keyword'>double </span><span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>hist1</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>hist2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN749"><span class='Ref_to_Parameter'>hist1</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN749"><span class='Ref_to_Parameter'>hist2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Both bounds are finite. The value should be finite too, because it 
         * lies somewhere between the bounds. If it doesn't, just return 
         * something. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN749"><span class='Ref_to_Parameter'>hist2</span></a> <span class='Operator'>- </span><span class='Keyword'>value</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN749"><span class='Ref_to_Parameter'>hist2</span></a> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN749"><span class='Ref_to_Parameter'>hist1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN749"><span class='Ref_to_Parameter'>hist1</span></a><span class='Parentheses'>) </span><span class='Operator'>&& !</span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN749"><span class='Ref_to_Parameter'>hist2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Lower bin boundary is -infinite, upper is finite. Return 1.0 to 
         * indicate the value is infinitely far from the lower bound. 
         */ 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN749"><span class='Ref_to_Parameter'>hist1</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN749"><span class='Ref_to_Parameter'>hist2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* same as above, but in reverse */ 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If both bin boundaries are infinite, they should be equal to each 
         * other, and the value should also be infinite and equal to both 
         * bounds. (But don't Assert that, to avoid crashing unnecessarily if 
         * the caller messes up) 
         * 
         * Assume the value to lie in the middle of the infinite bounds. 
         */ 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_len_position &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Measure distance between two range bounds. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> 
<a name="LN794"></a><span class='Declare_Function'>get_distance</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bound1</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>bound2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN796"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>has_subdiff</span> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Operator'>.</span><a href="../../../include/fmgr.h.html#LN58"><span class='Ref_to_Member'>fn_oid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>bound1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& !</span><a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>bound2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * No bounds are infinite, use subdiff function or return default 
         * value of 1.0 if no subdiff is available. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN796"><span class='Ref_To_Local'>has_subdiff</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> 
                <a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN512"><span class='Ref_to_Proto'>FunctionCall2Coll</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN87"><span class='Ref_to_Member'>rng_subdiff_finfo</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>typcache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/typcache.h.html#LN84"><span class='Ref_to_Member'>rng_collation</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>bound2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>bound1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>bound1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>&& </span><a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>bound2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Both bounds are infinite */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>bound1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>== </span><a href="rangetypes_selfuncs.c.html#LN794"><span class='Ref_to_Parameter'>bound2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN55"><span class='Ref_to_Proto'>get_float8_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* One bound is infinite, another is not */ 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN55"><span class='Ref_to_Proto'>get_float8_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end get_distance &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate the average of function P(x), in the interval [length1, length2], 
 * where P(x) is the fraction of tuples with length &LT; x (or length &LT;= x if 
 * 'equal' is true). 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN834"></a><span class='Declare_Function'>calc_length_hist_frac</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>length_hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>length_hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN835"></a>                      <span class='Keyword'>double </span><span class='Declare_Parameter'>length1</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>length2</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>equal</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN837"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>frac</span><span class='Delimiter'>; 
</span><a name="LN838"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>A</span><span class='Delimiter'>, 
</span><a name="LN839"></a>                <span class='Declare_Local'>B</span><span class='Delimiter'>, 
</span><a name="LN840"></a>                <span class='Declare_Local'>PA</span><span class='Delimiter'>, 
</span><a name="LN841"></a>                <span class='Declare_Local'>PB</span><span class='Delimiter'>; 
</span><a name="LN842"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>pos</span><span class='Delimiter'>; 
</span><a name="LN843"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN844"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>area</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a> <span class='Operator'>&GT;= </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* shouldn't happen, but doesn't hurt to check */ 
</span> 
    <span class='Comment_Multi_Line'>/* All lengths in the table are &LT;= infinite. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>equal</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * The average of a function between A and B can be calculated by the 
     * formula: 
     * 
     *          B 
     *    1     / 
     * -------  | P(x)dx 
     *  B - A   / 
     *          A 
     * 
     * The geometrical interpretation of the integral is the area under the 
     * graph of P(x). P(x) is defined by the length histogram. We calculate 
     * the area in a piecewise fashion, iterating through the length histogram 
     * bins. Each bin is a trapezoid: 
     * 
     *       P(x2) 
     *        /| 
     *       / | 
     * P(x1)/  | 
     *     |   | 
     *     |   | 
     *  ---+---+-- 
     *     x1  x2 
     * 
     * where x1 and x2 are the boundaries of the current histogram, and P(x1) 
     * and P(x1) are the cumulative fraction of tuples at the boundaries. 
     * 
     * The area of each trapezoid is 1/2 * (P(x2) + P(x1)) * (x2 - x1) 
     * 
     * The first bin contains the lower bound passed by the caller, so we 
     * use linear interpolation between the previous and next histogram bin 
     * boundary to calculate P(x1). Likewise for the last bin: we use linear 
     * interpolation to calculate P(x2). For the bins in between, x1 and x2 
     * lie on histogram bin boundaries, so P(x1) and P(x2) are simply: 
     * P(x1) =    (bin index) / (number of bins) 
     * P(x2) = (bin index + 1 / (number of bins) 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* First bin, the one that contains lower bound */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN46"><span class='Ref_to_Proto'>length_hist_bsearch</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length1</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>equal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_selfuncs.c.html#LN842"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* interpolate length1's position in the bin */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN842"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN43"><span class='Ref_to_Proto'>get_len_position</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length1</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a> <span class='Operator'>= </span><span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="rangetypes_selfuncs.c.html#LN842"><span class='Ref_To_Local'>pos</span></a><span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN839"><span class='Ref_To_Local'>B</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length1</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In the degenerate case that length1 == length2, simply return 
     * P(length1). This is not merely an optimization: if length1 == length2, 
     * we'd divide by zero later on. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a> <span class='Operator'>== </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length1</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Loop through all the bins, until we hit the last bin, the one that 
     * contains the upper bound. (if lower and upper bounds are in the same 
     * bin, this falls out immediately) 
     */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN844"><span class='Ref_To_Local'>area</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN929"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>bin_upper</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* check if we've reached the last bin */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN929"><span class='Ref_To_Local'>bin_upper</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>equal</span></a> <span class='Operator'>&& </span><a href="rangetypes_selfuncs.c.html#LN929"><span class='Ref_To_Local'>bin_upper</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a><span class='Parentheses'>)))</span> 
            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* the upper bound of previous bin is the lower bound of this bin */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN838"><span class='Ref_To_Local'>A</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN839"><span class='Ref_To_Local'>B</span></a><span class='Delimiter'>; 
</span>        <a href="rangetypes_selfuncs.c.html#LN840"><span class='Ref_To_Local'>PA</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_selfuncs.c.html#LN839"><span class='Ref_To_Local'>B</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN929"><span class='Ref_To_Local'>bin_upper</span></a><span class='Delimiter'>; 
</span>        <a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add the area of this trapezoid to the total. The point of the 
         * if-check is to avoid NaN, in the corner case that PA == PB == 0, 
         * and B - A == Inf. The area of a zero-height trapezoid (PA == PB == 
         * 0) is zero, regardless of the width (B - A). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN840"><span class='Ref_To_Local'>PA</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="rangetypes_selfuncs.c.html#LN844"><span class='Ref_To_Local'>area</span></a> <span class='Operator'>+= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a> <span class='Operator'>+ </span><a href="rangetypes_selfuncs.c.html#LN840"><span class='Ref_To_Local'>PA</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN839"><span class='Ref_To_Local'>B</span></a> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN838"><span class='Ref_To_Local'>A</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;i&LT;length_hist_nvalue... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Last bin */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN838"><span class='Ref_To_Local'>A</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN839"><span class='Ref_To_Local'>B</span></a><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN840"><span class='Ref_To_Local'>PA</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_selfuncs.c.html#LN839"><span class='Ref_To_Local'>B</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* last bin ends at the query upper bound */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="rangetypes_selfuncs.c.html#LN842"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span> 
            <a href="rangetypes_selfuncs.c.html#LN842"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="rangetypes_selfuncs.c.html#LN842"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN43"><span class='Ref_to_Proto'>get_len_position</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN720"><span class='Ref_to_Func'>DatumGetFloat8</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a> <span class='Operator'>= </span><span class='Parentheses'>(((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="rangetypes_selfuncs.c.html#LN843"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="rangetypes_selfuncs.c.html#LN842"><span class='Ref_To_Local'>pos</span></a><span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="rangetypes_selfuncs.c.html#LN834"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN840"><span class='Ref_To_Local'>PA</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="rangetypes_selfuncs.c.html#LN844"><span class='Ref_To_Local'>area</span></a> <span class='Operator'>+= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN841"><span class='Ref_To_Local'>PB</span></a> <span class='Operator'>+ </span><a href="rangetypes_selfuncs.c.html#LN840"><span class='Ref_To_Local'>PA</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN839"><span class='Ref_To_Local'>B</span></a> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN838"><span class='Ref_To_Local'>A</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Ok, we have calculated the area, ie. the integral. Divide by width to 
     * get the requested average. 
     * 
     * Avoid NaN arising from infinite / infinite. This happens at least if 
     * length2 is infinite. It's not clear what the correct value would be in 
     * that case, so 0.5 seems as good as any value. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN844"><span class='Ref_To_Local'>area</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="../../../include/utils/builtins.h.html#LN59"><span class='Ref_to_Proto'>is_infinite</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a><span class='Parentheses'>))</span> 
        <a href="rangetypes_selfuncs.c.html#LN837"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>5</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="rangetypes_selfuncs.c.html#LN837"><span class='Ref_To_Local'>frac</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN844"><span class='Ref_To_Local'>area</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length2</span></a> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN835"><span class='Ref_to_Parameter'>length1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN837"><span class='Ref_To_Local'>frac</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calc_length_hist_frac &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate selectivity of "var &LT;@ const" operator, ie. estimate the fraction 
 * of ranges that fall within the constant lower and upper bounds. This uses 
 * the histograms of range lower bounds and range lengths, on the assumption 
 * that the range lengths are independent of the lower bounds. 
 * 
 * The caller has already checked that constant lower and upper bounds are 
 * finite. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN997"></a><span class='Declare_Function'>calc_hist_selectivity_contained</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN998"></a>                                <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lower</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>upper</span><span class='Delimiter'>, 
</span><a name="LN999"></a>                                <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist_lower</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN1000"></a>                          <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>length_hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>length_hist_nvalues</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1002"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1003"></a>                <span class='Declare_Local'>upper_index</span><span class='Delimiter'>; 
</span><a name="LN1004"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>prev_dist</span><span class='Delimiter'>; 
</span><a name="LN1005"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>bin_width</span><span class='Delimiter'>; 
</span><a name="LN1006"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>upper_bin_width</span><span class='Delimiter'>; 
</span><a name="LN1007"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>sum_frac</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Begin by finding the bin containing the upper bound, in the lower bound 
     * histogram. Any range with a lower bound &GT; constant upper bound can't 
     * match, ie. there are no matches in bins greater than upper_index. 
     */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>upper</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN63"><span class='Ref_to_Member'>inclusive</span></a> <span class='Operator'>= !</span><a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>upper</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN63"><span class='Ref_to_Member'>inclusive</span></a><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>upper</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN1003"><span class='Ref_To_Local'>upper_index</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN39"><span class='Ref_to_Proto'>rbound_bsearch</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN997"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>upper</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_nvalues</span></a><span class='Delimiter'>, 
</span>                                 <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate upper_bin_width, ie. the fraction of the (upper_index, 
     * upper_index + 1) bin which is greater than upper bound of query range 
     * using linear interpolation of subdiff function. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1003"><span class='Ref_To_Local'>upper_index</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="rangetypes_selfuncs.c.html#LN1003"><span class='Ref_To_Local'>upper_index</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="rangetypes_selfuncs.c.html#LN1006"><span class='Ref_To_Local'>upper_bin_width</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN41"><span class='Ref_to_Proto'>get_position</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN997"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>upper</span></a><span class='Delimiter'>, 
</span>                                       <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN1003"><span class='Ref_To_Local'>upper_index</span></a><span class='Delimiter'>], 
</span>                                       <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN1003"><span class='Ref_To_Local'>upper_index</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="rangetypes_selfuncs.c.html#LN1006"><span class='Ref_To_Local'>upper_bin_width</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In the loop, dist and prev_dist are the distance of the "current" bin's 
     * lower and upper bounds from the constant upper bound. 
     * 
     * bin_width represents the width of the current bin. Normally it is 1.0, 
     * meaning a full width bin, but can be less in the corner cases: start 
     * and end of the loop. We start with bin_width = upper_bin_width, because 
     * we begin at the bin containing the upper bound. 
     */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN1004"><span class='Ref_To_Local'>prev_dist</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN1005"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN1006"><span class='Ref_To_Local'>upper_bin_width</span></a><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_selfuncs.c.html#LN1007"><span class='Ref_To_Local'>sum_frac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1002"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN1003"><span class='Ref_To_Local'>upper_index</span></a><span class='Delimiter'>; </span><a href="rangetypes_selfuncs.c.html#LN1002"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_selfuncs.c.html#LN1002"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1046"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>dist</span><span class='Delimiter'>; 
</span><a name="LN1047"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>length_hist_frac</span><span class='Delimiter'>; 
</span><a name="LN1048"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>final_bin</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * dist -- distance from upper bound of query range to lower bound of 
         * the current bin in the lower bound histogram. Or to the lower bound 
         * of the constant range, if this is the final bin, containing the 
         * constant lower bound. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN997"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN1002"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>lower</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="rangetypes_selfuncs.c.html#LN1046"><span class='Ref_To_Local'>dist</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN44"><span class='Ref_to_Proto'>get_distance</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN997"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>upper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Subtract from bin_width the portion of this bin that we want to 
             * ignore. 
             */ 
</span>            <a href="rangetypes_selfuncs.c.html#LN1005"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>-= </span><a href="rangetypes_selfuncs.c.html#LN41"><span class='Ref_to_Proto'>get_position</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN997"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN1002"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                      <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN1002"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1005"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="rangetypes_selfuncs.c.html#LN1005"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_selfuncs.c.html#LN1048"><span class='Ref_To_Local'>final_bin</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="rangetypes_selfuncs.c.html#LN1046"><span class='Ref_To_Local'>dist</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN44"><span class='Ref_to_Proto'>get_distance</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN997"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN1002"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="rangetypes_selfuncs.c.html#LN998"><span class='Ref_to_Parameter'>upper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Estimate the fraction of tuples in this bin that are narrow enough 
         * to not exceed the distance to the upper bound of the query range. 
         */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN1047"><span class='Ref_To_Local'>length_hist_frac</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN48"><span class='Ref_to_Proto'>calc_length_hist_frac</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1000"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN1000"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a><span class='Delimiter'>, 
</span>                                                 <a href="rangetypes_selfuncs.c.html#LN1004"><span class='Ref_To_Local'>prev_dist</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN1046"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Add the fraction of tuples in this bin, with a suitable length, to 
         * the total. 
         */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN1007"><span class='Ref_To_Local'>sum_frac</span></a> <span class='Operator'>+= </span><a href="rangetypes_selfuncs.c.html#LN1047"><span class='Ref_To_Local'>length_hist_frac</span></a> <span class='Operator'>* </span><a href="rangetypes_selfuncs.c.html#LN1005"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="rangetypes_selfuncs.c.html#LN999"><span class='Ref_to_Parameter'>hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1048"><span class='Ref_To_Local'>final_bin</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_selfuncs.c.html#LN1005"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_selfuncs.c.html#LN1004"><span class='Ref_To_Local'>prev_dist</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN1046"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=upper_index;i&GT;=0;i-... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN1007"><span class='Ref_To_Local'>sum_frac</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calc_hist_selectivity_contained &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Calculate selectivity of "var @&GT; const" operator, ie. estimate the fraction 
 * of ranges that contain the constant lower and upper bounds. This uses 
 * the histograms of range lower bounds and range lengths, on the assumption 
 * that the range lengths are independent of the lower bounds. 
 * 
 * Note, this is "var @&GT; const", ie. estimate the fraction of ranges that 
 * contain the constant lower and upper bounds. 
 */ 
</span><span class='Keyword'>static double 
</span><a name="LN1107"></a><span class='Declare_Function'>calc_hist_selectivity_contains</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN1108"></a>                               <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>lower</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>upper</span><span class='Delimiter'>, 
</span><a name="LN1109"></a>                               <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hist_lower</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>hist_nvalues</span><span class='Delimiter'>, 
</span><a name="LN1110"></a>                          <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>length_hist_values</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>length_hist_nvalues</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1112"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN1113"></a>                <span class='Declare_Local'>lower_index</span><span class='Delimiter'>; 
</span><a name="LN1114"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>bin_width</span><span class='Delimiter'>, 
</span><a name="LN1115"></a>                <span class='Declare_Local'>lower_bin_width</span><span class='Delimiter'>; 
</span><a name="LN1116"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>sum_frac</span><span class='Delimiter'>; 
</span><a name="LN1117"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>prev_dist</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the bin containing the lower bound of query range. */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN1113"><span class='Ref_To_Local'>lower_index</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN39"><span class='Ref_to_Proto'>rbound_bsearch</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1107"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN1108"><span class='Ref_to_Parameter'>lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN1109"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN1109"><span class='Ref_to_Parameter'>hist_nvalues</span></a><span class='Delimiter'>, 
</span>                                 <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Calculate lower_bin_width, ie. the fraction of the of (lower_index, 
     * lower_index + 1) bin which is greater than lower bound of query range 
     * using linear interpolation of subdiff function. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1113"><span class='Ref_To_Local'>lower_index</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="rangetypes_selfuncs.c.html#LN1113"><span class='Ref_To_Local'>lower_index</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_selfuncs.c.html#LN1109"><span class='Ref_to_Parameter'>hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="rangetypes_selfuncs.c.html#LN1115"><span class='Ref_To_Local'>lower_bin_width</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN41"><span class='Ref_to_Proto'>get_position</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1107"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN1108"><span class='Ref_to_Parameter'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN1109"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN1113"><span class='Ref_To_Local'>lower_index</span></a><span class='Delimiter'>], 
</span>                                       <span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN1109"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN1113"><span class='Ref_To_Local'>lower_index</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="rangetypes_selfuncs.c.html#LN1115"><span class='Ref_To_Local'>lower_bin_width</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Loop through all the lower bound bins, smaller than the query lower 
     * bound. In the loop, dist and prev_dist are the distance of the 
     * "current" bin's lower and upper bounds from the constant upper bound. 
     * We begin from query lower bound, and walk backwards, so the first bin's 
     * upper bound is the query lower bound, and its distance to the query 
     * upper bound is the length of the query range. 
     * 
     * bin_width represents the width of the current bin. Normally it is 1.0, 
     * meaning a full width bin, except for the first bin, which is only 
     * counted up to the constant lower bound. 
     */ 
</span>    <a href="rangetypes_selfuncs.c.html#LN1117"><span class='Ref_To_Local'>prev_dist</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN44"><span class='Ref_to_Proto'>get_distance</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1107"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN1108"><span class='Ref_to_Parameter'>lower</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN1108"><span class='Ref_to_Parameter'>upper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN1116"><span class='Ref_To_Local'>sum_frac</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_selfuncs.c.html#LN1114"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN1115"><span class='Ref_To_Local'>lower_bin_width</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN1113"><span class='Ref_To_Local'>lower_index</span></a><span class='Delimiter'>; </span><a href="rangetypes_selfuncs.c.html#LN1112"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_selfuncs.c.html#LN1112"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1151"></a>        <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>dist</span><span class='Delimiter'>; 
</span><a name="LN1152"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>length_hist_frac</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * dist -- distance from upper bound of query range to current value 
         * of lower bound histogram or lower bound of query range (if we've 
         * reach it). 
         */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN1151"><span class='Ref_To_Local'>dist</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN44"><span class='Ref_to_Proto'>get_distance</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1107"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_selfuncs.c.html#LN1109"><span class='Ref_to_Parameter'>hist_lower</span></a><span class='Delimiter'>[</span><a href="rangetypes_selfuncs.c.html#LN1112"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="rangetypes_selfuncs.c.html#LN1108"><span class='Ref_to_Parameter'>upper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get average fraction of length histogram which covers intervals 
         * longer than (or equal to) distance to upper bound of query range. 
         */ 
</span>        <a href="rangetypes_selfuncs.c.html#LN1152"><span class='Ref_To_Local'>length_hist_frac</span></a> <span class='Operator'>= 
</span>            <span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>- </span><a href="rangetypes_selfuncs.c.html#LN48"><span class='Ref_to_Proto'>calc_length_hist_frac</span></a><span class='Parentheses'>(</span><a href="rangetypes_selfuncs.c.html#LN1110"><span class='Ref_to_Parameter'>length_hist_values</span></a><span class='Delimiter'>, 
</span>                                        <a href="rangetypes_selfuncs.c.html#LN1110"><span class='Ref_to_Parameter'>length_hist_nvalues</span></a><span class='Delimiter'>, 
</span>                                        <a href="rangetypes_selfuncs.c.html#LN1117"><span class='Ref_To_Local'>prev_dist</span></a><span class='Delimiter'>, </span><a href="rangetypes_selfuncs.c.html#LN1151"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_selfuncs.c.html#LN1116"><span class='Ref_To_Local'>sum_frac</span></a> <span class='Operator'>+= </span><a href="rangetypes_selfuncs.c.html#LN1152"><span class='Ref_To_Local'>length_hist_frac</span></a> <span class='Operator'>* </span><a href="rangetypes_selfuncs.c.html#LN1114"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) (</span><a href="rangetypes_selfuncs.c.html#LN1109"><span class='Ref_to_Parameter'>hist_nvalues</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_selfuncs.c.html#LN1114"><span class='Ref_To_Local'>bin_width</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_selfuncs.c.html#LN1117"><span class='Ref_To_Local'>prev_dist</span></a> <span class='Operator'>= </span><a href="rangetypes_selfuncs.c.html#LN1151"><span class='Ref_To_Local'>dist</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=lower_index;i&GT;=0;i-... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="rangetypes_selfuncs.c.html#LN1116"><span class='Ref_To_Local'>sum_frac</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calc_hist_selectivity_contains &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>