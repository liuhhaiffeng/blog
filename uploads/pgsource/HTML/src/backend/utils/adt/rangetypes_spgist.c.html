<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\rangetypes_spgist.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\rangetypes_spgist.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:53 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * rangetypes_spgist.c 
 *    implementation of quad tree over ranges mapped to 2d-points for SP-GiST. 
 * 
 * Quad tree is a data structure similar to a binary tree, but is adapted to 
 * 2d data. Each inner node of a quad tree contains a point (centroid) which 
 * divides the 2d-space into 4 quadrants. Each quadrant is associated with a 
 * child node. 
 * 
 * Ranges are mapped to 2d-points so that the lower bound is one dimension, 
 * and the upper bound is another. By convention, we visualize the lower bound 
 * to be the horizontal axis, and upper bound the vertical axis. 
 * 
 * One quirk with this mapping is the handling of empty ranges. An empty range 
 * doesn't have lower and upper bounds, so it cannot be mapped to 2d space in 
 * a straightforward way. To cope with that, the root node can have a 5th 
 * quadrant, which is reserved for empty ranges. Furthermore, there can be 
 * inner nodes in the tree with no centroid. They contain only two child nodes, 
 * one for empty ranges and another for non-empty ones. Such a node can appear 
 * as the root node, or in the tree under the 5th child of the root node (in 
 * which case it will only contain empty nodes). 
 * 
 * The SP-GiST picksplit function uses medians along both axes as the centroid. 
 * This implementation only uses the comparison function of the range element 
 * datatype, therefore it works for any range type. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * IDENTIFICATION 
 *          src/backend/utils/adt/rangetypes_spgist.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/spgist.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/stratnum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datum.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rangetypes.h"</span> 
 
<a name="LN45"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> <span class='Declare_Prototype'>getQuadrant</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>centroid</span><span class='Delimiter'>, 
</span><a name="LN46"></a>            <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tst</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN47"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>bound_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN49"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>adjacent_inner_consistent</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, 
</span><a name="LN50"></a>                          <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>centroid</span><span class='Delimiter'>, 
</span><a name="LN51"></a>                          <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>prev</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN52"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>adjacent_cmp_bounds</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, 
</span><a name="LN53"></a>                    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>centroid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * SP-GiST 'config' interface function. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN59"></a><span class='Declare_Function'>spg_range_quad_config</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* spgConfigIn *cfgin = (spgConfigIn *) PG_GETARG_POINTER(0); */ 
</span><a name="LN62"></a>    <a href="../../../include/access/spgist.h.html#LN42"><span class='Ref_to_Struct'>spgConfigOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>cfg</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN42"><span class='Ref_to_Struct'>spgConfigOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_spgist.c.html#LN62"><span class='Ref_To_Local'>cfg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN44"><span class='Ref_to_Member'>prefixType</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN713"><span class='Ref_to_Const'>ANYRANGEOID</span></a><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN62"><span class='Ref_To_Local'>cfg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN45"><span class='Ref_to_Member'>labelType</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN689"><span class='Ref_to_Const'>VOIDOID</span></a><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* we don't need node labels */ 
</span>    <a href="rangetypes_spgist.c.html#LN62"><span class='Ref_To_Local'>cfg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN46"><span class='Ref_to_Member'>canReturnData</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN62"><span class='Ref_To_Local'>cfg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN47"><span class='Ref_to_Member'>longValuesOK</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/*---------- 
 * Determine which quadrant a 2d-mapped range falls into, relative to the 
 * centroid. 
 * 
 * Quadrants are numbered like this: 
 * 
 *   4  |  1 
 *  ----+---- 
 *   3  |  2 
 * 
 * Where the lower bound of range is the horizontal axis and upper bound the 
 * vertical axis. 
 * 
 * Ranges on one of the axes are taken to lie in the quadrant with higher value 
 * along perpendicular axis. That is, a value on the horizontal axis is taken 
 * to belong to quadrant 1 or 4, and a value on the vertical axis is taken to 
 * belong to quadrant 1 or 2. A range equal to centroid is taken to lie in 
 * quadrant 1. 
 * 
 * Empty ranges are taken to lie in the special quadrant 5. 
 *---------- 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a> 
<a name="LN94"></a><span class='Declare_Function'>getQuadrant</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>centroid</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tst</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN96"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>centroidLower</span><span class='Delimiter'>, 
</span><a name="LN97"></a>                <span class='Declare_Local'>centroidUpper</span><span class='Delimiter'>; 
</span><a name="LN98"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>centroidEmpty</span><span class='Delimiter'>; 
</span><a name="LN99"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>lower</span><span class='Delimiter'>, 
</span><a name="LN100"></a>                <span class='Declare_Local'>upper</span><span class='Delimiter'>; 
</span><a name="LN101"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN94"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN94"><span class='Ref_to_Parameter'>centroid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN96"><span class='Ref_To_Local'>centroidLower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN97"><span class='Ref_To_Local'>centroidUpper</span></a><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN98"><span class='Ref_To_Local'>centroidEmpty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN94"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN94"><span class='Ref_to_Parameter'>tst</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN99"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN100"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN101"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN101"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>5</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN94"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN99"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN96"><span class='Ref_To_Local'>centroidLower</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN94"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN100"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN97"><span class='Ref_To_Local'>centroidUpper</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN94"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN100"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN97"><span class='Ref_To_Local'>centroidUpper</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Number'>4</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end getQuadrant &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Choose SP-GiST function: choose path for addition of new range. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN130"></a><span class='Declare_Function'>spg_range_quad_choose</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN132"></a>    <a href="../../../include/access/spgist.h.html#LN53"><span class='Ref_to_Struct'>spgChooseIn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN53"><span class='Ref_to_Struct'>spgChooseIn</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN133"></a>    <a href="../../../include/access/spgist.h.html#LN74"><span class='Ref_to_Struct'>spgChooseOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN74"><span class='Ref_to_Struct'>spgChooseOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN134"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>inRange</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN132"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN55"><span class='Ref_to_Member'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN135"></a>               <span class='Operator'>*</span><span class='Declare_Local'>centroid</span><span class='Delimiter'>; 
</span><a name="LN136"></a>    <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>quadrant</span><span class='Delimiter'>; 
</span><a name="LN137"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN132"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN60"><span class='Ref_to_Member'>allTheSame</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN76"><span class='Ref_to_Member'>resultType</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist.h.html#LN69"><span class='Ref_to_EnumConst'>spgMatchNode</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* nodeN will be set by core */ 
</span>        <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>levelAdd <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>restDatum <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN134"><span class='Ref_To_Local'>inRange</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="rangetypes_spgist.c.html#LN137"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN134"><span class='Ref_To_Local'>inRange</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * A node with no centroid divides ranges purely on whether they're empty 
     * or not. All empty ranges go to child node 0, all non-empty ranges go to 
     * node 1. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_spgist.c.html#LN132"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN61"><span class='Ref_to_Member'>hasPrefix</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN76"><span class='Ref_to_Member'>resultType</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist.h.html#LN69"><span class='Ref_to_EnumConst'>spgMatchNode</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN134"><span class='Ref_To_Local'>inRange</span></a><span class='Parentheses'>))</span> 
            <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>nodeN <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>nodeN <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>levelAdd <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>restDatum <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN134"><span class='Ref_To_Local'>inRange</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="rangetypes_spgist.c.html#LN135"><span class='Ref_To_Local'>centroid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN132"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN62"><span class='Ref_to_Member'>prefixDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN136"><span class='Ref_To_Local'>quadrant</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN45"><span class='Ref_to_Proto'>getQuadrant</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN137"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN135"><span class='Ref_To_Local'>centroid</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN134"><span class='Ref_To_Local'>inRange</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN136"><span class='Ref_To_Local'>quadrant</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_spgist.c.html#LN132"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN63"><span class='Ref_to_Member'>nNodes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Select node matching to quadrant number */ 
</span>    <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN76"><span class='Ref_to_Member'>resultType</span></a> <span class='Operator'>= </span><a href="../../../include/access/spgist.h.html#LN69"><span class='Ref_to_EnumConst'>spgMatchNode</span></a><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>nodeN <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN136"><span class='Ref_To_Local'>quadrant</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>levelAdd <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN133"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN104"><span class='Ref_to_Member'>result</span></a><span class='Operator'>.</span>matchNode<span class='Operator'>.</span>restDatum <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN134"><span class='Ref_To_Local'>inRange</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spg_range_quad_choose &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Bound comparison for sorting. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN185"></a><span class='Declare_Function'>bound_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN187"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ba</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_spgist.c.html#LN185"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>; 
</span><a name="LN188"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bb</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_spgist.c.html#LN185"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>; 
</span><a name="LN189"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_spgist.c.html#LN185"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN189"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN187"><span class='Ref_To_Local'>ba</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN188"><span class='Ref_To_Local'>bb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Picksplit SP-GiST function: split ranges into nodes. Select "centroid" 
 * range and distribute ranges according to quadrants. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN199"></a><span class='Declare_Function'>spg_range_quad_picksplit</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN201"></a>    <a href="../../../include/access/spgist.h.html#LN110"><span class='Ref_to_Struct'>spgPickSplitIn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN110"><span class='Ref_to_Struct'>spgPickSplitIn</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN202"></a>    <a href="../../../include/access/spgist.h.html#LN117"><span class='Ref_to_Struct'>spgPickSplitOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN117"><span class='Ref_to_Struct'>spgPickSplitOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN203"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN204"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN205"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nonEmptyCount</span><span class='Delimiter'>; 
</span><a name="LN206"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>centroid</span><span class='Delimiter'>; 
</span><a name="LN207"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span><a name="LN208"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use the median values of lower and upper bounds as the centroid range */ 
</span><a name="LN211"></a>    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>lowerBounds</span><span class='Delimiter'>, 
</span><a name="LN212"></a>               <span class='Operator'>*</span><span class='Declare_Local'>upperBounds</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_spgist.c.html#LN208"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, 
</span>                          <a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN113"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate memory for bounds */ 
</span>    <a href="rangetypes_spgist.c.html#LN211"><span class='Ref_To_Local'>lowerBounds</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN212"><span class='Ref_To_Local'>upperBounds</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN204"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deserialize bounds of ranges, count non-empty ranges */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN208"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN113"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN211"><span class='Ref_To_Local'>lowerBounds</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN204"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN212"><span class='Ref_To_Local'>upperBounds</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN204"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN207"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_spgist.c.html#LN207"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>            <a href="rangetypes_spgist.c.html#LN204"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="rangetypes_spgist.c.html#LN205"><span class='Ref_To_Local'>nonEmptyCount</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN204"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * All the ranges are empty. The best we can do is to construct an inner 
     * node with no centroid, and put all ranges into node 0. If non-empty 
     * ranges are added later, they will be routed to node 1. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN205"><span class='Ref_To_Local'>nonEmptyCount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN122"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN119"><span class='Ref_to_Member'>hasPrefix</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Prefix is empty */ 
</span>        <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN120"><span class='Ref_to_Member'>prefixDatum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN123"><span class='Ref_to_Member'>nodeLabels</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN125"><span class='Ref_to_Member'>mapTuplesToNodes</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN126"><span class='Ref_to_Member'>leafTupleDatums</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Place all ranges into node 0 */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN251"></a>            <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN113"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN126"><span class='Ref_to_Member'>leafTupleDatums</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN251"><span class='Ref_To_Local'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN125"><span class='Ref_to_Member'>mapTuplesToNodes</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nonEmptyCount==0 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Sort range bounds in order to find medians */ 
</span>    <a href="../../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN211"><span class='Ref_To_Local'>lowerBounds</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN205"><span class='Ref_To_Local'>nonEmptyCount</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="rangetypes_spgist.c.html#LN47"><span class='Ref_to_Proto'>bound_cmp</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN208"><span class='Ref_To_Local'>typcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../port/qsort_arg.c.html#LN111"><span class='Ref_to_Func'>qsort_arg</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN212"><span class='Ref_To_Local'>upperBounds</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN205"><span class='Ref_To_Local'>nonEmptyCount</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="rangetypes_spgist.c.html#LN47"><span class='Ref_to_Proto'>bound_cmp</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN208"><span class='Ref_To_Local'>typcache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Construct "centroid" range from medians of lower and upper bounds */ 
</span>    <a href="rangetypes_spgist.c.html#LN206"><span class='Ref_To_Local'>centroid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN121"><span class='Ref_to_Proto'>range_serialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN208"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN211"><span class='Ref_To_Local'>lowerBounds</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN205"><span class='Ref_To_Local'>nonEmptyCount</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                               <span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN212"><span class='Ref_To_Local'>upperBounds</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN205"><span class='Ref_To_Local'>nonEmptyCount</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>], </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN119"><span class='Ref_to_Member'>hasPrefix</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN120"><span class='Ref_to_Member'>prefixDatum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN206"><span class='Ref_To_Local'>centroid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create node for empty ranges only if it is a root node */ 
</span>    <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN122"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN114"><span class='Ref_to_Member'>level</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>5</span> <span class='Operator'>: </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN123"><span class='Ref_to_Member'>nodeLabels</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* we don't need node labels */ 
</span> 
    <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN125"><span class='Ref_to_Member'>mapTuplesToNodes</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN126"><span class='Ref_to_Member'>leafTupleDatums</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Assign ranges to corresponding nodes according to quadrants relative to 
     * "centroid" range. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN112"><span class='Ref_to_Member'>nTuples</span></a><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN284"></a>        <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN201"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN113"><span class='Ref_to_Member'>datums</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN285"></a>        <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>quadrant</span> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN45"><span class='Ref_to_Proto'>getQuadrant</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN208"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN206"><span class='Ref_To_Local'>centroid</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN284"><span class='Ref_To_Local'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN126"><span class='Ref_to_Member'>leafTupleDatums</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN72"><span class='Ref_to_Macro'>RangeTypeGetDatum</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN284"><span class='Ref_To_Local'>range</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_spgist.c.html#LN202"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN125"><span class='Ref_to_Member'>mapTuplesToNodes</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN203"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN285"><span class='Ref_To_Local'>quadrant</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spg_range_quad_picksplit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SP-GiST consistent function for inner nodes: check which nodes are 
 * consistent with given set of queries. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN299"></a><span class='Declare_Function'>spg_range_quad_inner_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN301"></a>    <a href="../../../include/access/spgist.h.html#LN132"><span class='Ref_to_Struct'>spgInnerConsistentIn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN132"><span class='Ref_to_Struct'>spgInnerConsistentIn</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN302"></a>    <a href="../../../include/access/spgist.h.html#LN152"><span class='Ref_to_Struct'>spgInnerConsistentOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN152"><span class='Ref_to_Struct'>spgInnerConsistentOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN303"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>which</span><span class='Delimiter'>; 
</span><a name="LN304"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN305"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldCtx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * For adjacent search we need also previous centroid (if any) to improve 
     * the precision of the consistent check. In this case needPrevious flag 
     * is set and centroid is passed into traversalValue. 
     */ 
</span><a name="LN312"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>needPrevious</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN145"><span class='Ref_to_Member'>allTheSame</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Report that all nodes should be visited */ 
</span>        <a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>; 
</span>        <a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN155"><span class='Ref_to_Member'>nodeNumbers</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN155"><span class='Ref_to_Member'>nodeNumbers</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN146"><span class='Ref_to_Member'>hasPrefix</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * No centroid on this inner node. Such a node has two child nodes, 
         * the first for empty ranges, and the second for non-empty ones. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Nth bit of which variable means that (N - 1)th node should be 
         * visited. Initially all bits are set. Bits of nodes which should be 
         * skipped will be unset. 
         */ 
</span>        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN135"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN340"></a>            <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN134"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Delimiter'>; 
</span><a name="LN341"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * The only strategy when second argument of operator is not range 
             * is RANGESTRAT_CONTAINS_ELEM. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN340"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/rangetypes.h.html#LN87"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS_ELEM</span></a><span class='Parentheses'>) 
</span>                <a href="rangetypes_spgist.c.html#LN341"><span class='Ref_To_Local'>empty</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN53"><span class='Ref_to_Macro'>RangeIsEmpty</span></a><span class='Parentheses'>(</span> 
                             <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN134"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="rangetypes_spgist.c.html#LN341"><span class='Ref_To_Local'>empty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN340"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN79"><span class='Ref_to_Const'>RANGESTRAT_BEFORE</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN80"><span class='Ref_to_Const'>RANGESTRAT_OVERLEFT</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN81"><span class='Ref_to_Const'>RANGESTRAT_OVERLAPS</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN82"><span class='Ref_to_Const'>RANGESTRAT_OVERRIGHT</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN83"><span class='Ref_to_Const'>RANGESTRAT_AFTER</span></a><span class='Operator'>: 
</span>                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN84"><span class='Ref_to_Const'>RANGESTRAT_ADJACENT</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* These strategies return false if any argument is empty */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN341"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>                        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN85"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * All ranges contain an empty range. Only non-empty 
                     * ranges can contain a non-empty range. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_spgist.c.html#LN341"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>                        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN86"><span class='Ref_to_Const'>RANGESTRAT_CONTAINED_BY</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Only an empty range is contained by an empty range. 
                     * Both empty and non-empty ranges can be contained by a 
                     * non-empty range. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN341"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>                        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN87"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS_ELEM</span></a><span class='Operator'>: 
</span>                    <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN88"><span class='Ref_to_Const'>RANGESTRAT_EQ</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN341"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>                        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized range strategy: %d"</span><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN340"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategy &raquo; </span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* no need to consider remaining conditions */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;in-&GT;nkeys;i++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !in-&GT;hasPrefix &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN410"></a>        <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>centroidLower</span><span class='Delimiter'>, 
</span><a name="LN411"></a>                    <span class='Declare_Local'>centroidUpper</span><span class='Delimiter'>; 
</span><a name="LN412"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>centroidEmpty</span><span class='Delimiter'>; 
</span><a name="LN413"></a>        <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span><a name="LN414"></a>        <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>centroid</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* This node has a centroid. Fetch it. */ 
</span>        <a href="rangetypes_spgist.c.html#LN414"><span class='Ref_To_Local'>centroid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN147"><span class='Ref_to_Member'>prefixDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN414"><span class='Ref_To_Local'>centroid</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN414"><span class='Ref_To_Local'>centroid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN410"><span class='Ref_To_Local'>centroidLower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN411"><span class='Ref_To_Local'>centroidUpper</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN412"><span class='Ref_To_Local'>centroidEmpty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>== </span><span class='Number'>4</span> <span class='Operator'>|| </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>== </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Nth bit of which variable means that (N - 1)th node (Nth quadrant) 
         * should be visited. Initially all bits are set. Bits of nodes which 
         * can be skipped will be unset. 
         */ 
</span>        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN135"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN434"></a>            <a href="../../../include/access/stratnum.h.html#LN21"><span class='Ref_to_Typedef'>StrategyNumber</span></a> <span class='Declare_Local'>strategy</span><span class='Delimiter'>; 
</span><a name="LN435"></a>            <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>lower</span><span class='Delimiter'>, 
</span><a name="LN436"></a>                        <span class='Declare_Local'>upper</span><span class='Delimiter'>; 
</span><a name="LN437"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>empty</span><span class='Delimiter'>; 
</span><a name="LN438"></a>            <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>range</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN440"></a>            <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>prevCentroid</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN441"></a>            <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a>  <span class='Declare_Local'>prevLower</span><span class='Delimiter'>, 
</span><a name="LN442"></a>                        <span class='Declare_Local'>prevUpper</span><span class='Delimiter'>; 
</span><a name="LN443"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>prevEmpty</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Restrictions on range bounds according to scan strategy */ 
</span><a name="LN446"></a>            <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Local'>minLower</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN447"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>maxLower</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN448"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>minUpper</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span><a name="LN449"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>maxUpper</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Are the restrictions on range bounds inclusive? */ 
</span><a name="LN452"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>inclusive</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN453"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>strictEmpty</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN454"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>, 
</span><a name="LN455"></a>                        <span class='Declare_Local'>which1</span><span class='Delimiter'>, 
</span><a name="LN456"></a>                        <span class='Declare_Local'>which2</span><span class='Delimiter'>; 
</span> 
            <a href="rangetypes_spgist.c.html#LN434"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN134"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * RANGESTRAT_CONTAINS_ELEM is just like RANGESTRAT_CONTAINS, but 
             * the argument is a single element. Expand the single element to 
             * a range containing only the element, and treat it like 
             * RANGESTRAT_CONTAINS. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN434"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>== </span><a href="../../../include/utils/rangetypes.h.html#LN87"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS_ELEM</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN63"><span class='Ref_to_Member'>inclusive</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN134"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Delimiter'>; 
</span> 
                <a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN63"><span class='Ref_to_Member'>inclusive</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN62"><span class='Ref_to_Member'>infinite</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Operator'>.</span><a href="../../../include/utils/rangetypes.h.html#LN61"><span class='Ref_to_Member'>val</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN134"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Delimiter'>; 
</span> 
                <a href="rangetypes_spgist.c.html#LN437"><span class='Ref_To_Local'>empty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
                <a href="rangetypes_spgist.c.html#LN434"><span class='Ref_To_Local'>strategy</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN85"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="rangetypes_spgist.c.html#LN438"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN134"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN438"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN437"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Most strategies are handled by forming a bounding box from the 
             * search key, defined by a minLower, maxLower, minUpper, 
             * maxUpper. Some modify 'which' directly, to specify exactly 
             * which quadrants need to be visited. 
             * 
             * For most strategies, nothing matches an empty search key, and 
             * an empty range never matches a non-empty key. If a strategy 
             * does not behave like that wrt. empty ranges, set strictEmpty to 
             * false. 
             */ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN434"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN79"><span class='Ref_to_Const'>RANGESTRAT_BEFORE</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Range A is before range B if upper bound of A is lower 
                     * than lower bound of B. 
                     */ 
</span>                    <a href="rangetypes_spgist.c.html#LN449"><span class='Ref_To_Local'>maxUpper</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>; 
</span>                    <a href="rangetypes_spgist.c.html#LN452"><span class='Ref_To_Local'>inclusive</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN80"><span class='Ref_to_Const'>RANGESTRAT_OVERLEFT</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Range A is overleft to range B if upper bound of A is 
                     * less or equal to upper bound of B. 
                     */ 
</span>                    <a href="rangetypes_spgist.c.html#LN449"><span class='Ref_To_Local'>maxUpper</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN81"><span class='Ref_to_Const'>RANGESTRAT_OVERLAPS</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Non-empty ranges overlap, if lower bound of each range 
                     * is lower or equal to upper bound of the other range. 
                     */ 
</span>                    <a href="rangetypes_spgist.c.html#LN447"><span class='Ref_To_Local'>maxLower</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>; 
</span>                    <a href="rangetypes_spgist.c.html#LN448"><span class='Ref_To_Local'>minUpper</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN82"><span class='Ref_to_Const'>RANGESTRAT_OVERRIGHT</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Range A is overright to range B if lower bound of A is 
                     * greater or equal to lower bound of B. 
                     */ 
</span>                    <a href="rangetypes_spgist.c.html#LN446"><span class='Ref_To_Local'>minLower</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN83"><span class='Ref_to_Const'>RANGESTRAT_AFTER</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Range A is after range B if lower bound of A is greater 
                     * than upper bound of B. 
                     */ 
</span>                    <a href="rangetypes_spgist.c.html#LN446"><span class='Ref_To_Local'>minLower</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>; 
</span>                    <a href="rangetypes_spgist.c.html#LN452"><span class='Ref_To_Local'>inclusive</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN84"><span class='Ref_to_Const'>RANGESTRAT_ADJACENT</span></a><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN437"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>break</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Skip to strictEmpty check. */ 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Previously selected quadrant could exclude possibility 
                     * for lower or upper bounds to be adjacent. Deserialize 
                     * previous centroid range if present for checking this. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN138"><span class='Ref_to_Member'>traversalValue</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="rangetypes_spgist.c.html#LN440"><span class='Ref_To_Local'>prevCentroid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN138"><span class='Ref_to_Member'>traversalValue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../../include/utils/rangetypes.h.html#LN123"><span class='Ref_to_Proto'>range_deserialize</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN440"><span class='Ref_To_Local'>prevCentroid</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN441"><span class='Ref_To_Local'>prevLower</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN442"><span class='Ref_To_Local'>prevUpper</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN443"><span class='Ref_To_Local'>prevEmpty</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * For a range's upper bound to be adjacent to the 
                     * argument's lower bound, it will be found along the line 
                     * adjacent to (and just below) Y=lower. Therefore, if the 
                     * argument's lower bound is less than the centroid's 
                     * upper bound, the line falls in quadrants 2 and 3; if 
                     * greater, the line falls in quadrants 1 and 4. (see 
                     * adjacent_cmp_bounds for description of edge cases). 
                     */ 
</span>                    <a href="rangetypes_spgist.c.html#LN454"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN49"><span class='Ref_to_Proto'>adjacent_inner_consistent</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN411"><span class='Ref_To_Local'>centroidUpper</span></a><span class='Delimiter'>, 
</span>                                           <a href="rangetypes_spgist.c.html#LN440"><span class='Ref_To_Local'>prevCentroid</span></a> <span class='Operator'>? &</span><a href="rangetypes_spgist.c.html#LN442"><span class='Ref_To_Local'>prevUpper</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN454"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="rangetypes_spgist.c.html#LN455"><span class='Ref_To_Local'>which1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN454"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="rangetypes_spgist.c.html#LN455"><span class='Ref_To_Local'>which1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="rangetypes_spgist.c.html#LN455"><span class='Ref_To_Local'>which1</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Also search for ranges's adjacent to argument's upper 
                     * bound. They will be found along the line adjacent to 
                     * (and just right of) X=upper, which falls in quadrants 3 
                     * and 4, or 1 and 2. 
                     */ 
</span>                    <a href="rangetypes_spgist.c.html#LN454"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN49"><span class='Ref_to_Proto'>adjacent_inner_consistent</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN410"><span class='Ref_To_Local'>centroidLower</span></a><span class='Delimiter'>, 
</span>                                           <a href="rangetypes_spgist.c.html#LN440"><span class='Ref_To_Local'>prevCentroid</span></a> <span class='Operator'>? &</span><a href="rangetypes_spgist.c.html#LN441"><span class='Ref_To_Local'>prevLower</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN454"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="rangetypes_spgist.c.html#LN456"><span class='Ref_To_Local'>which2</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN454"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="rangetypes_spgist.c.html#LN456"><span class='Ref_To_Local'>which2</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="rangetypes_spgist.c.html#LN456"><span class='Ref_To_Local'>which2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* We must chase down ranges adjacent to either bound. */ 
</span>                    <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><a href="rangetypes_spgist.c.html#LN455"><span class='Ref_To_Local'>which1</span></a> <span class='Operator'>| </span><a href="rangetypes_spgist.c.html#LN456"><span class='Ref_To_Local'>which2</span></a><span class='Delimiter'>; 
</span> 
                    <a href="rangetypes_spgist.c.html#LN312"><span class='Ref_To_Local'>needPrevious</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN85"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Non-empty range A contains non-empty range B if lower 
                     * bound of A is lower or equal to lower bound of range B 
                     * and upper bound of range A is greater or equal to upper 
                     * bound of range A. 
                     * 
                     * All non-empty ranges contain an empty range. 
                     */ 
</span>                    <a href="rangetypes_spgist.c.html#LN453"><span class='Ref_To_Local'>strictEmpty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_spgist.c.html#LN437"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="rangetypes_spgist.c.html#LN447"><span class='Ref_To_Local'>maxLower</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>; 
</span>                        <a href="rangetypes_spgist.c.html#LN448"><span class='Ref_To_Local'>minUpper</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN86"><span class='Ref_to_Const'>RANGESTRAT_CONTAINED_BY</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* The opposite of contains. */ 
</span>                    <a href="rangetypes_spgist.c.html#LN453"><span class='Ref_To_Local'>strictEmpty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN437"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Comment_Multi_Line'>/* An empty range is only contained by an empty range */ 
</span>                        <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="rangetypes_spgist.c.html#LN446"><span class='Ref_To_Local'>minLower</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN435"><span class='Ref_To_Local'>lower</span></a><span class='Delimiter'>; 
</span>                        <a href="rangetypes_spgist.c.html#LN449"><span class='Ref_To_Local'>maxUpper</span></a> <span class='Operator'>= &</span><a href="rangetypes_spgist.c.html#LN436"><span class='Ref_To_Local'>upper</span></a><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN88"><span class='Ref_to_Const'>RANGESTRAT_EQ</span></a><span class='Operator'>: 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * Equal range can be only in the same quadrant where 
                     * argument would be placed to. 
                     */ 
</span>                    <a href="rangetypes_spgist.c.html#LN453"><span class='Ref_To_Local'>strictEmpty</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="rangetypes_spgist.c.html#LN45"><span class='Ref_to_Proto'>getQuadrant</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN414"><span class='Ref_To_Local'>centroid</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN438"><span class='Ref_To_Local'>range</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized range strategy: %d"</span><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN434"><span class='Ref_To_Local'>strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch strategy &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN453"><span class='Ref_To_Local'>strictEmpty</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN437"><span class='Ref_To_Local'>empty</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Scan key is empty, no branches are satisfying */ 
</span>                    <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Shouldn't visit tree branch with empty ranges */ 
</span>                    <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Using the bounding box, see which quadrants we have to descend 
             * into. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN446"><span class='Ref_To_Local'>minLower</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If the centroid's lower bound is less than or equal to the 
                 * minimum lower bound, anything in the 3rd and 4th quadrants 
                 * will have an even smaller lower bound, and thus can't 
                 * match. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN410"><span class='Ref_To_Local'>centroidLower</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN446"><span class='Ref_To_Local'>minLower</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN447"><span class='Ref_To_Local'>maxLower</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If the centroid's lower bound is greater than the maximum 
                 * lower bound, anything in the 1st and 2nd quadrants will 
                 * also have a greater than or equal lower bound, and thus 
                 * can't match. If the centroid's lower bound is equal to the 
                 * maximum lower bound, we can still exclude the 1st and 2nd 
                 * quadrants if we're looking for a value strictly greater 
                 * than the maximum. 
                 */ 
</span><a name="LN696"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
                <a href="rangetypes_spgist.c.html#LN696"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN410"><span class='Ref_To_Local'>centroidLower</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN447"><span class='Ref_To_Local'>maxLower</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN696"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_spgist.c.html#LN452"><span class='Ref_To_Local'>inclusive</span></a> <span class='Operator'>&& </span><a href="rangetypes_spgist.c.html#LN696"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                    <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN448"><span class='Ref_To_Local'>minUpper</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If the centroid's upper bound is less than or equal to the 
                 * minimum upper bound, anything in the 2nd and 3rd quadrants 
                 * will have an even smaller upper bound, and thus can't 
                 * match. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN411"><span class='Ref_To_Local'>centroidUpper</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN448"><span class='Ref_To_Local'>minUpper</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>4</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN449"><span class='Ref_To_Local'>maxUpper</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * If the centroid's upper bound is greater than the maximum 
                 * upper bound, anything in the 1st and 4th quadrants will 
                 * also have a greater than or equal upper bound, and thus 
                 * can't match. If the centroid's upper bound is equal to the 
                 * maximum upper bound, we can still exclude the 1st and 4th 
                 * quadrants if we're looking for a value strictly greater 
                 * than the maximum. 
                 */ 
</span><a name="LN724"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
                <a href="rangetypes_spgist.c.html#LN724"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN413"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="rangetypes_spgist.c.html#LN411"><span class='Ref_To_Local'>centroidUpper</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN449"><span class='Ref_To_Local'>maxUpper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN724"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_spgist.c.html#LN452"><span class='Ref_To_Local'>inclusive</span></a> <span class='Operator'>&& </span><a href="rangetypes_spgist.c.html#LN724"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                    <a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>&= </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* no need to consider remaining conditions */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;in-&GT;nkeys;i++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* We must descend into the quadrant(s) identified by 'which' */ 
</span>    <a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN155"><span class='Ref_to_Member'>nodeNumbers</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN312"><span class='Ref_To_Local'>needPrevious</span></a><span class='Parentheses'>) 
</span>        <a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN158"><span class='Ref_to_Member'>traversalValues</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>**</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Elements of traversalValues should be allocated in 
     * traversalMemoryContext 
     */ 
</span>    <a href="rangetypes_spgist.c.html#LN305"><span class='Ref_To_Local'>oldCtx</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN139"><span class='Ref_to_Member'>traversalMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN148"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN303"><span class='Ref_To_Local'>which</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Save previous prefix if needed */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN312"><span class='Ref_To_Local'>needPrevious</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN755"></a>                <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>previousCentroid</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * We know, that in-&GT;prefixDatum in this place is varlena, 
                 * because it's range 
                 */ 
</span>                <a href="rangetypes_spgist.c.html#LN755"><span class='Ref_To_Local'>previousCentroid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datum.h.html#LN30"><span class='Ref_to_Proto'>datumCopy</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN301"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN147"><span class='Ref_to_Member'>prefixDatum</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN158"><span class='Ref_to_Member'>traversalValues</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="rangetypes_spgist.c.html#LN755"><span class='Ref_To_Local'>previousCentroid</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN155"><span class='Ref_to_Member'>nodeNumbers</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN304"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="rangetypes_spgist.c.html#LN302"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN154"><span class='Ref_to_Member'>nNodes</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=in-&GT;nNodes;i++ &raquo; </span> 
 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN305"><span class='Ref_To_Local'>oldCtx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spg_range_quad_inner_consistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * adjacent_cmp_bounds 
 * 
 * Given an argument and centroid bound, this function determines if any 
 * bounds that are adjacent to the argument are smaller than, or greater than 
 * or equal to centroid. For brevity, we call the arg &LT; centroid "left", and 
 * arg &GT;= centroid case "right". This corresponds to how the quadrants are 
 * arranged, if you imagine that "left" is equivalent to "down" and "right" 
 * is equivalent to "up". 
 * 
 * For the "left" case, returns -1, and for the "right" case, returns 1. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN787"></a><span class='Declare_Function'>adjacent_cmp_bounds</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, 
</span><a name="LN788"></a>                    <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>centroid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN790"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN787"><span class='Ref_to_Parameter'>arg</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a> <span class='Operator'>!= </span><a href="rangetypes_spgist.c.html#LN788"><span class='Ref_to_Parameter'>centroid</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_spgist.c.html#LN790"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN787"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN787"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN788"><span class='Ref_to_Parameter'>centroid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN788"><span class='Ref_to_Parameter'>centroid</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rangetypes.h.html#LN64"><span class='Ref_to_Member'>lower</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/*------ 
         * The argument is an upper bound, we are searching for adjacent lower 
         * bounds. A matching adjacent lower bound must be *larger* than the 
         * argument, but only just. 
         * 
         * The following table illustrates the desired result with a fixed 
         * argument bound, and different centroids. The CMP column shows 
         * the value of 'cmp' variable, and ADJ shows whether the argument 
         * and centroid are adjacent, per bounds_adjacent(). (N) means we 
         * don't need to check for that case, because it's implied by CMP. 
         * With the argument range [..., 500), the adjacent range we're 
         * searching for is [500, ...): 
         * 
         *  ARGUMENT   CENTROID     CMP   ADJ 
         *  [..., 500) [498, ...)    &GT;    (N)   [500, ...) is to the right 
         *  [..., 500) [499, ...)    =    (N)   [500, ...) is to the right 
         *  [..., 500) [500, ...)    &LT;     Y    [500, ...) is to the right 
         *  [..., 500) [501, ...)    &LT;     N    [500, ...) is to the left 
         * 
         * So, we must search left when the argument is smaller than, and not 
         * adjacent, to the centroid. Otherwise search right. 
         *------ 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN790"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="../../../include/utils/rangetypes.h.html#LN134"><span class='Ref_to_Proto'>bounds_adjacent</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN787"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="rangetypes_spgist.c.html#LN787"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="rangetypes_spgist.c.html#LN788"><span class='Ref_to_Parameter'>centroid</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if centroid-&GT;lower &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/*------ 
         * The argument is a lower bound, we are searching for adjacent upper 
         * bounds. A matching adjacent upper bound must be *smaller* than the 
         * argument, but only just. 
         * 
         *  ARGUMENT   CENTROID     CMP   ADJ 
         *  [500, ...) [..., 499)    &GT;    (N)   [..., 500) is to the right 
         *  [500, ...) [..., 500)    &GT;    (Y)   [..., 500) is to the right 
         *  [500, ...) [..., 501)    =    (N)   [..., 500) is to the left 
         *  [500, ...) [..., 502)    &LT;    (N)   [..., 500) is to the left 
         * 
         * We must search left when the argument is smaller than or equal to 
         * the centroid. Otherwise search right. We don't need to check 
         * whether the argument is adjacent with the centroid, because it 
         * doesn't matter. 
         *------ 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN790"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end adjacent_cmp_bounds &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*---------- 
 * adjacent_inner_consistent 
 * 
 * Like adjacent_cmp_bounds, but also takes into account the previous 
 * level's centroid. We might've traversed left (or right) at the previous 
 * node, in search for ranges adjacent to the other bound, even though we 
 * already ruled out the possibility for any matches in that direction for 
 * this bound. By comparing the argument with the previous centroid, and 
 * the previous centroid with the current centroid, we can determine which 
 * direction we should've moved in at previous level, and which direction we 
 * actually moved. 
 * 
 * If there can be any matches to the left, returns -1. If to the right, 
 * returns 1. If there can be no matches below this centroid, because we 
 * already ruled them out at the previous level, returns 0. 
 * 
 * XXX: Comparing just the previous and current level isn't foolproof; we 
 * might still search some branches unnecessarily. For example, imagine that 
 * we are searching for value 15, and we traverse the following centroids 
 * (only considering one bound for the moment): 
 * 
 * Level 1: 20 
 * Level 2: 50 
 * Level 3: 25 
 * 
 * At this point, previous centroid is 50, current centroid is 25, and the 
 * target value is to the left. But because we already moved right from 
 * centroid 20 to 50 in the first level, there cannot be any values &LT; 20 in 
 * the current branch. But we don't know that just by looking at the previous 
 * and current centroid, so we traverse left, unnecessarily. The reason we are 
 * down this branch is that we're searching for matches with the *other* 
 * bound. If we kept track of which bound we are searching for explicitly, 
 * instead of deducing that from the previous and current centroid, we could 
 * avoid some unnecessary work. 
 *---------- 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN889"></a><span class='Declare_Function'>adjacent_inner_consistent</span><span class='Parentheses'>(</span><a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typcache</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, 
</span><a name="LN890"></a>                          <a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>centroid</span><span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN59"><span class='Ref_to_Typedef'>RangeBound</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>prev</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN890"><span class='Ref_to_Parameter'>prev</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN894"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>prevcmp</span><span class='Delimiter'>; 
</span><a name="LN895"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Which direction were we supposed to traverse at previous level, 
         * left or right? 
         */ 
</span>        <a href="rangetypes_spgist.c.html#LN894"><span class='Ref_To_Local'>prevcmp</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN52"><span class='Ref_to_Proto'>adjacent_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN889"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN889"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN890"><span class='Ref_to_Parameter'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* and which direction did we actually go? */ 
</span>        <a href="rangetypes_spgist.c.html#LN895"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN130"><span class='Ref_to_Proto'>range_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN889"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN890"><span class='Ref_to_Parameter'>centroid</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN890"><span class='Ref_to_Parameter'>prev</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* if the two don't agree, there's nothing to see here */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="rangetypes_spgist.c.html#LN894"><span class='Ref_To_Local'>prevcmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="rangetypes_spgist.c.html#LN895"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN894"><span class='Ref_To_Local'>prevcmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="rangetypes_spgist.c.html#LN895"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="rangetypes_spgist.c.html#LN52"><span class='Ref_to_Proto'>adjacent_cmp_bounds</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN889"><span class='Ref_to_Parameter'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN889"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN890"><span class='Ref_to_Parameter'>centroid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end adjacent_inner_consistent &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SP-GiST consistent function for leaf nodes: check leaf value against query 
 * using corresponding function. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN919"></a><span class='Declare_Function'>spg_range_quad_leaf_consistent</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN921"></a>    <a href="../../../include/access/spgist.h.html#LN164"><span class='Ref_to_Struct'>spgLeafConsistentIn</span></a> <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN164"><span class='Ref_to_Struct'>spgLeafConsistentIn</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN922"></a>    <a href="../../../include/access/spgist.h.html#LN177"><span class='Ref_to_Struct'>spgLeafConsistentOut</span></a> <span class='Operator'>*</span><span class='Declare_Local'>out</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/spgist.h.html#LN177"><span class='Ref_to_Struct'>spgLeafConsistentOut</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN923"></a>    <a href="../../../include/utils/rangetypes.h.html#LN24"><span class='Ref_to_Typedef'>RangeType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>leafRange</span> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN921"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN174"><span class='Ref_to_Member'>leafDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN924"></a>    <a href="../../../include/utils/typcache.h.html#LN28"><span class='Ref_to_Struct'>TypeCacheEntry</span></a> <span class='Operator'>*</span><span class='Declare_Local'>typcache</span><span class='Delimiter'>; 
</span><a name="LN925"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN926"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* all tests are exact */ 
</span>    <a href="rangetypes_spgist.c.html#LN922"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN180"><span class='Ref_to_Member'>recheck</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* leafDatum is what it is... */ 
</span>    <a href="rangetypes_spgist.c.html#LN922"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN179"><span class='Ref_to_Member'>leafValue</span></a> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN921"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN174"><span class='Ref_to_Member'>leafDatum</span></a><span class='Delimiter'>; 
</span> 
    <a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN119"><span class='Ref_to_Proto'>range_get_typcache</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="../../../include/utils/rangetypes.h.html#LN32"><span class='Ref_to_Macro'>RangeTypeGetOid</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Perform the required comparison(s) */ 
</span>    <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN926"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN926"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="rangetypes_spgist.c.html#LN921"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN167"><span class='Ref_to_Member'>nkeys</span></a><span class='Delimiter'>; </span><a href="rangetypes_spgist.c.html#LN926"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN940"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>keyDatum</span> <span class='Operator'>= </span><a href="rangetypes_spgist.c.html#LN921"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN166"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN926"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Call the function corresponding to the scan strategy */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN921"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN166"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN926"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN79"><span class='Ref_to_Const'>RANGESTRAT_BEFORE</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN105"><span class='Ref_to_Proto'>range_before_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN80"><span class='Ref_to_Const'>RANGESTRAT_OVERLEFT</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN113"><span class='Ref_to_Proto'>range_overleft_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN81"><span class='Ref_to_Const'>RANGESTRAT_OVERLAPS</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN111"><span class='Ref_to_Proto'>range_overlaps_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN82"><span class='Ref_to_Const'>RANGESTRAT_OVERRIGHT</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN115"><span class='Ref_to_Proto'>range_overright_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                               <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN83"><span class='Ref_to_Const'>RANGESTRAT_AFTER</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN107"><span class='Ref_to_Proto'>range_after_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN84"><span class='Ref_to_Const'>RANGESTRAT_ADJACENT</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN109"><span class='Ref_to_Proto'>range_adjacent_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN85"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN101"><span class='Ref_to_Proto'>range_contains_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN86"><span class='Ref_to_Const'>RANGESTRAT_CONTAINED_BY</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN103"><span class='Ref_to_Proto'>range_contained_by_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                                <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN87"><span class='Ref_to_Const'>RANGESTRAT_CONTAINS_ELEM</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN94"><span class='Ref_to_Proto'>range_contains_elem_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                                   <a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../include/utils/rangetypes.h.html#LN88"><span class='Ref_to_Const'>RANGESTRAT_EQ</span></a><span class='Operator'>: 
</span>                <a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rangetypes.h.html#LN97"><span class='Ref_to_Proto'>range_eq_internal</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN924"><span class='Ref_To_Local'>typcache</span></a><span class='Delimiter'>, </span><a href="rangetypes_spgist.c.html#LN923"><span class='Ref_To_Local'>leafRange</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/utils/rangetypes.h.html#LN70"><span class='Ref_to_Macro'>DatumGetRangeType</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN940"><span class='Ref_To_Local'>keyDatum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized range strategy: %d"</span><span class='Delimiter'>, 
</span>                     <a href="rangetypes_spgist.c.html#LN921"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/spgist.h.html#LN166"><span class='Ref_to_Member'>scankeys</span></a><span class='Delimiter'>[</span><a href="rangetypes_spgist.c.html#LN926"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch in-&GT;scankeys[i].sk_st... &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * If leaf datum doesn't match to a query key, no need to check 
         * subsequent keys. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;in-&GT;nkeys;i++ &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="rangetypes_spgist.c.html#LN925"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end spg_range_quad_leaf_consistent &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>