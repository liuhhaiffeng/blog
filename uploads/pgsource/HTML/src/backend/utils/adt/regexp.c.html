<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\regexp.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\regexp.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:53 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * regexp.c 
 *    Postgres' interface to the regular expression package. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/regexp.c 
 * 
 *      Alistair Crooks added the code for the regex caching 
 *      agc - cached the regular expressions used - there's a good chance 
 *      that we'll get a hit, so this saves a compile step for every 
 *      attempted match. I haven't actually measured the speed improvement, 
 *      but it `looks' a lot quicker visually when watching regression 
 *      test output. 
 * 
 *      agc - incorporated Keith Bostic's Berkeley regex code into 
 *      the tree for all ports. To distinguish this regex code from any that 
 *      is existent on a platform, I've prepended the string "pg_" to 
 *      the functions regcomp, regerror, regexec and regfree. 
 *      Fixed a bug that was originally a typo by me, where `i' was used 
 *      instead of `oldest' when compiling regular expressions - benign 
 *      results mostly, although occasionally it bit you... 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"regex/regex.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
 
<a name="LN39"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_GETARG_TEXT_PP_IF_EXISTS</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>_n</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="regexp.c.html#LN39"><span class='Ref_to_Parameter'>_n</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN39"><span class='Ref_to_Parameter'>_n</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
 
 
<span class='Comment_Multi_Line'>/* all the options of interest for regex functions */ 
</span><a name="LN44"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>pg_re_flags</span> 
<span class='Delimiter'>{ 
</span><a name="LN46"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>cflags</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* compile flags for Spencer's regex code */ 
</span><a name="LN47"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>glob</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* do it globally (for each occurrence) */ 
</span><a name="LN48"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>pg_re_flags</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* cross-call state for regexp_match and regexp_split functions */ 
</span><a name="LN51"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>regexp_matches_ctx</span> 
<span class='Delimiter'>{ 
</span><a name="LN53"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Member'>orig_str</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* data string in original TEXT form */ 
</span><a name="LN54"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>nmatches</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* number of places where pattern matched */ 
</span><a name="LN55"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>npatterns</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* number of capturing subpatterns */ 
</span>    <span class='Comment_Multi_Line'>/* We store start char index and end+1 char index for each match */ 
</span>    <span class='Comment_Multi_Line'>/* so the number of entries in match_locs is nmatches * npatterns * 2 */ 
</span><a name="LN58"></a>    <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Member'>match_locs</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* 0-based character indexes */ 
</span><a name="LN59"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>next_match</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* 0-based index of next match to process */ 
</span>    <span class='Comment_Multi_Line'>/* workspace for build_regexp_match_result() */ 
</span><a name="LN61"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Member'>elems</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* has npatterns elements */ 
</span><a name="LN62"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Member'>nulls</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* has npatterns elements */ 
</span><a name="LN63"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>regexp_matches_ctx</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * We cache precompiled regular expressions using a "self organizing list" 
 * structure, in which recently-used items tend to be near the front. 
 * Whenever we use an entry, it's moved up to the front of the list. 
 * Over time, an item's average position corresponds to its frequency of use. 
 * 
 * When we first create an entry, it's inserted at the front of 
 * the array, dropping the entry at the end of the array if necessary to 
 * make room.  (This might seem to be weighting the new entry too heavily, 
 * but if we insert new entries further back, we'll be unable to adjust to 
 * a sudden shift in the query mix where we are presented with MAX_CACHED_RES 
 * never-before-seen items used circularly.  We ought to be able to handle 
 * that case, so we have to insert at the front.) 
 * 
 * Knuth mentions a variant strategy in which a used item is moved up just 
 * one place in the list.  Although he says this uses fewer comparisons on 
 * average, it seems not to adapt very well to the situation where you have 
 * both some reusable patterns and a steady stream of non-reusable patterns. 
 * A reusable pattern that isn't used at least as often as non-reusable 
 * patterns are seen will "fail to keep up" and will drop off the end of the 
 * cache.  With move-to-front, a reusable pattern is guaranteed to stay in 
 * the cache as long as it's used at least once in every MAX_CACHED_RES uses. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* this is the maximum number of cached regular expressions */ 
</span><span class='Directive'>#ifndef</span> <a href="regexp.c.html#LN91"><span class='Ref_to_Const'>MAX_CACHED_RES</span></a> 
<a name="LN91"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MAX_CACHED_RES</span>  <span class='Number'>32</span> 
<span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* this structure describes one cached regular expression */ 
</span><a name="LN95"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>cached_re_str</span> 
<span class='Delimiter'>{ 
</span><a name="LN97"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>cre_pat</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* original RE (not null terminated!) */ 
</span><a name="LN98"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>cre_pat_len</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* length of original RE, in bytes */ 
</span><a name="LN99"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>cre_flags</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* compile flags: extended,icase etc */ 
</span><a name="LN100"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Member'>cre_collation</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* collation to use */ 
</span><a name="LN101"></a>    <a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a>     <span class='Declare_Member'>cre_re</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* the compiled regular expression */ 
</span><a name="LN102"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>cached_re_str</span><span class='Delimiter'>; 
</span> 
<a name="LN104"></a><span class='Keyword'>static int</span>  <span class='Declare_Var'>num_res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* # of cached re's */ 
</span><a name="LN105"></a><span class='Keyword'>static </span><a href="regexp.c.html#LN95"><span class='Ref_to_Struct'>cached_re_str</span></a> <span class='Declare_Var'>re_array</span><span class='Delimiter'>[</span><a href="regexp.c.html#LN91"><span class='Ref_to_Const'>MAX_CACHED_RES</span></a><span class='Delimiter'>];</span>  <span class='Comment_Single_Line'>/* cached re's */ 
</span> 
 
<span class='Comment_Multi_Line'>/* Local functions */ 
</span><a name="LN109"></a><span class='Keyword'>static </span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>setup_regexp_matches</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>orig_str</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pattern</span><span class='Delimiter'>, 
</span><a name="LN110"></a>                     <a href="regexp.c.html#LN44"><span class='Ref_to_Struct'>pg_re_flags</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>flags</span><span class='Delimiter'>, 
</span><a name="LN111"></a>                     <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN112"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_subpatterns</span><span class='Delimiter'>, 
</span><a name="LN113"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>ignore_degenerate</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN114"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>cleanup_regexp_matches</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>matchctx</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN115"></a><span class='Keyword'>static </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>build_regexp_match_result</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>matchctx</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN116"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>build_regexp_split_result</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>splitctx</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * RE_compile_and_cache - compile a RE, caching if possible 
 * 
 * Returns regex_t * 
 * 
 *  text_re --- the pattern, expressed as a TEXT object 
 *  cflags --- compile options for the pattern 
 *  collation --- collation to use for LC_CTYPE-dependent behavior 
 * 
 * Pattern is given in the database encoding.  We internally convert to 
 * an array of pg_wchar, which is what Spencer's regex package wants. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a> <span class='Operator'>* 
</span><a name="LN132"></a><span class='Declare_Function'>RE_compile_and_cache</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>text_re</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>cflags</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN134"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>text_re_len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN132"><span class='Ref_to_Parameter'>text_re</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN135"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>text_re_val</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN132"><span class='Ref_to_Parameter'>text_re</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN136"></a>    <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>pattern</span><span class='Delimiter'>; 
</span><a name="LN137"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pattern_len</span><span class='Delimiter'>; 
</span><a name="LN138"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN139"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>regcomp_result</span><span class='Delimiter'>; 
</span><a name="LN140"></a>    <a href="regexp.c.html#LN95"><span class='Ref_to_Struct'>cached_re_str</span></a> <span class='Declare_Local'>re_temp</span><span class='Delimiter'>; 
</span><a name="LN141"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>errMsg</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look for a match among previously compiled REs.  Since the data 
     * structure is self-organizing with most-used entries at the front, our 
     * search strategy can just be to scan from the front. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regexp.c.html#LN104"><span class='Ref_to_Global_Var'>num_res</span></a><span class='Delimiter'>; </span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="regexp.c.html#LN98"><span class='Ref_to_Member'>cre_pat_len</span></a> <span class='Operator'>== </span><a href="regexp.c.html#LN134"><span class='Ref_To_Local'>text_re_len</span></a> <span class='Operator'>&& 
</span>            <a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="regexp.c.html#LN99"><span class='Ref_to_Member'>cre_flags</span></a> <span class='Operator'>== </span><a href="regexp.c.html#LN132"><span class='Ref_to_Parameter'>cflags</span></a> <span class='Operator'>&& 
</span>            <a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="regexp.c.html#LN100"><span class='Ref_to_Member'>cre_collation</span></a> <span class='Operator'>== </span><a href="regexp.c.html#LN132"><span class='Ref_to_Parameter'>collation</span></a> <span class='Operator'>&& 
</span>            memcmp<span class='Parentheses'>(</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="regexp.c.html#LN97"><span class='Ref_to_Member'>cre_pat</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN135"><span class='Ref_To_Local'>text_re_val</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN134"><span class='Ref_To_Local'>text_re_len</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Found a match; move it to front if not there already. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="regexp.c.html#LN138"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN95"><span class='Ref_to_Struct'>cached_re_str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>return</span> <span class='Operator'>&</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="regexp.c.html#LN101"><span class='Ref_to_Member'>cre_re</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;num_res;i++ &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Couldn't find it, so try to compile the new RE.  To avoid leaking 
     * resources on failure, we build into the re_temp local. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* Convert pattern string to wide characters */ 
</span>    <a href="regexp.c.html#LN136"><span class='Ref_To_Local'>pattern</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="regexp.c.html#LN134"><span class='Ref_To_Local'>text_re_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN137"><span class='Ref_To_Local'>pattern_len</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN510"><span class='Ref_to_Proto'>pg_mb2wchar_with_len</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN135"><span class='Ref_To_Local'>text_re_val</span></a><span class='Delimiter'>, 
</span>                                       <a href="regexp.c.html#LN136"><span class='Ref_To_Local'>pattern</span></a><span class='Delimiter'>, 
</span>                                       <a href="regexp.c.html#LN134"><span class='Ref_To_Local'>text_re_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="regexp.c.html#LN139"><span class='Ref_To_Local'>regcomp_result</span></a> <span class='Operator'>= </span><a href="../../../include/regex/regex.h.html#LN169"><span class='Ref_to_Proto'>pg_regcomp</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN101"><span class='Ref_to_Member'>cre_re</span></a><span class='Delimiter'>, 
</span>                                <a href="regexp.c.html#LN136"><span class='Ref_To_Local'>pattern</span></a><span class='Delimiter'>, 
</span>                                <a href="regexp.c.html#LN137"><span class='Ref_To_Local'>pattern_len</span></a><span class='Delimiter'>, 
</span>                                <a href="regexp.c.html#LN132"><span class='Ref_to_Parameter'>cflags</span></a><span class='Delimiter'>, 
</span>                                <a href="regexp.c.html#LN132"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN136"><span class='Ref_To_Local'>pattern</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN139"><span class='Ref_To_Local'>regcomp_result</span></a> <span class='Operator'>!= </span><a href="../../../include/regex/regex.h.html#LN136"><span class='Ref_to_Const'>REG_OKAY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* re didn't compile (no need for pg_regfree, if so) */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Here and in other places in this file, do CHECK_FOR_INTERRUPTS 
         * before reporting a regex error.  This is so that if the regex 
         * library aborts and returns REG_CANCEL, we don't print an error 
         * message that implies the regex was invalid. 
         */ 
</span>        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="../../regex/regerror.c.html#LN58"><span class='Ref_to_Func'>pg_regerror</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN139"><span class='Ref_To_Local'>regcomp_result</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN101"><span class='Ref_to_Member'>cre_re</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN141"><span class='Ref_To_Local'>errMsg</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN141"><span class='Ref_To_Local'>errMsg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_REGULAR_EXPRESSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid regular expression: %s"</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN141"><span class='Ref_To_Local'>errMsg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We use malloc/free for the cre_pat field because the storage has to 
     * persist across transactions, and because we want to get control back on 
     * out-of-memory.  The Max() is because some malloc implementations return 
     * NULL for malloc(0). 
     */ 
</span>    <a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN97"><span class='Ref_to_Member'>cre_pat</span></a> <span class='Operator'>= </span><a href="../../../include/snowball/header.h.html#LN49"><span class='Ref_to_Macro'>malloc</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN134"><span class='Ref_To_Local'>text_re_len</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN97"><span class='Ref_to_Member'>cre_pat</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../regex/regfree.c.html#LN47"><span class='Ref_to_Func'>pg_regfree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN101"><span class='Ref_to_Member'>cre_re</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    memcpy<span class='Parentheses'>(</span><a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN97"><span class='Ref_to_Member'>cre_pat</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN135"><span class='Ref_To_Local'>text_re_val</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN134"><span class='Ref_To_Local'>text_re_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN98"><span class='Ref_to_Member'>cre_pat_len</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN134"><span class='Ref_To_Local'>text_re_len</span></a><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN99"><span class='Ref_to_Member'>cre_flags</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN132"><span class='Ref_to_Parameter'>cflags</span></a><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN100"><span class='Ref_to_Member'>cre_collation</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN132"><span class='Ref_to_Parameter'>collation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Okay, we have a valid new item in re_temp; insert it into the storage 
     * array.  Discard last entry if needed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN104"><span class='Ref_to_Global_Var'>num_res</span></a> <span class='Operator'>&GT;= </span><a href="regexp.c.html#LN91"><span class='Ref_to_Const'>MAX_CACHED_RES</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>--</span><a href="regexp.c.html#LN104"><span class='Ref_to_Global_Var'>num_res</span></a><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN104"><span class='Ref_to_Global_Var'>num_res</span></a> <span class='Operator'>&LT; </span><a href="regexp.c.html#LN91"><span class='Ref_to_Const'>MAX_CACHED_RES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../regex/regfree.c.html#LN47"><span class='Ref_to_Func'>pg_regfree</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN104"><span class='Ref_to_Global_Var'>num_res</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="regexp.c.html#LN101"><span class='Ref_to_Member'>cre_re</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN104"><span class='Ref_to_Global_Var'>num_res</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="regexp.c.html#LN97"><span class='Ref_to_Member'>cre_pat</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN104"><span class='Ref_to_Global_Var'>num_res</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="regexp.c.html#LN104"><span class='Ref_to_Global_Var'>num_res</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN95"><span class='Ref_to_Struct'>cached_re_str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regexp.c.html#LN140"><span class='Ref_To_Local'>re_temp</span></a><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN104"><span class='Ref_to_Global_Var'>num_res</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Operator'>&</span><a href="regexp.c.html#LN105"><span class='Ref_to_Global_Var'>re_array</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="regexp.c.html#LN101"><span class='Ref_to_Member'>cre_re</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RE_compile_and_cache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RE_wchar_execute - execute a RE on pg_wchar data 
 * 
 * Returns TRUE on match, FALSE on no match 
 * 
 *  re --- the compiled pattern as returned by RE_compile_and_cache 
 *  data --- the data to match against (need not be null-terminated) 
 *  data_len --- the length of the data string 
 *  start_search -- the offset in the data to start searching 
 *  nmatch, pmatch  --- optional return area for match details 
 * 
 * Data is given as array of pg_wchar which is what Spencer's regex package 
 * wants. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN261"></a><span class='Declare_Function'>RE_wchar_execute</span><span class='Parentheses'>(</span><a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>re</span><span class='Delimiter'>, </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>data_len</span><span class='Delimiter'>, 
</span><a name="LN262"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>start_search</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nmatch</span><span class='Delimiter'>, </span><a href="../../../include/regex/regex.h.html#LN82"><span class='Ref_to_Typedef'>regmatch_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pmatch</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN264"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>regexec_result</span><span class='Delimiter'>; 
</span><a name="LN265"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>errMsg</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Perform RE match and return result */ 
</span>    <a href="regexp.c.html#LN264"><span class='Ref_To_Local'>regexec_result</span></a> <span class='Operator'>= </span><a href="../../regex/regexec.c.html#LN170"><span class='Ref_to_Func'>pg_regexec</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN261"><span class='Ref_to_Parameter'>re</span></a><span class='Delimiter'>, 
</span>                                <a href="regexp.c.html#LN261"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, 
</span>                                <a href="regexp.c.html#LN261"><span class='Ref_to_Parameter'>data_len</span></a><span class='Delimiter'>, 
</span>                                <a href="regexp.c.html#LN262"><span class='Ref_to_Parameter'>start_search</span></a><span class='Delimiter'>, 
</span>                                <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>   <span class='Comment_Single_Line'>/* no details */ 
</span>                                <a href="regexp.c.html#LN262"><span class='Ref_to_Parameter'>nmatch</span></a><span class='Delimiter'>, 
</span>                                <a href="regexp.c.html#LN262"><span class='Ref_to_Parameter'>pmatch</span></a><span class='Delimiter'>, 
</span>                                <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN264"><span class='Ref_To_Local'>regexec_result</span></a> <span class='Operator'>!= </span><a href="../../../include/regex/regex.h.html#LN136"><span class='Ref_to_Const'>REG_OKAY</span></a> <span class='Operator'>&& </span><a href="regexp.c.html#LN264"><span class='Ref_To_Local'>regexec_result</span></a> <span class='Operator'>!= </span><a href="../../../include/regex/regex.h.html#LN137"><span class='Ref_to_Const'>REG_NOMATCH</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* re failed??? */ 
</span>        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../regex/regerror.c.html#LN58"><span class='Ref_to_Func'>pg_regerror</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN264"><span class='Ref_To_Local'>regexec_result</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN261"><span class='Ref_to_Parameter'>re</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN265"><span class='Ref_To_Local'>errMsg</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN265"><span class='Ref_To_Local'>errMsg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_REGULAR_EXPRESSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"regular expression failed: %s"</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN265"><span class='Ref_To_Local'>errMsg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN264"><span class='Ref_To_Local'>regexec_result</span></a> <span class='Operator'>== </span><a href="../../../include/regex/regex.h.html#LN136"><span class='Ref_to_Const'>REG_OKAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RE_wchar_execute &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * RE_execute - execute a RE 
 * 
 * Returns TRUE on match, FALSE on no match 
 * 
 *  re --- the compiled pattern as returned by RE_compile_and_cache 
 *  dat --- the data to match against (need not be null-terminated) 
 *  dat_len --- the length of the data string 
 *  nmatch, pmatch  --- optional return area for match details 
 * 
 * Data is given in the database encoding.  We internally 
 * convert to array of pg_wchar which is what Spencer's regex package wants. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN304"></a><span class='Declare_Function'>RE_execute</span><span class='Parentheses'>(</span><a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>re</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dat</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dat_len</span><span class='Delimiter'>, 
</span><a name="LN305"></a>           <span class='Keyword'>int </span><span class='Declare_Parameter'>nmatch</span><span class='Delimiter'>, </span><a href="../../../include/regex/regex.h.html#LN82"><span class='Ref_to_Typedef'>regmatch_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pmatch</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN307"></a>    <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN308"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>data_len</span><span class='Delimiter'>; 
</span><a name="LN309"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>match</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert data string to wide characters */ 
</span>    <a href="regexp.c.html#LN307"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="regexp.c.html#LN304"><span class='Ref_to_Parameter'>dat_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN308"><span class='Ref_To_Local'>data_len</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN510"><span class='Ref_to_Proto'>pg_mb2wchar_with_len</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN304"><span class='Ref_to_Parameter'>dat</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN307"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN304"><span class='Ref_to_Parameter'>dat_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Perform RE match and return result */ 
</span>    <a href="regexp.c.html#LN309"><span class='Ref_To_Local'>match</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN260"><span class='Ref_to_Func'>RE_wchar_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN304"><span class='Ref_to_Parameter'>re</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN307"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN308"><span class='Ref_To_Local'>data_len</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN305"><span class='Ref_to_Parameter'>nmatch</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN305"><span class='Ref_to_Parameter'>pmatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN307"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="regexp.c.html#LN309"><span class='Ref_To_Local'>match</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * RE_compile_and_execute - compile and execute a RE 
 * 
 * Returns TRUE on match, FALSE on no match 
 * 
 *  text_re --- the pattern, expressed as a TEXT object 
 *  dat --- the data to match against (need not be null-terminated) 
 *  dat_len --- the length of the data string 
 *  cflags --- compile options for the pattern 
 *  collation --- collation to use for LC_CTYPE-dependent behavior 
 *  nmatch, pmatch  --- optional return area for match details 
 * 
 * Both pattern and data are given in the database encoding.  We internally 
 * convert to array of pg_wchar which is what Spencer's regex package wants. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN338"></a><span class='Declare_Function'>RE_compile_and_execute</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>text_re</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dat</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>dat_len</span><span class='Delimiter'>, 
</span><a name="LN339"></a>                       <span class='Keyword'>int </span><span class='Declare_Parameter'>cflags</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN340"></a>                       <span class='Keyword'>int </span><span class='Declare_Parameter'>nmatch</span><span class='Delimiter'>, </span><a href="../../../include/regex/regex.h.html#LN82"><span class='Ref_to_Typedef'>regmatch_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pmatch</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN342"></a>    <a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>re</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Compile RE */ 
</span>    <a href="regexp.c.html#LN342"><span class='Ref_To_Local'>re</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN131"><span class='Ref_to_Func'>RE_compile_and_cache</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN338"><span class='Ref_to_Parameter'>text_re</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN339"><span class='Ref_to_Parameter'>cflags</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN339"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="regexp.c.html#LN303"><span class='Ref_to_Func'>RE_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN342"><span class='Ref_To_Local'>re</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN338"><span class='Ref_to_Parameter'>dat</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN338"><span class='Ref_to_Parameter'>dat_len</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN340"><span class='Ref_to_Parameter'>nmatch</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN340"><span class='Ref_to_Parameter'>pmatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * parse_re_flags - parse the options argument of regexp_match and friends 
 * 
 *  flags --- output argument, filled with desired options 
 *  opts --- TEXT object, or NULL for defaults 
 * 
 * This accepts all the options allowed by any of the callers; callers that 
 * don't want some have to reject them after the fact. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN361"></a><span class='Declare_Function'>parse_re_flags</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN44"><span class='Ref_to_Struct'>pg_re_flags</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>flags</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>opts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* regex flavor is always folded into the compile flags */ 
</span>    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>= </span><a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>opts</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN369"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>opt_p</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN370"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>opt_len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>opts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN371"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN371"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regexp.c.html#LN371"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regexp.c.html#LN370"><span class='Ref_To_Local'>opt_len</span></a><span class='Delimiter'>; </span><a href="regexp.c.html#LN371"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN369"><span class='Ref_To_Local'>opt_p</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN371"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <span class='String'>'g'</span><span class='Operator'>: 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* BREs (but why???) */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>(</span><a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a> <span class='Operator'>| </span><a href="../../../include/regex/regex.h.html#LN100"><span class='Ref_to_Const'>REG_EXTENDED</span></a> <span class='Operator'>| </span><a href="../../../include/regex/regex.h.html#LN103"><span class='Ref_to_Const'>REG_QUOTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* case sensitive */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>&= ~</span><a href="../../../include/regex/regex.h.html#LN105"><span class='Ref_to_Const'>REG_ICASE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'e'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* plain EREs */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>|= </span><a href="../../../include/regex/regex.h.html#LN100"><span class='Ref_to_Const'>REG_EXTENDED</span></a><span class='Delimiter'>; 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>(</span><a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a> <span class='Operator'>| </span><a href="../../../include/regex/regex.h.html#LN103"><span class='Ref_to_Const'>REG_QUOTE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'i'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* case insensitive */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>|= </span><a href="../../../include/regex/regex.h.html#LN105"><span class='Ref_to_Const'>REG_ICASE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'m'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* Perloid synonym for n */ 
</span>                <span class='Control'>case</span> <span class='String'>'n'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* \n affects ^ $ . [^ */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>|= </span><a href="../../../include/regex/regex.h.html#LN110"><span class='Ref_to_Const'>REG_NEWLINE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'p'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* ~Perl, \n affects . [^ */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>|= </span><a href="../../../include/regex/regex.h.html#LN108"><span class='Ref_to_Const'>REG_NLSTOP</span></a><span class='Delimiter'>; 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>&= ~</span><a href="../../../include/regex/regex.h.html#LN109"><span class='Ref_to_Const'>REG_NLANCH</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'q'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* literal string */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>|= </span><a href="../../../include/regex/regex.h.html#LN103"><span class='Ref_to_Const'>REG_QUOTE</span></a><span class='Delimiter'>; 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>&= ~</span><span class='Parentheses'>(</span><a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a> <span class='Operator'>| </span><a href="../../../include/regex/regex.h.html#LN100"><span class='Ref_to_Const'>REG_EXTENDED</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* single line, \n ordinary */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>&= ~</span><a href="../../../include/regex/regex.h.html#LN110"><span class='Ref_to_Const'>REG_NEWLINE</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'t'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* tight syntax */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>&= ~</span><a href="../../../include/regex/regex.h.html#LN107"><span class='Ref_to_Const'>REG_EXPANDED</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'w'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* weird, \n affects ^ $ only */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>&= ~</span><a href="../../../include/regex/regex.h.html#LN108"><span class='Ref_to_Const'>REG_NLSTOP</span></a><span class='Delimiter'>; 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>|= </span><a href="../../../include/regex/regex.h.html#LN109"><span class='Ref_to_Const'>REG_NLANCH</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <span class='String'>'x'</span><span class='Operator'>:</span>       <span class='Comment_Single_Line'>/* expanded syntax */ 
</span>                    <a href="regexp.c.html#LN361"><span class='Ref_to_Parameter'>flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a> <span class='Operator'>|= </span><a href="../../../include/regex/regex.h.html#LN107"><span class='Ref_to_Const'>REG_EXPANDED</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid regexp option: \"%c\""</span><span class='Delimiter'>, 
</span>                                    <a href="regexp.c.html#LN369"><span class='Ref_To_Local'>opt_p</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN371"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch opt_p[i] &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;opt_len;i++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if opts &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end parse_re_flags &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  interface routines called by the function manager 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN435"></a><span class='Declare_Function'>nameregexeq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN437"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN438"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN337"><span class='Ref_to_Func'>RE_compile_and_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN438"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regexp.c.html#LN437"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          strlen<span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regexp.c.html#LN437"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                          <a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                          <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN449"></a><span class='Declare_Function'>nameregexne</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN451"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN452"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regexp.c.html#LN337"><span class='Ref_to_Func'>RE_compile_and_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN452"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regexp.c.html#LN451"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           strlen<span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regexp.c.html#LN451"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                           <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN463"></a><span class='Declare_Function'>textregexeq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN465"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN466"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN337"><span class='Ref_to_Func'>RE_compile_and_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN466"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN465"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN465"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                          <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN477"></a><span class='Declare_Function'>textregexne</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN479"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN480"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regexp.c.html#LN337"><span class='Ref_to_Func'>RE_compile_and_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN480"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN479"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN479"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                           <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *  routines that use the regexp stuff, but ignore the case. 
 *  for this, we use the REG_ICASE flag to pg_regcomp 
 */ 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN498"></a><span class='Declare_Function'>nameicregexeq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN500"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN501"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN337"><span class='Ref_to_Func'>RE_compile_and_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN501"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regexp.c.html#LN500"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          strlen<span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regexp.c.html#LN500"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                          <a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a> <span class='Operator'>| </span><a href="../../../include/regex/regex.h.html#LN105"><span class='Ref_to_Const'>REG_ICASE</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                          <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN512"></a><span class='Declare_Function'>nameicregexne</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN514"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN515"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regexp.c.html#LN337"><span class='Ref_to_Func'>RE_compile_and_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN515"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regexp.c.html#LN514"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           strlen<span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="regexp.c.html#LN514"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a> <span class='Operator'>| </span><a href="../../../include/regex/regex.h.html#LN105"><span class='Ref_to_Const'>REG_ICASE</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                           <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN526"></a><span class='Declare_Function'>texticregexeq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN528"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN529"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN337"><span class='Ref_to_Func'>RE_compile_and_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN529"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN528"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN528"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a> <span class='Operator'>| </span><a href="../../../include/regex/regex.h.html#LN105"><span class='Ref_to_Const'>REG_ICASE</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                          <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN540"></a><span class='Declare_Function'>texticregexne</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN542"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN543"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regexp.c.html#LN337"><span class='Ref_to_Func'>RE_compile_and_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN543"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN542"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN542"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a> <span class='Operator'>| </span><a href="../../../include/regex/regex.h.html#LN105"><span class='Ref_to_Const'>REG_ICASE</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                           <span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * textregexsubstr() 
 *      Return a substring matched by a regular expression. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN559"></a><span class='Declare_Function'>textregexsubstr</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN561"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN562"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN563"></a>    <a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>re</span><span class='Delimiter'>; 
</span><a name="LN564"></a>    <a href="../../../include/regex/regex.h.html#LN82"><span class='Ref_to_Typedef'>regmatch_t</span></a>  <span class='Declare_Local'>pmatch</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN565"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>so</span><span class='Delimiter'>, 
</span><a name="LN566"></a>                <span class='Declare_Local'>eo</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Compile RE */ 
</span>    <a href="regexp.c.html#LN563"><span class='Ref_To_Local'>re</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN131"><span class='Ref_to_Func'>RE_compile_and_cache</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN562"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We pass two regmatch_t structs to get info about the overall match and 
     * the match for the first parenthesized subexpression (if any). If there 
     * is a parenthesized subexpression, we return what it matched; else 
     * return what the whole regexp matched. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regexp.c.html#LN303"><span class='Ref_to_Func'>RE_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN563"><span class='Ref_To_Local'>re</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN561"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN561"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                    <span class='Number'>2</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN564"><span class='Ref_To_Local'>pmatch</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* definitely no match */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN563"><span class='Ref_To_Local'>re</span></a><span class='Operator'>-&GT;</span><a href="../../../include/regex/regex.h.html#LN57"><span class='Ref_to_Member'>re_nsub</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* has parenthesized subexpressions, use the first one */ 
</span>        <a href="regexp.c.html#LN565"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN564"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN566"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN564"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* no parenthesized subexpression, use whole match */ 
</span>        <a href="regexp.c.html#LN565"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN564"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN566"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN564"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * It is possible to have a match to the whole pattern but no match for a 
     * subexpression; for example 'foo(bar)?' is considered to match 'foo' but 
     * there is no subexpression match.  So this extra test for match failure 
     * is not redundant. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN565"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="regexp.c.html#LN566"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN779"><span class='Ref_to_Func'>text_substr</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN561"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN565"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN566"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>- </span><a href="regexp.c.html#LN565"><span class='Ref_To_Local'>so</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end textregexsubstr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * textregexreplace_noopt() 
 *      Return a string matched by a regular expression, with replacement. 
 * 
 * This version doesn't have an option argument: we default to case 
 * sensitive match, replace the first instance only. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN618"></a><span class='Declare_Function'>textregexreplace_noopt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN620"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN621"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN622"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN623"></a>    <a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>re</span><span class='Delimiter'>; 
</span> 
    <a href="regexp.c.html#LN623"><span class='Ref_To_Local'>re</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN131"><span class='Ref_to_Func'>RE_compile_and_cache</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN621"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/varlena.h.html#LN33"><span class='Ref_to_Proto'>replace_text_regexp</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN620"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="regexp.c.html#LN623"><span class='Ref_To_Local'>re</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN622"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * textregexreplace() 
 *      Return a string matched by a regular expression, with replacement. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN635"></a><span class='Declare_Function'>textregexreplace</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN637"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN638"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN639"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>r</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN640"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>opt</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN641"></a>    <a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>re</span><span class='Delimiter'>; 
</span><a name="LN642"></a>    <a href="regexp.c.html#LN44"><span class='Ref_to_Struct'>pg_re_flags</span></a> <span class='Declare_Local'>flags</span><span class='Delimiter'>; 
</span> 
    <a href="regexp.c.html#LN360"><span class='Ref_to_Func'>parse_re_flags</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN642"><span class='Ref_To_Local'>flags</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN640"><span class='Ref_To_Local'>opt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="regexp.c.html#LN641"><span class='Ref_To_Local'>re</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN131"><span class='Ref_to_Func'>RE_compile_and_cache</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN638"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN642"><span class='Ref_To_Local'>flags</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/varlena.h.html#LN33"><span class='Ref_to_Proto'>replace_text_regexp</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN637"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="regexp.c.html#LN641"><span class='Ref_To_Local'>re</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN639"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN642"><span class='Ref_To_Local'>flags</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * similar_escape() 
 * Convert a SQL:2008 regexp pattern to POSIX style, so it can be used by 
 * our regexp engine. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN657"></a><span class='Declare_Function'>similar_escape</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN659"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pat_text</span><span class='Delimiter'>; 
</span><a name="LN660"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>esc_text</span><span class='Delimiter'>; 
</span><a name="LN661"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN662"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>, 
</span><a name="LN663"></a>               <span class='Operator'>*</span><span class='Declare_Local'>e</span><span class='Delimiter'>, 
</span><a name="LN664"></a>               <span class='Operator'>*</span><span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span><a name="LN665"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>plen</span><span class='Delimiter'>, 
</span><a name="LN666"></a>                <span class='Declare_Local'>elen</span><span class='Delimiter'>; 
</span><a name="LN667"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>afterescape</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN668"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>incharclass</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN669"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nquotes</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This function is not strict, so must test explicitly */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN659"><span class='Ref_To_Local'>pat_text</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN662"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN659"><span class='Ref_To_Local'>pat_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN665"><span class='Ref_To_Local'>plen</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN659"><span class='Ref_To_Local'>pat_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* No ESCAPE clause provided; default to backslash as escape */ 
</span>        <a href="regexp.c.html#LN663"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>= </span><span class='String'>"\\"</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN666"><span class='Ref_To_Local'>elen</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="regexp.c.html#LN660"><span class='Ref_To_Local'>esc_text</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN663"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN660"><span class='Ref_To_Local'>esc_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN666"><span class='Ref_To_Local'>elen</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN660"><span class='Ref_To_Local'>esc_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN666"><span class='Ref_To_Local'>elen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="regexp.c.html#LN663"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* no escape character */ 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN692"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>escape_mblen</span> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN529"><span class='Ref_to_Proto'>pg_mbstrlen_with_len</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN663"><span class='Ref_To_Local'>e</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN666"><span class='Ref_To_Local'>elen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN692"><span class='Ref_To_Local'>escape_mblen</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_ESCAPE_SEQUENCE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid escape string"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Escape string must be empty or one character."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * We surround the transformed input string with 
     *          ^(?: ... )$ 
     * which requires some explanation.  We need "^" and "$" to force 
     * the pattern to match the entire input string as per SQL99 spec. 
     * The "(?:" and ")" are a non-capturing set of parens; we have to have 
     * parens in case the string contains "|", else the "^" and "$" will 
     * be bound into the first and last alternatives which is not what we 
     * want, and the parens must be non capturing because we don't want them 
     * to count when selecting output for SUBSTRING. 
     *---------- 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need room for the prefix/postfix plus as many as 3 output bytes per 
     * input byte; since the input is at most 1GB this can't overflow 
     */ 
</span>    <a href="regexp.c.html#LN661"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><span class='Number'>6</span> <span class='Operator'>+ </span><span class='Number'>3</span> <span class='Operator'>* </span><a href="regexp.c.html#LN665"><span class='Ref_To_Local'>plen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN661"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'^'</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'('</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'?'</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN665"><span class='Ref_To_Local'>plen</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN729"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>pchar</span> <span class='Operator'>= *</span><a href="regexp.c.html#LN662"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If both the escape character and the current character from the 
         * pattern are multi-byte, we need to take the slow path. 
         * 
         * But if one of them is single-byte, we can process the pattern one 
         * byte at a time, ignoring multi-byte characters.  (This works 
         * because all server-encodings have the property that a valid 
         * multi-byte character representation cannot contain the 
         * representation of a valid single-byte character.) 
         */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN666"><span class='Ref_To_Local'>elen</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN744"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>mblen</span> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN662"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN744"><span class='Ref_To_Local'>mblen</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* slow, multi-byte path */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN667"><span class='Ref_To_Local'>afterescape</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>                    memcpy<span class='Parentheses'>(</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN662"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN744"><span class='Ref_To_Local'>mblen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>+= </span><a href="regexp.c.html#LN744"><span class='Ref_To_Local'>mblen</span></a><span class='Delimiter'>; 
</span>                    <a href="regexp.c.html#LN667"><span class='Ref_To_Local'>afterescape</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN663"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>&& </span><a href="regexp.c.html#LN666"><span class='Ref_To_Local'>elen</span></a> <span class='Operator'>== </span><a href="regexp.c.html#LN744"><span class='Ref_To_Local'>mblen</span></a> <span class='Operator'>&& </span>memcmp<span class='Parentheses'>(</span><a href="regexp.c.html#LN663"><span class='Ref_To_Local'>e</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN662"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN744"><span class='Ref_To_Local'>mblen</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* SQL99 escape character; do not send to output */ 
</span>                    <a href="regexp.c.html#LN667"><span class='Ref_To_Local'>afterescape</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * We know it's a multi-byte character, so we don't need 
                     * to do all the comparisons to single-byte characters 
                     * that we do below. 
                     */ 
</span>                    memcpy<span class='Parentheses'>(</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN662"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN744"><span class='Ref_To_Local'>mblen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>+= </span><a href="regexp.c.html#LN744"><span class='Ref_To_Local'>mblen</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="regexp.c.html#LN662"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="regexp.c.html#LN744"><span class='Ref_To_Local'>mblen</span></a><span class='Delimiter'>; 
</span>                <a href="regexp.c.html#LN665"><span class='Ref_To_Local'>plen</span></a> <span class='Operator'>-= </span><a href="regexp.c.html#LN744"><span class='Ref_To_Local'>mblen</span></a><span class='Delimiter'>; 
</span> 
                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if mblen&GT;1 &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if elen&GT;1 &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* fast path */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN667"><span class='Ref_To_Local'>afterescape</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'"'</span> <span class='Operator'>&& !</span><a href="regexp.c.html#LN668"><span class='Ref_To_Local'>incharclass</span></a><span class='Parentheses'>)</span>   <span class='Comment_Single_Line'>/* for SUBSTRING patterns */ 
</span>                <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='Parentheses'>((</span><a href="regexp.c.html#LN669"><span class='Ref_To_Local'>nquotes</span></a><span class='Operator'>++ % </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><span class='String'>'('</span> <span class='Operator'>: </span><span class='String'>')'</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="regexp.c.html#LN667"><span class='Ref_To_Local'>afterescape</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN663"><span class='Ref_To_Local'>e</span></a> <span class='Operator'>&& </span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== *</span><a href="regexp.c.html#LN663"><span class='Ref_To_Local'>e</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* SQL99 escape character; do not send to output */ 
</span>            <a href="regexp.c.html#LN667"><span class='Ref_To_Local'>afterescape</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN668"><span class='Ref_To_Local'>incharclass</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>']'</span><span class='Parentheses'>) 
</span>                <a href="regexp.c.html#LN668"><span class='Ref_To_Local'>incharclass</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'['</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a><span class='Delimiter'>; 
</span>            <a href="regexp.c.html#LN668"><span class='Ref_To_Local'>incharclass</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'*'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'_'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'.'</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'('</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* convert to non-capturing parenthesis */ 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'('</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'?'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>':'</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span> <span class='Operator'>|| </span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'.'</span> <span class='Operator'>|| 
</span>                 <a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'^'</span> <span class='Operator'>|| </span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a> <span class='Operator'>== </span><span class='String'>'$'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><a href="regexp.c.html#LN729"><span class='Ref_To_Local'>pchar</span></a><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN662"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN665"><span class='Ref_To_Local'>plen</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while plen&GT;0 &raquo; </span> 
 
    <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>')'</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a><span class='Operator'>++ = </span><span class='String'>'$'</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN661"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN664"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>- </span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="regexp.c.html#LN661"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN661"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end similar_escape &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * regexp_match() 
 *      Return the first substring(s) matching a pattern within a string. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN847"></a><span class='Declare_Function'>regexp_match</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN849"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>orig_str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN850"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pattern</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN851"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>flags</span> <span class='Operator'>= </span><a href="regexp.c.html#LN39"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP_IF_EXISTS</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN852"></a>    <a href="regexp.c.html#LN44"><span class='Ref_to_Struct'>pg_re_flags</span></a> <span class='Declare_Local'>re_flags</span><span class='Delimiter'>; 
</span><a name="LN853"></a>    <a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>matchctx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Determine options */ 
</span>    <a href="regexp.c.html#LN360"><span class='Ref_to_Func'>parse_re_flags</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN852"><span class='Ref_To_Local'>re_flags</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN851"><span class='Ref_To_Local'>flags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* User mustn't specify 'g' */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN852"><span class='Ref_To_Local'>re_flags</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"regexp_match does not support the global option"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use the regexp_matches function instead."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="regexp.c.html#LN853"><span class='Ref_To_Local'>matchctx</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN109"><span class='Ref_to_Proto'>setup_regexp_matches</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN849"><span class='Ref_To_Local'>orig_str</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN850"><span class='Ref_To_Local'>pattern</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regexp.c.html#LN852"><span class='Ref_To_Local'>re_flags</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN853"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN54"><span class='Ref_to_Member'>nmatches</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN853"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN54"><span class='Ref_to_Member'>nmatches</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create workspace that build_regexp_match_result needs */ 
</span>    <a href="regexp.c.html#LN853"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN61"><span class='Ref_to_Member'>elems</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="regexp.c.html#LN853"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN853"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN62"><span class='Ref_to_Member'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="regexp.c.html#LN853"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN115"><span class='Ref_to_Proto'>build_regexp_match_result</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN853"><span class='Ref_To_Local'>matchctx</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end regexp_match &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* This is separate to keep the opr_sanity regression test from complaining */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN881"></a><span class='Declare_Function'>regexp_match_no_flags</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="regexp.c.html#LN846"><span class='Ref_to_Func'>regexp_match</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * regexp_matches() 
 *      Return a table of all matches of a pattern within a string. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN891"></a><span class='Declare_Function'>regexp_matches</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN893"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN894"></a>    <a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>matchctx</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN898"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pattern</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN899"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>flags</span> <span class='Operator'>= </span><a href="regexp.c.html#LN39"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP_IF_EXISTS</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN900"></a>        <a href="regexp.c.html#LN44"><span class='Ref_to_Struct'>pg_re_flags</span></a> <span class='Declare_Local'>re_flags</span><span class='Delimiter'>; 
</span><a name="LN901"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <a href="regexp.c.html#LN893"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN901"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN893"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Determine options */ 
</span>        <a href="regexp.c.html#LN360"><span class='Ref_to_Func'>parse_re_flags</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN900"><span class='Ref_To_Local'>re_flags</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN899"><span class='Ref_To_Local'>flags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* be sure to copy the input string into the multi-call ctx */ 
</span>        <a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN109"><span class='Ref_to_Proto'>setup_regexp_matches</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN278"><span class='Ref_to_Macro'>PG_GETARG_TEXT_P_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN898"><span class='Ref_To_Local'>pattern</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="regexp.c.html#LN900"><span class='Ref_To_Local'>re_flags</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Pre-create workspace that build_regexp_match_result needs */ 
</span>        <a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN61"><span class='Ref_to_Member'>elems</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN62"><span class='Ref_to_Member'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN901"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN893"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <a href="regexp.c.html#LN893"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="regexp.c.html#LN893"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a> <span class='Operator'>&LT; </span><a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN54"><span class='Ref_to_Member'>nmatches</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN928"></a>        <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result_ary</span><span class='Delimiter'>; 
</span> 
        <a href="regexp.c.html#LN928"><span class='Ref_To_Local'>result_ary</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN115"><span class='Ref_to_Proto'>build_regexp_match_result</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN893"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN928"><span class='Ref_To_Local'>result_ary</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* release space in multi-call ctx to avoid intraquery memory leak */ 
</span>    <a href="regexp.c.html#LN114"><span class='Ref_to_Proto'>cleanup_regexp_matches</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN894"><span class='Ref_To_Local'>matchctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN893"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end regexp_matches &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* This is separate to keep the opr_sanity regression test from complaining */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN943"></a><span class='Declare_Function'>regexp_matches_no_flags</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="regexp.c.html#LN890"><span class='Ref_to_Func'>regexp_matches</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * setup_regexp_matches --- do the initial matching for regexp_match 
 *      and regexp_split functions 
 * 
 * To avoid having to re-find the compiled pattern on each call, we do 
 * all the matching in one swoop.  The returned regexp_matches_ctx contains 
 * the locations of all the substrings matching the pattern. 
 * 
 * The two bool parameters have only two patterns (one for matching, one for 
 * splitting) but it seems clearer to distinguish the functionality this way 
 * than to key it all off one "is_split" flag. 
 */ 
</span><span class='Keyword'>static </span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>* 
</span><a name="LN961"></a><span class='Declare_Function'>setup_regexp_matches</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>orig_str</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pattern</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN44"><span class='Ref_to_Struct'>pg_re_flags</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>re_flags</span><span class='Delimiter'>, 
</span><a name="LN962"></a>                     <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN963"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>use_subpatterns</span><span class='Delimiter'>, 
</span><a name="LN964"></a>                     <span class='Keyword'>bool </span><span class='Declare_Parameter'>ignore_degenerate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN966"></a>    <a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>matchctx</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN967"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>orig_len</span><span class='Delimiter'>; 
</span><a name="LN968"></a>    <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>wide_str</span><span class='Delimiter'>; 
</span><a name="LN969"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>wide_len</span><span class='Delimiter'>; 
</span><a name="LN970"></a>    <a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>cpattern</span><span class='Delimiter'>; 
</span><a name="LN971"></a>    <a href="../../../include/regex/regex.h.html#LN82"><span class='Ref_to_Typedef'>regmatch_t</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pmatch</span><span class='Delimiter'>; 
</span><a name="LN972"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pmatch_len</span><span class='Delimiter'>; 
</span><a name="LN973"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>array_len</span><span class='Delimiter'>; 
</span><a name="LN974"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>array_idx</span><span class='Delimiter'>; 
</span><a name="LN975"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>prev_match_end</span><span class='Delimiter'>; 
</span><a name="LN976"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>start_search</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* save original string --- we'll extract result substrings from it */ 
</span>    <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN53"><span class='Ref_to_Member'>orig_str</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN961"><span class='Ref_to_Parameter'>orig_str</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* convert string to pg_wchar form for matching */ 
</span>    <a href="regexp.c.html#LN967"><span class='Ref_To_Local'>orig_len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN961"><span class='Ref_to_Parameter'>orig_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN968"><span class='Ref_To_Local'>wide_str</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="regexp.c.html#LN967"><span class='Ref_To_Local'>orig_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN969"><span class='Ref_To_Local'>wide_len</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN510"><span class='Ref_to_Proto'>pg_mb2wchar_with_len</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN961"><span class='Ref_to_Parameter'>orig_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN968"><span class='Ref_To_Local'>wide_str</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN967"><span class='Ref_To_Local'>orig_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set up the compiled pattern */ 
</span>    <a href="regexp.c.html#LN970"><span class='Ref_To_Local'>cpattern</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN131"><span class='Ref_to_Func'>RE_compile_and_cache</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN961"><span class='Ref_to_Parameter'>pattern</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN961"><span class='Ref_to_Parameter'>re_flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN46"><span class='Ref_to_Member'>cflags</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN962"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* do we want to remember subpatterns? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN963"><span class='Ref_to_Parameter'>use_subpatterns</span></a> <span class='Operator'>&& </span><a href="regexp.c.html#LN970"><span class='Ref_To_Local'>cpattern</span></a><span class='Operator'>-&GT;</span><a href="../../../include/regex/regex.h.html#LN57"><span class='Ref_to_Member'>re_nsub</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN970"><span class='Ref_To_Local'>cpattern</span></a><span class='Operator'>-&GT;</span><a href="../../../include/regex/regex.h.html#LN57"><span class='Ref_to_Member'>re_nsub</span></a><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN972"><span class='Ref_To_Local'>pmatch_len</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN970"><span class='Ref_To_Local'>cpattern</span></a><span class='Operator'>-&GT;</span><a href="../../../include/regex/regex.h.html#LN57"><span class='Ref_to_Member'>re_nsub</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="regexp.c.html#LN963"><span class='Ref_to_Parameter'>use_subpatterns</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN972"><span class='Ref_To_Local'>pmatch_len</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* temporary output space for RE package */ 
</span>    <a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/regex/regex.h.html#LN82"><span class='Ref_to_Typedef'>regmatch_t</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="regexp.c.html#LN972"><span class='Ref_To_Local'>pmatch_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* the real output space (grown dynamically if needed) */ 
</span>    <a href="regexp.c.html#LN973"><span class='Ref_To_Local'>array_len</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN961"><span class='Ref_to_Parameter'>re_flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a> <span class='Operator'>? </span><span class='Number'>256</span> <span class='Operator'>: </span><span class='Number'>32</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="regexp.c.html#LN973"><span class='Ref_To_Local'>array_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN974"><span class='Ref_To_Local'>array_idx</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* search for the pattern, perhaps repeatedly */ 
</span>    <a href="regexp.c.html#LN975"><span class='Ref_To_Local'>prev_match_end</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN976"><span class='Ref_To_Local'>start_search</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN260"><span class='Ref_to_Func'>RE_wchar_execute</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN970"><span class='Ref_To_Local'>cpattern</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN968"><span class='Ref_To_Local'>wide_str</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN969"><span class='Ref_To_Local'>wide_len</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN976"><span class='Ref_To_Local'>start_search</span></a><span class='Delimiter'>, 
</span>                            <a href="regexp.c.html#LN972"><span class='Ref_To_Local'>pmatch_len</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If requested, ignore degenerate matches, which are zero-length 
         * matches occurring at the start or end of a string or just after a 
         * previous match. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regexp.c.html#LN964"><span class='Ref_to_Parameter'>ignore_degenerate</span></a> <span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a> <span class='Operator'>&LT; </span><a href="regexp.c.html#LN969"><span class='Ref_To_Local'>wide_len</span></a> <span class='Operator'>&& 
</span>             <a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a> <span class='Operator'>&GT; </span><a href="regexp.c.html#LN975"><span class='Ref_To_Local'>prev_match_end</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* enlarge output space if needed */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN974"><span class='Ref_To_Local'>array_idx</span></a> <span class='Operator'>+ </span><a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>&GT; </span><a href="regexp.c.html#LN973"><span class='Ref_To_Local'>array_len</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="regexp.c.html#LN973"><span class='Ref_To_Local'>array_len</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Delimiter'>, 
</span>                                                    <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="regexp.c.html#LN973"><span class='Ref_To_Local'>array_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* save this match's locations */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN963"><span class='Ref_to_Parameter'>use_subpatterns</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1036"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1036"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="regexp.c.html#LN1036"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a><span class='Delimiter'>; </span><a href="regexp.c.html#LN1036"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN974"><span class='Ref_To_Local'>array_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1036"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Delimiter'>; 
</span>                    <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN974"><span class='Ref_To_Local'>array_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1036"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN974"><span class='Ref_To_Local'>array_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Delimiter'>; 
</span>                <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN974"><span class='Ref_To_Local'>array_idx</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN54"><span class='Ref_to_Member'>nmatches</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !ignore_degenerate||(... &raquo; </span> 
        <a href="regexp.c.html#LN975"><span class='Ref_To_Local'>prev_match_end</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* if not glob, stop after one match */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="regexp.c.html#LN961"><span class='Ref_to_Parameter'>re_flags</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Advance search position.  Normally we start the next search at the 
         * end of the previous match; but if the match was of zero length, we 
         * have to advance by one character, or we'd just find the same match 
         * again. 
         */ 
</span>        <a href="regexp.c.html#LN976"><span class='Ref_To_Local'>start_search</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN975"><span class='Ref_To_Local'>prev_match_end</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a> <span class='Operator'>== </span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Parentheses'>) 
</span>            <a href="regexp.c.html#LN976"><span class='Ref_To_Local'>start_search</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN976"><span class='Ref_To_Local'>start_search</span></a> <span class='Operator'>&GT; </span><a href="regexp.c.html#LN969"><span class='Ref_To_Local'>wide_len</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while RE_wchar_execute(cpat... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Clean up temp storage */ 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN968"><span class='Ref_To_Local'>wide_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN971"><span class='Ref_To_Local'>pmatch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="regexp.c.html#LN966"><span class='Ref_To_Local'>matchctx</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end setup_regexp_matches &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * cleanup_regexp_matches - release memory of a regexp_matches_ctx 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1081"></a><span class='Declare_Function'>cleanup_regexp_matches</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>matchctx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1081"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN53"><span class='Ref_to_Member'>orig_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1081"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1081"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN61"><span class='Ref_to_Member'>elems</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1081"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN61"><span class='Ref_to_Member'>elems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1081"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN62"><span class='Ref_to_Member'>nulls</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1081"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN62"><span class='Ref_to_Member'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1081"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * build_regexp_match_result - build output array for current match 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>* 
</span><a name="LN1096"></a><span class='Declare_Function'>build_regexp_match_result</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>matchctx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1098"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elems</span> <span class='Operator'>= </span><a href="regexp.c.html#LN1096"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN61"><span class='Ref_to_Member'>elems</span></a><span class='Delimiter'>; 
</span><a name="LN1099"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="regexp.c.html#LN1096"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN62"><span class='Ref_to_Member'>nulls</span></a><span class='Delimiter'>; 
</span><a name="LN1100"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dims</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1101"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lbs</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1102"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>loc</span><span class='Delimiter'>; 
</span><a name="LN1103"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Extract matching substrings from the original string */ 
</span>    <a href="regexp.c.html#LN1102"><span class='Ref_To_Local'>loc</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN1096"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a> <span class='Operator'>* </span><a href="regexp.c.html#LN1096"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1103"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="regexp.c.html#LN1103"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="regexp.c.html#LN1096"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a><span class='Delimiter'>; </span><a href="regexp.c.html#LN1103"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1109"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>so</span> <span class='Operator'>= </span><a href="regexp.c.html#LN1096"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1102"><span class='Ref_To_Local'>loc</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span><a name="LN1110"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>eo</span> <span class='Operator'>= </span><a href="regexp.c.html#LN1096"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1102"><span class='Ref_To_Local'>loc</span></a><span class='Operator'>++</span><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1109"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="regexp.c.html#LN1110"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="regexp.c.html#LN1098"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1103"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="regexp.c.html#LN1099"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1103"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="regexp.c.html#LN1098"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1103"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN779"><span class='Ref_to_Func'>text_substr</span></a><span class='Delimiter'>, 
</span>                                         <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1096"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN53"><span class='Ref_to_Member'>orig_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1109"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1110"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>- </span><a href="regexp.c.html#LN1109"><span class='Ref_To_Local'>so</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="regexp.c.html#LN1099"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1103"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* And form an array */ 
</span>    <a href="regexp.c.html#LN1100"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="regexp.c.html#LN1096"><span class='Ref_to_Parameter'>matchctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN55"><span class='Ref_to_Member'>npatterns</span></a><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN1101"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* XXX: this hardcodes assumptions about the text type */ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1098"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1099"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN1100"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1101"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_regexp_match_result &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * regexp_split_to_table() 
 *      Split the string at matches of the pattern, returning the 
 *      split-out substrings as a table. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1141"></a><span class='Declare_Function'>regexp_split_to_table</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1143"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN1144"></a>    <a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splitctx</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1148"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>pattern</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1149"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>flags</span> <span class='Operator'>= </span><a href="regexp.c.html#LN39"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP_IF_EXISTS</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1150"></a>        <a href="regexp.c.html#LN44"><span class='Ref_to_Struct'>pg_re_flags</span></a> <span class='Declare_Local'>re_flags</span><span class='Delimiter'>; 
</span><a name="LN1151"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
        <a href="regexp.c.html#LN1143"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN1151"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1143"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Determine options */ 
</span>        <a href="regexp.c.html#LN360"><span class='Ref_to_Func'>parse_re_flags</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN1150"><span class='Ref_To_Local'>re_flags</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1149"><span class='Ref_To_Local'>flags</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* User mustn't specify 'g' */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1150"><span class='Ref_To_Local'>re_flags</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"regexp_split_to_table does not support the global option"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* But we find all the matches anyway */ 
</span>        <a href="regexp.c.html#LN1150"><span class='Ref_To_Local'>re_flags</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* be sure to copy the input string into the multi-call ctx */ 
</span>        <a href="regexp.c.html#LN1144"><span class='Ref_To_Local'>splitctx</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN109"><span class='Ref_to_Proto'>setup_regexp_matches</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN278"><span class='Ref_to_Macro'>PG_GETARG_TEXT_P_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN1148"><span class='Ref_To_Local'>pattern</span></a><span class='Delimiter'>, 
</span>                                        <span class='Operator'>&</span><a href="regexp.c.html#LN1150"><span class='Ref_To_Local'>re_flags</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                        <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1151"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN1143"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="regexp.c.html#LN1144"><span class='Ref_To_Local'>splitctx</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <a href="regexp.c.html#LN1143"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN1144"><span class='Ref_To_Local'>splitctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="regexp.c.html#LN1143"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1144"><span class='Ref_To_Local'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a> <span class='Operator'>&LT;= </span><a href="regexp.c.html#LN1144"><span class='Ref_To_Local'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN54"><span class='Ref_to_Member'>nmatches</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1181"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="regexp.c.html#LN116"><span class='Ref_to_Proto'>build_regexp_split_result</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1144"><span class='Ref_To_Local'>splitctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="regexp.c.html#LN1144"><span class='Ref_To_Local'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1143"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1181"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* release space in multi-call ctx to avoid intraquery memory leak */ 
</span>    <a href="regexp.c.html#LN114"><span class='Ref_to_Proto'>cleanup_regexp_matches</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1144"><span class='Ref_To_Local'>splitctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1143"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end regexp_split_to_table &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* This is separate to keep the opr_sanity regression test from complaining */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1195"></a><span class='Declare_Function'>regexp_split_to_table_no_flags</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="regexp.c.html#LN1140"><span class='Ref_to_Func'>regexp_split_to_table</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * regexp_split_to_array() 
 *      Split the string at matches of the pattern, returning the 
 *      split-out substrings as an array. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1206"></a><span class='Declare_Function'>regexp_split_to_array</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1208"></a>    <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>astate</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1209"></a>    <a href="regexp.c.html#LN44"><span class='Ref_to_Struct'>pg_re_flags</span></a> <span class='Declare_Local'>re_flags</span><span class='Delimiter'>; 
</span><a name="LN1210"></a>    <a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>splitctx</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Determine options */ 
</span>    <a href="regexp.c.html#LN360"><span class='Ref_to_Func'>parse_re_flags</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="regexp.c.html#LN1209"><span class='Ref_To_Local'>re_flags</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN39"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP_IF_EXISTS</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* User mustn't specify 'g' */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1209"><span class='Ref_To_Local'>re_flags</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"regexp_split_to_array does not support the global option"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* But we find all the matches anyway */ 
</span>    <a href="regexp.c.html#LN1209"><span class='Ref_To_Local'>re_flags</span></a><span class='Operator'>.</span><a href="regexp.c.html#LN47"><span class='Ref_to_Member'>glob</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="regexp.c.html#LN1210"><span class='Ref_To_Local'>splitctx</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN109"><span class='Ref_to_Proto'>setup_regexp_matches</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <span class='Operator'>&</span><a href="regexp.c.html#LN1209"><span class='Ref_To_Local'>re_flags</span></a><span class='Delimiter'>, 
</span>                                    <a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>()</span><span class='Delimiter'>, 
</span>                                    <span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1210"><span class='Ref_To_Local'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a> <span class='Operator'>&LT;= </span><a href="regexp.c.html#LN1210"><span class='Ref_To_Local'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN54"><span class='Ref_to_Member'>nmatches</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regexp.c.html#LN1208"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1208"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, 
</span>                                  <a href="regexp.c.html#LN116"><span class='Ref_to_Proto'>build_regexp_split_result</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1210"><span class='Ref_To_Local'>splitctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                  <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                  <a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="regexp.c.html#LN1210"><span class='Ref_To_Local'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't call cleanup_regexp_matches here; it would try to pfree the 
     * input string, which we didn't copy.  The space is not in a long-lived 
     * memory context anyway. 
     */ 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN394"><span class='Ref_to_Proto'>makeArrayResult</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1208"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end regexp_split_to_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* This is separate to keep the opr_sanity regression test from complaining */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1249"></a><span class='Declare_Function'>regexp_split_to_array_no_flags</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="regexp.c.html#LN1205"><span class='Ref_to_Func'>regexp_split_to_array</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * build_regexp_split_result - build output string for current match 
 * 
 * We return the string between the current match and the previous one, 
 * or the string after the last match when next_match == nmatches. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1261"></a><span class='Declare_Function'>build_regexp_split_result</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN51"><span class='Ref_to_Struct'>regexp_matches_ctx</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>splitctx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1263"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>startpos</span><span class='Delimiter'>; 
</span><a name="LN1264"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>endpos</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1261"><span class='Ref_to_Parameter'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="regexp.c.html#LN1263"><span class='Ref_To_Local'>startpos</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN1261"><span class='Ref_to_Parameter'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1261"><span class='Ref_to_Parameter'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>    <span class='Control'>else</span> 
        <a href="regexp.c.html#LN1263"><span class='Ref_To_Local'>startpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1263"><span class='Ref_To_Local'>startpos</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid match ending position"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1261"><span class='Ref_to_Parameter'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a> <span class='Operator'>&LT; </span><a href="regexp.c.html#LN1261"><span class='Ref_to_Parameter'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN54"><span class='Ref_to_Member'>nmatches</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="regexp.c.html#LN1264"><span class='Ref_To_Local'>endpos</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN1261"><span class='Ref_to_Parameter'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN58"><span class='Ref_to_Member'>match_locs</span></a><span class='Delimiter'>[</span><a href="regexp.c.html#LN1261"><span class='Ref_to_Parameter'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN59"><span class='Ref_to_Member'>next_match</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1264"><span class='Ref_To_Local'>endpos</span></a> <span class='Operator'>&LT; </span><a href="regexp.c.html#LN1263"><span class='Ref_To_Local'>startpos</span></a><span class='Parentheses'>) 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid match starting position"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN587"><span class='Ref_to_Macro'>DirectFunctionCall3</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN779"><span class='Ref_to_Func'>text_substr</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1261"><span class='Ref_to_Parameter'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN53"><span class='Ref_to_Member'>orig_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1263"><span class='Ref_To_Local'>startpos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1264"><span class='Ref_To_Local'>endpos</span></a> <span class='Operator'>- </span><a href="regexp.c.html#LN1263"><span class='Ref_To_Local'>startpos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* no more matches, return rest of string */ 
</span>        <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN793"><span class='Ref_to_Func'>text_substr_no_len</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1261"><span class='Ref_to_Parameter'>splitctx</span></a><span class='Operator'>-&GT;</span><a href="regexp.c.html#LN53"><span class='Ref_to_Member'>orig_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                   <a href="../../../include/postgres.h.html#LN484"><span class='Ref_to_Macro'>Int32GetDatum</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1263"><span class='Ref_To_Local'>startpos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end build_regexp_split_result &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * regexp_fixed_prefix - extract fixed prefix, if any, for a regexp 
 * 
 * The result is NULL if there is no fixed prefix, else a palloc'd string. 
 * If it is an exact match, not just a prefix, *exact is returned as TRUE. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1299"></a><span class='Declare_Function'>regexp_fixed_prefix</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>text_re</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>case_insensitive</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collation</span><span class='Delimiter'>, 
</span><a name="LN1300"></a>                    <span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>exact</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1302"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1303"></a>    <a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>re</span><span class='Delimiter'>; 
</span><a name="LN1304"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cflags</span><span class='Delimiter'>; 
</span><a name="LN1305"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>re_result</span><span class='Delimiter'>; 
</span><a name="LN1306"></a>    <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN1307"></a>    size_t      <span class='Declare_Local'>slen</span><span class='Delimiter'>; 
</span><a name="LN1308"></a>    size_t      <span class='Declare_Local'>maxlen</span><span class='Delimiter'>; 
</span><a name="LN1309"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>errMsg</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
    <span class='Operator'>*</span><a href="regexp.c.html#LN1300"><span class='Ref_to_Parameter'>exact</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* default result */ 
</span> 
    <span class='Comment_Multi_Line'>/* Compile RE */ 
</span>    <a href="regexp.c.html#LN1304"><span class='Ref_To_Local'>cflags</span></a> <span class='Operator'>= </span><a href="../../../include/regex/regex.h.html#LN102"><span class='Ref_to_Const'>REG_ADVANCED</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1299"><span class='Ref_to_Parameter'>case_insensitive</span></a><span class='Parentheses'>) 
</span>        <a href="regexp.c.html#LN1304"><span class='Ref_To_Local'>cflags</span></a> <span class='Operator'>|= </span><a href="../../../include/regex/regex.h.html#LN105"><span class='Ref_to_Const'>REG_ICASE</span></a><span class='Delimiter'>; 
</span> 
    <a href="regexp.c.html#LN1303"><span class='Ref_To_Local'>re</span></a> <span class='Operator'>= </span><a href="regexp.c.html#LN131"><span class='Ref_to_Func'>RE_compile_and_cache</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1299"><span class='Ref_to_Parameter'>text_re</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1304"><span class='Ref_To_Local'>cflags</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1299"><span class='Ref_to_Parameter'>collation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Examine it to see if there's a fixed prefix */ 
</span>    <a href="regexp.c.html#LN1305"><span class='Ref_To_Local'>re_result</span></a> <span class='Operator'>= </span><a href="../../regex/regprefix.c.html#LN44"><span class='Ref_to_Func'>pg_regprefix</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1303"><span class='Ref_To_Local'>re</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regexp.c.html#LN1306"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="regexp.c.html#LN1307"><span class='Ref_To_Local'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="regexp.c.html#LN1305"><span class='Ref_To_Local'>re_result</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/regex/regex.h.html#LN137"><span class='Ref_to_Const'>REG_NOMATCH</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/regex/regex.h.html#LN161"><span class='Ref_to_Const'>REG_PREFIX</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* continue with wchar conversion */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/regex/regex.h.html#LN162"><span class='Ref_to_Const'>REG_EXACT</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="regexp.c.html#LN1300"><span class='Ref_to_Parameter'>exact</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* continue with wchar conversion */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* re failed??? */ 
</span>            <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../regex/regerror.c.html#LN58"><span class='Ref_to_Func'>pg_regerror</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1305"><span class='Ref_To_Local'>re_result</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1303"><span class='Ref_To_Local'>re</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1309"><span class='Ref_To_Local'>errMsg</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN1309"><span class='Ref_To_Local'>errMsg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_REGULAR_EXPRESSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"regular expression failed: %s"</span><span class='Delimiter'>, </span><a href="regexp.c.html#LN1309"><span class='Ref_To_Local'>errMsg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch re_result &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Convert pg_wchar result back to database encoding */ 
</span>    <a href="regexp.c.html#LN1308"><span class='Ref_To_Local'>maxlen</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN535"><span class='Ref_to_Proto'>pg_database_encoding_max_length</span></a><span class='Parentheses'>() </span><span class='Operator'>* </span><a href="regexp.c.html#LN1307"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN1302"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1308"><span class='Ref_To_Local'>maxlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="regexp.c.html#LN1307"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN514"><span class='Ref_to_Proto'>pg_wchar2mb_with_len</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1306"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1302"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="regexp.c.html#LN1307"><span class='Ref_To_Local'>slen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="regexp.c.html#LN1307"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>&LT; </span><a href="regexp.c.html#LN1308"><span class='Ref_To_Local'>maxlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/snowball/header.h.html#LN64"><span class='Ref_to_Macro'>free</span></a><span class='Parentheses'>(</span><a href="regexp.c.html#LN1306"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="regexp.c.html#LN1302"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end regexp_fixed_prefix &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>