<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\timestamp.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\timestamp.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:54 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * timestamp.c 
 *    Functions for the built-in SQL types "timestamp" and "interval". 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/timestamp.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;math.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;float.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;sys/time.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/int128.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/makefuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/scansup.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datetime.h"</span> 
 
<span class='Comment_Multi_Line'>/* 
 * gcc's -ffast-math switch breaks routines that expect exact results from 
 * expressions like timeval / SECS_PER_HOUR, where timeval is double. 
 */ 
</span><span class='Directive'>#ifdef</span> __FAST_MATH__ 
#error <span class='Operator'>-</span>ffast<span class='Operator'>-</span>math is known to <span class='Control'>break</span> <span class='Keyword'>this </span>code 
<span class='Directive'>#endif</span> 
 
<a name="LN45"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SAMESIGN</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span>   <span class='Parentheses'>(((</span><a href="timestamp.c.html#LN45"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN45"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* Set at postmaster start */ 
</span><a name="LN48"></a><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Var'>PgStartTime</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* Set at configuration reload */ 
</span><a name="LN51"></a><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Var'>PgReloadTime</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN55"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Member'>current</span><span class='Delimiter'>; 
</span><a name="LN56"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Member'>finish</span><span class='Delimiter'>; 
</span><a name="LN57"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Member'>step</span><span class='Delimiter'>; 
</span><a name="LN58"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>step_sign</span><span class='Delimiter'>; 
</span><a name="LN59"></a>} <span class='Declare_Typedef'>generate_series_timestamp_fctx</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN63"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Member'>current</span><span class='Delimiter'>; 
</span><a name="LN64"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Member'>finish</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Member'>step</span><span class='Delimiter'>; 
</span><a name="LN66"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>step_sign</span><span class='Delimiter'>; 
</span><a name="LN67"></a>} <span class='Declare_Typedef'>generate_series_timestamptz_fctx</span><span class='Delimiter'>; 
</span> 
 
<a name="LN70"></a><span class='Keyword'>static </span><a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a> <span class='Declare_Prototype'>time2t</span><span class='Parentheses'>(</span><span class='Keyword'>const int </span><span class='Declare_Parameter'>hour</span><span class='Delimiter'>, </span><span class='Keyword'>const int </span><span class='Declare_Parameter'>min</span><span class='Delimiter'>, </span><span class='Keyword'>const int </span><span class='Declare_Parameter'>sec</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN71"></a><span class='Keyword'>static </span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Prototype'>dt2local</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Parameter'>dt</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>timezone</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN72"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AdjustTimestampForTypmod</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>time</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN73"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>AdjustIntervalForTypmod</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>interval</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN74"></a><span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Prototype'>timestamp2timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Parameter'>timestamp</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN75"></a><span class='Keyword'>static </span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Prototype'>timestamptz2timestamp</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>timestamp</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* common code for timestamptypmodin and timestamptztypmodin */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN80"></a><span class='Declare_Function'>anytimestamp_typmodin</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>istz</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ta</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN82"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tl</span><span class='Delimiter'>; 
</span><a name="LN83"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN82"><span class='Ref_To_Local'>tl</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN198"><span class='Ref_to_Func'>ArrayGetIntegerTypmods</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN80"><span class='Ref_to_Parameter'>ta</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN83"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * we're not too tense about good error message here because grammar 
     * shouldn't allow wrong number of modifiers for TIMESTAMP 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN83"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid type modifier"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/timestamp.h.html#LN67"><span class='Ref_to_Proto'>anytimestamp_typmod_check</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN80"><span class='Ref_to_Parameter'>istz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN82"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* exported so parse_expr.c can use it */ 
</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN101"></a><span class='Declare_Function'>anytimestamp_typmod_check</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>istz</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN101"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"TIMESTAMP(%d)%s precision must not be negative"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN101"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN101"><span class='Ref_to_Parameter'>istz</span></a> <span class='Operator'>? </span><span class='String'>" WITH TIME ZONE"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN101"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>           <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"TIMESTAMP(%d)%s precision reduced to maximum allowed, %d"</span><span class='Delimiter'>, 
</span>                  <a href="timestamp.c.html#LN101"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN101"><span class='Ref_to_Parameter'>istz</span></a> <span class='Operator'>? </span><span class='String'>" WITH TIME ZONE"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN101"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>= </span><a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN101"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end anytimestamp_typmod_check &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* common code for timestamptypmodout and timestamptztypmodout */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN123"></a><span class='Declare_Function'>anytimestamp_typmodout</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>istz</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN125"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tz</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN123"><span class='Ref_to_Parameter'>istz</span></a> <span class='Operator'>? </span><span class='String'>" with time zone"</span> <span class='Operator'>: </span><span class='String'>" without time zone"</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN123"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"(%d)%s"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="timestamp.c.html#LN123"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN125"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <a href="../../../common/psprintf.c.html#LN44"><span class='Ref_to_Func'>psprintf</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN125"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *   USER I/O ROUTINES                                                       * 
 *****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* timestamp_in() 
 * Convert a string to internal form. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN142"></a><span class='Declare_Function'>timestamp_in</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN144"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
<a name="LN147"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typelem</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN149"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN150"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN151"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN152"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN153"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN152"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN154"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN155"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dtype</span><span class='Delimiter'>; 
</span><a name="LN156"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nf</span><span class='Delimiter'>; 
</span><a name="LN157"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span><a name="LN158"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>field</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>]; 
</span><a name="LN159"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ftype</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>]; 
</span><a name="LN160"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>workbuf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>]; 
</span> 
    <a href="timestamp.c.html#LN157"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN293"><span class='Ref_to_Proto'>ParseDateTime</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN144"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN160"><span class='Ref_To_Local'>workbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN160"><span class='Ref_To_Local'>workbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="timestamp.c.html#LN158"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN159"><span class='Ref_To_Local'>ftype</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN156"><span class='Ref_To_Local'>nf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN157"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN157"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN296"><span class='Ref_to_Proto'>DecodeDateTime</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN158"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN159"><span class='Ref_To_Local'>ftype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN156"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN155"><span class='Ref_To_Local'>dtype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN153"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN151"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN154"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN157"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN3763"><span class='Ref_to_Func'>DateTimeParseError</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN157"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN144"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='String'>"timestamp"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN155"><span class='Ref_To_Local'>dtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN153"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN151"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN150"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range: \"%s\""</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN144"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN149"><span class='Ref_to_Const'>DTK_EPOCH</span></a><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN150"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN71"><span class='Ref_to_Func'>SetEpochTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN148"><span class='Ref_to_Const'>DTK_LATE</span></a><span class='Operator'>: 
</span>            <a href="../../../include/datatype/timestamp.h.html#LN116"><span class='Ref_to_Macro'>TIMESTAMP_NOEND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN150"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN147"><span class='Ref_to_Const'>DTK_EARLY</span></a><span class='Operator'>: 
</span>            <a href="../../../include/datatype/timestamp.h.html#LN111"><span class='Ref_to_Macro'>TIMESTAMP_NOBEGIN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN150"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN145"><span class='Ref_to_Const'>DTK_INVALID</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date/time value \"%s\" is no longer supported"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN144"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/datatype/timestamp.h.html#LN116"><span class='Ref_to_Macro'>TIMESTAMP_NOEND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN150"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected dtype %d while parsing timestamp \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="timestamp.c.html#LN155"><span class='Ref_To_Local'>dtype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN144"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/datatype/timestamp.h.html#LN116"><span class='Ref_to_Macro'>TIMESTAMP_NOEND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN150"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch dtype &raquo; </span> 
 
    <a href="timestamp.c.html#LN72"><span class='Ref_to_Proto'>AdjustTimestampForTypmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN150"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN149"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN150"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_in &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamp_out() 
 * Convert a timestamp to external form. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN213"></a><span class='Declare_Function'>timestamp_out</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN215"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN216"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN217"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN218"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN217"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN219"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN220"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN215"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN194"><span class='Ref_to_Func'>EncodeSpecialTimestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN215"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN220"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN215"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN218"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN219"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN315"><span class='Ref_to_Proto'>EncodeDateTime</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN218"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN219"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN106"><span class='Ref_to_Global_Var'>DateStyle</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN220"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN216"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN220"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN216"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_out &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      timestamp_recv          - converts external binary format to timestamp 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN239"></a><span class='Declare_Function'>timestamp_recv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN241"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
<a name="LN244"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typelem</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN246"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN247"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span><span class='Delimiter'>; 
</span><a name="LN248"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN249"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN248"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN250"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN247"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a><span class='Parentheses'>) </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN241"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* range check: see if timestamp_out would like it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN247"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
         <span class='Comment_Multi_Line'>/* ok */ </span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN247"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN249"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN250"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>             <span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN247"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN72"><span class='Ref_to_Proto'>AdjustTimestampForTypmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN247"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN246"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN247"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_recv &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      timestamp_send          - converts timestamp to binary format 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN272"></a><span class='Declare_Function'>timestamp_send</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN274"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN275"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN275"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN275"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN274"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN275"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN283"></a><span class='Declare_Function'>timestamptypmodin</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN285"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ta</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN79"><span class='Ref_to_Func'>anytimestamp_typmodin</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN285"><span class='Ref_To_Local'>ta</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN291"></a><span class='Declare_Function'>timestamptypmodout</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN293"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN122"><span class='Ref_to_Func'>anytimestamp_typmodout</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN293"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* timestamp_transform() 
 * Flatten calls to timestamp_scale() and timestamptz_scale() that solely 
 * represent increases in allowed precision. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN304"></a><span class='Declare_Function'>timestamp_transform</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/datetime.h.html#LN332"><span class='Ref_to_Proto'>TemporalTransform</span></a><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* timestamp_scale() 
 * Adjust time type for specified scale factor. 
 * Used by PostgreSQL type system to stuff columns. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN315"></a><span class='Declare_Function'>timestamp_scale</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN317"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN318"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN319"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN319"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN317"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN72"><span class='Ref_to_Proto'>AdjustTimestampForTypmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN319"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN318"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN319"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * AdjustTimestampForTypmod --- round off a timestamp to suit given typmod 
 * Works for either timestamp or timestamptz. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN333"></a><span class='Declare_Function'>AdjustTimestampForTypmod</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>time</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN335"></a>    <span class='Keyword'>static const </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Local'>TimestampScales</span><span class='Delimiter'>[</span><a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>100000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>10000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>}; 
</span> 
<a name="LN345"></a>    <span class='Keyword'>static const </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Local'>TimestampOffsets</span><span class='Delimiter'>[</span><a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>500000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>50000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>5000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>500</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>50</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>time</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>!= </span><a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp(%d) precision must be between %d and %d"</span><span class='Delimiter'>, 
</span>                         <a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN52"><span class='Ref_to_Const'>MAX_TIMESTAMP_PRECISION</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>time</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Operator'>*</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>time</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN345"><span class='Ref_To_Local'>TimestampOffsets</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="timestamp.c.html#LN335"><span class='Ref_To_Local'>TimestampScales</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>* 
</span>                <a href="timestamp.c.html#LN335"><span class='Ref_To_Local'>TimestampScales</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>time</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((((</span><span class='Operator'>-*</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>time</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="timestamp.c.html#LN345"><span class='Ref_To_Local'>TimestampOffsets</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>/ </span><a href="timestamp.c.html#LN335"><span class='Ref_To_Local'>TimestampScales</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
                      <span class='Operator'>* </span><a href="timestamp.c.html#LN335"><span class='Ref_To_Local'>TimestampScales</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN333"><span class='Ref_to_Parameter'>typmod</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !TIMESTAMP_NOT_FINITE... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AdjustTimestampForTypmod &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* timestamptz_in() 
 * Convert a string to internal form. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN382"></a><span class='Declare_Function'>timestamptz_in</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN384"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
<a name="LN387"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typelem</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN389"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN390"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN391"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN392"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN393"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN392"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN394"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN395"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dtype</span><span class='Delimiter'>; 
</span><a name="LN396"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nf</span><span class='Delimiter'>; 
</span><a name="LN397"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span><a name="LN398"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>field</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>]; 
</span><a name="LN399"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ftype</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>]; 
</span><a name="LN400"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>workbuf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>]; 
</span> 
    <a href="timestamp.c.html#LN397"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN293"><span class='Ref_to_Proto'>ParseDateTime</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN384"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN400"><span class='Ref_To_Local'>workbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN400"><span class='Ref_To_Local'>workbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                          <a href="timestamp.c.html#LN398"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN399"><span class='Ref_To_Local'>ftype</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN396"><span class='Ref_To_Local'>nf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN397"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN397"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN296"><span class='Ref_to_Proto'>DecodeDateTime</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN398"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN399"><span class='Ref_To_Local'>ftype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN396"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN395"><span class='Ref_To_Local'>dtype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN393"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN391"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN394"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN397"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="datetime.c.html#LN3763"><span class='Ref_to_Func'>DateTimeParseError</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN397"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN384"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='String'>"timestamp with time zone"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN395"><span class='Ref_To_Local'>dtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN139"><span class='Ref_to_Const'>DTK_DATE</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN393"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN391"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN394"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN390"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range: \"%s\""</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN384"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN149"><span class='Ref_to_Const'>DTK_EPOCH</span></a><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN390"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN71"><span class='Ref_to_Func'>SetEpochTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN148"><span class='Ref_to_Const'>DTK_LATE</span></a><span class='Operator'>: 
</span>            <a href="../../../include/datatype/timestamp.h.html#LN116"><span class='Ref_to_Macro'>TIMESTAMP_NOEND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN390"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN147"><span class='Ref_to_Const'>DTK_EARLY</span></a><span class='Operator'>: 
</span>            <a href="../../../include/datatype/timestamp.h.html#LN111"><span class='Ref_to_Macro'>TIMESTAMP_NOBEGIN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN390"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN145"><span class='Ref_to_Const'>DTK_INVALID</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date/time value \"%s\" is no longer supported"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN384"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/datatype/timestamp.h.html#LN116"><span class='Ref_to_Macro'>TIMESTAMP_NOEND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN390"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected dtype %d while parsing timestamptz \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="timestamp.c.html#LN395"><span class='Ref_To_Local'>dtype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN384"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/datatype/timestamp.h.html#LN116"><span class='Ref_to_Macro'>TIMESTAMP_NOEND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN390"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch dtype &raquo; </span> 
 
    <a href="timestamp.c.html#LN72"><span class='Ref_to_Proto'>AdjustTimestampForTypmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN390"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN389"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN390"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz_in &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Try to parse a timezone specification, and return its timezone offset value 
 * if it's acceptable.  Otherwise, an error is thrown. 
 * 
 * Note: some code paths update tm-&GT;tm_isdst, and some don't; current callers 
 * don't care, so we don't bother being consistent. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN457"></a><span class='Declare_Function'>parse_sane_timezone</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>zone</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN459"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tzname</span><span class='Delimiter'>[</span><a href="../../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN460"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rt</span><span class='Delimiter'>; 
</span><a name="LN461"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/builtins.h.html#LN88"><span class='Ref_to_Proto'>text_to_cstring_buffer</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN457"><span class='Ref_to_Parameter'>zone</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the requested timezone.  First we try to interpret it as a 
     * numeric timezone specification; if DecodeTimezone decides it doesn't 
     * like the format, we look in the timezone abbreviation table (to handle 
     * cases like "EST"), and if that also fails, we look in the timezone 
     * database (to handle cases like "America/New_York").  (This matches the 
     * order in which timestamp input checks the cases; it's important because 
     * the timezone database unwisely uses a few zone names that are identical 
     * to offset abbreviations.) 
     * 
     * Note pg_tzset happily parses numeric input that DecodeTimezone would 
     * reject.  To avoid having it accept input that would otherwise be seen 
     * as invalid, it's enough to disallow having a digit in the first 
     * position of our input string. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>isdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for numeric time zone: \"%s\""</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Numeric time zones must have \"-\" or \"+\" as first character."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN460"><span class='Ref_To_Local'>rt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN299"><span class='Ref_to_Proto'>DecodeTimezone</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN461"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN460"><span class='Ref_To_Local'>rt</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN490"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lowzone</span><span class='Delimiter'>; 
</span><a name="LN491"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN492"></a>                    <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN493"></a>        <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tzp</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN460"><span class='Ref_To_Local'>rt</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN29"><span class='Ref_to_Const'>DTERR_TZDISP_OVERFLOW</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"numeric time zone \"%s\" out of range"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN460"><span class='Ref_To_Local'>rt</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone \"%s\" not recognized"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* DecodeTimezoneAbbrev requires lowercase input */ 
</span>        <a href="timestamp.c.html#LN490"><span class='Ref_To_Local'>lowzone</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, 
</span>                                               strlen<span class='Parentheses'>(</span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN491"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN325"><span class='Ref_to_Proto'>DecodeTimezoneAbbrev</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN490"><span class='Ref_To_Local'>lowzone</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN492"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN493"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN491"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a> <span class='Operator'>|| </span><a href="timestamp.c.html#LN491"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN95"><span class='Ref_to_Const'>DTZ</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* fixed-offset abbreviation */ 
</span>            <a href="timestamp.c.html#LN461"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN492"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN491"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN96"><span class='Ref_to_Const'>DYNTZ</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* dynamic-offset abbreviation, resolve using specified time */ 
</span>            <a href="timestamp.c.html#LN461"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN312"><span class='Ref_to_Proto'>DetermineTimeZoneAbbrevOffset</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN457"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN493"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* try it as a full zone name */ 
</span>            <a href="timestamp.c.html#LN493"><span class='Ref_To_Local'>tzp</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN493"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>) 
</span>                <a href="timestamp.c.html#LN461"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN457"><span class='Ref_to_Parameter'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN493"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone \"%s\" not recognized"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN459"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if rt!=0 &raquo; </span> 
 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN461"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_sane_timezone &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_timestamp_internal 
 *      workhorse for make_timestamp and make_timestamptz 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> 
<a name="LN541"></a><span class='Declare_Function'>make_timestamp_internal</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>year</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>month</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>day</span><span class='Delimiter'>, 
</span><a name="LN542"></a>                        <span class='Keyword'>int </span><span class='Declare_Parameter'>hour</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>min</span><span class='Delimiter'>, </span><span class='Keyword'>double </span><span class='Declare_Parameter'>sec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN544"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN545"></a>    <a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a>  <span class='Declare_Local'>date</span><span class='Delimiter'>; 
</span><a name="LN546"></a>    <a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a>  <span class='Declare_Local'>time</span><span class='Delimiter'>; 
</span><a name="LN547"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span><a name="LN548"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>month</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>day</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: we'll reject zero or negative year values.  Perhaps negatives 
     * should be allowed to represent BC years? 
     */ 
</span>    <a href="timestamp.c.html#LN547"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN322"><span class='Ref_to_Proto'>ValidateDate</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN186"><span class='Ref_to_Const'>DTK_DATE_M</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN547"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_FIELD_OVERFLOW<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date field value out of range: %d-%02d-%02d"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>day</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN154"><span class='Ref_to_Macro'>IS_VALID_JULIAN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date out of range: %d-%02d-%02d"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>day</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN545"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN544"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * This should match the checks in DecodeTimeOnly, except that since we're 
     * dealing with a float "sec" value, we also explicitly reject NaN.  (An 
     * infinity input should get rejected by the range comparisons, but we 
     * can't be sure how those will treat a NaN.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>hour</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a> <span class='Operator'>- </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        <a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>sec</span></a><span class='Parentheses'>)</span> <span class='Operator'>|| 
</span>        <a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>sec</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a> <span class='Operator'>|| 
</span>        <a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>hour</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>|| 
</span>    <span class='Comment_Multi_Line'>/* test for &GT; 24:00:00 */ 
</span>        <span class='Parentheses'>(</span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>hour</span></a> <span class='Operator'>== </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>sec</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_FIELD_OVERFLOW<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time field value out of range: %d:%02d:%02g"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>hour</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>min</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>sec</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This should match tm2time */ 
</span>    <a href="timestamp.c.html#LN546"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>(((</span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>hour</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>min</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Parentheses'>)</span> 
            <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>sec</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN548"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN545"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN546"><span class='Ref_To_Local'>time</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* check for major overflow */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="timestamp.c.html#LN548"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN546"><span class='Ref_To_Local'>time</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a> <span class='Operator'>!= </span><a href="timestamp.c.html#LN545"><span class='Ref_To_Local'>date</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range: %d-%02d-%02d %d:%02d:%02g"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>day</span></a><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>hour</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>min</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>sec</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check for just-barely overflow (okay except time-of-day wraps) */ 
</span>    <span class='Comment_Multi_Line'>/* caution: we want to allow 1999-12-31 24:00:00 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="timestamp.c.html#LN548"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN545"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><a href="timestamp.c.html#LN548"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN545"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>&LT; -</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range: %d-%02d-%02d %d:%02d:%02g"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>day</span></a><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>hour</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>min</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>sec</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* final range check catches just-out-of-range timestamps */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN548"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range: %d-%02d-%02d %d:%02d:%02g"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN541"><span class='Ref_to_Parameter'>day</span></a><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>hour</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>min</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN542"><span class='Ref_to_Parameter'>sec</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN548"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_timestamp_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_timestamp() - timestamp constructor 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN629"></a><span class='Declare_Function'>make_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN631"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>year</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN632"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>month</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN633"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>mday</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN634"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>hour</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN635"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>min</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN636"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>sec</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN245"><span class='Ref_to_Macro'>PG_GETARG_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN637"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN637"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN540"><span class='Ref_to_Func'>make_timestamp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN631"><span class='Ref_To_Local'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN632"><span class='Ref_To_Local'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN633"><span class='Ref_To_Local'>mday</span></a><span class='Delimiter'>, 
</span>                                     <a href="timestamp.c.html#LN634"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN635"><span class='Ref_To_Local'>min</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN636"><span class='Ref_To_Local'>sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN637"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * make_timestamptz() - timestamp with time zone constructor 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN649"></a><span class='Declare_Function'>make_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN651"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>year</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN652"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>month</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN653"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>mday</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN654"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>hour</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN655"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>min</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN656"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>sec</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN245"><span class='Ref_to_Macro'>PG_GETARG_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN657"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN657"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN540"><span class='Ref_to_Func'>make_timestamp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN651"><span class='Ref_To_Local'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN652"><span class='Ref_To_Local'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN653"><span class='Ref_To_Local'>mday</span></a><span class='Delimiter'>, 
</span>                                     <a href="timestamp.c.html#LN654"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN655"><span class='Ref_To_Local'>min</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN656"><span class='Ref_To_Local'>sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN657"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Construct a timestamp with time zone. 
 *      As above, but the time zone is specified as seventh argument. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN670"></a><span class='Declare_Function'>make_timestamptz_at_timezone</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN672"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>year</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN673"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>month</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN674"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>mday</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN675"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>hour</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN676"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>min</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN677"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>sec</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN245"><span class='Ref_to_Macro'>PG_GETARG_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN678"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>zone</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>6</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN679"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN680"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span><span class='Delimiter'>; 
</span><a name="LN681"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>; 
</span><a name="LN682"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN683"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN680"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN540"><span class='Ref_to_Func'>make_timestamp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN672"><span class='Ref_To_Local'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN673"><span class='Ref_To_Local'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN674"><span class='Ref_To_Local'>mday</span></a><span class='Delimiter'>, 
</span>                                        <a href="timestamp.c.html#LN675"><span class='Ref_To_Local'>hour</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN676"><span class='Ref_To_Local'>min</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN677"><span class='Ref_To_Local'>sec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN680"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN681"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN683"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN682"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN456"><span class='Ref_to_Func'>parse_sane_timezone</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN681"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN678"><span class='Ref_To_Local'>zone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN679"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN26"><span class='Ref_to_Func'>dt2local</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN680"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><a href="timestamp.c.html#LN682"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN679"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN679"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_timestamptz_at_timezone &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * to_timestamp(double precision) 
 * Convert UNIX epoch to timestamptz. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN710"></a><span class='Declare_Function'>float8_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN712"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>seconds</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN245"><span class='Ref_to_Macro'>PG_GETARG_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN713"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Deal with NaN and infinite inputs ... */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp cannot be NaN"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/isinf.c.html#LN24"><span class='Ref_to_Func'>isinf</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/datatype/timestamp.h.html#LN111"><span class='Ref_to_Macro'>TIMESTAMP_NOBEGIN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN713"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/datatype/timestamp.h.html#LN116"><span class='Ref_to_Macro'>TIMESTAMP_NOEND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN713"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Out of range? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a> <span class='Operator'>&LT; 
</span>            <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN178"><span class='Ref_to_Const'>DATETIME_MIN_JULIAN</span></a> <span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>|| </span><a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a> <span class='Operator'>&GT;= 
</span>            <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN180"><span class='Ref_to_Const'>TIMESTAMP_END_JULIAN</span></a> <span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range: \"%g\""</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Convert UNIX epoch to Postgres epoch */ 
</span>        <a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a> <span class='Operator'>-= </span><span class='Parentheses'>((</span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a> <span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a> <span class='Operator'>= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN713"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN712"><span class='Ref_To_Local'>seconds</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Recheck in case roundoff produces something just out of range */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN713"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range: \"%g\""</span><span class='Delimiter'>, 
</span>                            <a href="../../../include/fmgr.h.html#LN245"><span class='Ref_to_Macro'>PG_GETARG_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN713"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end float8_timestamptz &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamptz_out() 
 * Convert a timestamp to external form. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN760"></a><span class='Declare_Function'>timestamptz_out</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN762"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN763"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN764"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN765"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN766"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN765"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN767"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN768"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tzn</span><span class='Delimiter'>; 
</span><a name="LN769"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN762"><span class='Ref_To_Local'>dt</span></a><span class='Parentheses'>))</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN194"><span class='Ref_to_Func'>EncodeSpecialTimestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN762"><span class='Ref_To_Local'>dt</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN769"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN762"><span class='Ref_To_Local'>dt</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN764"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN766"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN767"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN768"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN315"><span class='Ref_to_Proto'>EncodeDateTime</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN766"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN767"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN764"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN768"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN106"><span class='Ref_to_Global_Var'>DateStyle</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN769"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN763"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN769"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN763"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz_out &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      timestamptz_recv            - converts external binary format to timestamptz 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN788"></a><span class='Declare_Function'>timestamptz_recv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN790"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
<a name="LN793"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typelem</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN795"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN796"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span><span class='Delimiter'>; 
</span><a name="LN797"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN798"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN799"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN798"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN800"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN796"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a><span class='Parentheses'>) </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN790"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* range check: see if timestamptz_out would like it */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN796"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
         <span class='Comment_Multi_Line'>/* ok */ </span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN796"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN797"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN799"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN800"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>             <span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN796"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN72"><span class='Ref_to_Proto'>AdjustTimestampForTypmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN796"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN795"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN796"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz_recv &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      timestamptz_send            - converts timestamptz to binary format 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN822"></a><span class='Declare_Function'>timestamptz_send</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN824"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN825"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN825"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN825"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN824"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN825"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN833"></a><span class='Declare_Function'>timestamptztypmodin</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN835"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ta</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN79"><span class='Ref_to_Func'>anytimestamp_typmodin</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN835"><span class='Ref_To_Local'>ta</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN841"></a><span class='Declare_Function'>timestamptztypmodout</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN843"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN122"><span class='Ref_to_Func'>anytimestamp_typmodout</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN843"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* timestamptz_scale() 
 * Adjust time type for specified scale factor. 
 * Used by PostgreSQL type system to stuff columns. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN854"></a><span class='Declare_Function'>timestamptz_scale</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN856"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN857"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN858"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN858"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN856"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN72"><span class='Ref_to_Proto'>AdjustTimestampForTypmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN858"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN857"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN858"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* interval_in() 
 * Convert a string to internal form. 
 * 
 * External format(s): 
 *  Uses the generic date/time parsing and decoding routines. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN875"></a><span class='Declare_Function'>interval_in</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN877"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
<a name="LN880"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typelem</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN882"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN883"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN884"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN885"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN886"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN885"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN887"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dtype</span><span class='Delimiter'>; 
</span><a name="LN888"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nf</span><span class='Delimiter'>; 
</span><a name="LN889"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>range</span><span class='Delimiter'>; 
</span><a name="LN890"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>dterr</span><span class='Delimiter'>; 
</span><a name="LN891"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>field</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>]; 
</span><a name="LN892"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ftype</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>]; 
</span><a name="LN893"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>workbuf</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; 
</span> 
    <a href="timestamp.c.html#LN886"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN886"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN886"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN886"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN886"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN886"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN884"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN882"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN889"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN53"><span class='Ref_to_Macro'>INTERVAL_RANGE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN882"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="timestamp.c.html#LN889"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN21"><span class='Ref_to_Const'>INTERVAL_FULL_RANGE</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN890"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN293"><span class='Ref_to_Proto'>ParseDateTime</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN877"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN893"><span class='Ref_To_Local'>workbuf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN893"><span class='Ref_To_Local'>workbuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN891"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>, 
</span>                          <a href="timestamp.c.html#LN892"><span class='Ref_To_Local'>ftype</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN197"><span class='Ref_to_Const'>MAXDATEFIELDS</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN888"><span class='Ref_To_Local'>nf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN890"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN890"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN303"><span class='Ref_to_Proto'>DecodeInterval</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN891"><span class='Ref_To_Local'>field</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN892"><span class='Ref_To_Local'>ftype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN888"><span class='Ref_To_Local'>nf</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN889"><span class='Ref_To_Local'>range</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="timestamp.c.html#LN887"><span class='Ref_To_Local'>dtype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN886"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN884"><span class='Ref_To_Local'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if those functions think it's a bad format, try ISO8601 style */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN890"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN25"><span class='Ref_to_Const'>DTERR_BAD_FORMAT</span></a><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN890"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/interval.c.html#LN122"><span class='Ref_to_Func'>DecodeISO8601Interval</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN877"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="timestamp.c.html#LN887"><span class='Ref_To_Local'>dtype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN886"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN884"><span class='Ref_To_Local'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN890"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN890"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN26"><span class='Ref_to_Const'>DTERR_FIELD_OVERFLOW</span></a><span class='Parentheses'>) 
</span>            <a href="timestamp.c.html#LN890"><span class='Ref_To_Local'>dterr</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN28"><span class='Ref_to_Const'>DTERR_INTERVAL_OVERFLOW</span></a><span class='Delimiter'>; 
</span>        <a href="datetime.c.html#LN3763"><span class='Ref_to_Func'>DateTimeParseError</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN890"><span class='Ref_To_Local'>dterr</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN877"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='String'>"interval"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="timestamp.c.html#LN883"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN887"><span class='Ref_To_Local'>dtype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN156"><span class='Ref_to_Const'>DTK_DELTA</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN89"><span class='Ref_to_Proto'>tm2interval</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN886"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN884"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN883"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN145"><span class='Ref_to_Const'>DTK_INVALID</span></a><span class='Operator'>: 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date/time value \"%s\" is no longer supported"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN877"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected dtype %d while parsing interval \"%s\""</span><span class='Delimiter'>, 
</span>                 <a href="timestamp.c.html#LN887"><span class='Ref_To_Local'>dtype</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN877"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="timestamp.c.html#LN73"><span class='Ref_to_Proto'>AdjustIntervalForTypmod</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN883"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN882"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN883"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_in &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* interval_out() 
 * Convert a time span to external form. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN957"></a><span class='Declare_Function'>interval_out</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN959"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN960"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN961"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN962"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN961"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN963"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN964"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN88"><span class='Ref_to_Proto'>interval2tm</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN959"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN962"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN963"><span class='Ref_To_Local'>fsec</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not convert interval to tm"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN316"><span class='Ref_to_Proto'>EncodeInterval</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN962"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN963"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><a href="../init/globals.c.html#LN108"><span class='Ref_to_Global_Var'>IntervalStyle</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN964"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN960"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN964"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN960"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      interval_recv           - converts external binary format to interval 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN979"></a><span class='Declare_Function'>interval_recv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN981"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> NOT_USED 
<a name="LN984"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typelem</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN986"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN987"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN987"><span class='Ref_To_Local'>interval</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN987"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN39"><span class='Ref_to_Proto'>pq_getmsgint64</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN981"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN987"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN981"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN987"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN987"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN38"><span class='Ref_to_Proto'>pq_getmsgint</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN981"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN987"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN73"><span class='Ref_to_Proto'>AdjustIntervalForTypmod</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN987"><span class='Ref_To_Local'>interval</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN986"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN987"><span class='Ref_To_Local'>interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_recv &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      interval_send           - converts interval to binary format 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1004"></a><span class='Declare_Function'>interval_send</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1006"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1007"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1007"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN26"><span class='Ref_to_Proto'>pq_sendint64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1007"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1006"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1007"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1006"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1006"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN25"><span class='Ref_to_Proto'>pq_sendint</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1007"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1006"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1006"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1007"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * The interval typmod stores a "range" in its high 16 bits and a "precision" 
 * in its low 16 bits.  Both contribute to defining the resolution of the 
 * type.  Range addresses resolution granules larger than one second, and 
 * precision specifies resolution below one second.  This representation can 
 * express all SQL standard resolutions, but we implement them all in terms of 
 * truncating rightward from some position.  Range is a bitmap of permitted 
 * fields, but only the temporally-smallest such field is significant to our 
 * calculations.  Precision is a count of sub-second decimal places to retain. 
 * Setting all bits (INTERVAL_FULL_PRECISION) gives the same truncation 
 * semantics as choosing MAX_INTERVAL_PRECISION. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1029"></a><span class='Declare_Function'>intervaltypmodin</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1031"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ta</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1032"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tl</span><span class='Delimiter'>; 
</span><a name="LN1033"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span><a name="LN1034"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN198"><span class='Ref_to_Func'>ArrayGetIntegerTypmods</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1031"><span class='Ref_To_Local'>ta</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1033"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * tl[0] - interval range (fields bitmask)  tl[1] - precision (optional) 
     * 
     * Note we must validate tl[0] even though it's normally guaranteed 
     * correct by the grammar --- consider SELECT 'foo'::"interval"(1000). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1033"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN21"><span class='Ref_to_Const'>INTERVAL_FULL_RANGE</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* all OK */ 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid INTERVAL type modifier"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch tl[0] &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if n&GT;0 &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1033"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN21"><span class='Ref_to_Const'>INTERVAL_FULL_RANGE</span></a><span class='Parentheses'>) 
</span>            <a href="timestamp.c.html#LN1034"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN51"><span class='Ref_to_Macro'>INTERVAL_TYPMOD</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN49"><span class='Ref_to_Const'>INTERVAL_FULL_PRECISION</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="timestamp.c.html#LN1034"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1033"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"INTERVAL(%d) precision must not be negative"</span><span class='Delimiter'>, 
</span>                            <a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>              <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"INTERVAL(%d) precision reduced to maximum allowed, %d"</span><span class='Delimiter'>, 
</span>                     <a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN1034"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN51"><span class='Ref_to_Macro'>INTERVAL_TYPMOD</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="timestamp.c.html#LN1034"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN51"><span class='Ref_to_Macro'>INTERVAL_TYPMOD</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], </span><a href="timestamp.c.html#LN1032"><span class='Ref_To_Local'>tl</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid INTERVAL type modifier"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1034"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1034"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end intervaltypmodin &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1108"></a><span class='Declare_Function'>intervaltypmodout</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1110"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1111"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Number'>64</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1112"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fields</span><span class='Delimiter'>; 
</span><a name="LN1113"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>precision</span><span class='Delimiter'>; 
</span><a name="LN1114"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>fieldstr</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1110"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1111"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1111"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="timestamp.c.html#LN1112"><span class='Ref_To_Local'>fields</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN53"><span class='Ref_to_Macro'>INTERVAL_RANGE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1110"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1113"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN52"><span class='Ref_to_Macro'>INTERVAL_PRECISION</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1110"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1112"><span class='Ref_To_Local'>fields</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" year"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" month"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" day"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" hour"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" minute"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" second"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" year to month"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" day to hour"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" day to minute"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" day to second"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" hour to minute"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" hour to second"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>" minute to second"</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN21"><span class='Ref_to_Const'>INTERVAL_FULL_RANGE</span></a><span class='Operator'>: 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid INTERVAL typmod: 0x%x"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1110"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch fields &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1113"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/timestamp.h.html#LN49"><span class='Ref_to_Const'>INTERVAL_FULL_PRECISION</span></a><span class='Parentheses'>) 
</span>        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1111"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, </span><span class='String'>"%s(%d)"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1113"><span class='Ref_To_Local'>precision</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../pl/plperl/plperl.h.html#LN60"><span class='Ref_to_Macro'>snprintf</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1111"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>, </span><span class='Number'>64</span><span class='Delimiter'>, </span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1114"><span class='Ref_To_Local'>fieldstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1111"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end intervaltypmodout &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Given an interval typmod value, return a code for the least-significant 
 * field that the typmod allows to be nonzero, for instance given 
 * INTERVAL DAY TO HOUR we want to identify "hour". 
 * 
 * The results should be ordered by field significance, which means 
 * we can't use the dt.h macros YEAR etc, because for some odd reason 
 * they aren't ordered that way.  Instead, arbitrarily represent 
 * SECOND = 0, MINUTE = 1, HOUR = 2, DAY = 3, MONTH = 4, YEAR = 5. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1194"></a><span class='Declare_Function'>intervaltypmodleastfield</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1194"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>               <span class='Comment_Single_Line'>/* SECOND */ 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN53"><span class='Ref_to_Macro'>INTERVAL_RANGE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1194"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>5</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* YEAR */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>4</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* MONTH */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>3</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* DAY */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>2</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* HOUR */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* MINUTE */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* SECOND */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>4</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* MONTH */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>2</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* HOUR */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* MINUTE */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* SECOND */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* MINUTE */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* SECOND */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)</span><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* SECOND */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN21"><span class='Ref_to_Const'>INTERVAL_FULL_RANGE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* SECOND */ 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid INTERVAL typmod: 0x%x"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1194"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch INTERVAL_RANGE(typmod... &raquo; </span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* can't get here, but keep compiler quiet */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end intervaltypmodleastfield &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* interval_transform() 
 * Flatten superfluous calls to interval_scale().  The interval typmod is 
 * complex to permit accepting and regurgitating all SQL standard variations. 
 * For truncation purposes, it boils down to a single, simple granularity. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1243"></a><span class='Declare_Function'>interval_transform</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1245"></a>    <a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>expr</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodes.h.html#LN575"><span class='Ref_to_Macro'>castNode</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN444"><span class='Ref_to_Struct'>FuncExpr</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN1246"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1247"></a>    <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>typmod</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1245"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1247"><span class='Ref_To_Local'>typmod</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN115"><span class='Ref_to_Macro'>lsecond</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1245"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1247"><span class='Ref_To_Local'>typmod</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a><span class='Parentheses'>)</span> <span class='Operator'>&&!</span><span class='Parentheses'>((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="timestamp.c.html#LN1247"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constisnull<span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1255"></a>        <a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>source</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN110"><span class='Ref_to_Macro'>linitial</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1245"><span class='Ref_To_Local'>expr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN455"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1256"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>new_typmod</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(((</span><a href="../../../include/nodes/primnodes.h.html#LN188"><span class='Ref_to_Struct'>Const</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="timestamp.c.html#LN1247"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>constvalue<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1257"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>noop</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1256"><span class='Ref_To_Local'>new_typmod</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="timestamp.c.html#LN1257"><span class='Ref_To_Local'>noop</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1263"></a>            <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>old_typmod</span> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN32"><span class='Ref_to_Proto'>exprTypmod</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1255"><span class='Ref_To_Local'>source</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1264"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>old_least_field</span><span class='Delimiter'>; 
</span><a name="LN1265"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>new_least_field</span><span class='Delimiter'>; 
</span><a name="LN1266"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>old_precis</span><span class='Delimiter'>; 
</span><a name="LN1267"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>new_precis</span><span class='Delimiter'>; 
</span> 
            <a href="timestamp.c.html#LN1264"><span class='Ref_To_Local'>old_least_field</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1193"><span class='Ref_to_Func'>intervaltypmodleastfield</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1263"><span class='Ref_To_Local'>old_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN1265"><span class='Ref_To_Local'>new_least_field</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1193"><span class='Ref_to_Func'>intervaltypmodleastfield</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1256"><span class='Ref_To_Local'>new_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1263"><span class='Ref_To_Local'>old_typmod</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="timestamp.c.html#LN1266"><span class='Ref_To_Local'>old_precis</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN49"><span class='Ref_to_Const'>INTERVAL_FULL_PRECISION</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="timestamp.c.html#LN1266"><span class='Ref_To_Local'>old_precis</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN52"><span class='Ref_to_Macro'>INTERVAL_PRECISION</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1263"><span class='Ref_To_Local'>old_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN1267"><span class='Ref_To_Local'>new_precis</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN52"><span class='Ref_to_Macro'>INTERVAL_PRECISION</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1256"><span class='Ref_To_Local'>new_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Cast is a no-op if least field stays the same or decreases 
             * while precision stays the same or increases.  But precision, 
             * which is to say, sub-second precision, only affects ranges that 
             * include SECOND. 
             */ 
</span>            <a href="timestamp.c.html#LN1257"><span class='Ref_To_Local'>noop</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1265"><span class='Ref_To_Local'>new_least_field</span></a> <span class='Operator'>&LT;= </span><a href="timestamp.c.html#LN1264"><span class='Ref_To_Local'>old_least_field</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1264"><span class='Ref_To_Local'>old_least_field</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Comment_Multi_Line'>/* SECOND */ </span><span class='Operator'>|| 
</span>                 <a href="timestamp.c.html#LN1267"><span class='Ref_To_Local'>new_precis</span></a> <span class='Operator'>&GT;= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a> <span class='Operator'>|| 
</span>                 <a href="timestamp.c.html#LN1267"><span class='Ref_To_Local'>new_precis</span></a> <span class='Operator'>&GT;= </span><a href="timestamp.c.html#LN1266"><span class='Ref_To_Local'>old_precis</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1257"><span class='Ref_To_Local'>noop</span></a><span class='Parentheses'>) 
</span>            <a href="timestamp.c.html#LN1246"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/nodeFuncs.h.html#LN34"><span class='Ref_to_Proto'>relabel_to_typmod</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1255"><span class='Ref_To_Local'>source</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1256"><span class='Ref_To_Local'>new_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if IsA(typmod,Const)&&!(... &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1246"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_transform &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* interval_scale() 
 * Adjust interval type for specified fields. 
 * Used by PostgreSQL type system to stuff columns. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1300"></a><span class='Declare_Function'>interval_scale</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1302"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1303"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>typmod</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1304"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1304"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="timestamp.c.html#LN1304"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= *</span><a href="timestamp.c.html#LN1302"><span class='Ref_To_Local'>interval</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN73"><span class='Ref_to_Proto'>AdjustIntervalForTypmod</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1304"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1303"><span class='Ref_To_Local'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1304"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *  Adjust interval for specified precision, in both YEAR to SECOND 
 *  range and sub-second precision. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1319"></a><span class='Declare_Function'>AdjustIntervalForTypmod</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>interval</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1321"></a>    <span class='Keyword'>static const </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Local'>IntervalScales</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>1000000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>100000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>10000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>}; 
</span> 
<a name="LN1331"></a>    <span class='Keyword'>static const </span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a> <span class='Declare_Local'>IntervalOffsets</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Delimiter'>{ 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>500000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>50000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>5000</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>500</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>50</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>        <a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>}; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unspecified range and precision? Then not necessary to adjust. Setting 
     * typmod to -1 is the convention for all data types. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1347"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>range</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN53"><span class='Ref_to_Macro'>INTERVAL_RANGE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1348"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>precision</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN52"><span class='Ref_to_Macro'>INTERVAL_PRECISION</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Our interpretation of intervals with a limited set of fields is 
         * that fields to the right of the last one specified are zeroed out, 
         * but those to the left of it remain valid.  Thus for example there 
         * is no operational difference between INTERVAL YEAR TO MONTH and 
         * INTERVAL MONTH.  In some cases we could meaningfully enforce that 
         * higher-order fields are zero; for example INTERVAL DAY could reject 
         * nonzero "month" field.  However that seems a bit pointless when we 
         * can't do it consistently.  (We cannot enforce a range limit on the 
         * highest expected field, since we do not have any equivalent of 
         * SQL's &LT;interval leading field precision&GT;.)  If we ever decide to 
         * revisit this, interval_transform will likely require adjusting. 
         * 
         * Note: before PG 8.4 we interpreted a limited set of fields as 
         * actually causing a "modulo" operation on a given value, potentially 
         * losing high-order as well as low-order information.  But there is 
         * no support for such behavior in the standard, and it seems fairly 
         * undesirable on data consistency grounds anyway.  Now we only 
         * perform truncation or rounding of low-order fields. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN21"><span class='Ref_to_Const'>INTERVAL_FULL_RANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Do nothing... */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* YEAR TO MONTH */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN91"><span class='Ref_to_Const'>YEAR</span></a><span class='Parentheses'>) </span><span class='Operator'>| </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN90"><span class='Ref_to_Const'>MONTH</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN91"><span class='Ref_to_Const'>USECS_PER_HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                <a href="../../../include/datatype/timestamp.h.html#LN91"><span class='Ref_to_Const'>USECS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                <a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* fractional-second rounding will be dealt with below */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* DAY TO HOUR */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN91"><span class='Ref_to_Const'>USECS_PER_HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                <a href="../../../include/datatype/timestamp.h.html#LN91"><span class='Ref_to_Const'>USECS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* DAY TO MINUTE */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                <a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* DAY TO SECOND */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN92"><span class='Ref_to_Const'>DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* fractional-second rounding will be dealt with below */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* HOUR TO MINUTE */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>* 
</span>                <a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* HOUR TO SECOND */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN99"><span class='Ref_to_Const'>HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* fractional-second rounding will be dealt with below */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* MINUTE TO SECOND */ 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1347"><span class='Ref_To_Local'>range</span></a> <span class='Operator'>== </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN100"><span class='Ref_to_Const'>MINUTE</span></a><span class='Parentheses'>) </span><span class='Operator'>| 
</span>                           <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN22"><span class='Ref_to_Macro'>INTERVAL_MASK</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN101"><span class='Ref_to_Const'>SECOND</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* fractional-second rounding will be dealt with below */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized interval typmod: %d"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Need to adjust sub-second precision? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/timestamp.h.html#LN49"><span class='Ref_to_Const'>INTERVAL_FULL_PRECISION</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a> <span class='Operator'>&GT; </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval(%d) precision must be between %d and %d"</span><span class='Delimiter'>, 
</span>                          <a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN23"><span class='Ref_to_Const'>MAX_INTERVAL_PRECISION</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>&GT;= </span><a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>+ 
</span>                                   <a href="timestamp.c.html#LN1331"><span class='Ref_To_Local'>IntervalOffsets</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>/ 
</span>                                  <a href="timestamp.c.html#LN1321"><span class='Ref_To_Local'>IntervalScales</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>* 
</span>                    <a href="timestamp.c.html#LN1321"><span class='Ref_To_Local'>IntervalScales</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a><span class='Delimiter'>]; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= -</span><span class='Parentheses'>(((</span><span class='Operator'>-</span><a href="timestamp.c.html#LN1319"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>+ 
</span>                                     <a href="timestamp.c.html#LN1331"><span class='Ref_To_Local'>IntervalOffsets</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>/ 
</span>                                    <a href="timestamp.c.html#LN1321"><span class='Ref_To_Local'>IntervalScales</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span> <span class='Operator'>* 
</span>                                   <a href="timestamp.c.html#LN1321"><span class='Ref_To_Local'>IntervalScales</span></a><span class='Delimiter'>[</span><a href="timestamp.c.html#LN1348"><span class='Ref_To_Local'>precision</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if precision!=INTERVAL_F... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if typmod&GT;=0 &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AdjustIntervalForTypmod &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make_interval - numeric Interval constructor 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1486"></a><span class='Declare_Function'>make_interval</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1488"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>years</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1489"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>months</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1490"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>weeks</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1491"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>days</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1492"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>hours</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1493"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>mins</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>5</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1494"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>secs</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN245"><span class='Ref_to_Macro'>PG_GETARG_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>6</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1495"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Reject out-of-range inputs.  We really ought to check the integer 
     * inputs as well, but it's not entirely clear what limits to apply. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/isinf.c.html#LN24"><span class='Ref_to_Func'>isinf</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1494"><span class='Ref_To_Local'>secs</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1494"><span class='Ref_To_Local'>secs</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1495"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1495"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1488"><span class='Ref_To_Local'>years</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN1489"><span class='Ref_To_Local'>months</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1495"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1490"><span class='Ref_To_Local'>weeks</span></a> <span class='Operator'>* </span><span class='Number'>7</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN1491"><span class='Ref_To_Local'>days</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1494"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1494"><span class='Ref_To_Local'>secs</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1495"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1492"><span class='Ref_To_Local'>hours</span></a> <span class='Operator'>* </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN86"><span class='Ref_to_Const'>SECS_PER_HOUR</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ 
</span>        <a href="timestamp.c.html#LN1493"><span class='Ref_To_Local'>mins</span></a> <span class='Operator'>* </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ 
</span>        <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN1494"><span class='Ref_To_Local'>secs</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1495"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end make_interval &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* EncodeSpecialTimestamp() 
 * Convert reserved timestamp data type to string. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1522"></a><span class='Declare_Function'>EncodeSpecialTimestamp</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Parameter'>dt</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN114"><span class='Ref_to_Macro'>TIMESTAMP_IS_NOBEGIN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1522"><span class='Ref_to_Parameter'>dt</span></a><span class='Parentheses'>))</span> 
        <a href="../../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1522"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN36"><span class='Ref_to_Const'>EARLY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN119"><span class='Ref_to_Macro'>TIMESTAMP_IS_NOEND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1522"><span class='Ref_to_Parameter'>dt</span></a><span class='Parentheses'>))</span> 
        <a href="../../../../contrib/cube/cubeparse.y.html#LN150"><span class='Ref_to_Proto'>strcpy</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1522"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN37"><span class='Ref_to_Const'>LATE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* shouldn't happen */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid argument for EncodeSpecialTimestamp"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1533"></a><span class='Declare_Function'>now</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN340"><span class='Ref_to_Proto'>GetCurrentTransactionStartTimestamp</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1539"></a><span class='Declare_Function'>statement_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN341"><span class='Ref_to_Proto'>GetCurrentStatementStartTimestamp</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1545"></a><span class='Declare_Function'>clock_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN69"><span class='Ref_to_Proto'>GetCurrentTimestamp</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1551"></a><span class='Declare_Function'>pg_postmaster_start_time</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN48"><span class='Ref_to_Global_Var'>PgStartTime</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1557"></a><span class='Declare_Function'>pg_conf_load_time</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN51"><span class='Ref_to_Global_Var'>PgReloadTime</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GetCurrentTimestamp -- get the current operating system time 
 * 
 * Result is in the form of a TimestampTz value, and is expressed to the 
 * full precision of the gettimeofday() syscall 
 */ 
</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> 
<a name="LN1569"></a><span class='Declare_Function'>GetCurrentTimestamp</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1571"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1572"></a>    <span class='Control'>struct</span> timeval <span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span> 
    <a href="../../../port/gettimeofday.c.html#LN103"><span class='Ref_to_Func'>gettimeofday</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1572"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1571"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN1572"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>.</span>tv_sec <span class='Operator'>- 
</span>        <span class='Parentheses'>((</span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a> <span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1571"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1571"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="timestamp.c.html#LN1572"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>.</span>tv_usec<span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN1571"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GetSQLCurrentTimestamp -- implements CURRENT_TIMESTAMP, CURRENT_TIMESTAMP(n) 
 */ 
</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> 
<a name="LN1587"></a><span class='Declare_Function'>GetSQLCurrentTimestamp</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1589"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>ts</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1589"><span class='Ref_To_Local'>ts</span></a> <span class='Operator'>= </span><a href="../../../include/access/xact.h.html#LN340"><span class='Ref_to_Proto'>GetCurrentTransactionStartTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1587"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN72"><span class='Ref_to_Proto'>AdjustTimestampForTypmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1589"><span class='Ref_To_Local'>ts</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1587"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="timestamp.c.html#LN1589"><span class='Ref_To_Local'>ts</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * GetSQLLocalTimestamp -- implements LOCALTIMESTAMP, LOCALTIMESTAMP(n) 
 */ 
</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> 
<a name="LN1601"></a><span class='Declare_Function'>GetSQLLocalTimestamp</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1603"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>ts</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1603"><span class='Ref_To_Local'>ts</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN75"><span class='Ref_to_Proto'>timestamptz2timestamp</span></a><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN340"><span class='Ref_to_Proto'>GetCurrentTransactionStartTimestamp</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1601"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN72"><span class='Ref_to_Proto'>AdjustTimestampForTypmod</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1603"><span class='Ref_To_Local'>ts</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1601"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="timestamp.c.html#LN1603"><span class='Ref_To_Local'>ts</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * TimestampDifference -- convert the difference between two timestamps 
 *      into integer seconds and microseconds 
 * 
 * Both inputs must be ordinary finite timestamps (in current usage, 
 * they'll be results from GetCurrentTimestamp()). 
 * 
 * We expect start_time &LT;= stop_time.  If not, we return zeros; for current 
 * callers there is no need to be tense about which way division rounds on 
 * negative inputs. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1623"></a><span class='Declare_Function'>TimestampDifference</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>start_time</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>stop_time</span><span class='Delimiter'>, 
</span><a name="LN1624"></a>                    <span class='Keyword'>long </span><span class='Operator'>*</span><span class='Declare_Parameter'>secs</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>microsecs</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1626"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>diff</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN1623"><span class='Ref_to_Parameter'>stop_time</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN1623"><span class='Ref_to_Parameter'>start_time</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1626"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1624"><span class='Ref_to_Parameter'>secs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1624"><span class='Ref_to_Parameter'>microsecs</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1624"><span class='Ref_to_Parameter'>secs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>long</span><span class='Parentheses'>) (</span><a href="timestamp.c.html#LN1626"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1624"><span class='Ref_to_Parameter'>microsecs</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="timestamp.c.html#LN1626"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>% </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * TimestampDifferenceExceeds -- report whether the difference between two 
 *      timestamps is &GT;= a threshold (expressed in milliseconds) 
 * 
 * Both inputs must be ordinary finite timestamps (in current usage, 
 * they'll be results from GetCurrentTimestamp()). 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1648"></a><span class='Declare_Function'>TimestampDifferenceExceeds</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>start_time</span><span class='Delimiter'>, 
</span><a name="LN1649"></a>                           <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>stop_time</span><span class='Delimiter'>, 
</span><a name="LN1650"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>msec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1652"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>diff</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN1649"><span class='Ref_to_Parameter'>stop_time</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN1648"><span class='Ref_to_Parameter'>start_time</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1652"><span class='Ref_To_Local'>diff</span></a> <span class='Operator'>&GT;= </span><a href="timestamp.c.html#LN1650"><span class='Ref_to_Parameter'>msec</span></a> <span class='Operator'>* </span><a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>1000</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Convert a time_t to TimestampTz. 
 * 
 * We do not use time_t internally in Postgres, but this is provided for use 
 * by functions that need to interpret, say, a stat(2) result. 
 * 
 * To avoid having the function's ABI vary depending on the width of time_t, 
 * we declare the argument as pg_time_t, which is cast-compatible with 
 * time_t but always 64 bits wide (unless the platform has no 64-bit type). 
 * This detail should be invisible to callers, at least at source code level. 
 */ 
</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> 
<a name="LN1669"></a><span class='Declare_Function'>time_t_to_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a> <span class='Declare_Parameter'>tm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1671"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1671"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN1669"><span class='Ref_to_Parameter'>tm</span></a> <span class='Operator'>- 
</span>        <span class='Parentheses'>((</span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a> <span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1671"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>*= </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN1671"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Convert a TimestampTz to time_t. 
 * 
 * This too is just marginally useful, but some places need it. 
 * 
 * To avoid having the function's ABI vary depending on the width of time_t, 
 * we declare the result as pg_time_t, which is cast-compatible with 
 * time_t but always 64 bits wide (unless the platform has no 64-bit type). 
 * This detail should be invisible to callers, at least at source code level. 
 */ 
</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a> 
<a name="LN1691"></a><span class='Declare_Function'>timestamptz_to_time_t</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>t</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1693"></a>    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1693"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a><span class='Parentheses'>) (</span><a href="timestamp.c.html#LN1691"><span class='Ref_to_Parameter'>t</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a> <span class='Operator'>+ 
</span>                 <span class='Parentheses'>((</span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a> <span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN1693"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Produce a C-string representation of a TimestampTz. 
 * 
 * This is mostly for use in emitting messages.  The primary difference 
 * from timestamptz_out is that we force the output format to ISO.  Note 
 * also that the result is in a static buffer, not pstrdup'd. 
 */ 
</span><span class='Keyword'>const char </span><span class='Operator'>* 
</span><a name="LN1709"></a><span class='Declare_Function'>timestamptz_to_str</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>t</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1711"></a>    <span class='Keyword'>static char </span><span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN1712"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN1713"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN1714"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN1713"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN1715"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN1716"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tzn</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1709"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>))</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN194"><span class='Ref_to_Func'>EncodeSpecialTimestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1709"><span class='Ref_to_Parameter'>t</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1711"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1709"><span class='Ref_to_Parameter'>t</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1712"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1714"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1715"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1716"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN315"><span class='Ref_to_Proto'>EncodeDateTime</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1714"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1715"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1712"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1716"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN12"><span class='Ref_to_Const'>USE_ISO_DATES</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1711"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../port/strlcpy.c.html#LN43"><span class='Ref_to_Func'>strlcpy</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1711"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"(timestamp out of range)"</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1711"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN1711"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>void 
</span><a name="LN1730"></a><span class='Declare_Function'>dt2time</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Parameter'>jd</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>hour</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>min</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>sec</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1732"></a>    <a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a>  <span class='Declare_Local'>time</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1732"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1730"><span class='Ref_to_Parameter'>jd</span></a><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="timestamp.c.html#LN1730"><span class='Ref_to_Parameter'>hour</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1732"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN91"><span class='Ref_to_Const'>USECS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1732"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN1730"><span class='Ref_to_Parameter'>hour</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN91"><span class='Ref_to_Const'>USECS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="timestamp.c.html#LN1730"><span class='Ref_to_Parameter'>min</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1732"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1732"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN1730"><span class='Ref_to_Parameter'>min</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="timestamp.c.html#LN1730"><span class='Ref_to_Parameter'>sec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1732"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="timestamp.c.html#LN1730"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1732"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN1730"><span class='Ref_to_Parameter'>sec</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span>   <span class='Comment_Single_Line'>/* dt2time() */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * timestamp2tm() - Convert timestamp data type to POSIX time structure. 
 * 
 * Note that year is _not_ 1900-based, but is an explicit full value. 
 * Also, month is one-based, _not_ zero-based. 
 * Returns: 
 *   0 on success 
 *  -1 on out of range 
 * 
 * If attimezone is NULL, the global timezone setting will be used. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1757"></a><span class='Declare_Function'>timestamp2tm</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Parameter'>dt</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>tzn</span><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>attimezone</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1759"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>date</span><span class='Delimiter'>; 
</span><a name="LN1760"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>time</span><span class='Delimiter'>; 
</span><a name="LN1761"></a>    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>utime</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use session timezone if caller asks for default */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>attimezone</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>attimezone</span></a> <span class='Operator'>= </span><a href="../../../timezone/pgtz.c.html#LN27"><span class='Ref_to_Global_Var'>session_timezone</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1760"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>dt</span></a><span class='Delimiter'>; 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN227"><span class='Ref_to_Macro'>TMODULO</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1760"><span class='Ref_To_Local'>time</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1759"><span class='Ref_To_Local'>date</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1760"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>&LT; </span><a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN1760"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1759"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>-= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* add offset to go from J2000 back to standard Julian date */ 
</span>    <a href="timestamp.c.html#LN1759"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Julian day routine does not work for negative Julian days */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1759"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="timestamp.c.html#LN1759"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>&GT; </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a><span class='Parentheses'>) </span>INT_MAX<span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>((</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="timestamp.c.html#LN1759"><span class='Ref_To_Local'>date</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/timestamp.h.html#LN86"><span class='Ref_to_Proto'>dt2time</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1760"><span class='Ref_To_Local'>time</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Done if no TZ conversion wanted */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN35"><span class='Ref_to_Member'>tm_gmtoff</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN36"><span class='Ref_to_Member'>tm_zone</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tzn</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tzn</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the time falls within the range of pg_time_t, use pg_localtime() to 
     * rotate to the local time zone. 
     * 
     * First, convert to an integral timestamp, avoiding possibly 
     * platform-specific roundoff-in-wrong-direction errors, and adjust to 
     * Unix epoch.  Then see if we can convert to pg_time_t without loss. This 
     * coding avoids hardwiring any assumptions about the width of pg_time_t, 
     * so it should behave sanely on machines without int64. 
     */ 
</span>    <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>dt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>dt</span></a> <span class='Operator'>- *</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a> <span class='Operator'>+ 
</span>        <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a> <span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN161"><span class='Ref_to_Const'>UNIX_EPOCH_JDATE</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1761"><span class='Ref_To_Local'>utime</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>dt</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN1761"><span class='Ref_To_Local'>utime</span></a> <span class='Operator'>== </span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>dt</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1812"></a>        <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>*</span><span class='Declare_Local'>tx</span> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN47"><span class='Ref_to_Proto'>pg_localtime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1761"><span class='Ref_To_Local'>utime</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>attimezone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1812"><span class='Ref_To_Local'>tx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>1900</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1812"><span class='Ref_To_Local'>tx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1812"><span class='Ref_To_Local'>tx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1812"><span class='Ref_To_Local'>tx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1812"><span class='Ref_To_Local'>tx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1812"><span class='Ref_To_Local'>tx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1812"><span class='Ref_To_Local'>tx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN35"><span class='Ref_to_Member'>tm_gmtoff</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1812"><span class='Ref_To_Local'>tx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN35"><span class='Ref_to_Member'>tm_gmtoff</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN36"><span class='Ref_to_Member'>tm_zone</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1812"><span class='Ref_To_Local'>tx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN36"><span class='Ref_to_Member'>tm_zone</span></a><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN35"><span class='Ref_to_Member'>tm_gmtoff</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tzn</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tzn</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN36"><span class='Ref_to_Member'>tm_zone</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * When out of range of pg_time_t, treat as GMT 
         */ 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Mark this as *no* time zone available */ 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN34"><span class='Ref_to_Member'>tm_isdst</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN35"><span class='Ref_to_Member'>tm_gmtoff</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN36"><span class='Ref_to_Member'>tm_zone</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tzn</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="timestamp.c.html#LN1757"><span class='Ref_to_Parameter'>tzn</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp2tm &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* tm2timestamp() 
 * Convert a tm structure to a timestamp data type. 
 * Note that year is _not_ 1900-based, but is an explicit full value. 
 * Also, month is one-based, _not_ zero-based. 
 * 
 * Returns -1 on failure (value out of range). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1853"></a><span class='Declare_Function'>tm2timestamp</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>tzp</span><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1855"></a>    <a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a>  <span class='Declare_Local'>date</span><span class='Delimiter'>; 
</span><a name="LN1856"></a>    <a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a>  <span class='Declare_Local'>time</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Prevent overflow in Julian-day routines */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN154"><span class='Ref_to_Macro'>IS_VALID_JULIAN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="timestamp.c.html#LN1855"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1856"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN20"><span class='Ref_to_Func'>time2t</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>fsec</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1855"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN1856"><span class='Ref_To_Local'>time</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* check for major overflow */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN1856"><span class='Ref_To_Local'>time</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a> <span class='Operator'>!= </span><a href="timestamp.c.html#LN1855"><span class='Ref_To_Local'>date</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Comment_Multi_Line'>/* check for just-barely overflow (okay except time-of-day wraps) */ 
</span>    <span class='Comment_Multi_Line'>/* caution: we want to allow 1999-12-31 24:00:00 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN1855"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN1855"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>&LT; -</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tzp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN26"><span class='Ref_to_Func'>dt2local</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>tzp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* final range check catches just-out-of-range timestamps */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="timestamp.c.html#LN1853"><span class='Ref_to_Parameter'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tm2timestamp &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* interval2tm() 
 * Convert an interval data type to a tm structure. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1901"></a><span class='Declare_Function'>interval2tm</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Declare_Parameter'>span</span><span class='Delimiter'>, </span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>fsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1903"></a>    <a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a>  <span class='Declare_Local'>time</span><span class='Delimiter'>; 
</span><a name="LN1904"></a>    <a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a>  <span class='Declare_Local'>tfrac</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>span</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>span</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>% </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>span</span></a><span class='Operator'>.</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1903"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>span</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1903"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN91"><span class='Ref_to_Const'>USECS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1903"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>-= </span><a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN91"><span class='Ref_to_Const'>USECS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1903"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1903"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>-= </span><a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN92"><span class='Ref_to_Const'>USECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1903"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>fsec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1903"><span class='Ref_To_Local'>time</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1901"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1904"><span class='Ref_To_Local'>tfrac</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval2tm &raquo; </span> 
 
<span class='Keyword'>int 
</span><a name="LN1929"></a><span class='Declare_Function'>tm2interval</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>span</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1931"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>total_months</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN1931"><span class='Ref_To_Local'>total_months</span></a> <span class='Operator'>&GT; </span>INT_MAX <span class='Operator'>|| </span><a href="timestamp.c.html#LN1931"><span class='Ref_To_Local'>total_months</span></a> <span class='Operator'>&LT; </span>INT_MIN<span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1931"><span class='Ref_To_Local'>total_months</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>(((((</span><a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>* </span><a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>60</span><span class='Parentheses'>))</span> <span class='Operator'>+ 
</span>                     <a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>60</span><span class='Parentheses'>))</span> <span class='Operator'>+ 
</span>                   <a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN1929"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a> 
<a name="LN1945"></a><span class='Declare_Function'>time2t</span><span class='Parentheses'>(</span><span class='Keyword'>const int </span><span class='Declare_Parameter'>hour</span><span class='Delimiter'>, </span><span class='Keyword'>const int </span><span class='Declare_Parameter'>min</span><span class='Delimiter'>, </span><span class='Keyword'>const int </span><span class='Declare_Parameter'>sec</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a> <span class='Declare_Parameter'>fsec</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(((((</span><a href="timestamp.c.html#LN1945"><span class='Ref_to_Parameter'>hour</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="timestamp.c.html#LN1945"><span class='Ref_to_Parameter'>min</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN1945"><span class='Ref_to_Parameter'>sec</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN1945"><span class='Ref_to_Parameter'>fsec</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> 
<a name="LN1951"></a><span class='Declare_Function'>dt2local</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Parameter'>dt</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>tz</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="timestamp.c.html#LN1951"><span class='Ref_to_Parameter'>dt</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1951"><span class='Ref_to_Parameter'>tz</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="timestamp.c.html#LN1951"><span class='Ref_to_Parameter'>dt</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *   PUBLIC ROUTINES                                                         * 
 *****************************************************************************/ 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1964"></a><span class='Declare_Function'>timestamp_finite</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1966"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN1966"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1972"></a><span class='Declare_Function'>interval_finite</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/*---------------------------------------------------------- 
 *  Relational operators for timestamp. 
 *---------------------------------------------------------*/ 
</span> 
<span class='Keyword'>void 
</span><a name="LN1983"></a><span class='Declare_Function'>GetEpochTime</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>* </span><span class='Declare_Parameter'>tm</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1985"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Operator'>*</span><span class='Declare_Local'>t0</span><span class='Delimiter'>; 
</span><a name="LN1986"></a>    <a href="../../../include/pgtime.h.html#LN22"><span class='Ref_to_Typedef'>pg_time_t</span></a>   <span class='Declare_Local'>epoch</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1985"><span class='Ref_To_Local'>t0</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN48"><span class='Ref_to_Proto'>pg_gmtime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN1986"><span class='Ref_To_Local'>epoch</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1983"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1985"><span class='Ref_To_Local'>t0</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1983"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1985"><span class='Ref_To_Local'>t0</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1983"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1985"><span class='Ref_To_Local'>t0</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1983"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1985"><span class='Ref_To_Local'>t0</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1983"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1985"><span class='Ref_To_Local'>t0</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1983"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN1985"><span class='Ref_To_Local'>t0</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN1983"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><span class='Number'>1900</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN1983"><span class='Ref_to_Parameter'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> 
<a name="LN2002"></a><span class='Declare_Function'>SetEpochTimestamp</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2004"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt</span><span class='Delimiter'>; 
</span><a name="LN2005"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN2006"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN2005"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN92"><span class='Ref_to_Proto'>GetEpochTime</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2006"><span class='Ref_To_Local'>tm</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* we don't bother to test for failure ... */ 
</span>    <a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2006"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2004"><span class='Ref_To_Local'>dt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN2004"><span class='Ref_To_Local'>dt</span></a><span class='Delimiter'>; 
}</span>   <span class='Comment_Single_Line'>/* SetEpochTimestamp() */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * We are currently sharing some code between timestamp and timestamptz. 
 * The comparison functions are among them. - thomas 2001-09-25 
 * 
 *      timestamp_relop - is timestamp1 relop timestamp2 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN2022"></a><span class='Declare_Function'>timestamp_cmp_internal</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Parameter'>dt1</span><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Parameter'>dt2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2022"><span class='Ref_to_Parameter'>dt1</span></a> <span class='Operator'>&LT; </span><a href="timestamp.c.html#LN2022"><span class='Ref_to_Parameter'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN2022"><span class='Ref_to_Parameter'>dt1</span></a> <span class='Operator'>&GT; </span><a href="timestamp.c.html#LN2022"><span class='Ref_to_Parameter'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2028"></a><span class='Declare_Function'>timestamp_eq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2030"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2031"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2030"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2031"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2037"></a><span class='Declare_Function'>timestamp_ne</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2039"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2040"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2039"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2040"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2046"></a><span class='Declare_Function'>timestamp_lt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2048"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2049"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2048"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2049"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2055"></a><span class='Declare_Function'>timestamp_gt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2057"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2058"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2057"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2058"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2064"></a><span class='Declare_Function'>timestamp_le</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2066"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2067"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2066"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2067"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2073"></a><span class='Declare_Function'>timestamp_ge</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2075"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2076"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2075"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2076"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2082"></a><span class='Declare_Function'>timestamp_cmp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2084"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2085"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2084"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2085"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* note: this is used for timestamptz also */ 
</span><span class='Keyword'>static int 
</span><a name="LN2092"></a><span class='Declare_Function'>timestamp_fastcmp</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2094"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>a</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN26"><span class='Ref_to_Macro'>DatumGetTimestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2092"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2095"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>b</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN26"><span class='Ref_to_Macro'>DatumGetTimestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2092"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2094"><span class='Ref_To_Local'>a</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2095"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2101"></a><span class='Declare_Function'>timestamp_sortsupport</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2103"></a>    <a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Local'>ssup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2103"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN106"><span class='Ref_to_Member'>comparator</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2091"><span class='Ref_to_Func'>timestamp_fastcmp</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2110"></a><span class='Declare_Function'>timestamp_hash</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../access/hash/hashfunc.c.html#LN60"><span class='Ref_to_Func'>hashint8</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Cross-type comparison functions for timestamp vs timestamptz 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2121"></a><span class='Declare_Function'>timestamp_eq_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2123"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2124"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2125"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2125"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2123"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2125"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2124"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2133"></a><span class='Declare_Function'>timestamp_ne_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2135"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2136"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2137"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2137"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2135"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2137"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2136"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2145"></a><span class='Declare_Function'>timestamp_lt_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2147"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2148"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2149"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2149"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2147"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2149"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2148"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2157"></a><span class='Declare_Function'>timestamp_gt_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2159"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2160"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2161"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2161"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2159"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2161"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2160"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2169"></a><span class='Declare_Function'>timestamp_le_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2171"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2172"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2173"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2173"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2171"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2173"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2172"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2181"></a><span class='Declare_Function'>timestamp_ge_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2183"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2184"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2185"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2185"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2183"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2185"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2184"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2193"></a><span class='Declare_Function'>timestamp_cmp_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2195"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2196"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2197"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2197"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2195"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2197"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2196"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2205"></a><span class='Declare_Function'>timestamptz_eq_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2207"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2208"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2209"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2209"><span class='Ref_To_Local'>dt2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2208"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2207"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2209"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2217"></a><span class='Declare_Function'>timestamptz_ne_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2219"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2220"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2221"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2221"><span class='Ref_To_Local'>dt2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2220"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2219"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2221"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2229"></a><span class='Declare_Function'>timestamptz_lt_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2231"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2232"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2233"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2233"><span class='Ref_To_Local'>dt2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2232"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2231"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2233"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2241"></a><span class='Declare_Function'>timestamptz_gt_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2243"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2244"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2245"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2245"><span class='Ref_To_Local'>dt2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2244"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2243"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2245"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2253"></a><span class='Declare_Function'>timestamptz_le_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2255"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2256"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2257"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2257"><span class='Ref_To_Local'>dt2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2256"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2255"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2257"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2265"></a><span class='Declare_Function'>timestamptz_ge_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2267"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2268"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2269"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2269"><span class='Ref_To_Local'>dt2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2268"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2267"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2269"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2277"></a><span class='Declare_Function'>timestamptz_cmp_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2279"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2280"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestampVal</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2281"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2281"><span class='Ref_To_Local'>dt2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2280"><span class='Ref_To_Local'>timestampVal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2279"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2281"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *      interval_relop  - is interval1 relop interval2 
 * 
 * Interval comparison is based on converting interval values to a linear 
 * representation expressed in the units of the time field (microseconds, 
 * in the case of integer timestamps) with days assumed to be always 24 hours 
 * and months assumed to be always 30 days.  To avoid overflow, we need a 
 * wider-than-int64 datatype for the linear representation, so use INT128. 
 */ 
</span> 
<span class='Keyword'>static inline </span><a href="../../../include/common/int128.h.html#LN106"><span class='Ref_to_Typedef'>INT128</span></a> 
<a name="LN2300"></a><span class='Declare_Function'>interval_cmp_value</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>interval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2302"></a>    <a href="../../../include/common/int128.h.html#LN106"><span class='Ref_to_Typedef'>INT128</span></a>      <span class='Declare_Local'>span</span><span class='Delimiter'>; 
</span><a name="LN2303"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>dayfraction</span><span class='Delimiter'>; 
</span><a name="LN2304"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>days</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Separate time field into days and dayfraction, then add the month and 
     * day fields to the days part.  We cannot overflow int64 days here. 
     */ 
</span>    <a href="timestamp.c.html#LN2303"><span class='Ref_To_Local'>dayfraction</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2300"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>% </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2304"><span class='Ref_To_Local'>days</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2300"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2304"><span class='Ref_To_Local'>days</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2300"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>* </span><a href="../../../include/c.h.html#LN306"><span class='Ref_to_Macro'>INT64CONST</span></a><span class='Parentheses'>(</span><span class='Number'>30</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2304"><span class='Ref_To_Local'>days</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2300"><span class='Ref_to_Parameter'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Widen dayfraction to 128 bits */ 
</span>    <a href="timestamp.c.html#LN2302"><span class='Ref_To_Local'>span</span></a> <span class='Operator'>= </span><a href="../../../include/common/int128.h.html#LN82"><span class='Ref_to_Func'>int64_to_int128</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2303"><span class='Ref_To_Local'>dayfraction</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Scale up days to microseconds, forming a 128-bit product */ 
</span>    <a href="../../../include/common/int128.h.html#LN60"><span class='Ref_to_Func'>int128_add_int64_mul_int64</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN2302"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2304"><span class='Ref_To_Local'>days</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN2302"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_cmp_value &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN2325"></a><span class='Declare_Function'>interval_cmp_internal</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>interval1</span><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>interval2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2327"></a>    <a href="../../../include/common/int128.h.html#LN106"><span class='Ref_to_Typedef'>INT128</span></a>      <span class='Declare_Local'>span1</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN2299"><span class='Ref_to_Func'>interval_cmp_value</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2325"><span class='Ref_to_Parameter'>interval1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2328"></a>    <a href="../../../include/common/int128.h.html#LN106"><span class='Ref_to_Typedef'>INT128</span></a>      <span class='Declare_Local'>span2</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN2299"><span class='Ref_to_Func'>interval_cmp_value</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2325"><span class='Ref_to_Parameter'>interval2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/common/int128.h.html#LN69"><span class='Ref_to_Func'>int128_compare</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2327"><span class='Ref_To_Local'>span1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2328"><span class='Ref_To_Local'>span2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2334"></a><span class='Declare_Function'>interval_eq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2336"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2337"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2336"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2337"><span class='Ref_To_Local'>interval2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2343"></a><span class='Declare_Function'>interval_ne</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2345"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2346"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2345"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2346"><span class='Ref_To_Local'>interval2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2352"></a><span class='Declare_Function'>interval_lt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2354"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2355"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2354"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2355"><span class='Ref_To_Local'>interval2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2361"></a><span class='Declare_Function'>interval_gt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2363"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2364"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2363"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2364"><span class='Ref_To_Local'>interval2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2370"></a><span class='Declare_Function'>interval_le</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2372"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2373"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2372"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2373"><span class='Ref_To_Local'>interval2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2379"></a><span class='Declare_Function'>interval_ge</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2381"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2382"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2381"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2382"><span class='Ref_To_Local'>interval2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2388"></a><span class='Declare_Function'>interval_cmp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2390"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2391"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2390"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2391"><span class='Ref_To_Local'>interval2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Hashing for intervals 
 * 
 * We must produce equal hashvals for values that interval_cmp_internal() 
 * considers equal.  So, compute the net span the same way it does, 
 * and then hash that. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2404"></a><span class='Declare_Function'>interval_hash</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2406"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2407"></a>    <a href="../../../include/common/int128.h.html#LN106"><span class='Ref_to_Typedef'>INT128</span></a>      <span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN2299"><span class='Ref_to_Func'>interval_cmp_value</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2406"><span class='Ref_To_Local'>interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2408"></a>    <a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a>       <span class='Declare_Local'>span64</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use only the least significant 64 bits for hashing.  The upper 64 bits 
     * seldom add any useful information, and besides we must do it like this 
     * for compatibility with hashes calculated before use of INT128 was 
     * introduced. 
     */ 
</span>    <a href="timestamp.c.html#LN2408"><span class='Ref_To_Local'>span64</span></a> <span class='Operator'>= </span><a href="../../../include/common/int128.h.html#LN92"><span class='Ref_to_Func'>int128_to_int64</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2407"><span class='Ref_To_Local'>span</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../access/hash/hashfunc.c.html#LN60"><span class='Ref_to_Func'>hashint8</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN777"><span class='Ref_to_Macro'>Int64GetDatumFast</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2408"><span class='Ref_To_Local'>span64</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* overlaps_timestamp() --- implements the SQL OVERLAPS operator. 
 * 
 * Algorithm is per SQL spec.  This is much harder than you'd think 
 * because the spec requires us to deliver a non-null answer in some cases 
 * where some of the inputs are null. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2428"></a><span class='Declare_Function'>overlaps_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * The arguments are Timestamps, but we leave them as generic Datums to 
     * avoid unnecessary conversions between value and reference forms --- not 
     * to mention possible dereferences of null pointers. 
     */ 
</span><a name="LN2435"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>ts1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2436"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>te1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2437"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>ts2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2438"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>te2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2439"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ts1IsNull</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2440"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>te1IsNull</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2441"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ts2IsNull</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2442"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>te2IsNull</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN2444"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>TIMESTAMP_GT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>t2</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2054"><span class='Ref_to_Func'>timestamp_gt</span></a><span class='Delimiter'>,</span>t1<span class='Delimiter'>,</span>t2<span class='Parentheses'>))</span> 
<a name="LN2446"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>TIMESTAMP_LT</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>t2</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2045"><span class='Ref_to_Func'>timestamp_lt</span></a><span class='Delimiter'>,</span>t1<span class='Delimiter'>,</span>t2<span class='Parentheses'>))</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If both endpoints of interval 1 are null, the result is null (unknown). 
     * If just one endpoint is null, take ts1 as the non-null one. Otherwise, 
     * take ts1 as the lesser endpoint. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2439"><span class='Ref_To_Local'>ts1IsNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2440"><span class='Ref_To_Local'>te1IsNull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* swap null for non-null */ 
</span>        <a href="timestamp.c.html#LN2435"><span class='Ref_To_Local'>ts1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2436"><span class='Ref_To_Local'>te1</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2440"><span class='Ref_To_Local'>te1IsNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="timestamp.c.html#LN2440"><span class='Ref_To_Local'>te1IsNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2444"><span class='Ref_to_Macro'>TIMESTAMP_GT</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2435"><span class='Ref_To_Local'>ts1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2436"><span class='Ref_To_Local'>te1</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2466"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>tt</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN2435"><span class='Ref_To_Local'>ts1</span></a><span class='Delimiter'>; 
</span> 
            <a href="timestamp.c.html#LN2435"><span class='Ref_To_Local'>ts1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2436"><span class='Ref_To_Local'>te1</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN2436"><span class='Ref_To_Local'>te1</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2466"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Likewise for interval 2. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2441"><span class='Ref_To_Local'>ts2IsNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2442"><span class='Ref_To_Local'>te2IsNull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* swap null for non-null */ 
</span>        <a href="timestamp.c.html#LN2437"><span class='Ref_To_Local'>ts2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2438"><span class='Ref_To_Local'>te2</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2442"><span class='Ref_To_Local'>te2IsNull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="timestamp.c.html#LN2442"><span class='Ref_To_Local'>te2IsNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2444"><span class='Ref_to_Macro'>TIMESTAMP_GT</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2437"><span class='Ref_To_Local'>ts2</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2438"><span class='Ref_To_Local'>te2</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN2486"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>tt</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN2437"><span class='Ref_To_Local'>ts2</span></a><span class='Delimiter'>; 
</span> 
            <a href="timestamp.c.html#LN2437"><span class='Ref_To_Local'>ts2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2438"><span class='Ref_To_Local'>te2</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN2438"><span class='Ref_To_Local'>te2</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2486"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * At this point neither ts1 nor ts2 is null, so we can consider three 
     * cases: ts1 &GT; ts2, ts1 &LT; ts2, ts1 = ts2 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2444"><span class='Ref_to_Macro'>TIMESTAMP_GT</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2435"><span class='Ref_To_Local'>ts1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2437"><span class='Ref_To_Local'>ts2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * This case is ts1 &LT; te2 OR te1 &LT; te2, which may look redundant but 
         * in the presence of nulls it's not quite completely so. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2442"><span class='Ref_To_Local'>te2IsNull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2446"><span class='Ref_to_Macro'>TIMESTAMP_LT</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2435"><span class='Ref_To_Local'>ts1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2438"><span class='Ref_To_Local'>te2</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2440"><span class='Ref_To_Local'>te1IsNull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If te1 is not null then we had ts1 &LT;= te1 above, and we just found 
         * ts1 &GT;= te2, hence te1 &GT;= te2. 
         */ 
</span>        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2446"><span class='Ref_to_Macro'>TIMESTAMP_LT</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2435"><span class='Ref_To_Local'>ts1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2437"><span class='Ref_To_Local'>ts2</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* This case is ts2 &LT; te1 OR te2 &LT; te1 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2440"><span class='Ref_To_Local'>te1IsNull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2446"><span class='Ref_to_Macro'>TIMESTAMP_LT</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2437"><span class='Ref_To_Local'>ts2</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2436"><span class='Ref_To_Local'>te1</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2442"><span class='Ref_To_Local'>te2IsNull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If te2 is not null then we had ts2 &LT;= te2 above, and we just found 
         * ts2 &GT;= te1, hence te2 &GT;= te1. 
         */ 
</span>        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * For ts1 = ts2 the spec says te1 &LT;&GT; te2 OR te1 = te2, which is a 
         * rather silly way of saying "true if both are non-null, else null". 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2440"><span class='Ref_To_Local'>te1IsNull</span></a> <span class='Operator'>|| </span><a href="timestamp.c.html#LN2442"><span class='Ref_To_Local'>te2IsNull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
<span class='Keyword'>#undef </span><a href="timestamp.c.html#LN2444"><span class='Ref_to_Macro'>TIMESTAMP_GT</span></a> 
<span class='Keyword'>#undef </span><a href="timestamp.c.html#LN2446"><span class='Ref_to_Macro'>TIMESTAMP_LT</span></a> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end overlaps_timestamp &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/*---------------------------------------------------------- 
 *  "Arithmetic" operators on date/times. 
 *---------------------------------------------------------*/ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2553"></a><span class='Declare_Function'>timestamp_smaller</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2555"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2556"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2557"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* use timestamp_cmp_internal to be sure this agrees with comparisons */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2555"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2556"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="timestamp.c.html#LN2557"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2555"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="timestamp.c.html#LN2557"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2556"><span class='Ref_To_Local'>dt2</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2557"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2568"></a><span class='Declare_Function'>timestamp_larger</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2570"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2571"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2572"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2570"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2571"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="timestamp.c.html#LN2572"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2570"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="timestamp.c.html#LN2572"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2571"><span class='Ref_To_Local'>dt2</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2572"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2583"></a><span class='Declare_Function'>timestamp_mi</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2585"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2586"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2587"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2587"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2585"><span class='Ref_To_Local'>dt1</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2586"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cannot subtract infinite timestamps"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2587"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2585"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN2586"><span class='Ref_To_Local'>dt2</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2587"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2587"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     *  This is wrong, but removing it breaks a lot of regression tests. 
     *  For example: 
     * 
     *  test=&GT; SET timezone = 'EST5EDT'; 
     *  test=&GT; SELECT 
     *  test-&GT; ('2005-10-30 13:22:00-05'::timestamptz - 
     *  test(&GT;  '2005-10-29 13:22:00-04'::timestamptz); 
     *  ?column? 
     *  ---------------- 
     *   1 day 01:00:00 
     *   (1 row) 
     * 
     *  so adding that to the first timestamp gets: 
     * 
     *   test=&GT; SELECT 
     *   test-&GT; ('2005-10-29 13:22:00-04'::timestamptz + 
     *   test(&GT; ('2005-10-30 13:22:00-05'::timestamptz - 
     *   test(&GT;  '2005-10-29 13:22:00-04'::timestamptz)) at time zone 'EST'; 
     *      timezone 
     *  -------------------- 
     *  2005-10-30 14:22:00 
     *  (1 row) 
     *---------- 
     */ 
</span>    <a href="timestamp.c.html#LN2587"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2699"><span class='Ref_to_Func'>interval_justify_hours</span></a><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2587"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2587"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_mi &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  interval_justify_interval() 
 * 
 *  Adjust interval so 'month', 'day', and 'time' portions are within 
 *  customary bounds.  Specifically: 
 * 
 *      0 &LT;= abs(time) &LT; 24 hours 
 *      0 &LT;= abs(day)  &LT; 30 days 
 * 
 *  Also, the sign bit on all three fields is made equal, so either 
 *  all three fields are negative or all are positive. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2645"></a><span class='Declare_Function'>interval_justify_interval</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2647"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2648"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2649"></a>    <a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a>  <span class='Declare_Local'>wholeday</span><span class='Delimiter'>; 
</span><a name="LN2650"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>wholemonth</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2647"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2647"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2647"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN227"><span class='Ref_to_Macro'>TMODULO</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2649"><span class='Ref_To_Local'>wholeday</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2649"><span class='Ref_To_Local'>wholeday</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* could overflow... */ 
</span> 
    <a href="timestamp.c.html#LN2650"><span class='Ref_To_Local'>wholemonth</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>-= </span><a href="timestamp.c.html#LN2650"><span class='Ref_To_Local'>wholemonth</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2650"><span class='Ref_To_Local'>wholemonth</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>             <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>-= </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>-= </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2648"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_justify_interval &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  interval_justify_hours() 
 * 
 *  Adjust interval so 'time' contains less than a whole day, adding 
 *  the excess to 'day'.  This is useful for 
 *  situations (such as non-TZ) where '1 day' = '24 hours' is valid, 
 *  e.g. interval subtraction and division. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2700"></a><span class='Declare_Function'>interval_justify_hours</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2702"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2703"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2704"></a>    <a href="../../../include/datatype/timestamp.h.html#LN39"><span class='Ref_to_Typedef'>TimeOffset</span></a>  <span class='Declare_Local'>wholeday</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2702"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2702"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2702"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN227"><span class='Ref_to_Macro'>TMODULO</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2704"><span class='Ref_To_Local'>wholeday</span></a><span class='Delimiter'>, </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2704"><span class='Ref_To_Local'>wholeday</span></a><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* could overflow... */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>-= </span><a href="../../../include/datatype/timestamp.h.html#LN90"><span class='Ref_to_Const'>USECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2703"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_justify_hours &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  interval_justify_days() 
 * 
 *  Adjust interval so 'day' contains less than 30 days, adding 
 *  the excess to 'month'. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2735"></a><span class='Declare_Function'>interval_justify_days</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2737"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2738"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2739"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>wholemonth</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2737"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2737"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2737"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2739"><span class='Ref_To_Local'>wholemonth</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>-= </span><a href="timestamp.c.html#LN2739"><span class='Ref_To_Local'>wholemonth</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2739"><span class='Ref_To_Local'>wholemonth</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>-= </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2738"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_justify_days &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamp_pl_interval() 
 * Add an interval to a timestamp data type. 
 * Note that interval has provisions for qualitative year/month and day 
 *  units, so try to do the right thing with them. 
 * To add a month, increment the month, and use the same day of month. 
 * Then, if the next month has fewer days, set the day of month 
 *  to the last day of month. 
 * To add a day, increment the mday, and use the same time of day. 
 * Lastly, add in the "quantitative time". 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2775"></a><span class='Declare_Function'>timestamp_pl_interval</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2777"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2778"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2779"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2777"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="timestamp.c.html#LN2779"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2777"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2778"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2787"></a>            <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN2788"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN2787"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN2789"></a>            <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2777"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2789"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2778"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>% </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>% </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>+ </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* adjust for end of month boundary problems... */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>&GT; </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN12"><span class='Ref_to_Global_Var'>day_tab</span></a><span class='Delimiter'>[</span><a href="../../../timezone/private.h.html#LN142"><span class='Ref_to_Macro'>isleap</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>][</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
                <a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN12"><span class='Ref_to_Global_Var'>day_tab</span></a><span class='Delimiter'>[</span><a href="../../../timezone/private.h.html#LN142"><span class='Ref_to_Macro'>isleap</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>][</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2788"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2789"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2777"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if span-&GT;month!=0 &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2778"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2820"></a>            <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN2821"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN2820"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN2822"></a>            <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN2823"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>julian</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2777"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2821"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2822"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add days by converting to and from Julian */ 
</span>            <a href="timestamp.c.html#LN2823"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2821"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2821"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2821"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="timestamp.c.html#LN2778"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2823"><span class='Ref_To_Local'>julian</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2821"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2821"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2821"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2821"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2822"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2777"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if span-&GT;day!=0 &raquo; </span> 
 
        <a href="timestamp.c.html#LN2777"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2778"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2777"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN2779"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2777"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2779"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_pl_interval &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2854"></a><span class='Declare_Function'>timestamp_mi_interval</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2856"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2857"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2858"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Local'>tspan</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2858"><span class='Ref_To_Local'>tspan</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN2857"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2858"><span class='Ref_To_Local'>tspan</span></a><span class='Operator'>.</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN2857"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2858"><span class='Ref_To_Local'>tspan</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN2857"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2774"><span class='Ref_to_Func'>timestamp_pl_interval</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/timestamp.h.html#LN30"><span class='Ref_to_Macro'>TimestampGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2856"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN2858"><span class='Ref_To_Local'>tspan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* timestamptz_pl_interval() 
 * Add an interval to a timestamp with time zone data type. 
 * Note that interval has provisions for qualitative year/month 
 *  units, so try to do the right thing with them. 
 * To add a month, increment the month, and use the same day of month. 
 * Then, if the next month has fewer days, set the day of month 
 *  to the last day of month. 
 * Lastly, add in the "quantitative time". 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2880"></a><span class='Declare_Function'>timestamptz_pl_interval</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2882"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2883"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2884"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2885"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2882"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="timestamp.c.html#LN2884"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2882"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2883"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2893"></a>            <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN2894"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN2893"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN2895"></a>            <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2882"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2885"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2895"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2883"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&GT; </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>% </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>% </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a> <span class='Operator'>+ </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* adjust for end of month boundary problems... */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>&GT; </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN12"><span class='Ref_to_Global_Var'>day_tab</span></a><span class='Delimiter'>[</span><a href="../../../timezone/private.h.html#LN142"><span class='Ref_to_Macro'>isleap</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>][</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span> 
                <a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN12"><span class='Ref_to_Global_Var'>day_tab</span></a><span class='Delimiter'>[</span><a href="../../../timezone/private.h.html#LN142"><span class='Ref_to_Macro'>isleap</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>][</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="timestamp.c.html#LN2885"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.c.html#LN27"><span class='Ref_to_Global_Var'>session_timezone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2894"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2895"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2885"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2882"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if span-&GT;month!=0 &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2883"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2928"></a>            <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN2929"></a>                       <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN2928"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN2930"></a>            <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN2931"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>julian</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2882"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2885"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2929"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2930"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Add days by converting to and from Julian */ 
</span>            <a href="timestamp.c.html#LN2931"><span class='Ref_To_Local'>julian</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2929"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2929"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2929"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="timestamp.c.html#LN2883"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2931"><span class='Ref_To_Local'>julian</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2929"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2929"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2929"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="timestamp.c.html#LN2885"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2929"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.c.html#LN27"><span class='Ref_to_Global_Var'>session_timezone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2929"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2930"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2885"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN2882"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if span-&GT;day!=0 &raquo; </span> 
 
        <a href="timestamp.c.html#LN2882"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN2883"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2882"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN2884"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2882"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2884"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz_pl_interval &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2964"></a><span class='Declare_Function'>timestamptz_mi_interval</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2966"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2967"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2968"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Local'>tspan</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2968"><span class='Ref_To_Local'>tspan</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN2967"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2968"><span class='Ref_To_Local'>tspan</span></a><span class='Operator'>.</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN2967"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2968"><span class='Ref_To_Local'>tspan</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN2967"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2879"><span class='Ref_to_Func'>timestamptz_pl_interval</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/timestamp.h.html#LN30"><span class='Ref_to_Macro'>TimestampGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2966"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN2968"><span class='Ref_To_Local'>tspan</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2981"></a><span class='Declare_Function'>interval_um</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2983"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2984"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2984"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN2984"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN2983"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* overflow check copied from int4um */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2983"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2984"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2983"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2984"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN2983"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2983"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2984"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2983"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN2984"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN2983"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2983"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2984"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN2983"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2984"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_um &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3010"></a><span class='Declare_Function'>interval_smaller</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3012"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3013"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3014"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* use interval_cmp_internal to be sure this agrees with comparisons */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3012"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3013"><span class='Ref_To_Local'>interval2</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="timestamp.c.html#LN3014"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3012"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="timestamp.c.html#LN3014"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3013"><span class='Ref_To_Local'>interval2</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3014"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3025"></a><span class='Declare_Function'>interval_larger</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3027"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3028"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3029"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3027"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3028"><span class='Ref_To_Local'>interval2</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="timestamp.c.html#LN3029"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3027"><span class='Ref_To_Local'>interval1</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="timestamp.c.html#LN3029"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3028"><span class='Ref_To_Local'>interval2</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3029"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3039"></a><span class='Declare_Function'>interval_pl</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3041"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3042"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3043"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3043"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3043"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3041"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN3042"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* overflow check copied from int4pl */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3041"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3042"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3043"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3041"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3043"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3041"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN3042"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3041"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3042"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3043"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3041"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3043"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3041"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN3042"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3041"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3042"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3043"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3041"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3043"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_pl &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3073"></a><span class='Declare_Function'>interval_mi</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3075"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3076"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3077"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3077"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3077"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3075"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3076"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* overflow check copied from int4mi */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3075"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3076"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3077"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3075"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3077"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3075"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3076"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3075"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3076"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3077"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3075"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3077"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3075"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3076"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3075"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3076"><span class='Ref_To_Local'>span2</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>        <span class='Operator'>!</span><a href="int8.c.html#LN27"><span class='Ref_to_Macro'>SAMESIGN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3077"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3075"><span class='Ref_To_Local'>span1</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3077"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_mi &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  There is no interval_abs():  it is unclear what value to return: 
 *    http://archives.postgresql.org/pgsql-general/2009-10/msg01031.php 
 *    http://archives.postgresql.org/pgsql-general/2009-11/msg00041.php 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3113"></a><span class='Declare_Function'>interval_mul</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3115"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3116"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>factor</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN245"><span class='Ref_to_Macro'>PG_GETARG_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3117"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>month_remainder_days</span><span class='Delimiter'>, 
</span><a name="LN3118"></a>                <span class='Declare_Local'>sec_remainder</span><span class='Delimiter'>, 
</span><a name="LN3119"></a>                <span class='Declare_Local'>result_double</span><span class='Delimiter'>; 
</span><a name="LN3120"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>orig_month</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN3115"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>, 
</span><a name="LN3121"></a>                <span class='Declare_Local'>orig_day</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN3115"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span><a name="LN3122"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3122"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3115"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>* </span><a href="timestamp.c.html#LN3116"><span class='Ref_To_Local'>factor</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a> <span class='Operator'>&GT; </span>INT_MAX <span class='Operator'>|| </span><a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a> <span class='Operator'>&LT; </span>INT_MIN<span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3115"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>* </span><a href="timestamp.c.html#LN3116"><span class='Ref_To_Local'>factor</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/test/expected/pgtypeslib-nan_test.c.html#LN30"><span class='Ref_to_Macro'>isnan</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>        <a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a> <span class='Operator'>&GT; </span>INT_MAX <span class='Operator'>|| </span><a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a> <span class='Operator'>&LT; </span>INT_MIN<span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The above correctly handles the whole-number part of the month and day 
     * products, but we have to do something with any fractional part 
     * resulting when the factor is non-integral.  We cascade the fractions 
     * down to lower units using the conversion factors DAYS_PER_MONTH and 
     * SECS_PER_DAY.  Note we do NOT cascade up, since we are not forced to do 
     * so by the representation.  The user can choose to cascade up later, 
     * using justify_hours and/or justify_days. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fractional months full days into days. 
     * 
     * Floating point calculation are inherently imprecise, so these 
     * calculations are crafted to produce the most reliable result possible. 
     * TSROUND() is needed to more accurately produce whole numbers where 
     * appropriate. 
     */ 
</span>    <a href="timestamp.c.html#LN3117"><span class='Ref_To_Local'>month_remainder_days</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3120"><span class='Ref_To_Local'>orig_month</span></a> <span class='Operator'>* </span><a href="timestamp.c.html#LN3116"><span class='Ref_To_Local'>factor</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3117"><span class='Ref_To_Local'>month_remainder_days</span></a> <span class='Operator'>= </span><a href="../../../include/datatype/timestamp.h.html#LN60"><span class='Ref_to_Macro'>TSROUND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3117"><span class='Ref_To_Local'>month_remainder_days</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3118"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3121"><span class='Ref_To_Local'>orig_day</span></a> <span class='Operator'>* </span><a href="timestamp.c.html#LN3116"><span class='Ref_To_Local'>factor</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+ 
</span>           <a href="timestamp.c.html#LN3117"><span class='Ref_To_Local'>month_remainder_days</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="timestamp.c.html#LN3117"><span class='Ref_To_Local'>month_remainder_days</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3118"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>= </span><a href="../../../include/datatype/timestamp.h.html#LN60"><span class='Ref_to_Macro'>TSROUND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3118"><span class='Ref_To_Local'>sec_remainder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Might have 24:00:00 hours due to rounding, or &GT;24 hours because of time 
     * cascade from months and days.  It might still be &GT;24 if the combination 
     * of cascade and the seconds factor operation itself. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3118"><span class='Ref_To_Local'>sec_remainder</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="timestamp.c.html#LN3118"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3118"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="timestamp.c.html#LN3118"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* cascade units down */ 
</span>    <a href="timestamp.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN3117"><span class='Ref_To_Local'>month_remainder_days</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a> <span class='Operator'>= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3115"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>* </span><a href="timestamp.c.html#LN3116"><span class='Ref_To_Local'>factor</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN3118"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a> <span class='Operator'>&GT; </span><a href="../../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a> <span class='Operator'>|| </span><a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a> <span class='Operator'>&LT; </span><a href="../../../include/c.h.html#LN341"><span class='Ref_to_Const'>PG_INT64_MIN</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN3119"><span class='Ref_To_Local'>result_double</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3122"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_mul &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3190"></a><span class='Declare_Function'>mul_d_interval</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Args are float8 and Interval *, but leave them as generic Datum */ 
</span><a name="LN3193"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>factor</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3194"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3112"><span class='Ref_to_Func'>interval_mul</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3194"><span class='Ref_To_Local'>span</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3193"><span class='Ref_To_Local'>factor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3200"></a><span class='Declare_Function'>interval_div</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3202"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>span</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3203"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>factor</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN245"><span class='Ref_to_Macro'>PG_GETARG_FLOAT8</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3204"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>month_remainder_days</span><span class='Delimiter'>, 
</span><a name="LN3205"></a>                <span class='Declare_Local'>sec_remainder</span><span class='Delimiter'>; 
</span><a name="LN3206"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>orig_month</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN3202"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Delimiter'>, 
</span><a name="LN3207"></a>                <span class='Declare_Local'>orig_day</span> <span class='Operator'>= </span><a href="timestamp.c.html#LN3202"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span><a name="LN3208"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3208"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3203"><span class='Ref_To_Local'>factor</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DIVISION_BY_ZERO<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"division by zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3208"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="timestamp.c.html#LN3202"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>/ </span><a href="timestamp.c.html#LN3203"><span class='Ref_To_Local'>factor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3208"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) (</span><a href="timestamp.c.html#LN3202"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>/ </span><a href="timestamp.c.html#LN3203"><span class='Ref_To_Local'>factor</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Fractional months full days into days.  See comment in interval_mul(). 
     */ 
</span>    <a href="timestamp.c.html#LN3204"><span class='Ref_To_Local'>month_remainder_days</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3206"><span class='Ref_To_Local'>orig_month</span></a> <span class='Operator'>/ </span><a href="timestamp.c.html#LN3203"><span class='Ref_To_Local'>factor</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3208"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3204"><span class='Ref_To_Local'>month_remainder_days</span></a> <span class='Operator'>= </span><a href="../../../include/datatype/timestamp.h.html#LN60"><span class='Ref_to_Macro'>TSROUND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3204"><span class='Ref_To_Local'>month_remainder_days</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3205"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3207"><span class='Ref_To_Local'>orig_day</span></a> <span class='Operator'>/ </span><a href="timestamp.c.html#LN3203"><span class='Ref_To_Local'>factor</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3208"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+ 
</span>           <a href="timestamp.c.html#LN3204"><span class='Ref_To_Local'>month_remainder_days</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="timestamp.c.html#LN3204"><span class='Ref_To_Local'>month_remainder_days</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3205"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>= </span><a href="../../../include/datatype/timestamp.h.html#LN60"><span class='Ref_to_Macro'>TSROUND</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3205"><span class='Ref_To_Local'>sec_remainder</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN811"><span class='Ref_to_Macro'>Abs</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3205"><span class='Ref_To_Local'>sec_remainder</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN3208"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="timestamp.c.html#LN3205"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3205"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>-= </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) (</span><a href="timestamp.c.html#LN3205"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* cascade units down */ 
</span>    <a href="timestamp.c.html#LN3208"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>+= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN3204"><span class='Ref_To_Local'>month_remainder_days</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3208"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>= </span><a href="../../../port/rint.c.html#LN20"><span class='Ref_to_Func'>rint</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3202"><span class='Ref_To_Local'>span</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="timestamp.c.html#LN3203"><span class='Ref_To_Local'>factor</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN3205"><span class='Ref_To_Local'>sec_remainder</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3208"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_div &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * interval_accum, interval_accum_inv, and interval_avg implement the 
 * AVG(interval) aggregate. 
 * 
 * The transition datatype for this aggregate is a 2-element array of 
 * intervals, where the first is the running sum and the second contains 
 * the number of values so far in its 'time' field.  This is a bit ugly 
 * but it beats inventing a specialized datatype for the purpose. 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3252"></a><span class='Declare_Function'>interval_accum</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3254"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3255"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3256"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>transdatums</span><span class='Delimiter'>; 
</span><a name="LN3257"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndatums</span><span class='Delimiter'>; 
</span><a name="LN3258"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Local'>sumX</span><span class='Delimiter'>, 
</span><a name="LN3259"></a>                <span class='Declare_Local'>N</span><span class='Delimiter'>; 
</span><a name="LN3260"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newsum</span><span class='Delimiter'>; 
</span><a name="LN3261"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3254"><span class='Ref_To_Local'>transarray</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="timestamp.c.html#LN3256"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3257"><span class='Ref_To_Local'>ndatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3257"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element interval array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3258"><span class='Ref_To_Local'>sumX</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3256"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3259"><span class='Ref_To_Local'>N</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3256"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3260"><span class='Ref_To_Local'>newsum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3038"><span class='Ref_to_Func'>interval_pl</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN3258"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3255"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3259"><span class='Ref_To_Local'>N</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3256"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3260"><span class='Ref_To_Local'>newsum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3256"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN3259"><span class='Ref_To_Local'>N</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3261"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3256"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                             <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3261"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_accum &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3287"></a><span class='Declare_Function'>interval_combine</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3289"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray1</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3290"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray2</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3291"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>transdatums1</span><span class='Delimiter'>; 
</span><a name="LN3292"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>transdatums2</span><span class='Delimiter'>; 
</span><a name="LN3293"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndatums1</span><span class='Delimiter'>; 
</span><a name="LN3294"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndatums2</span><span class='Delimiter'>; 
</span><a name="LN3295"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Local'>sum1</span><span class='Delimiter'>, 
</span><a name="LN3296"></a>                <span class='Declare_Local'>N1</span><span class='Delimiter'>; 
</span><a name="LN3297"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Local'>sum2</span><span class='Delimiter'>, 
</span><a name="LN3298"></a>                <span class='Declare_Local'>N2</span><span class='Delimiter'>; 
</span> 
<a name="LN3300"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newsum</span><span class='Delimiter'>; 
</span><a name="LN3301"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3289"><span class='Ref_To_Local'>transarray1</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="timestamp.c.html#LN3291"><span class='Ref_To_Local'>transdatums1</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3293"><span class='Ref_To_Local'>ndatums1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3293"><span class='Ref_To_Local'>ndatums1</span></a> <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element interval array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3295"><span class='Ref_To_Local'>sum1</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3291"><span class='Ref_To_Local'>transdatums1</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3296"><span class='Ref_To_Local'>N1</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3291"><span class='Ref_To_Local'>transdatums1</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3290"><span class='Ref_To_Local'>transarray2</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="timestamp.c.html#LN3292"><span class='Ref_To_Local'>transdatums2</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3294"><span class='Ref_To_Local'>ndatums2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3294"><span class='Ref_To_Local'>ndatums2</span></a> <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element interval array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3297"><span class='Ref_To_Local'>sum2</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3292"><span class='Ref_To_Local'>transdatums2</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3298"><span class='Ref_To_Local'>N2</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3292"><span class='Ref_To_Local'>transdatums2</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3300"><span class='Ref_To_Local'>newsum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3038"><span class='Ref_to_Func'>interval_pl</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN3295"><span class='Ref_To_Local'>sum1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                   <a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN3297"><span class='Ref_To_Local'>sum2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3296"><span class='Ref_To_Local'>N1</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN3298"><span class='Ref_To_Local'>N2</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3291"><span class='Ref_To_Local'>transdatums1</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3300"><span class='Ref_To_Local'>newsum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3291"><span class='Ref_To_Local'>transdatums1</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN3296"><span class='Ref_To_Local'>N1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3301"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3291"><span class='Ref_To_Local'>transdatums1</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                             <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3301"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_combine &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3336"></a><span class='Declare_Function'>interval_accum_inv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3338"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3339"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3340"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>transdatums</span><span class='Delimiter'>; 
</span><a name="LN3341"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndatums</span><span class='Delimiter'>; 
</span><a name="LN3342"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Local'>sumX</span><span class='Delimiter'>, 
</span><a name="LN3343"></a>                <span class='Declare_Local'>N</span><span class='Delimiter'>; 
</span><a name="LN3344"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>newsum</span><span class='Delimiter'>; 
</span><a name="LN3345"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3338"><span class='Ref_To_Local'>transarray</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="timestamp.c.html#LN3340"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3341"><span class='Ref_To_Local'>ndatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3341"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element interval array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3342"><span class='Ref_To_Local'>sumX</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3340"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3343"><span class='Ref_To_Local'>N</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3340"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3344"><span class='Ref_To_Local'>newsum</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3072"><span class='Ref_to_Func'>interval_mi</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN3342"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3339"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3343"><span class='Ref_To_Local'>N</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>-= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3340"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3344"><span class='Ref_To_Local'>newsum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3340"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN3343"><span class='Ref_To_Local'>N</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3345"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3340"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, 
</span>                             <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3345"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_accum_inv &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3371"></a><span class='Declare_Function'>interval_avg</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3373"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>transarray</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3374"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>transdatums</span><span class='Delimiter'>; 
</span><a name="LN3375"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndatums</span><span class='Delimiter'>; 
</span><a name="LN3376"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Local'>sumX</span><span class='Delimiter'>, 
</span><a name="LN3377"></a>                <span class='Declare_Local'>N</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3373"><span class='Ref_To_Local'>transarray</span></a><span class='Delimiter'>, 
</span>                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN54"><span class='Ref_to_Const'>INTERVALOID</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'d'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="timestamp.c.html#LN3374"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3375"><span class='Ref_To_Local'>ndatums</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3375"><span class='Ref_To_Local'>ndatums</span></a> <span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"expected 2-element interval array"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3376"><span class='Ref_To_Local'>sumX</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3374"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN3377"><span class='Ref_To_Local'>N</span></a> <span class='Operator'>= *</span><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN28"><span class='Ref_to_Macro'>DatumGetIntervalP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3374"><span class='Ref_To_Local'>transdatums</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* SQL defines AVG of no values to be NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3377"><span class='Ref_To_Local'>N</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3199"><span class='Ref_to_Func'>interval_div</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/timestamp.h.html#LN32"><span class='Ref_to_Macro'>IntervalPGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN3376"><span class='Ref_To_Local'>sumX</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../include/postgres.h.html#LN745"><span class='Ref_to_Func'>Float8GetDatum</span></a><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="timestamp.c.html#LN3377"><span class='Ref_To_Local'>N</span></a><span class='Operator'>.</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_avg &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* timestamp_age() 
 * Calculate time difference while retaining year/month fields. 
 * Note that this does not result in an accurate absolute time span 
 *  since year and month are out of context once the arithmetic 
 *  is done. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3405"></a><span class='Declare_Function'>timestamp_age</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3407"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3408"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3409"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3410"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>, 
</span><a name="LN3411"></a>                <span class='Declare_Local'>fsec1</span><span class='Delimiter'>, 
</span><a name="LN3412"></a>                <span class='Declare_Local'>fsec2</span><span class='Delimiter'>; 
</span><a name="LN3413"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN3414"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN3413"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN3415"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt1</span><span class='Delimiter'>, 
</span><a name="LN3416"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm1</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN3415"><span class='Ref_To_Local'>tt1</span></a><span class='Delimiter'>; 
</span><a name="LN3417"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt2</span><span class='Delimiter'>, 
</span><a name="LN3418"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm2</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN3417"><span class='Ref_To_Local'>tt2</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3409"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3407"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3416"><span class='Ref_To_Local'>tm1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3411"><span class='Ref_To_Local'>fsec1</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3408"><span class='Ref_To_Local'>dt2</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3418"><span class='Ref_To_Local'>tm2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3412"><span class='Ref_To_Local'>fsec2</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* form the symbolic difference */ 
</span>        <a href="timestamp.c.html#LN3410"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3411"><span class='Ref_To_Local'>fsec1</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3412"><span class='Ref_To_Local'>fsec2</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3416"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3418"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3416"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3418"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3416"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3418"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3416"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3418"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3416"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3418"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3416"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3418"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* flip sign if necessary... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3407"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>&LT; </span><a href="timestamp.c.html#LN3408"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3410"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3410"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* propagate any negative fields into the next higher field */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3410"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3410"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3407"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>&LT; </span><a href="timestamp.c.html#LN3408"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN12"><span class='Ref_to_Global_Var'>day_tab</span></a><span class='Delimiter'>[</span><a href="../../../timezone/private.h.html#LN142"><span class='Ref_to_Macro'>isleap</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3416"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>][</span><a href="timestamp.c.html#LN3416"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN12"><span class='Ref_to_Global_Var'>day_tab</span></a><span class='Delimiter'>[</span><a href="../../../timezone/private.h.html#LN142"><span class='Ref_to_Macro'>isleap</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3418"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>][</span><a href="timestamp.c.html#LN3418"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* recover sign if necessary... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3407"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>&LT; </span><a href="timestamp.c.html#LN3408"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3410"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3410"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN89"><span class='Ref_to_Proto'>tm2interval</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3414"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3410"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3409"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if timestamp2tm(dt1,NULL... &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3409"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_age &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* timestamptz_age() 
 * Calculate time difference while retaining year/month fields. 
 * Note that this does not result in an accurate absolute time span 
 *  since year and month are out of context once the arithmetic 
 *  is done. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3524"></a><span class='Declare_Function'>timestamptz_age</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3526"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt1</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3527"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>dt2</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3528"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3529"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>, 
</span><a name="LN3530"></a>                <span class='Declare_Local'>fsec1</span><span class='Delimiter'>, 
</span><a name="LN3531"></a>                <span class='Declare_Local'>fsec2</span><span class='Delimiter'>; 
</span><a name="LN3532"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN3533"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN3532"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN3534"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt1</span><span class='Delimiter'>, 
</span><a name="LN3535"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm1</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN3534"><span class='Ref_To_Local'>tt1</span></a><span class='Delimiter'>; 
</span><a name="LN3536"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt2</span><span class='Delimiter'>, 
</span><a name="LN3537"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm2</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN3536"><span class='Ref_To_Local'>tt2</span></a><span class='Delimiter'>; 
</span><a name="LN3538"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz1</span><span class='Delimiter'>; 
</span><a name="LN3539"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz2</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3528"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3526"><span class='Ref_To_Local'>dt1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3538"><span class='Ref_To_Local'>tz1</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3535"><span class='Ref_To_Local'>tm1</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3530"><span class='Ref_To_Local'>fsec1</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3527"><span class='Ref_To_Local'>dt2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3539"><span class='Ref_To_Local'>tz2</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3537"><span class='Ref_To_Local'>tm2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3531"><span class='Ref_To_Local'>fsec2</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* form the symbolic difference */ 
</span>        <a href="timestamp.c.html#LN3529"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3530"><span class='Ref_To_Local'>fsec1</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3531"><span class='Ref_To_Local'>fsec2</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3535"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3537"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3535"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3537"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3535"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3537"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3535"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3537"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3535"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3537"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN3535"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN3537"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* flip sign if necessary... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3526"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>&LT; </span><a href="timestamp.c.html#LN3527"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3529"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3529"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* propagate any negative fields into the next higher field */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3529"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3529"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN77"><span class='Ref_to_Const'>HOURS_PER_DAY</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3526"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>&LT; </span><a href="timestamp.c.html#LN3527"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN12"><span class='Ref_to_Global_Var'>day_tab</span></a><span class='Delimiter'>[</span><a href="../../../timezone/private.h.html#LN142"><span class='Ref_to_Macro'>isleap</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3535"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>][</span><a href="timestamp.c.html#LN3535"><span class='Ref_To_Local'>tm1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>+= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt_common.c.html#LN12"><span class='Ref_to_Global_Var'>day_tab</span></a><span class='Delimiter'>[</span><a href="../../../timezone/private.h.html#LN142"><span class='Ref_to_Macro'>isleap</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3537"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>][</span><a href="timestamp.c.html#LN3537"><span class='Ref_To_Local'>tm2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>+= </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note: we deliberately ignore any difference between tz1 and tz2. 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* recover sign if necessary... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3526"><span class='Ref_To_Local'>dt1</span></a> <span class='Operator'>&LT; </span><a href="timestamp.c.html#LN3527"><span class='Ref_To_Local'>dt2</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="timestamp.c.html#LN3529"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3529"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN89"><span class='Ref_to_Proto'>tm2interval</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3533"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3529"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3528"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if timestamp2tm(dt1,&tz1... &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3528"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz_age &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/*---------------------------------------------------------- 
 *  Conversion operators. 
 *---------------------------------------------------------*/ 
</span> 
 
<span class='Comment_Multi_Line'>/* timestamp_trunc() 
 * Truncate timestamp to specified units. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3651"></a><span class='Declare_Function'>timestamp_trunc</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3653"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>units</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3654"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3655"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3656"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN3657"></a>                <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN3658"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lowunits</span><span class='Delimiter'>; 
</span><a name="LN3659"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN3660"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN3661"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN3660"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3654"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3654"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3658"><span class='Ref_To_Local'>lowunits</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3653"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3653"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3656"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN318"><span class='Ref_to_Proto'>DecodeUnits</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3658"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3657"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3656"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3654"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3659"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3657"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN3683"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>woy</span><span class='Delimiter'>; 
</span> 
                    <a href="timestamp.c.html#LN3683"><span class='Ref_To_Local'>woy</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN102"><span class='Ref_to_Proto'>date2isoweek</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If it is week 52/53 and the month is January, then the 
                     * week must belong to the previous year. Also, some 
                     * December dates belong to the next year. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3683"><span class='Ref_To_Local'>woy</span></a> <span class='Operator'>&GT;= </span><span class='Number'>52</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                        <span class='Operator'>--</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3683"><span class='Ref_To_Local'>woy</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>== </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>++</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/timestamp.h.html#LN100"><span class='Ref_to_Proto'>isoweek2date</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3683"><span class='Ref_To_Local'>woy</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN3659"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* see comments in timestamptz_trunc */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>999</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>1000</span> <span class='Operator'>- </span><span class='Number'>999</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>999</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>1000</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* see comments in timestamptz_trunc */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>99</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>100</span> <span class='Operator'>- </span><span class='Number'>99</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>99</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>100</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* see comments in timestamptz_trunc */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3657"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a> <span class='Operator'>&& </span><a href="timestamp.c.html#LN3657"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>8</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN163"><span class='Ref_to_Const'>DTK_QUARTER</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>3</span> <span class='Operator'>* </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>3</span><span class='Parentheses'>))</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3659"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3659"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3659"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp units \"%s\" not supported"</span><span class='Delimiter'>, 
</span>                                <a href="timestamp.c.html#LN3658"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN3655"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch val &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3661"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3659"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3655"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type==UNITS &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp units \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN3658"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3655"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3655"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_trunc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamptz_trunc() 
 * Truncate timestamp to specified units. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3776"></a><span class='Declare_Function'>timestamptz_trunc</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3778"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>units</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3779"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3780"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3781"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN3782"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN3783"></a>                <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN3784"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>redotz</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN3785"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lowunits</span><span class='Delimiter'>; 
</span><a name="LN3786"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN3787"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN3788"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN3787"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3779"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3779"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3785"><span class='Ref_To_Local'>lowunits</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3778"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3778"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3782"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN318"><span class='Ref_to_Proto'>DecodeUnits</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3785"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3783"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3782"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3779"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3781"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3786"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3783"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN3810"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>woy</span><span class='Delimiter'>; 
</span> 
                    <a href="timestamp.c.html#LN3810"><span class='Ref_To_Local'>woy</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN102"><span class='Ref_to_Proto'>date2isoweek</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* 
                     * If it is week 52/53 and the month is January, then the 
                     * week must belong to the previous year. Also, some 
                     * December dates belong to the next year. 
                     */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3810"><span class='Ref_To_Local'>woy</span></a> <span class='Operator'>&GT;= </span><span class='Number'>52</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                        <span class='Operator'>--</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3810"><span class='Ref_To_Local'>woy</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>== </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>) 
</span>                        <span class='Operator'>++</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/timestamp.h.html#LN100"><span class='Ref_to_Proto'>isoweek2date</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3810"><span class='Ref_To_Local'>woy</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN3786"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN3784"><span class='Ref_To_Local'>redotz</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* one may consider DTK_THOUSAND and DTK_HUNDRED... */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * truncating to the millennium? what is this supposed to 
                 * mean? let us put the first year of the millennium... i.e. 
                 * -1000, 1, 1001, 2001... 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>999</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>1000</span> <span class='Operator'>- </span><span class='Number'>999</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>999</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>1000</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* truncating to the century? as above: -100, 1, 101... */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>99</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>100</span> <span class='Operator'>- </span><span class='Number'>99</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>99</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>100</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * truncating to the decade? first year of the decade. must 
                 * not be applied if year was truncated before! 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3783"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a> <span class='Operator'>&& </span><a href="timestamp.c.html#LN3783"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>8</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN163"><span class='Ref_to_Const'>DTK_QUARTER</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Number'>3</span> <span class='Operator'>* </span><span class='Parentheses'>((</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>3</span><span class='Parentheses'>))</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN3784"><span class='Ref_To_Local'>redotz</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* for all cases &GT;= DAY */ 
</span>                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* FALL THRU */ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3786"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN3786"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3786"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Operator'>: 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp with time zone units \"%s\" not "</span> 
                                <span class='String'>"supported"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3785"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN3780"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch val &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3784"><span class='Ref_To_Local'>redotz</span></a><span class='Parentheses'>) 
</span>            <a href="timestamp.c.html#LN3781"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.c.html#LN27"><span class='Ref_to_Global_Var'>session_timezone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3788"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3786"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3781"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3780"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type==UNITS &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp with time zone units \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                      <a href="timestamp.c.html#LN3785"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN3780"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3780"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz_trunc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* interval_trunc() 
 * Extract specified field from interval. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3925"></a><span class='Declare_Function'>interval_trunc</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3927"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>units</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3928"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3929"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3930"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN3931"></a>                <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN3932"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lowunits</span><span class='Delimiter'>; 
</span><a name="LN3933"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN3934"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN3935"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN3934"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3929"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3932"><span class='Ref_To_Local'>lowunits</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3927"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3927"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN3930"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN318"><span class='Ref_to_Proto'>DecodeUnits</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3932"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3931"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3930"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN88"><span class='Ref_to_Proto'>interval2tm</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN3928"><span class='Ref_To_Local'>interval</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN3933"><span class='Ref_To_Local'>fsec</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3931"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* fall through */ 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* caution: C division may have negative remainder */ 
</span>                    <a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* caution: C division may have negative remainder */ 
</span>                    <a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* caution: C division may have negative remainder */ 
</span>                    <a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN163"><span class='Ref_to_Const'>DTK_QUARTER</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>= </span><span class='Number'>3</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>/ </span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN3933"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN3933"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3933"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Operator'>: 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN3931"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Parentheses'>) 
</span>                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval units \"%s\" not supported "</span> 
                              <span class='String'>"because months usually have fractional weeks"</span><span class='Delimiter'>, 
</span>                                        <a href="timestamp.c.html#LN3932"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval units \"%s\" not supported"</span><span class='Delimiter'>, 
</span>                                        <a href="timestamp.c.html#LN3932"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch val &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN89"><span class='Ref_to_Proto'>tm2interval</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3935"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3933"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN3929"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if interval2tm(*interval... &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not convert interval to tm"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type==UNITS &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval units \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN3932"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN40"><span class='Ref_to_Macro'>PG_RETURN_INTERVAL_P</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN3929"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_trunc &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* isoweek2j() 
 * 
 *  Return the Julian day which corresponds to the first day (Monday) of the given ISO 8601 year and week. 
 *  Julian days are used to convert between ISO week dates and Gregorian dates. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN4021"></a><span class='Declare_Function'>isoweek2j</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>year</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>week</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4023"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>day0</span><span class='Delimiter'>, 
</span><a name="LN4024"></a>                <span class='Declare_Local'>day4</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fourth day of current year */ 
</span>    <a href="timestamp.c.html#LN4024"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4021"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* day0 == offset to first day of week (Monday) */ 
</span>    <a href="timestamp.c.html#LN4023"><span class='Ref_To_Local'>day0</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4024"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>((</span><a href="timestamp.c.html#LN4021"><span class='Ref_to_Parameter'>week</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>7</span><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4024"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4023"><span class='Ref_To_Local'>day0</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* isoweek2date() 
 * Convert ISO week of year number to date. 
 * The year field must be specified with the ISO year! 
 * karel 2000/08/07 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4041"></a><span class='Declare_Function'>isoweek2date</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>woy</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>year</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>mon</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>mday</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN99"><span class='Ref_to_Proto'>isoweek2j</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN4041"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4041"><span class='Ref_to_Parameter'>woy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4041"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4041"><span class='Ref_to_Parameter'>mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4041"><span class='Ref_to_Parameter'>mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* isoweekdate2date() 
 * 
 *  Convert an ISO 8601 week date (ISO year, ISO week) into a Gregorian date. 
 *  Gregorian day of week sent so weekday strings can be supplied. 
 *  Populates year, mon, and mday with the correct Gregorian values. 
 *  year must be passed in as the ISO year. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN4054"></a><span class='Declare_Function'>isoweekdate2date</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>isoweek</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>wday</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>year</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>mon</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>mday</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4056"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>jday</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4056"><span class='Ref_To_Local'>jday</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN99"><span class='Ref_to_Proto'>isoweek2j</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN4054"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4054"><span class='Ref_to_Parameter'>isoweek</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* convert Gregorian week start (Sunday=1) to ISO week start (Monday=1) */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4054"><span class='Ref_to_Parameter'>wday</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN4056"><span class='Ref_To_Local'>jday</span></a> <span class='Operator'>+= </span><a href="timestamp.c.html#LN4054"><span class='Ref_to_Parameter'>wday</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="timestamp.c.html#LN4056"><span class='Ref_To_Local'>jday</span></a> <span class='Operator'>+= </span><span class='Number'>6</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4056"><span class='Ref_To_Local'>jday</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4054"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4054"><span class='Ref_to_Parameter'>mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4054"><span class='Ref_to_Parameter'>mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* date2isoweek() 
 * 
 *  Returns ISO week number of year. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN4072"></a><span class='Declare_Function'>date2isoweek</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>year</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mon</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mday</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4074"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4075"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>day0</span><span class='Delimiter'>, 
</span><a name="LN4076"></a>                <span class='Declare_Local'>day4</span><span class='Delimiter'>, 
</span><a name="LN4077"></a>                <span class='Declare_Local'>dayn</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* current day */ 
</span>    <a href="timestamp.c.html#LN4077"><span class='Ref_To_Local'>dayn</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4072"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4072"><span class='Ref_to_Parameter'>mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4072"><span class='Ref_to_Parameter'>mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fourth day of current year */ 
</span>    <a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4072"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* day0 == offset to first day of week (Monday) */ 
</span>    <a href="timestamp.c.html#LN4075"><span class='Ref_To_Local'>day0</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need the first week containing a Thursday, otherwise this day falls 
     * into the previous year for purposes of counting weeks 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4077"><span class='Ref_To_Local'>dayn</span></a> <span class='Operator'>&LT; </span><a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4075"><span class='Ref_To_Local'>day0</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4072"><span class='Ref_to_Parameter'>year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* day0 == offset to first day of week (Monday) */ 
</span>        <a href="timestamp.c.html#LN4075"><span class='Ref_To_Local'>day0</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="timestamp.c.html#LN4074"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4077"><span class='Ref_To_Local'>dayn</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4075"><span class='Ref_To_Local'>day0</span></a><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>7</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sometimes the last few days in a year will fall into the first week of 
     * the next year, so check for this. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4074"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT;= </span><span class='Number'>52</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4072"><span class='Ref_to_Parameter'>year</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* day0 == offset to first day of week (Monday) */ 
</span>        <a href="timestamp.c.html#LN4075"><span class='Ref_To_Local'>day0</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4077"><span class='Ref_To_Local'>dayn</span></a> <span class='Operator'>&GT;= </span><a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4075"><span class='Ref_To_Local'>day0</span></a><span class='Parentheses'>) 
</span>            <a href="timestamp.c.html#LN4074"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4077"><span class='Ref_To_Local'>dayn</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4076"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4075"><span class='Ref_To_Local'>day0</span></a><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>7</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><a href="timestamp.c.html#LN4074"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end date2isoweek &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* date2isoyear() 
 * 
 *  Returns ISO 8601 year number. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN4126"></a><span class='Declare_Function'>date2isoyear</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>year</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mon</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mday</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4128"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4129"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>day0</span><span class='Delimiter'>, 
</span><a name="LN4130"></a>                <span class='Declare_Local'>day4</span><span class='Delimiter'>, 
</span><a name="LN4131"></a>                <span class='Declare_Local'>dayn</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* current day */ 
</span>    <a href="timestamp.c.html#LN4131"><span class='Ref_To_Local'>dayn</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4126"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4126"><span class='Ref_to_Parameter'>mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4126"><span class='Ref_to_Parameter'>mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fourth day of current year */ 
</span>    <a href="timestamp.c.html#LN4130"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4126"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* day0 == offset to first day of week (Monday) */ 
</span>    <a href="timestamp.c.html#LN4129"><span class='Ref_To_Local'>day0</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4130"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need the first week containing a Thursday, otherwise this day falls 
     * into the previous year for purposes of counting weeks 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4131"><span class='Ref_To_Local'>dayn</span></a> <span class='Operator'>&LT; </span><a href="timestamp.c.html#LN4130"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4129"><span class='Ref_To_Local'>day0</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN4130"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4126"><span class='Ref_to_Parameter'>year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* day0 == offset to first day of week (Monday) */ 
</span>        <a href="timestamp.c.html#LN4129"><span class='Ref_To_Local'>day0</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4130"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN4126"><span class='Ref_to_Parameter'>year</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="timestamp.c.html#LN4128"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4131"><span class='Ref_To_Local'>dayn</span></a> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4130"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4129"><span class='Ref_To_Local'>day0</span></a><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>7</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sometimes the last few days in a year will fall into the first week of 
     * the next year, so check for this. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4128"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT;= </span><span class='Number'>52</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN4130"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4126"><span class='Ref_to_Parameter'>year</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* day0 == offset to first day of week (Monday) */ 
</span>        <a href="timestamp.c.html#LN4129"><span class='Ref_To_Local'>day0</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4130"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4131"><span class='Ref_To_Local'>dayn</span></a> <span class='Operator'>&GT;= </span><a href="timestamp.c.html#LN4130"><span class='Ref_To_Local'>day4</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4129"><span class='Ref_To_Local'>day0</span></a><span class='Parentheses'>) 
</span>            <a href="timestamp.c.html#LN4126"><span class='Ref_to_Parameter'>year</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN4126"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end date2isoyear &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* date2isoyearday() 
 * 
 *  Returns the ISO 8601 day-of-year, given a Gregorian year, month and day. 
 *  Possible return values are 1 through 371 (364 in non-leap years). 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN4183"></a><span class='Declare_Function'>date2isoyearday</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>year</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mon</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>mday</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4183"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4183"><span class='Ref_to_Parameter'>mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4183"><span class='Ref_to_Parameter'>mday</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/utils/timestamp.h.html#LN99"><span class='Ref_to_Proto'>isoweek2j</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN103"><span class='Ref_to_Proto'>date2isoyear</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4183"><span class='Ref_to_Parameter'>year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4183"><span class='Ref_to_Parameter'>mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4183"><span class='Ref_to_Parameter'>mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * NonFiniteTimestampTzPart 
 * 
 *  Used by timestamp_part and timestamptz_part when extracting from infinite 
 *  timestamp[tz].  Returns +/-Infinity if that is the appropriate result, 
 *  otherwise returns zero (which should be taken as meaning to return NULL). 
 * 
 *  Errors thrown here for invalid units should exactly match those that 
 *  would be thrown in the calling functions, else there will be unexpected 
 *  discrepancies between finite- and infinite-input cases. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a> 
<a name="LN4200"></a><span class='Declare_Function'>NonFiniteTimestampTzPart</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>type</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>unit</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>lowunits</span><span class='Delimiter'>, 
</span><a name="LN4201"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>isNegative</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isTz</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="timestamp.c.html#LN4200"><span class='Ref_to_Parameter'>type</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4200"><span class='Ref_to_Parameter'>type</span></a> <span class='Operator'>!= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4201"><span class='Ref_to_Parameter'>isTz</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp with time zone units \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                      <a href="timestamp.c.html#LN4200"><span class='Ref_to_Parameter'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp units \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                            <a href="timestamp.c.html#LN4200"><span class='Ref_to_Parameter'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4200"><span class='Ref_to_Parameter'>unit</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Oscillating units */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN163"><span class='Ref_to_Const'>DTK_QUARTER</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN172"><span class='Ref_to_Const'>DTK_DOW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN177"><span class='Ref_to_Const'>DTK_ISODOW</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN173"><span class='Ref_to_Const'>DTK_DOY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN175"><span class='Ref_to_Const'>DTK_TZ_MINUTE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN174"><span class='Ref_to_Const'>DTK_TZ_HOUR</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Monotonically-increasing units */ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN176"><span class='Ref_to_Const'>DTK_ISOYEAR</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN149"><span class='Ref_to_Const'>DTK_EPOCH</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4201"><span class='Ref_to_Parameter'>isNegative</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Operator'>-</span><a href="../../../include/utils/builtins.h.html#LN55"><span class='Ref_to_Proto'>get_float8_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN55"><span class='Ref_to_Proto'>get_float8_infinity</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4201"><span class='Ref_to_Parameter'>isTz</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp with time zone units \"%s\" not supported"</span><span class='Delimiter'>, 
</span>                       <a href="timestamp.c.html#LN4200"><span class='Ref_to_Parameter'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp units \"%s\" not supported"</span><span class='Delimiter'>, 
</span>                                <a href="timestamp.c.html#LN4200"><span class='Ref_to_Parameter'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch unit &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end NonFiniteTimestampTzPart &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamp_part() 
 * Extract specified field from timestamp. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4269"></a><span class='Declare_Function'>timestamp_part</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4271"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>units</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4272"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4273"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4274"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>epoch</span><span class='Delimiter'>; 
</span><a name="LN4275"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN4276"></a>                <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN4277"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lowunits</span><span class='Delimiter'>; 
</span><a name="LN4278"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN4279"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN4280"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN4279"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4277"><span class='Ref_To_Local'>lowunits</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4271"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4271"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4275"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN318"><span class='Ref_to_Proto'>DecodeUnits</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4277"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4276"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4275"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN4275"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN327"><span class='Ref_to_Proto'>DecodeSpecial</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4277"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4276"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4272"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4199"><span class='Ref_to_Func'>NonFiniteTimestampTzPart</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4275"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4276"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4277"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/datatype/timestamp.h.html#LN114"><span class='Ref_to_Macro'>TIMESTAMP_IS_NOBEGIN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4272"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4275"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4272"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4278"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4276"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4278"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4278"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4278"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN163"><span class='Ref_to_Const'>DTK_QUARTER</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>3</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a><span class='Parentheses'>) </span><a href="../../../include/utils/timestamp.h.html#LN102"><span class='Ref_to_Proto'>date2isoweek</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Comment_Multi_Line'>/* there is no year 0, just 1 BC and 1 AD */ 
</span>                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * what is a decade wrt dates? let us assume that decade 199 
                 * is 1990 thru 1999... decade 0 starts on year 1 BC, and -1 
                 * is 11 BC thru 2 BC... 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>8</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Operator'>: 
</span> 
                <span class='Comment_Multi_Line'>/* ---- 
                 * centuries AD, c&GT;0: year in [ (c-1)* 100 + 1 : c*100 ] 
                 * centuries BC, c&LT;0: year in [ c*100 : (c+1) * 100 - 1] 
                 * there is no number 0 century. 
                 * ---- 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>99</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Comment_Multi_Line'>/* caution: C division may have negative remainder */ 
</span>                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>99</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* see comments above. */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>999</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>999</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>+= </span><span class='Parentheses'>((((</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ 
</span>                    <a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4278"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN176"><span class='Ref_to_Const'>DTK_ISOYEAR</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN103"><span class='Ref_to_Proto'>date2isoyear</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN172"><span class='Ref_to_Const'>DTK_DOW</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN177"><span class='Ref_to_Const'>DTK_ISODOW</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4272"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4278"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4276"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN177"><span class='Ref_to_Const'>DTK_ISODOW</span></a> <span class='Operator'>&& </span><a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>7</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN173"><span class='Ref_to_Const'>DTK_DOY</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4272"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4278"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>) 
</span>                          <span class='Operator'>- </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4280"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN175"><span class='Ref_to_Const'>DTK_TZ_MINUTE</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN174"><span class='Ref_to_Const'>DTK_TZ_HOUR</span></a><span class='Operator'>: 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp units \"%s\" not supported"</span><span class='Delimiter'>, 
</span>                                <a href="timestamp.c.html#LN4277"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch val &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type==UNITS &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4275"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4276"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN149"><span class='Ref_to_Const'>DTK_EPOCH</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4274"><span class='Ref_To_Local'>epoch</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN71"><span class='Ref_to_Func'>SetEpochTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* try to avoid precision loss in subtraction */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4272"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4274"><span class='Ref_To_Local'>epoch</span></a><span class='Parentheses'>))</span> 
                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4272"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4274"><span class='Ref_To_Local'>epoch</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN4272"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4274"><span class='Ref_To_Local'>epoch</span></a><span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp units \"%s\" not supported"</span><span class='Delimiter'>, 
</span>                                <a href="timestamp.c.html#LN4277"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type==RESERV &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp units \"%s\" not recognized"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4277"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4273"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_part &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamptz_part() 
 * Extract specified field from timestamp with time zone. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4468"></a><span class='Declare_Function'>timestamptz_part</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4470"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>units</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4471"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4472"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4473"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>epoch</span><span class='Delimiter'>; 
</span><a name="LN4474"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN4475"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN4476"></a>                <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN4477"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lowunits</span><span class='Delimiter'>; 
</span><a name="LN4478"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>dummy</span><span class='Delimiter'>; 
</span><a name="LN4479"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN4480"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN4481"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN4480"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4477"><span class='Ref_To_Local'>lowunits</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4470"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4470"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4475"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN318"><span class='Ref_to_Proto'>DecodeUnits</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4477"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4476"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4475"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN4475"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN327"><span class='Ref_to_Proto'>DecodeSpecial</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4477"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4476"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4471"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4199"><span class='Ref_to_Func'>NonFiniteTimestampTzPart</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4475"><span class='Ref_To_Local'>type</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4476"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4477"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/datatype/timestamp.h.html#LN114"><span class='Ref_to_Macro'>TIMESTAMP_IS_NOBEGIN</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4471"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                          <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4475"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4471"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4474"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4479"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4476"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN141"><span class='Ref_to_Const'>DTK_TZ</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN4474"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN175"><span class='Ref_to_Const'>DTK_TZ_MINUTE</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN4474"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>/= </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Delimiter'>; 
</span>                <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN216"><span class='Ref_to_Macro'>FMODULO</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4478"><span class='Ref_To_Local'>dummy</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN174"><span class='Ref_to_Const'>DTK_TZ_HOUR</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4478"><span class='Ref_To_Local'>dummy</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN4474"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>; 
</span>                <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN216"><span class='Ref_to_Macro'>FMODULO</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4478"><span class='Ref_To_Local'>dummy</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN86"><span class='Ref_to_Const'>SECS_PER_HOUR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4479"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4479"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4479"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN163"><span class='Ref_to_Const'>DTK_QUARTER</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>3</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN161"><span class='Ref_to_Const'>DTK_WEEK</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a><span class='Parentheses'>) </span><a href="../../../include/utils/timestamp.h.html#LN102"><span class='Ref_to_Proto'>date2isoweek</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Comment_Multi_Line'>/* there is no year 0, just 1 BC and 1 AD */ 
</span>                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* see comments in timestamp_part */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>8</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* see comments in timestamp_part */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>99</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>99</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* see comments in timestamp_part */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>+ </span><span class='Number'>999</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= -</span><span class='Parentheses'>((</span><span class='Number'>999</span> <span class='Operator'>- </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN170"><span class='Ref_to_Const'>DTK_JULIAN</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>+= </span><span class='Parentheses'>((((</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN88"><span class='Ref_to_Const'>MINS_PER_HOUR</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN87"><span class='Ref_to_Const'>SECS_PER_MINUTE</span></a><span class='Parentheses'>)</span> <span class='Operator'>+ 
</span>                    <a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4479"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>))</span> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN176"><span class='Ref_to_Const'>DTK_ISOYEAR</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN103"><span class='Ref_to_Proto'>date2isoyear</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN172"><span class='Ref_to_Const'>DTK_DOW</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN177"><span class='Ref_to_Const'>DTK_ISODOW</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4471"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4474"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4479"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN330"><span class='Ref_to_Proto'>j2day</span></a><span class='Parentheses'>(</span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4476"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN177"><span class='Ref_to_Const'>DTK_ISODOW</span></a> <span class='Operator'>&& </span><a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>7</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN173"><span class='Ref_to_Const'>DTK_DOY</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4471"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4474"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4479"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>) 
</span>                          <span class='Operator'>- </span><a href="datetime.c.html#LN290"><span class='Ref_to_Func'>date2j</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4481"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp with time zone units \"%s\" not supported"</span><span class='Delimiter'>, 
</span>                       <a href="timestamp.c.html#LN4477"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch val &raquo; </span> 
 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type==UNITS &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4475"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4476"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN149"><span class='Ref_to_Const'>DTK_EPOCH</span></a><span class='Operator'>: 
</span>                <a href="timestamp.c.html#LN4473"><span class='Ref_To_Local'>epoch</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN71"><span class='Ref_to_Func'>SetEpochTimestamp</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* try to avoid precision loss in subtraction */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4471"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>&LT; </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN342"><span class='Ref_to_Const'>PG_INT64_MAX</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4473"><span class='Ref_To_Local'>epoch</span></a><span class='Parentheses'>))</span> 
                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4471"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4473"><span class='Ref_To_Local'>epoch</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a><span class='Parentheses'>) </span><a href="timestamp.c.html#LN4471"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>- </span><a href="timestamp.c.html#LN4473"><span class='Ref_To_Local'>epoch</span></a><span class='Parentheses'>)</span> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp with time zone units \"%s\" not supported"</span><span class='Delimiter'>, 
</span>                       <a href="timestamp.c.html#LN4477"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type==RESERV &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>               <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp with time zone units \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                      <a href="timestamp.c.html#LN4477"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4472"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz_part &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* interval_part() 
 * Extract specified field from interval. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4672"></a><span class='Declare_Function'>interval_part</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4674"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>units</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4675"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>interval</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4676"></a>    <a href="../../../include/c.h.html#LN380"><span class='Ref_to_Typedef'>float8</span></a>      <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4677"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN4678"></a>                <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN4679"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lowunits</span><span class='Delimiter'>; 
</span><a name="LN4680"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN4681"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN4682"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN4681"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4679"><span class='Ref_To_Local'>lowunits</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4674"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4674"><span class='Ref_To_Local'>units</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4677"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN318"><span class='Ref_to_Proto'>DecodeUnits</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4679"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4678"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4677"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN118"><span class='Ref_to_Const'>UNKNOWN_FIELD</span></a><span class='Parentheses'>) 
</span>        <a href="timestamp.c.html#LN4677"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN327"><span class='Ref_to_Proto'>DecodeSpecial</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4679"><span class='Ref_To_Local'>lowunits</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4678"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4677"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN106"><span class='Ref_to_Const'>UNITS</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN88"><span class='Ref_to_Proto'>interval2tm</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="timestamp.c.html#LN4675"><span class='Ref_To_Local'>interval</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4680"><span class='Ref_To_Local'>fsec</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4678"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN169"><span class='Ref_to_Const'>DTK_MICROSEC</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>* </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4680"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN168"><span class='Ref_to_Const'>DTK_MILLISEC</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>* </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4680"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN157"><span class='Ref_to_Const'>DTK_SECOND</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN26"><span class='Ref_to_Member'>tm_sec</span></a> <span class='Operator'>+ </span><a href="timestamp.c.html#LN4680"><span class='Ref_To_Local'>fsec</span></a> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN158"><span class='Ref_to_Const'>DTK_MINUTE</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN27"><span class='Ref_to_Member'>tm_min</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN159"><span class='Ref_to_Const'>DTK_HOUR</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN28"><span class='Ref_to_Member'>tm_hour</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN160"><span class='Ref_to_Const'>DTK_DAY</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN162"><span class='Ref_to_Const'>DTK_MONTH</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN163"><span class='Ref_to_Const'>DTK_QUARTER</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a> <span class='Operator'>/ </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN164"><span class='Ref_to_Const'>DTK_YEAR</span></a><span class='Operator'>: 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN165"><span class='Ref_to_Const'>DTK_DECADE</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* caution: C division may have negative remainder */ 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN166"><span class='Ref_to_Const'>DTK_CENTURY</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* caution: C division may have negative remainder */ 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>100</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>case</span> <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN167"><span class='Ref_to_Const'>DTK_MILLENNIUM</span></a><span class='Operator'>: 
</span>                    <span class='Comment_Multi_Line'>/* caution: C division may have negative remainder */ 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4682"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>-&GT;</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a> <span class='Operator'>/ </span><span class='Number'>1000</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>default</span><span class='Operator'>: 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval units \"%s\" not supported"</span><span class='Delimiter'>, 
</span>                                    <a href="timestamp.c.html#LN4679"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch val &raquo; </span> 
 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if interval2tm(*interval... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not convert interval to tm"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type==UNITS &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4677"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN89"><span class='Ref_to_Const'>RESERV</span></a> <span class='Operator'>&& </span><a href="timestamp.c.html#LN4678"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN149"><span class='Ref_to_Const'>DTK_EPOCH</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4675"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><span class='Number'>1000000</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>+= </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN67"><span class='Ref_to_Const'>DAYS_PER_YEAR</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4675"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>+= </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN76"><span class='Ref_to_Const'>DAYS_PER_MONTH</span></a> <span class='Operator'>* </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4675"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>% </span><a href="../../../include/datatype/timestamp.h.html#LN68"><span class='Ref_to_Const'>MONTHS_PER_YEAR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>+= </span><span class='Parentheses'>((</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="../../../include/datatype/timestamp.h.html#LN85"><span class='Ref_to_Const'>SECS_PER_DAY</span></a><span class='Parentheses'>)</span> <span class='Operator'>* </span><a href="timestamp.c.html#LN4675"><span class='Ref_To_Local'>interval</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval units \"%s\" not recognized"</span><span class='Delimiter'>, 
</span>                        <a href="timestamp.c.html#LN4679"><span class='Ref_To_Local'>lowunits</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN325"><span class='Ref_to_Macro'>PG_RETURN_FLOAT8</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4676"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end interval_part &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* timestamp_zone_transform() 
 * The original optimization here caused problems by relabeling Vars that 
 * could be matched to index entries.  It might be possible to resurrect it 
 * at some point by teaching the planner to be less cavalier with RelabelType 
 * nodes, but that will take careful analysis. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4791"></a><span class='Declare_Function'>timestamp_zone_transform</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/*  timestamp_zone() 
 *  Encode timestamp type with specified time zone. 
 *  This function is just timestamp2timestamptz() except instead of 
 *  shifting to the global timezone, we shift to the specified timezone. 
 *  This is different from the other AT TIME ZONE cases because instead 
 *  of shifting _to_ a new time zone, it sets the time to _be_ the 
 *  specified timezone. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4805"></a><span class='Declare_Function'>timestamp_zone</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4807"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>zone</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4808"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4809"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4810"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN4811"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tzname</span><span class='Delimiter'>[</span><a href="../../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4812"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lowzone</span><span class='Delimiter'>; 
</span><a name="LN4813"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN4814"></a>                <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN4815"></a>    <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tzp</span><span class='Delimiter'>; 
</span><a name="LN4816"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN4817"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4808"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4808"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the requested timezone.  First we look in the timezone 
     * abbreviation table (to handle cases like "EST"), and if that fails, we 
     * look in the timezone database (to handle cases like 
     * "America/New_York").  (This matches the order in which timestamp input 
     * checks the cases; it's important because the timezone database unwisely 
     * uses a few zone names that are identical to offset abbreviations.) 
     */ 
</span>    <a href="../../../include/utils/builtins.h.html#LN88"><span class='Ref_to_Proto'>text_to_cstring_buffer</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4807"><span class='Ref_To_Local'>zone</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4811"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4811"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* DecodeTimezoneAbbrev requires lowercase input */ 
</span>    <a href="timestamp.c.html#LN4812"><span class='Ref_To_Local'>lowzone</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4811"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, 
</span>                                           strlen<span class='Parentheses'>(</span><a href="timestamp.c.html#LN4811"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4813"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN325"><span class='Ref_to_Proto'>DecodeTimezoneAbbrev</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4812"><span class='Ref_To_Local'>lowzone</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4814"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4815"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4813"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a> <span class='Operator'>|| </span><a href="timestamp.c.html#LN4813"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN95"><span class='Ref_to_Const'>DTZ</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* fixed-offset abbreviation */ 
</span>        <a href="timestamp.c.html#LN4810"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4814"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN4809"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN26"><span class='Ref_to_Func'>dt2local</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4808"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4810"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4813"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN96"><span class='Ref_to_Const'>DYNTZ</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* dynamic-offset abbreviation, resolve using specified time */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4808"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4816"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4817"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4815"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN4810"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= -</span><a href="../../../include/utils/datetime.h.html#LN312"><span class='Ref_to_Proto'>DetermineTimeZoneAbbrevOffset</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN4816"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4811"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4815"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN4809"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN26"><span class='Ref_to_Func'>dt2local</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4808"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4810"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* try it as a full zone name */ 
</span>        <a href="timestamp.c.html#LN4815"><span class='Ref_To_Local'>tzp</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4811"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4815"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Apply the timezone change */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4808"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4816"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4817"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4815"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN4810"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN4816"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4815"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN4816"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4817"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4810"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4809"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone \"%s\" not recognized"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4811"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN4809"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4809"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4809"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_zone &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamp_izone_transform() 
 * The original optimization here caused problems by relabeling Vars that 
 * could be matched to index entries.  It might be possible to resurrect it 
 * at some point by teaching the planner to be less cavalier with RelabelType 
 * nodes, but that will take careful analysis. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4896"></a><span class='Declare_Function'>timestamp_izone_transform</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* timestamp_izone() 
 * Encode timestamp type with specified time interval as time zone. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4905"></a><span class='Declare_Function'>timestamp_izone</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4907"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>zone</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4908"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4909"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4910"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4908"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4908"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN4907"><span class='Ref_To_Local'>zone</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="timestamp.c.html#LN4907"><span class='Ref_To_Local'>zone</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval time zone \"%s\" must not include months or days"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN956"><span class='Ref_to_Func'>interval_out</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4907"><span class='Ref_To_Local'>zone</span></a><span class='Parentheses'>))))))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4910"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4907"><span class='Ref_To_Local'>zone</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN4909"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN26"><span class='Ref_to_Func'>dt2local</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4908"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4910"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4909"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4909"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp_izone &raquo; </span>   <span class='Comment_Single_Line'>/* timestamp_izone() */ 
</span> 
<span class='Comment_Multi_Line'>/* timestamp_timestamptz() 
 * Convert local timestamp to timestamp at GMT 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4938"></a><span class='Declare_Function'>timestamp_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4940"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN39"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN74"><span class='Ref_to_Proto'>timestamp2timestamptz</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4940"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> 
<a name="LN4946"></a><span class='Declare_Function'>timestamp2timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> <span class='Declare_Parameter'>timestamp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4948"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4949"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN4950"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN4949"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN4951"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN4952"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4946"><span class='Ref_to_Parameter'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="timestamp.c.html#LN4948"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4946"><span class='Ref_to_Parameter'>timestamp</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4946"><span class='Ref_to_Parameter'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4950"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4951"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN4952"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN311"><span class='Ref_to_Proto'>DetermineTimeZoneOffset</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4950"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="../../../timezone/pgtz.c.html#LN27"><span class='Ref_to_Global_Var'>session_timezone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4950"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4951"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4952"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4948"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="timestamp.c.html#LN4948"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamp2timestamptz &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamptz_timestamp() 
 * Convert timestamp at GMT to local timestamp 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4978"></a><span class='Declare_Function'>timestamptz_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4980"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN75"><span class='Ref_to_Proto'>timestamptz2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4980"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a> 
<a name="LN4986"></a><span class='Declare_Function'>timestamptz2timestamp</span><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Parameter'>timestamp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4988"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4989"></a>    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tt</span><span class='Delimiter'>, 
</span><a name="LN4990"></a>               <span class='Operator'>*</span><span class='Declare_Local'>tm</span> <span class='Operator'>= &</span><a href="timestamp.c.html#LN4989"><span class='Ref_To_Local'>tt</span></a><span class='Delimiter'>; 
</span><a name="LN4991"></a>    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN4992"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4986"><span class='Ref_to_Parameter'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="timestamp.c.html#LN4988"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN4986"><span class='Ref_to_Parameter'>timestamp</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4986"><span class='Ref_to_Parameter'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4992"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4990"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4991"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN4990"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN4991"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN4988"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="timestamp.c.html#LN4988"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz2timestamp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamptz_zone() 
 * Evaluate timestamp with time zone type at the specified time zone. 
 * Returns a timestamp without time zone. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5015"></a><span class='Declare_Function'>timestamptz_zone</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5017"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>zone</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5018"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5019"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5020"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN5021"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>tzname</span><span class='Delimiter'>[</span><a href="../../../include/pgtime.h.html#LN43"><span class='Ref_to_Const'>TZ_STRLEN_MAX</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN5022"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lowzone</span><span class='Delimiter'>; 
</span><a name="LN5023"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>type</span><span class='Delimiter'>, 
</span><a name="LN5024"></a>                <span class='Declare_Local'>val</span><span class='Delimiter'>; 
</span><a name="LN5025"></a>    <a href="../../../timezone/pgtz.h.html#LN58"><span class='Ref_to_Struct'>pg_tz</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>tzp</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5018"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5018"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Look up the requested timezone.  First we look in the timezone 
     * abbreviation table (to handle cases like "EST"), and if that fails, we 
     * look in the timezone database (to handle cases like 
     * "America/New_York").  (This matches the order in which timestamp input 
     * checks the cases; it's important because the timezone database unwisely 
     * uses a few zone names that are identical to offset abbreviations.) 
     */ 
</span>    <a href="../../../include/utils/builtins.h.html#LN88"><span class='Ref_to_Proto'>text_to_cstring_buffer</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5017"><span class='Ref_To_Local'>zone</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5021"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5021"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* DecodeTimezoneAbbrev requires lowercase input */ 
</span>    <a href="timestamp.c.html#LN5022"><span class='Ref_To_Local'>lowzone</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5021"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, 
</span>                                           strlen<span class='Parentheses'>(</span><a href="timestamp.c.html#LN5021"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN5023"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN325"><span class='Ref_to_Proto'>DecodeTimezoneAbbrev</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5022"><span class='Ref_To_Local'>lowzone</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN5024"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN5025"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN5023"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN94"><span class='Ref_to_Const'>TZ</span></a> <span class='Operator'>|| </span><a href="timestamp.c.html#LN5023"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN95"><span class='Ref_to_Const'>DTZ</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* fixed-offset abbreviation */ 
</span>        <a href="timestamp.c.html#LN5020"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= -</span><a href="timestamp.c.html#LN5024"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN5019"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN26"><span class='Ref_to_Func'>dt2local</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5018"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5020"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN5023"><span class='Ref_To_Local'>type</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN96"><span class='Ref_to_Const'>DYNTZ</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* dynamic-offset abbreviation, resolve using specified time */ 
</span><a name="LN5056"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>isdst</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN5020"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= </span><a href="../../../include/utils/datetime.h.html#LN313"><span class='Ref_to_Proto'>DetermineTimeZoneAbbrevOffsetTS</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5018"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5021"><span class='Ref_To_Local'>tzname</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5025"><span class='Ref_To_Local'>tzp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN5056"><span class='Ref_To_Local'>isdst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN5019"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN26"><span class='Ref_to_Func'>dt2local</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5018"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5020"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* try it as a full zone name */ 
</span>        <a href="timestamp.c.html#LN5025"><span class='Ref_To_Local'>tzp</span></a> <span class='Operator'>= </span><a href="../../../include/pgtime.h.html#LN76"><span class='Ref_to_Proto'>pg_tzset</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5021"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN5025"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Apply the timezone change */ 
</span><a name="LN5068"></a>            <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN5069"></a>            <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5018"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN5020"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN5068"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN5069"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5025"><span class='Ref_To_Local'>tzp</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN40"><span class='Ref_to_Func'>tm2timestamp</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN5068"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5069"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN5019"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"time zone \"%s\" not recognized"</span><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5021"><span class='Ref_To_Local'>tzname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="timestamp.c.html#LN5019"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5019"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5019"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz_zone &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* timestamptz_izone() 
 * Encode timestamp with time zone type with specified time interval as time zone. 
 * Returns a timestamp without time zone. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5102"></a><span class='Declare_Function'>timestamptz_izone</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5104"></a>    <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>zone</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5105"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5106"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN5107"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5105"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5105"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN5104"><span class='Ref_To_Local'>zone</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN28"><span class='Ref_to_Member'>month</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="timestamp.c.html#LN5104"><span class='Ref_To_Local'>zone</span></a><span class='Operator'>-&GT;</span><a href="../../../include/datatype/timestamp.h.html#LN46"><span class='Ref_to_Member'>day</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>          <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"interval time zone \"%s\" must not include months or days"</span><span class='Delimiter'>, 
</span>                 <a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN956"><span class='Ref_to_Func'>interval_out</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5104"><span class='Ref_To_Local'>zone</span></a><span class='Parentheses'>))))))</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN5107"><span class='Ref_To_Local'>tz</span></a> <span class='Operator'>= -</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5104"><span class='Ref_To_Local'>zone</span></a><span class='Operator'>-&GT;</span><a href="../../../interfaces/ecpg/include/pgtypes_interval.h.html#LN27"><span class='Ref_to_Member'>time</span></a> <span class='Operator'>/ </span><a href="../../../include/datatype/timestamp.h.html#LN93"><span class='Ref_to_Const'>USECS_PER_SEC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="timestamp.c.html#LN5106"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/timestamp.c.html#LN26"><span class='Ref_to_Func'>dt2local</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5105"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5107"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/datatype/timestamp.h.html#LN194"><span class='Ref_to_Macro'>IS_VALID_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5106"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/timestamp.h.html#LN38"><span class='Ref_to_Macro'>PG_RETURN_TIMESTAMP</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5106"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end timestamptz_izone &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* generate_series_timestamp() 
 * Generate the set of timestamps from start to finish by step 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5135"></a><span class='Declare_Function'>generate_series_timestamp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5137"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN5138"></a>    <a href="timestamp.c.html#LN53"><span class='Ref_to_Typedef'>generate_series_timestamp_fctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fctx</span><span class='Delimiter'>; 
</span><a name="LN5139"></a>    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* stuff done only on the first call of the function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5144"></a>        <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>start</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5145"></a>        <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>finish</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN34"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5146"></a>        <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>step</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5147"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN5148"></a>        <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Local'>interval_zero</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* create a function context for cross-call persistence */ 
</span>        <a href="timestamp.c.html#LN5137"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * switch to memory context appropriate for multiple function calls 
         */ 
</span>        <a href="timestamp.c.html#LN5147"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5137"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* allocate memory for user context */ 
</span>        <a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN53"><span class='Ref_to_Typedef'>generate_series_timestamp_fctx</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN53"><span class='Ref_to_Typedef'>generate_series_timestamp_fctx</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Use fctx to keep state from call to call. Seed current with the 
         * original start value 
         */ 
</span>        <a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN55"><span class='Ref_to_Member'>current</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5144"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN56"><span class='Ref_to_Member'>finish</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5145"><span class='Ref_To_Local'>finish</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN57"><span class='Ref_to_Member'>step</span></a> <span class='Operator'>= *</span><a href="timestamp.c.html#LN5146"><span class='Ref_To_Local'>step</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Determine sign of the interval */ 
</span>        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN5148"><span class='Ref_To_Local'>interval_zero</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN58"><span class='Ref_to_Member'>step_sign</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN57"><span class='Ref_to_Member'>step</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN5148"><span class='Ref_To_Local'>interval_zero</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN58"><span class='Ref_to_Member'>step_sign</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"step size cannot equal zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN5137"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5147"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* stuff done on every call of the function */ 
</span>    <a href="timestamp.c.html#LN5137"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the saved state and use current as the result for this iteration 
     */ 
</span>    <a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5137"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN5139"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN55"><span class='Ref_to_Member'>current</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN58"><span class='Ref_to_Member'>step_sign</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? 
</span>        <a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5139"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN56"><span class='Ref_to_Member'>finish</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>: 
</span>        <a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5139"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN56"><span class='Ref_to_Member'>finish</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* increment current in preparation for next iteration */ 
</span>        <a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN55"><span class='Ref_to_Member'>current</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN26"><span class='Ref_to_Macro'>DatumGetTimestamp</span></a><span class='Parentheses'>(</span> 
                                   <a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2774"><span class='Ref_to_Func'>timestamp_pl_interval</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/utils/timestamp.h.html#LN30"><span class='Ref_to_Macro'>TimestampGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN55"><span class='Ref_to_Member'>current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN5138"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN57"><span class='Ref_to_Member'>step</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* do when there is more left to send */ 
</span>        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5137"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/timestamp.h.html#LN30"><span class='Ref_to_Macro'>TimestampGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5139"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* do when there is no more left */ 
</span>        <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5137"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end generate_series_timestamp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* generate_series_timestamptz() 
 * Generate the set of timestamps from start to finish by step 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5216"></a><span class='Declare_Function'>generate_series_timestamptz</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5218"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN5219"></a>    <a href="timestamp.c.html#LN61"><span class='Ref_to_Typedef'>generate_series_timestamptz_fctx</span></a> <span class='Operator'>*</span><span class='Declare_Local'>fctx</span><span class='Delimiter'>; 
</span><a name="LN5220"></a>    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* stuff done only on the first call of the function */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN5225"></a>        <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>start</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5226"></a>        <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>finish</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN35"><span class='Ref_to_Macro'>PG_GETARG_TIMESTAMPTZ</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5227"></a>        <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>step</span> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN36"><span class='Ref_to_Macro'>PG_GETARG_INTERVAL_P</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN5228"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN5229"></a>        <a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a>    <span class='Declare_Local'>interval_zero</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* create a function context for cross-call persistence */ 
</span>        <a href="timestamp.c.html#LN5218"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * switch to memory context appropriate for multiple function calls 
         */ 
</span>        <a href="timestamp.c.html#LN5228"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5218"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* allocate memory for user context */ 
</span>        <a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN61"><span class='Ref_to_Typedef'>generate_series_timestamptz_fctx</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="timestamp.c.html#LN61"><span class='Ref_to_Typedef'>generate_series_timestamptz_fctx</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Use fctx to keep state from call to call. Seed current with the 
         * original start value 
         */ 
</span>        <a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN63"><span class='Ref_to_Member'>current</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5225"><span class='Ref_To_Local'>start</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN64"><span class='Ref_to_Member'>finish</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5226"><span class='Ref_To_Local'>finish</span></a><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN65"><span class='Ref_to_Member'>step</span></a> <span class='Operator'>= *</span><a href="timestamp.c.html#LN5227"><span class='Ref_To_Local'>step</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Determine sign of the interval */ 
</span>        <a href="../../../include/c.h.html#LN856"><span class='Ref_to_Macro'>MemSet</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN5229"><span class='Ref_To_Local'>interval_zero</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN42"><span class='Ref_to_Typedef'>Interval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN66"><span class='Ref_to_Member'>step_sign</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN2324"><span class='Ref_to_Func'>interval_cmp_internal</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN65"><span class='Ref_to_Member'>step</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="timestamp.c.html#LN5229"><span class='Ref_To_Local'>interval_zero</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN66"><span class='Ref_to_Member'>step_sign</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"step size cannot equal zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="timestamp.c.html#LN5218"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5228"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* stuff done on every call of the function */ 
</span>    <a href="timestamp.c.html#LN5218"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * get the saved state and use current as the result for this iteration 
     */ 
</span>    <a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5218"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span>    <a href="timestamp.c.html#LN5220"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN63"><span class='Ref_to_Member'>current</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN66"><span class='Ref_to_Member'>step_sign</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>? 
</span>        <a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5220"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN64"><span class='Ref_to_Member'>finish</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><span class='Number'>0</span> <span class='Operator'>: 
</span>        <a href="../../../include/utils/timestamp.h.html#LN94"><span class='Ref_to_Proto'>timestamp_cmp_internal</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5220"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN64"><span class='Ref_to_Member'>finish</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* increment current in preparation for next iteration */ 
</span>        <a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN63"><span class='Ref_to_Member'>current</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN27"><span class='Ref_to_Macro'>DatumGetTimestampTz</span></a><span class='Parentheses'>(</span> 
                                 <a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN2879"><span class='Ref_to_Func'>timestamptz_pl_interval</span></a><span class='Delimiter'>, 
</span>                                          <a href="../../../include/utils/timestamp.h.html#LN31"><span class='Ref_to_Macro'>TimestampTzGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN63"><span class='Ref_to_Member'>current</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                              <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="timestamp.c.html#LN5219"><span class='Ref_To_Local'>fctx</span></a><span class='Operator'>-&GT;</span><a href="timestamp.c.html#LN65"><span class='Ref_to_Member'>step</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* do when there is more left to send */ 
</span>        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5218"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/timestamp.h.html#LN31"><span class='Ref_to_Macro'>TimestampTzGetDatum</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5220"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* do when there is no more left */ 
</span>        <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="timestamp.c.html#LN5218"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end generate_series_timestamptz &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>