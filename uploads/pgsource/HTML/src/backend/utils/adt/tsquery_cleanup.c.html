<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\tsquery_cleanup.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\tsquery_cleanup.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:54 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * tsquery_cleanup.c 
 *   Cleanup query from NOT values and/or stopword 
 *   Utility functions to correct work. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/tsquery_cleanup.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"tsearch/ts_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
 
<a name="LN20"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>NODE</span> 
<span class='Delimiter'>{ 
</span><a name="LN22"></a>    <span class='Control'>struct</span> <a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>*</span><span class='Declare_Member'>left</span><span class='Delimiter'>; 
</span><a name="LN23"></a>    <span class='Control'>struct</span> <a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>*</span><span class='Declare_Member'>right</span><span class='Delimiter'>; 
</span><a name="LN24"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>valnode</span><span class='Delimiter'>; 
</span><a name="LN25"></a>} <span class='Declare_Typedef'>NODE</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * make query tree from plain view of query 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>* 
</span><a name="LN31"></a><span class='Declare_Function'>maketree</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>in</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN33"></a>    <a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* since this function recurses, it could be driven to stack overflow. */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="tsquery_cleanup.c.html#LN33"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN31"><span class='Ref_to_Parameter'>in</span></a><span class='Delimiter'>; 
</span>    <a href="tsquery_cleanup.c.html#LN33"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN33"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN31"><span class='Ref_to_Parameter'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN143"><span class='Ref_to_Const'>QI_OPR</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsquery_cleanup.c.html#LN33"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN30"><span class='Ref_to_Func'>maketree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN31"><span class='Ref_to_Parameter'>in</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN31"><span class='Ref_to_Parameter'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>!= </span><a href="../../../include/tsearch/ts_type.h.html#LN174"><span class='Ref_to_Const'>OP_NOT</span></a><span class='Parentheses'>) 
</span>            <a href="tsquery_cleanup.c.html#LN33"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN30"><span class='Ref_to_Func'>maketree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN31"><span class='Ref_to_Parameter'>in</span></a> <span class='Operator'>+ </span><a href="tsquery_cleanup.c.html#LN31"><span class='Ref_to_Parameter'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN192"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN33"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Internal state for plaintree and plainnode 
 */ 
</span><span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN54"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>ptr</span><span class='Delimiter'>; 
</span><a name="LN55"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>len</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* allocated size of ptr */ 
</span><a name="LN56"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>cur</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* number of elements in ptr */ 
</span><a name="LN57"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>PLAINTREE</span><span class='Delimiter'>; 
</span> 
<span class='Keyword'>static void 
</span><a name="LN60"></a><span class='Declare_Function'>plainnode</span><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN52"><span class='Ref_to_Typedef'>PLAINTREE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* since this function recurses, it could be driven to stack overflow. */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a> <span class='Operator'>== </span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN55"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN55"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN54"><span class='Ref_to_Member'>ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN54"><span class='Ref_to_Member'>ptr</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN55"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    memcpy<span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN54"><span class='Ref_to_Member'>ptr</span></a><span class='Delimiter'>[</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a><span class='Parentheses'>) 
</span>        <a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN174"><span class='Ref_to_Const'>OP_NOT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN54"><span class='Ref_to_Member'>ptr</span></a><span class='Delimiter'>[</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN192"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN59"><span class='Ref_to_Func'>plainnode</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN81"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>cur</span> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a><span class='Delimiter'>; 
</span> 
        <a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN59"><span class='Ref_to_Func'>plainnode</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN54"><span class='Ref_to_Member'>ptr</span></a><span class='Delimiter'>[</span><a href="tsquery_cleanup.c.html#LN81"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN192"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a> <span class='Operator'>- </span><a href="tsquery_cleanup.c.html#LN81"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN59"><span class='Ref_to_Func'>plainnode</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN60"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end plainnode &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * make plain view of tree from a NODE-tree representation 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a> <span class='Operator'>* 
</span><a name="LN95"></a><span class='Declare_Function'>plaintree</span><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN97"></a>    <a href="tsquery_cleanup.c.html#LN52"><span class='Ref_to_Typedef'>PLAINTREE</span></a>   <span class='Declare_Local'>pl</span><span class='Delimiter'>; 
</span> 
    <a href="tsquery_cleanup.c.html#LN97"><span class='Ref_To_Local'>pl</span></a><span class='Operator'>.</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="tsquery_cleanup.c.html#LN97"><span class='Ref_To_Local'>pl</span></a><span class='Operator'>.</span><a href="tsquery_cleanup.c.html#LN55"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><span class='Number'>16</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN95"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN95"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a> <span class='Operator'>|| </span><a href="tsquery_cleanup.c.html#LN95"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN143"><span class='Ref_to_Const'>QI_OPR</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tsquery_cleanup.c.html#LN97"><span class='Ref_To_Local'>pl</span></a><span class='Operator'>.</span><a href="tsquery_cleanup.c.html#LN54"><span class='Ref_to_Member'>ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN97"><span class='Ref_To_Local'>pl</span></a><span class='Operator'>.</span><a href="tsquery_cleanup.c.html#LN55"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN59"><span class='Ref_to_Func'>plainnode</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tsquery_cleanup.c.html#LN97"><span class='Ref_To_Local'>pl</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN95"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="tsquery_cleanup.c.html#LN97"><span class='Ref_To_Local'>pl</span></a><span class='Operator'>.</span><a href="tsquery_cleanup.c.html#LN54"><span class='Ref_to_Member'>ptr</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN95"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN97"><span class='Ref_To_Local'>pl</span></a><span class='Operator'>.</span><a href="tsquery_cleanup.c.html#LN56"><span class='Ref_to_Member'>cur</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN97"><span class='Ref_To_Local'>pl</span></a><span class='Operator'>.</span><a href="tsquery_cleanup.c.html#LN54"><span class='Ref_to_Member'>ptr</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static void 
</span><a name="LN113"></a><span class='Declare_Function'>freetree</span><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* since this function recurses, it could be driven to stack overflow. */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsquery_cleanup.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>) 
</span>        <a href="tsquery_cleanup.c.html#LN112"><span class='Ref_to_Func'>freetree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Parentheses'>) 
</span>        <a href="tsquery_cleanup.c.html#LN112"><span class='Ref_to_Func'>freetree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN113"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * clean tree for ! operator. 
 * It's useful for debug, but in 
 * other case, such view is used with search in index. 
 * Operator ! always return TRUE 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>* 
</span><a name="LN134"></a><span class='Declare_Function'>clean_NOT_intree</span><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* since this function recurses, it could be driven to stack overflow. */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN174"><span class='Ref_to_Const'>OP_NOT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsquery_cleanup.c.html#LN112"><span class='Ref_to_Func'>freetree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* operator & or | */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN176"><span class='Ref_to_Const'>OP_OR</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN133"><span class='Ref_to_Func'>clean_NOT_intree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>            <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN133"><span class='Ref_to_Func'>clean_NOT_intree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tsquery_cleanup.c.html#LN112"><span class='Ref_to_Func'>freetree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN160"></a>        <a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN175"><span class='Ref_to_Const'>OP_AND</span></a> <span class='Operator'>|| 
</span>               <a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN177"><span class='Ref_to_Const'>OP_PHRASE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN133"><span class='Ref_to_Func'>clean_NOT_intree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN133"><span class='Ref_to_Func'>clean_NOT_intree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsquery_cleanup.c.html#LN160"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsquery_cleanup.c.html#LN160"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsquery_cleanup.c.html#LN160"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN160"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN134"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end clean_NOT_intree &raquo; </span> 
 
<a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a> <span class='Operator'>* 
</span><a name="LN188"></a><span class='Declare_Function'>clean_NOT</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN190"></a>    <a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>root</span> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN30"><span class='Ref_to_Func'>maketree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN188"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN94"><span class='Ref_to_Func'>plaintree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN133"><span class='Ref_to_Func'>clean_NOT_intree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN190"><span class='Ref_To_Local'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN188"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Remove QI_VALSTOP (stopword) nodes from query tree. 
 * 
 * Returns NULL if the query degenerates to nothing.  Input must not be NULL. 
 * 
 * When we remove a phrase operator due to removing one or both of its 
 * arguments, we might need to adjust the distance of a parent phrase 
 * operator.  For example, 'a' is a stopword, so: 
 *      (b &LT;-&GT; a) &LT;-&GT; c  should become  b &LT;2&GT; c 
 *      b &LT;-&GT; (a &LT;-&GT; c)  should become  b &LT;2&GT; c 
 *      (b &LT;-&GT; (a &LT;-&GT; a)) &LT;-&GT; c  should become  b &LT;3&GT; c 
 *      b &LT;-&GT; ((a &LT;-&GT; a) &LT;-&GT; c)  should become  b &LT;3&GT; c 
 * To handle that, we define two output parameters: 
 *      ladd: amount to add to a phrase distance to the left of this node 
 *      radd: amount to add to a phrase distance to the right of this node 
 * We need two outputs because we could need to bubble up adjustments to two 
 * different parent phrase operators.  Consider 
 *      w &LT;-&GT; (((a &LT;-&GT; x) &LT;2&GT; (y &LT;3&GT; a)) &LT;-&GT; z) 
 * After we've removed the two a's and are considering the &LT;2&GT; node (which is 
 * now just x &LT;2&GT; y), we have an ladd distance of 1 that needs to propagate 
 * up to the topmost (leftmost) &LT;-&GT;, and an radd distance of 3 that needs to 
 * propagate to the rightmost &LT;-&GT;, so that we'll end up with 
 *      w &LT;2&GT; ((x &LT;2&GT; y) &LT;4&GT; z) 
 * Near the bottom of the tree, we may have subtrees consisting only of 
 * stopwords.  The distances of any phrase operators within such a subtree are 
 * summed and propagated to both ladd and radd, since we don't know which side 
 * of the lowest surviving phrase operator we are in.  The rule is that any 
 * subtree that degenerates to NULL must return equal values of ladd and radd, 
 * and the parent node dealing with it should incorporate only one of those. 
 * 
 * Currently, we only implement this adjustment for adjacent phrase operators. 
 * Thus for example 'x &LT;-&GT; ((a &LT;-&GT; y) | z)' will become 'x &LT;-&GT; (y | z)', which 
 * isn't ideal, but there is no way to represent the really desired semantics 
 * without some redesign of the tsquery structure.  Certainly it would not be 
 * any better to convert that to 'x &LT;2&GT; (y | z)'.  Since this is such a weird 
 * corner case, let it go for now.  But we can fix it in cases where the 
 * intervening non-phrase operator also gets removed, for example 
 * '((x &LT;-&GT; a) | a) &LT;-&GT; y' will become 'x &LT;2&GT; y'. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>* 
</span><a name="LN236"></a><span class='Declare_Function'>clean_stopword_intree</span><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>ladd</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>radd</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* since this function recurses, it could be driven to stack overflow. */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* default output parameters indicate no change in parent distance */ 
</span>    <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>ladd</span></a> <span class='Operator'>= *</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>radd</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN144"><span class='Ref_to_Const'>QI_VALSTOP</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN143"><span class='Ref_to_Const'>QI_OPR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN174"><span class='Ref_to_Const'>OP_NOT</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* NOT doesn't change pattern width, so just report child distances */ 
</span>        <a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN235"><span class='Ref_to_Func'>clean_stopword_intree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>ladd</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>radd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsquery_cleanup.c.html#LN112"><span class='Ref_to_Func'>freetree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN266"></a>        <a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span><a name="LN267"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isphrase</span><span class='Delimiter'>; 
</span><a name="LN268"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>ndistance</span><span class='Delimiter'>, 
</span><a name="LN269"></a>                    <span class='Declare_Local'>lladd</span><span class='Delimiter'>, 
</span><a name="LN270"></a>                    <span class='Declare_Local'>lradd</span><span class='Delimiter'>, 
</span><a name="LN271"></a>                    <span class='Declare_Local'>rladd</span><span class='Delimiter'>, 
</span><a name="LN272"></a>                    <span class='Declare_Local'>rradd</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* First, recurse */ 
</span>        <a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN235"><span class='Ref_to_Func'>clean_stopword_intree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_cleanup.c.html#LN269"><span class='Ref_To_Local'>lladd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_cleanup.c.html#LN270"><span class='Ref_To_Local'>lradd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN235"><span class='Ref_to_Func'>clean_stopword_intree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_cleanup.c.html#LN271"><span class='Ref_To_Local'>rladd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_cleanup.c.html#LN272"><span class='Ref_To_Local'>rradd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check if current node is OP_PHRASE, get its distance */ 
</span>        <a href="tsquery_cleanup.c.html#LN267"><span class='Ref_To_Local'>isphrase</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN177"><span class='Ref_to_Const'>OP_PHRASE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN268"><span class='Ref_To_Local'>ndistance</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN267"><span class='Ref_To_Local'>isphrase</span></a> <span class='Operator'>? </span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN191"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>&& </span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * When we collapse out a phrase node entirely, propagate its own 
             * distance into both *ladd and *radd; it is the responsibility of 
             * the parent node to count it only once.  Also, for a phrase 
             * node, distances coming from children are summed and propagated 
             * up to parent (we assume lladd == lradd and rladd == rradd, else 
             * rule was broken at a lower level).  But if this isn't a phrase 
             * node, take the larger of the two child distances; that 
             * corresponds to what TS_execute will do in non-stopword cases. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN267"><span class='Ref_To_Local'>isphrase</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>ladd</span></a> <span class='Operator'>= *</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>radd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN269"><span class='Ref_To_Local'>lladd</span></a> <span class='Operator'>+ </span><a href="tsquery_cleanup.c.html#LN268"><span class='Ref_To_Local'>ndistance</span></a> <span class='Operator'>+ </span><a href="tsquery_cleanup.c.html#LN271"><span class='Ref_To_Local'>rladd</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>ladd</span></a> <span class='Operator'>= *</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>radd</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN269"><span class='Ref_To_Local'>lladd</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN271"><span class='Ref_To_Local'>rladd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsquery_cleanup.c.html#LN112"><span class='Ref_to_Func'>freetree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Removing this operator and left subnode */ 
</span>            <span class='Comment_Multi_Line'>/* lladd and lradd are equal/redundant, don't count both */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN267"><span class='Ref_To_Local'>isphrase</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* operator's own distance must propagate to left */ 
</span>                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>ladd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN269"><span class='Ref_To_Local'>lladd</span></a> <span class='Operator'>+ </span><a href="tsquery_cleanup.c.html#LN268"><span class='Ref_To_Local'>ndistance</span></a> <span class='Operator'>+ </span><a href="tsquery_cleanup.c.html#LN271"><span class='Ref_To_Local'>rladd</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>radd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN272"><span class='Ref_To_Local'>rradd</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* at non-phrase op, just forget the left subnode entirely */ 
</span>                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>ladd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN271"><span class='Ref_To_Local'>rladd</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>radd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN272"><span class='Ref_To_Local'>rradd</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="tsquery_cleanup.c.html#LN266"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Removing this operator and right subnode */ 
</span>            <span class='Comment_Multi_Line'>/* rladd and rradd are equal/redundant, don't count both */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN267"><span class='Ref_To_Local'>isphrase</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* operator's own distance must propagate to right */ 
</span>                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>ladd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN269"><span class='Ref_To_Local'>lladd</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>radd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN270"><span class='Ref_To_Local'>lradd</span></a> <span class='Operator'>+ </span><a href="tsquery_cleanup.c.html#LN268"><span class='Ref_To_Local'>ndistance</span></a> <span class='Operator'>+ </span><a href="tsquery_cleanup.c.html#LN272"><span class='Ref_To_Local'>rradd</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* at non-phrase op, just forget the right subnode entirely */ 
</span>                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>ladd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN269"><span class='Ref_To_Local'>lladd</span></a><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>radd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN270"><span class='Ref_To_Local'>lradd</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="tsquery_cleanup.c.html#LN266"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN267"><span class='Ref_To_Local'>isphrase</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Absorb appropriate corrections at this level */ 
</span>            <a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN191"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>+= </span><a href="tsquery_cleanup.c.html#LN270"><span class='Ref_To_Local'>lradd</span></a> <span class='Operator'>+ </span><a href="tsquery_cleanup.c.html#LN271"><span class='Ref_To_Local'>rladd</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Propagate up any unaccounted-for corrections */ 
</span>            <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>ladd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN269"><span class='Ref_To_Local'>lladd</span></a><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>radd</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN272"><span class='Ref_To_Local'>rradd</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* We're keeping a non-phrase operator, so ladd/radd remain 0 */ 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN266"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN236"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end clean_stopword_intree &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Number of elements in query tree 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN361"></a><span class='Declare_Function'>calcstrlen</span><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN363"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>size</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN361"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsquery_cleanup.c.html#LN363"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN361"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN205"><span class='Ref_to_Member'>qoperand</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN166"><span class='Ref_to_Member'>length</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN361"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN143"><span class='Ref_to_Const'>QI_OPR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tsquery_cleanup.c.html#LN363"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN360"><span class='Ref_to_Func'>calcstrlen</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN361"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN23"><span class='Ref_to_Member'>right</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN361"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN24"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>!= </span><a href="../../../include/tsearch/ts_type.h.html#LN174"><span class='Ref_to_Const'>OP_NOT</span></a><span class='Parentheses'>) 
</span>            <a href="tsquery_cleanup.c.html#LN363"><span class='Ref_To_Local'>size</span></a> <span class='Operator'>+= </span><a href="tsquery_cleanup.c.html#LN360"><span class='Ref_to_Func'>calcstrlen</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN361"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="tsquery_cleanup.c.html#LN22"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN363"><span class='Ref_To_Local'>size</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end calcstrlen &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Remove QI_VALSTOP (stopword) nodes from TSQuery. 
 */ 
</span><a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a> 
<a name="LN385"></a><span class='Declare_Function'>cleanup_tsquery_stopwords</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a> <span class='Declare_Parameter'>in</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN387"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>len</span><span class='Delimiter'>, 
</span><a name="LN388"></a>                <span class='Declare_Local'>lenstr</span><span class='Delimiter'>, 
</span><a name="LN389"></a>                <span class='Declare_Local'>commonlen</span><span class='Delimiter'>, 
</span><a name="LN390"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN391"></a>    <a href="../../../../contrib/ltree/ltxtquery_io.c.html#LN26"><span class='Ref_to_Struct'>NODE</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>root</span><span class='Delimiter'>; 
</span><a name="LN392"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ladd</span><span class='Delimiter'>, 
</span><a name="LN393"></a>                <span class='Declare_Local'>radd</span><span class='Delimiter'>; 
</span><a name="LN394"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN395"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>items</span><span class='Delimiter'>; 
</span><a name="LN396"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>operands</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN385"><span class='Ref_to_Parameter'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN385"><span class='Ref_to_Parameter'>in</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* eliminate stop words */ 
</span>    <a href="tsquery_cleanup.c.html#LN391"><span class='Ref_To_Local'>root</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN235"><span class='Ref_to_Func'>clean_stopword_intree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN30"><span class='Ref_to_Func'>maketree</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN385"><span class='Ref_to_Parameter'>in</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_cleanup.c.html#LN392"><span class='Ref_To_Local'>ladd</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_cleanup.c.html#LN393"><span class='Ref_To_Local'>radd</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN391"><span class='Ref_To_Local'>root</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"text-search query contains only stop words or doesn't contain lexemes, ignored"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN222"><span class='Ref_to_Const'>HDRSIZETQ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN222"><span class='Ref_to_Const'>HDRSIZETQ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Build TSQuery from plain view 
     */ 
</span> 
    <a href="tsquery_cleanup.c.html#LN388"><span class='Ref_To_Local'>lenstr</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN360"><span class='Ref_to_Func'>calcstrlen</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN391"><span class='Ref_To_Local'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsquery_cleanup.c.html#LN395"><span class='Ref_To_Local'>items</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN94"><span class='Ref_to_Func'>plaintree</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN391"><span class='Ref_To_Local'>root</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_cleanup.c.html#LN387"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsquery_cleanup.c.html#LN389"><span class='Ref_To_Local'>commonlen</span></a> <span class='Operator'>= </span><a href="../../../../contrib/ltree/ltree.h.html#LN113"><span class='Ref_to_Macro'>COMPUTESIZE</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN387"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN388"><span class='Ref_To_Local'>lenstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN389"><span class='Ref_To_Local'>commonlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN389"><span class='Ref_To_Local'>commonlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN387"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN395"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN387"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tsquery_cleanup.c.html#LN395"><span class='Ref_To_Local'>items</span></a> <span class='Operator'>= </span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsquery_cleanup.c.html#LN396"><span class='Ref_To_Local'>operands</span></a> <span class='Operator'>= </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN390"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsquery_cleanup.c.html#LN390"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; </span><a href="tsquery_cleanup.c.html#LN390"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN431"></a>        <a href="../../../include/tsearch/ts_type.h.html#LN151"><span class='Ref_to_Typedef'>QueryOperand</span></a> <span class='Operator'>*</span><span class='Declare_Local'>op</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN151"><span class='Ref_to_Typedef'>QueryOperand</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="tsquery_cleanup.c.html#LN395"><span class='Ref_To_Local'>items</span></a><span class='Delimiter'>[</span><a href="tsquery_cleanup.c.html#LN390"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN431"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN153"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN396"><span class='Ref_To_Local'>operands</span></a><span class='Delimiter'>, </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN385"><span class='Ref_to_Parameter'>in</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsquery_cleanup.c.html#LN431"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN167"><span class='Ref_to_Member'>distance</span></a><span class='Delimiter'>, </span><a href="tsquery_cleanup.c.html#LN431"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN166"><span class='Ref_to_Member'>length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN396"><span class='Ref_To_Local'>operands</span></a><span class='Delimiter'>[</span><a href="tsquery_cleanup.c.html#LN431"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN166"><span class='Ref_to_Member'>length</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN431"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN167"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>= </span><a href="tsquery_cleanup.c.html#LN396"><span class='Ref_To_Local'>operands</span></a> <span class='Operator'>- </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_cleanup.c.html#LN396"><span class='Ref_To_Local'>operands</span></a> <span class='Operator'>+= </span><a href="tsquery_cleanup.c.html#LN431"><span class='Ref_To_Local'>op</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN166"><span class='Ref_to_Member'>length</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tsquery_cleanup.c.html#LN394"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end cleanup_tsquery_stopwords &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>