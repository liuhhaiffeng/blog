<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\tsquery_rewrite.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\tsquery_rewrite.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:54 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * tsquery_rewrite.c 
 *    Utilities for reconstructing tsquery 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/tsquery_rewrite.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/spi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tsearch/ts_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * If "node" is equal to "ex", return a copy of "subs" instead. 
 * If "ex" matches a subset of node's children, return a modified version 
 * of "node" in which those children are replaced with a copy of "subs". 
 * Otherwise return "node" unmodified. 
 * 
 * The QTN_NOCHANGE bit is set in successfully modified nodes, so that 
 * we won't uselessly recurse into them. 
 * Also, set *isfind true if we make a replacement. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>* 
</span><a name="LN34"></a><span class='Declare_Function'>findeq</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>node</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ex</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subs</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isfind</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Can't match unless signature matches and node type matches. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN206"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>& </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN206"><span class='Ref_to_Member'>sign</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN206"><span class='Ref_to_Member'>sign</span></a> <span class='Operator'>|| 
</span>        <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>!= </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Ignore nodes marked NOCHANGE, too. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN203"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/tsearch/ts_utils.h.html#LN212"><span class='Ref_to_Const'>QTN_NOCHANGE</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN143"><span class='Ref_to_Const'>QI_OPR</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Must be same operator. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>!= </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>== </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Simple case: when same number of children, match if equal. 
             * (This is reliable when the children were sorted earlier.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_util.c.html#LN180"><span class='Ref_to_Func'>QTNEq</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Match; delete node and return a copy of subs instead. */ 
</span>                <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>subs</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN232"><span class='Ref_to_Proto'>QTNCopy</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>subs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN203"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="../../../include/tsearch/ts_utils.h.html#LN212"><span class='Ref_to_Const'>QTN_NOCHANGE</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>isfind</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;nchild==ex-&GT;nch... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>&GT; </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>&& </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * AND and OR are commutative/associative, so we should check if a 
             * subset of the children match.  For example, if node is A|B|C, 
             * and ex is B|C, we have a match after we notionally convert node 
             * to A|(B|C).  This does not work for NOT or PHRASE nodes, but we 
             * can't get here for those node types because they have a fixed 
             * number of children. 
             * 
             * Because we expect that the children are sorted, it suffices to 
             * make one pass through the two lists to find the matches. 
             */ 
</span><a name="LN84"></a>            <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>matched</span><span class='Delimiter'>; 
</span><a name="LN85"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>nmatched</span><span class='Delimiter'>; 
</span><a name="LN86"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN87"></a>                        <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Assert that the subset rule is OK */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN175"><span class='Ref_to_Const'>OP_AND</span></a> <span class='Operator'>|| 
</span>                   <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN176"><span class='Ref_to_Const'>OP_OR</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* matched[] will record which children of node matched */ 
</span>            <a href="tsquery_rewrite.c.html#LN84"><span class='Ref_To_Local'>matched</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="tsquery_rewrite.c.html#LN85"><span class='Ref_To_Local'>nmatched</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN87"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>&& </span><a href="tsquery_rewrite.c.html#LN87"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN99"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span> <span class='Operator'>= </span><a href="tsquery_util.c.html#LN94"><span class='Ref_to_Func'>QTNodeCompare</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN87"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN99"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* match! */ 
</span>                    <a href="tsquery_rewrite.c.html#LN84"><span class='Ref_To_Local'>matched</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <a href="tsquery_rewrite.c.html#LN85"><span class='Ref_To_Local'>nmatched</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                    <a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN87"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN99"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* node-&GT;child[i] has no match, ignore it */ 
</span>                    <a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* ex-&GT;child[j] has no match; we can give up immediately */ 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while i&LT;node-&GT;nchild&&j&LT;ex-... &raquo; </span> 
 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN85"><span class='Ref_To_Local'>nmatched</span></a> <span class='Operator'>== </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* collapse out the matched children of node */ 
</span>                <a href="tsquery_rewrite.c.html#LN87"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a><span class='Delimiter'>; </span><a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN84"><span class='Ref_To_Local'>matched</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                        <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN87"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN86"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* and instead insert a copy of subs */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>subs</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>subs</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN232"><span class='Ref_to_Proto'>QTNCopy</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>subs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>subs</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN203"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="../../../include/tsearch/ts_utils.h.html#LN212"><span class='Ref_to_Const'>QTN_NOCHANGE</span></a><span class='Delimiter'>; 
</span>                    <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN87"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>subs</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN87"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * At this point we might have a node with zero or one child, 
                 * which should be simplified.  But we leave it to our caller 
                 * (dofindsubquery) to take care of that. 
                 */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Re-sort the node to put new child in the right place.  This 
                 * is a bit bogus, because it won't matter for findsubquery's 
                 * remaining processing, and it's insufficient to prepare the 
                 * tree for another search (we would need to re-flatten as 
                 * well, and we don't want to do that because we'd lose the 
                 * QTN_NOCHANGE marking on the new child).  But it's needed to 
                 * keep the results the same as the regression tests expect. 
                 */ 
</span>                <a href="tsquery_util.c.html#LN160"><span class='Ref_to_Func'>QTNSort</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Operator'>*</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>isfind</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if nmatched==ex-&GT;nchild &raquo; </span> 
 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN84"><span class='Ref_To_Local'>matched</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;nchild&GT;ex-&GT;nchi... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;valnode-&GT;type==... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN205"><span class='Ref_to_Member'>qoperand</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN159"><span class='Ref_to_Member'>valcrc</span></a> <span class='Operator'>!= </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN205"><span class='Ref_to_Member'>qoperand</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN159"><span class='Ref_to_Member'>valcrc</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_util.c.html#LN180"><span class='Ref_to_Func'>QTNEq</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>ex</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>subs</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN232"><span class='Ref_to_Proto'>QTNCopy</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>subs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN203"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>|= </span><a href="../../../include/tsearch/ts_utils.h.html#LN212"><span class='Ref_to_Const'>QTN_NOCHANGE</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Operator'>*</span><a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>isfind</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="tsquery_rewrite.c.html#LN34"><span class='Ref_to_Parameter'>node</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end findeq &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Recursive guts of findsubquery(): attempt to replace "ex" with "subs" 
 * at the root node, and if we failed to do so, recursively match against 
 * child nodes. 
 * 
 * Delete any void subtrees resulting from the replacement. 
 * In the following example '5' is replaced by empty operand: 
 * 
 *    AND       -&GT;    6 
 *   /   \ 
 *  5    OR 
 *      /  \ 
 *     6    5 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>* 
</span><a name="LN205"></a><span class='Declare_Function'>dofindsubquery</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ex</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subs</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isfind</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* since this function recurses, it could be driven to stack overflow. */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* also, since it's a bit expensive, let's check for query cancel. */ 
</span>    <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* match at the node itself */ 
</span>    <a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN33"><span class='Ref_to_Func'>findeq</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>ex</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>subs</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>isfind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* unless we matched here, consider matches at child nodes */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN203"><span class='Ref_to_Member'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/tsearch/ts_utils.h.html#LN212"><span class='Ref_to_Const'>QTN_NOCHANGE</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN143"><span class='Ref_to_Const'>QI_OPR</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN220"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN221"></a>                    <span class='Declare_Local'>j</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Any subtrees that are replaced by NULL must be dropped from the 
         * tree. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN220"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsquery_rewrite.c.html#LN220"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a><span class='Delimiter'>; </span><a href="tsquery_rewrite.c.html#LN220"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN221"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN204"><span class='Ref_to_Func'>dofindsubquery</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN220"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>ex</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>subs</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>isfind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN221"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="tsquery_rewrite.c.html#LN221"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN221"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If we have just zero or one remaining child node, simplify out this 
         * operator node. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN204"><span class='Ref_to_Member'>nchild</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN202"><span class='Ref_to_Member'>valnode</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>!= </span><a href="../../../include/tsearch/ts_type.h.html#LN174"><span class='Ref_to_Const'>OP_NOT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN247"></a>            <a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>nroot</span> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN207"><span class='Ref_to_Member'>child</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN247"><span class='Ref_To_Local'>nroot</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if root&&(root-&GT;flags&QT... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="tsquery_rewrite.c.html#LN205"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end dofindsubquery &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Substitute "subs" for "ex" throughout the QTNode tree at root. 
 * 
 * If isfind isn't NULL, set *isfind to show whether we made any substitution. 
 * 
 * Both "root" and "ex" must have been through QTNTernary and QTNSort 
 * to ensure reliable matching. 
 */ 
</span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>* 
</span><a name="LN266"></a><span class='Declare_Function'>findsubquery</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>root</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ex</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>subs</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isfind</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN268"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>DidFind</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="tsquery_rewrite.c.html#LN266"><span class='Ref_to_Parameter'>root</span></a> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN204"><span class='Ref_to_Func'>dofindsubquery</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN266"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN266"><span class='Ref_to_Parameter'>ex</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN266"><span class='Ref_to_Parameter'>subs</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_rewrite.c.html#LN268"><span class='Ref_To_Local'>DidFind</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN266"><span class='Ref_to_Parameter'>isfind</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="tsquery_rewrite.c.html#LN266"><span class='Ref_to_Parameter'>isfind</span></a> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN268"><span class='Ref_To_Local'>DidFind</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tsquery_rewrite.c.html#LN266"><span class='Ref_to_Parameter'>root</span></a><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN279"></a><span class='Declare_Function'>tsquery_rewrite_query</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN281"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN247"><span class='Ref_to_Macro'>PG_GETARG_TSQUERY_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN282"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN283"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>rewrited</span> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN281"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>; 
</span><a name="LN284"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>outercontext</span> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span><a name="LN285"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN286"></a>    <a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>tree</span><span class='Delimiter'>; 
</span><a name="LN287"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN288"></a>    <a href="../../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN289"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN290"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN281"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN282"><span class='Ref_To_Local'>in</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN283"><span class='Ref_To_Local'>rewrited</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a> <span class='Operator'>= </span><a href="tsquery_util.c.html#LN22"><span class='Ref_to_Func'>QT2QTN</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN281"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN281"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tsquery_util.c.html#LN198"><span class='Ref_to_Func'>QTNTernary</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsquery_util.c.html#LN160"><span class='Ref_to_Func'>QTNSort</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsquery_rewrite.c.html#LN287"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN282"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsquery_rewrite.c.html#LN288"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN99"><span class='Ref_to_Proto'>SPI_prepare</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN287"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_prepare(\"%s\") failed"</span><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN287"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsquery_rewrite.c.html#LN289"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN138"><span class='Ref_to_Proto'>SPI_cursor_open</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN288"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_cursor_open(\"%s\") failed"</span><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN287"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN148"><span class='Ref_to_Proto'>SPI_cursor_fetch</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN289"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>!= </span><span class='Number'>2</span> <span class='Operator'>|| 
</span>        <a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN72"><span class='Ref_to_Const'>TSQUERYOID</span></a> <span class='Operator'>|| 
</span>        <a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN72"><span class='Ref_to_Const'>TSQUERYOID</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ts_rewrite query must return two tsquery columns"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN324"></a>        <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN324"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsquery_rewrite.c.html#LN324"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>&& </span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Delimiter'>; </span><a href="tsquery_rewrite.c.html#LN324"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN328"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>qdata</span> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN324"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_rewrite.c.html#LN290"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN329"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>sdata</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN290"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
            <a href="tsquery_rewrite.c.html#LN329"><span class='Ref_To_Local'>sdata</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><a href="tsquery_rewrite.c.html#LN324"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsquery_rewrite.c.html#LN290"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsquery_rewrite.c.html#LN290"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN338"></a>                <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>qtex</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN243"><span class='Ref_to_Macro'>DatumGetTSQuery</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN328"><span class='Ref_To_Local'>qdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN339"></a>                <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>qtsubs</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN243"><span class='Ref_to_Macro'>DatumGetTSQuery</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN329"><span class='Ref_To_Local'>sdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN340"></a>                <a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>qex</span><span class='Delimiter'>, 
</span><a name="LN341"></a>                           <span class='Operator'>*</span><span class='Declare_Local'>qsubs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN338"><span class='Ref_To_Local'>qtex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN338"><span class='Ref_To_Local'>qtex</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN328"><span class='Ref_To_Local'>qdata</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN338"><span class='Ref_To_Local'>qtex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN339"><span class='Ref_To_Local'>qtsubs</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN329"><span class='Ref_To_Local'>sdata</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN339"><span class='Ref_To_Local'>qtsubs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="tsquery_rewrite.c.html#LN340"><span class='Ref_To_Local'>qex</span></a> <span class='Operator'>= </span><a href="tsquery_util.c.html#LN22"><span class='Ref_to_Func'>QT2QTN</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN338"><span class='Ref_To_Local'>qtex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN338"><span class='Ref_To_Local'>qtex</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="tsquery_util.c.html#LN198"><span class='Ref_to_Func'>QTNTernary</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN340"><span class='Ref_To_Local'>qex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsquery_util.c.html#LN160"><span class='Ref_to_Func'>QTNSort</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN340"><span class='Ref_To_Local'>qex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN339"><span class='Ref_To_Local'>qtsubs</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>                    <a href="tsquery_rewrite.c.html#LN341"><span class='Ref_To_Local'>qsubs</span></a> <span class='Operator'>= </span><a href="tsquery_util.c.html#LN22"><span class='Ref_to_Func'>QT2QTN</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN339"><span class='Ref_To_Local'>qtsubs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN339"><span class='Ref_To_Local'>qtsubs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                <a href="tsquery_rewrite.c.html#LN285"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN284"><span class='Ref_To_Local'>outercontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN236"><span class='Ref_to_Proto'>findsubquery</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN340"><span class='Ref_To_Local'>qex</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN341"><span class='Ref_To_Local'>qsubs</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN285"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN340"><span class='Ref_To_Local'>qex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN338"><span class='Ref_To_Local'>qtex</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN328"><span class='Ref_To_Local'>qdata</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN338"><span class='Ref_To_Local'>qtex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN341"><span class='Ref_To_Local'>qsubs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN339"><span class='Ref_To_Local'>qtsubs</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN329"><span class='Ref_To_Local'>sdata</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN339"><span class='Ref_To_Local'>qtsubs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* ready the tree for another pass */ 
</span>                    <a href="../../../include/tsearch/ts_utils.h.html#LN233"><span class='Ref_to_Proto'>QTNClearFlags</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_utils.h.html#LN212"><span class='Ref_to_Const'>QTN_NOCHANGE</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tsquery_util.c.html#LN198"><span class='Ref_to_Func'>QTNTernary</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tsquery_util.c.html#LN160"><span class='Ref_to_Func'>QTNSort</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !isnull &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;SPI_processed&&... &raquo; </span> 
 
        <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/executor/spi.h.html#LN148"><span class='Ref_to_Proto'>SPI_cursor_fetch</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN289"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while SPI_processed&GT;0&&tree &raquo; </span> 
 
    <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN152"><span class='Ref_to_Proto'>SPI_cursor_close</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN289"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN108"><span class='Ref_to_Proto'>SPI_freeplan</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN288"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/tsearch/ts_utils.h.html#LN230"><span class='Ref_to_Proto'>QTNBinary</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_rewrite.c.html#LN283"><span class='Ref_To_Local'>rewrited</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN226"><span class='Ref_to_Proto'>QTN2QT</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN286"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN281"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN283"><span class='Ref_To_Local'>rewrited</span></a><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN222"><span class='Ref_to_Const'>HDRSIZETQ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_rewrite.c.html#LN283"><span class='Ref_To_Local'>rewrited</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN287"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN282"><span class='Ref_To_Local'>in</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN283"><span class='Ref_To_Local'>rewrited</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsquery_rewrite_query &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN409"></a><span class='Declare_Function'>tsquery_rewrite</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN411"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN247"><span class='Ref_to_Macro'>PG_GETARG_TSQUERY_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN412"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>ex</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_TSQUERY</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN413"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>subst</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_TSQUERY</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN414"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>rewrited</span> <span class='Operator'>= </span><a href="tsquery_rewrite.c.html#LN411"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>; 
</span><a name="LN415"></a>    <a href="../../../include/tsearch/ts_utils.h.html#LN200"><span class='Ref_to_Struct'>QTNode</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>tree</span><span class='Delimiter'>, 
</span><a name="LN416"></a>               <span class='Operator'>*</span><span class='Declare_Local'>qex</span><span class='Delimiter'>, 
</span><a name="LN417"></a>               <span class='Operator'>*</span><span class='Declare_Local'>subs</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN411"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="tsquery_rewrite.c.html#LN412"><span class='Ref_To_Local'>ex</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN412"><span class='Ref_To_Local'>ex</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN413"><span class='Ref_To_Local'>subst</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN414"><span class='Ref_To_Local'>rewrited</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tsquery_rewrite.c.html#LN415"><span class='Ref_To_Local'>tree</span></a> <span class='Operator'>= </span><a href="tsquery_util.c.html#LN22"><span class='Ref_to_Func'>QT2QTN</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN411"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN411"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tsquery_util.c.html#LN198"><span class='Ref_to_Func'>QTNTernary</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN415"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsquery_util.c.html#LN160"><span class='Ref_to_Func'>QTNSort</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN415"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsquery_rewrite.c.html#LN416"><span class='Ref_To_Local'>qex</span></a> <span class='Operator'>= </span><a href="tsquery_util.c.html#LN22"><span class='Ref_to_Func'>QT2QTN</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN412"><span class='Ref_To_Local'>ex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN412"><span class='Ref_To_Local'>ex</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tsquery_util.c.html#LN198"><span class='Ref_to_Func'>QTNTernary</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN416"><span class='Ref_To_Local'>qex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsquery_util.c.html#LN160"><span class='Ref_to_Func'>QTNSort</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN416"><span class='Ref_To_Local'>qex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN413"><span class='Ref_To_Local'>subst</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>        <a href="tsquery_rewrite.c.html#LN417"><span class='Ref_To_Local'>subs</span></a> <span class='Operator'>= </span><a href="tsquery_util.c.html#LN22"><span class='Ref_to_Func'>QT2QTN</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN413"><span class='Ref_To_Local'>subst</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN413"><span class='Ref_To_Local'>subst</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="tsquery_rewrite.c.html#LN415"><span class='Ref_To_Local'>tree</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN236"><span class='Ref_to_Proto'>findsubquery</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN415"><span class='Ref_To_Local'>tree</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN416"><span class='Ref_To_Local'>qex</span></a><span class='Delimiter'>, </span><a href="tsquery_rewrite.c.html#LN417"><span class='Ref_To_Local'>subs</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN416"><span class='Ref_To_Local'>qex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN417"><span class='Ref_To_Local'>subs</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsquery_rewrite.c.html#LN415"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN414"><span class='Ref_To_Local'>rewrited</span></a><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN222"><span class='Ref_to_Const'>HDRSIZETQ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_rewrite.c.html#LN414"><span class='Ref_To_Local'>rewrited</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN412"><span class='Ref_To_Local'>ex</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN413"><span class='Ref_To_Local'>subst</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN414"><span class='Ref_To_Local'>rewrited</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/tsearch/ts_utils.h.html#LN230"><span class='Ref_to_Proto'>QTNBinary</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN415"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_rewrite.c.html#LN414"><span class='Ref_To_Local'>rewrited</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN226"><span class='Ref_to_Proto'>QTN2QT</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN415"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsquery_util.c.html#LN61"><span class='Ref_to_Func'>QTNFree</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN415"><span class='Ref_To_Local'>tree</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN411"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN412"><span class='Ref_To_Local'>ex</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN413"><span class='Ref_To_Local'>subst</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsquery_rewrite.c.html#LN414"><span class='Ref_To_Local'>rewrited</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsquery_rewrite &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>