<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\tsvector_op.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\tsvector_op.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:54 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * tsvector_op.c 
 *    operations over tsvector 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/tsvector_op.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/trigger.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/spi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"funcapi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/parse_coerce.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"tsearch/ts_utils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/regproc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN35"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>arrb</span><span class='Delimiter'>; 
</span><a name="LN36"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>arre</span><span class='Delimiter'>; 
</span><a name="LN37"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>values</span><span class='Delimiter'>; 
</span><a name="LN38"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>operand</span><span class='Delimiter'>; 
</span><a name="LN39"></a>} <span class='Declare_Typedef'>CHKVAL</span><span class='Delimiter'>; 
</span> 
 
<a name="LN42"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>StatEntry</span> 
<span class='Delimiter'>{ 
</span><a name="LN44"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>ndoc</span><span class='Delimiter'>;</span>           <span class='Comment_Multi_Line'>/* zero indicates that we were already here 
                                 * while walking through the tree */ 
</span><a name="LN46"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>nentry</span><span class='Delimiter'>; 
</span><a name="LN47"></a>    <span class='Control'>struct</span> <a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a> <span class='Operator'>*</span><span class='Declare_Member'>left</span><span class='Delimiter'>; 
</span><a name="LN48"></a>    <span class='Control'>struct</span> <a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a> <span class='Operator'>*</span><span class='Declare_Member'>right</span><span class='Delimiter'>; 
</span><a name="LN49"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>lenlexeme</span><span class='Delimiter'>; 
</span><a name="LN50"></a>    <span class='Keyword'>char</span>        <span class='Declare_Member'>lexeme</span><span class='Delimiter'>[</span>FLEXIBLE_ARRAY_MEMBER<span class='Delimiter'>]; 
</span><a name="LN51"></a>} <span class='Declare_Typedef'>StatEntry</span><span class='Delimiter'>; 
</span> 
<a name="LN53"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>STATENTRYHDRSZ</span>  <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a><span class='Delimiter'>, </span>lexeme<span class='Parentheses'>))</span> 
 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN57"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Member'>weight</span><span class='Delimiter'>; 
</span> 
<a name="LN59"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>maxdepth</span><span class='Delimiter'>; 
</span> 
<a name="LN61"></a>    <a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a> <span class='Operator'>**</span><span class='Declare_Member'>stack</span><span class='Delimiter'>; 
</span><a name="LN62"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Member'>stackpos</span><span class='Delimiter'>; 
</span> 
<a name="LN64"></a>    <a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Member'>root</span><span class='Delimiter'>; 
</span><a name="LN65"></a>} <span class='Declare_Typedef'>TSVectorStat</span><span class='Delimiter'>; 
</span> 
<a name="LN67"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>STATHDRSIZE</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a><span class='Delimiter'>, </span>data<span class='Parentheses'>))</span> 
 
<a name="LN69"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>tsvector_update_trigger</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>config_column</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN70"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>tsvector_bsearch</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>tsv</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>lexeme</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lexeme_len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Order: haspos, len, word, for all positions (pos, weight) 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN76"></a><span class='Declare_Function'>silly_cmp_tsvector</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>&GT; </span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>b</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN88"></a>        <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>aptr</span> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a>        <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>bptr</span> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN90"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN91"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN90"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN90"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN90"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>!= </span><a href="tsvector_op.c.html#LN89"><span class='Ref_To_Local'>bptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>&GT; </span><a href="tsvector_op.c.html#LN89"><span class='Ref_To_Local'>bptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN91"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN184"><span class='Ref_to_Proto'>tsCompareString</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN89"><span class='Ref_To_Local'>bptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN89"><span class='Ref_To_Local'>bptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>return</span> <a href="tsvector_op.c.html#LN91"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN106"></a>                <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ap</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN119"><span class='Ref_to_Macro'>POSDATAPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a>                <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bp</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN119"><span class='Ref_to_Macro'>POSDATAPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN89"><span class='Ref_To_Local'>bptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN108"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN89"><span class='Ref_To_Local'>bptr</span></a><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN89"><span class='Ref_To_Local'>bptr</span></a><span class='Parentheses'>))</span> <span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN108"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN108"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN76"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN108"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN106"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN107"><span class='Ref_To_Local'>bp</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN106"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN107"><span class='Ref_To_Local'>bp</span></a><span class='Parentheses'>))</span> <span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN106"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN107"><span class='Ref_To_Local'>bp</span></a><span class='Parentheses'>))</span> 
                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN106"><span class='Ref_To_Local'>ap</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN107"><span class='Ref_To_Local'>bp</span></a><span class='Parentheses'>))</span> <span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="tsvector_op.c.html#LN106"><span class='Ref_To_Local'>ap</span></a><span class='Operator'>++</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN107"><span class='Ref_To_Local'>bp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if aptr-&GT;haspos &raquo; </span> 
 
            <a href="tsvector_op.c.html#LN88"><span class='Ref_To_Local'>aptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN89"><span class='Ref_To_Local'>bptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;a-&GT;size;i++ &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end silly_cmp_tsvector &raquo; </span> 
 
<a name="LN135"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>TSVECTORCMPFUNC</span><span class='Parentheses'>( </span><span class='Declare_Parameter'>type</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>action</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>ret</span> <span class='Parentheses'>)</span>            <span class='Operator'>\ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>                                                   <span class='Operator'>\ 
</span>tsvector_##<a href="tsvector_op.c.html#LN135"><span class='Ref_to_Parameter'>type</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>)</span>                       <span class='Operator'>\ 
</span><span class='Delimiter'>{</span>                                                       <span class='Operator'>\ 
</span>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    a <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>              <span class='Operator'>\ 
</span>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    b <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>              <span class='Operator'>\ 
</span>    <span class='Keyword'>int</span>         res <span class='Operator'>= </span><a href="tsvector_op.c.html#LN75"><span class='Ref_to_Func'>silly_cmp_tsvector</span></a><span class='Parentheses'>(</span>a<span class='Delimiter'>, </span>b<span class='Parentheses'>)</span><span class='Delimiter'>;</span>         <span class='Operator'>\ 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span>a<span class='Delimiter'>,</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>                               <span class='Operator'>\ 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span>b<span class='Delimiter'>,</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>                               <span class='Operator'>\ 
</span>    PG_RETURN_##<a href="tsvector_op.c.html#LN135"><span class='Ref_to_Parameter'>ret</span></a><span class='Parentheses'>( </span>res <a href="tsvector_op.c.html#LN135"><span class='Ref_to_Parameter'>action</span></a> <span class='Number'>0</span> <span class='Parentheses'>)</span><span class='Delimiter'>;</span>                    <span class='Operator'>\ 
</span><span class='Delimiter'>}</span>   <span class='Operator'>\ 
</span><span class='Comment_Multi_Line'>/* keep compiler quiet - no extra ; */</span>                  <span class='Operator'>\ 
</span><span class='Keyword'>extern int </span>no_such_variable 
 
<a name="LN149"></a><span class='Declare_Prototype'>TSVECTORCMPFUNC</span><span class='Parentheses'>(</span>lt<span class='Delimiter'>, </span><span class='Operator'>&LT;</span><span class='Delimiter'>, </span>BOOL<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN150"></a><span class='Declare_Prototype'>TSVECTORCMPFUNC</span><span class='Parentheses'>(</span>le<span class='Delimiter'>, </span><span class='Operator'>&LT;=</span><span class='Delimiter'>, </span>BOOL<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN151"></a><span class='Declare_Prototype'>TSVECTORCMPFUNC</span><span class='Parentheses'>(</span>eq<span class='Delimiter'>, </span><span class='Operator'>==</span><span class='Delimiter'>, </span>BOOL<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN152"></a><span class='Declare_Prototype'>TSVECTORCMPFUNC</span><span class='Parentheses'>(</span>ge<span class='Delimiter'>, </span><span class='Operator'>&GT;=</span><span class='Delimiter'>, </span>BOOL<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN153"></a><span class='Declare_Prototype'>TSVECTORCMPFUNC</span><span class='Parentheses'>(</span>gt<span class='Delimiter'>, </span><span class='Operator'>&GT;</span><span class='Delimiter'>, </span>BOOL<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a href="tsvector_op.c.html#LN135"><span class='Ref_to_Macro'>TSVECTORCMPFUNC</span></a><span class='Parentheses'>(</span>ne<span class='Delimiter'>, </span><span class='Operator'>!=</span><span class='Delimiter'>, </span>BOOL<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN155"></a><span class='Declare_Prototype'>TSVECTORCMPFUNC</span><span class='Parentheses'>(</span><a href="../../regex/regcomp.c.html#LN218"><span class='Ref_to_Proto'>cmp</span></a><span class='Delimiter'>, </span><span class='Operator'>+</span><span class='Delimiter'>, </span>INT32<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN158"></a><span class='Declare_Function'>tsvector_strip</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN160"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN161"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN162"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN163"></a>                <span class='Declare_Local'>len</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN164"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arrin</span> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN160"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN165"></a>               <span class='Operator'>*</span><span class='Declare_Local'>arrout</span><span class='Delimiter'>; 
</span><a name="LN166"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN160"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN163"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN164"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN163"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN71"><span class='Ref_to_Macro'>CALCDATASIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN160"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN163"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN161"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN163"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN161"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN163"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN161"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN160"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN165"><span class='Ref_To_Local'>arrout</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN161"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN166"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN161"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN160"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN166"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN160"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN164"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN164"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN165"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN165"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN164"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN165"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN166"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>- </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN161"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN166"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN165"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN162"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN160"><span class='Ref_To_Local'>in</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN161"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_strip &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN191"></a><span class='Declare_Function'>tsvector_length</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN193"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN194"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>ret</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN193"><span class='Ref_To_Local'>in</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN193"><span class='Ref_To_Local'>in</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN194"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN201"></a><span class='Declare_Function'>tsvector_setweight</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN203"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN204"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>cw</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN237"><span class='Ref_to_Macro'>PG_GETARG_CHAR</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN205"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN206"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN207"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN208"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN209"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN210"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>w</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN204"><span class='Ref_To_Local'>cw</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='String'>'A'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'a'</span><span class='Operator'>: 
</span>            <a href="tsvector_op.c.html#LN210"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'B'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>: 
</span>            <a href="tsvector_op.c.html#LN210"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>            <a href="tsvector_op.c.html#LN210"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>            <a href="tsvector_op.c.html#LN210"><span class='Ref_To_Local'>w</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* internal error */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized weight: %d"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN204"><span class='Ref_To_Local'>cw</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cw &raquo; </span> 
 
    <a href="tsvector_op.c.html#LN205"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN203"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN205"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN203"><span class='Ref_To_Local'>in</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN203"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN208"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN205"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN206"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN205"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN206"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN207"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN205"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN208"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN209"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN119"><span class='Ref_to_Macro'>POSDATAPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN205"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN208"><span class='Ref_To_Local'>entry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN207"><span class='Ref_To_Local'>j</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/tsearch/ts_type.h.html#LN81"><span class='Ref_to_Macro'>WEP_SETWEIGHT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN209"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN210"><span class='Ref_To_Local'>w</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN209"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="tsvector_op.c.html#LN208"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN203"><span class='Ref_To_Local'>in</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN205"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_setweight &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * setweight(tsin tsvector, char_weight "char", lexemes "text"[]) 
 * 
 * Assign weight w to elements of tsin that are listed in lexemes. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN263"></a><span class='Declare_Function'>tsvector_setweight_by_filter</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN265"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>tsin</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN266"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>char_weight</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN237"><span class='Ref_to_Macro'>PG_GETARG_CHAR</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN267"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>lexemes</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN269"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>tsout</span><span class='Delimiter'>; 
</span><a name="LN270"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN271"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN272"></a>                <span class='Declare_Local'>nlexemes</span><span class='Delimiter'>, 
</span><a name="LN273"></a>                <span class='Declare_Local'>weight</span><span class='Delimiter'>; 
</span><a name="LN274"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span><a name="LN275"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dlexemes</span><span class='Delimiter'>; 
</span><a name="LN276"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN266"><span class='Ref_To_Local'>char_weight</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='String'>'A'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'a'</span><span class='Operator'>: 
</span>            <a href="tsvector_op.c.html#LN273"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'B'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>: 
</span>            <a href="tsvector_op.c.html#LN273"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>            <a href="tsvector_op.c.html#LN273"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>        <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>            <a href="tsvector_op.c.html#LN273"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* internal error */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized weight: %c"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN266"><span class='Ref_To_Local'>char_weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch char_weight &raquo; </span> 
 
    <a href="tsvector_op.c.html#LN269"><span class='Ref_To_Local'>tsout</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN265"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN269"><span class='Ref_To_Local'>tsout</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN265"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN265"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN274"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN269"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN267"><span class='Ref_To_Local'>lexemes</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="tsvector_op.c.html#LN275"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN276"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN272"><span class='Ref_To_Local'>nlexemes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Assuming that lexemes array is significantly shorter than tsvector we 
     * can iterate through lexemes performing binary search of each lexeme 
     * from lexemes in tsvector. 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN270"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN270"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN272"><span class='Ref_To_Local'>nlexemes</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN270"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN315"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lex</span><span class='Delimiter'>; 
</span><a name="LN316"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_len</span><span class='Delimiter'>, 
</span><a name="LN317"></a>                    <span class='Declare_Local'>lex_pos</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN276"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN270"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"lexeme array may not contain nulls"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN315"><span class='Ref_To_Local'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN275"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN270"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN316"><span class='Ref_To_Local'>lex_len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN275"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN270"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN317"><span class='Ref_To_Local'>lex_pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN70"><span class='Ref_to_Proto'>tsvector_bsearch</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN269"><span class='Ref_To_Local'>tsout</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN315"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN316"><span class='Ref_To_Local'>lex_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN317"><span class='Ref_To_Local'>lex_pos</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN271"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN269"><span class='Ref_To_Local'>tsout</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN274"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN317"><span class='Ref_To_Local'>lex_pos</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN330"></a>            <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN119"><span class='Ref_to_Macro'>POSDATAPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN269"><span class='Ref_To_Local'>tsout</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN274"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN317"><span class='Ref_To_Local'>lex_pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN271"><span class='Ref_To_Local'>j</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="../../../include/tsearch/ts_type.h.html#LN81"><span class='Ref_to_Macro'>WEP_SETWEIGHT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN330"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN273"><span class='Ref_To_Local'>weight</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN330"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nlexemes;i++ &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN265"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN267"><span class='Ref_To_Local'>lexemes</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN269"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_setweight_by_filter &raquo; </span> 
 
<a name="LN346"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>compareEntry</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>pa</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>pb</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="../../../include/tsearch/ts_utils.h.html#LN184"><span class='Ref_to_Proto'>tsCompareString</span></a><span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN346"><span class='Ref_to_Parameter'>pa</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN346"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>pos<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN346"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>len<span class='Delimiter'>,</span>  <span class='Operator'>\ 
</span>                    <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN346"><span class='Ref_to_Parameter'>pb</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN346"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>pos<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN346"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>len<span class='Delimiter'>,</span>  <span class='Operator'>\ 
</span>                    <span class='Boolean'>false</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Add positions from src to dest after offsetting them by maxpos. 
 * Return the number added (might be less than expected due to overflow) 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN356"></a><span class='Declare_Function'>add_pos</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>srcptr</span><span class='Delimiter'>, 
</span><a name="LN357"></a>        <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>dest</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>destptr</span><span class='Delimiter'>, 
</span><a name="LN358"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>maxpos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN360"></a>    <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>clen</span> <span class='Operator'>= &</span><a href="../../../include/tsearch/ts_type.h.html#LN117"><span class='Ref_to_Macro'>_POSVECPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN357"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN357"><span class='Ref_to_Parameter'>destptr</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>npos<span class='Delimiter'>; 
</span><a name="LN361"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN362"></a>    <a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a>      <span class='Declare_Local'>slen</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN356"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN356"><span class='Ref_to_Parameter'>srcptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN363"></a>                <span class='Declare_Local'>startlen</span><span class='Delimiter'>; 
</span><a name="LN364"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>spos</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN119"><span class='Ref_to_Macro'>POSDATAPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN356"><span class='Ref_to_Parameter'>src</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN356"><span class='Ref_to_Parameter'>srcptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN365"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dpos</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN119"><span class='Ref_to_Macro'>POSDATAPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN357"><span class='Ref_to_Parameter'>dest</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN357"><span class='Ref_to_Parameter'>destptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN357"><span class='Ref_to_Parameter'>destptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN363"><span class='Ref_To_Local'>startlen</span></a> <span class='Operator'>= *</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN361"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>         <a href="tsvector_op.c.html#LN361"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN362"><span class='Ref_To_Local'>slen</span></a> <span class='Operator'>&& *</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a> <span class='Operator'>&LT; </span><a href="../../../include/tsearch/ts_type.h.html#LN85"><span class='Ref_to_Const'>MAXNUMPOS</span></a> <span class='Operator'>&& 
</span>         <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN365"><span class='Ref_To_Local'>dpos</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/tsearch/ts_type.h.html#LN84"><span class='Ref_to_Const'>MAXENTRYPOS</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>         <a href="tsvector_op.c.html#LN361"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/tsearch/ts_type.h.html#LN81"><span class='Ref_to_Macro'>WEP_SETWEIGHT</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN365"><span class='Ref_To_Local'>dpos</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a><span class='Delimiter'>], </span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN364"><span class='Ref_To_Local'>spos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN361"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/tsearch/ts_type.h.html#LN82"><span class='Ref_to_Macro'>WEP_SETPOS</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN365"><span class='Ref_To_Local'>dpos</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a><span class='Delimiter'>], </span><a href="../../../include/tsearch/ts_type.h.html#LN86"><span class='Ref_to_Macro'>LIMITPOS</span></a><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN364"><span class='Ref_To_Local'>spos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN361"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN358"><span class='Ref_to_Parameter'>maxpos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a><span class='Parentheses'>)</span><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a> <span class='Operator'>!= </span><a href="tsvector_op.c.html#LN363"><span class='Ref_To_Local'>startlen</span></a><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN357"><span class='Ref_to_Parameter'>destptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Operator'>*</span><a href="tsvector_op.c.html#LN360"><span class='Ref_To_Local'>clen</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN363"><span class='Ref_To_Local'>startlen</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end add_pos &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Perform binary search of given lexeme in TSVector. 
 * Returns lexeme position in TSVector's entry array or -1 if lexeme wasn't 
 * found. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN392"></a><span class='Declare_Function'>tsvector_bsearch</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>tsv</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>lexeme</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lexeme_len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN394"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arrin</span> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN392"><span class='Ref_to_Parameter'>tsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN395"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>StopLow</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN396"></a>                <span class='Declare_Local'>StopHigh</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN392"><span class='Ref_to_Parameter'>tsv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, 
</span><a name="LN397"></a>                <span class='Declare_Local'>StopMiddle</span><span class='Delimiter'>, 
</span><a name="LN398"></a>                <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN395"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN396"><span class='Ref_To_Local'>StopHigh</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN397"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN395"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN396"><span class='Ref_To_Local'>StopHigh</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN398"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN184"><span class='Ref_to_Proto'>tsCompareString</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN392"><span class='Ref_to_Parameter'>lexeme</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN392"><span class='Ref_to_Parameter'>lexeme_len</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN392"><span class='Ref_to_Parameter'>tsv</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN394"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN397"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, 
</span>                              <a href="tsvector_op.c.html#LN394"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN397"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, 
</span>                              <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN398"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="tsvector_op.c.html#LN396"><span class='Ref_To_Local'>StopHigh</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN397"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN398"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="tsvector_op.c.html#LN395"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN397"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* found it */ 
</span>            <span class='Control'>return</span> <a href="tsvector_op.c.html#LN397"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_bsearch &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * qsort comparator functions 
 */ 
</span> 
<span class='Keyword'>static int 
</span><a name="LN425"></a><span class='Declare_Function'>compare_int</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>va</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>vb</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN427"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>a</span> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>const int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN425"><span class='Ref_to_Parameter'>va</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN428"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>b</span> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>const int </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN425"><span class='Ref_to_Parameter'>vb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN427"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>== </span><a href="tsvector_op.c.html#LN428"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN427"><span class='Ref_To_Local'>a</span></a> <span class='Operator'>&GT; </span><a href="tsvector_op.c.html#LN428"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: -</span><span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static int 
</span><a name="LN436"></a><span class='Declare_Function'>compare_text_lexemes</span><span class='Parentheses'>(</span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>va</span><span class='Delimiter'>, </span><span class='Keyword'>const void </span><span class='Operator'>*</span><span class='Declare_Parameter'>vb</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN438"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>a</span> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN436"><span class='Ref_to_Parameter'>va</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN439"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>b</span> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>const </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN436"><span class='Ref_to_Parameter'>vb</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN440"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>alex</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN438"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN441"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>alex_len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN438"><span class='Ref_To_Local'>a</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN442"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>blex</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN439"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN443"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>blex_len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN439"><span class='Ref_To_Local'>b</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/tsearch/ts_utils.h.html#LN184"><span class='Ref_to_Proto'>tsCompareString</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN440"><span class='Ref_To_Local'>alex</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN441"><span class='Ref_To_Local'>alex_len</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN442"><span class='Ref_To_Local'>blex</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN443"><span class='Ref_To_Local'>blex_len</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Internal routine to delete lexemes from TSVector by array of offsets. 
 * 
 * int *indices_to_delete -- array of lexeme offsets to delete (modified here!) 
 * int indices_count -- size of that array 
 * 
 * Returns new TSVector without given lexemes along with their positions 
 * and weights. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> 
<a name="LN458"></a><span class='Declare_Function'>tsvector_delete_by_indices</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>tsv</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>indices_to_delete</span><span class='Delimiter'>, 
</span><a name="LN459"></a>                           <span class='Keyword'>int </span><span class='Declare_Parameter'>indices_count</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN461"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>tsout</span><span class='Delimiter'>; 
</span><a name="LN462"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arrin</span> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>tsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN463"></a>               <span class='Operator'>*</span><span class='Declare_Local'>arrout</span><span class='Delimiter'>; 
</span><a name="LN464"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>tsv</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN465"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dataout</span><span class='Delimiter'>; 
</span><a name="LN466"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* index in arrin */ 
</span><a name="LN467"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* index in arrout */ 
</span><a name="LN468"></a>                <span class='Declare_Local'>k</span><span class='Delimiter'>,</span>              <span class='Comment_Single_Line'>/* index in indices_to_delete */ 
</span><a name="LN469"></a>                <span class='Declare_Local'>curoff</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* index in dataout area */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Sort the filter array to simplify membership checks below.  Also, get 
     * rid of any duplicate entries, so that we can assume that indices_count 
     * is exactly equal to the number of lexemes that will be removed. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN459"><span class='Ref_to_Parameter'>indices_count</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN478"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>kp</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>indices_to_delete</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN459"><span class='Ref_to_Parameter'>indices_count</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN424"><span class='Ref_to_Func'>compare_int</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN478"><span class='Ref_To_Local'>kp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN459"><span class='Ref_to_Parameter'>indices_count</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>indices_to_delete</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>indices_to_delete</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN478"><span class='Ref_To_Local'>kp</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>indices_to_delete</span></a><span class='Delimiter'>[</span><span class='Operator'>++</span><a href="tsvector_op.c.html#LN478"><span class='Ref_To_Local'>kp</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>indices_to_delete</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <a href="tsvector_op.c.html#LN459"><span class='Ref_to_Parameter'>indices_count</span></a> <span class='Operator'>= ++</span><a href="tsvector_op.c.html#LN478"><span class='Ref_To_Local'>kp</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Here we overestimate tsout size, since we don't know how much space is 
     * used by the deleted lexeme(s).  We will set exact size below. 
     */ 
</span>    <a href="tsvector_op.c.html#LN461"><span class='Ref_To_Local'>tsout</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>tsv</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* This count must be correct because STRPTR(tsout) relies on it. */ 
</span>    <a href="tsvector_op.c.html#LN461"><span class='Ref_To_Local'>tsout</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>tsv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN459"><span class='Ref_to_Parameter'>indices_count</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Copy tsv to tsout, skipping lexemes listed in indices_to_delete. 
     */ 
</span>    <a href="tsvector_op.c.html#LN463"><span class='Ref_To_Local'>arrout</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN461"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN465"><span class='Ref_To_Local'>dataout</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN461"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN469"><span class='Ref_To_Local'>curoff</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN467"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>tsv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * If current i is present in indices_to_delete, skip this lexeme. 
         * Since indices_to_delete is already sorted, we only need to check 
         * the current (k'th) entry. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN459"><span class='Ref_to_Parameter'>indices_count</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>indices_to_delete</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Copy lexeme and its positions and weights */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN465"><span class='Ref_To_Local'>dataout</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN469"><span class='Ref_To_Local'>curoff</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN464"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN462"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN462"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN463"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN467"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN462"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN463"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN467"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN462"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN463"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN467"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN469"><span class='Ref_To_Local'>curoff</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN469"><span class='Ref_To_Local'>curoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN462"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN462"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN526"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>tsv</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN462"><span class='Ref_To_Local'>arrin</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="tsvector_op.c.html#LN469"><span class='Ref_To_Local'>curoff</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN469"><span class='Ref_To_Local'>curoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN465"><span class='Ref_To_Local'>dataout</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN469"><span class='Ref_To_Local'>curoff</span></a><span class='Delimiter'>, 
</span>                   <a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN458"><span class='Ref_to_Parameter'>tsv</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN462"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN462"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN466"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="tsvector_op.c.html#LN526"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN469"><span class='Ref_To_Local'>curoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN526"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tsvector_op.c.html#LN467"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=j=k=0;i&LT;tsv-&GT;size;i... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * k should now be exactly equal to indices_count. If it isn't then the 
     * caller provided us with indices outside of [0, tsv-&GT;size) range and 
     * estimation of tsout's size is wrong. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN468"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>== </span><a href="tsvector_op.c.html#LN459"><span class='Ref_to_Parameter'>indices_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN461"><span class='Ref_To_Local'>tsout</span></a><span class='Delimiter'>, </span><a href="../../../../contrib/hstore/hstore.h.html#LN71"><span class='Ref_to_Macro'>CALCDATASIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN461"><span class='Ref_To_Local'>tsout</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN469"><span class='Ref_To_Local'>curoff</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN461"><span class='Ref_To_Local'>tsout</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_delete_by_indices &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Delete given lexeme from tsvector. 
 * Implementation of user-level ts_delete(tsvector, text). 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN555"></a><span class='Declare_Function'>tsvector_delete_str</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN557"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>tsin</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN558"></a>                <span class='Declare_Local'>tsout</span><span class='Delimiter'>; 
</span><a name="LN559"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tlexeme</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN560"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lexeme</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN559"><span class='Ref_To_Local'>tlexeme</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN561"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>lexeme_len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN559"><span class='Ref_To_Local'>tlexeme</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN562"></a>                <span class='Declare_Local'>skip_index</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN562"><span class='Ref_To_Local'>skip_index</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN70"><span class='Ref_to_Proto'>tsvector_bsearch</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN557"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN560"><span class='Ref_To_Local'>lexeme</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN561"><span class='Ref_To_Local'>lexeme_len</span></a><span class='Parentheses'>))</span> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN557"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN558"><span class='Ref_To_Local'>tsout</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN457"><span class='Ref_to_Func'>tsvector_delete_by_indices</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN557"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN562"><span class='Ref_To_Local'>skip_index</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN557"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN559"><span class='Ref_To_Local'>tlexeme</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN558"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Delete given array of lexemes from tsvector. 
 * Implementation of user-level ts_delete(tsvector, text[]). 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN579"></a><span class='Declare_Function'>tsvector_delete_arr</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN581"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>tsin</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN582"></a>                <span class='Declare_Local'>tsout</span><span class='Delimiter'>; 
</span><a name="LN583"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>lexemes</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN584"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN585"></a>                <span class='Declare_Local'>nlex</span><span class='Delimiter'>, 
</span><a name="LN586"></a>                <span class='Declare_Local'>skip_count</span><span class='Delimiter'>, 
</span><a name="LN587"></a>               <span class='Operator'>*</span><span class='Declare_Local'>skip_indices</span><span class='Delimiter'>; 
</span><a name="LN588"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dlexemes</span><span class='Delimiter'>; 
</span><a name="LN589"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN583"><span class='Ref_To_Local'>lexemes</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="tsvector_op.c.html#LN588"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN589"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN585"><span class='Ref_To_Local'>nlex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In typical use case array of lexemes to delete is relatively small. So 
     * here we optimize things for that scenario: iterate through lexarr 
     * performing binary search of each lexeme from lexarr in tsvector. 
     */ 
</span>    <a href="tsvector_op.c.html#LN587"><span class='Ref_To_Local'>skip_indices</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN585"><span class='Ref_To_Local'>nlex</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN584"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN586"><span class='Ref_To_Local'>skip_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN584"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN585"><span class='Ref_To_Local'>nlex</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN584"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN602"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lex</span><span class='Delimiter'>; 
</span><a name="LN603"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_len</span><span class='Delimiter'>, 
</span><a name="LN604"></a>                    <span class='Declare_Local'>lex_pos</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN589"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN584"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"lexeme array may not contain nulls"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN602"><span class='Ref_To_Local'>lex</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN588"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN584"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN603"><span class='Ref_To_Local'>lex_len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN588"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN584"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN604"><span class='Ref_To_Local'>lex_pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN70"><span class='Ref_to_Proto'>tsvector_bsearch</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN581"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN602"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN603"><span class='Ref_To_Local'>lex_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN604"><span class='Ref_To_Local'>lex_pos</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="tsvector_op.c.html#LN587"><span class='Ref_To_Local'>skip_indices</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN586"><span class='Ref_To_Local'>skip_count</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN604"><span class='Ref_To_Local'>lex_pos</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tsvector_op.c.html#LN582"><span class='Ref_To_Local'>tsout</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN457"><span class='Ref_to_Func'>tsvector_delete_by_indices</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN581"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN587"><span class='Ref_To_Local'>skip_indices</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN586"><span class='Ref_To_Local'>skip_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN587"><span class='Ref_To_Local'>skip_indices</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN581"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN583"><span class='Ref_To_Local'>lexemes</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN582"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_delete_arr &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Expand tsvector as table with following columns: 
 *     lexeme: lexeme text 
 *     positions: integer array of lexeme positions 
 *     weights: char array of weights corresponding to positions 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN635"></a><span class='Declare_Function'>tsvector_unnest</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN637"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN638"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>tsin</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN642"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN643"></a>        <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN642"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN643"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN643"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"lexeme"</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN643"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"positions"</span><span class='Delimiter'>, 
</span>                           <a href="../../../include/catalog/pg_type.h.html#LN463"><span class='Ref_to_Const'>INT2ARRAYOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN643"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='String'>"weights"</span><span class='Delimiter'>, 
</span>                           <a href="../../../include/catalog/pg_type.h.html#LN469"><span class='Ref_to_Const'>TEXTARRAYOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN119"><span class='Ref_to_Member'>tuple_desc</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN643"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN129"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN642"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if SRF_IS_FIRSTCALL() &raquo; </span> 
 
    <a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN638"><span class='Ref_To_Local'>tsin</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN64"><span class='Ref_to_Member'>call_cntr</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN638"><span class='Ref_To_Local'>tsin</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN667"></a>        <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arrin</span> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN638"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN668"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN638"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN669"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN670"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN671"></a>                    <span class='Declare_Local'>i</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN64"><span class='Ref_to_Member'>call_cntr</span></a><span class='Delimiter'>; 
</span><a name="LN672"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[] </span><span class='Operator'>= </span><span class='Delimiter'>{</span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>}; 
</span><a name="LN673"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span> 
        <a href="tsvector_op.c.html#LN673"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span> 
                  <a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN668"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN667"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN667"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>) 
</span>            <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN667"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN671"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN681"></a>            <a href="../../../include/tsearch/ts_type.h.html#LN64"><span class='Ref_to_Typedef'>WordEntryPosVector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>posv</span><span class='Delimiter'>; 
</span><a name="LN682"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>positions</span><span class='Delimiter'>; 
</span><a name="LN683"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>weights</span><span class='Delimiter'>; 
</span><a name="LN684"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>weight</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Internally tsvector stores position and weight in the same 
             * uint16 (2 bits for weight, 14 for position). Here we extract 
             * that in two separate arrays. 
             */ 
</span>            <a href="tsvector_op.c.html#LN681"><span class='Ref_To_Local'>posv</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN117"><span class='Ref_to_Macro'>_POSVECPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN638"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN667"><span class='Ref_To_Local'>arrin</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN671"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN682"><span class='Ref_To_Local'>positions</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN681"><span class='Ref_To_Local'>posv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN683"><span class='Ref_To_Local'>weights</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN681"><span class='Ref_To_Local'>posv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN670"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN670"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN681"><span class='Ref_To_Local'>posv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN670"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="tsvector_op.c.html#LN682"><span class='Ref_To_Local'>positions</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN670"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN456"><span class='Ref_to_Macro'>Int16GetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN681"><span class='Ref_To_Local'>posv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN670"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN684"><span class='Ref_To_Local'>weight</span></a> <span class='Operator'>= </span><span class='String'>'D'</span> <span class='Operator'>- </span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN681"><span class='Ref_To_Local'>posv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN670"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN683"><span class='Ref_To_Local'>weights</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN670"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span> 
                                         <a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN684"><span class='Ref_To_Local'>weight</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="tsvector_op.c.html#LN673"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span> 
              <a href="../../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN682"><span class='Ref_To_Local'>positions</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN681"><span class='Ref_To_Local'>posv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='String'>'s'</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN673"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span> 
              <a href="../../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN683"><span class='Ref_To_Local'>weights</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN681"><span class='Ref_To_Local'>posv</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if arrin[i].haspos &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN672"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN672"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tsvector_op.c.html#LN669"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN119"><span class='Ref_to_Member'>tuple_desc</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN673"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN672"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="../../../include/funcapi.h.html#LN221"><span class='Ref_to_Macro'>HeapTupleGetDatum</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN669"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if funcctx-&GT;call_cntr&LT;ts... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN638"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN637"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_unnest &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert tsvector to array of lexemes. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN727"></a><span class='Declare_Function'>tsvector_to_array</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN729"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>tsin</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN730"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arrin</span> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN729"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN731"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elements</span><span class='Delimiter'>; 
</span><a name="LN732"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN733"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN731"><span class='Ref_To_Local'>elements</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN729"><span class='Ref_To_Local'>tsin</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN732"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN729"><span class='Ref_To_Local'>tsin</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN731"><span class='Ref_To_Local'>elements</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span> 
          <a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN729"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN730"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN730"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN732"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span> 
            <span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tsvector_op.c.html#LN733"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN369"><span class='Ref_to_Proto'>construct_array</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN731"><span class='Ref_To_Local'>elements</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN729"><span class='Ref_To_Local'>tsin</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN731"><span class='Ref_To_Local'>elements</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN729"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN733"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_to_array &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Build tsvector from array of lexemes. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN755"></a><span class='Declare_Function'>array_to_tsvector</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN757"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN758"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>tsout</span><span class='Delimiter'>; 
</span><a name="LN759"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dlexemes</span><span class='Delimiter'>; 
</span><a name="LN760"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arrout</span><span class='Delimiter'>; 
</span><a name="LN761"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN762"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>, 
</span><a name="LN763"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN764"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN765"></a>                <span class='Declare_Local'>tslen</span><span class='Delimiter'>, 
</span><a name="LN766"></a>                <span class='Declare_Local'>datalen</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN767"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN757"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN759"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN761"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Reject nulls (maybe we should just ignore them, instead?) */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN761"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"lexeme array may not contain nulls"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Sort and de-dup, because this is required for a valid tsvector. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN759"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN435"><span class='Ref_to_Func'>compare_text_lexemes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN764"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN435"><span class='Ref_to_Func'>compare_text_lexemes</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN759"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN764"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN759"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                <a href="tsvector_op.c.html#LN759"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><span class='Operator'>++</span><a href="tsvector_op.c.html#LN764"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN759"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span>        <a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= ++</span><a href="tsvector_op.c.html#LN764"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Calculate space needed for surviving lexemes. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN766"><span class='Ref_To_Local'>datalen</span></a> <span class='Operator'>+= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN759"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN765"><span class='Ref_To_Local'>tslen</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN71"><span class='Ref_to_Macro'>CALCDATASIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN766"><span class='Ref_To_Local'>datalen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate and fill tsvector. */ 
</span>    <a href="tsvector_op.c.html#LN758"><span class='Ref_To_Local'>tsout</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN765"><span class='Ref_To_Local'>tslen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN758"><span class='Ref_To_Local'>tsout</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN765"><span class='Ref_To_Local'>tslen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN758"><span class='Ref_To_Local'>tsout</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN760"><span class='Ref_To_Local'>arrout</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN758"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN767"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN758"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN762"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN807"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>lex</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN759"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN808"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>lex_len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN759"><span class='Ref_To_Local'>dlexemes</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN767"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN807"><span class='Ref_To_Local'>lex</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN808"><span class='Ref_To_Local'>lex_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN760"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN760"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN808"><span class='Ref_To_Local'>lex_len</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN760"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN763"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN767"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>- </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN758"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN767"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN808"><span class='Ref_To_Local'>lex_len</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN757"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN758"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_to_tsvector &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * ts_filter(): keep only lexemes with given weights in tsvector. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN825"></a><span class='Declare_Function'>tsvector_filter</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN827"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>tsin</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN828"></a>                <span class='Declare_Local'>tsout</span><span class='Delimiter'>; 
</span><a name="LN829"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>weights</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN830"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arrin</span> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN827"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN831"></a>               <span class='Operator'>*</span><span class='Declare_Local'>arrout</span><span class='Delimiter'>; 
</span><a name="LN832"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>datain</span> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN827"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span><a name="LN833"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dataout</span><span class='Delimiter'>; 
</span><a name="LN834"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>dweights</span><span class='Delimiter'>; 
</span><a name="LN835"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN836"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nweights</span><span class='Delimiter'>; 
</span><a name="LN837"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN838"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>; 
</span><a name="LN839"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cur_pos</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN840"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>mask</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN829"><span class='Ref_To_Local'>weights</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN19"><span class='Ref_to_Const'>CHAROID</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='String'>'c'</span><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="tsvector_op.c.html#LN834"><span class='Ref_To_Local'>dweights</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN835"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN836"><span class='Ref_To_Local'>nweights</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN836"><span class='Ref_To_Local'>nweights</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN847"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>char_weight</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN835"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"weight array may not contain nulls"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN847"><span class='Ref_To_Local'>char_weight</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN414"><span class='Ref_to_Macro'>DatumGetChar</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN834"><span class='Ref_To_Local'>dweights</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN847"><span class='Ref_To_Local'>char_weight</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'A'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'a'</span><span class='Operator'>: 
</span>                <a href="tsvector_op.c.html#LN840"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN840"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>| </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'B'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>: 
</span>                <a href="tsvector_op.c.html#LN840"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN840"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>| </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>                <a href="tsvector_op.c.html#LN840"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN840"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>| </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>                <a href="tsvector_op.c.html#LN840"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN840"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>| </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized weight: \"%c\""</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN847"><span class='Ref_To_Local'>char_weight</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch char_weight &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nweights;i++ &raquo; </span> 
 
    <a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN827"><span class='Ref_To_Local'>tsin</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN827"><span class='Ref_To_Local'>tsin</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN831"><span class='Ref_To_Local'>arrout</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN833"><span class='Ref_To_Local'>dataout</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN838"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN827"><span class='Ref_To_Local'>tsin</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN887"></a>        <a href="../../../include/tsearch/ts_type.h.html#LN64"><span class='Ref_to_Typedef'>WordEntryPosVector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>posvin</span><span class='Delimiter'>, 
</span><a name="LN888"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>posvout</span><span class='Delimiter'>; 
</span><a name="LN889"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>npos</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN890"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>k</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN830"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN887"><span class='Ref_To_Local'>posvin</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN117"><span class='Ref_to_Macro'>_POSVECPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN827"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN830"><span class='Ref_To_Local'>arrin</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN888"><span class='Ref_To_Local'>posvout</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN64"><span class='Ref_to_Typedef'>WordEntryPosVector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN833"><span class='Ref_To_Local'>dataout</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN839"><span class='Ref_To_Local'>cur_pos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN830"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN890"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN890"><span class='Ref_To_Local'>k</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN887"><span class='Ref_To_Local'>posvin</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN890"><span class='Ref_To_Local'>k</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN840"><span class='Ref_To_Local'>mask</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN887"><span class='Ref_To_Local'>posvin</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN890"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span> 
                <a href="tsvector_op.c.html#LN888"><span class='Ref_To_Local'>posvout</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN889"><span class='Ref_To_Local'>npos</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN887"><span class='Ref_To_Local'>posvin</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN890"><span class='Ref_To_Local'>k</span></a><span class='Delimiter'>]; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* if no satisfactory positions found, skip lexeme */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN889"><span class='Ref_To_Local'>npos</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN831"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN838"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN831"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN838"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN830"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN831"><span class='Ref_To_Local'>arrout</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN838"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN839"><span class='Ref_To_Local'>cur_pos</span></a><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN833"><span class='Ref_To_Local'>dataout</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN839"><span class='Ref_To_Local'>cur_pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN832"><span class='Ref_To_Local'>datain</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN830"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN830"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN888"><span class='Ref_To_Local'>posvout</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN889"><span class='Ref_To_Local'>npos</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN839"><span class='Ref_To_Local'>cur_pos</span></a> <span class='Operator'>+= </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN830"><span class='Ref_To_Local'>arrin</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN837"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN839"><span class='Ref_To_Local'>cur_pos</span></a> <span class='Operator'>+= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN831"><span class='Ref_To_Local'>arrout</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN838"><span class='Ref_To_Local'>j</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ 
</span>            <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN838"><span class='Ref_To_Local'>j</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=j=0;i&LT;tsin-&GT;size;i+... &raquo; </span> 
 
    <a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN838"><span class='Ref_To_Local'>j</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN833"><span class='Ref_To_Local'>dataout</span></a> <span class='Operator'>!= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN833"><span class='Ref_To_Local'>dataout</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN839"><span class='Ref_To_Local'>cur_pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Delimiter'>, </span><a href="../../../../contrib/hstore/hstore.h.html#LN71"><span class='Ref_to_Macro'>CALCDATASIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN839"><span class='Ref_To_Local'>cur_pos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN827"><span class='Ref_To_Local'>tsin</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN828"><span class='Ref_To_Local'>tsout</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_filter &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN932"></a><span class='Declare_Function'>tsvector_concat</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN934"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>in1</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN935"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>in2</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN936"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>out</span><span class='Delimiter'>; 
</span><a name="LN937"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN938"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>ptr1</span><span class='Delimiter'>, 
</span><a name="LN939"></a>               <span class='Operator'>*</span><span class='Declare_Local'>ptr2</span><span class='Delimiter'>; 
</span><a name="LN940"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN941"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>maxpos</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN942"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN943"></a>                <span class='Declare_Local'>j</span><span class='Delimiter'>, 
</span><a name="LN944"></a>                <span class='Declare_Local'>i1</span><span class='Delimiter'>, 
</span><a name="LN945"></a>                <span class='Declare_Local'>i2</span><span class='Delimiter'>, 
</span><a name="LN946"></a>                <span class='Declare_Local'>dataoff</span><span class='Delimiter'>, 
</span><a name="LN947"></a>                <span class='Declare_Local'>output_bytes</span><span class='Delimiter'>, 
</span><a name="LN948"></a>                <span class='Declare_Local'>output_size</span><span class='Delimiter'>; 
</span><a name="LN949"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>, 
</span><a name="LN950"></a>               <span class='Operator'>*</span><span class='Declare_Local'>data1</span><span class='Delimiter'>, 
</span><a name="LN951"></a>               <span class='Operator'>*</span><span class='Declare_Local'>data2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get max position in in1; we'll need this to offset in2's positions */ 
</span>    <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN942"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN942"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN943"><span class='Ref_To_Local'>j</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN940"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN119"><span class='Ref_to_Macro'>POSDATAPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN943"><span class='Ref_To_Local'>j</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN940"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><a href="tsvector_op.c.html#LN941"><span class='Ref_To_Local'>maxpos</span></a><span class='Parentheses'>)</span> 
                    <a href="tsvector_op.c.html#LN941"><span class='Ref_To_Local'>maxpos</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN940"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN940"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN950"><span class='Ref_To_Local'>data1</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN951"><span class='Ref_To_Local'>data2</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN944"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN945"><span class='Ref_To_Local'>i2</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Conservative estimate of space needed.  We might need all the data in 
     * both inputs, and conceivably add a pad byte before position data for 
     * each item where there was none before. 
     */ 
</span>    <a href="tsvector_op.c.html#LN947"><span class='Ref_To_Local'>output_bytes</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN944"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN945"><span class='Ref_To_Local'>i2</span></a><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN947"><span class='Ref_To_Local'>output_bytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN947"><span class='Ref_To_Local'>output_bytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We must make out-&GT;size valid so that STRPTR(out) is sensible.  We'll 
     * collapse out any unused space at the end. 
     */ 
</span>    <a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN944"><span class='Ref_To_Local'>i1</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN945"><span class='Ref_To_Local'>i2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN999"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN346"><span class='Ref_to_Macro'>compareEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN950"><span class='Ref_To_Local'>data1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN951"><span class='Ref_To_Local'>data2</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN999"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{</span>                       <span class='Comment_Single_Line'>/* in1 first */ 
</span>            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN950"><span class='Ref_To_Local'>data1</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN117"><span class='Ref_to_Macro'>_POSVECPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN944"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN999"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{</span>                       <span class='Comment_Single_Line'>/* in2 first */ 
</span>            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN951"><span class='Ref_To_Local'>data2</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1028"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>addlen</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN355"><span class='Ref_to_Func'>add_pos</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN941"><span class='Ref_To_Local'>maxpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1028"><span class='Ref_To_Local'>addlen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                    <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN1028"><span class='Ref_To_Local'>addlen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN945"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cmp&GT;0 &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>| </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN950"><span class='Ref_To_Local'>data1</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN117"><span class='Ref_to_Macro'>_POSVECPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>                        <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN355"><span class='Ref_to_Func'>add_pos</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN941"><span class='Ref_To_Local'>maxpos</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* must have ptr2-&GT;haspos */ 
</span>                <span class='Delimiter'>{ 
</span><a name="LN1062"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>addlen</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN355"><span class='Ref_to_Func'>add_pos</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN941"><span class='Ref_To_Local'>maxpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1062"><span class='Ref_To_Local'>addlen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                    <span class='Delimiter'>{ 
</span>                        <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN1062"><span class='Ref_To_Local'>addlen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ptr-&GT;haspos &raquo; </span> 
 
            <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN944"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN945"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while i1&&i2 &raquo; </span> 
 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN944"><span class='Ref_To_Local'>i1</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN950"><span class='Ref_To_Local'>data1</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN117"><span class='Ref_to_Macro'>_POSVECPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN938"><span class='Ref_To_Local'>ptr1</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN944"><span class='Ref_To_Local'>i1</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN945"><span class='Ref_To_Local'>i2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN951"><span class='Ref_To_Local'>data2</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1110"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>addlen</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN355"><span class='Ref_to_Func'>add_pos</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN941"><span class='Ref_To_Local'>maxpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1110"><span class='Ref_To_Local'>addlen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN1110"><span class='Ref_To_Local'>addlen</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN266"><span class='Ref_to_Typedef'>uint16</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN939"><span class='Ref_To_Local'>ptr2</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN945"><span class='Ref_To_Local'>i2</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while i2 &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Instead of checking each offset individually, we check for overflow of 
     * pos fields once at the end. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a> <span class='Operator'>&GT; </span><a href="../../../include/tsearch/ts_type.h.html#LN49"><span class='Ref_to_Const'>MAXSTRPOS</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_PROGRAM_LIMIT_EXCEEDED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"string is too long for tsvector (%d bytes, max %d bytes)"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN49"><span class='Ref_to_Const'>MAXSTRPOS</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Adjust sizes (asserting that we didn't overrun the original estimates) 
     * and collapse out any unused array entries. 
     */ 
</span>    <a href="tsvector_op.c.html#LN948"><span class='Ref_To_Local'>output_size</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN937"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>- </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN948"><span class='Ref_To_Local'>output_size</span></a> <span class='Operator'>&LT;= </span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN948"><span class='Ref_To_Local'>output_size</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>!= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN949"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN947"><span class='Ref_To_Local'>output_bytes</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN71"><span class='Ref_to_Macro'>CALCDATASIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN946"><span class='Ref_To_Local'>dataoff</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN947"><span class='Ref_To_Local'>output_bytes</span></a> <span class='Operator'>&LT;= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN947"><span class='Ref_To_Local'>output_bytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN934"><span class='Ref_To_Local'>in1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN935"><span class='Ref_To_Local'>in2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN936"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_concat &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compare two strings by tsvector rules. 
 * 
 * if isPrefix = true then it returns zero value iff b has prefix a 
 */ 
</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN1159"></a><span class='Declare_Function'>tsCompareString</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lena</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>lenb</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>prefix</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1161"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lena</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>prefix</span></a><span class='Parentheses'>) 
</span>            <a href="tsvector_op.c.html#LN1161"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* empty string is prefix of anything */ 
</span>        <span class='Control'>else</span> 
            <a href="tsvector_op.c.html#LN1161"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lenb</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lenb</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN1161"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lena</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN1161"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lena</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lenb</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>prefix</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1161"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lena</span></a> <span class='Operator'>&GT; </span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lenb</span></a><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN1161"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* a is longer, so not a prefix of b */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1161"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lena</span></a> <span class='Operator'>!= </span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lenb</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN1161"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lena</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1159"><span class='Ref_to_Parameter'>lenb</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1161"><span class='Ref_To_Local'>cmp</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsCompareString &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Check weight info or/and fill 'data' with the required positions 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1196"></a><span class='Declare_Function'>checkclass_str</span><span class='Parentheses'>(</span><a href="../../../../contrib/intarray/_int_bool.c.html#LN225"><span class='Ref_to_Typedef'>CHKVAL</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>chkval</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>entry</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN151"><span class='Ref_to_Typedef'>QueryOperand</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, 
</span><a name="LN1197"></a>               <a href="../../../include/tsearch/ts_utils.h.html#LN133"><span class='Ref_to_Struct'>ExecPhraseData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1199"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1196"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1196"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN154"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>|| </span><a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1203"></a>        <a href="../../../include/tsearch/ts_type.h.html#LN64"><span class='Ref_to_Typedef'>WordEntryPosVector</span></a> <span class='Operator'>*</span><span class='Declare_Local'>posvec</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We can't use the _POSVECPTR macro here because the pointer to the 
         * tsvector's lexeme storage is already contained in chkval-&GT;values. 
         */ 
</span>        <a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN64"><span class='Ref_to_Typedef'>WordEntryPosVector</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1196"><span class='Ref_to_Parameter'>chkval</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN37"><span class='Ref_to_Member'>values</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN583"><span class='Ref_to_Macro'>SHORTALIGN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1196"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1196"><span class='Ref_to_Parameter'>entry</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1196"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN154"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1214"></a>            <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>posvec_iter</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>; 
</span><a name="LN1215"></a>            <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>dptr</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Filter position information by weights 
             */ 
</span>            <a href="tsvector_op.c.html#LN1215"><span class='Ref_To_Local'>dptr</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN136"><span class='Ref_to_Member'>allocated</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Is there a position with a matching weight? */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1214"><span class='Ref_To_Local'>posvec_iter</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* If true, append this position to the data-&GT;pos */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1196"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN154"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN1214"><span class='Ref_To_Local'>posvec_iter</span></a><span class='Parentheses'>)))</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Operator'>*</span><a href="tsvector_op.c.html#LN1215"><span class='Ref_To_Local'>dptr</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN1214"><span class='Ref_To_Local'>posvec_iter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tsvector_op.c.html#LN1215"><span class='Ref_To_Local'>dptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="tsvector_op.c.html#LN1214"><span class='Ref_To_Local'>posvec_iter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1215"><span class='Ref_To_Local'>dptr</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN1199"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if val-&GT;weight&&data &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1196"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN154"><span class='Ref_to_Member'>weight</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1243"></a>            <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>posvec_iter</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Is there a position with a matching weight? */ 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1243"><span class='Ref_To_Local'>posvec_iter</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1196"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN154"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN1243"><span class='Ref_To_Local'>posvec_iter</span></a><span class='Parentheses'>)))</span> 
                <span class='Delimiter'>{ 
</span>                    <a href="tsvector_op.c.html#LN1199"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* no need to go further */ 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="tsvector_op.c.html#LN1243"><span class='Ref_To_Local'>posvec_iter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* data != NULL */ 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN66"><span class='Ref_to_Member'>npos</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1203"><span class='Ref_To_Local'>posvec</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN67"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1197"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN136"><span class='Ref_to_Member'>allocated</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1199"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if entry-&GT;haspos&&(val-&GT;... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN1199"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1199"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end checkclass_str &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Removes duplicate pos entries. We can't use uniquePos() from 
 * tsvector.c because array might be longer than MAXENTRYPOS 
 * 
 * Returns new length. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1280"></a><span class='Declare_Function'>uniqueLongPos</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pos</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>npos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1282"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>pos_iter</span><span class='Delimiter'>, 
</span><a name="LN1283"></a>               <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1280"><span class='Ref_to_Parameter'>npos</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1280"><span class='Ref_to_Parameter'>npos</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/port.h.html#LN439"><span class='Ref_to_Macro'>qsort</span></a><span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN1280"><span class='Ref_to_Parameter'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1280"><span class='Ref_to_Parameter'>npos</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="tsvector.c.html#LN31"><span class='Ref_to_Func'>compareWordEntryPos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN1283"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1280"><span class='Ref_to_Parameter'>pos</span></a><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN1282"><span class='Ref_To_Local'>pos_iter</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1280"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1282"><span class='Ref_To_Local'>pos_iter</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1280"><span class='Ref_to_Parameter'>pos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1280"><span class='Ref_to_Parameter'>npos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN1282"><span class='Ref_To_Local'>pos_iter</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN1283"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN1283"><span class='Ref_To_Local'>result</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="tsvector_op.c.html#LN1283"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN1282"><span class='Ref_To_Local'>pos_iter</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="tsvector_op.c.html#LN1282"><span class='Ref_To_Local'>pos_iter</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1283"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN1280"><span class='Ref_to_Parameter'>pos</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end uniqueLongPos &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * is there value 'val' in array or not ? 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1310"></a><span class='Declare_Function'>checkcondition_str</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>checkval</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN151"><span class='Ref_to_Typedef'>QueryOperand</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>val</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_utils.h.html#LN133"><span class='Ref_to_Struct'>ExecPhraseData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1312"></a>    <a href="../../../../contrib/intarray/_int_bool.c.html#LN225"><span class='Ref_to_Typedef'>CHKVAL</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>chkval</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/intarray/_int_bool.c.html#LN225"><span class='Ref_to_Typedef'>CHKVAL</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>checkval</span></a><span class='Delimiter'>; 
</span><a name="LN1313"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>StopLow</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN35"><span class='Ref_to_Member'>arrb</span></a><span class='Delimiter'>; 
</span><a name="LN1314"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>StopHigh</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN36"><span class='Ref_to_Member'>arre</span></a><span class='Delimiter'>; 
</span><a name="LN1315"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>StopMiddle</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1314"><span class='Ref_To_Local'>StopHigh</span></a><span class='Delimiter'>; 
</span><a name="LN1316"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>difference</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN1317"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop invariant: StopLow &LT;= val &LT; StopHigh */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1313"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1314"><span class='Ref_To_Local'>StopHigh</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1313"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1314"><span class='Ref_To_Local'>StopHigh</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN1313"><span class='Ref_To_Local'>StopLow</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN1316"><span class='Ref_To_Local'>difference</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN184"><span class='Ref_to_Proto'>tsCompareString</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN38"><span class='Ref_to_Member'>operand</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN167"><span class='Ref_to_Member'>distance</span></a><span class='Delimiter'>, 
</span>                                     <a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN166"><span class='Ref_to_Member'>length</span></a><span class='Delimiter'>, 
</span>                                     <a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN37"><span class='Ref_to_Member'>values</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, 
</span>                                     <a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1316"><span class='Ref_To_Local'>difference</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Check weight info & fill 'data' with positions */ 
</span>            <a href="tsvector_op.c.html#LN1317"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1195"><span class='Ref_to_Func'>checkclass_str</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1316"><span class='Ref_To_Local'>difference</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="tsvector_op.c.html#LN1313"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="tsvector_op.c.html#LN1314"><span class='Ref_To_Local'>StopHigh</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while StopLow&LT;StopHigh &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN1317"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>|| </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN158"><span class='Ref_to_Member'>prefix</span></a><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1343"></a>        <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>allpos</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1344"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>npos</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN1345"></a>                    <span class='Declare_Local'>totalpos</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * there was a failed exact search, so we should scan further to find 
         * a prefix match. We also need to do so if caller needs position info 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1313"><span class='Ref_To_Local'>StopLow</span></a> <span class='Operator'>&GT;= </span><a href="tsvector_op.c.html#LN1314"><span class='Ref_To_Local'>StopHigh</span></a><span class='Parentheses'>) 
</span>            <a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1314"><span class='Ref_To_Local'>StopHigh</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>((</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN1317"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>|| </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) </span><span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN36"><span class='Ref_to_Member'>arre</span></a> <span class='Operator'>&& 
</span>               <a href="../../../include/tsearch/ts_utils.h.html#LN184"><span class='Ref_to_Proto'>tsCompareString</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN38"><span class='Ref_to_Member'>operand</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN167"><span class='Ref_to_Member'>distance</span></a><span class='Delimiter'>, 
</span>                               <a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN166"><span class='Ref_to_Member'>length</span></a><span class='Delimiter'>, 
</span>                               <a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN37"><span class='Ref_to_Member'>values</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, 
</span>                               <a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>, 
</span>                               <span class='Boolean'>true</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * We need to join position information 
                 */ 
</span>                <a href="tsvector_op.c.html#LN1317"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1195"><span class='Ref_to_Func'>checkclass_str</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1317"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1344"><span class='Ref_To_Local'>npos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>&GT;= </span><a href="tsvector_op.c.html#LN1345"><span class='Ref_To_Local'>totalpos</span></a><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1345"><span class='Ref_To_Local'>totalpos</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <span class='Delimiter'>{ 
</span>                            <a href="tsvector_op.c.html#LN1345"><span class='Ref_To_Local'>totalpos</span></a> <span class='Operator'>= </span><span class='Number'>256</span><span class='Delimiter'>; 
</span>                            <a href="tsvector_op.c.html#LN1343"><span class='Ref_To_Local'>allpos</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="tsvector_op.c.html#LN1345"><span class='Ref_To_Local'>totalpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                        <span class='Control'>else</span> 
                        <span class='Delimiter'>{ 
</span>                            <a href="tsvector_op.c.html#LN1345"><span class='Ref_To_Local'>totalpos</span></a> <span class='Operator'>*= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                            <a href="tsvector_op.c.html#LN1343"><span class='Ref_To_Local'>allpos</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1343"><span class='Ref_To_Local'>allpos</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="tsvector_op.c.html#LN1345"><span class='Ref_To_Local'>totalpos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Delimiter'>} 
</span>                    <span class='Delimiter'>} 
</span> 
                    memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1343"><span class='Ref_To_Local'>allpos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1344"><span class='Ref_To_Local'>npos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="tsvector_op.c.html#LN1344"><span class='Ref_To_Local'>npos</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if data &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="tsvector_op.c.html#LN1317"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1195"><span class='Ref_to_Func'>checkclass_str</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1312"><span class='Ref_To_Local'>chkval</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>val</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <a href="tsvector_op.c.html#LN1315"><span class='Ref_To_Local'>StopMiddle</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while (!res||data)&&StopMid... &raquo; </span> 
 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1317"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Sort and make unique array of found positions */ 
</span>            <a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1343"><span class='Ref_To_Local'>allpos</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1279"><span class='Ref_to_Func'>uniqueLongPos</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1343"><span class='Ref_To_Local'>allpos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1344"><span class='Ref_To_Local'>npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1310"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN136"><span class='Ref_to_Member'>allocated</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (!res||data)&&val-&GT;pr... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1317"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end checkcondition_str &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Compute output position list for a tsquery operator in phrase mode. 
 * 
 * Merge the position lists in Ldata and Rdata as specified by "emit", 
 * returning the result list into *data.  The input position lists must be 
 * sorted and unique, and the output will be as well. 
 * 
 * data: pointer to initially-all-zeroes output struct, or NULL 
 * Ldata, Rdata: input position lists 
 * emit: bitmask of TSPO_XXX flags 
 * Loffset: offset to be added to Ldata positions before comparing/outputting 
 * Roffset: offset to be added to Rdata positions before comparing/outputting 
 * max_npos: maximum possible required size of output position array 
 * 
 * Loffset and Roffset should not be negative, else we risk trying to output 
 * negative positions, which won't fit into WordEntryPos. 
 * 
 * Returns true if any positions were emitted to *data; or if data is NULL, 
 * returns true if any positions would have been emitted. 
 */ 
</span><a name="LN1428"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TSPO_L_ONLY</span>     <span class='Number'>0x01</span>    <span class='Comment_Single_Line'>/* emit positions appearing only in L */ 
</span><a name="LN1429"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TSPO_R_ONLY</span>     <span class='Number'>0x02</span>    <span class='Comment_Single_Line'>/* emit positions appearing only in R */ 
</span><a name="LN1430"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TSPO_BOTH</span>       <span class='Number'>0x04</span>    <span class='Comment_Single_Line'>/* emit positions appearing in both L&R */ 
</span> 
<span class='Keyword'>static bool 
</span><a name="LN1433"></a><span class='Declare_Function'>TS_phrase_output</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN133"><span class='Ref_to_Struct'>ExecPhraseData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, 
</span><a name="LN1434"></a>                 <a href="../../../include/tsearch/ts_utils.h.html#LN133"><span class='Ref_to_Struct'>ExecPhraseData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Ldata</span><span class='Delimiter'>, 
</span><a name="LN1435"></a>                 <a href="../../../include/tsearch/ts_utils.h.html#LN133"><span class='Ref_to_Struct'>ExecPhraseData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>Rdata</span><span class='Delimiter'>, 
</span><a name="LN1436"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>emit</span><span class='Delimiter'>, 
</span><a name="LN1437"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>Loffset</span><span class='Delimiter'>, 
</span><a name="LN1438"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>Roffset</span><span class='Delimiter'>, 
</span><a name="LN1439"></a>                 <span class='Keyword'>int </span><span class='Declare_Parameter'>max_npos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1441"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>Lindex</span><span class='Delimiter'>, 
</span><a name="LN1442"></a>                <span class='Declare_Local'>Rindex</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Loop until both inputs are exhausted */ 
</span>    <a href="tsvector_op.c.html#LN1441"><span class='Ref_To_Local'>Lindex</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1442"><span class='Ref_To_Local'>Rindex</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1441"><span class='Ref_To_Local'>Lindex</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1434"><span class='Ref_to_Parameter'>Ldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>|| </span><a href="tsvector_op.c.html#LN1442"><span class='Ref_To_Local'>Rindex</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1435"><span class='Ref_to_Parameter'>Rdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1448"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>Lpos</span><span class='Delimiter'>, 
</span><a name="LN1449"></a>                    <span class='Declare_Local'>Rpos</span><span class='Delimiter'>; 
</span><a name="LN1450"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>output_pos</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Fetch current values to compare.  WEP_GETPOS() is needed because 
         * ExecPhraseData-&GT;data can point to a tsvector's WordEntryPosVector. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1441"><span class='Ref_To_Local'>Lindex</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1434"><span class='Ref_to_Parameter'>Ldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>) 
</span>            <a href="tsvector_op.c.html#LN1448"><span class='Ref_To_Local'>Lpos</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1434"><span class='Ref_to_Parameter'>Ldata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN1441"><span class='Ref_To_Local'>Lindex</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1437"><span class='Ref_to_Parameter'>Loffset</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* L array exhausted, so we're done if R_ONLY isn't set */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1436"><span class='Ref_to_Parameter'>emit</span></a> <span class='Operator'>& </span><a href="tsvector_op.c.html#LN1429"><span class='Ref_to_Const'>TSPO_R_ONLY</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1448"><span class='Ref_To_Local'>Lpos</span></a> <span class='Operator'>= </span>INT_MAX<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1442"><span class='Ref_To_Local'>Rindex</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1435"><span class='Ref_to_Parameter'>Rdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>) 
</span>            <a href="tsvector_op.c.html#LN1449"><span class='Ref_To_Local'>Rpos</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN79"><span class='Ref_to_Macro'>WEP_GETPOS</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1435"><span class='Ref_to_Parameter'>Rdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN1442"><span class='Ref_To_Local'>Rindex</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1438"><span class='Ref_to_Parameter'>Roffset</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* R array exhausted, so we're done if L_ONLY isn't set */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1436"><span class='Ref_to_Parameter'>emit</span></a> <span class='Operator'>& </span><a href="tsvector_op.c.html#LN1428"><span class='Ref_to_Const'>TSPO_L_ONLY</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1449"><span class='Ref_To_Local'>Rpos</span></a> <span class='Operator'>= </span>INT_MAX<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Merge-join the two input lists */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1448"><span class='Ref_To_Local'>Lpos</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN1449"><span class='Ref_To_Local'>Rpos</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Lpos is not matched in Rdata, should we output it? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1436"><span class='Ref_to_Parameter'>emit</span></a> <span class='Operator'>& </span><a href="tsvector_op.c.html#LN1428"><span class='Ref_to_Const'>TSPO_L_ONLY</span></a><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN1450"><span class='Ref_To_Local'>output_pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1448"><span class='Ref_To_Local'>Lpos</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1441"><span class='Ref_To_Local'>Lindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1448"><span class='Ref_To_Local'>Lpos</span></a> <span class='Operator'>== </span><a href="tsvector_op.c.html#LN1449"><span class='Ref_To_Local'>Rpos</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Lpos and Rpos match ... should we output it? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1436"><span class='Ref_to_Parameter'>emit</span></a> <span class='Operator'>& </span><a href="tsvector_op.c.html#LN1430"><span class='Ref_to_Const'>TSPO_BOTH</span></a><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN1450"><span class='Ref_To_Local'>output_pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1449"><span class='Ref_To_Local'>Rpos</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1441"><span class='Ref_To_Local'>Lindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1442"><span class='Ref_To_Local'>Rindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* Lpos &GT; Rpos */ 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Rpos is not matched in Ldata, should we output it? */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1436"><span class='Ref_to_Parameter'>emit</span></a> <span class='Operator'>& </span><a href="tsvector_op.c.html#LN1429"><span class='Ref_to_Const'>TSPO_R_ONLY</span></a><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN1450"><span class='Ref_To_Local'>output_pos</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1449"><span class='Ref_To_Local'>Rpos</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1442"><span class='Ref_To_Local'>Rindex</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1450"><span class='Ref_To_Local'>output_pos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1433"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Store position, first allocating output array if needed */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1433"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="tsvector_op.c.html#LN1433"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>                        <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1439"><span class='Ref_to_Parameter'>max_npos</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="tsvector_op.c.html#LN1433"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN136"><span class='Ref_to_Member'>allocated</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="tsvector_op.c.html#LN1433"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN138"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN1433"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN1450"><span class='Ref_To_Local'>output_pos</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Exact positions not needed, so return true as soon as we 
                 * know there is at least one. 
                 */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if output_pos&GT;0 &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while Lindex&LT;Ldata-&GT;npos||R... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1433"><span class='Ref_to_Parameter'>data</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1433"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Let's assert we didn't overrun the array */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1433"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>&LT;= </span><a href="tsvector_op.c.html#LN1439"><span class='Ref_to_Parameter'>max_npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TS_phrase_output &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Execute tsquery at or below an OP_PHRASE operator. 
 * 
 * This handles tsquery execution at recursion levels where we need to care 
 * about match locations. 
 * 
 * In addition to the same arguments used for TS_execute, the caller may pass 
 * a preinitialized-to-zeroes ExecPhraseData struct, to be filled with lexeme 
 * match position info on success.  data == NULL if no position data need be 
 * returned.  (In practice, outside callers pass NULL, and only the internal 
 * recursion cases pass a data pointer.) 
 * Note: the function assumes data != NULL for operators other than OP_PHRASE. 
 * This is OK because an outside call always starts from an OP_PHRASE node. 
 * 
 * The detailed semantics of the match data, given that the function returned 
 * "true" (successful match, or possible match), are: 
 * 
 * npos &GT; 0, negate = false: 
 *   query is matched at specified position(s) (and only those positions) 
 * npos &GT; 0, negate = true: 
 *   query is matched at all positions *except* specified position(s) 
 * npos = 0, negate = false: 
 *   query is possibly matched, matching position(s) are unknown 
 *   (this should only be returned when TS_EXEC_PHRASE_NO_POS flag is set) 
 * npos = 0, negate = true: 
 *   query is matched at all positions 
 * 
 * Successful matches also return a "width" value which is the match width in 
 * lexemes, less one.  Hence, "width" is zero for simple one-lexeme matches, 
 * and is the sum of the phrase operator distances for phrase matches.  Note 
 * that when width &GT; 0, the listed positions represent the ends of matches not 
 * the starts.  (This unintuitive rule is needed to avoid possibly generating 
 * negative positions, which wouldn't fit into the WordEntryPos arrays.) 
 * 
 * When the function returns "false" (no match), it must return npos = 0, 
 * negate = false (which is the state initialized by the caller); but the 
 * "width" output in such cases is undefined. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1571"></a><span class='Declare_Function'>TS_phrase_execute</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>curitem</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>flags</span><span class='Delimiter'>, 
</span><a name="LN1572"></a>                  <a href="../../../include/tsearch/ts_utils.h.html#LN153"><span class='Ref_to_Typedef'>TSExecuteCallback</span></a> <span class='Declare_Parameter'>chkcond</span><span class='Delimiter'>, 
</span><a name="LN1573"></a>                  <a href="../../../include/tsearch/ts_utils.h.html#LN133"><span class='Ref_to_Struct'>ExecPhraseData</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1575"></a>    <a href="../../../include/tsearch/ts_utils.h.html#LN133"><span class='Ref_to_Struct'>ExecPhraseData</span></a> <span class='Declare_Local'>Ldata</span><span class='Delimiter'>, 
</span><a name="LN1576"></a>                <span class='Declare_Local'>Rdata</span><span class='Delimiter'>; 
</span><a name="LN1577"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>lmatch</span><span class='Delimiter'>, 
</span><a name="LN1578"></a>                <span class='Declare_Local'>rmatch</span><span class='Delimiter'>; 
</span><a name="LN1579"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>Loffset</span><span class='Delimiter'>, 
</span><a name="LN1580"></a>                <span class='Declare_Local'>Roffset</span><span class='Delimiter'>, 
</span><a name="LN1581"></a>                <span class='Declare_Local'>maxwidth</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* since this function recurses, it could be driven to stack overflow */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1572"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN151"><span class='Ref_to_Typedef'>QueryOperand</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN174"><span class='Ref_to_Const'>OP_NOT</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Because a "true" result with no specific positions is taken as 
             * uncertain, we need no special care here for !TS_EXEC_CALC_NOT. 
             * If it's a false positive, the right things happen anyway. 
             * 
             * Also, we need not touch data-&GT;width, since a NOT operation does 
             * not change the match width. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1570"><span class='Ref_to_Func'>TS_phrase_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1572"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* we have some positions, invert negate flag */ 
</span>                    <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a> <span class='Operator'>= !</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* change "match everywhere" to "match nowhere" */ 
</span>                    <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Comment_Multi_Line'>/* match positions are, and remain, uncertain */ 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* change "match nowhere" to "match everywhere" */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN177"><span class='Ref_to_Const'>OP_PHRASE</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN175"><span class='Ref_to_Const'>OP_AND</span></a><span class='Operator'>: 
</span>            memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN1570"><span class='Ref_to_Func'>TS_phrase_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN192"><span class='Ref_to_Member'>left</span></a><span class='Delimiter'>, 
</span>                                   <a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1572"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN1570"><span class='Ref_to_Func'>TS_phrase_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                   <a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1572"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If either operand has no position information, then we can't 
             * return position data, only a "possible match" result. "Possible 
             * match" answers are only wanted when TS_EXEC_PHRASE_NO_POS flag 
             * is set, otherwise return false. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/tsearch/ts_utils.h.html#LN174"><span class='Ref_to_Const'>TS_EXEC_PHRASE_NO_POS</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>true </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN177"><span class='Ref_to_Const'>OP_PHRASE</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * Compute Loffset and Roffset suitable for phrase match, and 
                 * compute overall width of whole phrase match. 
                 */ 
</span>                <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN191"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) 
</span>                    <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN191"><span class='Ref_to_Member'>distance</span></a> <span class='Operator'>+ 
</span>                        <a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * For OP_AND, set output width and alignment like OP_OR (see 
                 * comment below) 
                 */ 
</span>                <a href="tsvector_op.c.html#LN1581"><span class='Ref_To_Local'>maxwidth</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1581"><span class='Ref_To_Local'>maxwidth</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1581"><span class='Ref_To_Local'>maxwidth</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) 
</span>                    <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1581"><span class='Ref_To_Local'>maxwidth</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* !L & !R: treat as !(L | R) */ 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN1432"><span class='Ref_to_Func'>TS_phrase_output</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1430"><span class='Ref_to_Const'>TSPO_BOTH</span></a> <span class='Operator'>| </span><a href="tsvector_op.c.html#LN1428"><span class='Ref_to_Const'>TSPO_L_ONLY</span></a> <span class='Operator'>| </span><a href="tsvector_op.c.html#LN1429"><span class='Ref_to_Const'>TSPO_R_ONLY</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) 
</span>                    <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* !L & R */ 
</span>                <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1432"><span class='Ref_to_Func'>TS_phrase_output</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1429"><span class='Ref_to_Const'>TSPO_R_ONLY</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* L & !R */ 
</span>                <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1432"><span class='Ref_to_Func'>TS_phrase_output</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1428"><span class='Ref_to_Const'>TSPO_L_ONLY</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* straight AND */ 
</span>                <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1432"><span class='Ref_to_Func'>TS_phrase_output</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1430"><span class='Ref_to_Const'>TSPO_BOTH</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN176"><span class='Ref_to_Const'>OP_OR</span></a><span class='Operator'>: 
</span>            memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            memset<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <a href="tsvector_op.c.html#LN1577"><span class='Ref_To_Local'>lmatch</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1570"><span class='Ref_to_Func'>TS_phrase_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN192"><span class='Ref_to_Member'>left</span></a><span class='Delimiter'>, 
</span>                                       <a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1572"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1578"><span class='Ref_To_Local'>rmatch</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1570"><span class='Ref_to_Func'>TS_phrase_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                       <a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1572"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN1577"><span class='Ref_To_Local'>lmatch</span></a> <span class='Operator'>&& !</span><a href="tsvector_op.c.html#LN1578"><span class='Ref_To_Local'>rmatch</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * If a valid operand has no position information, then we can't 
             * return position data, only a "possible match" result. "Possible 
             * match" answers are only wanted when TS_EXEC_PHRASE_NO_POS flag 
             * is set, otherwise return false. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN1577"><span class='Ref_To_Local'>lmatch</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>) </span><span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1578"><span class='Ref_To_Local'>rmatch</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& !</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/tsearch/ts_utils.h.html#LN174"><span class='Ref_to_Const'>TS_EXEC_PHRASE_NO_POS</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Boolean'>true </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Cope with undefined output width from failed submatch.  (This 
             * takes less code than trying to ensure that all failure returns 
             * set data-&GT;width to zero.) 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN1577"><span class='Ref_To_Local'>lmatch</span></a><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN1578"><span class='Ref_To_Local'>rmatch</span></a><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * For OP_AND and OP_OR, report the width of the wider of the two 
             * inputs, and align the narrower input's positions to the right 
             * end of that width.  This rule deals at least somewhat 
             * reasonably with cases like "x &LT;-&GT; (y | z &LT;-&GT; q)". 
             */ 
</span>            <a href="tsvector_op.c.html#LN1581"><span class='Ref_To_Local'>maxwidth</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1581"><span class='Ref_To_Local'>maxwidth</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1581"><span class='Ref_To_Local'>maxwidth</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN139"><span class='Ref_to_Member'>width</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1581"><span class='Ref_To_Local'>maxwidth</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* !L | !R: treat as !(L & R) */ 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN1432"><span class='Ref_to_Func'>TS_phrase_output</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1430"><span class='Ref_to_Const'>TSPO_BOTH</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* !L | R: treat as !(L & !R) */ 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN1432"><span class='Ref_to_Func'>TS_phrase_output</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1428"><span class='Ref_to_Const'>TSPO_L_ONLY</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* L | !R: treat as !(!L & R) */ 
</span>                <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN1432"><span class='Ref_to_Func'>TS_phrase_output</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1429"><span class='Ref_to_Const'>TSPO_R_ONLY</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_utils.h.html#LN137"><span class='Ref_to_Member'>negate</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* straight OR */ 
</span>                <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1432"><span class='Ref_to_Func'>TS_phrase_output</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1573"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1430"><span class='Ref_to_Const'>TSPO_BOTH</span></a> <span class='Operator'>| </span><a href="tsvector_op.c.html#LN1428"><span class='Ref_to_Const'>TSPO_L_ONLY</span></a> <span class='Operator'>| </span><a href="tsvector_op.c.html#LN1429"><span class='Ref_to_Const'>TSPO_R_ONLY</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1579"><span class='Ref_To_Local'>Loffset</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1580"><span class='Ref_To_Local'>Roffset</span></a><span class='Delimiter'>, 
</span>                                        <a href="tsvector_op.c.html#LN1575"><span class='Ref_To_Local'>Ldata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1576"><span class='Ref_To_Local'>Rdata</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN135"><span class='Ref_to_Member'>npos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized operator: %d"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1571"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch curitem-&GT;qoperator.op... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* not reachable, but keep compiler quiet */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TS_phrase_execute &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Evaluate tsquery boolean expression. 
 * 
 * curitem: current tsquery item (initially, the first one) 
 * arg: opaque value to pass through to callback function 
 * flags: bitmask of flag bits shown in ts_utils.h 
 * chkcond: callback function to check whether a primitive value is present 
 * 
 * The logic here deals only with operators above any phrase operator, for 
 * which we do not need to worry about lexeme positions.  As soon as we hit an 
 * OP_PHRASE operator, we pass it off to TS_phrase_execute which does worry. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1814"></a><span class='Declare_Function'>TS_execute</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>curitem</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>flags</span><span class='Delimiter'>, 
</span><a name="LN1815"></a>           <a href="../../../include/tsearch/ts_utils.h.html#LN153"><span class='Ref_to_Typedef'>TSExecuteCallback</span></a> <span class='Declare_Parameter'>chkcond</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* since this function recurses, it could be driven to stack overflow */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1815"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN151"><span class='Ref_to_Typedef'>QueryOperand</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a><span class='Delimiter'>, 
</span>                       <span class='Null_Value'>NULL </span><span class='Comment_Multi_Line'>/* we don't need position info */ </span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN174"><span class='Ref_to_Const'>OP_NOT</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="../../../include/tsearch/ts_utils.h.html#LN167"><span class='Ref_to_Const'>TS_EXEC_CALC_NOT</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Operator'>!</span><a href="../../../include/tsearch/ts_utils.h.html#LN176"><span class='Ref_to_Proto'>TS_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1815"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN175"><span class='Ref_to_Const'>OP_AND</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN176"><span class='Ref_to_Proto'>TS_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN192"><span class='Ref_to_Member'>left</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1815"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/tsearch/ts_utils.h.html#LN176"><span class='Ref_to_Proto'>TS_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1815"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN176"><span class='Ref_to_Const'>OP_OR</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN176"><span class='Ref_to_Proto'>TS_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN192"><span class='Ref_to_Member'>left</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1815"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <a href="../../../include/tsearch/ts_utils.h.html#LN176"><span class='Ref_to_Proto'>TS_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1815"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN177"><span class='Ref_to_Const'>OP_PHRASE</span></a><span class='Operator'>: 
</span>            <span class='Control'>return</span> <a href="tsvector_op.c.html#LN1570"><span class='Ref_to_Func'>TS_phrase_execute</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1815"><span class='Ref_to_Parameter'>chkcond</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized operator: %d"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1814"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch curitem-&GT;qoperator.op... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* not reachable, but keep compiler quiet */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end TS_execute &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Detect whether a tsquery boolean expression requires any positive matches 
 * to values shown in the tsquery. 
 * 
 * This is needed to know whether a GIN index search requires full index scan. 
 * For example, 'x & !y' requires a match of x, so it's sufficient to scan 
 * entries for x; but 'x | !y' could match rows containing neither x nor y. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1864"></a><span class='Declare_Function'>tsquery_requires_match</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN201"><span class='Ref_to_Typedef'>QueryItem</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>curitem</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* since this function recurses, it could be driven to stack overflow */ 
</span>    <a href="../../../include/miscadmin.h.html#LN275"><span class='Ref_to_Proto'>check_stack_depth</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1864"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN203"><span class='Ref_to_Member'>type</span></a> <span class='Operator'>== </span><a href="../../../include/tsearch/ts_type.h.html#LN142"><span class='Ref_to_Const'>QI_VAL</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1864"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN174"><span class='Ref_to_Const'>OP_NOT</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Assume there are no required matches underneath a NOT.  For 
             * some cases with nested NOTs, we could prove there's a required 
             * match, but it seems unlikely to be worth the trouble. 
             */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN177"><span class='Ref_to_Const'>OP_PHRASE</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Treat OP_PHRASE as OP_AND here 
             */ 
</span>        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN175"><span class='Ref_to_Const'>OP_AND</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* If either side requires a match, we're good */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN178"><span class='Ref_to_Proto'>tsquery_requires_match</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1864"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1864"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN192"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <a href="../../../include/tsearch/ts_utils.h.html#LN178"><span class='Ref_to_Proto'>tsquery_requires_match</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1864"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/tsearch/ts_type.h.html#LN176"><span class='Ref_to_Const'>OP_OR</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Both sides must require a match */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN178"><span class='Ref_to_Proto'>tsquery_requires_match</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1864"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1864"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN192"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>))</span> 
                <span class='Control'>return</span> <a href="../../../include/tsearch/ts_utils.h.html#LN178"><span class='Ref_to_Proto'>tsquery_requires_match</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1864"><span class='Ref_to_Parameter'>curitem</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized operator: %d"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN1864"><span class='Ref_to_Parameter'>curitem</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN204"><span class='Ref_to_Member'>qoperator</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_type.h.html#LN190"><span class='Ref_to_Member'>oper</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch curitem-&GT;qoperator.op... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* not reachable, but keep compiler quiet */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsquery_requires_match &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * boolean operations 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1914"></a><span class='Declare_Function'>ts_match_qv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN312"><span class='Ref_to_Macro'>PG_RETURN_DATUM</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1921"><span class='Ref_to_Func'>ts_match_vq</span></a><span class='Delimiter'>, 
</span>                                        <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                        <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1922"></a><span class='Declare_Function'>ts_match_vq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1924"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>val</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN128"><span class='Ref_to_Macro'>PG_GETARG_TSVECTOR</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1925"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_TSQUERY</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1926"></a>    <a href="../../../../contrib/intarray/_int_bool.c.html#LN225"><span class='Ref_to_Typedef'>CHKVAL</span></a>      <span class='Declare_Local'>chkval</span><span class='Delimiter'>; 
</span><a name="LN1927"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* empty query matches nothing */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN1925"><span class='Ref_To_Local'>query</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN216"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1924"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1925"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tsvector_op.c.html#LN1926"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>.</span><a href="tsvector_op.c.html#LN35"><span class='Ref_to_Member'>arrb</span></a> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1924"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN1926"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>.</span><a href="tsvector_op.c.html#LN36"><span class='Ref_to_Member'>arre</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN1926"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>.</span><a href="tsvector_op.c.html#LN35"><span class='Ref_to_Member'>arrb</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN1924"><span class='Ref_To_Local'>val</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN1926"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>.</span><a href="tsvector_op.c.html#LN37"><span class='Ref_to_Member'>values</span></a> <span class='Operator'>= </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1924"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN1926"><span class='Ref_To_Local'>chkval</span></a><span class='Operator'>.</span><a href="tsvector_op.c.html#LN38"><span class='Ref_to_Member'>operand</span></a> <span class='Operator'>= </span><a href="../../../../contrib/ltree/ltree.h.html#LN117"><span class='Ref_to_Macro'>GETOPERAND</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1925"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN1927"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_utils.h.html#LN176"><span class='Ref_to_Proto'>TS_execute</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/ltree/ltree.h.html#LN116"><span class='Ref_to_Macro'>GETQUERY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1925"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                        <span class='Operator'>&</span><a href="tsvector_op.c.html#LN1926"><span class='Ref_To_Local'>chkval</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../include/tsearch/ts_utils.h.html#LN167"><span class='Ref_to_Const'>TS_EXEC_CALC_NOT</span></a><span class='Delimiter'>, 
</span>                        <a href="../../../../contrib/ltree/ltxtquery_op.c.html#LN54"><span class='Ref_to_Func'>checkcondition_str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1924"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1925"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1927"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ts_match_vq &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1952"></a><span class='Declare_Function'>ts_match_tt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1954"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>vector</span><span class='Delimiter'>; 
</span><a name="LN1955"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span><a name="LN1956"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN1954"><span class='Ref_To_Local'>vector</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN125"><span class='Ref_to_Macro'>DatumGetTSVector</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../tsearch/to_tsany.c.html#LN255"><span class='Ref_to_Func'>to_tsvector</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN1955"><span class='Ref_To_Local'>query</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN243"><span class='Ref_to_Macro'>DatumGetTSQuery</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../tsearch/to_tsany.c.html#LN551"><span class='Ref_to_Func'>plainto_tsquery</span></a><span class='Delimiter'>, 
</span>                                                <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN1956"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1921"><span class='Ref_to_Func'>ts_match_vq</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/tsearch/ts_type.h.html#LN127"><span class='Ref_to_Macro'>TSVectorGetDatum</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1954"><span class='Ref_To_Local'>vector</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/tsearch/ts_type.h.html#LN245"><span class='Ref_to_Macro'>TSQueryGetDatum</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1955"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1954"><span class='Ref_To_Local'>vector</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1955"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1956"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ts_match_tt &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1974"></a><span class='Declare_Function'>ts_match_tq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1976"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>vector</span><span class='Delimiter'>; 
</span><a name="LN1977"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN220"><span class='Ref_to_Typedef'>TSQuery</span></a>     <span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_TSQUERY</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1978"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN1976"><span class='Ref_To_Local'>vector</span></a> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN125"><span class='Ref_to_Macro'>DatumGetTSVector</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="../../tsearch/to_tsany.c.html#LN255"><span class='Ref_to_Func'>to_tsvector</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN1978"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1921"><span class='Ref_to_Func'>ts_match_vq</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../include/tsearch/ts_type.h.html#LN127"><span class='Ref_to_Macro'>TSVectorGetDatum</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1976"><span class='Ref_To_Local'>vector</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <a href="../../../include/tsearch/ts_type.h.html#LN245"><span class='Ref_to_Macro'>TSQueryGetDatum</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1977"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1976"><span class='Ref_To_Local'>vector</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1977"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN1978"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * ts_stat statistic function support 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Returns the number of positions in value 'wptr' within tsvector 'txt', 
 * that have a weight equal to one of the weights in 'weight' bitmask. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2003"></a><span class='Declare_Function'>check_weight</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>txt</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>wptr</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN253"><span class='Ref_to_Typedef'>int8</span></a> <span class='Declare_Parameter'>weight</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2005"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2003"><span class='Ref_to_Parameter'>txt</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2003"><span class='Ref_to_Parameter'>wptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2006"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>num</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2007"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN62"><span class='Ref_to_Typedef'>WordEntryPos</span></a> <span class='Operator'>*</span><span class='Declare_Local'>ptr</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN119"><span class='Ref_to_Macro'>POSDATAPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2003"><span class='Ref_to_Parameter'>txt</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2003"><span class='Ref_to_Parameter'>wptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2005"><span class='Ref_To_Local'>len</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2003"><span class='Ref_to_Parameter'>weight</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="../../../include/tsearch/ts_type.h.html#LN78"><span class='Ref_to_Macro'>WEP_GETWEIGHT</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN2007"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>)))</span> 
            <a href="tsvector_op.c.html#LN2006"><span class='Ref_To_Local'>num</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2007"><span class='Ref_To_Local'>ptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN2006"><span class='Ref_To_Local'>num</span></a><span class='Delimiter'>; 
} 
</span> 
<a name="LN2018"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>compareStatWord</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>e</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span>                          <span class='Operator'>\ 
</span>    <a href="../../../include/tsearch/ts_utils.h.html#LN184"><span class='Ref_to_Proto'>tsCompareString</span></a><span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN2018"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>lexeme<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2018"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>lenlexeme<span class='Delimiter'>,</span>        <span class='Operator'>\ 
</span>                    <a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2018"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2018"><span class='Ref_to_Parameter'>e</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>pos<span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2018"><span class='Ref_to_Parameter'>e</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>len<span class='Delimiter'>,</span>     <span class='Operator'>\ 
</span>                    <span class='Boolean'>false</span><span class='Parentheses'>)</span> 
 
<span class='Keyword'>static void 
</span><a name="LN2024"></a><span class='Declare_Function'>insertStatEntry</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>persistentContext</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stat</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>txt</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>off</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2026"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN40"><span class='Ref_to_Typedef'>WordEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>we</span> <span class='Operator'>= </span><a href="../../../../contrib/intarray/_int.h.html#LN13"><span class='Ref_to_Macro'>ARRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>txt</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>off</span></a><span class='Delimiter'>; 
</span><a name="LN2027"></a>    <a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN64"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>, 
</span><a name="LN2028"></a>               <span class='Operator'>*</span><span class='Declare_Local'>pnode</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2029"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>, 
</span><a name="LN2030"></a>                <span class='Declare_Local'>res</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN2031"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>depth</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN57"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN2029"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2026"><span class='Ref_To_Local'>we</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="../../../include/tsearch/ts_type.h.html#LN118"><span class='Ref_to_Macro'>POSDATALEN</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>txt</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2026"><span class='Ref_To_Local'>we</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="tsvector_op.c.html#LN2029"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2026"><span class='Ref_To_Local'>we</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN43"><span class='Ref_to_Member'>haspos</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="tsvector_op.c.html#LN2002"><span class='Ref_to_Func'>check_weight</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>txt</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2026"><span class='Ref_To_Local'>we</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN57"><span class='Ref_to_Member'>weight</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2029"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* nothing to insert */ 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN2030"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2018"><span class='Ref_to_Macro'>compareStatWord</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2026"><span class='Ref_To_Local'>we</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>txt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2030"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN2028"><span class='Ref_To_Local'>pnode</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>            <a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2030"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN47"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>: </span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN48"><span class='Ref_to_Member'>right</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="tsvector_op.c.html#LN2031"><span class='Ref_To_Local'>depth</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2031"><span class='Ref_To_Local'>depth</span></a> <span class='Operator'>&GT; </span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN59"><span class='Ref_to_Member'>maxdepth</span></a><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN59"><span class='Ref_to_Member'>maxdepth</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2031"><span class='Ref_To_Local'>depth</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN53"><span class='Ref_to_Const'>STATENTRYHDRSZ</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN2026"><span class='Ref_To_Local'>we</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN47"><span class='Ref_to_Member'>left</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN48"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN44"><span class='Ref_to_Member'>ndoc</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN46"><span class='Ref_to_Member'>nentry</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2029"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN49"><span class='Ref_to_Member'>lenlexeme</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2026"><span class='Ref_To_Local'>we</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN44"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN50"><span class='Ref_to_Member'>lexeme</span></a><span class='Delimiter'>, </span><a href="../../../../contrib/hstore/hstore.h.html#LN75"><span class='Ref_to_Macro'>STRPTR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>txt</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="tsvector_op.c.html#LN2026"><span class='Ref_To_Local'>we</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN45"><span class='Ref_to_Member'>pos</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN49"><span class='Ref_to_Member'>lenlexeme</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2028"><span class='Ref_To_Local'>pnode</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN2024"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN64"><span class='Ref_to_Member'>root</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2030"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN2028"><span class='Ref_To_Local'>pnode</span></a><span class='Operator'>-&GT;</span>left <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="tsvector_op.c.html#LN2028"><span class='Ref_To_Local'>pnode</span></a><span class='Operator'>-&GT;</span>right <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node==NULL &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN44"><span class='Ref_to_Member'>ndoc</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2027"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN46"><span class='Ref_to_Member'>nentry</span></a> <span class='Operator'>+= </span><a href="tsvector_op.c.html#LN2029"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end insertStatEntry &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2090"></a><span class='Declare_Function'>chooseNextStatEntry</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>persistentContext</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stat</span><span class='Delimiter'>, </span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a> <span class='Declare_Parameter'>txt</span><span class='Delimiter'>, 
</span><a name="LN2091"></a>                    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>low</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>high</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>offset</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2093"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>pos</span><span class='Delimiter'>; 
</span><a name="LN2094"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>middle</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>low</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>high</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2093"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>low</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN2094"><span class='Ref_To_Local'>middle</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>low</span></a> <span class='Operator'>!= </span><a href="tsvector_op.c.html#LN2094"><span class='Ref_To_Local'>middle</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN2093"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>&GT;= </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN2093"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>txt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN2023"><span class='Ref_to_Func'>insertStatEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>stat</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>txt</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2093"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2093"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>high</span></a> <span class='Operator'>+ </span><a href="tsvector_op.c.html#LN2094"><span class='Ref_To_Local'>middle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2094"><span class='Ref_To_Local'>middle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>!= </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>high</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN2093"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>&GT;= </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN2093"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>offset</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>txt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN2023"><span class='Ref_to_Func'>insertStatEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>stat</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>txt</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2093"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>low</span></a> <span class='Operator'>!= </span><a href="tsvector_op.c.html#LN2094"><span class='Ref_To_Local'>middle</span></a><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN2089"><span class='Ref_to_Func'>chooseNextStatEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>stat</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>txt</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>low</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2094"><span class='Ref_To_Local'>middle</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>high</span></a> <span class='Operator'>!= </span><a href="tsvector_op.c.html#LN2094"><span class='Ref_To_Local'>middle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN2089"><span class='Ref_to_Func'>chooseNextStatEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>stat</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2090"><span class='Ref_to_Parameter'>txt</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2094"><span class='Ref_To_Local'>middle</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>high</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2091"><span class='Ref_to_Parameter'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * This is written like a custom aggregate function, because the 
 * original plan was to do just that. Unfortunately, an aggregate function 
 * can't return a set, so that plan was abandoned. If that limitation is 
 * lifted in the future, ts_stat could be a real aggregate function so that 
 * you could use it like this: 
 * 
 *   SELECT ts_stat(vector_column) FROM vector_table; 
 * 
 *  where vector_column is a tsvector-type column in vector_table. 
 */ 
</span> 
<span class='Keyword'>static </span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>* 
</span><a name="LN2122"></a><span class='Declare_Function'>ts_accum</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>persistentContext</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stat</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>data</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2124"></a>    <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>txt</span> <span class='Operator'>= </span><a href="../../../include/tsearch/ts_type.h.html#LN125"><span class='Ref_to_Macro'>DatumGetTSVector</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2125"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>, 
</span><a name="LN2126"></a>                <span class='Declare_Local'>nbit</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, 
</span><a name="LN2127"></a>                <span class='Declare_Local'>offset</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>stat</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{</span>                           <span class='Comment_Single_Line'>/* Init in first */ 
</span>        <a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>stat</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN59"><span class='Ref_to_Member'>maxdepth</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* simple check of correctness */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2124"><span class='Ref_To_Local'>txt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="tsvector_op.c.html#LN2124"><span class='Ref_To_Local'>txt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2124"><span class='Ref_To_Local'>txt</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN2124"><span class='Ref_To_Local'>txt</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2124"><span class='Ref_To_Local'>txt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>stat</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tsvector_op.c.html#LN2125"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2124"><span class='Ref_To_Local'>txt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN2125"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN2125"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN2126"><span class='Ref_To_Local'>nbit</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2126"><span class='Ref_To_Local'>nbit</span></a> <span class='Operator'>= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="tsvector_op.c.html#LN2126"><span class='Ref_To_Local'>nbit</span></a><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2127"><span class='Ref_To_Local'>offset</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2126"><span class='Ref_To_Local'>nbit</span></a> <span class='Operator'>- </span><a href="tsvector_op.c.html#LN2124"><span class='Ref_To_Local'>txt</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2023"><span class='Ref_to_Func'>insertStatEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>stat</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2124"><span class='Ref_To_Local'>txt</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2126"><span class='Ref_To_Local'>nbit</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="tsvector_op.c.html#LN2127"><span class='Ref_To_Local'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2089"><span class='Ref_to_Func'>chooseNextStatEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>stat</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2124"><span class='Ref_To_Local'>txt</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2126"><span class='Ref_To_Local'>nbit</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2127"><span class='Ref_To_Local'>offset</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN2122"><span class='Ref_to_Parameter'>stat</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ts_accum &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN2157"></a><span class='Declare_Function'>ts_setup_firstcall</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>funcctx</span><span class='Delimiter'>, 
</span><a name="LN2158"></a>                   <a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stat</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2160"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN2161"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span><a name="LN2162"></a>    <a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>node</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2157"><span class='Ref_to_Parameter'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2161"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2157"><span class='Ref_to_Parameter'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN61"><span class='Ref_to_Member'>stack</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN59"><span class='Ref_to_Member'>maxdepth</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2162"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN64"><span class='Ref_to_Member'>root</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* find leftmost value */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2162"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN61"><span class='Ref_to_Member'>stack</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN61"><span class='Ref_to_Member'>stack</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN2162"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2162"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN47"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN2162"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2162"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN47"><span class='Ref_to_Member'>left</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a> <span class='Operator'>&LT;= </span><a href="tsvector_op.c.html#LN2158"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN59"><span class='Ref_to_Member'>maxdepth</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2160"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../access/common/tupdesc.c.html#LN39"><span class='Ref_to_Func'>CreateTemplateTupleDesc</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>"word"</span><span class='Delimiter'>, 
</span>                       <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"ndoc"</span><span class='Delimiter'>, 
</span>                       <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/tupdesc.h.html#LN114"><span class='Ref_to_Proto'>TupleDescInitEntry</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="../../../include/access/attnum.h.html#LN20"><span class='Ref_to_Typedef'>AttrNumber</span></a><span class='Parentheses'>) </span><span class='Number'>3</span><span class='Delimiter'>, </span><span class='String'>"nentry"</span><span class='Delimiter'>, 
</span>                       <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2157"><span class='Ref_to_Parameter'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN119"><span class='Ref_to_Member'>tuple_desc</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN229"><span class='Ref_to_Proto'>BlessTupleDesc</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2157"><span class='Ref_to_Parameter'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN98"><span class='Ref_to_Member'>attinmeta</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN230"><span class='Ref_to_Proto'>TupleDescGetAttInMetadata</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2160"><span class='Ref_To_Local'>tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2161"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ts_setup_firstcall &raquo; </span> 
 
<span class='Keyword'>static </span><a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a> <span class='Operator'>* 
</span><a name="LN2203"></a><span class='Declare_Function'>walkStatEntryTree</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>stat</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2205"></a>    <a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>node</span> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN61"><span class='Ref_to_Member'>stack</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN44"><span class='Ref_to_Member'>ndoc</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* return entry itself: we already was at left sublink */ 
</span>        <span class='Control'>return</span> <a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN48"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>&& </span><a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN48"><span class='Ref_to_Member'>right</span></a> <span class='Operator'>!= </span><a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN61"><span class='Ref_to_Member'>stack</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* go on right sublink */ 
</span>        <a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN48"><span class='Ref_to_Member'>right</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* find most-left value */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN61"><span class='Ref_to_Member'>stack</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN47"><span class='Ref_to_Member'>left</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN47"><span class='Ref_to_Member'>left</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a> <span class='Operator'>&LT;= </span><a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN59"><span class='Ref_to_Member'>maxdepth</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if node-&GT;right&&node-&GT;ri... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* we already return all left subtree, itself and  right subtree */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN62"><span class='Ref_to_Member'>stackpos</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span> <a href="tsvector_op.c.html#LN2202"><span class='Ref_to_Func'>walkStatEntryTree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2203"><span class='Ref_to_Parameter'>stat</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN2205"><span class='Ref_To_Local'>node</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end walkStatEntryTree &raquo; </span> 
 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2249"></a><span class='Declare_Function'>ts_process_call</span><span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>funcctx</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2251"></a>    <a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Declare_Local'>st</span><span class='Delimiter'>; 
</span><a name="LN2252"></a>    <a href="tsvector_op.c.html#LN42"><span class='Ref_to_Struct'>StatEntry</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>entry</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2251"><span class='Ref_To_Local'>st</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="tsvector_op.c.html#LN2249"><span class='Ref_to_Parameter'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN89"><span class='Ref_to_Member'>user_fctx</span></a><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2252"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2202"><span class='Ref_to_Func'>walkStatEntryTree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2251"><span class='Ref_To_Local'>st</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2252"><span class='Ref_To_Local'>entry</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2260"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2261"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]; 
</span><a name="LN2262"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>ndoc</span><span class='Delimiter'>[</span><span class='Number'>16</span><span class='Delimiter'>]; 
</span><a name="LN2263"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>nentry</span><span class='Delimiter'>[</span><span class='Number'>16</span><span class='Delimiter'>]; 
</span><a name="LN2264"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2261"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2252"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN49"><span class='Ref_to_Member'>lenlexeme</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2261"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], </span><a href="tsvector_op.c.html#LN2252"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN50"><span class='Ref_to_Member'>lexeme</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2252"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN49"><span class='Ref_to_Member'>lenlexeme</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2261"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2252"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN49"><span class='Ref_to_Member'>lenlexeme</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2262"><span class='Ref_To_Local'>ndoc</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2252"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN44"><span class='Ref_to_Member'>ndoc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2261"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN2262"><span class='Ref_To_Local'>ndoc</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/port.h.html#LN170"><span class='Ref_to_Macro'>sprintf</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2263"><span class='Ref_To_Local'>nentry</span></a><span class='Delimiter'>, </span><span class='String'>"%d"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2252"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN46"><span class='Ref_to_Member'>nentry</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2261"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="tsvector_op.c.html#LN2263"><span class='Ref_To_Local'>nentry</span></a><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2264"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN231"><span class='Ref_to_Proto'>BuildTupleFromCStrings</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2249"><span class='Ref_to_Parameter'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN98"><span class='Ref_to_Member'>attinmeta</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2261"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2260"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN221"><span class='Ref_to_Macro'>HeapTupleGetDatum</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2264"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2261"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* mark entry as already visited */ 
</span>        <a href="tsvector_op.c.html#LN2252"><span class='Ref_To_Local'>entry</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN44"><span class='Ref_to_Member'>ndoc</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="tsvector_op.c.html#LN2260"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if entry!=NULL &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ts_process_call &raquo; </span> 
 
<span class='Keyword'>static </span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>* 
</span><a name="LN2289"></a><span class='Declare_Function'>ts_stat_sql</span><span class='Parentheses'>(</span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Parameter'>persistentContext</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>txt</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ws</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2291"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2289"><span class='Ref_to_Parameter'>txt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2292"></a>    <a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stat</span><span class='Delimiter'>; 
</span><a name="LN2293"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN2294"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN2295"></a>    <a href="../../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN2295"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN99"><span class='Ref_to_Proto'>SPI_prepare</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2291"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Comment_Multi_Line'>/* internal error */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_prepare(\"%s\") failed"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2291"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN2294"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN138"><span class='Ref_to_Proto'>SPI_cursor_open</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2295"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <span class='Comment_Multi_Line'>/* internal error */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_cursor_open(\"%s\") failed"</span><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2291"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN148"><span class='Ref_to_Proto'>SPI_cursor_fetch</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2294"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| 
</span>        <a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>!= </span><span class='Number'>1</span> <span class='Operator'>|| 
</span>        <span class='Operator'>!</span><a href="../../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN70"><span class='Ref_to_Const'>TSVECTOROID</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"ts_stat query must return one tsvector column"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2289"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN59"><span class='Ref_to_Member'>maxdepth</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2289"><span class='Ref_to_Parameter'>ws</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2320"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2320"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2289"><span class='Ref_to_Parameter'>ws</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2320"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>- </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2289"><span class='Ref_to_Parameter'>ws</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2289"><span class='Ref_to_Parameter'>ws</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2320"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="tsvector_op.c.html#LN2320"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Control'>case</span> <span class='String'>'A'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'a'</span><span class='Operator'>: 
</span>                        <a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN57"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>|= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'B'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'b'</span><span class='Operator'>: 
</span>                        <a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN57"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>|= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'C'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'c'</span><span class='Operator'>: 
</span>                        <a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN57"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>|= </span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>case</span> <span class='String'>'D'</span><span class='Operator'>: 
</span>                    <span class='Control'>case</span> <span class='String'>'d'</span><span class='Operator'>: 
</span>                        <a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN57"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>|= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                        <span class='Control'>break</span><span class='Delimiter'>; 
</span>                    <span class='Control'>default</span><span class='Operator'>: 
</span>                        <a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a><span class='Operator'>-&GT;</span><a href="tsvector_op.c.html#LN57"><span class='Ref_to_Member'>weight</span></a> <span class='Operator'>|= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch *buf &raquo; </span> 
            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if pg_mblen(buf)==1 &raquo; </span> 
            <a href="tsvector_op.c.html#LN2320"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2320"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while buf-VARDATA_ANY(ws)&LT;V... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ws &raquo; </span> 
 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2355"></a>        <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2355"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN2355"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN2355"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN2359"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2355"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], </span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN2293"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="tsvector_op.c.html#LN2293"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>                <a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2121"><span class='Ref_to_Func'>ts_accum</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2289"><span class='Ref_to_Parameter'>persistentContext</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2359"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/executor/spi.h.html#LN148"><span class='Ref_to_Proto'>SPI_cursor_fetch</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2294"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>100</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/executor/spi.h.html#LN136"><span class='Ref_to_Proto'>SPI_freetuptable</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN152"><span class='Ref_to_Proto'>SPI_cursor_close</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2294"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN108"><span class='Ref_to_Proto'>SPI_freeplan</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2295"><span class='Ref_To_Local'>plan</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2291"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN2292"><span class='Ref_To_Local'>stat</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ts_stat_sql &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2378"></a><span class='Declare_Function'>ts_stat1</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2380"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN2381"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2385"></a>        <a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stat</span><span class='Delimiter'>; 
</span><a name="LN2386"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>txt</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2380"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2385"><span class='Ref_To_Local'>stat</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2288"><span class='Ref_to_Func'>ts_stat_sql</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2380"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2386"><span class='Ref_To_Local'>txt</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2386"><span class='Ref_To_Local'>txt</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2156"><span class='Ref_to_Func'>ts_setup_firstcall</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2380"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2385"><span class='Ref_To_Local'>stat</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tsvector_op.c.html#LN2380"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN2381"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2248"><span class='Ref_to_Func'>ts_process_call</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2380"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span> <span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2380"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2381"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2380"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ts_stat1 &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2403"></a><span class='Declare_Function'>ts_stat2</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2405"></a>    <a href="../../../include/funcapi.h.html#LN56"><span class='Ref_to_Struct'>FuncCallContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>funcctx</span><span class='Delimiter'>; 
</span><a name="LN2406"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/funcapi.h.html#LN284"><span class='Ref_to_Macro'>SRF_IS_FIRSTCALL</span></a><span class='Parentheses'>())</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2410"></a>        <a href="tsvector_op.c.html#LN55"><span class='Ref_to_Typedef'>TSVectorStat</span></a> <span class='Operator'>*</span><span class='Declare_Local'>stat</span><span class='Delimiter'>; 
</span><a name="LN2411"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>txt</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2412"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ws</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2405"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN286"><span class='Ref_to_Macro'>SRF_FIRSTCALL_INIT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2410"><span class='Ref_To_Local'>stat</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2288"><span class='Ref_to_Func'>ts_stat_sql</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2405"><span class='Ref_To_Local'>funcctx</span></a><span class='Operator'>-&GT;</span><a href="../../../include/funcapi.h.html#LN108"><span class='Ref_to_Member'>multi_call_memory_ctx</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2411"><span class='Ref_To_Local'>txt</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2412"><span class='Ref_To_Local'>ws</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2411"><span class='Ref_To_Local'>txt</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2412"><span class='Ref_To_Local'>ws</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2156"><span class='Ref_to_Func'>ts_setup_firstcall</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2405"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2410"><span class='Ref_To_Local'>stat</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="tsvector_op.c.html#LN2405"><span class='Ref_To_Local'>funcctx</span></a> <span class='Operator'>= </span><a href="../../../include/funcapi.h.html#LN288"><span class='Ref_to_Macro'>SRF_PERCALL_SETUP</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="tsvector_op.c.html#LN2406"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2248"><span class='Ref_to_Func'>ts_process_call</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2405"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>))</span> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span> <span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/funcapi.h.html#LN290"><span class='Ref_to_Macro'>SRF_RETURN_NEXT</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2405"><span class='Ref_To_Local'>funcctx</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2406"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/funcapi.h.html#LN308"><span class='Ref_to_Macro'>SRF_RETURN_DONE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2405"><span class='Ref_To_Local'>funcctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ts_stat2 &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Triggers for automatic update of a tsvector column from text column(s) 
 * 
 * Trigger arguments are either 
 *      name of tsvector col, name of tsconfig to use, name(s) of text col(s) 
 *      name of tsvector col, name of regconfig col, name(s) of text col(s) 
 * ie, tsconfig can either be specified by name, or indirectly as the 
 * contents of a regconfig field in the row.  If the name is used, it must 
 * be explicitly schema-qualified. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2441"></a><span class='Declare_Function'>tsvector_update_trigger_byid</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN69"><span class='Ref_to_Proto'>tsvector_update_trigger</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2447"></a><span class='Declare_Function'>tsvector_update_trigger_bycolumn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="tsvector_op.c.html#LN69"><span class='Ref_to_Proto'>tsvector_update_trigger</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2453"></a><span class='Declare_Function'>tsvector_update_trigger</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>config_column</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2455"></a>    <a href="../../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>trigdata</span><span class='Delimiter'>; 
</span><a name="LN2456"></a>    <a href="../../../include/utils/reltrigger.h.html#LN22"><span class='Ref_to_Struct'>Trigger</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>trigger</span><span class='Delimiter'>; 
</span><a name="LN2457"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN2458"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>rettuple</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2459"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>tsvector_attr_num</span><span class='Delimiter'>, 
</span><a name="LN2460"></a>                <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2461"></a>    <a href="../../../include/tsearch/ts_utils.h.html#LN82"><span class='Ref_to_Typedef'>ParsedText</span></a>  <span class='Declare_Local'>prs</span><span class='Delimiter'>; 
</span><a name="LN2462"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN2463"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span><a name="LN2464"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>txt</span><span class='Delimiter'>; 
</span><a name="LN2465"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>cfgId</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check call context */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/commands/trigger.h.html#LN24"><span class='Ref_to_Macro'>CALLED_AS_TRIGGER</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>))</span>     <span class='Comment_Single_Line'>/* internal error */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"tsvector_update_trigger: not fired by trigger manager"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2455"><span class='Ref_To_Local'>trigdata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN29"><span class='Ref_to_Struct'>TriggerData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>context<span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/commands/trigger.h.html#LN81"><span class='Ref_to_Macro'>TRIGGER_FIRED_FOR_ROW</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2455"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"tsvector_update_trigger: must be fired for row"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/commands/trigger.h.html#LN87"><span class='Ref_to_Macro'>TRIGGER_FIRED_BEFORE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2455"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"tsvector_update_trigger: must be fired BEFORE event"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN69"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_INSERT</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2455"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="tsvector_op.c.html#LN2458"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2455"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN34"><span class='Ref_to_Member'>tg_trigtuple</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/commands/trigger.h.html#LN75"><span class='Ref_to_Macro'>TRIGGER_FIRED_BY_UPDATE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2455"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN32"><span class='Ref_to_Member'>tg_event</span></a><span class='Parentheses'>))</span> 
        <a href="tsvector_op.c.html#LN2458"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2455"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN35"><span class='Ref_to_Member'>tg_newtuple</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"tsvector_update_trigger: must be fired for INSERT or UPDATE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2455"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN36"><span class='Ref_to_Member'>tg_trigger</span></a><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="tsvector_op.c.html#LN2455"><span class='Ref_To_Local'>trigdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/commands/trigger.h.html#LN33"><span class='Ref_to_Member'>tg_relation</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a> <span class='Operator'>&LT; </span><span class='Number'>3</span><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"tsvector_update_trigger: arguments must be tsvector_field, ts_config, text_field1, ...)"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the target tsvector column */ 
</span>    <a href="tsvector_op.c.html#LN2459"><span class='Ref_To_Local'>tsvector_attr_num</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN123"><span class='Ref_to_Proto'>SPI_fnumber</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2459"><span class='Ref_To_Local'>tsvector_attr_num</span></a> <span class='Operator'>== </span><a href="../../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"tsvector column \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                        <a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* This will effectively reject system columns, so no separate test: */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2459"><span class='Ref_To_Local'>tsvector_attr_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                           <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN70"><span class='Ref_to_Const'>TSVECTOROID</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" is not of tsvector type"</span><span class='Delimiter'>, 
</span>                        <a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Find the configuration to use */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2453"><span class='Ref_to_Parameter'>config_column</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2508"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>config_attr_num</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2508"><span class='Ref_To_Local'>config_attr_num</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN123"><span class='Ref_to_Proto'>SPI_fnumber</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2508"><span class='Ref_To_Local'>config_attr_num</span></a> <span class='Operator'>== </span><a href="../../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"configuration column \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2508"><span class='Ref_To_Local'>config_attr_num</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                               <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN73"><span class='Ref_to_Const'>REGCONFIGOID</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" is not of regconfig type"</span><span class='Delimiter'>, 
</span>                            <a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2458"><span class='Ref_To_Local'>rettuple</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2508"><span class='Ref_To_Local'>config_attr_num</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN2463"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2463"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"configuration column \"%s\" must not be null"</span><span class='Delimiter'>, 
</span>                            <a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2465"><span class='Ref_To_Local'>cfgId</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if config_column &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2533"></a>        <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>names</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2533"><span class='Ref_To_Local'>names</span></a> <span class='Operator'>= </span><a href="../../../include/utils/regproc.h.html#LN17"><span class='Ref_to_Proto'>stringToQualifiedNameList</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* require a schema so that results are not search path dependent */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2533"><span class='Ref_To_Local'>names</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT; </span><span class='Number'>2</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"text search configuration name \"%s\" must be schema-qualified"</span><span class='Delimiter'>, 
</span>                            <a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2465"><span class='Ref_To_Local'>cfgId</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN106"><span class='Ref_to_Proto'>get_ts_config_oid</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2533"><span class='Ref_To_Local'>names</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* initialize parse state */ 
</span>    <a href="tsvector_op.c.html#LN2461"><span class='Ref_To_Local'>prs</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN85"><span class='Ref_to_Member'>lenwords</span></a> <span class='Operator'>= </span><span class='Number'>32</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2461"><span class='Ref_To_Local'>prs</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN86"><span class='Ref_to_Member'>curwords</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2461"><span class='Ref_To_Local'>prs</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN87"><span class='Ref_to_Member'>pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="tsvector_op.c.html#LN2461"><span class='Ref_To_Local'>prs</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN84"><span class='Ref_to_Member'>words</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN62"><span class='Ref_to_Typedef'>ParsedWord</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/tsearch/ts_utils.h.html#LN62"><span class='Ref_to_Typedef'>ParsedWord</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="tsvector_op.c.html#LN2461"><span class='Ref_To_Local'>prs</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN85"><span class='Ref_to_Member'>lenwords</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* find all words in indexable column(s) */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2460"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>2</span><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN2460"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN36"><span class='Ref_to_Member'>tgnargs</span></a><span class='Delimiter'>; </span><a href="tsvector_op.c.html#LN2460"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2554"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>numattr</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2554"><span class='Ref_To_Local'>numattr</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN123"><span class='Ref_to_Proto'>SPI_fnumber</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2460"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2554"><span class='Ref_To_Local'>numattr</span></a> <span class='Operator'>== </span><a href="../../../include/executor/spi.h.html#LN43"><span class='Ref_to_Const'>SPI_ERROR_NOATTRIBUTE</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_COLUMN<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" does not exist"</span><span class='Delimiter'>, 
</span>                            <a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2460"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/parser/parse_coerce.h.html#LN33"><span class='Ref_to_Proto'>IsBinaryCoercible</span></a><span class='Parentheses'>(</span><a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2554"><span class='Ref_To_Local'>numattr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATATYPE_MISMATCH<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column \"%s\" is not of a character type"</span><span class='Delimiter'>, 
</span>                            <a href="tsvector_op.c.html#LN2456"><span class='Ref_To_Local'>trigger</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/reltrigger.h.html#LN39"><span class='Ref_to_Member'>tgargs</span></a><span class='Delimiter'>[</span><a href="tsvector_op.c.html#LN2460"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2458"><span class='Ref_To_Local'>rettuple</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2554"><span class='Ref_To_Local'>numattr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN2463"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2463"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <a href="tsvector_op.c.html#LN2464"><span class='Ref_To_Local'>txt</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/tsearch/ts_utils.h.html#LN90"><span class='Ref_to_Proto'>parsetext</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2465"><span class='Ref_To_Local'>cfgId</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN2461"><span class='Ref_To_Local'>prs</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2464"><span class='Ref_To_Local'>txt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2464"><span class='Ref_To_Local'>txt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2464"><span class='Ref_To_Local'>txt</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2464"><span class='Ref_To_Local'>txt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=2;i&LT;trigger-&GT;tgnarg... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* make tsvector value */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2461"><span class='Ref_To_Local'>prs</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN86"><span class='Ref_to_Member'>curwords</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../tsearch/to_tsany.c.html#LN152"><span class='Ref_to_Func'>make_tsvector</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN2461"><span class='Ref_To_Local'>prs</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2463"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2458"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN807"><span class='Ref_to_Proto'>heap_modify_tuple_by_cols</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2458"><span class='Ref_To_Local'>rettuple</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, 
</span>                                             <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN2459"><span class='Ref_To_Local'>tsvector_attr_num</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN2463"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2592"></a>        <a href="../../../include/tsearch/ts_type.h.html#LN106"><span class='Ref_to_Typedef'>TSVector</span></a>    <span class='Declare_Local'>out</span> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../../contrib/hstore/hstore.h.html#LN71"><span class='Ref_to_Macro'>CALCDATASIZE</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2592"><span class='Ref_To_Local'>out</span></a><span class='Delimiter'>, </span><a href="../../../../contrib/hstore/hstore.h.html#LN71"><span class='Ref_to_Macro'>CALCDATASIZE</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2592"><span class='Ref_To_Local'>out</span></a><span class='Operator'>-&GT;</span><a href="../../../include/tsearch/ts_type.h.html#LN101"><span class='Ref_to_Member'>size</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2592"><span class='Ref_To_Local'>out</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2463"><span class='Ref_To_Local'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="tsvector_op.c.html#LN2458"><span class='Ref_To_Local'>rettuple</span></a> <span class='Operator'>= </span><a href="../../../include/access/htup_details.h.html#LN807"><span class='Ref_to_Proto'>heap_modify_tuple_by_cols</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2458"><span class='Ref_To_Local'>rettuple</span></a><span class='Delimiter'>, </span><a href="tsvector_op.c.html#LN2457"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, 
</span>                                             <span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN2459"><span class='Ref_To_Local'>tsvector_attr_num</span></a><span class='Delimiter'>, 
</span>                                             <span class='Operator'>&</span><a href="tsvector_op.c.html#LN2462"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="tsvector_op.c.html#LN2463"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2461"><span class='Ref_To_Local'>prs</span></a><span class='Operator'>.</span><a href="../../../include/tsearch/ts_utils.h.html#LN84"><span class='Ref_to_Member'>words</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="tsvector_op.c.html#LN2458"><span class='Ref_To_Local'>rettuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end tsvector_update_trigger &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>