<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\varlena.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\varlena.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:55 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * varlena.c 
 *    Functions for the variable-length built-in types. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/adt/varlena.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>&LT;ctype.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;limits.h&GT;</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/tuptoaster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_collation.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"common/md5.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/hyperloglog.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"parser/scansup.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"port/pg_bswap.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"regex/regex.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/bytea.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/pg_locale.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/sortsupport.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/varlena.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* GUC variable */ 
</span><a name="LN40"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>bytea_output</span> <span class='Operator'>= </span><a href="../../../include/utils/bytea.h.html#LN22"><span class='Ref_to_EnumConst'>BYTEA_OUTPUT_HEX</span></a><span class='Delimiter'>; 
</span> 
<a name="LN42"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="../../../include/c.h.html#LN438"><span class='Ref_to_Struct'>varlena</span></a> <span class='Declare_Typedef'>unknown</span><span class='Delimiter'>; 
</span><a name="LN43"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <a href="../../../include/c.h.html#LN438"><span class='Ref_to_Struct'>varlena</span></a> <span class='Declare_Typedef'>VarString</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN47"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>use_wchar</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* T if multibyte encoding */ 
</span><a name="LN48"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>str1</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* use these if not use_wchar */ 
</span><a name="LN49"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>str2</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* note: these point to original texts */ 
</span><a name="LN50"></a>    <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>wstr1</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* use these if use_wchar */ 
</span><a name="LN51"></a>    <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Member'>wstr2</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* note: these are palloc'd */ 
</span><a name="LN52"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>len1</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* string lengths in logical characters */ 
</span><a name="LN53"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>len2</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* Skip table for Boyer-Moore-Horspool search algorithm: */ 
</span><a name="LN55"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>skiptablemask</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* mask for ANDing with skiptable subscripts */ 
</span><a name="LN56"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>skiptable</span><span class='Delimiter'>[</span><span class='Number'>256</span><span class='Delimiter'>]; </span><span class='Comment_Single_Line'>/* skip distance for given mismatched char */ 
</span><a name="LN57"></a><span class='Delimiter'>} </span><span class='Declare_Typedef'>TextPositionState</span><span class='Delimiter'>; 
</span> 
<span class='Control'>typedef</span> <span class='Control'>struct</span> 
<span class='Delimiter'>{ 
</span><a name="LN61"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>buf1</span><span class='Delimiter'>;</span>           <span class='Comment_Multi_Line'>/* 1st string, or abbreviation original string 
                                 * buf */ 
</span><a name="LN63"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Member'>buf2</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* 2nd string, or abbreviation strxfrm() buf */ 
</span><a name="LN64"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>buflen1</span><span class='Delimiter'>; 
</span><a name="LN65"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>buflen2</span><span class='Delimiter'>; 
</span><a name="LN66"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>last_len1</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Length of last buf1 string/strxfrm() input */ 
</span><a name="LN67"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>last_len2</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Length of last buf2 string/strxfrm() blob */ 
</span><a name="LN68"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>last_returned</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* Last comparison result (cache) */ 
</span><a name="LN69"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>cache_blob</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* Does buf2 contain strxfrm() blob, etc? */ 
</span><a name="LN70"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>collate_c</span><span class='Delimiter'>; 
</span><a name="LN71"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>bpchar</span><span class='Delimiter'>;</span>         <span class='Comment_Single_Line'>/* Sorting bpchar, not varchar/text/bytea? */ 
</span><a name="LN72"></a>    <a href="../../../include/lib/hyperloglog.h.html#LN52"><span class='Ref_to_Struct'>hyperLogLogState</span></a> <span class='Declare_Member'>abbr_card</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* Abbreviated key cardinality state */ 
</span><a name="LN73"></a>    <a href="../../../include/lib/hyperloglog.h.html#LN52"><span class='Ref_to_Struct'>hyperLogLogState</span></a> <span class='Declare_Member'>full_card</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* Full key cardinality state */ 
</span><a name="LN74"></a>    <span class='Keyword'>double</span>      <span class='Declare_Member'>prop_card</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* Required cardinality proportion */ 
</span><a name="LN75"></a>    <a href="../../../include/utils/pg_locale.h.html#LN87"><span class='Ref_to_Typedef'>pg_locale_t</span></a> <span class='Declare_Member'>locale</span><span class='Delimiter'>; 
</span><a name="LN76"></a>} <span class='Declare_Typedef'>VarStringSortSupport</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* 
 * This should be large enough that most strings will fit, but small enough 
 * that we feel comfortable putting it on the stack 
 */ 
</span><a name="LN82"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TEXTBUFLEN</span>      <span class='Number'>1024</span> 
 
<a name="LN84"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetUnknownP</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>         <span class='Parentheses'>((</span><a href="varlena.c.html#LN42"><span class='Ref_to_Typedef'>unknown</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN84"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN85"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetUnknownPCopy</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>     <span class='Parentheses'>((</span><a href="varlena.c.html#LN42"><span class='Ref_to_Typedef'>unknown</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN206"><span class='Ref_to_Macro'>PG_DETOAST_DATUM_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN85"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN86"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_GETARG_UNKNOWN_P</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>)</span>      <a href="varlena.c.html#LN84"><span class='Ref_to_Macro'>DatumGetUnknownP</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN86"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> 
<a name="LN87"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_GETARG_UNKNOWN_P_COPY</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN85"><span class='Ref_to_Macro'>DatumGetUnknownPCopy</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN87"><span class='Ref_to_Parameter'>n</span></a><span class='Parentheses'>))</span> 
<a name="LN88"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_RETURN_UNKNOWN_P</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>x</span><span class='Parentheses'>)</span>      <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN88"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>) 
</span> 
<a name="LN90"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetVarStringP</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>       <span class='Parentheses'>((</span><a href="varlena.c.html#LN43"><span class='Ref_to_Typedef'>VarString</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN204"><span class='Ref_to_Macro'>PG_DETOAST_DATUM</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN90"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
<a name="LN91"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DatumGetVarStringPP</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>X</span><span class='Parentheses'>)</span>      <span class='Parentheses'>((</span><a href="varlena.c.html#LN43"><span class='Ref_to_Typedef'>VarString</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN212"><span class='Ref_to_Macro'>PG_DETOAST_DATUM_PACKED</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN91"><span class='Ref_to_Parameter'>X</span></a><span class='Parentheses'>))</span> 
 
<a name="LN93"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>varstrfastcmp_c</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN94"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>bpcharfastcmp_c</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN95"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>varstrfastcmp_locale</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN96"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>varstrcmp_abbrev</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN97"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>varstr_abbrev_convert</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>original</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN98"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>varstr_abbrev_abort</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>memtupcount</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN99"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Prototype'>text_length</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>str</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN100"></a><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>text_catenate</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN101"></a><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>text_substring</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>str</span><span class='Delimiter'>, 
</span><a name="LN102"></a>               <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>start</span><span class='Delimiter'>, 
</span><a name="LN103"></a>               <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>length</span><span class='Delimiter'>, 
</span><a name="LN104"></a>               <span class='Keyword'>bool </span><span class='Declare_Parameter'>length_not_specified</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN105"></a><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>text_overlay</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sl</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN106"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>text_position</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN107"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>text_position_setup</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN108"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>text_position_next</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>start_pos</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN109"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>text_position_cleanup</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN110"></a><span class='Keyword'>static int</span>  <span class='Declare_Prototype'>text_cmp</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg2</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collid</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN111"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>bytea_catenate</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN112"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>bytea_substring</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>str</span><span class='Delimiter'>, 
</span><a name="LN113"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>S</span><span class='Delimiter'>, 
</span><a name="LN114"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>L</span><span class='Delimiter'>, 
</span><a name="LN115"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>length_not_specified</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN116"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>bytea_overlay</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sl</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN117"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>appendStringInfoText</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN118"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>text_to_array_internal</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN119"></a><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>array_to_text_internal</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, 
</span><a name="LN120"></a>                       <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fldsep</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>null_string</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN121"></a><span class='Keyword'>static </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Prototype'>makeStringAggState</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN122"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>text_format_parse_digits</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>end_ptr</span><span class='Delimiter'>, 
</span><a name="LN123"></a>                         <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN124"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>text_format_parse_format</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>start_ptr</span><span class='Delimiter'>, 
</span><a name="LN125"></a>                         <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>end_ptr</span><span class='Delimiter'>, 
</span><a name="LN126"></a>                         <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>argpos</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>widthpos</span><span class='Delimiter'>, 
</span><a name="LN127"></a>                         <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>flags</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>width</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN128"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>text_format_string_conversion</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>conversion</span><span class='Delimiter'>, 
</span><a name="LN129"></a>                              <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typOutputInfo</span><span class='Delimiter'>, 
</span><a name="LN130"></a>                              <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN131"></a>                              <span class='Keyword'>int </span><span class='Declare_Parameter'>flags</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>width</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN132"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>text_format_append_string</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, 
</span><a name="LN133"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>flags</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>width</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *   CONVERSION ROUTINES EXPORTED FOR USE BY C CODE                          * 
 *****************************************************************************/ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * cstring_to_text 
 * 
 * Create a text value from a null-terminated C string. 
 * 
 * The new text value is freshly palloc'd with a full-size VARHDR. 
 */ 
</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN148"></a><span class='Declare_Function'>cstring_to_text</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN148"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="varlena.c.html#LN148"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * cstring_to_text_with_len 
 * 
 * Same as cstring_to_text except the caller specifies the string length; 
 * the string need not be null_terminated. 
 */ 
</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN160"></a><span class='Declare_Function'>cstring_to_text_with_len</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN162"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN160"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN162"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN160"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN162"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN160"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN160"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN162"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_to_cstring 
 * 
 * Create a palloc'd, null-terminated C string from a text value. 
 * 
 * We support being passed a compressed or toasted text value. 
 * This is a bit bogus since such values shouldn't really be referred to as 
 * "text *", but it seems useful for robustness.  If we didn't handle that 
 * case here, we'd need another routine that did, anyway. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN181"></a><span class='Declare_Function'>text_to_cstring</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* must cast away the const, unfortunately */ 
</span><a name="LN184"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tunpacked</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN202"><span class='Ref_to_Proto'>pg_detoast_datum_packed</span></a><span class='Parentheses'>((</span><span class='Control'>struct</span> <a href="../../../include/c.h.html#LN438"><span class='Ref_to_Struct'>varlena</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN181"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN185"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN184"><span class='Ref_To_Local'>tunpacked</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN186"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN186"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN185"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN186"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN184"><span class='Ref_To_Local'>tunpacked</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN185"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN186"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN185"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN184"><span class='Ref_To_Local'>tunpacked</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN181"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN184"><span class='Ref_To_Local'>tunpacked</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN186"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_to_cstring_buffer 
 * 
 * Copy a text value into a caller-supplied buffer of size dst_len. 
 * 
 * The text string is truncated if necessary to fit.  The result is 
 * guaranteed null-terminated (unless dst_len == 0). 
 * 
 * We support being passed a compressed or toasted text value. 
 * This is a bit bogus since such values shouldn't really be referred to as 
 * "text *", but it seems useful for robustness.  If we didn't handle that 
 * case here, we'd need another routine that did, anyway. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN212"></a><span class='Declare_Function'>text_to_cstring_buffer</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>dst</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>dst_len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* must cast away the const, unfortunately */ 
</span><a name="LN215"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>srcunpacked</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN202"><span class='Ref_to_Proto'>pg_detoast_datum_packed</span></a><span class='Parentheses'>((</span><span class='Control'>struct</span> <a href="../../../include/c.h.html#LN438"><span class='Ref_to_Struct'>varlena</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN216"></a>    size_t      <span class='Declare_Local'>src_len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN215"><span class='Ref_To_Local'>srcunpacked</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst_len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst_len</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst_len</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN216"><span class='Ref_To_Local'>src_len</span></a><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN216"><span class='Ref_To_Local'>src_len</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span>    <span class='Comment_Single_Line'>/* ensure truncation is encoding-safe */ 
</span>            <a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst_len</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN530"><span class='Ref_to_Proto'>pg_mbcliplen</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN215"><span class='Ref_To_Local'>srcunpacked</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN216"><span class='Ref_To_Local'>src_len</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN215"><span class='Ref_To_Local'>srcunpacked</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>dst_len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN215"><span class='Ref_To_Local'>srcunpacked</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN212"><span class='Ref_to_Parameter'>src</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN215"><span class='Ref_To_Local'>srcunpacked</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_to_cstring_buffer &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *   USER I/O ROUTINES                                                       * 
 *****************************************************************************/ 
</span> 
 
<a name="LN239"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>VAL</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>CH</span><span class='Parentheses'>)</span>         <span class='Parentheses'>((</span><a href="varlena.c.html#LN239"><span class='Ref_to_Parameter'>CH</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='String'>'0'</span><span class='Parentheses'>)</span> 
<a name="LN240"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>DIG</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>VAL</span><span class='Parentheses'>)</span>        <span class='Parentheses'>((</span><a href="varlena.c.html#LN240"><span class='Ref_to_Parameter'>VAL</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='String'>'0'</span><span class='Parentheses'>)</span> 
 
<span class='Comment_Multi_Line'>/* 
 *      byteain         - converts from printable representation of byte array 
 * 
 *      Non-printable characters must be passed as '\nnn' (octal) and are 
 *      converted to internal form.  '\' must be passed as '\\'. 
 *      ereport(ERROR, ...) if bad form. 
 * 
 *      BUGS: 
 *              The input is scanned twice. 
 *              The error checking of input is minimal. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN254"></a><span class='Declare_Function'>byteain</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN256"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>inputText</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN257"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tp</span><span class='Delimiter'>; 
</span><a name="LN258"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rp</span><span class='Delimiter'>; 
</span><a name="LN259"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bc</span><span class='Delimiter'>; 
</span><a name="LN260"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Recognize hex input */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN256"><span class='Ref_To_Local'>inputText</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\\'</span> <span class='Operator'>&& </span><a href="varlena.c.html#LN256"><span class='Ref_To_Local'>inputText</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'x'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN265"></a>        size_t      <span class='Declare_Local'>len</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="varlena.c.html#LN256"><span class='Ref_To_Local'>inputText</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN265"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>/ </span><span class='Number'>2</span> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* maximum possible length */ 
</span>        <a href="varlena.c.html#LN260"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN33"><span class='Ref_to_Proto'>hex_decode</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN256"><span class='Ref_To_Local'>inputText</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN265"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN260"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN260"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* actual length */ 
</span> 
        <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN260"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Else, it's the traditional escaped style */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN256"><span class='Ref_To_Local'>inputText</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& </span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><span class='String'>'3'</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& </span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><span class='String'>'7'</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& </span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><span class='String'>'7'</span><span class='Parentheses'>))</span> 
            <a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>))</span> 
            <a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * one backslash, not followed by another or ### valid octal 
             */ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"bytea"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for bc=0,tp=inputText;*tp... &raquo; </span> 
 
    <a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>+= </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN260"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN260"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN256"><span class='Ref_To_Local'>inputText</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN258"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN260"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>!= </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="varlena.c.html#LN258"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>++ = *</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& </span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><span class='String'>'3'</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& </span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><span class='String'>'7'</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& </span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>&LT;= </span><span class='String'>'7'</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN239"><span class='Ref_to_Macro'>VAL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN239"><span class='Ref_to_Macro'>VAL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="varlena.c.html#LN258"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>++ = </span><a href="varlena.c.html#LN259"><span class='Ref_To_Local'>bc</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN239"><span class='Ref_to_Macro'>VAL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) </span><span class='Operator'>&& 
</span>                 <span class='Parentheses'>(</span><a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Operator'>*</span><a href="varlena.c.html#LN258"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN257"><span class='Ref_To_Local'>tp</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * We should never get here. The first pass should not allow it. 
             */ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_TEXT_REPRESENTATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid input syntax for type %s"</span><span class='Delimiter'>, </span><span class='String'>"bytea"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while *tp!='\0' &raquo; </span> 
 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN260"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteain &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      byteaout        - converts to printable representation of byte array 
 * 
 *      In the traditional escaped format, non-printable characters are 
 *      printed as '\nnn' (octal) and '\' as '\\'. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN350"></a><span class='Declare_Function'>byteaout</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN352"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>vlena</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN353"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN354"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rp</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN40"><span class='Ref_to_Global_Var'>bytea_output</span></a> <span class='Operator'>== </span><a href="../../../include/utils/bytea.h.html#LN22"><span class='Ref_to_EnumConst'>BYTEA_OUTPUT_HEX</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Print hex format */ 
</span>        <a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN353"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN352"><span class='Ref_To_Local'>vlena</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>++ = </span><span class='String'>'x'</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>+= </span><a href="../../../include/utils/builtins.h.html#LN32"><span class='Ref_to_Proto'>hex_encode</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN352"><span class='Ref_To_Local'>vlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN352"><span class='Ref_To_Local'>vlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN40"><span class='Ref_to_Global_Var'>bytea_output</span></a> <span class='Operator'>== </span><a href="../../../include/utils/bytea.h.html#LN21"><span class='Ref_to_EnumConst'>BYTEA_OUTPUT_ESCAPE</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Print traditional escaped format */ 
</span><a name="LN367"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>vp</span><span class='Delimiter'>; 
</span><a name="LN368"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN369"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN368"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* empty string has 1 char */ 
</span>        <a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN352"><span class='Ref_To_Local'>vlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN369"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN352"><span class='Ref_To_Local'>vlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN369"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN369"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN368"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0x20</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0x7e</span><span class='Parentheses'>)</span> 
                <a href="varlena.c.html#LN368"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="varlena.c.html#LN368"><span class='Ref_To_Local'>len</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN353"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN368"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN352"><span class='Ref_To_Local'>vlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN369"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN352"><span class='Ref_To_Local'>vlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN369"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN369"><span class='Ref_To_Local'>i</span></a><span class='Operator'>--</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>                <span class='Operator'>*</span><a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>++ = </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0x20</span> <span class='Operator'>|| </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0x7e</span><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN393"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* holds unprintable chars */ 
</span> 
                <a href="varlena.c.html#LN393"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= *</span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\\'</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN240"><span class='Ref_to_Macro'>DIG</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN393"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>& </span><span class='Number'>07</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN393"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN240"><span class='Ref_to_Macro'>DIG</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN393"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>& </span><span class='Number'>07</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN393"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>&GT;&GT;= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN240"><span class='Ref_to_Macro'>DIG</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN393"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>& </span><span class='Number'>03</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>+= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <span class='Operator'>*</span><a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a><span class='Operator'>++ = *</span><a href="varlena.c.html#LN367"><span class='Ref_To_Local'>vp</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=VARSIZE_ANY_EXHDR(v... &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if bytea_output==BYTEA_O... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unrecognized bytea_output setting: %d"</span><span class='Delimiter'>, 
</span>             <a href="varlena.c.html#LN40"><span class='Ref_to_Global_Var'>bytea_output</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN353"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>} 
</span>    <span class='Operator'>*</span><a href="varlena.c.html#LN354"><span class='Ref_To_Local'>rp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN353"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteaout &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      bytearecv           - converts external binary format to bytea 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN422"></a><span class='Declare_Function'>bytearecv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN424"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN425"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN426"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN426"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN424"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN424"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN425"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN426"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN425"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN426"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN43"><span class='Ref_to_Proto'>pq_copymsgbytes</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN424"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN425"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN426"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN425"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      byteasend           - converts bytea to binary format 
 * 
 * This is a special case: just copy the input... 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN441"></a><span class='Declare_Function'>byteasend</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN443"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>vlena</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN277"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_P_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN443"><span class='Ref_To_Local'>vlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN449"></a><span class='Declare_Function'>bytea_string_agg_transfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN451"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN451"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Append the value unless null. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN458"></a>        <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>value</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* On the first time through, we ignore the delimiter. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN451"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN451"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN121"><span class='Ref_to_Proto'>makeStringAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN465"></a>            <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>delim</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN451"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN465"><span class='Ref_To_Local'>delim</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN465"><span class='Ref_To_Local'>delim</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN451"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The transition type for string_agg() is declared to be "internal", 
     * which is a pass-by-value type the same size as a pointer. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN451"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bytea_string_agg_transfn &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN481"></a><span class='Declare_Function'>bytea_string_agg_finalfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN483"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN483"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN483"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN492"></a>        <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN492"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN483"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN492"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN483"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN492"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN483"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN483"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN492"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bytea_string_agg_finalfn &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      textin          - converts "..." to internal representation 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN507"></a><span class='Declare_Function'>textin</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN509"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>inputText</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN509"><span class='Ref_To_Local'>inputText</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      textout         - converts internal representation to "..." 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN518"></a><span class='Declare_Function'>textout</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN520"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>txt</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN520"><span class='Ref_To_Local'>txt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      textrecv            - converts external binary format to text 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN529"></a><span class='Declare_Function'>textrecv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN531"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN532"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN533"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN534"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN533"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN44"><span class='Ref_to_Proto'>pq_getmsgtext</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN531"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN531"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN531"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN534"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN532"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN533"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN534"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN533"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN532"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      textsend            - converts text to binary format 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN547"></a><span class='Declare_Function'>textsend</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN549"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN550"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN550"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN22"><span class='Ref_to_Proto'>pq_sendtext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN550"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN549"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN549"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN550"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *      unknownin           - converts "..." to internal representation 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN562"></a><span class='Declare_Function'>unknownin</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN564"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* representation is same as cstring */ 
</span>    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN564"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      unknownout          - converts internal representation to "..." 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN574"></a><span class='Declare_Function'>unknownout</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* representation is same as cstring */ 
</span><a name="LN577"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN577"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      unknownrecv         - converts external binary format to unknown 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN586"></a><span class='Declare_Function'>unknownrecv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN588"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN589"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN590"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN589"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/libpq/pqformat.h.html#LN44"><span class='Ref_to_Proto'>pq_getmsgtext</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN588"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN588"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN588"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN590"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* representation is same as cstring */ 
</span>    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN589"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      unknownsend         - converts unknown to binary format 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN601"></a><span class='Declare_Function'>unknownsend</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* representation is same as cstring */ 
</span><a name="LN604"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN605"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN605"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN22"><span class='Ref_to_Proto'>pq_sendtext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN605"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN604"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="varlena.c.html#LN604"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN605"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* ========== PUBLIC ROUTINES ========== */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * textlen - 
 *    returns the logical length of a text* 
 *     (which is less than the VARSIZE of the text*) 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN621"></a><span class='Declare_Function'>textlen</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN623"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* try to avoid decompressing argument */ 
</span>    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN99"><span class='Ref_to_Proto'>text_length</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN623"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_length - 
 *  Does the real work for textlen() 
 * 
 *  This is broken out so it can be called directly by other string processing 
 *  functions.  Note that the argument is passed as a Datum, to indicate that 
 *  it may still be in compressed form.  We can avoid decompressing it at all 
 *  in some cases. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> 
<a name="LN639"></a><span class='Declare_Function'>text_length</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* fastpath when max encoding length is one */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN535"><span class='Ref_to_Proto'>pg_database_encoding_max_length</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
        <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN639"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN646"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN639"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN529"><span class='Ref_to_Proto'>pg_mbstrlen_with_len</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN646"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN646"><span class='Ref_To_Local'>t</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * textoctetlen - 
 *    returns the physical length of a text* 
 *     (which is less than the VARSIZE of the text*) 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN659"></a><span class='Declare_Function'>textoctetlen</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN661"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We need not detoast the input at all */ 
</span>    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN661"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * textcat - 
 *    takes two text* and returns a text* that is the concatenation of 
 *    the two. 
 * 
 * Rewritten by Sapa, sapa@hq.icb.chel.su. 8-Jul-96. 
 * Updated by Thomas, Thomas.Lockhart@jpl.nasa.gov 1997-07-10. 
 * Allocate space for output in all cases. 
 * XXX - thomas 1997-07-10 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN678"></a><span class='Declare_Function'>textcat</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN680"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN681"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN100"><span class='Ref_to_Proto'>text_catenate</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN680"><span class='Ref_To_Local'>t1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN681"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_catenate 
 *  Guts of textcat(), broken out so it can be used by other functions 
 * 
 * Arguments can be in short-header form, but not compressed or out-of-line 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN693"></a><span class='Declare_Function'>text_catenate</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN695"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN696"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN697"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>, 
</span><a name="LN698"></a>                <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN699"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN696"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN693"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN697"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN693"><span class='Ref_to_Parameter'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* paranoia ... probably should throw error instead? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN696"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN696"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN697"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN697"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN698"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN696"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN697"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN695"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN698"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set size of result string... */ 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN695"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN698"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fill data field of result string... */ 
</span>    <a href="varlena.c.html#LN699"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN695"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN696"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN699"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN693"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN696"><span class='Ref_To_Local'>len1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN697"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN699"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN696"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN693"><span class='Ref_to_Parameter'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN697"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN695"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_catenate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * charlen_to_bytelen() 
 *  Compute the number of bytes occupied by n characters starting at *p 
 * 
 * It is caller's responsibility that there actually are n characters; 
 * the string need not be null-terminated. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN734"></a><span class='Declare_Function'>charlen_to_bytelen</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>p</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>n</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN535"><span class='Ref_to_Proto'>pg_database_encoding_max_length</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Optimization for single-byte encodings */ 
</span>        <span class='Control'>return</span> <a href="varlena.c.html#LN734"><span class='Ref_to_Parameter'>n</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN743"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN743"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN734"><span class='Ref_to_Parameter'>p</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN734"><span class='Ref_to_Parameter'>n</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN734"><span class='Ref_to_Parameter'>n</span></a><span class='Operator'>--</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN743"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>+= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN743"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="varlena.c.html#LN743"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN734"><span class='Ref_to_Parameter'>p</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_substr() 
 * Return a substring starting at the specified position. 
 * - thomas 1997-12-31 
 * 
 * Input: 
 *  - string 
 *  - starting position (is one-based) 
 *  - string length 
 * 
 * If the starting position is zero or less, then return from the start of the string 
 *  adjusting the length to be consistent with the "negative start" per SQL. 
 * If the length is less than zero, return the remaining string. 
 * 
 * Added multibyte support. 
 * - Tatsuo Ishii 1998-4-21 
 * Changed behavior if starting position is less than one to conform to SQL behavior. 
 * Formerly returned the entire string; now returns a portion. 
 * - Thomas Lockhart 1998-12-10 
 * Now uses faster TOAST-slicing interface 
 * - John Gray 2002-02-22 
 * Remove "#ifdef MULTIBYTE" and test for encoding_max_length instead. Change 
 * behaviors conflicting with SQL to meet SQL (if E = S + L &LT; S throw 
 * error; if E &LT; 1, return '', not entire string). Fixed MB related bug when 
 * S &GT; LC and &LT; LC + 4 sometimes garbage characters are returned. 
 * - Joe Conway 2002-08-10 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN780"></a><span class='Declare_Function'>text_substr</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN101"><span class='Ref_to_Proto'>text_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_substr_no_len - 
 *    Wrapper to avoid opr_sanity failure due to 
 *    one function accepting a different number of args. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN794"></a><span class='Declare_Function'>text_substr_no_len</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN101"><span class='Ref_to_Proto'>text_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                    <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_substring - 
 *  Does the real work for text_substr() and text_substr_no_len() 
 * 
 *  This is broken out so it can be called directly by other string processing 
 *  functions.  Note that the argument is passed as a Datum, to indicate that 
 *  it may still be in compressed/toasted form.  We can avoid detoasting all 
 *  of it in some cases. 
 * 
 *  The result is always a freshly palloc'd datum. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN813"></a><span class='Declare_Function'>text_substring</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>start</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>length</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>length_not_specified</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN815"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>eml</span> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN535"><span class='Ref_to_Proto'>pg_database_encoding_max_length</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><a name="LN816"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>S</span> <span class='Operator'>= </span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>start</span></a><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* start position */ 
</span><a name="LN817"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>S1</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* adjusted start position */ 
</span><a name="LN818"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>L1</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* adjusted substring length */ 
</span> 
    <span class='Comment_Multi_Line'>/* life is easy if the encoding max length is 1 */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN815"><span class='Ref_To_Local'>eml</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN816"><span class='Ref_To_Local'>S</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>length_not_specified</span></a><span class='Parentheses'>)</span>       <span class='Comment_Multi_Line'>/* special case - get length to end of 
                                         * string */ 
</span>            <a href="varlena.c.html#LN818"><span class='Ref_To_Local'>L1</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* end position */ 
</span><a name="LN831"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>E</span> <span class='Operator'>= </span><a href="varlena.c.html#LN816"><span class='Ref_To_Local'>S</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>length</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * A negative value for L is the only way for the end position to 
             * be before the start. SQL99 says to throw an error. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN831"><span class='Ref_To_Local'>E</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN816"><span class='Ref_To_Local'>S</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SUBSTRING_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"negative substring length not allowed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * A zero or negative value for the end position can happen if the 
             * start was negative or one. SQL99 says to return a zero-length 
             * string. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN831"><span class='Ref_To_Local'>E</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN818"><span class='Ref_To_Local'>L1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN831"><span class='Ref_To_Local'>E</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * If the start position is past the end of the string, SQL99 says to 
         * return a zero-length string -- PG_GETARG_TEXT_P_SLICE() will do 
         * that for us. Convert to zero-based starting position 
         */ 
</span>        <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN267"><span class='Ref_to_Macro'>DatumGetTextPSlice</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN818"><span class='Ref_To_Local'>L1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if eml==1 &raquo; </span> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN815"><span class='Ref_To_Local'>eml</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * When encoding max length is &GT; 1, we can't get LC without 
         * detoasting, so we'll grab a conservatively large slice now and go 
         * back later to do the right thing 
         */ 
</span><a name="LN867"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>slice_start</span><span class='Delimiter'>; 
</span><a name="LN868"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>slice_size</span><span class='Delimiter'>; 
</span><a name="LN869"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>slice_strlen</span><span class='Delimiter'>; 
</span><a name="LN870"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>slice</span><span class='Delimiter'>; 
</span><a name="LN871"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>E1</span><span class='Delimiter'>; 
</span><a name="LN872"></a>        <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN873"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN874"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span><span class='Delimiter'>; 
</span><a name="LN875"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * if S is past the end of the string, the tuple toaster will return a 
         * zero-length string to us 
         */ 
</span>        <a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN816"><span class='Ref_To_Local'>S</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need to start at position zero because there is no way to know 
         * in advance which byte offset corresponds to the supplied start 
         * position. 
         */ 
</span>        <a href="varlena.c.html#LN867"><span class='Ref_To_Local'>slice_start</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>length_not_specified</span></a><span class='Parentheses'>)</span>       <span class='Comment_Multi_Line'>/* special case - get length to end of 
                                         * string */ 
</span>            <a href="varlena.c.html#LN868"><span class='Ref_To_Local'>slice_size</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN818"><span class='Ref_To_Local'>L1</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN895"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>E</span> <span class='Operator'>= </span><a href="varlena.c.html#LN816"><span class='Ref_To_Local'>S</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>length</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * A negative value for L is the only way for the end position to 
             * be before the start. SQL99 says to throw an error. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN895"><span class='Ref_To_Local'>E</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN816"><span class='Ref_To_Local'>S</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SUBSTRING_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"negative substring length not allowed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * A zero or negative value for the end position can happen if the 
             * start was negative or one. SQL99 says to return a zero-length 
             * string. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN895"><span class='Ref_To_Local'>E</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * if E is past the end of the string, the tuple toaster will 
             * truncate the length for us 
             */ 
</span>            <a href="varlena.c.html#LN818"><span class='Ref_To_Local'>L1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN895"><span class='Ref_To_Local'>E</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Total slice size in bytes can't be any longer than the start 
             * position plus substring length times the encoding max length. 
             */ 
</span>            <a href="varlena.c.html#LN868"><span class='Ref_To_Local'>slice_size</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN818"><span class='Ref_To_Local'>L1</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><a href="varlena.c.html#LN815"><span class='Ref_To_Local'>eml</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * If we're working with an untoasted source, no need to do an extra 
         * copying step. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN312"><span class='Ref_to_Macro'>VARATT_IS_COMPRESSED</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span> <span class='Operator'>|| 
</span>            <a href="../../../include/postgres.h.html#LN313"><span class='Ref_to_Macro'>VARATT_IS_EXTERNAL</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)))</span> 
            <a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN267"><span class='Ref_to_Macro'>DatumGetTextPSlice</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN867"><span class='Ref_To_Local'>slice_start</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN868"><span class='Ref_To_Local'>slice_size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* see if we got back an empty string */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Now we can get the actual length of the slice in MB characters */ 
</span>        <a href="varlena.c.html#LN869"><span class='Ref_To_Local'>slice_strlen</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN529"><span class='Ref_to_Proto'>pg_mbstrlen_with_len</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Check that the start position wasn't &GT; slice_strlen. If so, SQL99 
         * says to return a zero-length string. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a> <span class='Operator'>&GT; </span><a href="varlena.c.html#LN869"><span class='Ref_To_Local'>slice_strlen</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span> 
                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Adjust L1 and E1 now that we know the slice string length. Again 
         * remember that S1 is one based, and slice_start is zero based. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN818"><span class='Ref_To_Local'>L1</span></a> <span class='Operator'>&GT; -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN871"><span class='Ref_To_Local'>E1</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN818"><span class='Ref_To_Local'>L1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN867"><span class='Ref_To_Local'>slice_start</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="varlena.c.html#LN869"><span class='Ref_To_Local'>slice_strlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="varlena.c.html#LN871"><span class='Ref_To_Local'>E1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN867"><span class='Ref_To_Local'>slice_start</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="varlena.c.html#LN869"><span class='Ref_To_Local'>slice_strlen</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Find the start position in the slice; remember S1 is not zero based 
         */ 
</span>        <a href="varlena.c.html#LN873"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN872"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN872"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN872"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN873"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN873"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* hang onto a pointer to our start position */ 
</span>        <a href="varlena.c.html#LN874"><span class='Ref_To_Local'>s</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN873"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Count the actual bytes used by the substring of the requested 
         * length. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN872"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN817"><span class='Ref_To_Local'>S1</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN872"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN871"><span class='Ref_To_Local'>E1</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN872"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN873"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN873"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN875"><span class='Ref_To_Local'>ret</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN873"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN874"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN875"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a> <span class='Operator'>+ </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN873"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN874"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN875"><span class='Ref_To_Local'>ret</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN874"><span class='Ref_To_Local'>s</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN873"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN874"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN554"><span class='Ref_to_Macro'>DatumGetPointer</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN813"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>))</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN870"><span class='Ref_To_Local'>slice</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="varlena.c.html#LN875"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if eml&GT;1 &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"invalid backend encoding: encoding max length &LT; 1"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* not reached: suppress compiler warning */ 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_substring &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * textoverlay 
 *  Replace specified substring of first string with second 
 * 
 * The SQL standard defines OVERLAY() in terms of substring and concatenation. 
 * This code is a direct implementation of what the standard says. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1010"></a><span class='Declare_Function'>textoverlay</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1012"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1013"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1014"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sp</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* substring start position */ 
</span><a name="LN1015"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sl</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* substring length */ 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN105"><span class='Ref_to_Proto'>text_overlay</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1012"><span class='Ref_To_Local'>t1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1013"><span class='Ref_To_Local'>t2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1014"><span class='Ref_To_Local'>sp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1015"><span class='Ref_To_Local'>sl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1021"></a><span class='Declare_Function'>textoverlay_no_len</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1023"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1024"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1025"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sp</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* substring start position */ 
</span><a name="LN1026"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sl</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1026"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN99"><span class='Ref_to_Proto'>text_length</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1024"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* defaults to length(t2) */ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN105"><span class='Ref_to_Proto'>text_overlay</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1023"><span class='Ref_To_Local'>t1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1024"><span class='Ref_To_Local'>t2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1025"><span class='Ref_To_Local'>sp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1026"><span class='Ref_To_Local'>sl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN1033"></a><span class='Declare_Function'>text_overlay</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1035"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1036"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s1</span><span class='Delimiter'>; 
</span><a name="LN1037"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s2</span><span class='Delimiter'>; 
</span><a name="LN1038"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sp_pl_sl</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for possible integer-overflow cases.  For negative sp, throw a 
     * "substring length" error because that's what should be expected 
     * according to the spec's definition of OVERLAY(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1033"><span class='Ref_to_Parameter'>sp</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SUBSTRING_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"negative substring length not allowed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1038"><span class='Ref_To_Local'>sp_pl_sl</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1033"><span class='Ref_to_Parameter'>sp</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN1033"><span class='Ref_to_Parameter'>sl</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1038"><span class='Ref_To_Local'>sp_pl_sl</span></a> <span class='Operator'>&LT;= </span><a href="varlena.c.html#LN1033"><span class='Ref_to_Parameter'>sl</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"integer out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1036"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN101"><span class='Ref_to_Proto'>text_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1033"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1033"><span class='Ref_to_Parameter'>sp</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1037"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN101"><span class='Ref_to_Proto'>text_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1033"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1038"><span class='Ref_To_Local'>sp_pl_sl</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1035"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN100"><span class='Ref_to_Proto'>text_catenate</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1036"><span class='Ref_To_Local'>s1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1033"><span class='Ref_to_Parameter'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1035"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN100"><span class='Ref_to_Proto'>text_catenate</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1035"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1037"><span class='Ref_To_Local'>s2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN1035"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_overlay &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * textpos - 
 *    Return the position of the specified substring. 
 *    Implements the SQL POSITION() function. 
 *    Ref: A Guide To The SQL Standard, Date & Darwen, 1997 
 * - thomas 1997-07-27 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1071"></a><span class='Declare_Function'>textpos</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1073"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1074"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>search_str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a><span class='Parentheses'>) </span><a href="varlena.c.html#LN106"><span class='Ref_to_Proto'>text_position</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1073"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1074"><span class='Ref_To_Local'>search_str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_position - 
 *  Does the real work for textpos() 
 * 
 * Inputs: 
 *      t1 - string to be searched 
 *      t2 - pattern to match within t1 
 * Result: 
 *      Character index of the first matched char, starting from 1, 
 *      or 0 if no match. 
 * 
 *  This is broken out so it can be called directly by other string processing 
 *  functions. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1094"></a><span class='Declare_Function'>text_position</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1096"></a>    <a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN1097"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN107"><span class='Ref_to_Proto'>text_position_setup</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1094"><span class='Ref_to_Parameter'>t1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1094"><span class='Ref_to_Parameter'>t2</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN1096"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1097"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN108"><span class='Ref_to_Proto'>text_position_next</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN1096"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN1096"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="varlena.c.html#LN1097"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * text_position_setup, text_position_next, text_position_cleanup - 
 *  Component steps of text_position() 
 * 
 * These are broken out so that a string can be efficiently searched for 
 * multiple occurrences of the same pattern.  text_position_next may be 
 * called multiple times with increasing values of start_pos, which is 
 * the 1-based character position to start the search from.  The "state" 
 * variable is normally just a local variable in the caller. 
 */ 
</span> 
<span class='Keyword'>static void 
</span><a name="LN1118"></a><span class='Declare_Function'>text_position_setup</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1120"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1121"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len2</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN535"><span class='Ref_to_Proto'>pg_database_encoding_max_length</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* simple case - single byte encoding */ 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN47"><span class='Ref_to_Member'>use_wchar</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN48"><span class='Ref_to_Member'>str1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN49"><span class='Ref_to_Member'>str2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN52"><span class='Ref_to_Member'>len1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1120"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN53"><span class='Ref_to_Member'>len2</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* not as simple - multibyte encoding */ 
</span><a name="LN1135"></a>        <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>p1</span><span class='Delimiter'>, 
</span><a name="LN1136"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>p2</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN1135"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="varlena.c.html#LN1120"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1120"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN510"><span class='Ref_to_Proto'>pg_mb2wchar_with_len</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1135"><span class='Ref_To_Local'>p1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1120"><span class='Ref_To_Local'>len1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1136"><span class='Ref_To_Local'>p2</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN510"><span class='Ref_to_Proto'>pg_mb2wchar_with_len</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1136"><span class='Ref_To_Local'>p2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN47"><span class='Ref_to_Member'>use_wchar</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN50"><span class='Ref_to_Member'>wstr1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1135"><span class='Ref_To_Local'>p1</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN51"><span class='Ref_to_Member'>wstr2</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1136"><span class='Ref_To_Local'>p2</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN52"><span class='Ref_to_Member'>len1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1120"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN53"><span class='Ref_to_Member'>len2</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Prepare the skip table for Boyer-Moore-Horspool searching.  In these 
     * notes we use the terminology that the "haystack" is the string to be 
     * searched (t1) and the "needle" is the pattern being sought (t2). 
     * 
     * If the needle is empty or bigger than the haystack then there is no 
     * point in wasting cycles initializing the table.  We also choose not to 
     * use B-M-H for needles of length 1, since the skip table can't possibly 
     * save anything in that case. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1120"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>&& </span><a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1162"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>searchlength</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1120"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a><span class='Delimiter'>; 
</span><a name="LN1163"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>skiptablemask</span><span class='Delimiter'>; 
</span><a name="LN1164"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>last</span><span class='Delimiter'>; 
</span><a name="LN1165"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * First we must determine how much of the skip table to use.  The 
         * declaration of TextPositionState allows up to 256 elements, but for 
         * short search problems we don't really want to have to initialize so 
         * many elements --- it would take too long in comparison to the 
         * actual search time.  So we choose a useful skip table size based on 
         * the haystack length minus the needle length.  The closer the needle 
         * length is to the haystack length the less useful skipping becomes. 
         * 
         * Note: since we use bit-masking to select table elements, the skip 
         * table size MUST be a power of 2, and so the mask must be 2^N-1. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1162"><span class='Ref_To_Local'>searchlength</span></a> <span class='Operator'>&LT; </span><span class='Number'>16</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a> <span class='Operator'>= </span><span class='Number'>3</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1162"><span class='Ref_To_Local'>searchlength</span></a> <span class='Operator'>&LT; </span><span class='Number'>64</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a> <span class='Operator'>= </span><span class='Number'>7</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1162"><span class='Ref_To_Local'>searchlength</span></a> <span class='Operator'>&LT; </span><span class='Number'>128</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a> <span class='Operator'>= </span><span class='Number'>15</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1162"><span class='Ref_To_Local'>searchlength</span></a> <span class='Operator'>&LT; </span><span class='Number'>512</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a> <span class='Operator'>= </span><span class='Number'>31</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1162"><span class='Ref_To_Local'>searchlength</span></a> <span class='Operator'>&LT; </span><span class='Number'>2048</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a> <span class='Operator'>= </span><span class='Number'>63</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1162"><span class='Ref_To_Local'>searchlength</span></a> <span class='Operator'>&LT; </span><span class='Number'>4096</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a> <span class='Operator'>= </span><span class='Number'>127</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a> <span class='Operator'>= </span><span class='Number'>255</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN55"><span class='Ref_to_Member'>skiptablemask</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Initialize the skip table.  We set all elements to the needle 
         * length, since this is the correct skip distance for any character 
         * not found in the needle. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN56"><span class='Ref_to_Member'>skiptable</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now examine the needle.  For each character except the last one, 
         * set the corresponding table element to the appropriate skip 
         * distance.  Note that when two characters share the same skip table 
         * entry, the one later in the needle must determine the skip 
         * distance. 
         */ 
</span>        <a href="varlena.c.html#LN1164"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1121"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN47"><span class='Ref_to_Member'>use_wchar</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1214"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>str2</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN49"><span class='Ref_to_Member'>str2</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1164"><span class='Ref_To_Local'>last</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN56"><span class='Ref_to_Member'>skiptable</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN1214"><span class='Ref_To_Local'>str2</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>& </span><a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN1164"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1221"></a>            <span class='Keyword'>const </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>wstr2</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN51"><span class='Ref_to_Member'>wstr2</span></a><span class='Delimiter'>; 
</span> 
            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1164"><span class='Ref_To_Local'>last</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN1118"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN56"><span class='Ref_to_Member'>skiptable</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1221"><span class='Ref_To_Local'>wstr2</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>& </span><a href="varlena.c.html#LN1163"><span class='Ref_To_Local'>skiptablemask</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN1164"><span class='Ref_To_Local'>last</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN1165"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if len1&GT;=len2&&len2&GT;1 &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end text_position_setup &raquo; </span> 
 
<span class='Keyword'>static int 
</span><a name="LN1230"></a><span class='Declare_Function'>text_position_next</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>start_pos</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1232"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>haystack_len</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN52"><span class='Ref_to_Member'>len1</span></a><span class='Delimiter'>; 
</span><a name="LN1233"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>needle_len</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN53"><span class='Ref_to_Member'>len2</span></a><span class='Delimiter'>; 
</span><a name="LN1234"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>skiptablemask</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN55"><span class='Ref_to_Member'>skiptablemask</span></a><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>start_pos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* else caller error */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1233"><span class='Ref_To_Local'>needle_len</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>start_pos</span></a><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* result for empty pattern */ 
</span> 
    <a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>start_pos</span></a><span class='Operator'>--</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* adjust for zero based arrays */ 
</span> 
    <span class='Comment_Multi_Line'>/* Done if the needle can't possibly fit */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1232"><span class='Ref_To_Local'>haystack_len</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>start_pos</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN1233"><span class='Ref_To_Local'>needle_len</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN47"><span class='Ref_to_Member'>use_wchar</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* simple case - single byte encoding */ 
</span><a name="LN1250"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>haystack</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN48"><span class='Ref_to_Member'>str1</span></a><span class='Delimiter'>; 
</span><a name="LN1251"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>needle</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN49"><span class='Ref_to_Member'>str2</span></a><span class='Delimiter'>; 
</span><a name="LN1252"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>haystack_end</span> <span class='Operator'>= &</span><a href="varlena.c.html#LN1250"><span class='Ref_To_Local'>haystack</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1232"><span class='Ref_To_Local'>haystack_len</span></a><span class='Delimiter'>]; 
</span><a name="LN1253"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>hptr</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1233"><span class='Ref_To_Local'>needle_len</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No point in using B-M-H for a one-character needle */ 
</span><a name="LN1258"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>nchar</span> <span class='Operator'>= *</span><a href="varlena.c.html#LN1251"><span class='Ref_To_Local'>needle</span></a><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>= &</span><a href="varlena.c.html#LN1250"><span class='Ref_To_Local'>haystack</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>start_pos</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1252"><span class='Ref_To_Local'>haystack_end</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN1258"><span class='Ref_To_Local'>nchar</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN1250"><span class='Ref_To_Local'>haystack</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1270"></a>            <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>needle_last</span> <span class='Operator'>= &</span><a href="varlena.c.html#LN1251"><span class='Ref_To_Local'>needle</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1233"><span class='Ref_To_Local'>needle_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
            <span class='Comment_Multi_Line'>/* Start at startpos plus the length of the needle */ 
</span>            <a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>= &</span><a href="varlena.c.html#LN1250"><span class='Ref_To_Local'>haystack</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>start_pos</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN1233"><span class='Ref_To_Local'>needle_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1252"><span class='Ref_To_Local'>haystack_end</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Match the needle scanning *backward* */ 
</span><a name="LN1277"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>nptr</span><span class='Delimiter'>; 
</span><a name="LN1278"></a>                <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
                <a href="varlena.c.html#LN1277"><span class='Ref_To_Local'>nptr</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1270"><span class='Ref_To_Local'>needle_last</span></a><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN1278"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN1277"><span class='Ref_To_Local'>nptr</span></a> <span class='Operator'>== *</span><a href="varlena.c.html#LN1278"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Matched it all?  If so, return 1-based position */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1277"><span class='Ref_To_Local'>nptr</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN1251"><span class='Ref_To_Local'>needle</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="varlena.c.html#LN1278"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN1250"><span class='Ref_To_Local'>haystack</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="varlena.c.html#LN1277"><span class='Ref_To_Local'>nptr</span></a><span class='Operator'>--</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1278"><span class='Ref_To_Local'>p</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * No match, so use the haystack char at hptr to decide how 
                 * far to advance.  If the needle had any occurrence of that 
                 * character (or more precisely, one sharing the same 
                 * skiptable entry) before its last character, then we advance 
                 * far enough to align the last such needle character with 
                 * that haystack position.  Otherwise we can advance by the 
                 * whole needle length. 
                 */ 
</span>                <a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN56"><span class='Ref_to_Member'>skiptable</span></a><span class='Delimiter'>[</span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><a href="varlena.c.html#LN1253"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>& </span><a href="varlena.c.html#LN1234"><span class='Ref_To_Local'>skiptablemask</span></a><span class='Delimiter'>]; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while hptr&LT;haystack_end &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !state-&GT;use_wchar &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* The multibyte char version. This works exactly the same way. */ 
</span><a name="LN1306"></a>        <span class='Keyword'>const </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>haystack</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN50"><span class='Ref_to_Member'>wstr1</span></a><span class='Delimiter'>; 
</span><a name="LN1307"></a>        <span class='Keyword'>const </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>needle</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN51"><span class='Ref_to_Member'>wstr2</span></a><span class='Delimiter'>; 
</span><a name="LN1308"></a>        <span class='Keyword'>const </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>haystack_end</span> <span class='Operator'>= &</span><a href="varlena.c.html#LN1306"><span class='Ref_To_Local'>haystack</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1232"><span class='Ref_To_Local'>haystack_len</span></a><span class='Delimiter'>]; 
</span><a name="LN1309"></a>        <span class='Keyword'>const </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>hptr</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1233"><span class='Ref_To_Local'>needle_len</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* No point in using B-M-H for a one-character needle */ 
</span><a name="LN1314"></a>            <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>    <span class='Declare_Local'>nchar</span> <span class='Operator'>= *</span><a href="varlena.c.html#LN1307"><span class='Ref_To_Local'>needle</span></a><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>= &</span><a href="varlena.c.html#LN1306"><span class='Ref_To_Local'>haystack</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>start_pos</span></a><span class='Delimiter'>]; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1308"><span class='Ref_To_Local'>haystack_end</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN1314"><span class='Ref_To_Local'>nchar</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN1306"><span class='Ref_To_Local'>haystack</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1326"></a>            <span class='Keyword'>const </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>needle_last</span> <span class='Operator'>= &</span><a href="varlena.c.html#LN1307"><span class='Ref_To_Local'>needle</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1233"><span class='Ref_To_Local'>needle_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
            <span class='Comment_Multi_Line'>/* Start at startpos plus the length of the needle */ 
</span>            <a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>= &</span><a href="varlena.c.html#LN1306"><span class='Ref_To_Local'>haystack</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>start_pos</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN1233"><span class='Ref_To_Local'>needle_len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1308"><span class='Ref_To_Local'>haystack_end</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* Match the needle scanning *backward* */ 
</span><a name="LN1333"></a>                <span class='Keyword'>const </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>nptr</span><span class='Delimiter'>; 
</span><a name="LN1334"></a>                <span class='Keyword'>const </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
                <a href="varlena.c.html#LN1333"><span class='Ref_To_Local'>nptr</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1326"><span class='Ref_To_Local'>needle_last</span></a><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN1334"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a><span class='Delimiter'>; 
</span>                <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN1333"><span class='Ref_To_Local'>nptr</span></a> <span class='Operator'>== *</span><a href="varlena.c.html#LN1334"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* Matched it all?  If so, return 1-based position */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1333"><span class='Ref_To_Local'>nptr</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN1307"><span class='Ref_To_Local'>needle</span></a><span class='Parentheses'>) 
</span>                        <span class='Control'>return</span> <a href="varlena.c.html#LN1334"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN1306"><span class='Ref_To_Local'>haystack</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                    <a href="varlena.c.html#LN1333"><span class='Ref_To_Local'>nptr</span></a><span class='Operator'>--</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1334"><span class='Ref_To_Local'>p</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * No match, so use the haystack char at hptr to decide how 
                 * far to advance.  If the needle had any occurrence of that 
                 * character (or more precisely, one sharing the same 
                 * skiptable entry) before its last character, then we advance 
                 * far enough to align the last such needle character with 
                 * that haystack position.  Otherwise we can advance by the 
                 * whole needle length. 
                 */ 
</span>                <a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN1230"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN56"><span class='Ref_to_Member'>skiptable</span></a><span class='Delimiter'>[</span><span class='Operator'>*</span><a href="varlena.c.html#LN1309"><span class='Ref_To_Local'>hptr</span></a> <span class='Operator'>& </span><a href="varlena.c.html#LN1234"><span class='Ref_To_Local'>skiptablemask</span></a><span class='Delimiter'>]; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while hptr&LT;haystack_end &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>                   <span class='Comment_Single_Line'>/* not found */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end text_position_next &raquo; </span> 
 
<span class='Keyword'>static void 
</span><a name="LN1364"></a><span class='Declare_Function'>text_position_cleanup</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1364"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN47"><span class='Ref_to_Member'>use_wchar</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1364"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN50"><span class='Ref_to_Member'>wstr1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1364"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN51"><span class='Ref_to_Member'>wstr2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
} 
</span> 
<span class='Comment_Multi_Line'>/* varstr_cmp() 
 * Comparison function for text strings with given lengths. 
 * Includes locale support, but must copy strings to temporary memory 
 *  to allow null-termination for inputs to strcoll(). 
 * Returns an integer less than, equal to, or greater than zero, indicating 
 * whether arg1 is less than, equal to, or greater than arg2. 
 */ 
</span><span class='Keyword'>int 
</span><a name="LN1381"></a><span class='Declare_Function'>varstr_cmp</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len1</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>arg2</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len2</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1383"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Unfortunately, there is no strncoll(), so in the non-C locale case we 
     * have to do some memory copying.  This turns out to be significantly 
     * slower, so we optimize the case where LC_COLLATE is C.  We also try to 
     * optimize relatively-short strings by avoiding palloc/pfree overhead. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/pg_locale.h.html#LN50"><span class='Ref_to_Proto'>lc_collate_is_c</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>collid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Parentheses'>))</span> 
            <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1399"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>a1buf</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Delimiter'>]; 
</span><a name="LN1400"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>a2buf</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Delimiter'>]; 
</span><a name="LN1401"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>a1p</span><span class='Delimiter'>, 
</span><a name="LN1402"></a>                   <span class='Operator'>*</span><span class='Declare_Local'>a2p</span><span class='Delimiter'>; 
</span><a name="LN1403"></a>        <a href="../../../include/utils/pg_locale.h.html#LN87"><span class='Ref_to_Typedef'>pg_locale_t</span></a> <span class='Declare_Local'>mylocale</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>collid</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>collid</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * This typically means that the parser could not resolve a 
                 * conflict of implicit collations, so report it that way. 
                 */ 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INDETERMINATE_COLLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine which collation to use for string comparison"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use the COLLATE clause to set the collation explicitly."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a> <span class='Operator'>= </span><a href="../../../include/utils/pg_locale.h.html#LN89"><span class='Ref_to_Proto'>pg_newlocale_from_collation</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>collid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * memcmp() can't tell us which of two unequal strings sorts first, 
         * but it's a cheap way to tell if they're equal.  Testing shows that 
         * memcmp() followed by strcoll() is only trivially slower than 
         * strcoll() by itself, so we don't lose much if this doesn't work out 
         * very often, and if it does - for example, because there are many 
         * equal strings in the input - then we win big by avoiding expensive 
         * collation-aware comparisons. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a> <span class='Operator'>&& </span>memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
        <span class='Comment_Multi_Line'>/* Win32 does not have UTF-8, so we need to map to UTF-16 */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1437"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>a1len</span><span class='Delimiter'>; 
</span><a name="LN1438"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>a2len</span><span class='Delimiter'>; 
</span><a name="LN1439"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>r</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN1437"><span class='Ref_To_Local'>a1len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1437"><span class='Ref_To_Local'>a1len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN1437"><span class='Ref_To_Local'>a1len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1399"><span class='Ref_To_Local'>a1buf</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN1438"><span class='Ref_To_Local'>a2len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1438"><span class='Ref_To_Local'>a2len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN1438"><span class='Ref_To_Local'>a2len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1400"><span class='Ref_To_Local'>a2buf</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* stupid Microsloth API does not work for zero-length input */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN1439"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN1439"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>MultiByteToWideChar<span class='Parentheses'>(</span>CP_UTF8<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>(</span>LPWSTR<span class='Parentheses'>) </span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1437"><span class='Ref_To_Local'>a1len</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN1439"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert string to UTF-16: error code %lu"</span><span class='Delimiter'>, 
</span>                                    GetLastError<span class='Parentheses'>())))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Parentheses'>((</span>LPWSTR<span class='Parentheses'>) </span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN1439"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN1439"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN1439"><span class='Ref_To_Local'>r</span></a> <span class='Operator'>= </span>MultiByteToWideChar<span class='Parentheses'>(</span>CP_UTF8<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>(</span>LPWSTR<span class='Parentheses'>) </span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1438"><span class='Ref_To_Local'>a2len</span></a> <span class='Operator'>/ </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN1439"><span class='Ref_To_Local'>r</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not convert string to UTF-16: error code %lu"</span><span class='Delimiter'>, 
</span>                                    GetLastError<span class='Parentheses'>())))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Parentheses'>((</span>LPWSTR<span class='Parentheses'>) </span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN1439"><span class='Ref_To_Local'>r</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            errno <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> HAVE_LOCALE_T 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/port/win32.h.html#LN347"><span class='Ref_to_Const'>wcscoll_l</span></a><span class='Parentheses'>((</span>LPWSTR<span class='Parentheses'>) </span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>LPWSTR<span class='Parentheses'>) </span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>lt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
                <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>wcscoll<span class='Parentheses'>((</span>LPWSTR<span class='Parentheses'>) </span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>LPWSTR<span class='Parentheses'>) </span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>2147483647</span><span class='Parentheses'>)</span>   <span class='Comment_Multi_Line'>/* _NLSCMPERROR; missing from mingw 
                                         * headers */ 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not compare Unicode strings: %m"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * In some locales wcscoll() can claim that nonidentical strings 
             * are equal.  Believing that would be bad news for a number of 
             * reasons, so we follow Perl's lead and sort "equal" strings 
             * according to strcmp (on the UTF-8 representation). 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Parentheses'>))</span> 
                    <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1399"><span class='Ref_To_Local'>a1buf</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1400"><span class='Ref_To_Local'>a2buf</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>return</span> <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if GetDatabaseEncoding()... &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* WIN32 */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1399"><span class='Ref_To_Local'>a1buf</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1400"><span class='Ref_To_Local'>a2buf</span></a><span class='Delimiter'>; 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_ICU 
<span class='Directive'>#ifdef</span> HAVE_UCOL_STRCOLLUTF8 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN1545"></a>                    UErrorCode  <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span> 
                    <a href="varlena.c.html#LN1545"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span>U_ZERO_ERROR<span class='Delimiter'>; 
</span>                    <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>ucol_strcollUTF8<span class='Parentheses'>(</span><a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>icu<span class='Operator'>.</span>ucol<span class='Delimiter'>, 
</span>                                              <a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a><span class='Delimiter'>, 
</span>                                              <a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Delimiter'>, 
</span>                                              <span class='Operator'>&</span><a href="varlena.c.html#LN1545"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>U_FAILURE<span class='Parentheses'>(</span><a href="varlena.c.html#LN1545"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collation failed: %s"</span><span class='Delimiter'>, </span>u_errorName<span class='Parentheses'>(</span><a href="varlena.c.html#LN1545"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
                <span class='Delimiter'>{ 
</span><a name="LN1559"></a>                    <a href="../../../port/crypt.c.html#LN107"><span class='Ref_to_Typedef'>int32_t</span></a>     <span class='Declare_Local'>ulen1</span><span class='Delimiter'>, 
</span><a name="LN1560"></a>                                <span class='Declare_Local'>ulen2</span><span class='Delimiter'>; 
</span><a name="LN1561"></a>                    UChar      <span class='Operator'>*</span><span class='Declare_Local'>uchar1</span><span class='Delimiter'>, 
</span><a name="LN1562"></a>                               <span class='Operator'>*</span><span class='Declare_Local'>uchar2</span><span class='Delimiter'>; 
</span> 
                    <a href="varlena.c.html#LN1559"><span class='Ref_To_Local'>ulen1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/pg_locale.h.html#LN94"><span class='Ref_to_Proto'>icu_to_uchar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN1561"><span class='Ref_To_Local'>uchar1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="varlena.c.html#LN1560"><span class='Ref_To_Local'>ulen2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/pg_locale.h.html#LN94"><span class='Ref_to_Proto'>icu_to_uchar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN1562"><span class='Ref_To_Local'>uchar2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>arg2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1381"><span class='Ref_to_Parameter'>len2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>ucol_strcoll<span class='Parentheses'>(</span><a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>icu<span class='Operator'>.</span>ucol<span class='Delimiter'>, 
</span>                                          <a href="varlena.c.html#LN1561"><span class='Ref_To_Local'>uchar1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1559"><span class='Ref_To_Local'>ulen1</span></a><span class='Delimiter'>, 
</span>                                          <a href="varlena.c.html#LN1562"><span class='Ref_To_Local'>uchar2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1560"><span class='Ref_To_Local'>ulen2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* not USE_ICU */ 
</span>                <span class='Comment_Multi_Line'>/* shouldn't happen */ 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported collprovider: %c"</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_ICU */ 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if mylocale-&GT;provider==C... &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_LOCALE_T 
                <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/port/win32.h.html#LN345"><span class='Ref_to_Const'>strcoll_l</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>lt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
                <span class='Comment_Multi_Line'>/* shouldn't happen */ 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported collprovider: %c"</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN1403"><span class='Ref_To_Local'>mylocale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if mylocale &raquo; </span> 
        <span class='Control'>else</span> 
            <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>strcoll<span class='Parentheses'>(</span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * In some locales strcoll() can claim that nonidentical strings are 
         * equal.  Believing that would be bad news for a number of reasons, 
         * so we follow Perl's lead and sort "equal" strings according to 
         * strcmp(). 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>strcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1399"><span class='Ref_To_Local'>a1buf</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1401"><span class='Ref_To_Local'>a1p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1400"><span class='Ref_To_Local'>a2buf</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1402"><span class='Ref_To_Local'>a2p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="varlena.c.html#LN1383"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end varstr_cmp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* text_cmp() 
 * Internal comparison function for text strings. 
 * Returns -1, 0 or 1 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1612"></a><span class='Declare_Function'>text_cmp</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg2</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1614"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>a1p</span><span class='Delimiter'>, 
</span><a name="LN1615"></a>               <span class='Operator'>*</span><span class='Declare_Local'>a2p</span><span class='Delimiter'>; 
</span><a name="LN1616"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN1617"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1614"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1612"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1615"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1612"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1616"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1612"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1617"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1612"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="../../../include/utils/varlena.h.html#LN18"><span class='Ref_to_Proto'>varstr_cmp</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1614"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1616"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1615"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1617"><span class='Ref_To_Local'>len2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1612"><span class='Ref_to_Parameter'>collid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Comparison functions for text strings. 
 * 
 * Note: btree indexes need these routines not to leak memory; therefore, 
 * be careful to free working copies of toasted datums.  Most places don't 
 * need to be so careful. 
 */ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1637"></a><span class='Declare_Function'>texteq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1639"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1640"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1641"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1642"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN1643"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Since we only care about equality or not-equality, we can avoid all the 
     * expense of strcoll() here, and just do bitwise comparison.  In fact, we 
     * don't even have to do a bitwise comparison if we can show the lengths 
     * of the strings are unequal; which might save us from having to detoast 
     * one or both values. 
     */ 
</span>    <a href="varlena.c.html#LN1642"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1639"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1643"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1640"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1642"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1643"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN1641"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1658"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>targ1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1639"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1659"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>targ2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1640"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN1641"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1658"><span class='Ref_To_Local'>targ1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1659"><span class='Ref_To_Local'>targ2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="varlena.c.html#LN1642"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1658"><span class='Ref_To_Local'>targ1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1659"><span class='Ref_To_Local'>targ2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1641"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end texteq &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1672"></a><span class='Declare_Function'>textne</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1674"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1675"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1676"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN1677"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN1678"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* See comment in texteq() */ 
</span>    <a href="varlena.c.html#LN1677"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1674"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1678"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1675"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1677"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1678"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN1676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN1687"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>targ1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1674"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1688"></a>        <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>targ2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN255"><span class='Ref_to_Macro'>DatumGetTextPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1675"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN1676"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1687"><span class='Ref_To_Local'>targ1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1688"><span class='Ref_To_Local'>targ2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="varlena.c.html#LN1677"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1687"><span class='Ref_To_Local'>targ1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1688"><span class='Ref_To_Local'>targ2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1676"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end textne &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1701"></a><span class='Declare_Function'>text_lt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1703"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1704"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1705"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1705"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN110"><span class='Ref_to_Proto'>text_cmp</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1703"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1704"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1703"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1704"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1705"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1716"></a><span class='Declare_Function'>text_le</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1718"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1719"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1720"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1720"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN110"><span class='Ref_to_Proto'>text_cmp</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1718"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1719"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1718"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1719"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1720"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1731"></a><span class='Declare_Function'>text_gt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1733"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1734"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1735"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1735"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN110"><span class='Ref_to_Proto'>text_cmp</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1733"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1734"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1733"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1734"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1735"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1746"></a><span class='Declare_Function'>text_ge</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1748"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1749"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1750"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1750"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN110"><span class='Ref_to_Proto'>text_cmp</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1748"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1749"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1748"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1749"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1750"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1761"></a><span class='Declare_Function'>bttextcmp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1763"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1764"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1765"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1765"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN110"><span class='Ref_to_Proto'>text_cmp</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1763"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1764"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1763"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1764"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1765"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN1776"></a><span class='Declare_Function'>bttextsortsupport</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1778"></a>    <a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Local'>ssup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1779"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>collid</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1778"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN66"><span class='Ref_to_Member'>ssup_collation</span></a><span class='Delimiter'>; 
</span><a name="LN1780"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1780"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1778"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN65"><span class='Ref_to_Member'>ssup_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use generic string SortSupport */ 
</span>    <a href="../../../include/utils/varlena.h.html#LN19"><span class='Ref_to_Proto'>varstr_sortsupport</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1778"><span class='Ref_To_Local'>ssup</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1779"><span class='Ref_To_Local'>collid</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1780"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Generic sortsupport interface for character type's operator classes. 
 * Includes locale support, and support for BpChar semantics (i.e. removing 
 * trailing spaces before comparison). 
 * 
 * Relies on the assumption that text, VarChar, BpChar, and bytea all have the 
 * same representation.  Callers that always use the C collation (e.g. 
 * non-collatable type callers like bytea) may have NUL bytes in their strings; 
 * this will not work with any other collation, though. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1803"></a><span class='Declare_Function'>varstr_sortsupport</span><span class='Parentheses'>(</span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>collid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>bpchar</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1805"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>abbreviate</span> <span class='Operator'>= </span><a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN155"><span class='Ref_to_Member'>abbreviate</span></a><span class='Delimiter'>; 
</span><a name="LN1806"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>collate_c</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1807"></a>    <a href="varlena.c.html#LN59"><span class='Ref_to_Typedef'>VarStringSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sss</span><span class='Delimiter'>; 
</span><a name="LN1808"></a>    <a href="../../../include/utils/pg_locale.h.html#LN87"><span class='Ref_to_Typedef'>pg_locale_t</span></a> <span class='Declare_Local'>locale</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If possible, set ssup-&GT;comparator to a function which can be used to 
     * directly compare two datums.  If we can do this, we'll avoid the 
     * overhead of a trip through the fmgr layer for every comparison, which 
     * can be substantial. 
     * 
     * Most typically, we'll set the comparator to varstrfastcmp_locale, which 
     * uses strcoll() to perform comparisons and knows about the special 
     * requirements of BpChar callers.  However, if LC_COLLATE = C, we can 
     * make things quite a bit faster with varstrfastcmp_c or bpcharfastcmp_c, 
     * both of which use memcmp() rather than strcoll(). 
     * 
     * There is a further exception on Windows.  When the database encoding is 
     * UTF-8 and we are not using the C collation, complex hacks are required. 
     * We don't currently have a comparator that handles that case, so we fall 
     * back on the slow method of having the sort code invoke bttextcmp() (in 
     * the case of text) via the fmgr trampoline. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/pg_locale.h.html#LN50"><span class='Ref_to_Proto'>lc_collate_is_c</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>collid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>bpchar</span></a><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN106"><span class='Ref_to_Member'>comparator</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN93"><span class='Ref_to_Proto'>varstrfastcmp_c</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN106"><span class='Ref_to_Member'>comparator</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN94"><span class='Ref_to_Proto'>bpcharfastcmp_c</span></a><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN1806"><span class='Ref_To_Local'>collate_c</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/c.h.html#LN61"><span class='Ref_to_Const'>WIN32</span></a> 
    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span> 
        <span class='Control'>return</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN106"><span class='Ref_to_Member'>comparator</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN95"><span class='Ref_to_Proto'>varstrfastcmp_locale</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We need a collation-sensitive comparison.  To make things faster, 
         * we'll figure out the collation based on the locale id and cache the 
         * result. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>collid</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_collation.h.html#LN74"><span class='Ref_to_Const'>DEFAULT_COLLATION_OID</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>collid</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * This typically means that the parser could not resolve a 
                 * conflict of implicit collations, so report it that way. 
                 */ 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INDETERMINATE_COLLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not determine which collation to use for string comparison"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"Use the COLLATE clause to set the collation explicitly."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="varlena.c.html#LN1808"><span class='Ref_To_Local'>locale</span></a> <span class='Operator'>= </span><a href="../../../include/utils/pg_locale.h.html#LN89"><span class='Ref_to_Proto'>pg_newlocale_from_collation</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>collid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Unfortunately, it seems that abbreviation for non-C collations is 
     * broken on many common platforms; testing of multiple versions of glibc 
     * reveals that, for many locales, strcoll() and strxfrm() do not return 
     * consistent results, which is fatal to this optimization.  While no 
     * other libc other than Cygwin has so far been shown to have a problem, 
     * we take the conservative course of action for right now and disable 
     * this categorically.  (Users who are certain this isn't a problem on 
     * their system can define TRUST_STRXFRM.) 
     * 
     * Even apart from the risk of broken locales, it's possible that there 
     * are platforms where the use of abbreviated keys should be disabled at 
     * compile time.  Having only 4 byte datums could make worst-case 
     * performance drastically more likely, for example.  Moreover, macOS's 
     * strxfrm() implementation is known to not effectively concentrate a 
     * significant amount of entropy from the original string in earlier 
     * transformed blobs.  It's possible that other supported platforms are 
     * similarly encumbered.  So, if we ever get past disabling this 
     * categorically, we may still want or need to disable it for particular 
     * platforms. 
     */ 
</span><span class='Directive'>#ifndef</span> TRUST_STRXFRM 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN1806"><span class='Ref_To_Local'>collate_c</span></a> <span class='Operator'>&& !</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1808"><span class='Ref_To_Local'>locale</span></a> <span class='Operator'>&& </span><a href="varlena.c.html#LN1808"><span class='Ref_To_Local'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Parentheses'>))</span> 
        <a href="varlena.c.html#LN1805"><span class='Ref_To_Local'>abbreviate</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If we're using abbreviated keys, or if we're using a locale-aware 
     * comparison, we need to initialize a StringSortSupport object.  Both 
     * cases will make use of the temporary buffers we initialize here for 
     * scratch space (and to detect requirement for BpChar semantics from 
     * caller), and the abbreviation case requires additional state. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1805"><span class='Ref_To_Local'>abbreviate</span></a> <span class='Operator'>|| !</span><a href="varlena.c.html#LN1806"><span class='Ref_To_Local'>collate_c</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN59"><span class='Ref_to_Typedef'>VarStringSortSupport</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN64"><span class='Ref_to_Member'>buflen1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN82"><span class='Ref_to_Const'>TEXTBUFLEN</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Start with invalid values */ 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN66"><span class='Ref_to_Member'>last_len1</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN67"><span class='Ref_to_Member'>last_len2</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Initialize */ 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN68"><span class='Ref_to_Member'>last_returned</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1808"><span class='Ref_To_Local'>locale</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * To avoid somehow confusing a strxfrm() blob and an original string, 
         * constantly keep track of the variety of data that buf1 and buf2 
         * currently contain. 
         * 
         * Comparisons may be interleaved with conversion calls.  Frequently, 
         * conversions and comparisons are batched into two distinct phases, 
         * but the correctness of caching cannot hinge upon this.  For 
         * comparison caching, buffer state is only trusted if cache_blob is 
         * found set to false, whereas strxfrm() caching only trusts the state 
         * when cache_blob is found set to true. 
         * 
         * Arbitrarily initialize cache_blob to true. 
         */ 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN69"><span class='Ref_to_Member'>cache_blob</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN70"><span class='Ref_to_Member'>collate_c</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1806"><span class='Ref_To_Local'>collate_c</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN71"><span class='Ref_to_Member'>bpchar</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>bpchar</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN86"><span class='Ref_to_Member'>ssup_extra</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If possible, plan to use the abbreviated keys optimization.  The 
         * core code may switch back to authoritative comparator should 
         * abbreviation be aborted. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN1805"><span class='Ref_To_Local'>abbreviate</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN74"><span class='Ref_to_Member'>prop_card</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>20</span><span class='Delimiter'>; 
</span>            <a href="../../../include/lib/hyperloglog.h.html#LN61"><span class='Ref_to_Proto'>initHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN72"><span class='Ref_to_Member'>abbr_card</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/lib/hyperloglog.h.html#LN61"><span class='Ref_to_Proto'>initHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN1807"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN73"><span class='Ref_to_Member'>full_card</span></a><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN191"><span class='Ref_to_Member'>abbrev_full_comparator</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN106"><span class='Ref_to_Member'>comparator</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN106"><span class='Ref_to_Member'>comparator</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN96"><span class='Ref_to_Proto'>varstrcmp_abbrev</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN172"><span class='Ref_to_Member'>abbrev_converter</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN97"><span class='Ref_to_Proto'>varstr_abbrev_convert</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN1803"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN182"><span class='Ref_to_Member'>abbrev_abort</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN98"><span class='Ref_to_Proto'>varstr_abbrev_abort</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if abbreviate||!collate_... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end varstr_sortsupport &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * sortsupport comparison func (for C locale case) 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1955"></a><span class='Declare_Function'>varstrfastcmp_c</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1957"></a>    <a href="varlena.c.html#LN43"><span class='Ref_to_Typedef'>VarString</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="varlena.c.html#LN91"><span class='Ref_to_Macro'>DatumGetVarStringPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1955"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1958"></a>    <a href="varlena.c.html#LN43"><span class='Ref_to_Typedef'>VarString</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="varlena.c.html#LN91"><span class='Ref_to_Macro'>DatumGetVarStringPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1955"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1959"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>a1p</span><span class='Delimiter'>, 
</span><a name="LN1960"></a>               <span class='Operator'>*</span><span class='Declare_Local'>a2p</span><span class='Delimiter'>; 
</span><a name="LN1961"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN1962"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>, 
</span><a name="LN1963"></a>                <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1959"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1957"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1960"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1958"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1961"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1957"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1962"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1958"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1963"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN1959"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1960"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1961"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1962"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="varlena.c.html#LN1963"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1961"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1962"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span> 
        <a href="varlena.c.html#LN1963"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1961"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1962"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We can't afford to leak memory here. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1957"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="varlena.c.html#LN1955"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1957"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1958"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="varlena.c.html#LN1955"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1958"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN1963"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end varstrfastcmp_c &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * sortsupport comparison func (for BpChar C locale case) 
 * 
 * BpChar outsources its sortsupport to this module.  Specialization for the 
 * varstr_sortsupport BpChar case, modeled on 
 * internal_bpchar_pattern_compare(). 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1992"></a><span class='Declare_Function'>bpcharfastcmp_c</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1994"></a>    <a href="../../../include/c.h.html#LN453"><span class='Ref_to_Typedef'>BpChar</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN256"><span class='Ref_to_Macro'>DatumGetBpCharPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1992"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1995"></a>    <a href="../../../include/c.h.html#LN453"><span class='Ref_to_Typedef'>BpChar</span></a>     <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN256"><span class='Ref_to_Macro'>DatumGetBpCharPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1992"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1996"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>a1p</span><span class='Delimiter'>, 
</span><a name="LN1997"></a>               <span class='Operator'>*</span><span class='Declare_Local'>a2p</span><span class='Delimiter'>; 
</span><a name="LN1998"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN1999"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>, 
</span><a name="LN2000"></a>                <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1996"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1994"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1997"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1995"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN1998"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN82"><span class='Ref_to_Proto'>bpchartruelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1996"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1994"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN1999"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN82"><span class='Ref_to_Proto'>bpchartruelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1997"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1995"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2000"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN1996"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1997"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1998"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN1999"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="varlena.c.html#LN2000"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1998"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN1999"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span> 
        <a href="varlena.c.html#LN2000"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN1998"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN1999"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We can't afford to leak memory here. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1994"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="varlena.c.html#LN1992"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1994"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1995"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="varlena.c.html#LN1992"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1995"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN2000"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bpcharfastcmp_c &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * sortsupport comparison func (for locale case) 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2025"></a><span class='Declare_Function'>varstrfastcmp_locale</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2027"></a>    <a href="varlena.c.html#LN43"><span class='Ref_to_Typedef'>VarString</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="varlena.c.html#LN91"><span class='Ref_to_Macro'>DatumGetVarStringPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2025"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2028"></a>    <a href="varlena.c.html#LN43"><span class='Ref_to_Typedef'>VarString</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="varlena.c.html#LN91"><span class='Ref_to_Macro'>DatumGetVarStringPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2025"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2029"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>arg1_match</span><span class='Delimiter'>; 
</span><a name="LN2030"></a>    <a href="varlena.c.html#LN59"><span class='Ref_to_Typedef'>VarStringSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sss</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN59"><span class='Ref_to_Typedef'>VarStringSortSupport</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN2025"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN86"><span class='Ref_to_Member'>ssup_extra</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* working state */ 
</span><a name="LN2033"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>a1p</span><span class='Delimiter'>, 
</span><a name="LN2034"></a>               <span class='Operator'>*</span><span class='Declare_Local'>a2p</span><span class='Delimiter'>; 
</span><a name="LN2035"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN2036"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>, 
</span><a name="LN2037"></a>                <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2033"><span class='Ref_To_Local'>a1p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2027"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2034"><span class='Ref_To_Local'>a2p</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2028"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2027"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2028"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fast pre-check for equality, as discussed in varstr_cmp() */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>&& </span>memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN2033"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2034"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * No change in buf1 or buf2 contents, so avoid changing last_len1 or 
         * last_len2.  Existing contents of buffers might still be used by 
         * next call. 
         * 
         * It's fine to allow the comparison of BpChar padding bytes here, 
         * even though that implies that the memcmp() will usually be 
         * performed for BpChar callers (though multibyte characters could 
         * still prevent that from occurring).  The memcmp() is still very 
         * cheap, and BpChar's funny semantics have us remove trailing spaces 
         * (not limited to padding), so we need make no distinction between 
         * padding space characters and "real" space characters. 
         */ 
</span>        <a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="varlena.c.html#LN2186"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN71"><span class='Ref_to_Member'>bpchar</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Get true number of bytes, ignoring trailing spaces */ 
</span>        <a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN82"><span class='Ref_to_Proto'>bpchartruelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2033"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN82"><span class='Ref_to_Proto'>bpchartruelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2034"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN64"><span class='Ref_to_Member'>buflen1</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN64"><span class='Ref_to_Member'>buflen1</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN64"><span class='Ref_to_Member'>buflen1</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2025"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN65"><span class='Ref_to_Member'>ssup_cxt</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN64"><span class='Ref_to_Member'>buflen1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2025"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN65"><span class='Ref_to_Member'>ssup_cxt</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We're likely to be asked to compare the same strings repeatedly, and 
     * memcmp() is so much cheaper than strcoll() that it pays to try to cache 
     * comparisons, even though in general there is no reason to think that 
     * that will work out (every string datum may be unique).  Caching does 
     * not slow things down measurably when it doesn't work out, and can speed 
     * things up by rather a lot when it does.  In part, this is because the 
     * memcmp() compares data from cachelines that are needed in L1 cache even 
     * when the last comparison's result cannot be reused. 
     */ 
</span>    <a href="varlena.c.html#LN2029"><span class='Ref_To_Local'>arg1_match</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN66"><span class='Ref_to_Member'>last_len1</span></a> <span class='Operator'>|| </span>memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2033"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN2029"><span class='Ref_To_Local'>arg1_match</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2033"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN66"><span class='Ref_to_Member'>last_len1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're comparing the same two strings as last time, we can return the 
     * same answer without calling strcoll() again.  This is more likely than 
     * it seems (at least with moderate to low cardinality sets), because 
     * quicksort compares the same pivot against many values. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN67"><span class='Ref_to_Member'>last_len2</span></a> <span class='Operator'>|| </span>memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2034"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2034"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN67"><span class='Ref_to_Member'>last_len2</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2029"><span class='Ref_To_Local'>arg1_match</span></a> <span class='Operator'>&& !</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN69"><span class='Ref_to_Member'>cache_blob</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Use result cached following last actual strcoll() call */ 
</span>        <a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN68"><span class='Ref_to_Member'>last_returned</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="varlena.c.html#LN2186"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_ICU 
<span class='Directive'>#ifdef</span> HAVE_UCOL_STRCOLLUTF8 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span> 
            <span class='Delimiter'>{ 
</span><a name="LN2131"></a>                UErrorCode  <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span> 
                <a href="varlena.c.html#LN2131"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span>U_ZERO_ERROR<span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>ucol_strcollUTF8<span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>icu<span class='Operator'>.</span>ucol<span class='Delimiter'>, 
</span>                                          <a href="varlena.c.html#LN2033"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, 
</span>                                          <a href="varlena.c.html#LN2034"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a><span class='Delimiter'>, 
</span>                                          <span class='Operator'>&</span><a href="varlena.c.html#LN2131"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>U_FAILURE<span class='Parentheses'>(</span><a href="varlena.c.html#LN2131"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                      <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"collation failed: %s"</span><span class='Delimiter'>, </span>u_errorName<span class='Parentheses'>(</span><a href="varlena.c.html#LN2131"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
            <span class='Delimiter'>{ 
</span><a name="LN2145"></a>                <a href="../../../port/crypt.c.html#LN107"><span class='Ref_to_Typedef'>int32_t</span></a>     <span class='Declare_Local'>ulen1</span><span class='Delimiter'>, 
</span><a name="LN2146"></a>                            <span class='Declare_Local'>ulen2</span><span class='Delimiter'>; 
</span><a name="LN2147"></a>                UChar      <span class='Operator'>*</span><span class='Declare_Local'>uchar1</span><span class='Delimiter'>, 
</span><a name="LN2148"></a>                           <span class='Operator'>*</span><span class='Declare_Local'>uchar2</span><span class='Delimiter'>; 
</span> 
                <a href="varlena.c.html#LN2145"><span class='Ref_To_Local'>ulen1</span></a> <span class='Operator'>= </span><a href="../../../include/utils/pg_locale.h.html#LN94"><span class='Ref_to_Proto'>icu_to_uchar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN2147"><span class='Ref_To_Local'>uchar1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2033"><span class='Ref_To_Local'>a1p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2035"><span class='Ref_To_Local'>len1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN2146"><span class='Ref_To_Local'>ulen2</span></a> <span class='Operator'>= </span><a href="../../../include/utils/pg_locale.h.html#LN94"><span class='Ref_to_Proto'>icu_to_uchar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN2148"><span class='Ref_To_Local'>uchar2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2034"><span class='Ref_To_Local'>a2p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2036"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>ucol_strcoll<span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>icu<span class='Operator'>.</span>ucol<span class='Delimiter'>, 
</span>                                      <a href="varlena.c.html#LN2147"><span class='Ref_To_Local'>uchar1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2145"><span class='Ref_To_Local'>ulen1</span></a><span class='Delimiter'>, 
</span>                                      <a href="varlena.c.html#LN2148"><span class='Ref_To_Local'>uchar2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2146"><span class='Ref_To_Local'>ulen2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* not USE_ICU */ 
</span>            <span class='Comment_Multi_Line'>/* shouldn't happen */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported collprovider: %c"</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_ICU */ 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sss-&GT;locale-&GT;provider... &raquo; </span> 
        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> HAVE_LOCALE_T 
            <a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/port/win32.h.html#LN345"><span class='Ref_to_Const'>strcoll_l</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>lt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
            <span class='Comment_Multi_Line'>/* shouldn't happen */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unsupported collprovider: %c"</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sss-&GT;locale &raquo; </span> 
    <span class='Control'>else</span> 
        <a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>strcoll<span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In some locales strcoll() can claim that nonidentical strings are 
     * equal. Believing that would be bad news for a number of reasons, so we 
     * follow Perl's lead and sort "equal" strings according to strcmp(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>strcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cache result, perhaps saving an expensive strcoll() call next time */ 
</span>    <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN69"><span class='Ref_to_Member'>cache_blob</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2030"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN68"><span class='Ref_to_Member'>last_returned</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span><a name="LN2186"></a><span class='Label'>done</span><span class='Operator'>: 
</span>    <span class='Comment_Multi_Line'>/* We can't afford to leak memory here. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2027"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="varlena.c.html#LN2025"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2027"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2028"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="varlena.c.html#LN2025"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2028"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN2037"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end varstrfastcmp_locale &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Abbreviated key comparison func 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN2200"></a><span class='Declare_Function'>varstrcmp_abbrev</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>y</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * When 0 is returned, the core system will call varstrfastcmp_c() 
     * (bpcharfastcmp_c() in BpChar case) or varstrfastcmp_locale().  Even a 
     * strcmp() on two non-truncated strxfrm() blobs cannot indicate *equality* 
     * authoritatively, for the same reason that there is a strcoll() 
     * tie-breaker call to strcmp() in varstr_cmp(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2200"><span class='Ref_to_Parameter'>x</span></a> <span class='Operator'>&GT; </span><a href="varlena.c.html#LN2200"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2200"><span class='Ref_to_Parameter'>x</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN2200"><span class='Ref_to_Parameter'>y</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Conversion routine for sortsupport.  Converts original to abbreviated key 
 * representation.  Our encoding strategy is simple -- pack the first 8 bytes 
 * of a strxfrm() blob into a Datum (on little-endian machines, the 8 bytes are 
 * stored in reverse order), and treat it as an unsigned integer.  When the "C" 
 * locale is used, or in case of bytea, just memcpy() from original instead. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2225"></a><span class='Declare_Function'>varstr_abbrev_convert</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>original</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2227"></a>    <a href="varlena.c.html#LN59"><span class='Ref_to_Typedef'>VarStringSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sss</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN59"><span class='Ref_to_Typedef'>VarStringSortSupport</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN2225"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN86"><span class='Ref_to_Member'>ssup_extra</span></a><span class='Delimiter'>; 
</span><a name="LN2228"></a>    <a href="varlena.c.html#LN43"><span class='Ref_to_Typedef'>VarString</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>authoritative</span> <span class='Operator'>= </span><a href="varlena.c.html#LN91"><span class='Ref_to_Macro'>DatumGetVarStringPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2225"><span class='Ref_to_Parameter'>original</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2229"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>authoritative_data</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2228"><span class='Ref_To_Local'>authoritative</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* working state */ 
</span><a name="LN2232"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span><a name="LN2233"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>pres</span><span class='Delimiter'>; 
</span><a name="LN2234"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN2235"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>hash</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2233"><span class='Ref_To_Local'>pres</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><span class='Operator'>&</span><a href="varlena.c.html#LN2232"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* memset(), so any non-overwritten bytes are NUL */ 
</span>    memset<span class='Parentheses'>(</span><a href="varlena.c.html#LN2233"><span class='Ref_To_Local'>pres</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2228"><span class='Ref_To_Local'>authoritative</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Get number of bytes, ignoring trailing spaces */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN71"><span class='Ref_to_Member'>bpchar</span></a><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN82"><span class='Ref_to_Proto'>bpchartruelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2229"><span class='Ref_To_Local'>authoritative_data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If we're using the C collation, use memcpy(), rather than strxfrm(), to 
     * abbreviate keys.  The full comparator for the C locale is always 
     * memcmp().  It would be incorrect to allow bytea callers (callers that 
     * always force the C collation -- bytea isn't a collatable type, but this 
     * approach is convenient) to use strxfrm().  This is because bytea 
     * strings may contain NUL bytes.  Besides, this should be faster, too. 
     * 
     * More generally, it's okay that bytea callers can have NUL bytes in 
     * strings because varstrcmp_abbrev() need not make a distinction between 
     * terminating NUL bytes, and NUL bytes representing actual NULs in the 
     * authoritative representation.  Hopefully a comparison at or past one 
     * abbreviated key's terminating NUL byte will resolve the comparison 
     * without consulting the authoritative representation; specifically, some 
     * later non-NUL byte in the longer string can resolve the comparison 
     * against a subsequent terminating NUL in the shorter string.  There will 
     * usually be what is effectively a "length-wise" resolution there and 
     * then. 
     * 
     * If that doesn't work out -- if all bytes in the longer string 
     * positioned at or past the offset of the smaller string's (first) 
     * terminating NUL are actually representative of NUL bytes in the 
     * authoritative binary string (perhaps with some *terminating* NUL bytes 
     * towards the end of the longer string iff it happens to still be small) 
     * -- then an authoritative tie-breaker will happen, and do the right 
     * thing: explicitly consider string length. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN70"><span class='Ref_to_Member'>collate_c</span></a><span class='Parentheses'>) 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN2233"><span class='Ref_To_Local'>pres</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2229"><span class='Ref_To_Local'>authoritative_data</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2277"></a>        <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>bsize</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> USE_ICU 
<a name="LN2279"></a>        <a href="../../../port/crypt.c.html#LN107"><span class='Ref_to_Typedef'>int32_t</span></a>     <span class='Declare_Local'>ulen</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN2280"></a>        UChar      <span class='Operator'>*</span><span class='Declare_Local'>uchar</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <span class='Comment_Multi_Line'>/* 
         * We're not using the C collation, so fall back on strxfrm or ICU 
         * analogs. 
         */ 
</span> 
        <span class='Comment_Multi_Line'>/* By convention, we use buffer 1 to store and NUL-terminate */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN64"><span class='Ref_to_Member'>buflen1</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN64"><span class='Ref_to_Member'>buflen1</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN64"><span class='Ref_to_Member'>buflen1</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN64"><span class='Ref_to_Member'>buflen1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Might be able to reuse strxfrm() blob from last call */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN66"><span class='Ref_to_Member'>last_len1</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&& </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN69"><span class='Ref_to_Member'>cache_blob</span></a> <span class='Operator'>&& 
</span>            memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2229"><span class='Ref_To_Local'>authoritative_data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN2233"><span class='Ref_To_Local'>pres</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN67"><span class='Ref_to_Member'>last_len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* No change affecting cardinality, so no hashing required */ 
</span>            <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="varlena.c.html#LN2434"><span class='Ref_to_Label'>done</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2229"><span class='Ref_To_Local'>authoritative_data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Just like strcoll(), strxfrm() expects a NUL-terminated string. Not 
         * necessary for ICU, but doesn't hurt. 
         */ 
</span>        <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN66"><span class='Ref_to_Member'>last_len1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> USE_ICU 
        <span class='Comment_Multi_Line'>/* When using ICU and not UTF8, convert string to UChar. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a> <span class='Operator'>&& </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a> <span class='Operator'>&& 
</span>            <a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>() </span><span class='Operator'>!= </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span> 
            <a href="varlena.c.html#LN2279"><span class='Ref_To_Local'>ulen</span></a> <span class='Operator'>= </span><a href="../../../include/utils/pg_locale.h.html#LN94"><span class='Ref_to_Proto'>icu_to_uchar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN2280"><span class='Ref_To_Local'>uchar</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Loop: Call strxfrm() or ucol_getSortKey(), possibly enlarge buffer, 
         * and try again.  Both of these functions have the result buffer 
         * content undefined if the result did not fit, so we need to retry 
         * until everything fits, even though we only need the first few bytes 
         * in the end.  When using ucol_nextSortKeyPart(), however, we only 
         * ask for as many bytes as we actually need. 
         */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_ICU 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a> <span class='Operator'>&& </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_collation.h.html#LN84"><span class='Ref_to_Const'>COLLPROVIDER_ICU</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* 
                 * When using UTF8, use the iteration interface so we only 
                 * need to produce as many bytes as we actually need. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN2340"></a>                    UCharIterator <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN2341"></a>                    uint32_t    <span class='Declare_Local'>state</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]; 
</span><a name="LN2342"></a>                    UErrorCode  <span class='Declare_Local'>status</span><span class='Delimiter'>; 
</span> 
                    uiter_setUTF8<span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN2340"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="varlena.c.html#LN2341"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN2341"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* won't need that again */ 
</span>                    <a href="varlena.c.html#LN2342"><span class='Ref_To_Local'>status</span></a> <span class='Operator'>= </span>U_ZERO_ERROR<span class='Delimiter'>; 
</span>                    <a href="varlena.c.html#LN2277"><span class='Ref_To_Local'>bsize</span></a> <span class='Operator'>= </span>ucol_nextSortKeyPart<span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>icu<span class='Operator'>.</span>ucol<span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="varlena.c.html#LN2340"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, 
</span>                                                 <a href="varlena.c.html#LN2341"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, 
</span>                                                 <span class='Parentheses'>(</span>uint8_t <span class='Operator'>*</span><span class='Parentheses'>)</span> <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <span class='Operator'>&</span><a href="varlena.c.html#LN2342"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span>U_FAILURE<span class='Parentheses'>(</span><a href="varlena.c.html#LN2342"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"sort key generation failed: %s"</span><span class='Delimiter'>, </span>u_errorName<span class='Parentheses'>(</span><a href="varlena.c.html#LN2342"><span class='Ref_To_Local'>status</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                    <a href="varlena.c.html#LN2277"><span class='Ref_To_Local'>bsize</span></a> <span class='Operator'>= </span>ucol_getSortKey<span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>icu<span class='Operator'>.</span>ucol<span class='Delimiter'>, 
</span>                                            <a href="varlena.c.html#LN2280"><span class='Ref_To_Local'>uchar</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2279"><span class='Ref_To_Local'>ulen</span></a><span class='Delimiter'>, 
</span>                                        <span class='Parentheses'>(</span>uint8_t <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if sss-&GT;locale&&sss-&GT;loc... &raquo; </span> 
            <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
<span class='Directive'>#ifdef</span> HAVE_LOCALE_T 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a> <span class='Operator'>&& </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN70"><span class='Ref_to_Member'>provider</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_collation.h.html#LN85"><span class='Ref_to_Const'>COLLPROVIDER_LIBC</span></a><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN2277"><span class='Ref_To_Local'>bsize</span></a> <span class='Operator'>= </span><a href="../../../include/port/win32.h.html#LN346"><span class='Ref_to_Const'>strxfrm_l</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, 
</span>                                  <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN75"><span class='Ref_to_Member'>locale</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/pg_locale.h.html#LN84"><span class='Ref_to_Member'>info</span></a><span class='Operator'>.</span>lt<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
<span class='Directive'>#endif</span> 
                <a href="varlena.c.html#LN2277"><span class='Ref_To_Local'>bsize</span></a> <span class='Operator'>= </span>strxfrm<span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN61"><span class='Ref_to_Member'>buf1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN67"><span class='Ref_to_Member'>last_len2</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2277"><span class='Ref_To_Local'>bsize</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2277"><span class='Ref_To_Local'>bsize</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Grow buffer and retry. 
             */ 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2277"><span class='Ref_To_Local'>bsize</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                               <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>, </span><a href="../../../common/psprintf.c.html#LN27"><span class='Ref_to_Const'>MaxAllocSize</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN65"><span class='Ref_to_Member'>buflen2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * Every Datum byte is always compared.  This is safe because the 
         * strxfrm() blob is itself NUL terminated, leaving no danger of 
         * misinterpreting any NUL bytes not intended to be interpreted as 
         * logically representing termination. 
         * 
         * (Actually, even if there were NUL bytes in the blob it would be 
         * okay.  See remarks on bytea case above.) 
         */ 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN2233"><span class='Ref_To_Local'>pres</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN63"><span class='Ref_to_Member'>buf2</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2277"><span class='Ref_To_Local'>bsize</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Maintain approximate cardinality of both abbreviated keys and original, 
     * authoritative keys using HyperLogLog.  Used as cheap insurance against 
     * the worst case, where we do many string transformations for no saving 
     * in full strcoll()-based comparisons.  These statistics are used by 
     * varstr_abbrev_abort(). 
     * 
     * First, Hash key proper, or a significant fraction of it.  Mix in length 
     * in order to compensate for cases where differences are past 
     * PG_CACHE_LINE_SIZE bytes, so as to limit the overhead of hashing. 
     */ 
</span>    <a href="varlena.c.html#LN2235"><span class='Ref_To_Local'>hash</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../access/hash/hashfunc.c.html#LN305"><span class='Ref_to_Func'>hash_any</span></a><span class='Parentheses'>((</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN2229"><span class='Ref_To_Local'>authoritative_data</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="../../../include/pg_config_manual.h.html#LN236"><span class='Ref_to_Const'>PG_CACHE_LINE_SIZE</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><a href="../../../include/pg_config_manual.h.html#LN236"><span class='Ref_to_Const'>PG_CACHE_LINE_SIZE</span></a><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN2235"><span class='Ref_To_Local'>hash</span></a> <span class='Operator'>^= </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/access/hash.h.html#LN326"><span class='Ref_to_Proto'>hash_uint32</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="varlena.c.html#LN2234"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/hyperloglog.h.html#LN63"><span class='Ref_to_Proto'>addHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN73"><span class='Ref_to_Member'>full_card</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2235"><span class='Ref_To_Local'>hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Hash abbreviated key */ 
</span><span class='Directive'>#if</span> <a href="../../../include/postgres.h.html#LN373"><span class='Ref_to_Const'>SIZEOF_DATUM</span></a> <span class='Operator'>== </span><span class='Number'>8</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2419"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>lohalf</span><span class='Delimiter'>, 
</span><a name="LN2420"></a>                    <span class='Declare_Local'>hihalf</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN2419"><span class='Ref_To_Local'>lohalf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="varlena.c.html#LN2232"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2420"><span class='Ref_To_Local'>hihalf</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) (</span><a href="varlena.c.html#LN2232"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>32</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN2235"><span class='Ref_To_Local'>hash</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/access/hash.h.html#LN326"><span class='Ref_to_Proto'>hash_uint32</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2419"><span class='Ref_To_Local'>lohalf</span></a> <span class='Operator'>^ </span><a href="varlena.c.html#LN2420"><span class='Ref_To_Local'>hihalf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* SIZEOF_DATUM != 8 */ 
</span>    <a href="varlena.c.html#LN2235"><span class='Ref_To_Local'>hash</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/access/hash.h.html#LN326"><span class='Ref_to_Proto'>hash_uint32</span></a><span class='Parentheses'>((</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="varlena.c.html#LN2232"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <a href="../../../include/lib/hyperloglog.h.html#LN63"><span class='Ref_to_Proto'>addHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN72"><span class='Ref_to_Member'>abbr_card</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2235"><span class='Ref_To_Local'>hash</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cache result, perhaps saving an expensive strxfrm() call next time */ 
</span>    <a href="varlena.c.html#LN2227"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN69"><span class='Ref_to_Member'>cache_blob</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN2434"></a><span class='Label'>done</span><span class='Operator'>: 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Byteswap on little-endian machines. 
     * 
     * This is needed so that varstrcmp_abbrev() (an unsigned integer 3-way 
     * comparator) works correctly on all platforms.  If we didn't do this, 
     * the comparator would have to call memcmp() with a pair of pointers to 
     * the first byte of each abbreviated key, which is slower. 
     */ 
</span>    <a href="varlena.c.html#LN2232"><span class='Ref_To_Local'>res</span></a> <span class='Operator'>= </span><a href="../../../include/port/pg_bswap.h.html#LN59"><span class='Ref_to_Macro'>DatumBigEndianToNative</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2232"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Don't leak memory here */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2228"><span class='Ref_To_Local'>authoritative</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="varlena.c.html#LN2225"><span class='Ref_to_Parameter'>original</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2228"><span class='Ref_To_Local'>authoritative</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN2232"><span class='Ref_To_Local'>res</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end varstr_abbrev_convert &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Callback for estimating effectiveness of abbreviated key optimization, using 
 * heuristic rules.  Returns value indicating if the abbreviation optimization 
 * should be aborted, based on its projected effectiveness. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN2459"></a><span class='Declare_Function'>varstr_abbrev_abort</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>memtupcount</span><span class='Delimiter'>, </span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Parameter'>ssup</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2461"></a>    <a href="varlena.c.html#LN59"><span class='Ref_to_Typedef'>VarStringSortSupport</span></a> <span class='Operator'>*</span><span class='Declare_Local'>sss</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN59"><span class='Ref_to_Typedef'>VarStringSortSupport</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN2459"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN86"><span class='Ref_to_Member'>ssup_extra</span></a><span class='Delimiter'>; 
</span><a name="LN2462"></a>    <span class='Keyword'>double</span>      <span class='Declare_Local'>abbrev_distinct</span><span class='Delimiter'>, 
</span><a name="LN2463"></a>                <span class='Declare_Local'>key_distinct</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN2459"><span class='Ref_to_Parameter'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN155"><span class='Ref_to_Member'>abbreviate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Have a little patience */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2459"><span class='Ref_to_Parameter'>memtupcount</span></a> <span class='Operator'>&LT; </span><span class='Number'>100</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2462"><span class='Ref_To_Local'>abbrev_distinct</span></a> <span class='Operator'>= </span><a href="../../../include/lib/hyperloglog.h.html#LN64"><span class='Ref_to_Proto'>estimateHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN2461"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN72"><span class='Ref_to_Member'>abbr_card</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2463"><span class='Ref_To_Local'>key_distinct</span></a> <span class='Operator'>= </span><a href="../../../include/lib/hyperloglog.h.html#LN64"><span class='Ref_to_Proto'>estimateHyperLogLog</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN2461"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN73"><span class='Ref_to_Member'>full_card</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Clamp cardinality estimates to at least one distinct value.  While 
     * NULLs are generally disregarded, if only NULL values were seen so far, 
     * that might misrepresent costs if we failed to clamp. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2462"><span class='Ref_To_Local'>abbrev_distinct</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN2462"><span class='Ref_To_Local'>abbrev_distinct</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2463"><span class='Ref_To_Local'>key_distinct</span></a> <span class='Operator'>&LT;= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN2463"><span class='Ref_To_Local'>key_distinct</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Operator'>.</span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In the worst case all abbreviated keys are identical, while at the same 
     * time there are differences within full key strings not captured in 
     * abbreviations. 
     */ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/pg_config_manual.h.html#LN314"><span class='Ref_to_Const'>TRACE_SORT</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../sort/tuplesort.c.html#LN154"><span class='Ref_to_Global_Var'>trace_sort</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2493"></a>        <span class='Keyword'>double</span>      <span class='Declare_Local'>norm_abbrev_card</span> <span class='Operator'>= </span><a href="varlena.c.html#LN2462"><span class='Ref_To_Local'>abbrev_distinct</span></a> <span class='Operator'>/ </span><span class='Parentheses'>(</span><span class='Keyword'>double</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN2459"><span class='Ref_to_Parameter'>memtupcount</span></a><span class='Delimiter'>; 
</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"varstr_abbrev: abbrev_distinct after %d: %f "</span> 
             <span class='String'>"(key_distinct: %f, norm_abbrev_card: %f, prop_card: %f)"</span><span class='Delimiter'>, 
</span>             <a href="varlena.c.html#LN2459"><span class='Ref_to_Parameter'>memtupcount</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2462"><span class='Ref_To_Local'>abbrev_distinct</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2463"><span class='Ref_To_Local'>key_distinct</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2493"><span class='Ref_To_Local'>norm_abbrev_card</span></a><span class='Delimiter'>, 
</span>             <a href="varlena.c.html#LN2461"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN74"><span class='Ref_to_Member'>prop_card</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If the number of distinct abbreviated keys approximately matches the 
     * number of distinct authoritative original keys, that's reason enough to 
     * proceed.  We can win even with a very low cardinality set if most 
     * tie-breakers only memcmp().  This is by far the most important 
     * consideration. 
     * 
     * While comparisons that are resolved at the abbreviated key level are 
     * considerably cheaper than tie-breakers resolved with memcmp(), both of 
     * those two outcomes are so much cheaper than a full strcoll() once 
     * sorting is underway that it doesn't seem worth it to weigh abbreviated 
     * cardinality against the overall size of the set in order to more 
     * accurately model costs.  Assume that an abbreviated comparison, and an 
     * abbreviated comparison with a cheap memcmp()-based authoritative 
     * resolution are equivalent. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2462"><span class='Ref_To_Local'>abbrev_distinct</span></a> <span class='Operator'>&GT; </span><a href="varlena.c.html#LN2463"><span class='Ref_To_Local'>key_distinct</span></a> <span class='Operator'>* </span><a href="varlena.c.html#LN2461"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN74"><span class='Ref_to_Member'>prop_card</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * When we have exceeded 10,000 tuples, decay required cardinality 
         * aggressively for next call. 
         * 
         * This is useful because the number of comparisons required on 
         * average increases at a linearithmic rate, and at roughly 10,000 
         * tuples that factor will start to dominate over the linear costs of 
         * string transformation (this is a conservative estimate).  The decay 
         * rate is chosen to be a little less aggressive than halving -- which 
         * (since we're called at points at which memtupcount has doubled) 
         * would never see the cost model actually abort past the first call 
         * following a decay.  This decay rate is mostly a precaution against 
         * a sudden, violent swing in how well abbreviated cardinality tracks 
         * full key cardinality.  The decay also serves to prevent a marginal 
         * case from being aborted too late, when too much has already been 
         * invested in string transformation. 
         * 
         * It's possible for sets of several million distinct strings with 
         * mere tens of thousands of distinct abbreviated keys to still 
         * benefit very significantly.  This will generally occur provided 
         * each abbreviated key is a proxy for a roughly uniform number of the 
         * set's full keys. If it isn't so, we hope to catch that early and 
         * abort.  If it isn't caught early, by the time the problem is 
         * apparent it's probably not worth aborting. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2459"><span class='Ref_to_Parameter'>memtupcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>10000</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN2461"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN74"><span class='Ref_to_Member'>prop_card</span></a> <span class='Operator'>*= </span><span class='Number'>0</span><span class='Operator'>.</span><span class='Number'>65</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if abbrev_distinct&GT;key_d... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Abort abbreviation strategy. 
     * 
     * The worst case, where all abbreviated keys are identical while all 
     * original strings differ will typically only see a regression of about 
     * 10% in execution time for small to medium sized lists of strings. 
     * Whereas on modern CPUs where cache stalls are the dominant cost, we can 
     * often expect very large improvements, particularly with sets of strings 
     * of moderately high to high abbreviated cardinality.  There is little to 
     * lose but much to gain, which our strategy reflects. 
     */ 
</span><span class='Directive'>#ifdef</span> <a href="../../../include/pg_config_manual.h.html#LN314"><span class='Ref_to_Const'>TRACE_SORT</span></a> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../sort/tuplesort.c.html#LN154"><span class='Ref_to_Global_Var'>trace_sort</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN25"><span class='Ref_to_Const'>LOG</span></a><span class='Delimiter'>, </span><span class='String'>"varstr_abbrev: aborted abbreviation at %d "</span> 
             <span class='String'>"(abbrev_distinct: %f, key_distinct: %f, prop_card: %f)"</span><span class='Delimiter'>, 
</span>             <a href="varlena.c.html#LN2459"><span class='Ref_to_Parameter'>memtupcount</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2462"><span class='Ref_To_Local'>abbrev_distinct</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2463"><span class='Ref_To_Local'>key_distinct</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2461"><span class='Ref_To_Local'>sss</span></a><span class='Operator'>-&GT;</span><a href="varlena.c.html#LN74"><span class='Ref_to_Member'>prop_card</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end varstr_abbrev_abort &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2573"></a><span class='Declare_Function'>text_larger</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2575"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2576"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2577"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2577"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="varlena.c.html#LN110"><span class='Ref_to_Proto'>text_cmp</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2575"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2576"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><a href="varlena.c.html#LN2575"><span class='Ref_To_Local'>arg1</span></a> <span class='Operator'>: </span><a href="varlena.c.html#LN2576"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2577"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2585"></a><span class='Declare_Function'>text_smaller</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2587"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2588"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2589"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2589"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><a href="varlena.c.html#LN110"><span class='Ref_to_Proto'>text_cmp</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2587"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2588"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN162"><span class='Ref_to_Macro'>PG_GET_COLLATION</span></a><span class='Parentheses'>())</span> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>? </span><a href="varlena.c.html#LN2587"><span class='Ref_To_Local'>arg1</span></a> <span class='Operator'>: </span><a href="varlena.c.html#LN2588"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2589"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * The following operators support character-by-character comparison 
 * of text datums, to allow building indexes suitable for LIKE clauses. 
 * Note that the regular texteq/textne comparison operators, and regular 
 * support functions 1 and 2 with "C" collation are assumed to be 
 * compatible with these! 
 */ 
</span> 
<span class='Keyword'>static int 
</span><a name="LN2606"></a><span class='Declare_Function'>internal_text_pattern_compare</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2608"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2609"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN2610"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2609"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2606"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2610"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2606"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2608"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2606"><span class='Ref_to_Parameter'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2606"><span class='Ref_to_Parameter'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2609"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2610"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2608"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="varlena.c.html#LN2608"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2609"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN2610"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2609"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&GT; </span><a href="varlena.c.html#LN2610"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end internal_text_pattern_compare &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2628"></a><span class='Declare_Function'>text_pattern_lt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2630"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2631"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2632"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2632"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2605"><span class='Ref_to_Func'>internal_text_pattern_compare</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2630"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2631"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2630"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2631"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2632"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2644"></a><span class='Declare_Function'>text_pattern_le</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2646"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2647"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2648"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2648"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2605"><span class='Ref_to_Func'>internal_text_pattern_compare</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2646"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2647"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2646"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2647"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2648"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2660"></a><span class='Declare_Function'>text_pattern_ge</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2662"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2663"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2664"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2664"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2605"><span class='Ref_to_Func'>internal_text_pattern_compare</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2662"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2663"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2662"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2663"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2664"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2676"></a><span class='Declare_Function'>text_pattern_gt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2678"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2679"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2680"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2680"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2605"><span class='Ref_to_Func'>internal_text_pattern_compare</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2678"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2679"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2678"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2679"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2680"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2692"></a><span class='Declare_Function'>bttext_pattern_cmp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2694"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2695"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2696"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2696"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2605"><span class='Ref_to_Func'>internal_text_pattern_compare</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2694"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2695"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2694"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2695"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2696"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2708"></a><span class='Declare_Function'>bttext_pattern_sortsupport</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2710"></a>    <a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Local'>ssup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2711"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2711"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2710"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN65"><span class='Ref_to_Member'>ssup_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use generic string SortSupport, forcing "C" collation */ 
</span>    <a href="../../../include/utils/varlena.h.html#LN19"><span class='Ref_to_Proto'>varstr_sortsupport</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2710"><span class='Ref_To_Local'>ssup</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_collation.h.html#LN77"><span class='Ref_to_Const'>C_COLLATION_OID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2711"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/*------------------------------------------------------------- 
 * byteaoctetlen 
 * 
 * get the number of bytes contained in an instance of type 'bytea' 
 *------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2731"></a><span class='Declare_Function'>byteaoctetlen</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2733"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We need not detoast the input at all */ 
</span>    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2733"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * byteacat - 
 *    takes two bytea* and returns a bytea* that is the concatenation of 
 *    the two. 
 * 
 * Cloned from textcat and modified as required. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2747"></a><span class='Declare_Function'>byteacat</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2749"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2750"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN111"><span class='Ref_to_Proto'>bytea_catenate</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2749"><span class='Ref_To_Local'>t1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2750"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * bytea_catenate 
 *  Guts of byteacat(), broken out so it can be used by other functions 
 * 
 * Arguments can be in short-header form, but not compressed or out-of-line 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>* 
</span><a name="LN2762"></a><span class='Declare_Function'>bytea_catenate</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2764"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2765"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN2766"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>, 
</span><a name="LN2767"></a>                <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN2768"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2765"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2762"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2766"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2762"><span class='Ref_to_Parameter'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* paranoia ... probably should throw error instead? */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2765"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN2765"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2766"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN2766"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2767"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2765"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN2766"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2764"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2767"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Set size of result string... */ 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2764"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2767"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Fill data field of result string... */ 
</span>    <a href="varlena.c.html#LN2768"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2764"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2765"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN2768"><span class='Ref_To_Local'>ptr</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2762"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2765"><span class='Ref_To_Local'>len1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2766"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN2768"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN2765"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2762"><span class='Ref_to_Parameter'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2766"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN2764"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bytea_catenate &raquo; </span> 
 
<a name="LN2795"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_STR_GET_BYTEA</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>str_</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN253"><span class='Ref_to_Func'>byteain</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2795"><span class='Ref_to_Parameter'>str_</span></a><span class='Parentheses'>)))</span> 
 
<span class='Comment_Multi_Line'>/* 
 * bytea_substr() 
 * Return a substring starting at the specified position. 
 * Cloned from text_substr and modified as required. 
 * 
 * Input: 
 *  - string 
 *  - starting position (is one-based) 
 *  - string length (optional) 
 * 
 * If the starting position is zero or less, then return from the start of the string 
 * adjusting the length to be consistent with the "negative start" per SQL. 
 * If the length is less than zero, an ERROR is thrown. If no third argument 
 * (length) is provided, the length to the end of the string is assumed. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2814"></a><span class='Declare_Function'>bytea_substr</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN112"><span class='Ref_to_Proto'>bytea_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>false</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * bytea_substr_no_len - 
 *    Wrapper to avoid opr_sanity failure due to 
 *    one function accepting a different number of args. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2828"></a><span class='Declare_Function'>bytea_substr_no_len</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN112"><span class='Ref_to_Proto'>bytea_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                      <span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>* 
</span><a name="LN2837"></a><span class='Declare_Function'>bytea_substring</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>str</span><span class='Delimiter'>, 
</span><a name="LN2838"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>S</span><span class='Delimiter'>, 
</span><a name="LN2839"></a>                <span class='Keyword'>int </span><span class='Declare_Parameter'>L</span><span class='Delimiter'>, 
</span><a name="LN2840"></a>                <span class='Keyword'>bool </span><span class='Declare_Parameter'>length_not_specified</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2842"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>S1</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* adjusted start position */ 
</span><a name="LN2843"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>L1</span><span class='Delimiter'>;</span>             <span class='Comment_Single_Line'>/* adjusted substring length */ 
</span> 
    <a href="varlena.c.html#LN2842"><span class='Ref_To_Local'>S1</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN10"><span class='Ref_to_Macro'>Max</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2838"><span class='Ref_to_Parameter'>S</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2840"><span class='Ref_to_Parameter'>length_not_specified</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Not passed a length - DatumGetByteaPSlice() grabs everything to the 
         * end of the string if we pass it a negative value for length. 
         */ 
</span>        <a href="varlena.c.html#LN2843"><span class='Ref_To_Local'>L1</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* end position */ 
</span><a name="LN2858"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>E</span> <span class='Operator'>= </span><a href="varlena.c.html#LN2838"><span class='Ref_to_Parameter'>S</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN2839"><span class='Ref_to_Parameter'>L</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A negative value for L is the only way for the end position to be 
         * before the start. SQL99 says to throw an error. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2858"><span class='Ref_To_Local'>E</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN2838"><span class='Ref_to_Parameter'>S</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SUBSTRING_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"negative substring length not allowed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * A zero or negative value for the end position can happen if the 
         * start was negative or one. SQL99 says to return a zero-length 
         * string. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2858"><span class='Ref_To_Local'>E</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="varlena.c.html#LN2795"><span class='Ref_to_Macro'>PG_STR_GET_BYTEA</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN2843"><span class='Ref_To_Local'>L1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2858"><span class='Ref_To_Local'>E</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN2842"><span class='Ref_To_Local'>S1</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * If the start position is past the end of the string, SQL99 says to 
     * return a zero-length string -- DatumGetByteaPSlice() will do that for 
     * us. Convert to zero-based starting position 
     */ 
</span>    <span class='Control'>return</span> <a href="../../../include/fmgr.h.html#LN266"><span class='Ref_to_Macro'>DatumGetByteaPSlice</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2837"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2842"><span class='Ref_To_Local'>S1</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2843"><span class='Ref_To_Local'>L1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bytea_substring &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * byteaoverlay 
 *  Replace specified substring of first string with second 
 * 
 * The SQL standard defines OVERLAY() in terms of substring and concatenation. 
 * This code is a direct implementation of what the standard says. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2896"></a><span class='Declare_Function'>byteaoverlay</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2898"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2899"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2900"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sp</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* substring start position */ 
</span><a name="LN2901"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sl</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* substring length */ 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN116"><span class='Ref_to_Proto'>bytea_overlay</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2898"><span class='Ref_To_Local'>t1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2899"><span class='Ref_To_Local'>t2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2900"><span class='Ref_To_Local'>sp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2901"><span class='Ref_To_Local'>sl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2907"></a><span class='Declare_Function'>byteaoverlay_no_len</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2909"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2910"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2911"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sp</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* substring start position */ 
</span><a name="LN2912"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sl</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2912"><span class='Ref_To_Local'>sl</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2910"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* defaults to length(t2) */ 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN116"><span class='Ref_to_Proto'>bytea_overlay</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2909"><span class='Ref_To_Local'>t1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2910"><span class='Ref_To_Local'>t2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2911"><span class='Ref_To_Local'>sp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2912"><span class='Ref_To_Local'>sl</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>static </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>* 
</span><a name="LN2919"></a><span class='Declare_Function'>bytea_overlay</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t1</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t2</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sp</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2921"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2922"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>s1</span><span class='Delimiter'>; 
</span><a name="LN2923"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>s2</span><span class='Delimiter'>; 
</span><a name="LN2924"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>sp_pl_sl</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check for possible integer-overflow cases.  For negative sp, throw a 
     * "substring length" error because that's what should be expected 
     * according to the spec's definition of OVERLAY(). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2919"><span class='Ref_to_Parameter'>sp</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SUBSTRING_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"negative substring length not allowed"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2924"><span class='Ref_To_Local'>sp_pl_sl</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2919"><span class='Ref_to_Parameter'>sp</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN2919"><span class='Ref_to_Parameter'>sl</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2924"><span class='Ref_To_Local'>sp_pl_sl</span></a> <span class='Operator'>&LT;= </span><a href="varlena.c.html#LN2919"><span class='Ref_to_Parameter'>sl</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"integer out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2922"><span class='Ref_To_Local'>s1</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN112"><span class='Ref_to_Proto'>bytea_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2919"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2919"><span class='Ref_to_Parameter'>sp</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2923"><span class='Ref_To_Local'>s2</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN112"><span class='Ref_to_Proto'>bytea_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2919"><span class='Ref_to_Parameter'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN2924"><span class='Ref_To_Local'>sp_pl_sl</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2921"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN111"><span class='Ref_to_Proto'>bytea_catenate</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2922"><span class='Ref_To_Local'>s1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2919"><span class='Ref_to_Parameter'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2921"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN111"><span class='Ref_to_Proto'>bytea_catenate</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2921"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2923"><span class='Ref_To_Local'>s2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN2921"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end bytea_overlay &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * byteapos - 
 *    Return the position of the specified substring. 
 *    Implements the SQL POSITION() function. 
 * Cloned from textpos and modified as required. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2956"></a><span class='Declare_Function'>byteapos</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2958"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>t1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2959"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>t2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2960"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>pos</span><span class='Delimiter'>; 
</span><a name="LN2961"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>px</span><span class='Delimiter'>, 
</span><a name="LN2962"></a>                <span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN2963"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN2964"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span><a name="LN2965"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p1</span><span class='Delimiter'>, 
</span><a name="LN2966"></a>               <span class='Operator'>*</span><span class='Declare_Local'>p2</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2963"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2958"><span class='Ref_To_Local'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2964"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2959"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2964"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>&LT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>     <span class='Comment_Single_Line'>/* result for empty pattern */ 
</span> 
    <a href="varlena.c.html#LN2965"><span class='Ref_To_Local'>p1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2958"><span class='Ref_To_Local'>t1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2966"><span class='Ref_To_Local'>p2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2959"><span class='Ref_To_Local'>t2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN2960"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN2961"><span class='Ref_To_Local'>px</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN2963"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN2964"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN2962"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN2962"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT;= </span><a href="varlena.c.html#LN2961"><span class='Ref_To_Local'>px</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN2962"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>((</span><span class='Operator'>*</span><a href="varlena.c.html#LN2966"><span class='Ref_To_Local'>p2</span></a> <span class='Operator'>== *</span><a href="varlena.c.html#LN2965"><span class='Ref_To_Local'>p1</span></a><span class='Parentheses'>)</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><a href="varlena.c.html#LN2965"><span class='Ref_To_Local'>p1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2966"><span class='Ref_To_Local'>p2</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN2964"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <a href="varlena.c.html#LN2960"><span class='Ref_To_Local'>pos</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN2962"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}; 
</span>        <a href="varlena.c.html#LN2965"><span class='Ref_To_Local'>p1</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN2960"><span class='Ref_To_Local'>pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteapos &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*------------------------------------------------------------- 
 * byteaGetByte 
 * 
 * this routine treats "bytea" as an array of bytes. 
 * It returns the Nth byte (a number between 0 and 255). 
 *------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3000"></a><span class='Declare_Function'>byteaGetByte</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3002"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3003"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3004"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN3005"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>byte</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3004"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3002"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3003"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="varlena.c.html#LN3003"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN3004"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index %d out of valid range, 0..%d"</span><span class='Delimiter'>, 
</span>                        <a href="varlena.c.html#LN3003"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3004"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3005"><span class='Ref_To_Local'>byte</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3002"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN3003"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>]; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3005"><span class='Ref_To_Local'>byte</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteaGetByte &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*------------------------------------------------------------- 
 * byteaGetBit 
 * 
 * This routine treats a "bytea" type like an array of bits. 
 * It returns the value of the Nth bit (0 or 1). 
 * 
 *------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3029"></a><span class='Declare_Function'>byteaGetBit</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3031"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3032"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3033"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>byteNo</span><span class='Delimiter'>, 
</span><a name="LN3034"></a>                <span class='Declare_Local'>bitNo</span><span class='Delimiter'>; 
</span><a name="LN3035"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN3036"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>byte</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3035"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3031"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3032"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="varlena.c.html#LN3032"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN3035"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>* </span><span class='Number'>8</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index %d out of valid range, 0..%d"</span><span class='Delimiter'>, 
</span>                        <a href="varlena.c.html#LN3032"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3035"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>* </span><span class='Number'>8</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3033"><span class='Ref_To_Local'>byteNo</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3032"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>/ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3034"><span class='Ref_To_Local'>bitNo</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3032"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>% </span><span class='Number'>8</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3036"><span class='Ref_To_Local'>byte</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3031"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>))</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN3033"><span class='Ref_To_Local'>byteNo</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3036"><span class='Ref_To_Local'>byte</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="varlena.c.html#LN3034"><span class='Ref_To_Local'>bitNo</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteaGetBit &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*------------------------------------------------------------- 
 * byteaSetByte 
 * 
 * Given an instance of type 'bytea' creates a new one with 
 * the Nth byte set to the given value. 
 * 
 *------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3066"></a><span class='Declare_Function'>byteaSetByte</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3068"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN277"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_P_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3069"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3070"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>newByte</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3071"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3071"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3068"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3069"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="varlena.c.html#LN3069"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN3071"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index %d out of valid range, 0..%d"</span><span class='Delimiter'>, 
</span>                        <a href="varlena.c.html#LN3069"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3071"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Now set the byte. 
     */ 
</span>    <span class='Parentheses'>((</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3068"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN3069"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN3070"><span class='Ref_To_Local'>newByte</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3068"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteaSetByte &raquo; </span> 
 
<span class='Comment_Multi_Line'>/*------------------------------------------------------------- 
 * byteaSetBit 
 * 
 * Given an instance of type 'bytea' creates a new one with 
 * the Nth bit set to the given value. 
 * 
 *------------------------------------------------------------- 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3098"></a><span class='Declare_Function'>byteaSetBit</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3100"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>res</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN277"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_P_COPY</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3101"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3102"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>newBit</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3103"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN3104"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>oldByte</span><span class='Delimiter'>, 
</span><a name="LN3105"></a>                <span class='Declare_Local'>newByte</span><span class='Delimiter'>; 
</span><a name="LN3106"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>byteNo</span><span class='Delimiter'>, 
</span><a name="LN3107"></a>                <span class='Declare_Local'>bitNo</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3103"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3100"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3101"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="varlena.c.html#LN3101"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN3103"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>* </span><span class='Number'>8</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_ARRAY_SUBSCRIPT_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"index %d out of valid range, 0..%d"</span><span class='Delimiter'>, 
</span>                        <a href="varlena.c.html#LN3101"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3103"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>* </span><span class='Number'>8</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3106"><span class='Ref_To_Local'>byteNo</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3101"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>/ </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3107"><span class='Ref_To_Local'>bitNo</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3101"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>% </span><span class='Number'>8</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * sanity check! 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3102"><span class='Ref_To_Local'>newBit</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="varlena.c.html#LN3102"><span class='Ref_To_Local'>newBit</span></a> <span class='Operator'>!= </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"new bit must be 0 or 1"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Update the byte. 
     */ 
</span>    <a href="varlena.c.html#LN3104"><span class='Ref_To_Local'>oldByte</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3100"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN3106"><span class='Ref_To_Local'>byteNo</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3102"><span class='Ref_To_Local'>newBit</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN3105"><span class='Ref_To_Local'>newByte</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3104"><span class='Ref_To_Local'>oldByte</span></a> <span class='Operator'>& </span><span class='Parentheses'>(</span><span class='Operator'>~</span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="varlena.c.html#LN3107"><span class='Ref_To_Local'>bitNo</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="varlena.c.html#LN3105"><span class='Ref_To_Local'>newByte</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3104"><span class='Ref_To_Local'>oldByte</span></a> <span class='Operator'>| </span><span class='Parentheses'>(</span><span class='Number'>1</span> <span class='Operator'>&LT;&LT; </span><a href="varlena.c.html#LN3107"><span class='Ref_To_Local'>bitNo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Parentheses'>((</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3100"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>))</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN3106"><span class='Ref_To_Local'>byteNo</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN3105"><span class='Ref_To_Local'>newByte</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3100"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteaSetBit &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* text_name() 
 * Converts a text type to a Name type. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3148"></a><span class='Declare_Function'>text_name</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3150"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3151"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3152"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3152"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3150"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Truncate oversize input */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3152"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT;= </span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN3152"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN530"><span class='Ref_to_Proto'>pg_mbcliplen</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3150"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN3152"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We use palloc0 here to ensure result is zero-padded */ 
</span>    <a href="varlena.c.html#LN3151"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/include/sqlda-native.h.html#LN15"><span class='Ref_to_Const'>NAMEDATALEN</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3151"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3150"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN3152"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN322"><span class='Ref_to_Macro'>PG_RETURN_NAME</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3151"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* name_text() 
 * Converts a Name type to a text type. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3171"></a><span class='Declare_Function'>name_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3173"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3173"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * textToQualifiedNameList - convert a text object to list of names 
 * 
 * This implements the input parsing needed by nextval() and other 
 * functions that take a text parameter representing a qualified name. 
 * We split the name at dots, downcase if not double-quoted, and 
 * truncate names if they're too long. 
 */ 
</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN3188"></a><span class='Declare_Function'>textToQualifiedNameList</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>textval</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3190"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rawname</span><span class='Delimiter'>; 
</span><a name="LN3191"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN3192"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>namelist</span><span class='Delimiter'>; 
</span><a name="LN3193"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>l</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert to C string (handles possible detoasting). */ 
</span>    <span class='Comment_Multi_Line'>/* Note we rely on being able to modify rawname below. */ 
</span>    <a href="varlena.c.html#LN3190"><span class='Ref_To_Local'>rawname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3188"><span class='Ref_to_Parameter'>textval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/utils/varlena.h.html#LN29"><span class='Ref_to_Proto'>SplitIdentifierString</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3190"><span class='Ref_To_Local'>rawname</span></a><span class='Delimiter'>, </span><span class='String'>'.'</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN3192"><span class='Ref_To_Local'>namelist</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid name syntax"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3192"><span class='Ref_To_Local'>namelist</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_NAME<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid name syntax"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3193"><span class='Ref_To_Local'>l</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3192"><span class='Ref_To_Local'>namelist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3211"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curname</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3193"><span class='Ref_To_Local'>l</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN3191"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3191"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="../../nodes/value.c.html#LN51"><span class='Ref_to_Func'>makeString</span></a><span class='Parentheses'>(</span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3211"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3190"><span class='Ref_To_Local'>rawname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN265"><span class='Ref_to_Proto'>list_free</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3192"><span class='Ref_To_Local'>namelist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN3191"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end textToQualifiedNameList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * SplitIdentifierString --- parse a string containing identifiers 
 * 
 * This is the guts of textToQualifiedNameList, and is exported for use in 
 * other situations such as parsing GUC variables.  In the GUC case, it's 
 * important to avoid memory leaks, so the API is designed to minimize the 
 * amount of stuff that needs to be allocated and freed. 
 * 
 * Inputs: 
 *  rawstring: the input string; must be overwritable!  On return, it's 
 *             been modified to contain the separated identifiers. 
 *  separator: the separator punctuation expected between identifiers 
 *             (typically '.' or ',').  Whitespace may also appear around 
 *             identifiers. 
 * Outputs: 
 *  namelist: filled with a palloc'd list of pointers to identifiers within 
 *            rawstring.  Caller should list_free() this even on error return. 
 * 
 * Returns TRUE if okay, FALSE if there is a syntax error in the string. 
 * 
 * Note that an empty string is considered okay here, though not in 
 * textToQualifiedNameList. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN3246"></a><span class='Declare_Function'>SplitIdentifierString</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rawstring</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>separator</span><span class='Delimiter'>, 
</span><a name="LN3247"></a>                      <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>namelist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3249"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nextp</span> <span class='Operator'>= </span><a href="varlena.c.html#LN3246"><span class='Ref_to_Parameter'>rawstring</span></a><span class='Delimiter'>; 
</span><a name="LN3250"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>done</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="varlena.c.html#LN3247"><span class='Ref_to_Parameter'>namelist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Parentheses'>))</span> 
        <a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* skip leading whitespace */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* allow empty string */ 
</span> 
    <span class='Comment_Multi_Line'>/* At the top of the loop, we are at start of a new identifier. */ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3263"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curname</span><span class='Delimiter'>; 
</span><a name="LN3264"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endp</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Quoted name --- collapse quote-quote pairs, no downcasing */ 
</span>            <a href="varlena.c.html#LN3263"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* mismatched quotes */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* found end of quoted name */ 
</span>                <span class='Comment_Multi_Line'>/* Collapse adjacent quotes into one quote, and look again */ 
</span>                <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* endp now points at the terminating quote */ 
</span>            <a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Unquoted name --- extends to separator or whitespace */ 
</span><a name="LN3287"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>downname</span><span class='Delimiter'>; 
</span><a name="LN3288"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN3263"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>&& *</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN3246"><span class='Ref_to_Parameter'>separator</span></a> <span class='Operator'>&& 
</span>                   <span class='Operator'>!</span><a href="../../../include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Parentheses'>))</span> 
                <a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3263"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* empty unquoted name not allowed */ 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Downcase the identifier, using same code as main lexer does. 
             * 
             * XXX because we want to overwrite the input in-place, we cannot 
             * support a downcasing transformation that increases the string 
             * length.  This is not a problem given the current implementation 
             * of downcase_truncate_identifier, but we'll probably have to do 
             * something about this someday. 
             */ 
</span>            <a href="varlena.c.html#LN3288"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN3263"><span class='Ref_To_Local'>curname</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3287"><span class='Ref_To_Local'>downname</span></a> <span class='Operator'>= </span><a href="../../../include/parser/scansup.h.html#LN19"><span class='Ref_to_Proto'>downcase_truncate_identifier</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3263"><span class='Ref_To_Local'>curname</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3288"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="varlena.c.html#LN3287"><span class='Ref_To_Local'>downname</span></a><span class='Parentheses'>) </span><span class='Operator'>&LT;= </span><a href="varlena.c.html#LN3288"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            strncpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN3263"><span class='Ref_To_Local'>curname</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3287"><span class='Ref_To_Local'>downname</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3288"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* strncpy is required here */ 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3287"><span class='Ref_To_Local'>downname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Parentheses'>))</span> 
            <a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* skip trailing whitespace */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN3246"><span class='Ref_to_Parameter'>separator</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Parentheses'>))</span> 
                <a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* skip leading whitespace for next */ 
</span>            <span class='Comment_Multi_Line'>/* we expect another name, so done remains false */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3249"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN3250"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* invalid syntax */ 
</span> 
        <span class='Comment_Multi_Line'>/* Now safe to overwrite separator with a null */ 
</span>        <span class='Operator'>*</span><a href="varlena.c.html#LN3264"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Truncate name if it's overlength */ 
</span>        <a href="../../../include/parser/scansup.h.html#LN25"><span class='Ref_to_Proto'>truncate_identifier</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3263"><span class='Ref_To_Local'>curname</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="varlena.c.html#LN3263"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Finished isolating current name --- add it to list 
         */ 
</span>        <span class='Operator'>*</span><a href="varlena.c.html#LN3247"><span class='Ref_to_Parameter'>namelist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3247"><span class='Ref_to_Parameter'>namelist</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3263"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Loop back if we didn't reach end of string */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN3250"><span class='Ref_To_Local'>done</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SplitIdentifierString &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * SplitDirectoriesString --- parse a string containing directory names 
 * 
 * This is similar to SplitIdentifierString, except that the parsing 
 * rules are meant to handle pathnames instead of identifiers: there is 
 * no downcasing, embedded spaces are allowed, the max length is MAXPGPATH-1, 
 * and we apply canonicalize_path() to each extracted string.  Because of the 
 * last, the returned strings are separately palloc'd rather than being 
 * pointers into rawstring --- but we still scribble on rawstring. 
 * 
 * Inputs: 
 *  rawstring: the input string; must be modifiable! 
 *  separator: the separator punctuation expected between directories 
 *             (typically ',' or ';').  Whitespace may also appear around 
 *             directories. 
 * Outputs: 
 *  namelist: filled with a palloc'd list of directory names. 
 *            Caller should list_free_deep() this even on error return. 
 * 
 * Returns TRUE if okay, FALSE if there is a syntax error in the string. 
 * 
 * Note that an empty string is considered okay here. 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN3371"></a><span class='Declare_Function'>SplitDirectoriesString</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>rawstring</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>separator</span><span class='Delimiter'>, 
</span><a name="LN3372"></a>                       <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>**</span><span class='Declare_Parameter'>namelist</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3374"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nextp</span> <span class='Operator'>= </span><a href="varlena.c.html#LN3371"><span class='Ref_to_Parameter'>rawstring</span></a><span class='Delimiter'>; 
</span><a name="LN3375"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>done</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="varlena.c.html#LN3372"><span class='Ref_to_Parameter'>namelist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Parentheses'>))</span> 
        <a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>                <span class='Comment_Single_Line'>/* skip leading whitespace */ 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* allow empty string */ 
</span> 
    <span class='Comment_Multi_Line'>/* At the top of the loop, we are at start of a new directory. */ 
</span>    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3388"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>curname</span><span class='Delimiter'>; 
</span><a name="LN3389"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>endp</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Quoted name --- collapse quote-quote pairs */ 
</span>            <a href="varlena.c.html#LN3388"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>= </span>strchr<span class='Parentheses'>(</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='String'>'"'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* mismatched quotes */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>                    <span class='Control'>break</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* found end of quoted name */ 
</span>                <span class='Comment_Multi_Line'>/* Collapse adjacent quotes into one quote, and look again */ 
</span>                <a href="../../../include/c.h.html#LN1057"><span class='Ref_to_Macro'>memmove</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Comment_Multi_Line'>/* endp now points at the terminating quote */ 
</span>            <a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Unquoted name --- extends to separator or end of string */ 
</span>            <a href="varlena.c.html#LN3388"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>&& *</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN3371"><span class='Ref_to_Parameter'>separator</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* trailing whitespace should not be included in name */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Parentheses'>))</span> 
                    <a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3388"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* empty unquoted name not allowed */ 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Parentheses'>))</span> 
            <a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>            <span class='Comment_Single_Line'>/* skip trailing whitespace */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN3371"><span class='Ref_to_Parameter'>separator</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/parser/scansup.h.html#LN27"><span class='Ref_to_Proto'>scanner_isspace</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Parentheses'>))</span> 
                <a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a><span class='Operator'>++</span><span class='Delimiter'>;</span>        <span class='Comment_Single_Line'>/* skip leading whitespace for next */ 
</span>            <span class='Comment_Multi_Line'>/* we expect another name, so done remains false */ 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3374"><span class='Ref_To_Local'>nextp</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN3375"><span class='Ref_To_Local'>done</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>;</span>       <span class='Comment_Single_Line'>/* invalid syntax */ 
</span> 
        <span class='Comment_Multi_Line'>/* Now safe to overwrite separator with a null */ 
</span>        <span class='Operator'>*</span><a href="varlena.c.html#LN3389"><span class='Ref_To_Local'>endp</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Truncate path if it's overlength */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="varlena.c.html#LN3388"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a><span class='Parentheses'>)</span> 
            <a href="varlena.c.html#LN3388"><span class='Ref_To_Local'>curname</span></a><span class='Delimiter'>[</span><a href="../../../include/pg_config_manual.h.html#LN88"><span class='Ref_to_Const'>MAXPGPATH</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Finished isolating current name --- add it to list 
         */ 
</span>        <a href="varlena.c.html#LN3388"><span class='Ref_To_Local'>curname</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3388"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/port.h.html#LN42"><span class='Ref_to_Proto'>canonicalize_path</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3388"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><a href="varlena.c.html#LN3372"><span class='Ref_to_Parameter'>namelist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3372"><span class='Ref_to_Parameter'>namelist</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3388"><span class='Ref_To_Local'>curname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Loop back if we didn't reach end of string */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end do &raquo; </span> <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN3375"><span class='Ref_To_Local'>done</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SplitDirectoriesString &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/***************************************************************************** 
 *  Comparison Functions used for bytea 
 * 
 * Note: btree indexes need these routines not to leak memory; therefore, 
 * be careful to free working copies of toasted datums.  Most places don't 
 * need to be so careful. 
 *****************************************************************************/ 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3469"></a><span class='Declare_Function'>byteaeq</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3471"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3472"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3473"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3474"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN3475"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can use a fast path for unequal lengths, which might save us from 
     * having to detoast one or both values. 
     */ 
</span>    <a href="varlena.c.html#LN3474"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3471"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3475"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3472"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3474"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN3475"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN3473"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3487"></a>        <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>barg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3471"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3488"></a>        <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>barg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3472"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN3473"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3487"><span class='Ref_To_Local'>barg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3488"><span class='Ref_To_Local'>barg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="varlena.c.html#LN3474"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3487"><span class='Ref_To_Local'>barg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3488"><span class='Ref_To_Local'>barg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3473"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteaeq &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3501"></a><span class='Declare_Function'>byteane</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3503"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3504"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3505"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3506"></a>    <a href="../../../include/c.h.html#LN355"><span class='Ref_to_Typedef'>Size</span></a>        <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN3507"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We can use a fast path for unequal lengths, which might save us from 
     * having to detoast one or both values. 
     */ 
</span>    <a href="varlena.c.html#LN3506"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3503"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3507"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN220"><span class='Ref_to_Proto'>toast_raw_datum_size</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3504"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3506"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN3507"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN3505"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3519"></a>        <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>barg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3503"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3520"></a>        <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>barg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3504"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN3505"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3519"><span class='Ref_To_Local'>barg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3520"><span class='Ref_To_Local'>barg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="varlena.c.html#LN3506"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3519"><span class='Ref_To_Local'>barg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3520"><span class='Ref_To_Local'>barg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3505"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteane &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3533"></a><span class='Declare_Function'>bytealt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3535"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3536"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3537"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN3538"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span><a name="LN3539"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3537"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3535"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3538"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3536"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3539"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3535"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3536"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3537"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3538"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3535"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3536"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>((</span><a href="varlena.c.html#LN3539"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>|| </span><span class='Parentheses'>((</span><a href="varlena.c.html#LN3539"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN3537"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN3538"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3553"></a><span class='Declare_Function'>byteale</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3555"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3556"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3557"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN3558"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span><a name="LN3559"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3557"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3555"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3558"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3556"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3559"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3555"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3556"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3557"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3558"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3555"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3556"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>((</span><a href="varlena.c.html#LN3559"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>|| </span><span class='Parentheses'>((</span><a href="varlena.c.html#LN3559"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN3557"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&LT;= </span><a href="varlena.c.html#LN3558"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3573"></a><span class='Declare_Function'>byteagt</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3575"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3576"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3577"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN3578"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span><a name="LN3579"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3577"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3575"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3578"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3576"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3579"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3575"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3576"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3577"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3578"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3575"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3576"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>((</span><a href="varlena.c.html#LN3579"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>|| </span><span class='Parentheses'>((</span><a href="varlena.c.html#LN3579"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN3577"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&GT; </span><a href="varlena.c.html#LN3578"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3593"></a><span class='Declare_Function'>byteage</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3595"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3596"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3597"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN3598"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span><a name="LN3599"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3597"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3595"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3598"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3596"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3599"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3595"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3596"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3597"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3598"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3595"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3596"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>((</span><a href="varlena.c.html#LN3599"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> <span class='Operator'>|| </span><span class='Parentheses'>((</span><a href="varlena.c.html#LN3599"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN3597"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN3598"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3613"></a><span class='Declare_Function'>byteacmp</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3615"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg1</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3616"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>arg2</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3617"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len1</span><span class='Delimiter'>, 
</span><a name="LN3618"></a>                <span class='Declare_Local'>len2</span><span class='Delimiter'>; 
</span><a name="LN3619"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>cmp</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3617"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3615"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3618"><span class='Ref_To_Local'>len2</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3616"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3619"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span>memcmp<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3615"><span class='Ref_To_Local'>arg1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3616"><span class='Ref_To_Local'>arg2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/pgtypeslib/numeric.c.html#LN11"><span class='Ref_to_Macro'>Min</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3617"><span class='Ref_To_Local'>len1</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3618"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="varlena.c.html#LN3619"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN3617"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN3618"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>))</span> 
        <a href="varlena.c.html#LN3619"><span class='Ref_To_Local'>cmp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN3617"><span class='Ref_To_Local'>len1</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN3618"><span class='Ref_To_Local'>len2</span></a><span class='Parentheses'>) </span><span class='Operator'>? -</span><span class='Number'>1</span> <span class='Operator'>: </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3615"><span class='Ref_To_Local'>arg1</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN224"><span class='Ref_to_Macro'>PG_FREE_IF_COPY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3616"><span class='Ref_To_Local'>arg2</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3619"><span class='Ref_To_Local'>cmp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end byteacmp &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3635"></a><span class='Declare_Function'>bytea_sortsupport</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3637"></a>    <a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a> <span class='Declare_Local'>ssup</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/sortsupport.h.html#LN57"><span class='Ref_to_Typedef'>SortSupport</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3638"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3638"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3637"><span class='Ref_To_Local'>ssup</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/sortsupport.h.html#LN65"><span class='Ref_to_Member'>ssup_cxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use generic string SortSupport, forcing "C" collation */ 
</span>    <a href="../../../include/utils/varlena.h.html#LN19"><span class='Ref_to_Proto'>varstr_sortsupport</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3637"><span class='Ref_To_Local'>ssup</span></a><span class='Delimiter'>, </span><a href="../../../include/catalog/pg_collation.h.html#LN77"><span class='Ref_to_Const'>C_COLLATION_OID</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3638"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN308"><span class='Ref_to_Macro'>PG_RETURN_VOID</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * appendStringInfoText 
 * 
 * Append a text to str. 
 * Like appendStringInfoString(str, text_to_cstring(t)) but faster. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3657"></a><span class='Declare_Function'>appendStringInfoText</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3657"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3657"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3657"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * replace_text 
 * replace all occurrences of 'old_sub_str' in 'orig_str' 
 * with 'new_sub_str' to form 'new_str' 
 * 
 * returns 'orig_str' if 'old_sub_str' == '' or 'orig_str' == '' 
 * otherwise returns 'new_str' 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN3671"></a><span class='Declare_Function'>replace_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3673"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>src_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3674"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>from_sub_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3675"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>to_sub_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3676"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>src_text_len</span><span class='Delimiter'>; 
</span><a name="LN3677"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>from_sub_text_len</span><span class='Delimiter'>; 
</span><a name="LN3678"></a>    <a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN3679"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ret_text</span><span class='Delimiter'>; 
</span><a name="LN3680"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>start_posn</span><span class='Delimiter'>; 
</span><a name="LN3681"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>curr_posn</span><span class='Delimiter'>; 
</span><a name="LN3682"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>chunk_len</span><span class='Delimiter'>; 
</span><a name="LN3683"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start_ptr</span><span class='Delimiter'>; 
</span><a name="LN3684"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN107"><span class='Ref_to_Proto'>text_position_setup</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3673"><span class='Ref_To_Local'>src_text</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3674"><span class='Ref_To_Local'>from_sub_text</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN3678"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: we check the converted string length, not the original, because 
     * they could be different if the input contained invalid encoding. 
     */ 
</span>    <a href="varlena.c.html#LN3676"><span class='Ref_To_Local'>src_text_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3678"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="varlena.c.html#LN52"><span class='Ref_to_Member'>len1</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3677"><span class='Ref_To_Local'>from_sub_text_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3678"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="varlena.c.html#LN53"><span class='Ref_to_Member'>len2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Return unmodified source string if empty source or pattern */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3676"><span class='Ref_To_Local'>src_text_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span> <span class='Operator'>|| </span><a href="varlena.c.html#LN3677"><span class='Ref_To_Local'>from_sub_text_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3678"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3673"><span class='Ref_To_Local'>src_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="varlena.c.html#LN3680"><span class='Ref_To_Local'>start_posn</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3681"><span class='Ref_To_Local'>curr_posn</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN108"><span class='Ref_to_Proto'>text_position_next</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN3678"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* When the from_sub_text is not found, there is nothing to do. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3681"><span class='Ref_To_Local'>curr_posn</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3678"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3673"><span class='Ref_To_Local'>src_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* start_ptr points to the start_posn'th character of src_text */ 
</span>    <a href="varlena.c.html#LN3683"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3673"><span class='Ref_To_Local'>src_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3684"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* copy the data skipped over by last text_position_next() */ 
</span>        <a href="varlena.c.html#LN3682"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN733"><span class='Ref_to_Func'>charlen_to_bytelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3683"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3681"><span class='Ref_To_Local'>curr_posn</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN3680"><span class='Ref_To_Local'>start_posn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3684"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3683"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3682"><span class='Ref_To_Local'>chunk_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN117"><span class='Ref_to_Proto'>appendStringInfoText</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3684"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3675"><span class='Ref_To_Local'>to_sub_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN3680"><span class='Ref_To_Local'>start_posn</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3681"><span class='Ref_To_Local'>curr_posn</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN3683"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN3682"><span class='Ref_To_Local'>chunk_len</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN3680"><span class='Ref_To_Local'>start_posn</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN3677"><span class='Ref_To_Local'>from_sub_text_len</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN3683"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN733"><span class='Ref_to_Func'>charlen_to_bytelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3683"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3677"><span class='Ref_To_Local'>from_sub_text_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN3681"><span class='Ref_To_Local'>curr_posn</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN108"><span class='Ref_to_Proto'>text_position_next</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3680"><span class='Ref_To_Local'>start_posn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN3678"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3681"><span class='Ref_To_Local'>curr_posn</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* copy trailing data */ 
</span>    <a href="varlena.c.html#LN3682"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN3673"><span class='Ref_To_Local'>src_text</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3673"><span class='Ref_To_Local'>src_text</span></a><span class='Parentheses'>))</span> <span class='Operator'>- </span><a href="varlena.c.html#LN3683"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3684"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3683"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3682"><span class='Ref_To_Local'>chunk_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3678"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3679"><span class='Ref_To_Local'>ret_text</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3684"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3684"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3684"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3679"><span class='Ref_To_Local'>ret_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_text &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * check_replace_text_has_escape_char 
 * 
 * check whether replace_text contains escape char. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN3754"></a><span class='Declare_Function'>check_replace_text_has_escape_char</span><span class='Parentheses'>(</span><span class='Keyword'>const </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>replace_text</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3756"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3754"><span class='Ref_to_Parameter'>replace_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3757"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p_end</span> <span class='Operator'>= </span><a href="varlena.c.html#LN3756"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3754"><span class='Ref_to_Parameter'>replace_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN535"><span class='Ref_to_Proto'>pg_database_encoding_max_length</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN3756"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN3757"><span class='Ref_To_Local'>p_end</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN3756"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3756"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN3756"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN3757"><span class='Ref_To_Local'>p_end</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN3756"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3756"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3756"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end check_replace_text_has_escape_char &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * appendStringInfoRegexpSubstr 
 * 
 * Append replace_text to str, substituting regexp back references for 
 * \n escapes.  start_ptr is the start of the match in the source string, 
 * at logical character position data_pos. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3787"></a><span class='Declare_Function'>appendStringInfoRegexpSubstr</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>replace_text</span><span class='Delimiter'>, 
</span><a name="LN3788"></a>                             <a href="../../../include/regex/regex.h.html#LN82"><span class='Ref_to_Typedef'>regmatch_t</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>pmatch</span><span class='Delimiter'>, 
</span><a name="LN3789"></a>                             <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>start_ptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>data_pos</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3791"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3787"><span class='Ref_to_Parameter'>replace_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3792"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p_end</span> <span class='Operator'>= </span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3787"><span class='Ref_to_Parameter'>replace_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3793"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>eml</span> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN535"><span class='Ref_to_Proto'>pg_database_encoding_max_length</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>;;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3797"></a>        <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>chunk_start</span> <span class='Operator'>= </span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span><a name="LN3798"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>so</span><span class='Delimiter'>; 
</span><a name="LN3799"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>eo</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Find next escape char. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3793"><span class='Ref_To_Local'>eml</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN3792"><span class='Ref_To_Local'>p_end</span></a> <span class='Operator'>&& *</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'\\'</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                 <span class='Comment_Multi_Line'>/* nothing */ </span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN3792"><span class='Ref_To_Local'>p_end</span></a> <span class='Operator'>&& *</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'\\'</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
                 <span class='Comment_Multi_Line'>/* nothing */ </span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Copy the text we just scanned over, if any. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&GT; </span><a href="varlena.c.html#LN3797"><span class='Ref_To_Local'>chunk_start</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3787"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3797"><span class='Ref_To_Local'>chunk_start</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN3797"><span class='Ref_To_Local'>chunk_start</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Done if at end of string, else advance over escape char. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN3792"><span class='Ref_To_Local'>p_end</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN3792"><span class='Ref_To_Local'>p_end</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Escape at very end of input.  Treat same as unexpected char */ 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3787"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>'\\'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&GT;= </span><span class='String'>'1'</span> <span class='Operator'>&& *</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Use the back reference of regexp. */ 
</span><a name="LN3832"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>idx</span> <span class='Operator'>= *</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN3798"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3788"><span class='Ref_to_Parameter'>pmatch</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN3832"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3799"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3788"><span class='Ref_to_Parameter'>pmatch</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN3832"><span class='Ref_To_Local'>idx</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'&'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Use the entire matched string. */ 
</span>            <a href="varlena.c.html#LN3798"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3788"><span class='Ref_to_Parameter'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3799"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3788"><span class='Ref_to_Parameter'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\\'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* \\ means transfer one \ to output. */ 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3787"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>'\\'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3791"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If escape char is not followed by any expected char, just treat 
             * it as ordinary data to copy.  (XXX would it be better to throw 
             * an error?) 
             */ 
</span>            <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3787"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>'\\'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3798"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="varlena.c.html#LN3799"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Copy the text that is back reference of regexp.  Note so and eo 
             * are counted in characters not bytes. 
             */ 
</span><a name="LN3869"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>chunk_start</span><span class='Delimiter'>; 
</span><a name="LN3870"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>chunk_len</span><span class='Delimiter'>; 
</span> 
            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN3798"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN3789"><span class='Ref_to_Parameter'>data_pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3869"><span class='Ref_To_Local'>chunk_start</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3789"><span class='Ref_to_Parameter'>start_ptr</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3869"><span class='Ref_To_Local'>chunk_start</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN733"><span class='Ref_to_Func'>charlen_to_bytelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3869"><span class='Ref_To_Local'>chunk_start</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3798"><span class='Ref_To_Local'>so</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN3789"><span class='Ref_to_Parameter'>data_pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3870"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN733"><span class='Ref_to_Func'>charlen_to_bytelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3869"><span class='Ref_To_Local'>chunk_start</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3799"><span class='Ref_To_Local'>eo</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN3798"><span class='Ref_To_Local'>so</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3787"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3869"><span class='Ref_To_Local'>chunk_start</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3870"><span class='Ref_To_Local'>chunk_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for ;; &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end appendStringInfoRegexpSubstr &raquo; </span> 
 
<a name="LN3881"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>REGEXP_REPLACE_BACKREF_CNT</span>      <span class='Number'>10</span> 
 
<span class='Comment_Multi_Line'>/* 
 * replace_text_regexp 
 * 
 * replace text that matches to regexp in src_text to replace_text. 
 * 
 * Note: to avoid having to include regex.h in builtins.h, we declare 
 * the regexp argument as void *, but really it's regex_t *. 
 */ 
</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN3892"></a><span class='Declare_Function'>replace_text_regexp</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>src_text</span><span class='Delimiter'>, </span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>regexp</span><span class='Delimiter'>, 
</span><a name="LN3893"></a>                    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>replace_text</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>glob</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3895"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>ret_text</span><span class='Delimiter'>; 
</span><a name="LN3896"></a>    <a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>re</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/regex/regex.h.html#LN54"><span class='Ref_to_Typedef'>regex_t</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN3892"><span class='Ref_to_Parameter'>regexp</span></a><span class='Delimiter'>; 
</span><a name="LN3897"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>src_text_len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3892"><span class='Ref_to_Parameter'>src_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3898"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN3899"></a>    <a href="../../../include/regex/regex.h.html#LN82"><span class='Ref_to_Typedef'>regmatch_t</span></a>  <span class='Declare_Local'>pmatch</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN3881"><span class='Ref_to_Const'>REGEXP_REPLACE_BACKREF_CNT</span></a><span class='Delimiter'>]; 
</span><a name="LN3900"></a>    <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>data</span><span class='Delimiter'>; 
</span><a name="LN3901"></a>    size_t      <span class='Declare_Local'>data_len</span><span class='Delimiter'>; 
</span><a name="LN3902"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>search_start</span><span class='Delimiter'>; 
</span><a name="LN3903"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>data_pos</span><span class='Delimiter'>; 
</span><a name="LN3904"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start_ptr</span><span class='Delimiter'>; 
</span><a name="LN3905"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>have_escape</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3898"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Convert data string to wide characters. */ 
</span>    <a href="varlena.c.html#LN3900"><span class='Ref_To_Local'>data</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="varlena.c.html#LN3897"><span class='Ref_To_Local'>src_text_len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3901"><span class='Ref_To_Local'>data_len</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN510"><span class='Ref_to_Proto'>pg_mb2wchar_with_len</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3892"><span class='Ref_to_Parameter'>src_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN3900"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3897"><span class='Ref_To_Local'>src_text_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Check whether replace_text has escape char. */ 
</span>    <a href="varlena.c.html#LN3905"><span class='Ref_To_Local'>have_escape</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3753"><span class='Ref_to_Func'>check_replace_text_has_escape_char</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3893"><span class='Ref_to_Parameter'>replace_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* start_ptr points to the data_pos'th character of src_text */ 
</span>    <a href="varlena.c.html#LN3904"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3892"><span class='Ref_to_Parameter'>src_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN3903"><span class='Ref_To_Local'>data_pos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN3902"><span class='Ref_To_Local'>search_start</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3902"><span class='Ref_To_Local'>search_start</span></a> <span class='Operator'>&LT;= </span><a href="varlena.c.html#LN3901"><span class='Ref_To_Local'>data_len</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3923"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>regexec_result</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN3923"><span class='Ref_To_Local'>regexec_result</span></a> <span class='Operator'>= </span><a href="../../regex/regexec.c.html#LN170"><span class='Ref_to_Func'>pg_regexec</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3896"><span class='Ref_To_Local'>re</span></a><span class='Delimiter'>, 
</span>                                    <a href="varlena.c.html#LN3900"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, 
</span>                                    <a href="varlena.c.html#LN3901"><span class='Ref_To_Local'>data_len</span></a><span class='Delimiter'>, 
</span>                                    <a href="varlena.c.html#LN3902"><span class='Ref_To_Local'>search_start</span></a><span class='Delimiter'>, 
</span>                                    <span class='Null_Value'>NULL</span><span class='Delimiter'>,</span>       <span class='Comment_Single_Line'>/* no details */ 
</span>                                    <a href="varlena.c.html#LN3881"><span class='Ref_to_Const'>REGEXP_REPLACE_BACKREF_CNT</span></a><span class='Delimiter'>, 
</span>                                    <a href="varlena.c.html#LN3899"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>, 
</span>                                    <span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3923"><span class='Ref_To_Local'>regexec_result</span></a> <span class='Operator'>== </span><a href="../../../include/regex/regex.h.html#LN137"><span class='Ref_to_Const'>REG_NOMATCH</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3923"><span class='Ref_To_Local'>regexec_result</span></a> <span class='Operator'>!= </span><a href="../../../include/regex/regex.h.html#LN136"><span class='Ref_to_Const'>REG_OKAY</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3941"></a>            <span class='Keyword'>char</span>        <span class='Declare_Local'>errMsg</span><span class='Delimiter'>[</span><span class='Number'>100</span><span class='Delimiter'>]; 
</span> 
            <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="../../regex/regerror.c.html#LN58"><span class='Ref_to_Func'>pg_regerror</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3923"><span class='Ref_To_Local'>regexec_result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3896"><span class='Ref_To_Local'>re</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3941"><span class='Ref_To_Local'>errMsg</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN3941"><span class='Ref_To_Local'>errMsg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_REGULAR_EXPRESSION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"regular expression failed: %s"</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN3941"><span class='Ref_To_Local'>errMsg</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Copy the text to the left of the match position.  Note we are given 
         * character not byte indexes. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3899"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN3903"><span class='Ref_To_Local'>data_pos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN3956"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>chunk_len</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN3956"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN733"><span class='Ref_to_Func'>charlen_to_bytelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3904"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, 
</span>                                           <a href="varlena.c.html#LN3899"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN3903"><span class='Ref_To_Local'>data_pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3898"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3904"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3956"><span class='Ref_To_Local'>chunk_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Advance start_ptr over that text, to avoid multiple rescans of 
             * it if the replace_text contains multiple back-references. 
             */ 
</span>            <a href="varlena.c.html#LN3904"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN3956"><span class='Ref_To_Local'>chunk_len</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN3903"><span class='Ref_To_Local'>data_pos</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3899"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Copy the replace_text. Process back references when the 
         * replace_text has escape characters. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3905"><span class='Ref_To_Local'>have_escape</span></a><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN3786"><span class='Ref_to_Func'>appendStringInfoRegexpSubstr</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3898"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3893"><span class='Ref_to_Parameter'>replace_text</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3899"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>, 
</span>                                         <a href="varlena.c.html#LN3904"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3903"><span class='Ref_To_Local'>data_pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="varlena.c.html#LN117"><span class='Ref_to_Proto'>appendStringInfoText</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3898"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3893"><span class='Ref_to_Parameter'>replace_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Advance start_ptr and data_pos over the matched text. */ 
</span>        <a href="varlena.c.html#LN3904"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN733"><span class='Ref_to_Func'>charlen_to_bytelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3904"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, 
</span>                                        <a href="varlena.c.html#LN3899"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN3903"><span class='Ref_To_Local'>data_pos</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN3903"><span class='Ref_To_Local'>data_pos</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3899"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * When global option is off, replace the first instance only. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN3893"><span class='Ref_to_Parameter'>glob</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Advance search position.  Normally we start the next search at the 
         * end of the previous match; but if the match was of zero length, we 
         * have to advance by one character, or we'd just find the same match 
         * again. 
         */ 
</span>        <a href="varlena.c.html#LN3902"><span class='Ref_To_Local'>search_start</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN3903"><span class='Ref_To_Local'>data_pos</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3899"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN84"><span class='Ref_to_Member'>rm_so</span></a> <span class='Operator'>== </span><a href="varlena.c.html#LN3899"><span class='Ref_To_Local'>pmatch</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/regex/regex.h.html#LN85"><span class='Ref_to_Member'>rm_eo</span></a><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN3902"><span class='Ref_To_Local'>search_start</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while search_start&LT;=data_le... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * Copy the text to the right of the last match. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN3903"><span class='Ref_To_Local'>data_pos</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN3901"><span class='Ref_To_Local'>data_len</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4007"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>chunk_len</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN4007"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN3892"><span class='Ref_to_Parameter'>src_text</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3892"><span class='Ref_to_Parameter'>src_text</span></a><span class='Parentheses'>))</span> <span class='Operator'>- </span><a href="varlena.c.html#LN3904"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>; 
</span>        <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN3898"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3904"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4007"><span class='Ref_To_Local'>chunk_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="varlena.c.html#LN3895"><span class='Ref_To_Local'>ret_text</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3898"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN3898"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3898"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN3900"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN3895"><span class='Ref_To_Local'>ret_text</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end replace_text_regexp &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * split_text 
 * parse input string 
 * return ord item (1 based) 
 * based on provided field separator 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4027"></a><span class='Declare_Function'>split_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4029"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inputstring</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4030"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fldsep</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4031"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fldnum</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4032"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>inputstring_len</span><span class='Delimiter'>; 
</span><a name="LN4033"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fldsep_len</span><span class='Delimiter'>; 
</span><a name="LN4034"></a>    <a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4035"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>start_posn</span><span class='Delimiter'>; 
</span><a name="LN4036"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>end_posn</span><span class='Delimiter'>; 
</span><a name="LN4037"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result_text</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* field number is 1 based */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4031"><span class='Ref_To_Local'>fldnum</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"field position must be greater than zero"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN107"><span class='Ref_to_Proto'>text_position_setup</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4029"><span class='Ref_To_Local'>inputstring</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4030"><span class='Ref_To_Local'>fldsep</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4034"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Note: we check the converted string length, not the original, because 
     * they could be different if the input contained invalid encoding. 
     */ 
</span>    <a href="varlena.c.html#LN4032"><span class='Ref_To_Local'>inputstring_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4034"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="varlena.c.html#LN52"><span class='Ref_to_Member'>len1</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4033"><span class='Ref_To_Local'>fldsep_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4034"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="varlena.c.html#LN53"><span class='Ref_to_Member'>len2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* return empty string for empty input string */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4032"><span class='Ref_To_Local'>inputstring_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4034"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* empty field separator */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4033"><span class='Ref_To_Local'>fldsep_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4034"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* if first field, return input string, else empty string */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4031"><span class='Ref_To_Local'>fldnum</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4029"><span class='Ref_To_Local'>inputstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* identify bounds of first field */ 
</span>    <a href="varlena.c.html#LN4035"><span class='Ref_To_Local'>start_posn</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4036"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN108"><span class='Ref_to_Proto'>text_position_next</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4034"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* special case if fldsep not found at all */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4036"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4034"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* if field 1 requested, return input string, else empty string */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4031"><span class='Ref_To_Local'>fldnum</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4029"><span class='Ref_To_Local'>inputstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4036"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& --</span><a href="varlena.c.html#LN4031"><span class='Ref_To_Local'>fldnum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* identify bounds of next field */ 
</span>        <a href="varlena.c.html#LN4035"><span class='Ref_To_Local'>start_posn</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4036"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN4033"><span class='Ref_To_Local'>fldsep_len</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4036"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN108"><span class='Ref_to_Proto'>text_position_next</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4035"><span class='Ref_To_Local'>start_posn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4034"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4034"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4031"><span class='Ref_To_Local'>fldnum</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* N'th field separator not found */ 
</span>        <span class='Comment_Multi_Line'>/* if last field requested, return it, else empty string */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4031"><span class='Ref_To_Local'>fldnum</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN4037"><span class='Ref_To_Local'>result_text</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN101"><span class='Ref_to_Proto'>text_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4029"><span class='Ref_To_Local'>inputstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <a href="varlena.c.html#LN4035"><span class='Ref_To_Local'>start_posn</span></a><span class='Delimiter'>, 
</span>                                         <span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="varlena.c.html#LN4037"><span class='Ref_To_Local'>result_text</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* non-last field requested */ 
</span>        <a href="varlena.c.html#LN4037"><span class='Ref_To_Local'>result_text</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN101"><span class='Ref_to_Proto'>text_substring</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4029"><span class='Ref_To_Local'>inputstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                     <a href="varlena.c.html#LN4035"><span class='Ref_To_Local'>start_posn</span></a><span class='Delimiter'>, 
</span>                                     <a href="varlena.c.html#LN4036"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN4035"><span class='Ref_To_Local'>start_posn</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4037"><span class='Ref_To_Local'>result_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end split_text &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convenience function to return true when two text params are equal. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4124"></a><span class='Declare_Function'>text_isequal</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>txt1</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>txt2</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN585"><span class='Ref_to_Macro'>DirectFunctionCall2</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN1636"><span class='Ref_to_Func'>texteq</span></a><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4124"><span class='Ref_to_Parameter'>txt1</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                            <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4124"><span class='Ref_to_Parameter'>txt2</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_to_array 
 * parse input string and return text array of elements, 
 * based on provided field separator 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4137"></a><span class='Declare_Function'>text_to_array</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="varlena.c.html#LN118"><span class='Ref_to_Proto'>text_to_array_internal</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * text_to_array_null 
 * parse input string and return text array of elements, 
 * based on provided field separator and null string 
 * 
 * This is a separate entry point only to prevent the regression tests from 
 * complaining about different argument sets for the same internal function. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4151"></a><span class='Declare_Function'>text_to_array_null</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="varlena.c.html#LN118"><span class='Ref_to_Proto'>text_to_array_internal</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * common code for text_to_array and text_to_array_null functions 
 * 
 * These are not strict so we have to test for null inputs explicitly. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4162"></a><span class='Declare_Function'>text_to_array_internal</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4164"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>inputstring</span><span class='Delimiter'>; 
</span><a name="LN4165"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fldsep</span><span class='Delimiter'>; 
</span><a name="LN4166"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>null_string</span><span class='Delimiter'>; 
</span><a name="LN4167"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>inputstring_len</span><span class='Delimiter'>; 
</span><a name="LN4168"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>fldsep_len</span><span class='Delimiter'>; 
</span><a name="LN4169"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>start_ptr</span><span class='Delimiter'>; 
</span><a name="LN4170"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result_text</span><span class='Delimiter'>; 
</span><a name="LN4171"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>is_null</span><span class='Delimiter'>; 
</span><a name="LN4172"></a>    <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>astate</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* when input string is NULL, then result is NULL too */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4164"><span class='Ref_To_Local'>inputstring</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fldsep can be NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="varlena.c.html#LN4165"><span class='Ref_To_Local'>fldsep</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="varlena.c.html#LN4165"><span class='Ref_To_Local'>fldsep</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* null_string can be NULL or omitted */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>2</span> <span class='Operator'>&& !</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span> 
        <a href="varlena.c.html#LN4166"><span class='Ref_To_Local'>null_string</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="varlena.c.html#LN4166"><span class='Ref_To_Local'>null_string</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4165"><span class='Ref_To_Local'>fldsep</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Normal case with non-null fldsep.  Use the text_position machinery 
         * to search for occurrences of fldsep. 
         */ 
</span><a name="LN4198"></a>        <a href="varlena.c.html#LN45"><span class='Ref_to_Typedef'>TextPositionState</span></a> <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4199"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>fldnum</span><span class='Delimiter'>; 
</span><a name="LN4200"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>start_posn</span><span class='Delimiter'>; 
</span><a name="LN4201"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>end_posn</span><span class='Delimiter'>; 
</span><a name="LN4202"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>chunk_len</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN107"><span class='Ref_to_Proto'>text_position_setup</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4164"><span class='Ref_To_Local'>inputstring</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4165"><span class='Ref_To_Local'>fldsep</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4198"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Note: we check the converted string length, not the original, 
         * because they could be different if the input contained invalid 
         * encoding. 
         */ 
</span>        <a href="varlena.c.html#LN4167"><span class='Ref_To_Local'>inputstring_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4198"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="varlena.c.html#LN52"><span class='Ref_to_Member'>len1</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4168"><span class='Ref_To_Local'>fldsep_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4198"><span class='Ref_To_Local'>state</span></a><span class='Operator'>.</span><a href="varlena.c.html#LN53"><span class='Ref_to_Member'>len2</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* return empty array for empty input string */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4167"><span class='Ref_To_Local'>inputstring_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4198"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * empty field separator: return the input string as a one-element 
         * array 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4168"><span class='Ref_To_Local'>fldsep_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4227"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>elems</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4228"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4229"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>dims</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span><a name="LN4230"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>lbs</span><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
            <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4198"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* single element can be a NULL too */ 
</span>            <a href="varlena.c.html#LN4171"><span class='Ref_To_Local'>is_null</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4166"><span class='Ref_To_Local'>null_string</span></a> <span class='Operator'>? </span><a href="varlena.c.html#LN4123"><span class='Ref_to_Func'>text_isequal</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4164"><span class='Ref_To_Local'>inputstring</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4166"><span class='Ref_To_Local'>null_string</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN4227"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4164"><span class='Ref_To_Local'>inputstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4228"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="varlena.c.html#LN4171"><span class='Ref_To_Local'>is_null</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4229"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4230"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* XXX: this hardcodes assumptions about the text type */ 
</span>            <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN372"><span class='Ref_to_Proto'>construct_md_array</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4227"><span class='Ref_To_Local'>elems</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4228"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                                     <span class='Number'>1</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN4229"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4230"><span class='Ref_To_Local'>lbs</span></a><span class='Delimiter'>, 
</span>                                                   <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fldsep_len&LT;1 &raquo; </span> 
 
        <a href="varlena.c.html#LN4200"><span class='Ref_To_Local'>start_posn</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* start_ptr points to the start_posn'th character of inputstring */ 
</span>        <a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4164"><span class='Ref_To_Local'>inputstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4199"><span class='Ref_To_Local'>fldnum</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;; </span><a href="varlena.c.html#LN4199"><span class='Ref_To_Local'>fldnum</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span>     <span class='Comment_Single_Line'>/* field number is 1 based */ 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN4201"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN108"><span class='Ref_to_Proto'>text_position_next</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4200"><span class='Ref_To_Local'>start_posn</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4198"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4201"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* fetch last field */ 
</span>                <a href="varlena.c.html#LN4202"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>= </span><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN4164"><span class='Ref_To_Local'>inputstring</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN333"><span class='Ref_to_Macro'>VARSIZE_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4164"><span class='Ref_To_Local'>inputstring</span></a><span class='Parentheses'>))</span> <span class='Operator'>- </span><a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* fetch non-last field */ 
</span>                <a href="varlena.c.html#LN4202"><span class='Ref_To_Local'>chunk_len</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN733"><span class='Ref_to_Func'>charlen_to_bytelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4201"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN4200"><span class='Ref_To_Local'>start_posn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* must build a temp text datum to pass to accumArrayResult */ 
</span>            <a href="varlena.c.html#LN4170"><span class='Ref_To_Local'>result_text</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4202"><span class='Ref_To_Local'>chunk_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4171"><span class='Ref_To_Local'>is_null</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4166"><span class='Ref_To_Local'>null_string</span></a> <span class='Operator'>? </span><a href="varlena.c.html#LN4123"><span class='Ref_to_Func'>text_isequal</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4170"><span class='Ref_To_Local'>result_text</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4166"><span class='Ref_To_Local'>null_string</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* stash away this field */ 
</span>            <a href="varlena.c.html#LN4172"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4172"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4170"><span class='Ref_To_Local'>result_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="varlena.c.html#LN4171"><span class='Ref_To_Local'>is_null</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                      <a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4170"><span class='Ref_To_Local'>result_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4201"><span class='Ref_To_Local'>end_posn</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN4200"><span class='Ref_To_Local'>start_posn</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4201"><span class='Ref_To_Local'>end_posn</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN4202"><span class='Ref_To_Local'>chunk_len</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4200"><span class='Ref_To_Local'>start_posn</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN4168"><span class='Ref_To_Local'>fldsep_len</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN733"><span class='Ref_to_Func'>charlen_to_bytelen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4168"><span class='Ref_To_Local'>fldsep_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for fldnum=1;;fldnum++ &raquo; </span> 
 
        <a href="varlena.c.html#LN109"><span class='Ref_to_Proto'>text_position_cleanup</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4198"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if fldsep!=NULL &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * When fldsep is NULL, each character in the inputstring becomes an 
         * element in the result array.  The separator is effectively the 
         * space between characters. 
         */ 
</span>        <a href="varlena.c.html#LN4167"><span class='Ref_To_Local'>inputstring_len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4164"><span class='Ref_To_Local'>inputstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* return empty array for empty input string */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4167"><span class='Ref_To_Local'>inputstring_len</span></a> <span class='Operator'>&LT; </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN378"><span class='Ref_to_Proto'>construct_empty_array</span></a><span class='Parentheses'>(</span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4164"><span class='Ref_To_Local'>inputstring</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4167"><span class='Ref_To_Local'>inputstring_len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4308"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>chunk_len</span> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/miscadmin.h.html#LN99"><span class='Ref_to_Macro'>CHECK_FOR_INTERRUPTS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* must build a temp text datum to pass to accumArrayResult */ 
</span>            <a href="varlena.c.html#LN4170"><span class='Ref_To_Local'>result_text</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4308"><span class='Ref_To_Local'>chunk_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4171"><span class='Ref_To_Local'>is_null</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4166"><span class='Ref_To_Local'>null_string</span></a> <span class='Operator'>? </span><a href="varlena.c.html#LN4123"><span class='Ref_to_Func'>text_isequal</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4170"><span class='Ref_To_Local'>result_text</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4166"><span class='Ref_To_Local'>null_string</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* stash away this field */ 
</span>            <a href="varlena.c.html#LN4172"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4172"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4170"><span class='Ref_To_Local'>result_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <a href="varlena.c.html#LN4171"><span class='Ref_To_Local'>is_null</span></a><span class='Delimiter'>, 
</span>                                      <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, 
</span>                                      <a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4170"><span class='Ref_To_Local'>result_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN4169"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN4308"><span class='Ref_To_Local'>chunk_len</span></a><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4167"><span class='Ref_To_Local'>inputstring_len</span></a> <span class='Operator'>-= </span><a href="varlena.c.html#LN4308"><span class='Ref_To_Local'>chunk_len</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while inputstring_len&GT;0 &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN394"><span class='Ref_to_Proto'>makeArrayResult</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4172"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, 
</span>                                          <a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_to_array_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * array_to_text 
 * concatenate Cstring representation of input array elements 
 * using provided field separator 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4340"></a><span class='Declare_Function'>array_to_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4342"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>v</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4343"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fldsep</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN119"><span class='Ref_to_Proto'>array_to_text_internal</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="varlena.c.html#LN4342"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4343"><span class='Ref_To_Local'>fldsep</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * array_to_text_null 
 * concatenate Cstring representation of input array elements 
 * using provided field separator and null string 
 * 
 * This version is not strict so we have to test for null inputs explicitly. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4356"></a><span class='Declare_Function'>array_to_text_null</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4358"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span><a name="LN4359"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>fldsep</span><span class='Delimiter'>; 
</span><a name="LN4360"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>null_string</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* returns NULL when first or second parameter is NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>|| </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4358"><span class='Ref_To_Local'>v</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4359"><span class='Ref_To_Local'>fldsep</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* NULL null string is passed through as a null pointer */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span> 
        <a href="varlena.c.html#LN4360"><span class='Ref_To_Local'>null_string</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="varlena.c.html#LN4360"><span class='Ref_To_Local'>null_string</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN119"><span class='Ref_to_Proto'>array_to_text_internal</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><a href="varlena.c.html#LN4358"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4359"><span class='Ref_To_Local'>fldsep</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4360"><span class='Ref_To_Local'>null_string</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_to_text_null &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * common code for array_to_text and array_to_text_null functions 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN4382"></a><span class='Declare_Function'>array_to_text_internal</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>v</span><span class='Delimiter'>, 
</span><a name="LN4383"></a>                       <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fldsep</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>null_string</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4385"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4386"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>, 
</span><a name="LN4387"></a>               <span class='Operator'>*</span><span class='Declare_Local'>dims</span><span class='Delimiter'>, 
</span><a name="LN4388"></a>                <span class='Declare_Local'>ndims</span><span class='Delimiter'>; 
</span><a name="LN4389"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span><span class='Delimiter'>; 
</span><a name="LN4390"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span><a name="LN4391"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typbyval</span><span class='Delimiter'>; 
</span><a name="LN4392"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>typalign</span><span class='Delimiter'>; 
</span><a name="LN4393"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN4394"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>printed</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN4395"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN4396"></a>    <a href="../../../include/c.h.html#LN274"><span class='Ref_to_Typedef'>bits8</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bitmap</span><span class='Delimiter'>; 
</span><a name="LN4397"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>bitmask</span><span class='Delimiter'>; 
</span><a name="LN4398"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN4399"></a>    <a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>my_extra</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4388"><span class='Ref_To_Local'>ndims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4387"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4386"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><a href="arrayutils.c.html#LN73"><span class='Ref_to_Func'>ArrayGetNItems</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4388"><span class='Ref_To_Local'>ndims</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4387"><span class='Ref_To_Local'>dims</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if there are no elements, return an empty string */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4386"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4389"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4393"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We arrange to look up info about element type, including its output 
     * conversion proc, only once per series of calls, assuming the element 
     * type doesn't change underneath us. 
     */ 
</span>    <a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Delimiter'>, 
</span>                                                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN216"><span class='Ref_to_Struct'>ArrayMetaState</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN63"><span class='Ref_to_Member'>fn_extra</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= ~</span><a href="varlena.c.html#LN4389"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN4389"><span class='Ref_To_Local'>element_type</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * Get info about element type, including its output conversion proc 
         */ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN139"><span class='Ref_to_Proto'>get_type_io_data</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4389"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN32"><span class='Ref_to_EnumConst'>IOFunc_output</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN222"><span class='Ref_to_Member'>typdelim</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN223"><span class='Ref_to_Member'>typioparam</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN224"><span class='Ref_to_Member'>typiofunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, 
</span>                      <a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN64"><span class='Ref_to_Member'>fn_mcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN218"><span class='Ref_to_Member'>element_type</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4389"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="varlena.c.html#LN4390"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN219"><span class='Ref_to_Member'>typlen</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4391"><span class='Ref_To_Local'>typbyval</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN220"><span class='Ref_to_Member'>typbyval</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4392"><span class='Ref_To_Local'>typalign</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN221"><span class='Ref_to_Member'>typalign</span></a><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4395"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN302"><span class='Ref_to_Macro'>ARR_DATA_PTR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4396"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN280"><span class='Ref_to_Macro'>ARR_NULLBITMAP</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4382"><span class='Ref_to_Parameter'>v</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4397"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4398"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN4398"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN4386"><span class='Ref_To_Local'>nitems</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN4398"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4449"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>itemvalue</span><span class='Delimiter'>; 
</span><a name="LN4450"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get source element, checking for NULL */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4396"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>&& </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN4396"><span class='Ref_To_Local'>bitmap</span></a> <span class='Operator'>& </span><a href="varlena.c.html#LN4397"><span class='Ref_To_Local'>bitmask</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* if null_string is NULL, we just ignore null elements */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4383"><span class='Ref_to_Parameter'>null_string</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4394"><span class='Ref_To_Local'>printed</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4393"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%s%s"</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN4383"><span class='Ref_to_Parameter'>fldsep</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4383"><span class='Ref_to_Parameter'>null_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4393"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4383"><span class='Ref_to_Parameter'>null_string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN4394"><span class='Ref_To_Local'>printed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="varlena.c.html#LN4449"><span class='Ref_To_Local'>itemvalue</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN43"><span class='Ref_to_Macro'>fetch_att</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4395"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4391"><span class='Ref_To_Local'>typbyval</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4390"><span class='Ref_To_Local'>typlen</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4399"><span class='Ref_To_Local'>my_extra</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/array.h.html#LN225"><span class='Ref_to_Member'>proc</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4449"><span class='Ref_To_Local'>itemvalue</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4394"><span class='Ref_To_Local'>printed</span></a><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4393"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"%s%s"</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN4383"><span class='Ref_to_Parameter'>fldsep</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4393"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4394"><span class='Ref_To_Local'>printed</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN4395"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupmacs.h.html#LN171"><span class='Ref_to_Macro'>att_addlength_pointer</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4395"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4390"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4395"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4395"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/access/tupmacs.h.html#LN143"><span class='Ref_to_Macro'>att_align_nominal</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4395"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4392"><span class='Ref_To_Local'>typalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* advance bitmap pointer if any */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4396"><span class='Ref_To_Local'>bitmap</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="varlena.c.html#LN4397"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>&LT;&LT;= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4397"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>== </span><span class='Number'>0x100</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="varlena.c.html#LN4396"><span class='Ref_To_Local'>bitmap</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN4397"><span class='Ref_To_Local'>bitmask</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nitems;i++ &raquo; </span> 
 
    <a href="varlena.c.html#LN4385"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4393"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4393"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4393"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN4385"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end array_to_text_internal &raquo; </span> 
 
<a name="LN4499"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HEXBASE</span> <span class='Number'>16</span> 
<span class='Comment_Multi_Line'>/* 
 * Convert an int32 to a string containing a base 16 (hex) representation of 
 * the number. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4505"></a><span class='Declare_Function'>to_hex32</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4507"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>value</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4508"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN4509"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>digits</span> <span class='Operator'>= </span><span class='String'>"0123456789abcdef"</span><span class='Delimiter'>; 
</span><a name="LN4510"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>];</span>        <span class='Comment_Single_Line'>/* bigger than needed, but reasonable */ 
</span> 
    <a href="varlena.c.html#LN4508"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4510"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN4510"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="varlena.c.html#LN4508"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*--</span><a href="varlena.c.html#LN4508"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4509"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><span class='Keyword'>value </span><span class='Operator'>% </span><a href="varlena.c.html#LN4499"><span class='Ref_to_Const'>HEXBASE</span></a><span class='Delimiter'>]; 
</span>        <span class='Keyword'>value </span><span class='Operator'>/= </span><a href="varlena.c.html#LN4499"><span class='Ref_to_Const'>HEXBASE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4508"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&GT; </span><a href="varlena.c.html#LN4510"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>&& </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4508"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Convert an int64 to a string containing a base 16 (hex) representation of 
 * the number. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4529"></a><span class='Declare_Function'>to_hex64</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4531"></a>    <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>value</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN246"><span class='Ref_to_Macro'>PG_GETARG_INT64</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4532"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ptr</span><span class='Delimiter'>; 
</span><a name="LN4533"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>digits</span> <span class='Operator'>= </span><span class='String'>"0123456789abcdef"</span><span class='Delimiter'>; 
</span><a name="LN4534"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><span class='Number'>32</span><span class='Delimiter'>];</span>        <span class='Comment_Single_Line'>/* bigger than needed, but reasonable */ 
</span> 
    <a href="varlena.c.html#LN4532"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4534"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>+ </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN4534"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="varlena.c.html#LN4532"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>do</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*--</span><a href="varlena.c.html#LN4532"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4533"><span class='Ref_To_Local'>digits</span></a><span class='Delimiter'>[</span><span class='Keyword'>value </span><span class='Operator'>% </span><a href="varlena.c.html#LN4499"><span class='Ref_to_Const'>HEXBASE</span></a><span class='Delimiter'>]; 
</span>        <span class='Keyword'>value </span><span class='Operator'>/= </span><a href="varlena.c.html#LN4499"><span class='Ref_to_Const'>HEXBASE</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4532"><span class='Ref_To_Local'>ptr</span></a> <span class='Operator'>&GT; </span><a href="varlena.c.html#LN4534"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>&& </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4532"><span class='Ref_To_Local'>ptr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create an md5 hash of a text string and return it as hex 
 * 
 * md5 produces a 16 byte (128 bit) hash; double it for hex 
 */ 
</span><a name="LN4553"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>MD5_HASH_LEN</span>  <span class='Number'>32</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4556"></a><span class='Declare_Function'>md5_text</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4558"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>in_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4559"></a>    size_t      <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN4560"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>hexsum</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN4553"><span class='Ref_to_Const'>MD5_HASH_LEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* Calculate the length of the buffer using varlena metadata */ 
</span>    <a href="varlena.c.html#LN4559"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4558"><span class='Ref_To_Local'>in_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* get the hash result */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/common/md5.h.html#LN20"><span class='Ref_to_Proto'>pg_md5_hash</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4558"><span class='Ref_To_Local'>in_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN4559"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4560"><span class='Ref_To_Local'>hexsum</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* convert to text and return it */ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4560"><span class='Ref_To_Local'>hexsum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Create an md5 hash of a bytea field and return it as a hex string: 
 * 16-byte md5 digest is represented in 32 hex characters. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4580"></a><span class='Declare_Function'>md5_bytea</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4582"></a>    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>in</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN271"><span class='Ref_to_Macro'>PG_GETARG_BYTEA_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4583"></a>    size_t      <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN4584"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>hexsum</span><span class='Delimiter'>[</span><a href="varlena.c.html#LN4553"><span class='Ref_to_Const'>MD5_HASH_LEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <a href="varlena.c.html#LN4583"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4582"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/common/md5.h.html#LN20"><span class='Ref_to_Proto'>pg_md5_hash</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4582"><span class='Ref_To_Local'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN4583"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4584"><span class='Ref_To_Local'>hexsum</span></a><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Boolean'>false</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_OUT_OF_MEMORY<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"out of memory"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4584"><span class='Ref_To_Local'>hexsum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Return the size of a datum, possibly compressed 
 * 
 * Works on any data type 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4601"></a><span class='Declare_Function'>pg_column_size</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4603"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4604"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4605"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>typlen</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* On first call, get the input type's typlen, and save at *fn_extra */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Lookup the datatype of the supplied argument */ 
</span><a name="LN4611"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>argtypeid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN4605"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN133"><span class='Ref_to_Proto'>get_typlen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4611"><span class='Ref_To_Local'>argtypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4605"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span>        <span class='Comment_Single_Line'>/* should not happen */ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN4611"><span class='Ref_To_Local'>argtypeid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_mcxt<span class='Delimiter'>, 
</span>                                                      <span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Operator'>*</span><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Parentheses'>)</span> <span class='Operator'>= </span><a href="varlena.c.html#LN4605"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="varlena.c.html#LN4605"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>= *</span><span class='Parentheses'>((</span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Parentheses'>) </span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Operator'>-&GT;</span>fn_extra<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4605"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* varlena type, possibly toasted */ 
</span>        <a href="varlena.c.html#LN4604"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN228"><span class='Ref_to_Proto'>toast_datum_size</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4605"><span class='Ref_To_Local'>typlen</span></a> <span class='Operator'>== -</span><span class='Number'>2</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* cstring */ 
</span>        <a href="varlena.c.html#LN4604"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>))</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* ordinary fixed-width type */ 
</span>        <a href="varlena.c.html#LN4604"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4605"><span class='Ref_To_Local'>typlen</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN313"><span class='Ref_to_Macro'>PG_RETURN_INT32</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4604"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_column_size &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * string_agg - Concatenates values and returns string. 
 * 
 * Syntax: string_agg(value text, delimiter text) RETURNS text 
 * 
 * Note: Any NULL values are ignored. The first-call delimiter isn't 
 * actually used at all, and on subsequent calls the delimiter precedes 
 * the associated value. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* subroutine to initialize state */ 
</span><span class='Keyword'>static </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> 
<a name="LN4655"></a><span class='Declare_Function'>makeStringAggState</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4657"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span><a name="LN4658"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>aggcontext</span><span class='Delimiter'>; 
</span><a name="LN4659"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcontext</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4655"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4658"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"string_agg_transfn called in non-aggregate context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Create state in aggregate context.  It'll stay there across subsequent 
     * calls. 
     */ 
</span>    <a href="varlena.c.html#LN4659"><span class='Ref_To_Local'>oldcontext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4658"><span class='Ref_To_Local'>aggcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4657"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4659"><span class='Ref_To_Local'>oldcontext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN4657"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end makeStringAggState &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4679"></a><span class='Declare_Function'>string_agg_transfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4681"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4681"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Append the value unless null. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* On the first time through, we ignore the delimiter. */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4681"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN4681"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN121"><span class='Ref_to_Proto'>makeStringAggState</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span> 
            <a href="varlena.c.html#LN117"><span class='Ref_to_Proto'>appendStringInfoText</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4681"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>;</span>  <span class='Comment_Single_Line'>/* delimiter */ 
</span> 
        <a href="varlena.c.html#LN117"><span class='Ref_to_Proto'>appendStringInfoText</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4681"><span class='Ref_To_Local'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* value */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * The transition type for string_agg() is declared to be "internal", 
     * which is a pass-by-value type the same size as a pointer. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN320"><span class='Ref_to_Macro'>PG_RETURN_POINTER</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4681"><span class='Ref_To_Local'>state</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end string_agg_transfn &raquo; </span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4705"></a><span class='Declare_Function'>string_agg_finalfn</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4707"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>state</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* cannot be called directly because of internal-type argument */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN695"><span class='Ref_to_Proto'>AggCheckCallContext</span></a><span class='Parentheses'>(</span>fcinfo<span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4707"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='Null_Value'>NULL </span><span class='Operator'>: </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4707"><span class='Ref_To_Local'>state</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4707"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4707"><span class='Ref_To_Local'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Implementation of both concat() and concat_ws(). 
 * 
 * sepstr is the separator string to place between values. 
 * argidx identifies the first argument to concatenate (counting from zero). 
 * Returns NULL if result should be NULL, else text value. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN4728"></a><span class='Declare_Function'>concat_internal</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>sepstr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>argidx</span><span class='Delimiter'>, 
</span><a name="LN4729"></a>                <a href="../../../include/fmgr.h.html#LN37"><span class='Ref_to_Typedef'>FunctionCallInfo</span></a> <span class='Declare_Parameter'>fcinfo</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4731"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4732"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN4733"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>first_arg</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span><a name="LN4734"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * concat(VARIADIC some-array) is essentially equivalent to 
     * array_to_text(), ie concat the array elements with the given separator. 
     * So we just pass the case off to that code. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN667"><span class='Ref_to_Proto'>get_fn_expr_variadic</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4729"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4743"></a>        <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Should have just the one argument */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN4728"><span class='Ref_to_Parameter'>argidx</span></a> <span class='Operator'>== </span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* concat(VARIADIC NULL) is defined as NULL */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4728"><span class='Ref_to_Parameter'>argidx</span></a><span class='Parentheses'>))</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Non-null argument had better be an array.  We assume that any call 
         * context that could let get_fn_expr_variadic return true will have 
         * checked that a VARIADIC-labeled parameter actually is an array.  So 
         * it should be okay to just Assert that it's an array rather than 
         * doing a full-fledged error check. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN160"><span class='Ref_to_Proto'>get_base_element_type</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4729"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4728"><span class='Ref_to_Parameter'>argidx</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* OK, safe to fetch the array value */ 
</span>        <a href="varlena.c.html#LN4743"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4728"><span class='Ref_to_Parameter'>argidx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * And serialize the array.  We tell array_to_text to ignore null 
         * elements, which matches the behavior of the loop below. 
         */ 
</span>        <span class='Control'>return</span> <a href="varlena.c.html#LN119"><span class='Ref_to_Proto'>array_to_text_internal</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4729"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4743"><span class='Ref_To_Local'>arr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4728"><span class='Ref_to_Parameter'>sepstr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if get_fn_expr_variadic(... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Normal case without explicit VARIADIC marker */ 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4732"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4734"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4728"><span class='Ref_to_Parameter'>argidx</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN4734"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; </span><a href="varlena.c.html#LN4734"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4734"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN4778"></a>            <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4734"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4779"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>valtype</span><span class='Delimiter'>; 
</span><a name="LN4780"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typOutput</span><span class='Delimiter'>; 
</span><a name="LN4781"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>typIsVarlena</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* add separator if appropriate */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4733"><span class='Ref_To_Local'>first_arg</span></a><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN4733"><span class='Ref_To_Local'>first_arg</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4732"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4728"><span class='Ref_to_Parameter'>sepstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* call the appropriate type output function, append the result */ 
</span>            <a href="varlena.c.html#LN4779"><span class='Ref_To_Local'>valtype</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4729"><span class='Ref_to_Parameter'>fcinfo</span></a><span class='Operator'>-&GT;</span><a href="../../../include/fmgr.h.html#LN78"><span class='Ref_to_Member'>flinfo</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4734"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4779"><span class='Ref_To_Local'>valtype</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not determine data type of concat() input"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4779"><span class='Ref_To_Local'>valtype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4780"><span class='Ref_To_Local'>typOutput</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4781"><span class='Ref_To_Local'>typIsVarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4732"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4780"><span class='Ref_To_Local'>typOutput</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if !PG_ARGISNULL(i) &raquo; </span> 
    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=argidx;i&LT;PG_NARGS()... &raquo; </span> 
 
    <a href="varlena.c.html#LN4731"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4732"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4732"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4732"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN4731"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end concat_internal &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Concatenate all arguments. NULL arguments are ignored. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4809"></a><span class='Declare_Function'>text_concat</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4811"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4811"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4727"><span class='Ref_to_Func'>concat_internal</span></a><span class='Parentheses'>(</span><span class='String'>""</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4811"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4811"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Concatenate all but first argument value with separators. The first 
 * parameter is used as the separator. NULL arguments are ignored. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4824"></a><span class='Declare_Function'>text_concat_ws</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4826"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>sep</span><span class='Delimiter'>; 
</span><a name="LN4827"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* return NULL when separator is NULL */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4826"><span class='Ref_To_Local'>sep</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4827"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4727"><span class='Ref_to_Func'>concat_internal</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4826"><span class='Ref_To_Local'>sep</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Delimiter'>, </span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4827"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4827"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Return first n characters in the string. When n is negative, 
 * return all but last |n| characters. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4845"></a><span class='Declare_Function'>text_left</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4847"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4848"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4847"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4849"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4847"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4850"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4851"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>rlen</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4850"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN4850"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN529"><span class='Ref_to_Proto'>pg_mbstrlen_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4848"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4849"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="varlena.c.html#LN4850"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4851"><span class='Ref_To_Local'>rlen</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN533"><span class='Ref_to_Proto'>pg_mbcharcliplen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4848"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4849"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4850"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4848"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4851"><span class='Ref_To_Local'>rlen</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Return last n characters in the string. When n is negative, 
 * return all but first |n| characters. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4865"></a><span class='Declare_Function'>text_right</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4867"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4868"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4867"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4869"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4867"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4870"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4871"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>off</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4870"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN4870"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= -</span><a href="varlena.c.html#LN4870"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="varlena.c.html#LN4870"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN529"><span class='Ref_to_Proto'>pg_mbstrlen_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4868"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4869"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="varlena.c.html#LN4870"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4871"><span class='Ref_To_Local'>off</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN533"><span class='Ref_to_Proto'>pg_mbcharcliplen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4868"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4869"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4870"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4868"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN4871"><span class='Ref_To_Local'>off</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4869"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN4871"><span class='Ref_To_Local'>off</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Return reversed string 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4886"></a><span class='Declare_Function'>text_reverse</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4888"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4889"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4888"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4890"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4888"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4891"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>endp</span> <span class='Operator'>= </span><a href="varlena.c.html#LN4889"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><a href="varlena.c.html#LN4890"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span><a name="LN4892"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4893"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dst</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN4892"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4890"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4893"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4892"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><a href="varlena.c.html#LN4890"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4892"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4890"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN535"><span class='Ref_to_Proto'>pg_database_encoding_max_length</span></a><span class='Parentheses'>() </span><span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* multibyte version */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4889"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN4891"><span class='Ref_To_Local'>endp</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4904"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>sz</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN4904"><span class='Ref_To_Local'>sz</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4889"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4893"><span class='Ref_To_Local'>dst</span></a> <span class='Operator'>-= </span><a href="varlena.c.html#LN4904"><span class='Ref_To_Local'>sz</span></a><span class='Delimiter'>; 
</span>            memcpy<span class='Parentheses'>(</span><a href="varlena.c.html#LN4893"><span class='Ref_To_Local'>dst</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4889"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4904"><span class='Ref_To_Local'>sz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4889"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="varlena.c.html#LN4904"><span class='Ref_To_Local'>sz</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* single byte version */ 
</span>        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4889"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN4891"><span class='Ref_To_Local'>endp</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><span class='Parentheses'>(</span><span class='Operator'>--</span><a href="varlena.c.html#LN4893"><span class='Ref_To_Local'>dst</span></a><span class='Parentheses'>) </span><span class='Operator'>= *</span><a href="varlena.c.html#LN4889"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4892"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_reverse &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Support macros for text_format() 
 */ 
</span><a name="LN4926"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>TEXT_FORMAT_FLAG_MINUS</span>  <span class='Number'>0x0001</span>  <span class='Comment_Single_Line'>/* is minus flag present? */ 
</span> 
<a name="LN4928"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>ADVANCE_PARSE_POINTER</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>end_ptr</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>++</span><span class='Parentheses'>(</span><a href="varlena.c.html#LN4928"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;= </span><span class='Parentheses'>(</span><a href="varlena.c.html#LN4928"><span class='Ref_to_Parameter'>end_ptr</span></a><span class='Parentheses'>))</span> <span class='Operator'>\ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unterminated format() type specifier"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"For a single \"%%\" use \"%%%%\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Returns a formatted string 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4941"></a><span class='Declare_Function'>text_format</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4943"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>fmt</span><span class='Delimiter'>; 
</span><a name="LN4944"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN4945"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN4946"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>start_ptr</span><span class='Delimiter'>; 
</span><a name="LN4947"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>end_ptr</span><span class='Delimiter'>; 
</span><a name="LN4948"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4949"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN4950"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>funcvariadic</span><span class='Delimiter'>; 
</span><a name="LN4951"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nargs</span><span class='Delimiter'>; 
</span><a name="LN4952"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elements</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4953"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4954"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>element_type</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN4955"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>prev_type</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN4956"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>prev_width_type</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN4957"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Local'>typoutputfinfo</span><span class='Delimiter'>; 
</span><a name="LN4958"></a>    <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a>    <span class='Declare_Local'>typoutputinfo_width</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* When format string is null, immediately return null */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* If argument is marked VARIADIC, expand array into elements */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN667"><span class='Ref_to_Proto'>get_fn_expr_variadic</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN4967"></a>        <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>arr</span><span class='Delimiter'>; 
</span><a name="LN4968"></a>        <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>elmlen</span><span class='Delimiter'>; 
</span><a name="LN4969"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>elmbyval</span><span class='Delimiter'>; 
</span><a name="LN4970"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>elmalign</span><span class='Delimiter'>; 
</span><a name="LN4971"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>nitems</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Should have just the one argument */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>() </span><span class='Operator'>== </span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If argument is NULL, we treat it as zero-length array */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="varlena.c.html#LN4971"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Non-null argument had better be an array.  We assume that any 
             * call context that could let get_fn_expr_variadic return true 
             * will have checked that a VARIADIC-labeled parameter actually is 
             * an array.  So it should be okay to just Assert that it's an 
             * array rather than doing a full-fledged error check. 
             */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN160"><span class='Ref_to_Proto'>get_base_element_type</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* OK, safe to fetch the array value */ 
</span>            <a href="varlena.c.html#LN4967"><span class='Ref_To_Local'>arr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Get info about array element type */ 
</span>            <a href="varlena.c.html#LN4954"><span class='Ref_To_Local'>element_type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4967"><span class='Ref_To_Local'>arr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4954"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, 
</span>                                 <span class='Operator'>&</span><a href="varlena.c.html#LN4968"><span class='Ref_To_Local'>elmlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4969"><span class='Ref_To_Local'>elmbyval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4970"><span class='Ref_To_Local'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Extract all array elements */ 
</span>            <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4967"><span class='Ref_To_Local'>arr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4954"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4968"><span class='Ref_To_Local'>elmlen</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4969"><span class='Ref_To_Local'>elmbyval</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4970"><span class='Ref_To_Local'>elmalign</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="varlena.c.html#LN4952"><span class='Ref_To_Local'>elements</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4953"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4971"><span class='Ref_To_Local'>nitems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
        <a href="varlena.c.html#LN4951"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4971"><span class='Ref_To_Local'>nitems</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4950"><span class='Ref_To_Local'>funcvariadic</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if get_fn_expr_variadic(... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Non-variadic case, we'll process the arguments individually */ 
</span>        <a href="varlena.c.html#LN4951"><span class='Ref_To_Local'>nargs</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN167"><span class='Ref_to_Macro'>PG_NARGS</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4950"><span class='Ref_To_Local'>funcvariadic</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Setup for main loop. */ 
</span>    <a href="varlena.c.html#LN4943"><span class='Ref_To_Local'>fmt</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4946"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4943"><span class='Ref_To_Local'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4947"><span class='Ref_To_Local'>end_ptr</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4946"><span class='Ref_To_Local'>start_ptr</span></a> <span class='Operator'>+ </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4943"><span class='Ref_To_Local'>fmt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4944"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>;</span>                    <span class='Comment_Single_Line'>/* next argument position to print */ 
</span> 
    <span class='Comment_Multi_Line'>/* Scan format string, looking for conversion specifiers. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4946"><span class='Ref_To_Local'>start_ptr</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN4947"><span class='Ref_To_Local'>end_ptr</span></a><span class='Delimiter'>; </span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5023"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>argpos</span><span class='Delimiter'>; 
</span><a name="LN5024"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>widthpos</span><span class='Delimiter'>; 
</span><a name="LN5025"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>flags</span><span class='Delimiter'>; 
</span><a name="LN5026"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>width</span><span class='Delimiter'>; 
</span><a name="LN5027"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>value</span><span class='Delimiter'>; 
</span><a name="LN5028"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span><span class='Delimiter'>; 
</span><a name="LN5029"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typid</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's not the start of a conversion specifier, just copy it to 
         * the output buffer. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4944"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="varlena.c.html#LN4928"><span class='Ref_to_Macro'>ADVANCE_PARSE_POINTER</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4947"><span class='Ref_To_Local'>end_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Easy case: %% outputs a single % */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'%'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4944"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Parse the optional portions of the format specifier */ 
</span>        <a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN124"><span class='Ref_to_Proto'>text_format_parse_format</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4947"><span class='Ref_To_Local'>end_ptr</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="varlena.c.html#LN5023"><span class='Ref_To_Local'>argpos</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN5024"><span class='Ref_To_Local'>widthpos</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="varlena.c.html#LN5025"><span class='Ref_To_Local'>flags</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN5026"><span class='Ref_To_Local'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Next we should see the main conversion specifier.  Whether or not 
         * an argument position was present, it's known that at least one 
         * character remains in the string at this point.  Experience suggests 
         * that it's worth checking that that character is one of the expected 
         * ones before we try to fetch arguments, so as to produce the least 
         * confusing response to a mis-formatted specifier. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strchr<span class='Parentheses'>(</span><span class='String'>"sIL"</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized format() type specifier \"%c\""</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>*</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"For a single \"%%\" use \"%%%%\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* If indirect width was specified, get its value */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5024"><span class='Ref_To_Local'>widthpos</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Collect the specified or next argument position */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5024"><span class='Ref_To_Local'>widthpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5024"><span class='Ref_To_Local'>widthpos</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN4951"><span class='Ref_To_Local'>nargs</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"too few arguments for format()"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Get the value and type of the selected argument */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN4950"><span class='Ref_To_Local'>funcvariadic</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN5028"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Keyword'>value </span><span class='Operator'>= </span><a href="varlena.c.html#LN4952"><span class='Ref_To_Local'>elements</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <a href="varlena.c.html#LN5028"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4953"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>                <a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4954"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a><span class='Parentheses'>))</span> 
                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not determine data type of format() input"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* We can treat NULL width the same as zero */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5028"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN5026"><span class='Ref_To_Local'>width</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN5026"><span class='Ref_To_Local'>width</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN477"><span class='Ref_to_Macro'>DatumGetInt32</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Parentheses'>) 
</span>                <a href="varlena.c.html#LN5026"><span class='Ref_To_Local'>width</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN449"><span class='Ref_to_Macro'>DatumGetInt16</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* For less-usual datatypes, convert to text then to int */ 
</span><a name="LN5109"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN4956"><span class='Ref_To_Local'>prev_width_type</span></a><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN5113"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoutputfunc</span><span class='Delimiter'>; 
</span><a name="LN5114"></a>                    <span class='Keyword'>bool</span>        <span class='Declare_Local'>typIsVarlena</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN5113"><span class='Ref_To_Local'>typoutputfunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN5114"><span class='Ref_To_Local'>typIsVarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5113"><span class='Ref_To_Local'>typoutputfunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4958"><span class='Ref_To_Local'>typoutputinfo_width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <a href="varlena.c.html#LN4956"><span class='Ref_To_Local'>prev_width_type</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
                <a href="varlena.c.html#LN5109"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4958"><span class='Ref_To_Local'>typoutputinfo_width</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* pg_atoi will complain about bad data or overflow */ 
</span>                <a href="varlena.c.html#LN5026"><span class='Ref_To_Local'>width</span></a> <span class='Operator'>= </span><a href="numutils.c.html#LN35"><span class='Ref_to_Func'>pg_atoi</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5109"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='String'>'\0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5109"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if widthpos&GT;=0 &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* Collect the specified or next argument position */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5023"><span class='Ref_To_Local'>argpos</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5023"><span class='Ref_To_Local'>argpos</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>&GT;= </span><a href="varlena.c.html#LN4951"><span class='Ref_To_Local'>nargs</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"too few arguments for format()"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Get the value and type of the selected argument */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="varlena.c.html#LN4950"><span class='Ref_To_Local'>funcvariadic</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN232"><span class='Ref_to_Macro'>PG_GETARG_DATUM</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN5028"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN663"><span class='Ref_to_Proto'>get_fn_expr_argtype</span></a><span class='Parentheses'>(</span>fcinfo<span class='Operator'>-&GT;</span>flinfo<span class='Delimiter'>, </span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Keyword'>value </span><span class='Operator'>= </span><a href="varlena.c.html#LN4952"><span class='Ref_To_Local'>elements</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <a href="varlena.c.html#LN5028"><span class='Ref_To_Local'>isNull</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4953"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span>            <a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN4954"><span class='Ref_To_Local'>element_type</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"could not determine data type of format() input"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN4949"><span class='Ref_To_Local'>arg</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Get the appropriate typOutput function, reusing previous one if 
         * same type as previous argument.  That's particularly useful in the 
         * variadic-array case, but often saves work even for ordinary calls. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a> <span class='Operator'>!= </span><a href="varlena.c.html#LN4955"><span class='Ref_To_Local'>prev_type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN5163"></a>            <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typoutputfunc</span><span class='Delimiter'>; 
</span><a name="LN5164"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>typIsVarlena</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN5163"><span class='Ref_To_Local'>typoutputfunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN5164"><span class='Ref_To_Local'>typIsVarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/fmgr.h.html#LN92"><span class='Ref_to_Proto'>fmgr_info</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5163"><span class='Ref_To_Local'>typoutputfunc</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4957"><span class='Ref_To_Local'>typoutputfinfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4955"><span class='Ref_To_Local'>prev_type</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5029"><span class='Ref_To_Local'>typid</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * And now we can format the value. 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'s'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'I'</span><span class='Operator'>: 
</span>            <span class='Control'>case</span> <span class='String'>'L'</span><span class='Operator'>: 
</span>                <a href="varlena.c.html#LN128"><span class='Ref_to_Proto'>text_format_string_conversion</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN4944"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN4957"><span class='Ref_To_Local'>typoutputfinfo</span></a><span class='Delimiter'>, 
</span>                                              <span class='Keyword'>value</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN5028"><span class='Ref_To_Local'>isNull</span></a><span class='Delimiter'>, 
</span>                                              <a href="varlena.c.html#LN5025"><span class='Ref_To_Local'>flags</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5026"><span class='Ref_To_Local'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Comment_Multi_Line'>/* should not get here, because of previous check */ 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unrecognized format() type specifier \"%c\""</span><span class='Delimiter'>, 
</span>                                <span class='Operator'>*</span><a href="varlena.c.html#LN4945"><span class='Ref_To_Local'>cp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"For a single \"%%\" use \"%%%%\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for cp=start_ptr;cp&LT;end_p... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Don't need deconstruct_array results anymore. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4952"><span class='Ref_To_Local'>elements</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4952"><span class='Ref_To_Local'>elements</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN4953"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4953"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Generate results. */ 
</span>    <a href="varlena.c.html#LN4948"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4944"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN4944"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4944"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN4948"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_format &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse contiguous digits as a decimal number. 
 * 
 * Returns true if some digits could be parsed. 
 * The value is returned into *value, and *ptr is advanced to the next 
 * character to be parsed. 
 * 
 * Note parsing invariant: at least one character is known available before 
 * string end (end_ptr) at entry, and this is still true at exit. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN5218"></a><span class='Declare_Function'>text_format_parse_digits</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>**</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>end_ptr</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5220"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN5221"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>cp</span> <span class='Operator'>= *</span><a href="varlena.c.html#LN5218"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>; 
</span><a name="LN5222"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>val</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN5221"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>&GT;= </span><span class='String'>'0'</span> <span class='Operator'>&& *</span><a href="varlena.c.html#LN5221"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>&LT;= </span><span class='String'>'9'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5226"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>newval</span> <span class='Operator'>= </span><a href="varlena.c.html#LN5222"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>* </span><span class='Number'>10</span> <span class='Operator'>+ </span><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN5221"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>- </span><span class='String'>'0'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5226"><span class='Ref_To_Local'>newval</span></a> <span class='Operator'>/ </span><span class='Number'>10</span> <span class='Operator'>!= </span><a href="varlena.c.html#LN5222"><span class='Ref_To_Local'>val</span></a><span class='Parentheses'>) </span><span class='Comment_Single_Line'>/* overflow? */ 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number is out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN5222"><span class='Ref_To_Local'>val</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5226"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4928"><span class='Ref_to_Macro'>ADVANCE_PARSE_POINTER</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5221"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5218"><span class='Ref_to_Parameter'>end_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN5220"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Operator'>*</span><a href="varlena.c.html#LN5218"><span class='Ref_to_Parameter'>ptr</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5221"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><span class='Keyword'>value </span><span class='Operator'>= </span><a href="varlena.c.html#LN5222"><span class='Ref_To_Local'>val</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="varlena.c.html#LN5220"><span class='Ref_To_Local'>found</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_format_parse_digits &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Parse a format specifier (generally following the SUS printf spec). 
 * 
 * We have already advanced over the initial '%', and we are looking for 
 * [argpos][flags][width]type (but the type character is not consumed here). 
 * 
 * Inputs are start_ptr (the position after '%') and end_ptr (string end + 1). 
 * Output parameters: 
 *  argpos: argument position for value to be printed.  -1 means unspecified. 
 *  widthpos: argument position for width.  Zero means the argument position 
 *          was unspecified (ie, take the next arg) and -1 means no width 
 *          argument (width was omitted or specified as a constant). 
 *  flags: bitmask of flags. 
 *  width: directly-specified width value.  Zero means the width was omitted 
 *          (note it's not necessary to distinguish this case from an explicit 
 *          zero width value). 
 * 
 * The function result is the next character position to be parsed, ie, the 
 * location where the type character is/should be. 
 * 
 * Note parsing invariant: at least one character is known available before 
 * string end (end_ptr) at entry, and this is still true at exit. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN5267"></a><span class='Declare_Function'>text_format_parse_format</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>start_ptr</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>end_ptr</span><span class='Delimiter'>, 
</span><a name="LN5268"></a>                         <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>argpos</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>widthpos</span><span class='Delimiter'>, 
</span><a name="LN5269"></a>                         <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>flags</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>width</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5271"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>cp</span> <span class='Operator'>= </span><a href="varlena.c.html#LN5267"><span class='Ref_to_Parameter'>start_ptr</span></a><span class='Delimiter'>; 
</span><a name="LN5272"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>n</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* set defaults for output parameters */ 
</span>    <span class='Operator'>*</span><a href="varlena.c.html#LN5268"><span class='Ref_to_Parameter'>argpos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="varlena.c.html#LN5268"><span class='Ref_to_Parameter'>widthpos</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="varlena.c.html#LN5269"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Operator'>*</span><a href="varlena.c.html#LN5269"><span class='Ref_to_Parameter'>width</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* try to identify first number */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN122"><span class='Ref_to_Proto'>text_format_parse_digits</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5267"><span class='Ref_to_Parameter'>end_ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN5272"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'$'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Must be just a width and a type, so we're done */ 
</span>            <span class='Operator'>*</span><a href="varlena.c.html#LN5269"><span class='Ref_to_Parameter'>width</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5272"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Comment_Multi_Line'>/* The number was argument position */ 
</span>        <span class='Operator'>*</span><a href="varlena.c.html#LN5268"><span class='Ref_to_Parameter'>argpos</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5272"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Explicit 0 for argument index is immediately refused */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5272"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"format specifies argument 0, but arguments are numbered from 1"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4928"><span class='Ref_to_Macro'>ADVANCE_PARSE_POINTER</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5267"><span class='Ref_to_Parameter'>end_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Handle flags (only minus is supported now) */ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Operator'>*</span><a href="varlena.c.html#LN5269"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>|= </span><a href="varlena.c.html#LN4926"><span class='Ref_to_Const'>TEXT_FORMAT_FLAG_MINUS</span></a><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN4928"><span class='Ref_to_Macro'>ADVANCE_PARSE_POINTER</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5267"><span class='Ref_to_Parameter'>end_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>== </span><span class='String'>'*'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Handle indirect width */ 
</span>        <a href="varlena.c.html#LN4928"><span class='Ref_to_Macro'>ADVANCE_PARSE_POINTER</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5267"><span class='Ref_to_Parameter'>end_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN122"><span class='Ref_to_Proto'>text_format_parse_digits</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5267"><span class='Ref_to_Parameter'>end_ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN5272"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* number in this position must be closed by $ */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>!= </span><span class='String'>'$'</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                  <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"width argument position must be ended by \"$\""</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* The number was width argument position */ 
</span>            <span class='Operator'>*</span><a href="varlena.c.html#LN5268"><span class='Ref_to_Parameter'>widthpos</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5272"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* Explicit 0 for argument index is immediately refused */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5272"><span class='Ref_To_Local'>n</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"format specifies argument 0, but arguments are numbered from 1"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <a href="varlena.c.html#LN4928"><span class='Ref_to_Macro'>ADVANCE_PARSE_POINTER</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5267"><span class='Ref_to_Parameter'>end_ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Operator'>*</span><a href="varlena.c.html#LN5268"><span class='Ref_to_Parameter'>widthpos</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* width's argument position is unspecified */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if *cp=='*' &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Check for direct width specification */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN122"><span class='Ref_to_Proto'>text_format_parse_digits</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5267"><span class='Ref_to_Parameter'>end_ptr</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="varlena.c.html#LN5272"><span class='Ref_To_Local'>n</span></a><span class='Parentheses'>))</span> 
            <span class='Operator'>*</span><a href="varlena.c.html#LN5269"><span class='Ref_to_Parameter'>width</span></a> <span class='Operator'>= </span><a href="varlena.c.html#LN5272"><span class='Ref_To_Local'>n</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* cp should now be pointing at type character */ 
</span>    <span class='Control'>return</span> <a href="varlena.c.html#LN5271"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_format_parse_format &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Format a %s, %I, or %L conversion 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5344"></a><span class='Declare_Function'>text_format_string_conversion</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Declare_Parameter'>conversion</span><span class='Delimiter'>, 
</span><a name="LN5345"></a>                              <a href="../../../include/fmgr.h.html#LN55"><span class='Ref_to_Struct'>FmgrInfo</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>typOutputInfo</span><span class='Delimiter'>, 
</span><a name="LN5346"></a>                              <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isNull</span><span class='Delimiter'>, 
</span><a name="LN5347"></a>                              <span class='Keyword'>int </span><span class='Declare_Parameter'>flags</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>width</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5349"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Handle NULL arguments before trying to stringify the value. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5346"><span class='Ref_to_Parameter'>isNull</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>conversion</span></a> <span class='Operator'>== </span><span class='String'>'s'</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN132"><span class='Ref_to_Proto'>text_format_append_string</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>""</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>conversion</span></a> <span class='Operator'>== </span><span class='String'>'L'</span><span class='Parentheses'>) 
</span>            <a href="varlena.c.html#LN132"><span class='Ref_to_Proto'>text_format_append_string</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"NULL"</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>conversion</span></a> <span class='Operator'>== </span><span class='String'>'I'</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"null values cannot be formatted as an SQL identifier"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Stringify. */ 
</span>    <a href="varlena.c.html#LN5349"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN646"><span class='Ref_to_Proto'>OutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5345"><span class='Ref_to_Parameter'>typOutputInfo</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Escape. */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>conversion</span></a> <span class='Operator'>== </span><span class='String'>'I'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* quote_identifier may or may not allocate a new string. */ 
</span>        <a href="varlena.c.html#LN132"><span class='Ref_to_Proto'>text_format_append_string</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/builtins.h.html#LN77"><span class='Ref_to_Proto'>quote_identifier</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5349"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>conversion</span></a> <span class='Operator'>== </span><span class='String'>'L'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN5376"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>qstr</span> <span class='Operator'>= </span><a href="quote.c.html#LN100"><span class='Ref_to_Func'>quote_literal_cstr</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5349"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="varlena.c.html#LN132"><span class='Ref_to_Proto'>text_format_append_string</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5376"><span class='Ref_To_Local'>qstr</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* quote_literal_cstr() always allocates a new string */ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5376"><span class='Ref_To_Local'>qstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="varlena.c.html#LN132"><span class='Ref_to_Proto'>text_format_append_string</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5344"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5349"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>flags</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5347"><span class='Ref_to_Parameter'>width</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Cleanup. */ 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5349"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end text_format_string_conversion &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Append str to buf, padding as directed by flags/width 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN5393"></a><span class='Declare_Function'>text_format_append_string</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, 
</span><a name="LN5394"></a>                          <span class='Keyword'>int </span><span class='Declare_Parameter'>flags</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>width</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN5396"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>align_to_left</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN5397"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* fast path for typical easy case */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>width</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5393"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5393"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>width</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Negative width: implicit '-' flag, then take absolute value */ 
</span>        <a href="varlena.c.html#LN5396"><span class='Ref_To_Local'>align_to_left</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* -INT_MIN is undefined */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>width</span></a> <span class='Operator'>&LT;= </span>INT_MIN<span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NUMERIC_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"number is out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>        <a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>width</span></a> <span class='Operator'>= -</span><a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>width</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>flags</span></a> <span class='Operator'>& </span><a href="varlena.c.html#LN4926"><span class='Ref_to_Const'>TEXT_FORMAT_FLAG_MINUS</span></a><span class='Parentheses'>) 
</span>        <a href="varlena.c.html#LN5396"><span class='Ref_To_Local'>align_to_left</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <a href="varlena.c.html#LN5397"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN528"><span class='Ref_to_Proto'>pg_mbstrlen</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5393"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5396"><span class='Ref_To_Local'>align_to_left</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* left justify */ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5393"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5393"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5397"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>width</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN135"><span class='Ref_to_Proto'>appendStringInfoSpaces</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5393"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>width</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN5397"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* right justify */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5397"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&LT; </span><a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>width</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/lib/stringinfo.h.html#LN135"><span class='Ref_to_Proto'>appendStringInfoSpaces</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5393"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5394"><span class='Ref_to_Parameter'>width</span></a> <span class='Operator'>- </span><a href="varlena.c.html#LN5397"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="varlena.c.html#LN5393"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><a href="varlena.c.html#LN5393"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end text_format_append_string &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * text_format_nv - nonvariadic wrapper for text_format function. 
 * 
 * note: this wrapper is necessary to pass the sanity check in opr_sanity, 
 * which checks that all built-in functions that share the implementing C 
 * function take the same number of arguments. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN5445"></a><span class='Declare_Function'>text_format_nv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="varlena.c.html#LN4940"><span class='Ref_to_Func'>text_format</span></a><span class='Parentheses'>(</span>fcinfo<span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Helper function for Levenshtein distance functions. Faster than memcmp(), 
 * for this use case. 
 */ 
</span><span class='Keyword'>static inline bool 
</span><a name="LN5455"></a><span class='Declare_Function'>rest_of_char_same</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s1</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s2</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5455"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="varlena.c.html#LN5455"><span class='Ref_to_Parameter'>len</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="varlena.c.html#LN5455"><span class='Ref_to_Parameter'>s1</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN5455"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="varlena.c.html#LN5455"><span class='Ref_to_Parameter'>s2</span></a><span class='Delimiter'>[</span><a href="varlena.c.html#LN5455"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Expand each Levenshtein distance variant */ 
</span><span class='Keyword'>#include </span><span class='String'>"levenshtein.c"</span> 
<a name="LN5468"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>LEVENSHTEIN_LESS_EQUAL</span> 
<span class='Keyword'>#include </span><span class='String'>"levenshtein.c"</span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>