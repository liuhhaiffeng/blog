<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\adt\xml.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\adt\xml.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:55 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
</span><span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * xml.c 
 *    XML data type support. 
 * 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * src/backend/utils/adt/xml.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Generally, XML type support is only available when libxml use was 
 * configured during the build.  But even if that is not done, the 
 * type and all the functions are available, but most of them will 
 * fail.  For one thing, this avoids having to manage variant catalog 
 * installations.  But it also has nice effects such as that you can 
 * dump a database containing XML type data even if the server is not 
 * linked with libxml.  Thus, make sure xml_out() works even if nothing 
 * else does. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Notes on memory management: 
 * 
 * Sometimes libxml allocates global structures in the hope that it can reuse 
 * them later on.  This makes it impractical to change the xmlMemSetup 
 * functions on-the-fly; that is likely to lead to trying to pfree() chunks 
 * allocated with malloc() or vice versa.  Since libxml might be used by 
 * loadable modules, eg libperl, our only safe choices are to change the 
 * functions at postmaster/backend launch or not at all.  Since we'd rather 
 * not activate libxml in sessions that might never use it, the latter choice 
 * is the preferred one.  However, for debugging purposes it can be awfully 
 * handy to constrain libxml's allocations to be done in a specific palloc 
 * context, where they're easy to track.  Therefore there is code here that 
 * can be enabled in debug builds to redirect libxml's allocations into a 
 * special context LibxmlContext.  It's not recommended to turn this on in 
 * a production build because of the possibility of bad interactions with 
 * external modules. 
 */ 
/* #define USE_LIBXMLCONTEXT */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Directive'>#ifdef</span> USE_LIBXML 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/chvalid.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/parser.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/parserInternals.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/tree.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/uri.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/xmlerror.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/xmlversion.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/xmlwriter.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/xpath.h&GT;</span> 
<span class='Keyword'>#include </span><span class='String'>&LT;libxml/xpathInternals.h&GT;</span> 
 
<span class='Comment_Multi_Line'>/* 
 * We used to check for xmlStructuredErrorContext via a configure test; but 
 * that doesn't work on Windows, so instead use this grottier method of 
 * testing the library version number. 
 */ 
</span><span class='Directive'>#if</span> LIBXML_VERSION <span class='Operator'>&GT;= </span><span class='Number'>20704</span> 
<a name="LN65"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>HAVE_XMLSTRUCTUREDERRORCONTEXT</span> <span class='Number'>1</span> 
<span class='Directive'>#endif</span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_LIBXML */ 
</span> 
<span class='Keyword'>#include </span><span class='String'>"access/htup_details.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/namespace.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_class.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"commands/dbcommands.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/spi.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"executor/tablefunc.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"fmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"lib/stringinfo.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"libpq/pqformat.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"mb/pg_wchar.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/execnodes.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"nodes/nodeFuncs.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/array.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/date.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/datetime.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/lsyscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/xml.h"</span> 
 
 
<span class='Comment_Multi_Line'>/* GUC variables */ 
</span><a name="LN95"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>xmlbinary</span><span class='Delimiter'>; 
</span><a name="LN96"></a><span class='Keyword'>int</span>         <span class='Declare_Var'>xmloption</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> USE_LIBXML 
 
<span class='Comment_Multi_Line'>/* random number to identify PgXmlErrorContext */ 
</span><a name="LN101"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>ERRCXT_MAGIC</span>    <span class='Number'>68275028</span> 
 
<a name="LN103"></a><span class='Control'>struct</span> <span class='Declare_Struct'>PgXmlErrorContext</span> 
<span class='Delimiter'>{ 
</span><a name="LN105"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>magic</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* strictness argument passed to pg_xml_init */ 
</span><a name="LN107"></a>    <a href="../../../include/utils/xml.h.html#LN38"><span class='Ref_to_Typedef'>PgXmlStrictness</span></a> <span class='Declare_Member'>strictness</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* current error status and accumulated message, if any */ 
</span><a name="LN109"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Member'>err_occurred</span><span class='Delimiter'>; 
</span><a name="LN110"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Member'>err_buf</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* previous libxml error handling state (saved by pg_xml_init) */ 
</span><a name="LN112"></a>    xmlStructuredErrorFunc <span class='Declare_Member'>saved_errfunc</span><span class='Delimiter'>; 
</span><a name="LN113"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Member'>saved_errcxt</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* previous libxml entity handler (saved by pg_xml_init) */ 
</span><a name="LN115"></a>    xmlExternalEntityLoader <span class='Declare_Member'>saved_entityfunc</span><span class='Delimiter'>; 
}; 
</span> 
<a name="LN118"></a><span class='Keyword'>static </span>xmlParserInputPtr <span class='Declare_Prototype'>xmlPgEntityLoader</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>URL</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ID</span><span class='Delimiter'>, 
</span><a name="LN119"></a>                  xmlParserCtxtPtr <span class='Declare_Parameter'>ctxt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN120"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>xml_errorHandler</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span>xmlErrorPtr <span class='Declare_Parameter'>error</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN121"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>xml_ereport_by_code</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sqlcode</span><span class='Delimiter'>, 
</span><a name="LN122"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>errcode</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN123"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>chopStringInfoNewlines</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>str</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN124"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>appendStringInfoLineSeparator</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>str</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> USE_LIBXMLCONTEXT 
 
<a name="LN128"></a><span class='Keyword'>static </span><a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Var'>LibxmlContext</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<a name="LN130"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>xml_memory_init</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN131"></a><span class='Keyword'>static void </span><span class='Operator'>*</span><span class='Declare_Prototype'>xml_palloc</span><span class='Parentheses'>(</span>size_t <span class='Declare_Parameter'>size</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN132"></a><span class='Keyword'>static void </span><span class='Operator'>*</span><span class='Declare_Prototype'>xml_repalloc</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>size</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN133"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>xml_pfree</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN134"></a><span class='Keyword'>static char </span><span class='Operator'>*</span><span class='Declare_Prototype'>xml_pstrdup</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_LIBXMLCONTEXT */ 
</span> 
<a name="LN137"></a><span class='Keyword'>static </span>xmlChar <span class='Operator'>*</span><span class='Declare_Prototype'>xml_text2xmlChar</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>in</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN138"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>parse_xml_decl</span><span class='Parentheses'>(</span><span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span>size_t <span class='Operator'>*</span><span class='Declare_Parameter'>lenp</span><span class='Delimiter'>, 
</span><a name="LN139"></a>               xmlChar <span class='Operator'>**</span><span class='Declare_Parameter'>version</span><span class='Delimiter'>, </span>xmlChar <span class='Operator'>**</span><span class='Declare_Parameter'>encoding</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>standalone</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN140"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>print_xml_decl</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Parameter'>version</span><span class='Delimiter'>, 
</span><a name="LN141"></a>               <a href="../../../include/mb/pg_wchar.h.html#LN235"><span class='Ref_to_Enum'>pg_enc</span></a> <span class='Declare_Parameter'>encoding</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>standalone</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN142"></a><span class='Keyword'>static </span>xmlDocPtr <span class='Declare_Prototype'>xml_parse</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1131"><span class='Ref_to_Typedef'>XmlOptionType</span></a> <span class='Declare_Parameter'>xmloption_arg</span><span class='Delimiter'>, 
</span><a name="LN143"></a>          <span class='Keyword'>bool </span><span class='Declare_Parameter'>preserve_whitespace</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>encoding</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN144"></a><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>xml_xmlnodetoxmltype</span><span class='Parentheses'>(</span>xmlNodePtr <span class='Declare_Parameter'>cur</span><span class='Delimiter'>, </span><a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>xmlerrcxt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN145"></a><span class='Keyword'>static int </span><span class='Declare_Prototype'>xml_xpathobjtoxmlarray</span><span class='Parentheses'>(</span>xmlXPathObjectPtr <span class='Declare_Parameter'>xpathobj</span><span class='Delimiter'>, 
</span><a name="LN146"></a>                       <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Delimiter'>, 
</span><a name="LN147"></a>                       <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>xmlerrcxt</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN148"></a><span class='Keyword'>static </span>xmlChar <span class='Operator'>*</span><span class='Declare_Prototype'>pg_xmlCharStrndup</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_LIBXML */ 
</span> 
<a name="LN151"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>xmldata_root_element_start</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>eltname</span><span class='Delimiter'>, 
</span><a name="LN152"></a>                           <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>xmlschema</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Delimiter'>, 
</span><a name="LN153"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>top_level</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN154"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>xmldata_root_element_end</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>eltname</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN155"></a><span class='Keyword'>static </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Prototype'>query_to_xml_internal</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablename</span><span class='Delimiter'>, 
</span><a name="LN156"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>xmlschema</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, 
</span><a name="LN157"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>top_level</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN158"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>map_sql_table_to_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, 
</span><a name="LN159"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN160"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>map_sql_schema_to_xmlschema_types</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nspid</span><span class='Delimiter'>, 
</span><a name="LN161"></a>                                  <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relid_list</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN162"></a>                                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN163"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>map_sql_catalog_to_xmlschema_types</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nspid_list</span><span class='Delimiter'>, 
</span><a name="LN164"></a>                                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, 
</span><a name="LN165"></a>                                   <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN166"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>map_sql_type_to_xml_name</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeoid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>typmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN167"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>map_sql_typecoll_to_xmlschema_types</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tupdesc_list</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN168"></a><span class='Keyword'>static const char </span><span class='Operator'>*</span><span class='Declare_Prototype'>map_sql_type_to_xmlschema_type</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeoid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>typmod</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN169"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>SPI_sql_row_to_xmlelement</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>rownum</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, 
</span><a name="LN170"></a>                          <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablename</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, 
</span><a name="LN171"></a>                          <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>top_level</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Comment_Multi_Line'>/* XMLTABLE support */ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<span class='Comment_Multi_Line'>/* random number to identify XmlTableContext */ 
</span><a name="LN176"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>XMLTABLE_CONTEXT_MAGIC</span>  <span class='Number'>46922182</span> 
<a name="LN177"></a><span class='Control'>typedef</span> <span class='Control'>struct</span> <span class='Declare_Struct'>XmlTableBuilderData</span> 
<span class='Delimiter'>{ 
</span><a name="LN179"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>magic</span><span class='Delimiter'>; 
</span><a name="LN180"></a>    <span class='Keyword'>int</span>         <span class='Declare_Member'>natts</span><span class='Delimiter'>; 
</span><a name="LN181"></a>    <span class='Keyword'>long int</span>    <span class='Declare_Member'>row_count</span><span class='Delimiter'>; 
</span><a name="LN182"></a>    <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Member'>xmlerrcxt</span><span class='Delimiter'>; 
</span><a name="LN183"></a>    xmlParserCtxtPtr <span class='Declare_Member'>ctxt</span><span class='Delimiter'>; 
</span><a name="LN184"></a>    xmlDocPtr   <span class='Declare_Member'>doc</span><span class='Delimiter'>; 
</span><a name="LN185"></a>    xmlXPathContextPtr <span class='Declare_Member'>xpathcxt</span><span class='Delimiter'>; 
</span><a name="LN186"></a>    xmlXPathCompExprPtr <span class='Declare_Member'>xpathcomp</span><span class='Delimiter'>; 
</span><a name="LN187"></a>    xmlXPathObjectPtr <span class='Declare_Member'>xpathobj</span><span class='Delimiter'>; 
</span><a name="LN188"></a>    xmlXPathCompExprPtr <span class='Operator'>*</span><span class='Declare_Member'>xpathscomp</span><span class='Delimiter'>; 
</span><a name="LN189"></a>} <span class='Declare_Typedef'>XmlTableBuilderData</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
<a name="LN192"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>XmlTableInitOpaque</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>natts</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN193"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>XmlTableSetDocument</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN194"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>XmlTableSetNamespace</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, 
</span><a name="LN195"></a>                     <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>uri</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN196"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>XmlTableSetRowFilter</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN197"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>XmlTableSetColumnFilter</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, 
</span><a name="LN198"></a>                        <span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>colnum</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN199"></a><span class='Keyword'>static bool </span><span class='Declare_Prototype'>XmlTableFetchRow</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN200"></a><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Prototype'>XmlTableGetValue</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>colnum</span><span class='Delimiter'>, 
</span><a name="LN201"></a>                 <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN202"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>XmlTableDestroyOpaque</span><span class='Parentheses'>(</span><span class='Control'>struct</span> <a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<a name="LN204"></a><span class='Keyword'>const </span><a href="../../../include/executor/tablefunc.h.html#LN51"><span class='Ref_to_Struct'>TableFuncRoutine</span></a> <span class='Declare_Var'>XmlTableRoutine</span> <span class='Operator'>= 
</span><span class='Delimiter'>{ 
</span>    <a href="xml.c.html#LN192"><span class='Ref_to_Proto'>XmlTableInitOpaque</span></a><span class='Delimiter'>, 
</span>    <a href="xml.c.html#LN193"><span class='Ref_to_Proto'>XmlTableSetDocument</span></a><span class='Delimiter'>, 
</span>    <a href="xml.c.html#LN194"><span class='Ref_to_Proto'>XmlTableSetNamespace</span></a><span class='Delimiter'>, 
</span>    <a href="xml.c.html#LN196"><span class='Ref_to_Proto'>XmlTableSetRowFilter</span></a><span class='Delimiter'>, 
</span>    <a href="xml.c.html#LN197"><span class='Ref_to_Proto'>XmlTableSetColumnFilter</span></a><span class='Delimiter'>, 
</span>    <a href="xml.c.html#LN199"><span class='Ref_to_Proto'>XmlTableFetchRow</span></a><span class='Delimiter'>, 
</span>    <a href="xml.c.html#LN200"><span class='Ref_to_Proto'>XmlTableGetValue</span></a><span class='Delimiter'>, 
</span>    <a href="xml.c.html#LN202"><span class='Ref_to_Proto'>XmlTableDestroyOpaque</span></a> 
<span class='Delimiter'>}; 
</span> 
<a name="LN216"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>NO_XML_SUPPORT</span><span class='Parentheses'>() </span><span class='Operator'>\ 
</span>    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"unsupported XML feature"</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>             <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"This functionality requires the server to be built with libxml support."</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>             <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"You need to rebuild PostgreSQL using --with-libxml."</span><span class='Parentheses'>)))</span> 
 
 
<span class='Comment_Multi_Line'>/* from SQL/XML:2008 section 4.9 */ 
</span><a name="LN225"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NAMESPACE_XSD</span> <span class='String'>"http://www.w3.org/2001/XMLSchema"</span> 
<a name="LN226"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NAMESPACE_XSI</span> <span class='String'>"http://www.w3.org/2001/XMLSchema-instance"</span> 
<a name="LN227"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>NAMESPACE_SQLXML</span> <span class='String'>"http://standards.iso.org/iso/9075/2003/sqlxml"</span> 
 
 
<span class='Directive'>#ifdef</span> USE_LIBXML 
 
<span class='Keyword'>static int 
</span><a name="LN233"></a><span class='Declare_Function'>xmlChar_to_encoding</span><span class='Parentheses'>(</span><span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Parameter'>encoding_name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN235"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>encoding</span> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN501"><span class='Ref_to_Proto'>pg_char_to_encoding</span></a><span class='Parentheses'>((</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN233"><span class='Ref_to_Parameter'>encoding_name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN235"><span class='Ref_To_Local'>encoding</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_PARAMETER_VALUE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid encoding name \"%s\""</span><span class='Delimiter'>, 
</span>                        <span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN233"><span class='Ref_to_Parameter'>encoding_name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="xml.c.html#LN235"><span class='Ref_To_Local'>encoding</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * xml_in uses a plain C string to VARDATA conversion, so for the time being 
 * we use the conversion function for the text datatype. 
 * 
 * This is only acceptable so long as xmltype and text use the same 
 * representation. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN255"></a><span class='Declare_Function'>xml_in</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN258"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>s</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN241"><span class='Ref_to_Macro'>PG_GETARG_CSTRING</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN259"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>vardata</span><span class='Delimiter'>; 
</span><a name="LN260"></a>    xmlDocPtr   <span class='Declare_Local'>doc</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN259"><span class='Ref_To_Local'>vardata</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN258"><span class='Ref_To_Local'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the data to check if it is well-formed XML data.  Assume that 
     * ERROR occurred if parsing failed. 
     */ 
</span>    <a href="xml.c.html#LN260"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN142"><span class='Ref_to_Proto'>xml_parse</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN259"><span class='Ref_To_Local'>vardata</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN96"><span class='Ref_to_Global_Var'>xmloption</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN260"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN259"><span class='Ref_To_Local'>vardata</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end xml_in &raquo; </span> 
 
 
<a name="LN279"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>PG_XML_DEFAULT_VERSION</span> <span class='String'>"1.0"</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * xml_out_internal uses a plain VARDATA to C string conversion, so for the 
 * time being we use the conversion function for the text datatype. 
 * 
 * This is only acceptable so long as xmltype and text use the same 
 * representation. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN290"></a><span class='Declare_Function'>xml_out_internal</span><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>x</span><span class='Delimiter'>, </span><a href="../../../include/mb/pg_wchar.h.html#LN235"><span class='Ref_to_Enum'>pg_enc</span></a> <span class='Declare_Parameter'>target_encoding</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN292"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>((</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN290"><span class='Ref_to_Parameter'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN295"></a>    size_t      <span class='Declare_Local'>len</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN292"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN296"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>version</span><span class='Delimiter'>; 
</span><a name="LN297"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>standalone</span><span class='Delimiter'>; 
</span><a name="LN298"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_code</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="xml.c.html#LN298"><span class='Ref_To_Local'>res_code</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN138"><span class='Ref_to_Proto'>parse_xml_decl</span></a><span class='Parentheses'>((</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN292"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>                                   <span class='Operator'>&</span><a href="xml.c.html#LN295"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN296"><span class='Ref_To_Local'>version</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN297"><span class='Ref_To_Local'>standalone</span></a><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span><a name="LN303"></a>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
        <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN303"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN140"><span class='Ref_to_Proto'>print_xml_decl</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN303"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN296"><span class='Ref_To_Local'>version</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN290"><span class='Ref_to_Parameter'>target_encoding</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN297"><span class='Ref_To_Local'>standalone</span></a><span class='Parentheses'>))</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * If we are not going to produce an XML declaration, eat a single 
             * newline in the original string to prevent empty first lines in 
             * the output. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="xml.c.html#LN292"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>+ </span><a href="xml.c.html#LN295"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>)</span> 
                <a href="xml.c.html#LN295"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN303"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN292"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>+ </span><a href="xml.c.html#LN295"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN292"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="xml.c.html#LN303"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (res_code=parse_xml_d... &raquo; </span> 
 
    <a href="xml.c.html#LN121"><span class='Ref_to_Proto'>xml_ereport_by_code</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>, 
</span>                        <span class='String'>"could not parse XML declaration in stored value"</span><span class='Delimiter'>, 
</span>                        <a href="xml.c.html#LN298"><span class='Ref_To_Local'>res_code</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN292"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end xml_out_internal &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN333"></a><span class='Declare_Function'>xml_out</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN335"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>x</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * xml_out removes the encoding property in all cases.  This is because we 
     * cannot control from here whether the datum will be converted to a 
     * different client encoding, so we'd do more harm than good by including 
     * it. 
     */ 
</span>    <a href="../../../include/fmgr.h.html#LN321"><span class='Ref_to_Macro'>PG_RETURN_CSTRING</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN289"><span class='Ref_to_Func'>xml_out_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN335"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN348"></a><span class='Declare_Function'>xml_recv</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN351"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a><span class='Parentheses'>) </span><a href="../../../include/fmgr.h.html#LN240"><span class='Ref_to_Macro'>PG_GETARG_POINTER</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN352"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN353"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN354"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>newstr</span><span class='Delimiter'>; 
</span><a name="LN355"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nbytes</span><span class='Delimiter'>; 
</span><a name="LN356"></a>    xmlDocPtr   <span class='Declare_Local'>doc</span><span class='Delimiter'>; 
</span><a name="LN357"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>encodingStr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN358"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>encoding</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Read the data in raw format. We don't know yet what the encoding is, as 
     * that information is embedded in the xml declaration; so we have to 
     * parse that before converting to server encoding. 
     */ 
</span>    <a href="xml.c.html#LN355"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN351"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><a href="xml.c.html#LN351"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN39"><span class='Ref_to_Member'>cursor</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN353"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/libpq/pqformat.h.html#LN42"><span class='Ref_to_Proto'>pq_getmsgbytes</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN351"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN355"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We need a null-terminated string to pass to parse_xml_decl().  Rather 
     * than make a separate copy, make the temporary result one byte bigger 
     * than it needs to be. 
     */ 
</span>    <a href="xml.c.html#LN352"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN355"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+ </span><span class='Number'>1</span> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/postgres.h.html#LN327"><span class='Ref_to_Macro'>SET_VARSIZE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN352"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN355"><span class='Ref_To_Local'>nbytes</span></a> <span class='Operator'>+ </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN352"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="xml.c.html#LN353"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN355"><span class='Ref_To_Local'>nbytes</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN353"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN352"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN353"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN355"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN138"><span class='Ref_to_Proto'>parse_xml_decl</span></a><span class='Parentheses'>((</span><span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN353"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN357"><span class='Ref_To_Local'>encodingStr</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If encoding wasn't explicitly specified in the XML header, treat it as 
     * UTF-8, as that's the default in XML. This is different from xml_in(), 
     * where the input has to go through the normal client to server encoding 
     * conversion. 
     */ 
</span>    <a href="xml.c.html#LN358"><span class='Ref_To_Local'>encoding</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN357"><span class='Ref_To_Local'>encodingStr</span></a> <span class='Operator'>? </span><a href="xml.c.html#LN232"><span class='Ref_to_Func'>xmlChar_to_encoding</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN357"><span class='Ref_To_Local'>encodingStr</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Parse the data to check if it is well-formed XML data.  Assume that 
     * xml_parse will throw ERROR if not. 
     */ 
</span>    <a href="xml.c.html#LN356"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN142"><span class='Ref_to_Proto'>xml_parse</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN352"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN96"><span class='Ref_to_Global_Var'>xmloption</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="xml.c.html#LN358"><span class='Ref_To_Local'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN356"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now that we know what we're dealing with, convert to server encoding */ 
</span>    <a href="xml.c.html#LN354"><span class='Ref_To_Local'>newstr</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN566"><span class='Ref_to_Proto'>pg_any_to_server</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN353"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN355"><span class='Ref_To_Local'>nbytes</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN358"><span class='Ref_To_Local'>encoding</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN354"><span class='Ref_To_Local'>newstr</span></a> <span class='Operator'>!= </span><a href="xml.c.html#LN353"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN352"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN352"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN354"><span class='Ref_To_Local'>newstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN354"><span class='Ref_To_Local'>newstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN352"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end xml_recv &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN415"></a><span class='Declare_Function'>xml_send</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN417"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>x</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN418"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>outval</span><span class='Delimiter'>; 
</span><a name="LN419"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * xml_out_internal doesn't convert the encoding, it just prints the right 
     * declaration. pq_sendtext will do the conversion. 
     */ 
</span>    <a href="xml.c.html#LN418"><span class='Ref_To_Local'>outval</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN289"><span class='Ref_to_Func'>xml_out_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN417"><span class='Ref_To_Local'>x</span></a><span class='Delimiter'>, </span><a href="../mb/mbutils.c.html#LN315"><span class='Ref_to_Func'>pg_get_client_encoding</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/libpq/pqformat.h.html#LN31"><span class='Ref_to_Proto'>pq_begintypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN419"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/libpq/pqformat.h.html#LN22"><span class='Ref_to_Proto'>pq_sendtext</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN419"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN418"><span class='Ref_To_Local'>outval</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN418"><span class='Ref_To_Local'>outval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN418"><span class='Ref_To_Local'>outval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/fmgr.h.html#LN328"><span class='Ref_to_Macro'>PG_RETURN_BYTEA_P</span></a><span class='Parentheses'>(</span><a href="../../../include/libpq/pqformat.h.html#LN32"><span class='Ref_to_Proto'>pq_endtypsend</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN419"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Directive'>#ifdef</span> USE_LIBXML 
<span class='Keyword'>static void 
</span><a name="LN436"></a><span class='Declare_Function'>appendStringInfoText</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span><span class='Keyword'>const </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>t</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN436"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN436"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN436"><span class='Ref_to_Parameter'>t</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
 
<span class='Keyword'>static </span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>* 
</span><a name="LN444"></a><span class='Declare_Function'>stringinfo_to_xmltype</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN444"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN444"><span class='Ref_to_Parameter'>buf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static </span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>* 
</span><a name="LN451"></a><span class='Declare_Function'>cstring_to_xmltype</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN451"><span class='Ref_to_Parameter'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Directive'>#ifdef</span> USE_LIBXML 
<span class='Keyword'>static </span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>* 
</span><a name="LN459"></a><span class='Declare_Function'>xmlBuffer_to_xmltype</span><span class='Parentheses'>(</span>xmlBufferPtr <span class='Declare_Parameter'>buf</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/builtins.h.html#LN86"><span class='Ref_to_Proto'>cstring_to_text_with_len</span></a><span class='Parentheses'>((</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) </span>xmlBufferContent<span class='Parentheses'>(</span><a href="xml.c.html#LN459"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                xmlBufferLength<span class='Parentheses'>(</span><a href="xml.c.html#LN459"><span class='Ref_to_Parameter'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN468"></a><span class='Declare_Function'>xmlcomment</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN471"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN472"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>argdata</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN471"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN473"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>len</span> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN471"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN474"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN475"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* check for "--" in string or "-" at the end */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN475"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="xml.c.html#LN475"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="xml.c.html#LN473"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN475"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN472"><span class='Ref_To_Local'>argdata</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN475"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>&& </span><a href="xml.c.html#LN472"><span class='Ref_To_Local'>argdata</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN475"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_XML_COMMENT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid XML comment"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN473"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="xml.c.html#LN472"><span class='Ref_To_Local'>argdata</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN473"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'-'</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_XML_COMMENT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid XML comment"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN474"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN474"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;!--"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="varlena.c.html#LN117"><span class='Ref_to_Proto'>appendStringInfoText</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN474"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN471"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN474"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"--&GT;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN474"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end xmlcomment &raquo; </span> 
 
 
 
<span class='Comment_Multi_Line'>/* 
 * TODO: xmlconcat needs to merge the notations and unparsed entities 
 * of the argument values.  Not very important in practice, though. 
 */ 
</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>* 
</span><a name="LN509"></a><span class='Declare_Function'>xmlconcat</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>args</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN512"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>global_standalone</span> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN513"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>global_version</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN514"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>global_version_no_value</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN515"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN516"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>v</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN515"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN516"><span class='Ref_To_Local'>v</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN509"><span class='Ref_to_Parameter'>args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN521"></a>        <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>x</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN49"><span class='Ref_to_Macro'>DatumGetXmlP</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN516"><span class='Ref_To_Local'>v</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span><a name="LN522"></a>        size_t      <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN523"></a>        xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>version</span><span class='Delimiter'>; 
</span><a name="LN524"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>standalone</span><span class='Delimiter'>; 
</span><a name="LN525"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN522"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN521"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN525"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>((</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN521"><span class='Ref_To_Local'>x</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN138"><span class='Ref_to_Proto'>parse_xml_decl</span></a><span class='Parentheses'>((</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN525"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN522"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN523"><span class='Ref_To_Local'>version</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN524"><span class='Ref_To_Local'>standalone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN524"><span class='Ref_To_Local'>standalone</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="xml.c.html#LN512"><span class='Ref_To_Local'>global_standalone</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN512"><span class='Ref_To_Local'>global_standalone</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN524"><span class='Ref_To_Local'>standalone</span></a> <span class='Operator'>&LT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN512"><span class='Ref_To_Local'>global_standalone</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN523"><span class='Ref_To_Local'>version</span></a><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN514"><span class='Ref_To_Local'>global_version_no_value</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN513"><span class='Ref_To_Local'>global_version</span></a><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN513"><span class='Ref_To_Local'>global_version</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN523"><span class='Ref_To_Local'>version</span></a><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlStrcmp<span class='Parentheses'>(</span><a href="xml.c.html#LN523"><span class='Ref_To_Local'>version</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN513"><span class='Ref_To_Local'>global_version</span></a><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="xml.c.html#LN514"><span class='Ref_To_Local'>global_version_no_value</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN515"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN525"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>+ </span><a href="xml.c.html#LN522"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN525"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN514"><span class='Ref_To_Local'>global_version_no_value</span></a> <span class='Operator'>|| </span><a href="xml.c.html#LN512"><span class='Ref_To_Local'>global_standalone</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN550"></a>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf2</span><span class='Delimiter'>; 
</span> 
        <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN550"><span class='Ref_To_Local'>buf2</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN140"><span class='Ref_to_Proto'>print_xml_decl</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN550"><span class='Ref_To_Local'>buf2</span></a><span class='Delimiter'>, 
</span>                       <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN514"><span class='Ref_To_Local'>global_version_no_value</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="xml.c.html#LN513"><span class='Ref_To_Local'>global_version</span></a> <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                       <span class='Number'>0</span><span class='Delimiter'>, 
</span>                       <a href="xml.c.html#LN512"><span class='Ref_To_Local'>global_standalone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN550"><span class='Ref_To_Local'>buf2</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN515"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN515"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN550"><span class='Ref_To_Local'>buf2</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN515"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end xmlconcat &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * XMLAGG support 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN575"></a><span class='Declare_Function'>xmlconcat2</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
            <a href="../../../include/fmgr.h.html#LN304"><span class='Ref_to_Macro'>PG_RETURN_NULL</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN173"><span class='Ref_to_Macro'>PG_ARGISNULL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN62"><span class='Ref_to_Proto'>xmlconcat</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN139"><span class='Ref_to_Macro'>list_make2</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>))))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN593"></a><span class='Declare_Function'>texttoxml</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN595"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN66"><span class='Ref_to_Proto'>xmlparse</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN595"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN96"><span class='Ref_to_Global_Var'>xmloption</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN602"></a><span class='Declare_Function'>xmltotext</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN604"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* It's actually binary compatible. */ 
</span>    <a href="../../../include/fmgr.h.html#LN329"><span class='Ref_to_Macro'>PG_RETURN_TEXT_P</span></a><span class='Parentheses'>((</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN604"><span class='Ref_To_Local'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN612"></a><span class='Declare_Function'>xmltotext_with_xmloption</span><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1131"><span class='Ref_to_Typedef'>XmlOptionType</span></a> <span class='Declare_Parameter'>xmloption_arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN612"><span class='Ref_to_Parameter'>xmloption_arg</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN1133"><span class='Ref_to_EnumConst'>XMLOPTION_DOCUMENT</span></a> <span class='Operator'>&& !</span><a href="../../../include/utils/xml.h.html#LN69"><span class='Ref_to_Proto'>xml_is_document</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN612"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>))</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NOT_AN_XML_DOCUMENT<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"not an XML document"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* It's actually binary compatible, save for the above check. */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN612"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>* 
</span><a name="LN625"></a><span class='Declare_Function'>xmlelement</span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN1137"><span class='Ref_to_Struct'>XmlExpr</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>xexpr</span><span class='Delimiter'>, 
</span><a name="LN626"></a>           <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>named_argvalue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>named_argnull</span><span class='Delimiter'>, 
</span><a name="LN627"></a>           <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>argvalue</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>argnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN630"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN631"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>named_arg_strings</span><span class='Delimiter'>; 
</span><a name="LN632"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>arg_strings</span><span class='Delimiter'>; 
</span><a name="LN633"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN634"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>arg</span><span class='Delimiter'>; 
</span><a name="LN635"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>narg</span><span class='Delimiter'>; 
</span><a name="LN636"></a>    <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xmlerrcxt</span><span class='Delimiter'>; 
</span><a name="LN637"></a>    <span class='Keyword'>volatile </span>xmlBufferPtr <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN638"></a>    <span class='Keyword'>volatile </span>xmlTextWriterPtr <span class='Declare_Local'>writer</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * All arguments are already evaluated, and their values are passed in the 
     * named_argvalue/named_argnull or argvalue/argnull arrays.  This avoids 
     * issues if one of the arguments involves a call to some other function 
     * or subsystem that wants to use libxml on its own terms.  We examine the 
     * original XmlExpr to identify the numbers and types of the arguments. 
     */ 
</span>    <a href="xml.c.html#LN631"><span class='Ref_To_Local'>named_arg_strings</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN633"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN634"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN625"><span class='Ref_to_Parameter'>xexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1142"><span class='Ref_to_Member'>named_args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN651"></a>        <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>e</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN634"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN652"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN626"><span class='Ref_to_Parameter'>named_argnull</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN633"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN652"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="xml.c.html#LN652"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN75"><span class='Ref_to_Proto'>map_sql_value_to_xml_value</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN626"><span class='Ref_to_Parameter'>named_argvalue</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN633"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                             <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN651"><span class='Ref_To_Local'>e</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN631"><span class='Ref_To_Local'>named_arg_strings</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN631"><span class='Ref_To_Local'>named_arg_strings</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN652"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN633"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="xml.c.html#LN632"><span class='Ref_To_Local'>arg_strings</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN633"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN634"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN625"><span class='Ref_to_Parameter'>xexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1144"><span class='Ref_to_Member'>args</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN668"></a>        <a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>e</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/nodes/primnodes.h.html#LN131"><span class='Ref_to_Struct'>Expr</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN634"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN669"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* here we can just forget NULL elements immediately */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN627"><span class='Ref_to_Parameter'>argnull</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN633"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="xml.c.html#LN669"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN75"><span class='Ref_to_Proto'>map_sql_value_to_xml_value</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN627"><span class='Ref_to_Parameter'>argvalue</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN633"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                             <a href="../../../include/nodes/nodeFuncs.h.html#LN31"><span class='Ref_to_Proto'>exprType</span></a><span class='Parentheses'>((</span><a href="../../../include/nodes/nodes.h.html#LN508"><span class='Ref_to_Struct'>Node</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN668"><span class='Ref_To_Local'>e</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN632"><span class='Ref_To_Local'>arg_strings</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN632"><span class='Ref_To_Local'>arg_strings</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN669"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="xml.c.html#LN633"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="xml.c.html#LN636"><span class='Ref_To_Local'>xmlerrcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN56"><span class='Ref_to_Proto'>pg_xml_init</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN43"><span class='Ref_to_EnumConst'>PG_XML_STRICTNESS_ALL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN637"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span>xmlBufferCreate<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN637"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN636"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN636"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                        <span class='String'>"could not allocate xmlBuffer"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a> <span class='Operator'>= </span>xmlNewTextWriterMemory<span class='Parentheses'>(</span><a href="xml.c.html#LN637"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN636"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN636"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                        <span class='String'>"could not allocate xmlTextWriter"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        xmlTextWriterStartElement<span class='Parentheses'>(</span><a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN625"><span class='Ref_to_Parameter'>xexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1141"><span class='Ref_to_Member'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN179"><span class='Ref_to_Macro'>forboth</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN634"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN631"><span class='Ref_To_Local'>named_arg_strings</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN635"><span class='Ref_To_Local'>narg</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN625"><span class='Ref_to_Parameter'>xexpr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/primnodes.h.html#LN1143"><span class='Ref_to_Member'>arg_names</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN699"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN634"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN700"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>argname</span> <span class='Operator'>= </span><a href="../../../include/nodes/value.h.html#LN53"><span class='Ref_to_Macro'>strVal</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN635"><span class='Ref_To_Local'>narg</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN699"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>) 
</span>                xmlTextWriterWriteAttribute<span class='Parentheses'>(</span><a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a><span class='Delimiter'>, 
</span>                                            <span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN700"><span class='Ref_To_Local'>argname</span></a><span class='Delimiter'>, 
</span>                                            <span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN699"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN634"><span class='Ref_To_Local'>arg</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN632"><span class='Ref_To_Local'>arg_strings</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN710"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN634"><span class='Ref_To_Local'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            xmlTextWriterWriteRaw<span class='Parentheses'>(</span><a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN710"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        xmlTextWriterEndElement<span class='Parentheses'>(</span><a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* we MUST do this now to flush data out to the buffer ... */ 
</span>        xmlFreeTextWriter<span class='Parentheses'>(</span><a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN630"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN458"><span class='Ref_to_Func'>xmlBuffer_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN637"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a><span class='Parentheses'>) 
</span>            xmlFreeTextWriter<span class='Parentheses'>(</span><a href="xml.c.html#LN638"><span class='Ref_To_Local'>writer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN637"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) 
</span>            xmlBufferFree<span class='Parentheses'>(</span><a href="xml.c.html#LN637"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN636"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    xmlBufferFree<span class='Parentheses'>(</span><a href="xml.c.html#LN637"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN636"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN630"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end xmlelement &raquo; </span> 
 
 
<a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>* 
</span><a name="LN749"></a><span class='Declare_Function'>xmlparse</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1131"><span class='Ref_to_Typedef'>XmlOptionType</span></a> <span class='Declare_Parameter'>xmloption_arg</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>preserve_whitespace</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN752"></a>    xmlDocPtr   <span class='Declare_Local'>doc</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN752"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN142"><span class='Ref_to_Proto'>xml_parse</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN749"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN749"><span class='Ref_to_Parameter'>xmloption_arg</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN749"><span class='Ref_to_Parameter'>preserve_whitespace</span></a><span class='Delimiter'>, 
</span>                    <a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>    xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN752"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN749"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
 
<a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>* 
</span><a name="LN767"></a><span class='Declare_Function'>xmlpi</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>target</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>arg_is_null</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>result_is_null</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN770"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN771"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../port/pgstrcasecmp.c.html#LN34"><span class='Ref_to_Func'>pg_strcasecmp</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN767"><span class='Ref_to_Parameter'>target</span></a><span class='Delimiter'>, </span><span class='String'>"xml"</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_SYNTAX_ERROR<span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Comment_Single_Line'>/* really */ 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid XML processing instruction"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"XML processing instruction target name cannot be \"%s\"."</span><span class='Delimiter'>, </span><a href="xml.c.html#LN767"><span class='Ref_to_Parameter'>target</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Following the SQL standard, the null check comes after the syntax check 
     * above. 
     */ 
</span>    <span class='Operator'>*</span><a href="xml.c.html#LN767"><span class='Ref_to_Parameter'>result_is_null</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN767"><span class='Ref_to_Parameter'>arg_is_null</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN767"><span class='Ref_to_Parameter'>result_is_null</span></a><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN771"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN771"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;?%s"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN767"><span class='Ref_to_Parameter'>target</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN767"><span class='Ref_to_Parameter'>arg</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN793"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>string</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN793"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN767"><span class='Ref_to_Parameter'>arg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strstr<span class='Parentheses'>(</span><a href="xml.c.html#LN793"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>, </span><span class='String'>"?&GT;"</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_INVALID_XML_PROCESSING_INSTRUCTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid XML processing instruction"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>            <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"XML processing instruction cannot contain \"?&GT;\"."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN771"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>' '</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN771"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN793"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>+ </span>strspn<span class='Parentheses'>(</span><a href="xml.c.html#LN793"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>, </span><span class='String'>" "</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN793"><span class='Ref_To_Local'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN771"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"?&GT;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN770"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN771"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN771"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="xml.c.html#LN770"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end xmlpi &raquo; </span> 
 
 
<a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>* 
</span><a name="LN819"></a><span class='Declare_Function'>xmlroot</span><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>version</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>standalone</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN822"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN823"></a>    size_t      <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN824"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>orig_version</span><span class='Delimiter'>; 
</span><a name="LN825"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>orig_standalone</span><span class='Delimiter'>; 
</span><a name="LN826"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN823"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN819"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN822"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>((</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN819"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN138"><span class='Ref_to_Proto'>parse_xml_decl</span></a><span class='Parentheses'>((</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN822"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN823"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN824"><span class='Ref_To_Local'>orig_version</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN825"><span class='Ref_To_Local'>orig_standalone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN819"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN824"><span class='Ref_To_Local'>orig_version</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN137"><span class='Ref_to_Proto'>xml_text2xmlChar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN819"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="xml.c.html#LN824"><span class='Ref_To_Local'>orig_version</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN819"><span class='Ref_to_Parameter'>standalone</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/xml.h.html#LN26"><span class='Ref_to_EnumConst'>XML_STANDALONE_YES</span></a><span class='Operator'>: 
</span>            <a href="xml.c.html#LN825"><span class='Ref_To_Local'>orig_standalone</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/xml.h.html#LN27"><span class='Ref_to_EnumConst'>XML_STANDALONE_NO</span></a><span class='Operator'>: 
</span>            <a href="xml.c.html#LN825"><span class='Ref_To_Local'>orig_standalone</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/xml.h.html#LN28"><span class='Ref_to_EnumConst'>XML_STANDALONE_NO_VALUE</span></a><span class='Operator'>: 
</span>            <a href="xml.c.html#LN825"><span class='Ref_To_Local'>orig_standalone</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/xml.h.html#LN29"><span class='Ref_to_EnumConst'>XML_STANDALONE_OMITTED</span></a><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* leave original value */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN826"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN140"><span class='Ref_to_Proto'>print_xml_decl</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN826"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN824"><span class='Ref_To_Local'>orig_version</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="xml.c.html#LN825"><span class='Ref_To_Local'>orig_standalone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN826"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN822"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>+ </span><a href="xml.c.html#LN823"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN826"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end xmlroot &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Validate document (given as string) against DTD (given as external link) 
 * 
 * This has been removed because it is a security hole: unprivileged users 
 * should not be able to use Postgres to fetch arbitrary external files, 
 * which unfortunately is exactly what libxml is willing to do with the DTD 
 * parameter. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN875"></a><span class='Declare_Function'>xmlvalidate</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"xmlvalidate is not implemented"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>bool 
</span><a name="LN885"></a><span class='Declare_Function'>xml_is_document</span><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN888"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN889"></a>    <span class='Keyword'>volatile </span>xmlDocPtr <span class='Declare_Local'>doc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN890"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>ccxt</span> <span class='Operator'>= </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We want to catch ereport(INVALID_XML_DOCUMENT) and return false */ 
</span>    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN889"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN142"><span class='Ref_to_Proto'>xml_parse</span></a><span class='Parentheses'>((</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN885"><span class='Ref_to_Parameter'>arg</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1133"><span class='Ref_to_EnumConst'>XMLOPTION_DOCUMENT</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, 
</span>                        <a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN888"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span><a name="LN901"></a>        <a href="../../../include/utils/elog.h.html#LN328"><span class='Ref_to_Struct'>ErrorData</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>errdata</span><span class='Delimiter'>; 
</span><a name="LN902"></a>        <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>ecxt</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN902"><span class='Ref_To_Local'>ecxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN890"><span class='Ref_To_Local'>ccxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN901"><span class='Ref_To_Local'>errdata</span></a> <span class='Operator'>= </span><a href="../../../include/utils/elog.h.html#LN363"><span class='Ref_to_Proto'>CopyErrorData</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN901"><span class='Ref_To_Local'>errdata</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/elog.h.html#LN341"><span class='Ref_to_Member'>sqlerrcode</span></a> <span class='Operator'>== </span>ERRCODE_INVALID_XML_DOCUMENT<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/elog.h.html#LN365"><span class='Ref_to_Proto'>FlushErrorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN888"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN902"><span class='Ref_To_Local'>ecxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN889"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>) 
</span>        xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN889"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN888"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span>    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end xml_is_document &raquo; </span> 
 
 
<span class='Directive'>#ifdef</span> USE_LIBXML 
 
<span class='Comment_Multi_Line'>/* 
 * pg_xml_init_library --- set up for use of libxml 
 * 
 * This should be called by each function that is about to use libxml 
 * facilities but doesn't require error handling.  It initializes libxml 
 * and verifies compatibility with the loaded libxml version.  These are 
 * once-per-session activities. 
 * 
 * TODO: xmlChar is utf8-char, make proper tuning (initdb with enc!=utf8 and 
 * check) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN944"></a><span class='Declare_Function'>pg_xml_init_library</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN946"></a>    <span class='Keyword'>static bool </span><span class='Declare_Local'>first_time</span> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN946"><span class='Ref_To_Local'>first_time</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Stuff we need do only once per session */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Currently, we have no pure UTF-8 support for internals -- check if 
         * we can work. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>xmlChar<span class='Parentheses'>))</span> 
            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not initialize XML library"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"libxml2 has incompatible char type: sizeof(char)=%u, sizeof(xmlChar)=%u."</span><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>char</span><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>int</span><span class='Parentheses'>) </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>xmlChar<span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> USE_LIBXMLCONTEXT 
        <span class='Comment_Multi_Line'>/* Set up libxml's memory allocation our way */ 
</span>        <a href="xml.c.html#LN130"><span class='Ref_to_Proto'>xml_memory_init</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <span class='Comment_Multi_Line'>/* Check library compatibility */ 
</span>        LIBXML_TEST_VERSION<span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN946"><span class='Ref_To_Local'>first_time</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if first_time &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end pg_xml_init_library &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * pg_xml_init --- set up for use of libxml and register an error handler 
 * 
 * This should be called by each function that is about to use libxml 
 * facilities and requires error handling.  It initializes libxml with 
 * pg_xml_init_library() and establishes our libxml error handler. 
 * 
 * strictness determines which errors are reported and which are ignored. 
 * 
 * Calls to this function MUST be followed by a PG_TRY block that guarantees 
 * that pg_xml_done() is called during either normal or error exit. 
 * 
 * This is exported for use by contrib/xml2, as well as other code that might 
 * wish to share use of this module's libxml error handler. 
 */ 
</span><a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>* 
</span><a name="LN990"></a><span class='Declare_Function'>pg_xml_init</span><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN38"><span class='Ref_to_Typedef'>PgXmlStrictness</span></a> <span class='Declare_Parameter'>strictness</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN992"></a>    <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>errcxt</span><span class='Delimiter'>; 
</span><a name="LN993"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>new_errcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Do one-time setup if needed */ 
</span>    <a href="../../../include/utils/xml.h.html#LN55"><span class='Ref_to_Proto'>pg_xml_init_library</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Create error handling context structure */ 
</span>    <a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN105"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN101"><span class='Ref_to_Const'>ERRCXT_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN107"><span class='Ref_to_Member'>strictness</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN990"><span class='Ref_to_Parameter'>strictness</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN110"><span class='Ref_to_Member'>err_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Save original error handler and install ours. libxml originally didn't 
     * distinguish between the contexts for generic and for structured error 
     * handlers.  If we're using an old libxml version, we must thus save the 
     * generic error context, even though we're using a structured error 
     * handler. 
     */ 
</span>    <a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN112"><span class='Ref_to_Member'>saved_errfunc</span></a> <span class='Operator'>= </span>xmlStructuredError<span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> <a href="xml.c.html#LN65"><span class='Ref_to_Const'>HAVE_XMLSTRUCTUREDERRORCONTEXT</span></a> 
    <a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN113"><span class='Ref_to_Member'>saved_errcxt</span></a> <span class='Operator'>= </span>xmlStructuredErrorContext<span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN113"><span class='Ref_to_Member'>saved_errcxt</span></a> <span class='Operator'>= </span>xmlGenericErrorContext<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    xmlSetStructuredErrorFunc<span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN120"><span class='Ref_to_Proto'>xml_errorHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Verify that xmlSetStructuredErrorFunc set the context variable we 
     * expected it to.  If not, the error context pointer we just saved is not 
     * the correct thing to restore, and since that leaves us without a way to 
     * restore the context in pg_xml_done, we must fail. 
     * 
     * The only known situation in which this test fails is if we compile with 
     * headers from a libxml2 that doesn't track the structured error context 
     * separately (&LT; 2.7.4), but at runtime use a version that does, or vice 
     * versa.  The libxml2 authors did not treat that change as constituting 
     * an ABI break, so the LIBXML_TEST_VERSION test in pg_xml_init_library 
     * fails to protect us from this. 
     */ 
</span> 
<span class='Directive'>#ifdef</span> <a href="xml.c.html#LN65"><span class='Ref_to_Const'>HAVE_XMLSTRUCTUREDERRORCONTEXT</span></a> 
    <a href="xml.c.html#LN993"><span class='Ref_To_Local'>new_errcxt</span></a> <span class='Operator'>= </span>xmlStructuredErrorContext<span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN993"><span class='Ref_To_Local'>new_errcxt</span></a> <span class='Operator'>= </span>xmlGenericErrorContext<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN993"><span class='Ref_To_Local'>new_errcxt</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not set up XML error handler"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN985"><span class='Ref_to_Func'>errhint</span></a><span class='Parentheses'>(</span><span class='String'>"This probably indicates that the version of libxml2"</span> 
                         <span class='String'>" being used is not compatible with the libxml2"</span> 
                         <span class='String'>" header files that PostgreSQL was built with."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Also, install an entity loader to prevent unwanted fetches of external 
     * files and URLs. 
     */ 
</span>    <a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN115"><span class='Ref_to_Member'>saved_entityfunc</span></a> <span class='Operator'>= </span>xmlGetExternalEntityLoader<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    xmlSetExternalEntityLoader<span class='Parentheses'>(</span><a href="xml.c.html#LN118"><span class='Ref_to_Proto'>xmlPgEntityLoader</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN992"><span class='Ref_To_Local'>errcxt</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_xml_init &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * pg_xml_done --- restore previous libxml error handling 
 * 
 * Resets libxml's global error-handling state to what it was before 
 * pg_xml_init() was called. 
 * 
 * This routine verifies that all pending errors have been dealt with 
 * (in assert-enabled builds, anyway). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1071"></a><span class='Declare_Function'>pg_xml_done</span><span class='Parentheses'>(</span><a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>errcxt</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isError</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1073"></a>    <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>cur_errcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* An assert seems like enough protection here */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN105"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>== </span><a href="xml.c.html#LN101"><span class='Ref_to_Const'>ERRCXT_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * In a normal exit, there should be no un-handled libxml errors.  But we 
     * shouldn't try to enforce this during error recovery, since the longjmp 
     * could have been thrown before xml_ereport had a chance to run. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a> <span class='Operator'>|| </span><a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>isError</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Check that libxml's global state is correct, warn if not.  This is a 
     * real test and not an Assert because it has a higher probability of 
     * happening. 
     */ 
</span><span class='Directive'>#ifdef</span> <a href="xml.c.html#LN65"><span class='Ref_to_Const'>HAVE_XMLSTRUCTUREDERRORCONTEXT</span></a> 
    <a href="xml.c.html#LN1073"><span class='Ref_To_Local'>cur_errcxt</span></a> <span class='Operator'>= </span>xmlStructuredErrorContext<span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN1073"><span class='Ref_To_Local'>cur_errcxt</span></a> <span class='Operator'>= </span>xmlGenericErrorContext<span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1073"><span class='Ref_To_Local'>cur_errcxt</span></a> <span class='Operator'>!= </span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"libxml error handling state is out of sync with xml.c"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Restore the saved handlers */ 
</span>    xmlSetStructuredErrorFunc<span class='Parentheses'>(</span><a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN113"><span class='Ref_to_Member'>saved_errcxt</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN112"><span class='Ref_to_Member'>saved_errfunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    xmlSetExternalEntityLoader<span class='Parentheses'>(</span><a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN115"><span class='Ref_to_Member'>saved_entityfunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Mark the struct as invalid, just in case somebody somehow manages to 
     * call xml_errorHandler or xml_ereport with it. 
     */ 
</span>    <a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN105"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Release memory */ 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN110"><span class='Ref_to_Member'>err_buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1071"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end pg_xml_done &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * pg_xml_error_occurred() --- test the error flag 
 */ 
</span><span class='Keyword'>bool 
</span><a name="LN1119"></a><span class='Declare_Function'>pg_xml_error_occurred</span><span class='Parentheses'>(</span><a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>errcxt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="xml.c.html#LN1119"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL/XML allows storing "XML documents" or "XML content".  "XML 
 * documents" are specified by the XML specification and are parsed 
 * easily by libxml.  "XML content" is specified by SQL/XML as the 
 * production "XMLDecl? content".  But libxml can only parse the 
 * "content" part, so we have to parse the XML declaration ourselves 
 * to complete this. 
 */ 
</span> 
<a name="LN1134"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CHECK_XML_SPACE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>p</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span>xmlIsBlank_ch<span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1134"><span class='Ref_to_Parameter'>p</span></a><span class='Parentheses'>)))</span> <span class='Operator'>\ 
</span>            <span class='Control'>return</span> XML_ERR_SPACE_REQUIRED<span class='Delimiter'>; </span><span class='Operator'>\ 
</span>    <span class='Delimiter'>} </span><span class='Control'>while</span> <span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span> 
<a name="LN1140"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>SKIP_XML_SPACE</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>p</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span>xmlIsBlank_ch<span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1140"><span class='Ref_to_Parameter'>p</span></a><span class='Parentheses'>)))</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1140"><span class='Ref_to_Parameter'>p</span></a><span class='Parentheses'>)</span><span class='Operator'>++ 
</span> 
<span class='Comment_Multi_Line'>/* Letter | Digit | '.' | '-' | '_' | ':' | CombiningChar | Extender */ 
/* Beware of multiple evaluations of argument! */ 
</span><a name="LN1145"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>PG_XMLISNAMECHAR</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>    <span class='Parentheses'>(</span>xmlIsBaseChar_ch<span class='Parentheses'>(</span><a href="xml.c.html#LN1145"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span>xmlIsIdeographicQ<span class='Parentheses'>(</span><a href="xml.c.html#LN1145"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            <span class='Operator'>|| </span>xmlIsDigit_ch<span class='Parentheses'>(</span><a href="xml.c.html#LN1145"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            <span class='Operator'>|| </span><a href="xml.c.html#LN1145"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>'.'</span> <span class='Operator'>|| </span><a href="xml.c.html#LN1145"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| </span><a href="xml.c.html#LN1145"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>'_'</span> <span class='Operator'>|| </span><a href="xml.c.html#LN1145"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>':'</span> <span class='Operator'>\ 
</span>            <span class='Operator'>|| </span>xmlIsCombiningQ<span class='Parentheses'>(</span><a href="xml.c.html#LN1145"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>\ 
</span>            <span class='Operator'>|| </span>xmlIsExtender_ch<span class='Parentheses'>(</span><a href="xml.c.html#LN1145"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>))</span> 
 
<span class='Comment_Multi_Line'>/* pnstrdup, but deal with xmlChar not char; len is measured in xmlChars */ 
</span><span class='Keyword'>static </span>xmlChar <span class='Operator'>* 
</span><a name="LN1154"></a><span class='Declare_Function'>xml_pnstrdup</span><span class='Parentheses'>(</span><span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1156"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN1156"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="xml.c.html#LN1154"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>xmlChar<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="xml.c.html#LN1156"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1154"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1154"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>xmlChar<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1156"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN1154"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="xml.c.html#LN1156"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* Ditto, except input is char* */ 
</span><span class='Keyword'>static </span>xmlChar <span class='Operator'>* 
</span><a name="LN1166"></a><span class='Declare_Function'>pg_xmlCharStrndup</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>len</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1168"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN1168"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>((</span><a href="xml.c.html#LN1166"><span class='Ref_to_Parameter'>len</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>xmlChar<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memcpy<span class='Parentheses'>(</span><a href="xml.c.html#LN1168"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1166"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1166"><span class='Ref_to_Parameter'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1168"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN1166"><span class='Ref_to_Parameter'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN1168"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * str is the null-terminated input string.  Remaining arguments are 
 * output arguments; each can be NULL if value is not wanted. 
 * version and encoding are returned as locally-palloc'd strings. 
 * Result is 0 if OK, an error code if not. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN1184"></a><span class='Declare_Function'>parse_xml_decl</span><span class='Parentheses'>(</span><span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Delimiter'>, </span>size_t <span class='Operator'>*</span><span class='Declare_Parameter'>lenp</span><span class='Delimiter'>, 
</span><a name="LN1185"></a>               xmlChar <span class='Operator'>**</span><span class='Declare_Parameter'>version</span><span class='Delimiter'>, </span>xmlChar <span class='Operator'>**</span><span class='Declare_Parameter'>encoding</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>standalone</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1187"></a>    <span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span><a name="LN1188"></a>    <span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Local'>save_p</span><span class='Delimiter'>; 
</span><a name="LN1189"></a>    size_t      <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1190"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>utf8char</span><span class='Delimiter'>; 
</span><a name="LN1191"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>utf8len</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Only initialize libxml.  We don't need error handling here, but we do 
     * need to make sure libxml is initialized before calling any of its 
     * functions.  Note that this is safe (and a no-op) if caller has already 
     * done pg_xml_init(). 
     */ 
</span>    <a href="../../../include/utils/xml.h.html#LN55"><span class='Ref_to_Proto'>pg_xml_init_library</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Initialize output arguments to "not present" */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>version</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>encoding</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>encoding</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>standalone</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>standalone</span></a> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1184"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlStrncmp<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"&LT;?xml"</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="xml.c.html#LN1321"><span class='Ref_to_Label'>finished</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* if next char is name char, it's a PI like &LT;?xml-stylesheet ...?&GT; */ 
</span>    <a href="xml.c.html#LN1191"><span class='Ref_To_Local'>utf8len</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>((</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) (</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>5</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1190"><span class='Ref_To_Local'>utf8char</span></a> <span class='Operator'>= </span>xmlGetUTF8Char<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>5</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN1191"><span class='Ref_To_Local'>utf8len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1145"><span class='Ref_to_Macro'>PG_XMLISNAMECHAR</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1190"><span class='Ref_To_Local'>utf8char</span></a><span class='Parentheses'>))</span> 
        <span class='Control'>goto</span> <span class='Symbol_Characters'>&darr;</span><a href="xml.c.html#LN1321"><span class='Ref_to_Label'>finished</span></a><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>5</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* version */ 
</span>    <a href="xml.c.html#LN1134"><span class='Ref_to_Macro'>CHECK_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlStrncmp<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"version"</span><span class='Delimiter'>, </span><span class='Number'>7</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> XML_ERR_VERSION_MISSING<span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>7</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>        <span class='Control'>return</span> XML_ERR_VERSION_MISSING<span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\''</span> <span class='Operator'>|| *</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1236"></a>        <span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Local'>q</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN1236"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>= </span>xmlStrchr<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN1236"><span class='Ref_To_Local'>q</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> XML_ERR_VERSION_MISSING<span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>version</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1153"><span class='Ref_to_Func'>xml_pnstrdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1236"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>- </span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1236"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <span class='Control'>return</span> XML_ERR_VERSION_MISSING<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* encoding */ 
</span>    <a href="xml.c.html#LN1188"><span class='Ref_To_Local'>save_p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlStrncmp<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"encoding"</span><span class='Delimiter'>, </span><span class='Number'>8</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN1134"><span class='Ref_to_Macro'>CHECK_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1188"><span class='Ref_To_Local'>save_p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> XML_ERR_MISSING_ENCODING<span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'\''</span> <span class='Operator'>|| *</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'"'</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1264"></a>            <span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Local'>q</span><span class='Delimiter'>; 
</span> 
            <a href="xml.c.html#LN1264"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>= </span>xmlStrchr<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN1264"><span class='Ref_To_Local'>q</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> XML_ERR_MISSING_ENCODING<span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>encoding</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>encoding</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1153"><span class='Ref_to_Func'>xml_pnstrdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1264"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>- </span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1264"><span class='Ref_To_Local'>q</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> XML_ERR_MISSING_ENCODING<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if xmlStrncmp(p,(xmlChar... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1188"><span class='Ref_To_Local'>save_p</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* standalone */ 
</span>    <a href="xml.c.html#LN1188"><span class='Ref_To_Local'>save_p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlStrncmp<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"standalone"</span><span class='Delimiter'>, </span><span class='Number'>10</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN1134"><span class='Ref_to_Macro'>CHECK_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1188"><span class='Ref_To_Local'>save_p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>10</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>!= </span><span class='String'>'='</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> XML_ERR_STANDALONE_VALUE<span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlStrncmp<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"'yes'"</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>            xmlStrncmp<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"\"yes\""</span><span class='Delimiter'>, </span><span class='Number'>5</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>standalone</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>standalone</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>5</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlStrncmp<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"'no'"</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                 xmlStrncmp<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"\"no\""</span><span class='Delimiter'>, </span><span class='Number'>4</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>standalone</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>*</span><a href="xml.c.html#LN1185"><span class='Ref_to_Parameter'>standalone</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>4</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <span class='Control'>return</span> XML_ERR_STANDALONE_VALUE<span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if xmlStrncmp(p,(xmlChar... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1188"><span class='Ref_To_Local'>save_p</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="xml.c.html#LN1140"><span class='Ref_to_Macro'>SKIP_XML_SPACE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlStrncmp<span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"?&GT;"</span><span class='Delimiter'>, </span><span class='Number'>2</span><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Control'>return</span> XML_ERR_XMLDECL_NOT_FINISHED<span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>2</span><span class='Delimiter'>; 
</span> 
<a name="LN1321"></a><span class='Label'>finished</span><span class='Operator'>: 
</span>    <a href="xml.c.html#LN1189"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>- </span><a href="xml.c.html#LN1184"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1184"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&LT; </span><a href="xml.c.html#LN1184"><span class='Ref_to_Parameter'>str</span></a> <span class='Operator'>+ </span><a href="xml.c.html#LN1189"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1187"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>&GT; </span><span class='Number'>127</span><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> XML_ERR_INVALID_CHAR<span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1184"><span class='Ref_to_Parameter'>lenp</span></a><span class='Parentheses'>) 
</span>        <span class='Operator'>*</span><a href="xml.c.html#LN1184"><span class='Ref_to_Parameter'>lenp</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1189"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> XML_ERR_OK<span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end parse_xml_decl &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Write an XML declaration.  On output, we adjust the XML declaration 
 * as follows.  (These rules are the moral equivalent of the clause 
 * "Serialization of an XML value" in the SQL standard.) 
 * 
 * We try to avoid generating an XML declaration if possible.  This is 
 * so that you don't get trivial things like xml '&LT;foo/&GT;' resulting in 
 * '&LT;?xml version="1.0"?&GT;&LT;foo/&GT;', which would surely be annoying.  We 
 * must provide a declaration if the standalone property is specified 
 * or if we include an encoding declaration.  If we have a 
 * declaration, we must specify a version (XML requires this). 
 * Otherwise we only make a declaration if the version is not "1.0", 
 * which is the default version specified in SQL:2003. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1350"></a><span class='Declare_Function'>print_xml_decl</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>buf</span><span class='Delimiter'>, </span><span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Parameter'>version</span><span class='Delimiter'>, 
</span><a name="LN1351"></a>               <a href="../../../include/mb/pg_wchar.h.html#LN235"><span class='Ref_to_Enum'>pg_enc</span></a> <span class='Declare_Parameter'>encoding</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>standalone</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>version</span></a> <span class='Operator'>&& </span>strcmp<span class='Parentheses'>((</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>version</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN279"><span class='Ref_to_Const'>PG_XML_DEFAULT_VERSION</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Operator'>|| </span><span class='Parentheses'>(</span><a href="xml.c.html#LN1351"><span class='Ref_to_Parameter'>encoding</span></a> <span class='Operator'>&& </span><a href="xml.c.html#LN1351"><span class='Ref_to_Parameter'>encoding</span></a> <span class='Operator'>!= </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span> 
        <span class='Operator'>|| </span><a href="xml.c.html#LN1351"><span class='Ref_to_Parameter'>standalone</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>)</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;?xml"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" version=\"%s\""</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" version=\"%s\""</span><span class='Delimiter'>, </span><a href="xml.c.html#LN279"><span class='Ref_to_Const'>PG_XML_DEFAULT_VERSION</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1351"><span class='Ref_to_Parameter'>encoding</span></a> <span class='Operator'>&& </span><a href="xml.c.html#LN1351"><span class='Ref_to_Parameter'>encoding</span></a> <span class='Operator'>!= </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * XXX might be useful to convert this to IANA names (ISO-8859-1 
             * instead of LATIN1 etc.); needs field experience 
             */ 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" encoding=\"%s\""</span><span class='Delimiter'>, 
</span>                             <a href="../../../include/mb/pg_wchar.h.html#LN502"><span class='Ref_to_Proto'>pg_encoding_to_char</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1351"><span class='Ref_to_Parameter'>encoding</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1351"><span class='Ref_to_Parameter'>standalone</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" standalone=\"yes\""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1351"><span class='Ref_to_Parameter'>standalone</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>" standalone=\"no\""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1350"><span class='Ref_to_Parameter'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"?&GT;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if (version&&strcmp((con... &raquo; </span> 
    <span class='Control'>else</span> 
        <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end print_xml_decl &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Convert a C string to XML internal representation 
 * 
 * Note: it is caller's responsibility to xmlFreeDoc() the result, 
 * else a permanent memory leak will ensue! 
 * 
 * TODO maybe libxml2's xmlreader is better? (do not construct DOM, 
 * yet do not use SAX - see xmlreader.c) 
 */ 
</span><span class='Keyword'>static </span>xmlDocPtr 
<a name="LN1397"></a><span class='Declare_Function'>xml_parse</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1131"><span class='Ref_to_Typedef'>XmlOptionType</span></a> <span class='Declare_Parameter'>xmloption_arg</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>preserve_whitespace</span><span class='Delimiter'>, 
</span><a name="LN1398"></a>          <span class='Keyword'>int </span><span class='Declare_Parameter'>encoding</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1400"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN1401"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>string</span><span class='Delimiter'>; 
</span><a name="LN1402"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>utf8string</span><span class='Delimiter'>; 
</span><a name="LN1403"></a>    <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xmlerrcxt</span><span class='Delimiter'>; 
</span><a name="LN1404"></a>    <span class='Keyword'>volatile </span>xmlParserCtxtPtr <span class='Declare_Local'>ctxt</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1405"></a>    <span class='Keyword'>volatile </span>xmlDocPtr <span class='Declare_Local'>doc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN1400"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1397"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>;</span>      <span class='Comment_Single_Line'>/* will be useful later */ 
</span>    <a href="xml.c.html#LN1401"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN137"><span class='Ref_to_Proto'>xml_text2xmlChar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1397"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN1402"><span class='Ref_To_Local'>utf8string</span></a> <span class='Operator'>= </span><a href="../mb/mbutils.c.html#LN335"><span class='Ref_to_Func'>pg_do_encoding_conversion</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1401"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>, 
</span>                                           <a href="xml.c.html#LN1400"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, 
</span>                                           <a href="xml.c.html#LN1398"><span class='Ref_to_Parameter'>encoding</span></a><span class='Delimiter'>, 
</span>                                           <a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Start up libxml and its parser */ 
</span>    <a href="xml.c.html#LN1403"><span class='Ref_To_Local'>xmlerrcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN56"><span class='Ref_to_Proto'>pg_xml_init</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN42"><span class='Ref_to_EnumConst'>PG_XML_STRICTNESS_WELLFORMED</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Use a TRY block to ensure we clean up correctly */ 
</span>    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        xmlInitParser<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN1404"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>= </span>xmlNewParserCtxt<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1404"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN1403"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1403"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                        <span class='String'>"could not allocate parser context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1397"><span class='Ref_to_Parameter'>xmloption_arg</span></a> <span class='Operator'>== </span><a href="../../../include/nodes/primnodes.h.html#LN1133"><span class='Ref_to_EnumConst'>XMLOPTION_DOCUMENT</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Note, that here we try to apply DTD defaults 
             * (XML_PARSE_DTDATTR) according to SQL/XML:2008 GR 10.16.7.d: 
             * 'Default values defined by internal DTD are applied'. As for 
             * external DTDs, we try to support them too, (see SQL/XML:2008 GR 
             * 10.16.7.e) 
             */ 
</span>            <a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>= </span>xmlCtxtReadDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN1404"><span class='Ref_To_Local'>ctxt</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1402"><span class='Ref_To_Local'>utf8string</span></a><span class='Delimiter'>, 
</span>                                 <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                 <span class='String'>"UTF-8"</span><span class='Delimiter'>, 
</span>                                 XML_PARSE_NOENT <span class='Operator'>| </span>XML_PARSE_DTDATTR 
                           <span class='Operator'>| </span><span class='Parentheses'>(</span><a href="xml.c.html#LN1397"><span class='Ref_to_Parameter'>preserve_whitespace</span></a> <span class='Operator'>? </span><span class='Number'>0</span> <span class='Operator'>: </span>XML_PARSE_NOBLANKS<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN1403"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>                <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1403"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INVALID_XML_DOCUMENT<span class='Delimiter'>, 
</span>                            <span class='String'>"invalid XML document"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1448"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>res_code</span><span class='Delimiter'>; 
</span><a name="LN1449"></a>            size_t      <span class='Declare_Local'>count</span><span class='Delimiter'>; 
</span><a name="LN1450"></a>            xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>version</span><span class='Delimiter'>; 
</span><a name="LN1451"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>standalone</span><span class='Delimiter'>; 
</span> 
            <a href="xml.c.html#LN1448"><span class='Ref_To_Local'>res_code</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN138"><span class='Ref_to_Proto'>parse_xml_decl</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1402"><span class='Ref_To_Local'>utf8string</span></a><span class='Delimiter'>, 
</span>                                      <span class='Operator'>&</span><a href="xml.c.html#LN1449"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN1450"><span class='Ref_To_Local'>version</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN1451"><span class='Ref_To_Local'>standalone</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1448"><span class='Ref_To_Local'>res_code</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                <a href="xml.c.html#LN121"><span class='Ref_to_Proto'>xml_ereport_by_code</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INVALID_XML_CONTENT<span class='Delimiter'>, 
</span>                              <span class='String'>"invalid XML content: invalid XML declaration"</span><span class='Delimiter'>, 
</span>                                    <a href="xml.c.html#LN1448"><span class='Ref_To_Local'>res_code</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>= </span>xmlNewDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN1450"><span class='Ref_To_Local'>version</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a><span class='Operator'>-&GT;</span>encoding <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a><span class='Operator'>-&GT;</span>encoding <span class='Operator'>= </span>xmlStrdup<span class='Parentheses'>((</span><span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>"UTF-8"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a><span class='Operator'>-&GT;</span>standalone <span class='Operator'>= </span><a href="xml.c.html#LN1451"><span class='Ref_To_Local'>standalone</span></a><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* allow empty content */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1402"><span class='Ref_To_Local'>utf8string</span></a> <span class='Operator'>+ </span><a href="xml.c.html#LN1449"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="xml.c.html#LN1448"><span class='Ref_To_Local'>res_code</span></a> <span class='Operator'>= </span>xmlParseBalancedChunkMemory<span class='Parentheses'>(</span><a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, 
</span>                                                   <a href="xml.c.html#LN1402"><span class='Ref_To_Local'>utf8string</span></a> <span class='Operator'>+ </span><a href="xml.c.html#LN1449"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1448"><span class='Ref_To_Local'>res_code</span></a> <span class='Operator'>!= </span><span class='Number'>0</span> <span class='Operator'>|| </span><a href="xml.c.html#LN1403"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1403"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INVALID_XML_CONTENT<span class='Delimiter'>, 
</span>                                <span class='String'>"invalid XML content"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1404"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            xmlFreeParserCtxt<span class='Parentheses'>(</span><a href="xml.c.html#LN1404"><span class='Ref_To_Local'>ctxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1403"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    xmlFreeParserCtxt<span class='Parentheses'>(</span><a href="xml.c.html#LN1404"><span class='Ref_To_Local'>ctxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1403"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN1405"><span class='Ref_To_Local'>doc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end xml_parse &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * xmlChar&LT;-&GT;text conversions 
 */ 
</span><span class='Keyword'>static </span>xmlChar <span class='Operator'>* 
</span><a name="LN1501"></a><span class='Declare_Function'>xml_text2xmlChar</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>in</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1501"><span class='Ref_to_Parameter'>in</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Directive'>#ifdef</span> USE_LIBXMLCONTEXT 
 
<span class='Comment_Multi_Line'>/* 
 * Manage the special context used for all libxml allocations (but only 
 * in special debug builds; see notes at top of file) 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1514"></a><span class='Declare_Function'>xml_memory_init</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Create memory context if not there already */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN128"><span class='Ref_to_Global_Var'>LibxmlContext</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN128"><span class='Ref_to_Global_Var'>LibxmlContext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                              <span class='String'>"Libxml context"</span><span class='Delimiter'>, 
</span>                                              <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Re-establish the callbacks even if already set */ 
</span>    xmlMemSetup<span class='Parentheses'>(</span><a href="xml.c.html#LN133"><span class='Ref_to_Proto'>xml_pfree</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN131"><span class='Ref_to_Proto'>xml_palloc</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN132"><span class='Ref_to_Proto'>xml_repalloc</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN134"><span class='Ref_to_Proto'>xml_pstrdup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Wrappers for memory management functions 
 */ 
</span><span class='Keyword'>static void </span><span class='Operator'>* 
</span><a name="LN1530"></a><span class='Declare_Function'>xml_palloc</span><span class='Parentheses'>(</span>size_t <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/palloc.h.html#LN70"><span class='Ref_to_Proto'>MemoryContextAlloc</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN128"><span class='Ref_to_Global_Var'>LibxmlContext</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1530"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static void </span><span class='Operator'>* 
</span><a name="LN1537"></a><span class='Declare_Function'>xml_repalloc</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Delimiter'>, </span>size_t <span class='Declare_Parameter'>size</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/common/fe_memutils.h.html#LN36"><span class='Ref_to_Proto'>repalloc</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1537"><span class='Ref_to_Parameter'>ptr</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1537"><span class='Ref_to_Parameter'>size</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static void 
</span><a name="LN1544"></a><span class='Declare_Function'>xml_pfree</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>ptr</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* At least some parts of libxml assume xmlFree(NULL) is allowed */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1544"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1544"><span class='Ref_to_Parameter'>ptr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1553"></a><span class='Declare_Function'>xml_pstrdup</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>string</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="../../../include/utils/palloc.h.html#LN125"><span class='Ref_to_Proto'>MemoryContextStrdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN128"><span class='Ref_to_Global_Var'>LibxmlContext</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1553"><span class='Ref_to_Parameter'>string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_LIBXMLCONTEXT */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * xmlPgEntityLoader --- entity loader callback function 
 * 
 * Silently prevent any external entity URL from being loaded.  We don't want 
 * to throw an error, so instead make the entity appear to expand to an empty 
 * string. 
 * 
 * We would prefer to allow loading entities that exist in the system's 
 * global XML catalog; but the available libxml2 APIs make that a complex 
 * and fragile task.  For now, just shut down all external access. 
 */ 
</span><span class='Keyword'>static </span>xmlParserInputPtr 
<a name="LN1572"></a><span class='Declare_Function'>xmlPgEntityLoader</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>URL</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ID</span><span class='Delimiter'>, 
</span><a name="LN1573"></a>                  xmlParserCtxtPtr <span class='Declare_Parameter'>ctxt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> xmlNewStringInputStream<span class='Parentheses'>(</span><a href="xml.c.html#LN1573"><span class='Ref_to_Parameter'>ctxt</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * xml_ereport --- report an XML-related error 
 * 
 * The "msg" is the SQL-level message; some can be adopted from the SQL/XML 
 * standard.  This function adds libxml's native error message, if any, as 
 * detail. 
 * 
 * This is exported for modules that want to share the core libxml error 
 * handler.  Note that pg_xml_init() *must* have been called previously. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1590"></a><span class='Declare_Function'>xml_ereport</span><span class='Parentheses'>(</span><a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>errcxt</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sqlcode</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1592"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>detail</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Defend against someone passing us a bogus context struct */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1590"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN105"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="xml.c.html#LN101"><span class='Ref_to_Const'>ERRCXT_MAGIC</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"xml_ereport called with invalid PgXmlErrorContext"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Flag that the current libxml error has been reported */ 
</span>    <a href="xml.c.html#LN1590"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Include detail only if we have some text from libxml */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1590"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN110"><span class='Ref_to_Member'>err_buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN1592"><span class='Ref_To_Local'>detail</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1590"><span class='Ref_to_Parameter'>errcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN110"><span class='Ref_to_Member'>err_buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="xml.c.html#LN1592"><span class='Ref_To_Local'>detail</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1590"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1590"><span class='Ref_to_Parameter'>sqlcode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1590"><span class='Ref_to_Parameter'>msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="xml.c.html#LN1592"><span class='Ref_To_Local'>detail</span></a> <span class='Operator'>? </span><a href="../error/elog.c.html#LN898"><span class='Ref_to_Func'>errdetail_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1592"><span class='Ref_To_Local'>detail</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end xml_ereport &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Error handler for libxml errors and warnings 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1618"></a><span class='Declare_Function'>xml_errorHandler</span><span class='Parentheses'>(</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span>xmlErrorPtr <span class='Declare_Parameter'>error</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1620"></a>    <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xmlerrcxt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>; 
</span><a name="LN1621"></a>    xmlParserCtxtPtr <span class='Declare_Local'>ctxt</span> <span class='Operator'>= </span><span class='Parentheses'>(</span>xmlParserCtxtPtr<span class='Parentheses'>) </span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>error</span></a><span class='Operator'>-&GT;</span>ctxt<span class='Delimiter'>; 
</span><a name="LN1622"></a>    xmlParserInputPtr <span class='Declare_Local'>input</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="xml.c.html#LN1621"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>? </span><a href="xml.c.html#LN1621"><span class='Ref_To_Local'>ctxt</span></a><span class='Operator'>-&GT;</span>input <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1623"></a>    xmlNodePtr  <span class='Declare_Local'>node</span> <span class='Operator'>= </span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>error</span></a><span class='Operator'>-&GT;</span>node<span class='Delimiter'>; 
</span><a name="LN1624"></a>    <span class='Keyword'>const </span>xmlChar <span class='Operator'>*</span><span class='Declare_Local'>name</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="xml.c.html#LN1623"><span class='Ref_To_Local'>node</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL </span><span class='Operator'>&& 
</span>                         <a href="xml.c.html#LN1623"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span>type <span class='Operator'>== </span>XML_ELEMENT_NODE<span class='Parentheses'>) </span><span class='Operator'>? </span><a href="xml.c.html#LN1623"><span class='Ref_To_Local'>node</span></a><span class='Operator'>-&GT;</span>name <span class='Operator'>: </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN1626"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>domain</span> <span class='Operator'>= </span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>error</span></a><span class='Operator'>-&GT;</span>domain<span class='Delimiter'>; 
</span><a name="LN1627"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>level</span> <span class='Operator'>= </span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>error</span></a><span class='Operator'>-&GT;</span>level<span class='Delimiter'>; 
</span><a name="LN1628"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>errorBuf</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Defend against someone passing us a bogus context struct. 
     * 
     * We force a backend exit if this check fails because longjmp'ing out of 
     * libxml would likely render it unsafe to use further. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1620"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN105"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="xml.c.html#LN101"><span class='Ref_to_Const'>ERRCXT_MAGIC</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"xml_errorHandler called with invalid PgXmlErrorContext"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/*---------- 
     * Older libxml versions report some errors differently. 
     * First, some errors were previously reported as coming from the parser 
     * domain but are now reported as coming from the namespace domain. 
     * Second, some warnings were upgraded to errors. 
     * We attempt to compensate for that here. 
     *---------- 
     */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>error</span></a><span class='Operator'>-&GT;</span>code<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> XML_WAR_NS_URI<span class='Operator'>: 
</span>            <a href="xml.c.html#LN1627"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>= </span>XML_ERR_ERROR<span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN1626"><span class='Ref_To_Local'>domain</span></a> <span class='Operator'>= </span>XML_FROM_NAMESPACE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> XML_ERR_NS_DECL_ERROR<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_WAR_NS_URI_RELATIVE<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_WAR_NS_COLUMN<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_NS_ERR_XML_NAMESPACE<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_NS_ERR_UNDEFINED_NAMESPACE<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_NS_ERR_QNAME<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_NS_ERR_ATTRIBUTE_REDEFINED<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_NS_ERR_EMPTY<span class='Operator'>: 
</span>            <a href="xml.c.html#LN1626"><span class='Ref_To_Local'>domain</span></a> <span class='Operator'>= </span>XML_FROM_NAMESPACE<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Decide whether to act on the error or not */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1626"><span class='Ref_To_Local'>domain</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> XML_FROM_PARSER<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_FROM_NONE<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_FROM_MEMORY<span class='Operator'>: 
</span>        <span class='Control'>case</span> XML_FROM_IO<span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Suppress warnings about undeclared entities.  We need to do 
             * this to avoid problems due to not loading DTD definitions. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>error</span></a><span class='Operator'>-&GT;</span>code <span class='Operator'>== </span>XML_WAR_UNDECLARED_ENTITY<span class='Parentheses'>) 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Otherwise, accept error regardless of the parsing purpose */ 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Comment_Multi_Line'>/* Ignore error if only doing well-formedness check */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1620"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN107"><span class='Ref_to_Member'>strictness</span></a> <span class='Operator'>== </span><a href="../../../include/utils/xml.h.html#LN42"><span class='Ref_to_EnumConst'>PG_XML_STRICTNESS_WELLFORMED</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch domain &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Prepare error message in errorBuf */ 
</span>    <a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>error</span></a><span class='Operator'>-&GT;</span>line <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Delimiter'>, </span><span class='String'>"line %d: "</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>error</span></a><span class='Operator'>-&GT;</span>line<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1624"><span class='Ref_To_Local'>name</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Delimiter'>, </span><span class='String'>"element %s: "</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1624"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1618"><span class='Ref_to_Parameter'>error</span></a><span class='Operator'>-&GT;</span>message<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Append context information to errorBuf. 
     * 
     * xmlParserPrintFileContext() uses libxml's "generic" error handler to 
     * write the context.  Since we don't want to duplicate libxml 
     * functionality here, we set up a generic error handler temporarily. 
     * 
     * We use appendStringInfo() directly as libxml's generic error handler. 
     * This should work because it has essentially the same signature as 
     * libxml expects, namely (void *ptr, const char *msg, ...). 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1622"><span class='Ref_To_Local'>input</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1713"></a>        xmlGenericErrorFunc <span class='Declare_Local'>errFuncSaved</span> <span class='Operator'>= </span>xmlGenericError<span class='Delimiter'>; 
</span><a name="LN1714"></a>        <span class='Keyword'>void</span>       <span class='Operator'>*</span><span class='Declare_Local'>errCtxSaved</span> <span class='Operator'>= </span>xmlGenericErrorContext<span class='Delimiter'>; 
</span> 
        xmlSetGenericErrorFunc<span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(</span>xmlGenericErrorFunc<span class='Parentheses'>) </span><a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Add context information to errorBuf */ 
</span>        <a href="xml.c.html#LN124"><span class='Ref_to_Proto'>appendStringInfoLineSeparator</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        xmlParserPrintFileContext<span class='Parentheses'>(</span><a href="xml.c.html#LN1622"><span class='Ref_To_Local'>input</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Restore generic error func */ 
</span>        xmlSetGenericErrorFunc<span class='Parentheses'>(</span><a href="xml.c.html#LN1714"><span class='Ref_To_Local'>errCtxSaved</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1713"><span class='Ref_To_Local'>errFuncSaved</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Get rid of any trailing newlines in errorBuf */ 
</span>    <a href="xml.c.html#LN123"><span class='Ref_to_Proto'>chopStringInfoNewlines</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Legacy error handling mode.  err_occurred is never set, we just add the 
     * message to err_buf.  This mode exists because the xml2 contrib module 
     * uses our error-handling infrastructure, but we don't want to change its 
     * behaviour since it's deprecated anyway.  This is also why we don't 
     * distinguish between notices, warnings and errors here --- the old-style 
     * generic error handler wouldn't have done that either. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1620"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN107"><span class='Ref_to_Member'>strictness</span></a> <span class='Operator'>== </span><a href="../../../include/utils/xml.h.html#LN40"><span class='Ref_to_EnumConst'>PG_XML_STRICTNESS_LEGACY</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN124"><span class='Ref_to_Proto'>appendStringInfoLineSeparator</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1620"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN110"><span class='Ref_to_Member'>err_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1620"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN110"><span class='Ref_to_Member'>err_buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't want to ereport() here because that'd probably leave libxml in 
     * an inconsistent state.  Instead, we remember the error and ereport() 
     * from xml_ereport(). 
     * 
     * Warnings and notices can be reported immediately since they won't cause 
     * a longjmp() out of libxml. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1627"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>&GT;= </span>XML_ERR_ERROR<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN124"><span class='Ref_to_Proto'>appendStringInfoLineSeparator</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1620"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN110"><span class='Ref_to_Member'>err_buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1620"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN110"><span class='Ref_to_Member'>err_buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN1620"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1627"><span class='Ref_To_Local'>level</span></a> <span class='Operator'>&GT;= </span>XML_ERR_WARNING<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN36"><span class='Ref_to_Const'>NOTICE</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1628"><span class='Ref_To_Local'>errorBuf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end xml_errorHandler &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Wrapper for "ereport" function for XML-related errors.  The "msg" 
 * is the SQL-level message; some can be adopted from the SQL/XML 
 * standard.  This function uses "code" to create a textual detail 
 * message.  At the moment, we only need to cover those codes that we 
 * may raise in this file. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1788"></a><span class='Declare_Function'>xml_ereport_by_code</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>level</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>sqlcode</span><span class='Delimiter'>, 
</span><a name="LN1789"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>msg</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1791"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>det</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1789"><span class='Ref_to_Parameter'>code</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> XML_ERR_INVALID_CHAR<span class='Operator'>: 
</span>            <a href="xml.c.html#LN1791"><span class='Ref_To_Local'>det</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Invalid character value."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> XML_ERR_SPACE_REQUIRED<span class='Operator'>: 
</span>            <a href="xml.c.html#LN1791"><span class='Ref_To_Local'>det</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Space required."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> XML_ERR_STANDALONE_VALUE<span class='Operator'>: 
</span>            <a href="xml.c.html#LN1791"><span class='Ref_To_Local'>det</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"standalone accepts only 'yes' or 'no'."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> XML_ERR_VERSION_MISSING<span class='Operator'>: 
</span>            <a href="xml.c.html#LN1791"><span class='Ref_To_Local'>det</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Malformed declaration: missing version."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> XML_ERR_MISSING_ENCODING<span class='Operator'>: 
</span>            <a href="xml.c.html#LN1791"><span class='Ref_To_Local'>det</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Missing encoding in text declaration."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> XML_ERR_XMLDECL_NOT_FINISHED<span class='Operator'>: 
</span>            <a href="xml.c.html#LN1791"><span class='Ref_To_Local'>det</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Parsing XML declaration: '?&GT;' expected."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="xml.c.html#LN1791"><span class='Ref_To_Local'>det</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN138"><span class='Ref_to_Macro'>gettext_noop</span></a><span class='Parentheses'>(</span><span class='String'>"Unrecognized libxml error code: %d."</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch code &raquo; </span> 
 
    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1788"><span class='Ref_to_Parameter'>level</span></a><span class='Delimiter'>, 
</span>            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1788"><span class='Ref_to_Parameter'>sqlcode</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN825"><span class='Ref_to_Func'>errmsg_internal</span></a><span class='Parentheses'>(</span><span class='String'>"%s"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN1789"><span class='Ref_to_Parameter'>msg</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>             <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1791"><span class='Ref_To_Local'>det</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1789"><span class='Ref_to_Parameter'>code</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end xml_ereport_by_code &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Remove all trailing newlines from a StringInfo string 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1829"></a><span class='Declare_Function'>chopStringInfoNewlines</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1829"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="xml.c.html#LN1829"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN1829"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='String'>'\n'</span><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN1829"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>[</span><span class='Operator'>--</span><a href="xml.c.html#LN1829"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='String'>'\0'</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Append a newline after removing any existing trailing newlines 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN1840"></a><span class='Declare_Function'>appendStringInfoLineSeparator</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="xml.c.html#LN123"><span class='Ref_to_Proto'>chopStringInfoNewlines</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1840"><span class='Ref_to_Parameter'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1840"><span class='Ref_to_Parameter'>str</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN37"><span class='Ref_to_Member'>len</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1840"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert one char in the current server encoding to a Unicode codepoint. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> 
<a name="LN1852"></a><span class='Declare_Function'>sqlchar_to_unicode</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1854"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>utf8string</span><span class='Delimiter'>; 
</span><a name="LN1855"></a>    <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>    <span class='Declare_Local'>ret</span><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>];</span>         <span class='Comment_Single_Line'>/* need space for trailing zero */ 
</span> 
    <span class='Comment_Multi_Line'>/* note we're not assuming s is null-terminated */ 
</span>    <a href="xml.c.html#LN1854"><span class='Ref_To_Local'>utf8string</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN567"><span class='Ref_to_Proto'>pg_server_to_any</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1852"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1852"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/mb/pg_wchar.h.html#LN511"><span class='Ref_to_Proto'>pg_encoding_mb2wchar_with_len</span></a><span class='Parentheses'>(</span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1854"><span class='Ref_To_Local'>utf8string</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1855"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/mb/pg_wchar.h.html#LN523"><span class='Ref_to_Proto'>pg_encoding_mblen</span></a><span class='Parentheses'>(</span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1854"><span class='Ref_To_Local'>utf8string</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1854"><span class='Ref_To_Local'>utf8string</span></a> <span class='Operator'>!= </span><a href="xml.c.html#LN1852"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1854"><span class='Ref_To_Local'>utf8string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN1855"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]; 
} 
</span> 
 
<span class='Keyword'>static bool 
</span><a name="LN1871"></a><span class='Declare_Function'>is_valid_xml_namefirst</span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Declare_Parameter'>c</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* (Letter | '_' | ':') */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span>xmlIsBaseCharQ<span class='Parentheses'>(</span><a href="xml.c.html#LN1871"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span>xmlIsIdeographicQ<span class='Parentheses'>(</span><a href="xml.c.html#LN1871"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>|| </span><a href="xml.c.html#LN1871"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>'_'</span> <span class='Operator'>|| </span><a href="xml.c.html#LN1871"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>':'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static bool 
</span><a name="LN1880"></a><span class='Declare_Function'>is_valid_xml_namechar</span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Declare_Parameter'>c</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Letter | Digit | '.' | '-' | '_' | ':' | CombiningChar | Extender */ 
</span>    <span class='Control'>return</span> <span class='Parentheses'>(</span>xmlIsBaseCharQ<span class='Parentheses'>(</span><a href="xml.c.html#LN1880"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) </span><span class='Operator'>|| </span>xmlIsIdeographicQ<span class='Parentheses'>(</span><a href="xml.c.html#LN1880"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>|| </span>xmlIsDigitQ<span class='Parentheses'>(</span><a href="xml.c.html#LN1880"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>|| </span><a href="xml.c.html#LN1880"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>'.'</span> <span class='Operator'>|| </span><a href="xml.c.html#LN1880"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>'-'</span> <span class='Operator'>|| </span><a href="xml.c.html#LN1880"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>'_'</span> <span class='Operator'>|| </span><a href="xml.c.html#LN1880"><span class='Ref_to_Parameter'>c</span></a> <span class='Operator'>== </span><span class='String'>':'</span> 
            <span class='Operator'>|| </span>xmlIsCombiningQ<span class='Parentheses'>(</span><a href="xml.c.html#LN1880"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) 
</span>            <span class='Operator'>|| </span>xmlIsExtenderQ<span class='Parentheses'>(</span><a href="xml.c.html#LN1880"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_LIBXML */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Map SQL identifier to XML name; see SQL/XML:2008 section 9.1. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1896"></a><span class='Declare_Function'>map_sql_identifier_to_xml_name</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>ident</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>fully_escaped</span><span class='Delimiter'>, 
</span><a name="LN1897"></a>                               <span class='Keyword'>bool </span><span class='Declare_Parameter'>escape_period</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN1900"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN1901"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * SQL/XML doesn't make use of this case anywhere, so it's probably a 
     * mistake. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1896"><span class='Ref_to_Parameter'>fully_escaped</span></a> <span class='Operator'>|| !</span><a href="xml.c.html#LN1897"><span class='Ref_to_Parameter'>escape_period</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1900"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1896"><span class='Ref_to_Parameter'>ident</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>':'</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="xml.c.html#LN1896"><span class='Ref_to_Parameter'>ident</span></a> <span class='Operator'>|| </span><a href="xml.c.html#LN1896"><span class='Ref_to_Parameter'>fully_escaped</span></a><span class='Parentheses'>))</span> 
            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1900"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"_x003A_"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'_'</span> <span class='Operator'>&& *</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='String'>'x'</span><span class='Parentheses'>)</span> 
            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1900"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"_x005F_"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1896"><span class='Ref_to_Parameter'>fully_escaped</span></a> <span class='Operator'>&& </span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="xml.c.html#LN1896"><span class='Ref_to_Parameter'>ident</span></a> <span class='Operator'>&& 
</span>                 <a href="../../../port/pgstrcasecmp.c.html#LN67"><span class='Ref_to_Func'>pg_strncasecmp</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><span class='String'>"xml"</span><span class='Delimiter'>, </span><span class='Number'>3</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'x'</span><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1900"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"_x0078_"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1900"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"_x0058_"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1897"><span class='Ref_to_Parameter'>escape_period</span></a> <span class='Operator'>&& *</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'.'</span><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1900"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"_x002E_"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1929"></a>            <a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a>    <span class='Declare_Local'>u</span> <span class='Operator'>= </span><a href="xml.c.html#LN1851"><span class='Ref_to_Func'>sqlchar_to_unicode</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><a href="xml.c.html#LN1896"><span class='Ref_to_Parameter'>ident</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>? !</span><a href="xml.c.html#LN1870"><span class='Ref_to_Func'>is_valid_xml_namefirst</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1929"><span class='Ref_To_Local'>u</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>: !</span><a href="xml.c.html#LN1879"><span class='Ref_to_Func'>is_valid_xml_namechar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1929"><span class='Ref_To_Local'>u</span></a><span class='Parentheses'>))</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1900"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"_x%04X_"</span><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned int</span><span class='Parentheses'>) </span><a href="xml.c.html#LN1929"><span class='Ref_To_Local'>u</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1900"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1901"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for p=ident;*p;p+=pg_mble... &raquo; </span> 
 
    <span class='Control'>return</span> <a href="xml.c.html#LN1900"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span>                           <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span>    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end map_sql_identifier_to_xml_name &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map a Unicode codepoint into the current server encoding. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN1952"></a><span class='Declare_Function'>unicode_to_sqlchar</span><span class='Parentheses'>(</span><a href="../../../include/mb/pg_wchar.h.html#LN24"><span class='Ref_to_Typedef'>pg_wchar</span></a> <span class='Declare_Parameter'>c</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1954"></a>    <span class='Keyword'>char</span>        <span class='Declare_Local'>utf8string</span><span class='Delimiter'>[</span><span class='Number'>8</span><span class='Delimiter'>];</span>  <span class='Comment_Single_Line'>/* need room for trailing zero */ 
</span><a name="LN1955"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="xml.c.html#LN1954"><span class='Ref_To_Local'>utf8string</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1954"><span class='Ref_To_Local'>utf8string</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../mb/wchar.c.html#LN473"><span class='Ref_to_Func'>unicode_to_utf8</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1952"><span class='Ref_to_Parameter'>c</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>unsigned char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN1954"><span class='Ref_To_Local'>utf8string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN1955"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/mb/pg_wchar.h.html#LN566"><span class='Ref_to_Proto'>pg_any_to_server</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1954"><span class='Ref_To_Local'>utf8string</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN1954"><span class='Ref_To_Local'>utf8string</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../fe_utils/mbprint.c.html#LN42"><span class='Ref_to_Const'>PG_UTF8</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Comment_Multi_Line'>/* if pg_any_to_server didn't strdup, we must */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1955"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>== </span><a href="xml.c.html#LN1954"><span class='Ref_To_Local'>utf8string</span></a><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN1955"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1955"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="xml.c.html#LN1955"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Map XML name to SQL identifier; see SQL/XML:2008 section 9.3. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN1972"></a><span class='Declare_Function'>map_xml_name_to_sql_identifier</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1974"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN1975"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1974"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN1972"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>== </span><span class='String'>'_'</span> <span class='Operator'>&& *</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'x'</span> 
            <span class='Operator'>&& </span>isxdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Parentheses'>))</span> 
            <span class='Operator'>&& </span>isxdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>3</span><span class='Parentheses'>))</span> 
            <span class='Operator'>&& </span>isxdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>4</span><span class='Parentheses'>))</span> 
            <span class='Operator'>&& </span>isxdigit<span class='Parentheses'>((</span><span class='Keyword'>unsigned char</span><span class='Parentheses'>) </span><span class='Operator'>*</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>5</span><span class='Parentheses'>))</span> 
            <span class='Operator'>&& *</span><span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>6</span><span class='Parentheses'>)</span> <span class='Operator'>== </span><span class='String'>'_'</span><span class='Parentheses'>)</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1988"></a>            <span class='Keyword'>unsigned int </span><span class='Declare_Local'>u</span><span class='Delimiter'>; 
</span> 
            sscanf<span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+ </span><span class='Number'>2</span><span class='Delimiter'>, </span><span class='String'>"%X"</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN1988"><span class='Ref_To_Local'>u</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1974"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1951"><span class='Ref_to_Func'>unicode_to_sqlchar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1988"><span class='Ref_To_Local'>u</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>+= </span><span class='Number'>6</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../../include/lib/stringinfo.h.html#LN142"><span class='Ref_to_Proto'>appendBinaryStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN1974"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>, </span><a href="../../../include/mb/pg_wchar.h.html#LN521"><span class='Ref_to_Proto'>pg_mblen</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN1975"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN1974"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end map_xml_name_to_sql_identifier &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Map SQL value to XML value; see SQL/XML:2008 section 9.8. 
 * 
 * When xml_escape_strings is true, then certain characters in string 
 * values are replaced by entity references (&lt; etc.), as specified 
 * in SQL/XML:2008 section 9.8 GR 9) a) iii).   This is normally what is 
 * wanted.  The false case is mainly useful when the resulting value 
 * is used with xmlTextWriterWriteAttribute() to write out an 
 * attribute, because that function does the escaping itself. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN2012"></a><span class='Declare_Function'>map_sql_value_to_xml_value</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>type</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>xml_escape_strings</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN181"><span class='Ref_to_Macro'>type_is_array_domain</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2012"><span class='Ref_to_Parameter'>type</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2016"></a>        <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>array</span><span class='Delimiter'>; 
</span><a name="LN2017"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>elmtype</span><span class='Delimiter'>; 
</span><a name="LN2018"></a>        <a href="../../../include/c.h.html#LN254"><span class='Ref_to_Typedef'>int16</span></a>       <span class='Declare_Local'>elmlen</span><span class='Delimiter'>; 
</span><a name="LN2019"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>elmbyval</span><span class='Delimiter'>; 
</span><a name="LN2020"></a>        <span class='Keyword'>char</span>        <span class='Declare_Local'>elmalign</span><span class='Delimiter'>; 
</span><a name="LN2021"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>num_elems</span><span class='Delimiter'>; 
</span><a name="LN2022"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>elem_values</span><span class='Delimiter'>; 
</span><a name="LN2023"></a>        <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>elem_nulls</span><span class='Delimiter'>; 
</span><a name="LN2024"></a>        <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN2025"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN2016"><span class='Ref_To_Local'>array</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN241"><span class='Ref_to_Macro'>DatumGetArrayTypeP</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN2017"><span class='Ref_To_Local'>elmtype</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2016"><span class='Ref_To_Local'>array</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN136"><span class='Ref_to_Proto'>get_typlenbyvalalign</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2017"><span class='Ref_To_Local'>elmtype</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2018"><span class='Ref_To_Local'>elmlen</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2019"><span class='Ref_To_Local'>elmbyval</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2020"><span class='Ref_To_Local'>elmalign</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2016"><span class='Ref_To_Local'>array</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2017"><span class='Ref_To_Local'>elmtype</span></a><span class='Delimiter'>, 
</span>                          <a href="xml.c.html#LN2018"><span class='Ref_To_Local'>elmlen</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2019"><span class='Ref_To_Local'>elmbyval</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2020"><span class='Ref_To_Local'>elmalign</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="xml.c.html#LN2022"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2023"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="xml.c.html#LN2021"><span class='Ref_To_Local'>num_elems</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2024"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2025"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN2025"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="xml.c.html#LN2021"><span class='Ref_To_Local'>num_elems</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN2025"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2023"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN2025"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2024"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;element&GT;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2024"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, 
</span>                                   <a href="../../../include/utils/xml.h.html#LN75"><span class='Ref_to_Proto'>map_sql_value_to_xml_value</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2022"><span class='Ref_To_Local'>elem_values</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN2025"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                              <a href="xml.c.html#LN2017"><span class='Ref_To_Local'>elmtype</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2024"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;/element&GT;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2022"><span class='Ref_To_Local'>elem_values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2023"><span class='Ref_To_Local'>elem_nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>return</span> <a href="xml.c.html#LN2024"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if type_is_array_domain(... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN2056"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typeOut</span><span class='Delimiter'>; 
</span><a name="LN2057"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isvarlena</span><span class='Delimiter'>; 
</span><a name="LN2058"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Flatten domains; the special-case treatments below should apply to, 
         * eg, domains over boolean not just boolean. 
         */ 
</span>        <a href="xml.c.html#LN2012"><span class='Ref_to_Parameter'>type</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN168"><span class='Ref_to_Proto'>getBaseType</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2012"><span class='Ref_to_Parameter'>type</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Special XSD formatting for some data types 
         */ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2012"><span class='Ref_to_Parameter'>type</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN398"><span class='Ref_to_Macro'>DatumGetBool</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>))</span> 
                    <span class='Control'>return</span> <span class='String'>"true"</span><span class='Delimiter'>; 
</span>                <span class='Control'>else</span> 
                    <span class='Control'>return</span> <span class='String'>"false"</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN50"><span class='Ref_to_Const'>DATEOID</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2079"></a>                    <a href="../../../include/utils/date.h.html#LN21"><span class='Ref_to_Typedef'>DateADT</span></a>     <span class='Declare_Local'>date</span><span class='Delimiter'>; 
</span><a name="LN2080"></a>                    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN2081"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                    <a href="xml.c.html#LN2079"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>= </span><a href="../../../include/utils/date.h.html#LN51"><span class='Ref_to_Macro'>DatumGetDateADT</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Comment_Multi_Line'>/* XSD doesn't support infinite values */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/date.h.html#LN41"><span class='Ref_to_Macro'>DATE_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2079"><span class='Ref_To_Local'>date</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"date out of range"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"XML does not support infinite date values."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/datetime.h.html#LN290"><span class='Ref_to_Proto'>j2date</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2079"><span class='Ref_To_Local'>date</span></a> <span class='Operator'>+ </span><a href="../../../include/datatype/timestamp.h.html#LN162"><span class='Ref_to_Const'>POSTGRES_EPOCH_JDATE</span></a><span class='Delimiter'>, 
</span>                           <span class='Operator'>&</span><span class='Parentheses'>(</span><a href="xml.c.html#LN2080"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN31"><span class='Ref_to_Member'>tm_year</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="xml.c.html#LN2080"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN30"><span class='Ref_to_Member'>tm_mon</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="xml.c.html#LN2080"><span class='Ref_To_Local'>tm</span></a><span class='Operator'>.</span><a href="../../../include/pgtime.h.html#LN29"><span class='Ref_to_Member'>tm_mday</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <a href="../../../include/utils/datetime.h.html#LN316"><span class='Ref_to_Proto'>EncodeDateOnly</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2080"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="../../../include/miscadmin.h.html#LN215"><span class='Ref_to_Const'>USE_XSD_DATES</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2081"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>return</span> <a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2081"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN52"><span class='Ref_to_Const'>TIMESTAMPOID</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2099"></a>                    <a href="../../../include/datatype/timestamp.h.html#LN37"><span class='Ref_to_Typedef'>Timestamp</span></a>   <span class='Declare_Local'>timestamp</span><span class='Delimiter'>; 
</span><a name="LN2100"></a>                    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN2101"></a>                    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN2102"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                    <a href="xml.c.html#LN2099"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN26"><span class='Ref_to_Macro'>DatumGetTimestamp</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* XSD doesn't support infinite values */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2099"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"XML does not support infinite timestamp values."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2099"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2100"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2101"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN315"><span class='Ref_to_Proto'>EncodeDateTime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2100"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2101"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="../../../include/miscadmin.h.html#LN215"><span class='Ref_to_Const'>USE_XSD_DATES</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2102"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>return</span> <a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2102"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN53"><span class='Ref_to_Const'>TIMESTAMPTZOID</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2124"></a>                    <a href="../../../interfaces/ecpg/include/pgtypes_timestamp.h.html#LN9"><span class='Ref_to_Typedef'>TimestampTz</span></a> <span class='Declare_Local'>timestamp</span><span class='Delimiter'>; 
</span><a name="LN2125"></a>                    <span class='Control'>struct</span> <a href="../../../include/pgtime.h.html#LN24"><span class='Ref_to_Struct'>pg_tm</span></a> <span class='Declare_Local'>tm</span><span class='Delimiter'>; 
</span><a name="LN2126"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>tz</span><span class='Delimiter'>; 
</span><a name="LN2127"></a>                    <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN9"><span class='Ref_to_Typedef'>fsec_t</span></a>      <span class='Declare_Local'>fsec</span><span class='Delimiter'>; 
</span><a name="LN2128"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tzn</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2129"></a>                    <span class='Keyword'>char</span>        <span class='Declare_Local'>buf</span><span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN195"><span class='Ref_to_Const'>MAXDATELEN</span></a> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
                    <a href="xml.c.html#LN2124"><span class='Ref_To_Local'>timestamp</span></a> <span class='Operator'>= </span><a href="../../../include/utils/timestamp.h.html#LN26"><span class='Ref_to_Macro'>DatumGetTimestamp</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Comment_Multi_Line'>/* XSD doesn't support infinite values */ 
</span>                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/datatype/timestamp.h.html#LN121"><span class='Ref_to_Macro'>TIMESTAMP_NOT_FINITE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2124"><span class='Ref_To_Local'>timestamp</span></a><span class='Parentheses'>))</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"XML does not support infinite timestamp values."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/timestamp.h.html#LN84"><span class='Ref_to_Proto'>timestamp2tm</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2124"><span class='Ref_To_Local'>timestamp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2126"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2125"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2127"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2128"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                        <a href="../../../interfaces/ecpg/pgtypeslib/dt.h.html#LN315"><span class='Ref_to_Proto'>EncodeDateTime</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2125"><span class='Ref_To_Local'>tm</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2127"><span class='Ref_To_Local'>fsec</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2126"><span class='Ref_To_Local'>tz</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2128"><span class='Ref_To_Local'>tzn</span></a><span class='Delimiter'>, </span><a href="../../../include/miscadmin.h.html#LN215"><span class='Ref_to_Const'>USE_XSD_DATES</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2129"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATETIME_VALUE_OUT_OF_RANGE<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"timestamp out of range"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>return</span> <a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2129"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
<span class='Directive'>#ifdef</span> USE_LIBXML 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN18"><span class='Ref_to_Const'>BYTEAOID</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN2152"></a>                    <a href="../../../include/c.h.html#LN451"><span class='Ref_to_Typedef'>bytea</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>bstr</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN254"><span class='Ref_to_Macro'>DatumGetByteaPP</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2153"></a>                    <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xmlerrcxt</span><span class='Delimiter'>; 
</span><a name="LN2154"></a>                    <span class='Keyword'>volatile </span>xmlBufferPtr <span class='Declare_Local'>buf</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2155"></a>                    <span class='Keyword'>volatile </span>xmlTextWriterPtr <span class='Declare_Local'>writer</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN2156"></a>                    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
                    <a href="xml.c.html#LN2153"><span class='Ref_To_Local'>xmlerrcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN56"><span class='Ref_to_Proto'>pg_xml_init</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN43"><span class='Ref_to_EnumConst'>PG_XML_STRICTNESS_ALL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="xml.c.html#LN2154"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span>xmlBufferCreate<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2154"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN2153"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2153"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                                        <span class='String'>"could not allocate xmlBuffer"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="xml.c.html#LN2155"><span class='Ref_To_Local'>writer</span></a> <span class='Operator'>= </span>xmlNewTextWriterMemory<span class='Parentheses'>(</span><a href="xml.c.html#LN2154"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2155"><span class='Ref_To_Local'>writer</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN2153"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>                            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2153"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                                        <span class='String'>"could not allocate xmlTextWriter"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN95"><span class='Ref_to_Global_Var'>xmlbinary</span></a> <span class='Operator'>== </span><a href="../../../include/utils/xml.h.html#LN34"><span class='Ref_to_EnumConst'>XMLBINARY_BASE64</span></a><span class='Parentheses'>) 
</span>                            xmlTextWriterWriteBase64<span class='Parentheses'>(</span><a href="xml.c.html#LN2155"><span class='Ref_To_Local'>writer</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2152"><span class='Ref_To_Local'>bstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2152"><span class='Ref_To_Local'>bstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Control'>else</span> 
                            xmlTextWriterWriteBinHex<span class='Parentheses'>(</span><a href="xml.c.html#LN2155"><span class='Ref_To_Local'>writer</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2152"><span class='Ref_To_Local'>bstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <span class='Number'>0</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2152"><span class='Ref_To_Local'>bstr</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
                        <span class='Comment_Multi_Line'>/* we MUST do this now to flush data out to the buffer */ 
</span>                        xmlFreeTextWriter<span class='Parentheses'>(</span><a href="xml.c.html#LN2155"><span class='Ref_To_Local'>writer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="xml.c.html#LN2155"><span class='Ref_To_Local'>writer</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
                        <a href="xml.c.html#LN2156"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>((</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Parentheses'>) </span>xmlBufferContent<span class='Parentheses'>(</span><a href="xml.c.html#LN2154"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>{ 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2155"><span class='Ref_To_Local'>writer</span></a><span class='Parentheses'>) 
</span>                            xmlFreeTextWriter<span class='Parentheses'>(</span><a href="xml.c.html#LN2155"><span class='Ref_To_Local'>writer</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2154"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>) 
</span>                            xmlBufferFree<span class='Parentheses'>(</span><a href="xml.c.html#LN2154"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2153"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
                    xmlBufferFree<span class='Parentheses'>(</span><a href="xml.c.html#LN2154"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2153"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>return</span> <a href="xml.c.html#LN2156"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_LIBXML */ 
</span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch type &raquo; </span> 
 
        <span class='Comment_Multi_Line'>/* 
         * otherwise, just use the type's native text representation 
         */ 
</span>        <a href="../../../include/utils/lsyscache.h.html#LN162"><span class='Ref_to_Proto'>getTypeOutputInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2012"><span class='Ref_to_Parameter'>type</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2056"><span class='Ref_To_Local'>typeOut</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2057"><span class='Ref_To_Local'>isvarlena</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN2058"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN647"><span class='Ref_to_Proto'>OidOutputFunctionCall</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2056"><span class='Ref_To_Local'>typeOut</span></a><span class='Delimiter'>, </span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* ... exactly as-is for XML, and when escaping is not wanted */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2012"><span class='Ref_to_Parameter'>type</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN358"><span class='Ref_to_Const'>XMLOID</span></a> <span class='Operator'>|| !</span><a href="xml.c.html#LN2012"><span class='Ref_to_Parameter'>xml_escape_strings</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>return</span> <a href="xml.c.html#LN2058"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* otherwise, translate special characters as needed */ 
</span>        <span class='Control'>return</span> <a href="../../../include/utils/xml.h.html#LN71"><span class='Ref_to_Proto'>escape_xml</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2058"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end map_sql_value_to_xml_value &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Escape characters in text that have special meanings in XML. 
 * 
 * Returns a palloc'd string. 
 * 
 * NB: this is intentionally not dependent on libxml. 
 */ 
</span><span class='Keyword'>char </span><span class='Operator'>* 
</span><a name="LN2231"></a><span class='Declare_Function'>escape_xml</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>str</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2233"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN2234"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>p</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2233"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2234"><span class='Ref_To_Local'>p</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2231"><span class='Ref_to_Parameter'>str</span></a><span class='Delimiter'>; </span><span class='Operator'>*</span><a href="xml.c.html#LN2234"><span class='Ref_To_Local'>p</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN2234"><span class='Ref_To_Local'>p</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>switch</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN2234"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <span class='String'>'&'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2233"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"&amp;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'&LT;'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2233"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"&lt;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'&GT;'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2233"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"&gt;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>case</span> <span class='String'>'\r'</span><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2233"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='String'>"&#x0d;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>            <span class='Control'>default</span><span class='Operator'>: 
</span>                <a href="../../../include/lib/stringinfo.h.html#LN126"><span class='Ref_to_Macro'>appendStringInfoCharMacro</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2233"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Operator'>*</span><a href="xml.c.html#LN2234"><span class='Ref_To_Local'>p</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for p=str;*p;p++ &raquo; </span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN2233"><span class='Ref_To_Local'>buf</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end escape_xml &raquo; </span> 
 
 
<span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN2263"></a><span class='Declare_Function'>_SPI_strdup</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>s</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2265"></a>    size_t      <span class='Declare_Local'>len</span> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN2263"><span class='Ref_to_Parameter'>s</span></a><span class='Parentheses'>) </span><span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>; 
</span><a name="LN2266"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ret</span> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN131"><span class='Ref_to_Proto'>SPI_palloc</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2265"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    memcpy<span class='Parentheses'>(</span><a href="xml.c.html#LN2266"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2263"><span class='Ref_to_Parameter'>s</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2265"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="xml.c.html#LN2266"><span class='Ref_To_Local'>ret</span></a><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * SQL to XML mapping functions 
 * 
 * What follows below was at one point intentionally organized so that 
 * you can read along in the SQL/XML standard. The functions are 
 * mostly split up the way the clauses lay out in the standards 
 * document, and the identifiers are also aligned with the standard 
 * text.  Unfortunately, SQL/XML:2006 reordered the clauses 
 * differently than SQL/XML:2003, so the order below doesn't make much 
 * sense anymore. 
 * 
 * There are many things going on there: 
 * 
 * There are two kinds of mappings: Mapping SQL data (table contents) 
 * to XML documents, and mapping SQL structure (the "schema") to XML 
 * Schema.  And there are functions that do both at the same time. 
 * 
 * Then you can map a database, a schema, or a table, each in both 
 * ways.  This breaks down recursively: Mapping a database invokes 
 * mapping schemas, which invokes mapping tables, which invokes 
 * mapping rows, which invokes mapping columns, although you can't 
 * call the last two from the outside.  Because of this, there are a 
 * number of xyz_internal() functions which are to be called both from 
 * the function manager wrapper and from some upper layer in a 
 * recursive call. 
 * 
 * See the documentation about what the common function arguments 
 * nulls, tableforest, and targetns mean. 
 * 
 * Some style guidelines for XML output: Use double quotes for quoting 
 * XML attributes.  Indent XML elements by two spaces, but remember 
 * that a lot of code is called recursively at different levels, so 
 * it's better not to indent rather than create output that indents 
 * and outdents weirdly.  Add newlines to make the output look nice. 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Visibility of objects for XML mappings; see SQL/XML:2008 section 
 * 4.10.8. 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a query, which must return type oid as first column, produce 
 * a list of Oids with the query results. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN2320"></a><span class='Declare_Function'>query_to_oid_list</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2322"></a>    <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN2323"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>list</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN81"><span class='Ref_to_Proto'>SPI_execute</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2320"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN2322"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN2322"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2329"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>oid</span><span class='Delimiter'>; 
</span><a name="LN2330"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN2329"><span class='Ref_To_Local'>oid</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN2322"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                            <a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, 
</span>                            <span class='Number'>1</span><span class='Delimiter'>, 
</span>                            <span class='Operator'>&</span><a href="xml.c.html#LN2330"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN2330"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN2323"><span class='Ref_To_Local'>list</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN162"><span class='Ref_to_Func'>lappend_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2323"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2329"><span class='Ref_To_Local'>oid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN2323"><span class='Ref_To_Local'>list</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end query_to_oid_list &raquo; </span> 
 
 
<span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN2345"></a><span class='Declare_Function'>schema_get_xml_visible_tables</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nspid</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2347"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2347"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2347"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT oid FROM pg_catalog.pg_class"</span> 
                     <span class='String'>" WHERE relnamespace = %u AND relkind IN ("</span> 
                     <a href="../../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) </span><span class='String'>","</span> 
                     <a href="../../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) </span><span class='String'>","</span> 
                     <a href="../../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) </span><span class='String'>")"</span> 
                     <span class='String'>" AND pg_catalog.has_table_privilege (oid, 'SELECT')"</span> 
                     <span class='String'>" ORDER BY relname;"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2345"><span class='Ref_to_Parameter'>nspid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN2319"><span class='Ref_to_Func'>query_to_oid_list</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2347"><span class='Ref_To_Local'>query</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Including the system schemas is probably not useful for a database 
 * mapping. 
 */ 
</span><a name="LN2366"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>XML_VISIBLE_SCHEMAS_EXCLUDE</span> <span class='String'>"(nspname ~ '^pg_' OR nspname = 'information_schema')"</span> 
 
<a name="LN2368"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>XML_VISIBLE_SCHEMAS</span> <span class='String'>"SELECT oid FROM pg_catalog.pg_namespace WHERE pg_catalog.has_schema_privilege (oid, 'USAGE') AND NOT "</span> <a href="xml.c.html#LN2366"><span class='Ref_to_Const'>XML_VISIBLE_SCHEMAS_EXCLUDE</span></a> 
 
 
<span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN2372"></a><span class='Declare_Function'>database_get_xml_visible_schemas</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>return</span> <a href="xml.c.html#LN2319"><span class='Ref_to_Func'>query_to_oid_list</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2368"><span class='Ref_to_Const'>XML_VISIBLE_SCHEMAS</span></a> <span class='String'>" ORDER BY nspname;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>* 
</span><a name="LN2379"></a><span class='Declare_Function'>database_get_xml_visible_tables</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* At the moment there is no order required here. */ 
</span>    <span class='Control'>return</span> <a href="xml.c.html#LN2319"><span class='Ref_to_Func'>query_to_oid_list</span></a><span class='Parentheses'>(</span><span class='String'>"SELECT oid FROM pg_catalog.pg_class"</span> 
                             <span class='String'>" WHERE relkind IN ("</span> 
                             <a href="../../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN159"><span class='Ref_to_Const'>RELKIND_RELATION</span></a><span class='Parentheses'>) </span><span class='String'>","</span> 
                             <a href="../../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN164"><span class='Ref_to_Const'>RELKIND_MATVIEW</span></a><span class='Parentheses'>) </span><span class='String'>","</span> 
                             <a href="../../../include/c.h.html#LN161"><span class='Ref_to_Macro'>CppAsString2</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN163"><span class='Ref_to_Const'>RELKIND_VIEW</span></a><span class='Parentheses'>) </span><span class='String'>")"</span> 
                <span class='String'>" AND pg_catalog.has_table_privilege(pg_class.oid, 'SELECT')"</span> 
                          <span class='String'>" AND relnamespace IN ("</span> <a href="xml.c.html#LN2368"><span class='Ref_to_Const'>XML_VISIBLE_SCHEMAS</span></a> <span class='String'>");"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Map SQL table to XML and/or XML Schema document; see SQL/XML:2008 
 * section 9.11. 
 */ 
</span> 
<span class='Keyword'>static </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> 
<a name="LN2398"></a><span class='Declare_Function'>table_to_xml_internal</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, 
</span><a name="LN2399"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>xmlschema</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, 
</span><a name="LN2400"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>top_level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2402"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>query</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2402"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2402"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='String'>"SELECT * FROM %s"</span><span class='Delimiter'>, 
</span>                     <a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="regproc.c.html#LN970"><span class='Ref_to_Func'>regclassout</span></a><span class='Delimiter'>, 
</span>                                                  <a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2398"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))))</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <a href="xml.c.html#LN155"><span class='Ref_to_Proto'>query_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2402"><span class='Ref_To_Local'>query</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2398"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                 <a href="xml.c.html#LN2399"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2399"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2399"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Delimiter'>, 
</span>                                 <a href="xml.c.html#LN2400"><span class='Ref_to_Parameter'>targetns</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2400"><span class='Ref_to_Parameter'>top_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2415"></a><span class='Declare_Function'>table_to_xml</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2417"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2418"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2419"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2420"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2397"><span class='Ref_to_Func'>table_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2417"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                          <a href="xml.c.html#LN2418"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2419"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, 
</span>                                                           <a href="xml.c.html#LN2420"><span class='Ref_To_Local'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2429"></a><span class='Declare_Function'>query_to_xml</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2431"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2432"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2433"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2434"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN155"><span class='Ref_to_Proto'>query_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2431"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                    <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2432"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2433"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, 
</span>                                                           <a href="xml.c.html#LN2434"><span class='Ref_To_Local'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2443"></a><span class='Declare_Function'>cursor_to_xml</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2445"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2446"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>count</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN233"><span class='Ref_to_Macro'>PG_GETARG_INT32</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2447"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2448"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2449"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>4</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
<a name="LN2451"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2452"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span><a name="LN2453"></a>    <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2451"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN2448"><span class='Ref_To_Local'>tableforest</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN151"><span class='Ref_to_Proto'>xmldata_root_element_start</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2451"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"table"</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2449"><span class='Ref_To_Local'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2451"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN2452"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN147"><span class='Ref_to_Proto'>SPI_cursor_find</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2445"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2452"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_CURSOR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cursor \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2445"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN148"><span class='Ref_to_Proto'>SPI_cursor_fetch</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2452"><span class='Ref_To_Local'>portal</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2446"><span class='Ref_To_Local'>count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2453"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN2453"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN2453"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN169"><span class='Ref_to_Proto'>SPI_sql_row_to_xmlelement</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2453"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN2451"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2447"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                  <a href="xml.c.html#LN2448"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2449"><span class='Ref_To_Local'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN2448"><span class='Ref_To_Local'>tableforest</span></a><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN154"><span class='Ref_to_Proto'>xmldata_root_element_end</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2451"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"table"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN2451"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end cursor_to_xml &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Write the start tag of the root element of a data mapping. 
 * 
 * top_level means that this is the very top level of the eventual 
 * output.  For example, when the user calls table_to_xml, then a call 
 * with a table name to this function is the top level.  When the user 
 * calls database_to_xml, then a call with a schema name to this 
 * function is not the top level.  If top_level is false, then the XML 
 * namespace declarations are omitted, because they supposedly already 
 * appeared earlier in the output.  Repeating them is not wrong, but 
 * it looks ugly. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2497"></a><span class='Declare_Function'>xmldata_root_element_start</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>eltname</span><span class='Delimiter'>, 
</span><a name="LN2498"></a>                           <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>xmlschema</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Delimiter'>, 
</span><a name="LN2499"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>top_level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* This isn't really wrong but currently makes no sense. */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="xml.c.html#LN2499"><span class='Ref_to_Parameter'>top_level</span></a> <span class='Operator'>|| !</span><a href="xml.c.html#LN2498"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2497"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;%s"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2497"><span class='Ref_to_Parameter'>eltname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2499"><span class='Ref_to_Parameter'>top_level</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2497"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>" xmlns:xsi=\""</span> <a href="xml.c.html#LN226"><span class='Ref_to_Const'>NAMESPACE_XSI</span></a> <span class='String'>"\""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN2498"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2497"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>" xmlns=\"%s\""</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2498"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2498"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* FIXME: better targets */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN2498"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2497"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>" xsi:schemaLocation=\"%s #\""</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2498"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2497"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>" xsi:noNamespaceSchemaLocation=\"#\""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2497"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end xmldata_root_element_start &raquo; </span> 
 
 
<span class='Keyword'>static void 
</span><a name="LN2524"></a><span class='Declare_Function'>xmldata_root_element_end</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>eltname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2524"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;/%s&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2524"><span class='Ref_to_Parameter'>eltname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> 
<a name="LN2531"></a><span class='Declare_Function'>query_to_xml_internal</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>query</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablename</span><span class='Delimiter'>, 
</span><a name="LN2532"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>xmlschema</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, 
</span><a name="LN2533"></a>                      <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>top_level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2535"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2536"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>xmltn</span><span class='Delimiter'>; 
</span><a name="LN2537"></a>    <a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a>      <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2531"><span class='Ref_to_Parameter'>tablename</span></a><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN2536"><span class='Ref_To_Local'>xmltn</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2531"><span class='Ref_to_Parameter'>tablename</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="xml.c.html#LN2536"><span class='Ref_To_Local'>xmltn</span></a> <span class='Operator'>= </span><span class='String'>"table"</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2535"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/executor/spi.h.html#LN81"><span class='Ref_to_Proto'>SPI_execute</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2531"><span class='Ref_to_Parameter'>query</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Operator'>!= </span><a href="../../../include/executor/spi.h.html#LN53"><span class='Ref_to_Const'>SPI_OK_SELECT</span></a><span class='Parentheses'>)</span> 
        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATA_EXCEPTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid query"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN2532"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN151"><span class='Ref_to_Proto'>xmldata_root_element_start</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2535"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2536"><span class='Ref_To_Local'>xmltn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2532"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Delimiter'>, 
</span>                                   <a href="xml.c.html#LN2533"><span class='Ref_to_Parameter'>targetns</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2533"><span class='Ref_to_Parameter'>top_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2535"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2532"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2535"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2532"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2537"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN2537"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="../../executor/spi.c.html#LN38"><span class='Ref_to_Global_Var'>SPI_processed</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN2537"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN169"><span class='Ref_to_Proto'>SPI_sql_row_to_xmlelement</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2537"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2535"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2531"><span class='Ref_to_Parameter'>tablename</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2532"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, 
</span>                                  <a href="xml.c.html#LN2532"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2533"><span class='Ref_to_Parameter'>targetns</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2533"><span class='Ref_to_Parameter'>top_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN2532"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN154"><span class='Ref_to_Proto'>xmldata_root_element_end</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2535"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2536"><span class='Ref_To_Local'>xmltn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN2535"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end query_to_xml_internal &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2576"></a><span class='Declare_Function'>table_to_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2578"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2579"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2580"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2581"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2582"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2583"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2583"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2578"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN2582"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN158"><span class='Ref_to_Proto'>map_sql_table_to_xmlschema</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2583"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2578"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2579"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                        <a href="xml.c.html#LN2580"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2581"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2583"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN450"><span class='Ref_to_Func'>cstring_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2582"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2595"></a><span class='Declare_Function'>query_to_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2597"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2598"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2599"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2600"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2601"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2602"></a>    <a href="../../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN2603"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="xml.c.html#LN2602"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN99"><span class='Ref_to_Proto'>SPI_prepare</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2597"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_prepare(\"%s\") failed"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2597"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="xml.c.html#LN2603"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN138"><span class='Ref_to_Proto'>SPI_cursor_open</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2602"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_cursor_open(\"%s\") failed"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2597"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2601"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2262"><span class='Ref_to_Func'>_SPI_strdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN158"><span class='Ref_to_Proto'>map_sql_table_to_xmlschema</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2603"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>, 
</span>                                                    <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2598"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                                    <a href="xml.c.html#LN2599"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2600"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN152"><span class='Ref_to_Proto'>SPI_cursor_close</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2603"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN450"><span class='Ref_to_Func'>cstring_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2601"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end query_to_xmlschema &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2624"></a><span class='Declare_Function'>cursor_to_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2626"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>name</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2627"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2628"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2629"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2630"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>xmlschema</span><span class='Delimiter'>; 
</span><a name="LN2631"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN2631"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN147"><span class='Ref_to_Proto'>SPI_cursor_find</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2626"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2631"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_UNDEFINED_CURSOR<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"cursor \"%s\" does not exist"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2626"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2630"><span class='Ref_To_Local'>xmlschema</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2262"><span class='Ref_to_Func'>_SPI_strdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN158"><span class='Ref_to_Proto'>map_sql_table_to_xmlschema</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2631"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>, 
</span>                                                       <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2627"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                                     <a href="xml.c.html#LN2628"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2629"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN450"><span class='Ref_to_Func'>cstring_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2630"><span class='Ref_To_Local'>xmlschema</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end cursor_to_xmlschema &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2650"></a><span class='Declare_Function'>table_to_xml_and_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2652"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN239"><span class='Ref_to_Macro'>PG_GETARG_OID</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2653"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2654"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2655"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2656"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span><a name="LN2657"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>xmlschema</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2656"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2652"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN2657"><span class='Ref_To_Local'>xmlschema</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN158"><span class='Ref_to_Proto'>map_sql_table_to_xmlschema</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2656"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2652"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2653"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                           <a href="xml.c.html#LN2654"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2655"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2656"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2397"><span class='Ref_to_Func'>table_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2652"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, 
</span>                                               <a href="xml.c.html#LN2657"><span class='Ref_To_Local'>xmlschema</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2653"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2654"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, 
</span>                                                           <a href="xml.c.html#LN2655"><span class='Ref_To_Local'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2671"></a><span class='Declare_Function'>query_to_xml_and_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2673"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>query</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2674"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2675"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2676"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
<a name="LN2678"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>xmlschema</span><span class='Delimiter'>; 
</span><a name="LN2679"></a>    <a href="../../../include/executor/spi.h.html#LN33"><span class='Ref_to_Typedef'>SPIPlanPtr</span></a>  <span class='Declare_Local'>plan</span><span class='Delimiter'>; 
</span><a name="LN2680"></a>    <a href="../../../include/utils/portal.h.html#LN111"><span class='Ref_to_Typedef'>Portal</span></a>      <span class='Declare_Local'>portal</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="xml.c.html#LN2679"><span class='Ref_To_Local'>plan</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN99"><span class='Ref_to_Proto'>SPI_prepare</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2673"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_prepare(\"%s\") failed"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2673"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>((</span><a href="xml.c.html#LN2680"><span class='Ref_To_Local'>portal</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN138"><span class='Ref_to_Proto'>SPI_cursor_open</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2679"><span class='Ref_To_Local'>plan</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"SPI_cursor_open(\"%s\") failed"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2673"><span class='Ref_To_Local'>query</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2678"><span class='Ref_To_Local'>xmlschema</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2262"><span class='Ref_to_Func'>_SPI_strdup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN158"><span class='Ref_to_Proto'>map_sql_table_to_xmlschema</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2680"><span class='Ref_To_Local'>portal</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/portal.h.html#LN154"><span class='Ref_to_Member'>tupDesc</span></a><span class='Delimiter'>, 
</span>                                  <a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2674"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2675"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2676"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN152"><span class='Ref_to_Proto'>SPI_cursor_close</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2680"><span class='Ref_To_Local'>portal</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN155"><span class='Ref_to_Proto'>query_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2673"><span class='Ref_To_Local'>query</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                               <a href="xml.c.html#LN2678"><span class='Ref_To_Local'>xmlschema</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2674"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2675"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, 
</span>                                                           <a href="xml.c.html#LN2676"><span class='Ref_To_Local'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end query_to_xml_and_xmlschema &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map SQL schema to XML and/or XML Schema document; see SQL/XML:2008 
 * sections 9.13, 9.14. 
 */ 
</span> 
<span class='Keyword'>static </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> 
<a name="LN2707"></a><span class='Declare_Function'>schema_to_xml_internal</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nspid</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>xmlschema</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN2708"></a>                       <span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>top_level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2710"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2711"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>xmlsn</span><span class='Delimiter'>; 
</span><a name="LN2712"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>relid_list</span><span class='Delimiter'>; 
</span><a name="LN2713"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2711"><span class='Ref_To_Local'>xmlsn</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2707"><span class='Ref_to_Parameter'>nspid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN2710"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN151"><span class='Ref_to_Proto'>xmldata_root_element_start</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2710"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2711"><span class='Ref_To_Local'>xmlsn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2707"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2708"><span class='Ref_to_Parameter'>targetns</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2708"><span class='Ref_to_Parameter'>top_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2710"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2707"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2710"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2707"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2712"><span class='Ref_To_Local'>relid_list</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2344"><span class='Ref_to_Func'>schema_get_xml_visible_tables</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2707"><span class='Ref_to_Parameter'>nspid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2713"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2712"><span class='Ref_To_Local'>relid_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2731"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2713"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2732"></a>        <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>subres</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN2732"><span class='Ref_To_Local'>subres</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2397"><span class='Ref_to_Func'>table_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2731"><span class='Ref_To_Local'>relid</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2707"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2708"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Delimiter'>, 
</span>                                       <a href="xml.c.html#LN2708"><span class='Ref_to_Parameter'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2710"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2732"><span class='Ref_To_Local'>subres</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2710"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN154"><span class='Ref_to_Proto'>xmldata_root_element_end</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2710"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2711"><span class='Ref_To_Local'>xmlsn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN2710"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end schema_to_xml_internal &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2750"></a><span class='Declare_Function'>schema_to_xml</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2752"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>name</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2753"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2754"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2755"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
<a name="LN2757"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schemaname</span><span class='Delimiter'>; 
</span><a name="LN2758"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspid</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2757"><span class='Ref_To_Local'>schemaname</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN2752"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN2758"><span class='Ref_To_Local'>nspid</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN113"><span class='Ref_to_Proto'>LookupExplicitNamespace</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2757"><span class='Ref_To_Local'>schemaname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2706"><span class='Ref_to_Func'>schema_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2758"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                       <a href="xml.c.html#LN2753"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2754"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2755"><span class='Ref_To_Local'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Write the start element of the root element of an XML Schema mapping. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN2772"></a><span class='Declare_Function'>xsd_schema_element_start</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2772"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"&LT;xsd:schema\n"</span> 
                           <span class='String'>"    xmlns:xsd=\""</span> <a href="xml.c.html#LN225"><span class='Ref_to_Const'>NAMESPACE_XSD</span></a> <span class='String'>"\""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN2772"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2772"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"\n"</span> 
                         <span class='String'>"    targetNamespace=\"%s\"\n"</span> 
                         <span class='String'>"    elementFormDefault=\"qualified\""</span><span class='Delimiter'>, 
</span>                         <a href="xml.c.html#LN2772"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2772"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"&GT;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static void 
</span><a name="LN2789"></a><span class='Declare_Function'>xsd_schema_element_end</span><span class='Parentheses'>(</span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2789"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;/xsd:schema&GT;"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> 
<a name="LN2796"></a><span class='Declare_Function'>schema_to_xmlschema_internal</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>schemaname</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN2797"></a>                             <span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2799"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspid</span><span class='Delimiter'>; 
</span><a name="LN2800"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>relid_list</span><span class='Delimiter'>; 
</span><a name="LN2801"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tupdesc_list</span><span class='Delimiter'>; 
</span><a name="LN2802"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN2803"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2803"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2799"><span class='Ref_To_Local'>nspid</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN113"><span class='Ref_to_Proto'>LookupExplicitNamespace</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2796"><span class='Ref_to_Parameter'>schemaname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2771"><span class='Ref_to_Func'>xsd_schema_element_start</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2803"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2797"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2800"><span class='Ref_To_Local'>relid_list</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2344"><span class='Ref_to_Func'>schema_get_xml_visible_tables</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2799"><span class='Ref_To_Local'>nspid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2801"><span class='Ref_To_Local'>tupdesc_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2802"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2800"><span class='Ref_To_Local'>relid_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2818"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN2818"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2802"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN2801"><span class='Ref_To_Local'>tupdesc_list</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2801"><span class='Ref_To_Local'>tupdesc_list</span></a><span class='Delimiter'>, </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2818"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2818"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2803"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                           <a href="xml.c.html#LN167"><span class='Ref_to_Proto'>map_sql_typecoll_to_xmlschema_types</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2801"><span class='Ref_To_Local'>tupdesc_list</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2803"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                         <a href="xml.c.html#LN160"><span class='Ref_to_Proto'>map_sql_schema_to_xmlschema_types</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2799"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2800"><span class='Ref_To_Local'>relid_list</span></a><span class='Delimiter'>, 
</span>                                              <a href="xml.c.html#LN2796"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2797"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2797"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2788"><span class='Ref_to_Func'>xsd_schema_element_end</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2803"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN2803"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end schema_to_xmlschema_internal &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2841"></a><span class='Declare_Function'>schema_to_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2843"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>name</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2844"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2845"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2846"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2795"><span class='Ref_to_Func'>schema_to_xmlschema_internal</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN2843"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                             <a href="xml.c.html#LN2844"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2845"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2846"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2854"></a><span class='Declare_Function'>schema_to_xml_and_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2856"></a>    <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>name</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN242"><span class='Ref_to_Macro'>PG_GETARG_NAME</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2857"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2858"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2859"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>3</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2860"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schemaname</span><span class='Delimiter'>; 
</span><a name="LN2861"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspid</span><span class='Delimiter'>; 
</span><a name="LN2862"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>xmlschema</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2860"><span class='Ref_To_Local'>schemaname</span></a> <span class='Operator'>= </span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN2856"><span class='Ref_To_Local'>name</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN2861"><span class='Ref_To_Local'>nspid</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/namespace.h.html#LN113"><span class='Ref_to_Proto'>LookupExplicitNamespace</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2860"><span class='Ref_To_Local'>schemaname</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2862"><span class='Ref_To_Local'>xmlschema</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2795"><span class='Ref_to_Func'>schema_to_xmlschema_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2860"><span class='Ref_To_Local'>schemaname</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2857"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                             <a href="xml.c.html#LN2858"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2859"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2706"><span class='Ref_to_Func'>schema_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2861"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, 
</span>                                                      <a href="xml.c.html#LN2862"><span class='Ref_To_Local'>xmlschema</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2857"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                              <a href="xml.c.html#LN2858"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2859"><span class='Ref_To_Local'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end schema_to_xml_and_xmlschema &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map SQL database to XML and/or XML Schema document; see SQL/XML:2008 
 * sections 9.16, 9.17. 
 */ 
</span> 
<span class='Keyword'>static </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> 
<a name="LN2882"></a><span class='Declare_Function'>database_to_xml_internal</span><span class='Parentheses'>(</span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>xmlschema</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN2883"></a>                         <span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2885"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN2886"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>nspid_list</span><span class='Delimiter'>; 
</span><a name="LN2887"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN2888"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>xmlcn</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2888"><span class='Ref_To_Local'>xmlcn</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="../../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                           <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN2885"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN151"><span class='Ref_to_Proto'>xmldata_root_element_start</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2885"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2888"><span class='Ref_To_Local'>xmlcn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2882"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2883"><span class='Ref_to_Parameter'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2885"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN2882"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2885"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2882"><span class='Ref_to_Parameter'>xmlschema</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2886"><span class='Ref_To_Local'>nspid_list</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2371"><span class='Ref_to_Func'>database_get_xml_visible_schemas</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2887"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2886"><span class='Ref_To_Local'>nspid_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2906"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2887"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2907"></a>        <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>subres</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN2907"><span class='Ref_To_Local'>subres</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2706"><span class='Ref_to_Func'>schema_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2906"><span class='Ref_To_Local'>nspid</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2882"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, 
</span>                                        <a href="xml.c.html#LN2883"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2883"><span class='Ref_to_Parameter'>targetns</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2885"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2907"><span class='Ref_To_Local'>subres</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2885"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN154"><span class='Ref_to_Proto'>xmldata_root_element_end</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2885"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2888"><span class='Ref_To_Local'>xmlcn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN2885"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end database_to_xml_internal &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2925"></a><span class='Declare_Function'>database_to_xml</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2927"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2928"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2929"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2881"><span class='Ref_to_Func'>database_to_xml_internal</span></a><span class='Parentheses'>(</span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN2927"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                                    <a href="xml.c.html#LN2928"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2929"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Keyword'>static </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> 
<a name="LN2937"></a><span class='Declare_Function'>database_to_xmlschema_internal</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, 
</span><a name="LN2938"></a>                               <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2940"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>relid_list</span><span class='Delimiter'>; 
</span><a name="LN2941"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>nspid_list</span><span class='Delimiter'>; 
</span><a name="LN2942"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>tupdesc_list</span><span class='Delimiter'>; 
</span><a name="LN2943"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span><a name="LN2944"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2944"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../lib/stringinfo.c.html#LN26"><span class='Ref_to_Func'>makeStringInfo</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2771"><span class='Ref_to_Func'>xsd_schema_element_start</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2938"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN79"><span class='Ref_to_Proto'>SPI_connect</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2940"><span class='Ref_To_Local'>relid_list</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2378"><span class='Ref_to_Func'>database_get_xml_visible_tables</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN2941"><span class='Ref_To_Local'>nspid_list</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2371"><span class='Ref_to_Func'>database_get_xml_visible_schemas</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2942"><span class='Ref_To_Local'>tupdesc_list</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2943"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2940"><span class='Ref_To_Local'>relid_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN2958"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>rel</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN2958"><span class='Ref_To_Local'>rel</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2943"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN2942"><span class='Ref_To_Local'>tupdesc_list</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2942"><span class='Ref_To_Local'>tupdesc_list</span></a><span class='Delimiter'>, </span><a href="../../../include/access/tupdesc.h.html#LN88"><span class='Ref_to_Proto'>CreateTupleDescCopy</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2958"><span class='Ref_To_Local'>rel</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN114"><span class='Ref_to_Member'>rd_att</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2958"><span class='Ref_To_Local'>rel</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN33"><span class='Ref_to_Const'>NoLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                           <a href="xml.c.html#LN167"><span class='Ref_to_Proto'>map_sql_typecoll_to_xmlschema_types</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2942"><span class='Ref_To_Local'>tupdesc_list</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                           <a href="xml.c.html#LN163"><span class='Ref_to_Proto'>map_sql_catalog_to_xmlschema_types</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2941"><span class='Ref_To_Local'>nspid_list</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2937"><span class='Ref_to_Parameter'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2937"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2938"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2788"><span class='Ref_to_Func'>xsd_schema_element_end</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/executor/spi.h.html#LN80"><span class='Ref_to_Proto'>SPI_finish</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN2944"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end database_to_xmlschema_internal &raquo; </span> 
 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2980"></a><span class='Declare_Function'>database_to_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2982"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2983"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2984"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2936"><span class='Ref_to_Func'>database_to_xmlschema_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2982"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, 
</span>                                                    <a href="xml.c.html#LN2983"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2984"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN2992"></a><span class='Declare_Function'>database_to_xml_and_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN2994"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>nulls</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2995"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>tableforest</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN238"><span class='Ref_to_Macro'>PG_GETARG_BOOL</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN2996"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>targetns</span> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><a name="LN2997"></a>    <a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a>  <span class='Declare_Local'>xmlschema</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2997"><span class='Ref_To_Local'>xmlschema</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN2936"><span class='Ref_to_Func'>database_to_xmlschema_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2994"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2995"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2996"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN53"><span class='Ref_to_Macro'>PG_RETURN_XML_P</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN443"><span class='Ref_to_Func'>stringinfo_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2881"><span class='Ref_to_Func'>database_to_xml_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN2997"><span class='Ref_To_Local'>xmlschema</span></a><span class='Operator'>-&GT;</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>, 
</span>                                             <a href="xml.c.html#LN2994"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2995"><span class='Ref_To_Local'>tableforest</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN2996"><span class='Ref_To_Local'>targetns</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Map a multi-part SQL name to an XML name; see SQL/XML:2008 section 
 * 9.2. 
 */ 
</span><span class='Keyword'>static char </span><span class='Operator'>* 
</span><a name="LN3011"></a><span class='Declare_Function'>map_multipart_sql_identifier_to_xml_name</span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>c</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3013"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3013"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3011"><span class='Ref_to_Parameter'>a</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3013"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                               <a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3011"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3011"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3013"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>".%s"</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3011"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3011"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3013"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>".%s"</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3011"><span class='Ref_to_Parameter'>c</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3011"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3013"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>".%s"</span><span class='Delimiter'>, 
</span>                         <a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3011"><span class='Ref_to_Parameter'>d</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN3013"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end map_multipart_sql_identifier_to_xml_name &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map an SQL table to an XML Schema document; see SQL/XML:2008 
 * section 9.11. 
 * 
 * Map an SQL table to XML Schema data types; see SQL/XML:2008 section 
 * 9.9. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3042"></a><span class='Declare_Function'>map_sql_table_to_xmlschema</span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a> <span class='Declare_Parameter'>tupdesc</span><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>relid</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN3043"></a>                           <span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3045"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3046"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>xmltn</span><span class='Delimiter'>; 
</span><a name="LN3047"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tabletypename</span><span class='Delimiter'>; 
</span><a name="LN3048"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>rowtypename</span><span class='Delimiter'>; 
</span><a name="LN3049"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN537"><span class='Ref_to_Macro'>OidIsValid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3042"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3055"></a>        <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3056"></a>        <a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a> <span class='Declare_Local'>reltuple</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN3055"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN83"><span class='Ref_to_EnumConst'>RELOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3042"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3055"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for relation %u"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3042"><span class='Ref_to_Parameter'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN3056"><span class='Ref_To_Local'>reltuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_class.h.html#LN94"><span class='Ref_to_Typedef'>Form_pg_class</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3055"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN3046"><span class='Ref_To_Local'>xmltn</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3056"><span class='Ref_To_Local'>reltuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                               <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN3047"><span class='Ref_To_Local'>tabletypename</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN3010"><span class='Ref_to_Func'>map_multipart_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><span class='String'>"TableType"</span><span class='Delimiter'>, 
</span>                                             <a href="../../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3056"><span class='Ref_To_Local'>reltuple</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3056"><span class='Ref_To_Local'>reltuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN3048"><span class='Ref_To_Local'>rowtypename</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN3010"><span class='Ref_to_Func'>map_multipart_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><span class='String'>"RowType"</span><span class='Delimiter'>, 
</span>                                             <a href="../../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3056"><span class='Ref_To_Local'>reltuple</span></a><span class='Operator'>-&GT;</span>relnamespace<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3056"><span class='Ref_To_Local'>reltuple</span></a><span class='Operator'>-&GT;</span>relname<span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3055"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if OidIsValid(relid) &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3043"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN3046"><span class='Ref_To_Local'>xmltn</span></a> <span class='Operator'>= </span><span class='String'>"row"</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="xml.c.html#LN3046"><span class='Ref_To_Local'>xmltn</span></a> <span class='Operator'>= </span><span class='String'>"table"</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN3047"><span class='Ref_To_Local'>tabletypename</span></a> <span class='Operator'>= </span><span class='String'>"TableType"</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN3048"><span class='Ref_To_Local'>rowtypename</span></a> <span class='Operator'>= </span><span class='String'>"RowType"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="xml.c.html#LN2771"><span class='Ref_to_Func'>xsd_schema_element_start</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3043"><span class='Ref_to_Parameter'>targetns</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                   <a href="xml.c.html#LN167"><span class='Ref_to_Proto'>map_sql_typecoll_to_xmlschema_types</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN138"><span class='Ref_to_Macro'>list_make1</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3042"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"&LT;xsd:complexType name=\"%s\"&GT;\n"</span> 
                     <span class='String'>"  &LT;xsd:sequence&GT;\n"</span><span class='Delimiter'>, 
</span>                     <a href="xml.c.html#LN3048"><span class='Ref_To_Local'>rowtypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3045"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN3045"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="xml.c.html#LN3042"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN3045"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3042"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3045"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>               <span class='String'>"    &LT;xsd:element name=\"%s\" type=\"%s\"%s&GT;&LT;/xsd:element&GT;\n"</span><span class='Delimiter'>, 
</span>          <a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3042"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3045"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attname<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                         <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                   <a href="xml.c.html#LN166"><span class='Ref_to_Proto'>map_sql_type_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3042"><span class='Ref_to_Parameter'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3045"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                         <a href="xml.c.html#LN3042"><span class='Ref_to_Parameter'>nulls</span></a> <span class='Operator'>? </span><span class='String'>" nillable=\"true\""</span> <span class='Operator'>: </span><span class='String'>" minOccurs=\"0\""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"  &LT;/xsd:sequence&GT;\n"</span> 
                           <span class='String'>"&LT;/xsd:complexType&GT;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN3043"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"&LT;xsd:complexType name=\"%s\"&GT;\n"</span> 
                         <span class='String'>"  &LT;xsd:sequence&GT;\n"</span> 
                         <span class='String'>"    &LT;xsd:element name=\"row\" type=\"%s\" minOccurs=\"0\" maxOccurs=\"unbounded\"/&GT;\n"</span> 
                         <span class='String'>"  &LT;/xsd:sequence&GT;\n"</span> 
                         <span class='String'>"&LT;/xsd:complexType&GT;\n\n"</span><span class='Delimiter'>, 
</span>                         <a href="xml.c.html#LN3047"><span class='Ref_To_Local'>tabletypename</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3048"><span class='Ref_To_Local'>rowtypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"&LT;xsd:element name=\"%s\" type=\"%s\"/&GT;\n\n"</span><span class='Delimiter'>, 
</span>                         <a href="xml.c.html#LN3046"><span class='Ref_To_Local'>xmltn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3047"><span class='Ref_To_Local'>tabletypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"&LT;xsd:element name=\"%s\" type=\"%s\"/&GT;\n\n"</span><span class='Delimiter'>, 
</span>                         <a href="xml.c.html#LN3046"><span class='Ref_To_Local'>xmltn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3048"><span class='Ref_To_Local'>rowtypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN2788"><span class='Ref_to_Func'>xsd_schema_element_end</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN3049"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end map_sql_table_to_xmlschema &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map an SQL schema to XML Schema data types; see SQL/XML:2008 
 * section 9.12. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3145"></a><span class='Declare_Function'>map_sql_schema_to_xmlschema_types</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>nspid</span><span class='Delimiter'>, </span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>relid_list</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN3146"></a>                                  <span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3148"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbname</span><span class='Delimiter'>; 
</span><a name="LN3149"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nspname</span><span class='Delimiter'>; 
</span><a name="LN3150"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>xmlsn</span><span class='Delimiter'>; 
</span><a name="LN3151"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schematypename</span><span class='Delimiter'>; 
</span><a name="LN3152"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3153"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3148"><span class='Ref_To_Local'>dbname</span></a> <span class='Operator'>= </span><a href="../../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN3149"><span class='Ref_To_Local'>nspname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3145"><span class='Ref_to_Parameter'>nspid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3150"><span class='Ref_To_Local'>xmlsn</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3149"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3151"><span class='Ref_To_Local'>schematypename</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN3010"><span class='Ref_to_Func'>map_multipart_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><span class='String'>"SchemaType"</span><span class='Delimiter'>, 
</span>                                                              <a href="xml.c.html#LN3148"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, 
</span>                                                              <a href="xml.c.html#LN3149"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, 
</span>                                                              <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"&LT;xsd:complexType name=\"%s\"&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3151"><span class='Ref_To_Local'>schematypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN3146"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                               <span class='String'>"  &LT;xsd:all&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                               <span class='String'>"  &LT;xsd:sequence&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3153"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3145"><span class='Ref_to_Parameter'>relid_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3178"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>relid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3153"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3179"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>relname</span> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN124"><span class='Ref_to_Proto'>get_rel_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3178"><span class='Ref_To_Local'>relid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3180"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>xmltn</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3179"><span class='Ref_To_Local'>relname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3181"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>tabletypename</span> <span class='Operator'>= </span><a href="xml.c.html#LN3010"><span class='Ref_to_Func'>map_multipart_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3146"><span class='Ref_to_Parameter'>tableforest</span></a> <span class='Operator'>? </span><span class='String'>"RowType"</span> <span class='Operator'>: </span><span class='String'>"TableType"</span><span class='Delimiter'>, 
</span>                                                                      <a href="xml.c.html#LN3148"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, 
</span>                                                                     <a href="xml.c.html#LN3149"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, 
</span>                                                                    <a href="xml.c.html#LN3179"><span class='Ref_To_Local'>relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN3146"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                             <span class='String'>"    &LT;xsd:element name=\"%s\" type=\"%s\"/&GT;\n"</span><span class='Delimiter'>, 
</span>                             <a href="xml.c.html#LN3180"><span class='Ref_To_Local'>xmltn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3181"><span class='Ref_To_Local'>tabletypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                             <span class='String'>"    &LT;xsd:element name=\"%s\" type=\"%s\" minOccurs=\"0\" maxOccurs=\"unbounded\"/&GT;\n"</span><span class='Delimiter'>, 
</span>                             <a href="xml.c.html#LN3180"><span class='Ref_To_Local'>xmltn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3181"><span class='Ref_To_Local'>tabletypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="xml.c.html#LN3146"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                               <span class='String'>"  &LT;/xsd:all&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                               <span class='String'>"  &LT;/xsd:sequence&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"&LT;/xsd:complexType&GT;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"&LT;xsd:element name=\"%s\" type=\"%s\"/&GT;\n\n"</span><span class='Delimiter'>, 
</span>                     <a href="xml.c.html#LN3150"><span class='Ref_To_Local'>xmlsn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3151"><span class='Ref_To_Local'>schematypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN3152"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end map_sql_schema_to_xmlschema_types &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map an SQL catalog to XML Schema data types; see SQL/XML:2008 
 * section 9.15. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3218"></a><span class='Declare_Function'>map_sql_catalog_to_xmlschema_types</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>nspid_list</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, 
</span><a name="LN3219"></a>                                   <span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3221"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>dbname</span><span class='Delimiter'>; 
</span><a name="LN3222"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>xmlcn</span><span class='Delimiter'>; 
</span><a name="LN3223"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>catalogtypename</span><span class='Delimiter'>; 
</span><a name="LN3224"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3225"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3221"><span class='Ref_To_Local'>dbname</span></a> <span class='Operator'>= </span><a href="../../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3224"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3222"><span class='Ref_To_Local'>xmlcn</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3221"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3223"><span class='Ref_To_Local'>catalogtypename</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN3010"><span class='Ref_to_Func'>map_multipart_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><span class='String'>"CatalogType"</span><span class='Delimiter'>, 
</span>                                                               <a href="xml.c.html#LN3221"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, 
</span>                                                               <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                                               <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3224"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"&LT;xsd:complexType name=\"%s\"&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3223"><span class='Ref_To_Local'>catalogtypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3224"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"  &LT;xsd:all&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3225"><span class='Ref_To_Local'>cell</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3218"><span class='Ref_to_Parameter'>nspid_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3245"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>nspid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3225"><span class='Ref_To_Local'>cell</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3246"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>nspname</span> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3245"><span class='Ref_To_Local'>nspid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3247"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>xmlsn</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3246"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3248"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>schematypename</span> <span class='Operator'>= </span><a href="xml.c.html#LN3010"><span class='Ref_to_Func'>map_multipart_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><span class='String'>"SchemaType"</span><span class='Delimiter'>, 
</span>                                                                      <a href="xml.c.html#LN3221"><span class='Ref_To_Local'>dbname</span></a><span class='Delimiter'>, 
</span>                                                                     <a href="xml.c.html#LN3246"><span class='Ref_To_Local'>nspname</span></a><span class='Delimiter'>, 
</span>                                                                       <span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3224"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"    &LT;xsd:element name=\"%s\" type=\"%s\"/&GT;\n"</span><span class='Delimiter'>, 
</span>                         <a href="xml.c.html#LN3247"><span class='Ref_To_Local'>xmlsn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3248"><span class='Ref_To_Local'>schematypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3224"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"  &LT;/xsd:all&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3224"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                           <span class='String'>"&LT;/xsd:complexType&GT;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3224"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                     <span class='String'>"&LT;xsd:element name=\"%s\" type=\"%s\"/&GT;\n\n"</span><span class='Delimiter'>, 
</span>                     <a href="xml.c.html#LN3222"><span class='Ref_To_Local'>xmlcn</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3223"><span class='Ref_To_Local'>catalogtypename</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN3224"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end map_sql_catalog_to_xmlschema_types &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map an SQL data type to an XML name; see SQL/XML:2008 section 9.4. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3275"></a><span class='Declare_Function'>map_sql_type_to_xml_name</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeoid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3277"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typeoid</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN48"><span class='Ref_to_Const'>BPCHAROID</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"CHAR"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"CHAR_%d"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN49"><span class='Ref_to_Const'>VARCHAROID</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"VARCHAR"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"VARCHAR_%d"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN58"><span class='Ref_to_Const'>NUMERICOID</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"NUMERIC"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"NUMERIC_%d_%d"</span><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>((</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>16</span><span class='Parentheses'>)</span> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Operator'>: 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"INTEGER"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Operator'>: 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"SMALLINT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Operator'>: 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"BIGINT"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN38"><span class='Ref_to_Const'>FLOAT4OID</span></a><span class='Operator'>: 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"REAL"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN39"><span class='Ref_to_Const'>FLOAT8OID</span></a><span class='Operator'>: 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"DOUBLE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Operator'>: 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"BOOLEAN"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN51"><span class='Ref_to_Const'>TIMEOID</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"TIME"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"TIME_%d"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN55"><span class='Ref_to_Const'>TIMETZOID</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"TIME_WTZ"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"TIME_WTZ_%d"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN52"><span class='Ref_to_Const'>TIMESTAMPOID</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"TIMESTAMP"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"TIMESTAMP_%d"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN53"><span class='Ref_to_Const'>TIMESTAMPTZOID</span></a><span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"TIMESTAMP_WTZ"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>else</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"TIMESTAMP_WTZ_%d"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN50"><span class='Ref_to_Const'>DATEOID</span></a><span class='Operator'>: 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"DATE"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../include/catalog/pg_type.h.html#LN358"><span class='Ref_to_Const'>XMLOID</span></a><span class='Operator'>: 
</span>            <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"XML"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3353"></a>                <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>tuple</span><span class='Delimiter'>; 
</span><a name="LN3354"></a>                <a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a> <span class='Declare_Local'>typtuple</span><span class='Delimiter'>; 
</span> 
                <a href="xml.c.html#LN3353"><span class='Ref_To_Local'>tuple</span></a> <span class='Operator'>= </span><a href="../../../include/utils/syscache.h.html#LN155"><span class='Ref_to_Macro'>SearchSysCache1</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/syscache.h.html#LN107"><span class='Ref_to_EnumConst'>TYPEOID</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typeoid</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3353"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>))</span> 
                    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"cache lookup failed for type %u"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3275"><span class='Ref_to_Parameter'>typeoid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="xml.c.html#LN3354"><span class='Ref_To_Local'>typtuple</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN232"><span class='Ref_to_Typedef'>Form_pg_type</span></a><span class='Parentheses'>) </span><a href="../../../include/access/htup_details.h.html#LN655"><span class='Ref_to_Macro'>GETSTRUCT</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3353"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                       <a href="xml.c.html#LN3010"><span class='Ref_to_Func'>map_multipart_sql_identifier_to_xml_name</span></a><span class='Parentheses'>((</span><a href="xml.c.html#LN3354"><span class='Ref_To_Local'>typtuple</span></a><span class='Operator'>-&GT;</span>typtype <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>) </span><span class='Operator'>? </span><span class='String'>"Domain"</span> <span class='Operator'>: </span><span class='String'>"UDT"</span><span class='Delimiter'>, 
</span>                                             <a href="../../../include/commands/dbcommands.h.html#LN29"><span class='Ref_to_Proto'>get_database_name</span></a><span class='Parentheses'>(</span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <a href="../../../include/utils/lsyscache.h.html#LN175"><span class='Ref_to_Proto'>get_namespace_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3354"><span class='Ref_To_Local'>typtuple</span></a><span class='Operator'>-&GT;</span>typnamespace<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                <a href="../../../include/c.h.html#LN498"><span class='Ref_to_Macro'>NameStr</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3354"><span class='Ref_To_Local'>typtuple</span></a><span class='Operator'>-&GT;</span>typname<span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <a href="../../../include/utils/syscache.h.html#LN119"><span class='Ref_to_Proto'>ReleaseSysCache</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3353"><span class='Ref_To_Local'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch typeoid &raquo; </span> 
 
    <span class='Control'>return</span> <a href="xml.c.html#LN3277"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end map_sql_type_to_xml_name &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map a collection of SQL data types to XML Schema data types; see 
 * SQL/XML:2008 section 9.7. 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3380"></a><span class='Declare_Function'>map_sql_typecoll_to_xmlschema_types</span><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>tupdesc_list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3382"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>uniquetypes</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span><a name="LN3383"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3384"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3385"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cell0</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* extract all column types used in the set of TupleDescs */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3385"><span class='Ref_To_Local'>cell0</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3380"><span class='Ref_to_Parameter'>tupdesc_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3390"></a>        <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3385"><span class='Ref_To_Local'>cell0</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3383"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN3383"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="xml.c.html#LN3390"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN3383"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3390"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3383"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>attisdropped<span class='Parentheses'>) 
</span>                <span class='Control'>continue</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN3382"><span class='Ref_To_Local'>uniquetypes</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN258"><span class='Ref_to_Proto'>list_append_unique_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3382"><span class='Ref_To_Local'>uniquetypes</span></a><span class='Delimiter'>, 
</span>                                                 <a href="xml.c.html#LN3390"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3383"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* add base types of domains */ 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3385"><span class='Ref_To_Local'>cell0</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3382"><span class='Ref_To_Local'>uniquetypes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3404"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>typid</span> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3385"><span class='Ref_To_Local'>cell0</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN3405"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>basetypid</span> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN168"><span class='Ref_to_Proto'>getBaseType</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3404"><span class='Ref_To_Local'>typid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3405"><span class='Ref_To_Local'>basetypid</span></a> <span class='Operator'>!= </span><a href="xml.c.html#LN3404"><span class='Ref_To_Local'>typid</span></a><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN3382"><span class='Ref_To_Local'>uniquetypes</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN258"><span class='Ref_to_Proto'>list_append_unique_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3382"><span class='Ref_To_Local'>uniquetypes</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3405"><span class='Ref_To_Local'>basetypid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Convert to textual form */ 
</span>    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3384"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3385"><span class='Ref_To_Local'>cell0</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3382"><span class='Ref_To_Local'>uniquetypes</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3384"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"%s\n"</span><span class='Delimiter'>, 
</span>                         <a href="xml.c.html#LN168"><span class='Ref_to_Proto'>map_sql_type_to_xmlschema_type</span></a><span class='Parentheses'>(</span><a href="../../../include/nodes/pg_list.h.html#LN107"><span class='Ref_to_Macro'>lfirst_oid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3385"><span class='Ref_To_Local'>cell0</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                        <span class='Operator'>-</span><span class='Number'>1</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN3384"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end map_sql_typecoll_to_xmlschema_types &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map an SQL data type to a named XML Schema data type; see 
 * SQL/XML:2008 sections 9.5 and 9.6. 
 * 
 * (The distinction between 9.5 and 9.6 is basically that 9.6 adds 
 * a name attribute, which this function does.  The name-less version 
 * 9.5 doesn't appear to be required anywhere.) 
 */ 
</span><span class='Keyword'>static const char </span><span class='Operator'>* 
</span><a name="LN3434"></a><span class='Declare_Function'>map_sql_type_to_xmlschema_type</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typeoid</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>typmod</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3436"></a>    <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN3437"></a>    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>typename</span> <span class='Operator'>= </span><a href="xml.c.html#LN166"><span class='Ref_to_Proto'>map_sql_type_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typeoid</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typeoid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN358"><span class='Ref_to_Const'>XMLOID</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                               <span class='String'>"&LT;xsd:complexType mixed=\"true\"&GT;\n"</span> 
                               <span class='String'>"  &LT;xsd:sequence&GT;\n"</span> 
                               <span class='String'>"    &LT;xsd:any name=\"element\" minOccurs=\"0\" maxOccurs=\"unbounded\" processContents=\"skip\"/&GT;\n"</span> 
                               <span class='String'>"  &LT;/xsd:sequence&GT;\n"</span> 
                               <span class='String'>"&LT;/xsd:complexType&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                         <span class='String'>"&LT;xsd:simpleType name=\"%s\"&GT;\n"</span><span class='Delimiter'>, </span><span class='Keyword'>typename</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typeoid</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN48"><span class='Ref_to_Const'>BPCHAROID</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN49"><span class='Ref_to_Const'>VARCHAROID</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                 <span class='String'>"  &LT;xsd:restriction base=\"xsd:string\"&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                     <span class='String'>"    &LT;xsd:maxLength value=\"%d\"/&GT;\n"</span><span class='Delimiter'>, 
</span>                                     <a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN18"><span class='Ref_to_Const'>BYTEAOID</span></a><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                 <span class='String'>"  &LT;xsd:restriction base=\"xsd:%s\"&GT;\n"</span> 
                                 <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, 
</span>                <a href="xml.c.html#LN95"><span class='Ref_to_Global_Var'>xmlbinary</span></a> <span class='Operator'>== </span><a href="../../../include/utils/xml.h.html#LN34"><span class='Ref_to_EnumConst'>XMLBINARY_BASE64</span></a> <span class='Operator'>? </span><span class='String'>"base64Binary"</span> <span class='Operator'>: </span><span class='String'>"hexBinary"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN58"><span class='Ref_to_Const'>NUMERICOID</span></a><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>!= -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                 <span class='String'>"  &LT;xsd:restriction base=\"xsd:decimal\"&GT;\n"</span> 
                                     <span class='String'>"    &LT;xsd:totalDigits value=\"%d\"/&GT;\n"</span> 
                                   <span class='String'>"    &LT;xsd:fractionDigits value=\"%d\"/&GT;\n"</span> 
                                     <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>((</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>) </span><span class='Operator'>&GT;&GT; </span><span class='Number'>16</span><span class='Parentheses'>)</span> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Delimiter'>, 
</span>                                     <span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Parentheses'>)</span> <span class='Operator'>& </span><span class='Number'>0xffff</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                 <span class='String'>"  &LT;xsd:restriction base=\"xsd:short\"&GT;\n"</span> 
                                 <span class='String'>"    &LT;xsd:maxInclusive value=\"%d\"/&GT;\n"</span> 
                                 <span class='String'>"    &LT;xsd:minInclusive value=\"%d\"/&GT;\n"</span> 
                                 <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, 
</span>                                 SHRT_MAX<span class='Delimiter'>, </span>SHRT_MIN<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                 <span class='String'>"  &LT;xsd:restriction base=\"xsd:int\"&GT;\n"</span> 
                                 <span class='String'>"    &LT;xsd:maxInclusive value=\"%d\"/&GT;\n"</span> 
                                 <span class='String'>"    &LT;xsd:minInclusive value=\"%d\"/&GT;\n"</span> 
                                 <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, 
</span>                                 INT_MAX<span class='Delimiter'>, </span>INT_MIN<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN21"><span class='Ref_to_Const'>INT8OID</span></a><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                 <span class='String'>"  &LT;xsd:restriction base=\"xsd:long\"&GT;\n"</span> 
                       <span class='String'>"    &LT;xsd:maxInclusive value=\""</span> <a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>"\"/&GT;\n"</span> 
                       <span class='String'>"    &LT;xsd:minInclusive value=\""</span> <a href="../../../include/c.h.html#LN314"><span class='Ref_to_Const'>INT64_FORMAT</span></a> <span class='String'>"\"/&GT;\n"</span> 
                                 <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, 
</span>                               <span class='Parentheses'>(((</span><a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>8</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>))</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>, 
</span>                                 <span class='Parentheses'>(((</span><a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a><span class='Parentheses'>) </span><span class='Number'>1</span><span class='Parentheses'>)</span> <span class='Operator'>&LT;&LT; </span><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN294"><span class='Ref_to_Typedef'>int64</span></a><span class='Parentheses'>) </span><span class='Operator'>* </span><span class='Number'>8</span> <span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN38"><span class='Ref_to_Const'>FLOAT4OID</span></a><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                <span class='String'>"  &LT;xsd:restriction base=\"xsd:float\"&GT;&LT;/xsd:restriction&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN39"><span class='Ref_to_Const'>FLOAT8OID</span></a><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                       <span class='String'>"  &LT;xsd:restriction base=\"xsd:double\"&GT;&LT;/xsd:restriction&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                       <span class='String'>"  &LT;xsd:restriction base=\"xsd:boolean\"&GT;&LT;/xsd:restriction&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN51"><span class='Ref_to_Const'>TIMEOID</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN55"><span class='Ref_to_Const'>TIMETZOID</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN3533"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tz</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typeoid</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN55"><span class='Ref_to_Const'>TIMETZOID</span></a> <span class='Operator'>? </span><span class='String'>"(+|-)\\p{Nd}{2}:\\p{Nd}{2}"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"  &LT;xsd:restriction base=\"xsd:time\"&GT;\n"</span> 
                                         <span class='String'>"    &LT;xsd:pattern value=\"\\p{Nd}{2}:\\p{Nd}{2}:\\p{Nd}{2}(.\\p{Nd}+)?%s\"/&GT;\n"</span> 
                                         <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3533"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"  &LT;xsd:restriction base=\"xsd:time\"&GT;\n"</span> 
                                         <span class='String'>"    &LT;xsd:pattern value=\"\\p{Nd}{2}:\\p{Nd}{2}:\\p{Nd}{2}%s\"/&GT;\n"</span> 
                                         <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3533"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"  &LT;xsd:restriction base=\"xsd:time\"&GT;\n"</span> 
                                         <span class='String'>"    &LT;xsd:pattern value=\"\\p{Nd}{2}:\\p{Nd}{2}:\\p{Nd}{2}.\\p{Nd}{%d}%s\"/&GT;\n"</span> 
                            <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3533"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN52"><span class='Ref_to_Const'>TIMESTAMPOID</span></a><span class='Operator'>: 
</span>            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN53"><span class='Ref_to_Const'>TIMESTAMPTZOID</span></a><span class='Operator'>: 
</span>                <span class='Delimiter'>{ 
</span><a name="LN3556"></a>                    <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Local'>tz</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typeoid</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN53"><span class='Ref_to_Const'>TIMESTAMPTZOID</span></a> <span class='Operator'>? </span><span class='String'>"(+|-)\\p{Nd}{2}:\\p{Nd}{2}"</span> <span class='Operator'>: </span><span class='String'>""</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== -</span><span class='Number'>1</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"  &LT;xsd:restriction base=\"xsd:dateTime\"&GT;\n"</span> 
                                         <span class='String'>"    &LT;xsd:pattern value=\"\\p{Nd}{4}-\\p{Nd}{2}-\\p{Nd}{2}T\\p{Nd}{2}:\\p{Nd}{2}:\\p{Nd}{2}(.\\p{Nd}+)?%s\"/&GT;\n"</span> 
                                         <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3556"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"  &LT;xsd:restriction base=\"xsd:dateTime\"&GT;\n"</span> 
                                         <span class='String'>"    &LT;xsd:pattern value=\"\\p{Nd}{4}-\\p{Nd}{2}-\\p{Nd}{2}T\\p{Nd}{2}:\\p{Nd}{2}:\\p{Nd}{2}%s\"/&GT;\n"</span> 
                                         <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3556"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>else</span> 
                        <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                <span class='String'>"  &LT;xsd:restriction base=\"xsd:dateTime\"&GT;\n"</span> 
                                         <span class='String'>"    &LT;xsd:pattern value=\"\\p{Nd}{4}-\\p{Nd}{2}-\\p{Nd}{2}T\\p{Nd}{2}:\\p{Nd}{2}:\\p{Nd}{2}.\\p{Nd}{%d}%s\"/&GT;\n"</span> 
                            <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typmod</span></a> <span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3556"><span class='Ref_To_Local'>tz</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Control'>break</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span> 
            <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN50"><span class='Ref_to_Const'>DATEOID</span></a><span class='Operator'>: 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                    <span class='String'>"  &LT;xsd:restriction base=\"xsd:date\"&GT;\n"</span> 
                                       <span class='String'>"    &LT;xsd:pattern value=\"\\p{Nd}{4}-\\p{Nd}{2}-\\p{Nd}{2}\"/&GT;\n"</span> 
                                       <span class='String'>"  &LT;/xsd:restriction&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>default</span><span class='Operator'>: 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/utils/lsyscache.h.html#LN149"><span class='Ref_to_Proto'>get_typtype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typeoid</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN721"><span class='Ref_to_Const'>TYPTYPE_DOMAIN</span></a><span class='Parentheses'>)</span> 
                <span class='Delimiter'>{ 
</span><a name="LN3586"></a>                    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>base_typeoid</span><span class='Delimiter'>; 
</span><a name="LN3587"></a>                    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>base_typmod</span> <span class='Operator'>= -</span><span class='Number'>1</span><span class='Delimiter'>; 
</span> 
                    <a href="xml.c.html#LN3586"><span class='Ref_To_Local'>base_typeoid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/lsyscache.h.html#LN169"><span class='Ref_to_Proto'>getBaseTypeAndTypmod</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3434"><span class='Ref_to_Parameter'>typeoid</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN3587"><span class='Ref_To_Local'>base_typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                    <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, 
</span>                                     <span class='String'>"  &LT;xsd:restriction base=\"%s\"/&GT;\n"</span><span class='Delimiter'>, 
</span>                        <a href="xml.c.html#LN166"><span class='Ref_to_Proto'>map_sql_type_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3586"><span class='Ref_To_Local'>base_typeoid</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3587"><span class='Ref_To_Local'>base_typmod</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch typeoid &raquo; </span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;/xsd:simpleType&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="xml.c.html#LN3436"><span class='Ref_To_Local'>result</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end map_sql_type_to_xmlschema_type &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Map an SQL row to an XML element, taking the row from the active 
 * SPI cursor.  See also SQL/XML:2008 section 9.10. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3609"></a><span class='Declare_Function'>SPI_sql_row_to_xmlelement</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN297"><span class='Ref_to_Typedef'>uint64</span></a> <span class='Declare_Parameter'>rownum</span><span class='Delimiter'>, </span><a href="../../../include/lib/stringinfo.h.html#LN42"><span class='Ref_to_Typedef'>StringInfo</span></a> <span class='Declare_Parameter'>result</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>tablename</span><span class='Delimiter'>, 
</span><a name="LN3610"></a>                          <span class='Keyword'>bool </span><span class='Declare_Parameter'>nulls</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>tableforest</span><span class='Delimiter'>, 
</span><a name="LN3611"></a>                          <span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>targetns</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>top_level</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3613"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3614"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>xmltn</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>tablename</span></a><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN3614"><span class='Ref_To_Local'>xmltn</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>tablename</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3610"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN3614"><span class='Ref_To_Local'>xmltn</span></a> <span class='Operator'>= </span><span class='String'>"row"</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="xml.c.html#LN3614"><span class='Ref_To_Local'>xmltn</span></a> <span class='Operator'>= </span><span class='String'>"table"</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3610"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>        <a href="xml.c.html#LN151"><span class='Ref_to_Proto'>xmldata_root_element_start</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3614"><span class='Ref_To_Local'>xmltn</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3611"><span class='Ref_to_Parameter'>targetns</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3611"><span class='Ref_to_Parameter'>top_level</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;row&GT;\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3613"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>1</span><span class='Delimiter'>; </span><a href="xml.c.html#LN3613"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT;= </span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN3613"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3633"></a>        <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>colname</span><span class='Delimiter'>; 
</span><a name="LN3634"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>colval</span><span class='Delimiter'>; 
</span><a name="LN3635"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>isnull</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN3633"><span class='Ref_To_Local'>colname</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN73"><span class='Ref_to_Proto'>map_sql_identifier_to_xml_name</span></a><span class='Parentheses'>(</span><a href="../../../include/executor/spi.h.html#LN124"><span class='Ref_to_Proto'>SPI_fname</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3613"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                                 <span class='Boolean'>true</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN3634"><span class='Ref_To_Local'>colval</span></a> <span class='Operator'>= </span><a href="../../../include/executor/spi.h.html#LN126"><span class='Ref_to_Proto'>SPI_getbinval</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN27"><span class='Ref_to_Member'>vals</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>rownum</span></a><span class='Delimiter'>], 
</span>                               <a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, 
</span>                               <a href="xml.c.html#LN3613"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                               <span class='Operator'>&</span><a href="xml.c.html#LN3635"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3635"><span class='Ref_To_Local'>isnull</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3610"><span class='Ref_to_Parameter'>nulls</span></a><span class='Parentheses'>) 
</span>                <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"  &LT;%s xsi:nil=\"true\"/&GT;\n"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3633"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../../bin/pg_waldump/compat.c.html#LN69"><span class='Ref_to_Func'>appendStringInfo</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"  &LT;%s&GT;%s&LT;/%s&GT;\n"</span><span class='Delimiter'>, 
</span>                             <a href="xml.c.html#LN3633"><span class='Ref_To_Local'>colname</span></a><span class='Delimiter'>, 
</span>                             <a href="../../../include/utils/xml.h.html#LN75"><span class='Ref_to_Proto'>map_sql_value_to_xml_value</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3634"><span class='Ref_To_Local'>colval</span></a><span class='Delimiter'>, 
</span>                              <a href="../../../include/executor/spi.h.html#LN128"><span class='Ref_to_Proto'>SPI_gettypeid</span></a><span class='Parentheses'>(</span><a href="../../executor/spi.c.html#LN40"><span class='Ref_to_Global_Var'>SPI_tuptable</span></a><span class='Operator'>-&GT;</span><a href="../../../include/executor/spi.h.html#LN26"><span class='Ref_to_Member'>tupdesc</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3613"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="xml.c.html#LN3633"><span class='Ref_To_Local'>colname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=1;i&LT;=SPI_tuptable-&GT;... &raquo; </span> 
 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3610"><span class='Ref_to_Parameter'>tableforest</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN154"><span class='Ref_to_Proto'>xmldata_root_element_end</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3614"><span class='Ref_To_Local'>xmltn</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../replication/syncrep_scanner.l.html#LN76"><span class='Ref_to_Proto'>appendStringInfoChar</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>'\n'</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Control'>else</span> 
        <a href="../../../bin/pg_waldump/compat.c.html#LN79"><span class='Ref_to_Func'>appendStringInfoString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3609"><span class='Ref_to_Parameter'>result</span></a><span class='Delimiter'>, </span><span class='String'>"&LT;/row&GT;\n\n"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SPI_sql_row_to_xmlelement &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * XPath related functions 
 */ 
</span> 
<span class='Directive'>#ifdef</span> USE_LIBXML 
 
<span class='Comment_Multi_Line'>/* 
 * Convert XML node to text (dump subtree in case of element, 
 * return value otherwise) 
 */ 
</span><span class='Keyword'>static </span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>* 
</span><a name="LN3677"></a><span class='Declare_Function'>xml_xmlnodetoxmltype</span><span class='Parentheses'>(</span>xmlNodePtr <span class='Declare_Parameter'>cur</span><span class='Delimiter'>, </span><a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>xmlerrcxt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3679"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3677"><span class='Ref_to_Parameter'>cur</span></a><span class='Operator'>-&GT;</span>type <span class='Operator'>== </span>XML_ELEMENT_NODE<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3683"></a>        xmlBufferPtr <span class='Declare_Local'>buf</span><span class='Delimiter'>; 
</span><a name="LN3684"></a>        xmlNodePtr  <span class='Declare_Local'>cur_copy</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN3683"><span class='Ref_To_Local'>buf</span></a> <span class='Operator'>= </span>xmlBufferCreate<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * The result of xmlNodeDump() won't contain namespace definitions 
         * from parent nodes, but xmlCopyNode() duplicates a node along with 
         * its required namespace definitions. 
         */ 
</span>        <a href="xml.c.html#LN3684"><span class='Ref_To_Local'>cur_copy</span></a> <span class='Operator'>= </span>xmlCopyNode<span class='Parentheses'>(</span><a href="xml.c.html#LN3677"><span class='Ref_to_Parameter'>cur</span></a><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3684"><span class='Ref_To_Local'>cur_copy</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3677"><span class='Ref_to_Parameter'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                        <span class='String'>"could not copy node"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            xmlNodeDump<span class='Parentheses'>(</span><a href="xml.c.html#LN3683"><span class='Ref_To_Local'>buf</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3684"><span class='Ref_To_Local'>cur_copy</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN3679"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN458"><span class='Ref_to_Func'>xmlBuffer_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3683"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            xmlFreeNode<span class='Parentheses'>(</span><a href="xml.c.html#LN3684"><span class='Ref_To_Local'>cur_copy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            xmlBufferFree<span class='Parentheses'>(</span><a href="xml.c.html#LN3683"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        xmlFreeNode<span class='Parentheses'>(</span><a href="xml.c.html#LN3684"><span class='Ref_To_Local'>cur_copy</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        xmlBufferFree<span class='Parentheses'>(</span><a href="xml.c.html#LN3683"><span class='Ref_To_Local'>buf</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if cur-&GT;type==XML_ELEMEN... &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span><a name="LN3716"></a>        xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN3716"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span>xmlXPathCastNodeToString<span class='Parentheses'>(</span><a href="xml.c.html#LN3677"><span class='Ref_to_Parameter'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Here we rely on XML having the same representation as TEXT */ 
</span><a name="LN3722"></a>            <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>escaped</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN71"><span class='Ref_to_Proto'>escape_xml</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN3716"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="xml.c.html#LN3679"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/builtins.h.html#LN85"><span class='Ref_to_Proto'>cstring_to_text</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3722"><span class='Ref_To_Local'>escaped</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3722"><span class='Ref_To_Local'>escaped</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>{ 
</span>            xmlFree<span class='Parentheses'>(</span><a href="xml.c.html#LN3716"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        xmlFree<span class='Parentheses'>(</span><a href="xml.c.html#LN3716"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
 
    <span class='Control'>return</span> <a href="xml.c.html#LN3679"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end xml_xmlnodetoxmltype &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Convert an XML XPath object (the result of evaluating an XPath expression) 
 * to an array of xml values, which are appended to astate.  The function 
 * result value is the number of elements in the array. 
 * 
 * If "astate" is NULL then we don't generate the array value, but we still 
 * return the number of elements it would have had. 
 * 
 * Nodesets are converted to an array containing the nodes' textual 
 * representations.  Primitive values (float, double, string) are converted 
 * to a single-element array containing the value's string representation. 
 */ 
</span><span class='Keyword'>static int 
</span><a name="LN3752"></a><span class='Declare_Function'>xml_xpathobjtoxmlarray</span><span class='Parentheses'>(</span>xmlXPathObjectPtr <span class='Declare_Parameter'>xpathobj</span><span class='Delimiter'>, 
</span><a name="LN3753"></a>                       <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Delimiter'>, 
</span><a name="LN3754"></a>                       <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>xmlerrcxt</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3756"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN3757"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>datum</span><span class='Delimiter'>; 
</span><a name="LN3758"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>datumtype</span><span class='Delimiter'>; 
</span><a name="LN3759"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>result_str</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3752"><span class='Ref_to_Parameter'>xpathobj</span></a><span class='Operator'>-&GT;</span>type<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> XPATH_NODESET<span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3752"><span class='Ref_to_Parameter'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="xml.c.html#LN3756"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN3752"><span class='Ref_to_Parameter'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval<span class='Operator'>-&GT;</span>nodeNr<span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3753"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span><a name="LN3769"></a>                    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3769"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN3769"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="xml.c.html#LN3756"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN3769"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="xml.c.html#LN3757"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN144"><span class='Ref_to_Proto'>xml_xmlnodetoxmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3752"><span class='Ref_to_Parameter'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval<span class='Operator'>-&GT;</span>nodeTab<span class='Delimiter'>[</span><a href="xml.c.html#LN3769"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                                                 <a href="xml.c.html#LN3754"><span class='Ref_to_Parameter'>xmlerrcxt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                        <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3753"><span class='Ref_to_Parameter'>astate</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3757"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                                                <a href="../../../include/catalog/pg_type.h.html#LN358"><span class='Ref_to_Const'>XMLOID</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>return</span> <a href="xml.c.html#LN3756"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> XPATH_BOOLEAN<span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3753"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN3757"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN407"><span class='Ref_to_Macro'>BoolGetDatum</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3752"><span class='Ref_to_Parameter'>xpathobj</span></a><span class='Operator'>-&GT;</span>boolval<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN3758"><span class='Ref_To_Local'>datumtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> XPATH_NUMBER<span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3753"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN3757"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN745"><span class='Ref_to_Func'>Float8GetDatum</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3752"><span class='Ref_to_Parameter'>xpathobj</span></a><span class='Operator'>-&GT;</span>floatval<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN3758"><span class='Ref_To_Local'>datumtype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN39"><span class='Ref_to_Const'>FLOAT8OID</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> XPATH_STRING<span class='Operator'>: 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3753"><span class='Ref_to_Parameter'>astate</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN3757"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN583"><span class='Ref_to_Macro'>CStringGetDatum</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN3752"><span class='Ref_to_Parameter'>xpathobj</span></a><span class='Operator'>-&GT;</span>stringval<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="xml.c.html#LN3758"><span class='Ref_To_Local'>datumtype</span></a> <span class='Operator'>= </span><a href="../../../include/catalog/pg_type.h.html#LN683"><span class='Ref_to_Const'>CSTRINGOID</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"xpath expression result type %d is unsupported"</span><span class='Delimiter'>, 
</span>                 <a href="xml.c.html#LN3752"><span class='Ref_to_Parameter'>xpathobj</span></a><span class='Operator'>-&GT;</span>type<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch xpathobj-&GT;type &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Common code for scalar-value cases */ 
</span>    <a href="xml.c.html#LN3759"><span class='Ref_To_Local'>result_str</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN75"><span class='Ref_to_Proto'>map_sql_value_to_xml_value</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3757"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3758"><span class='Ref_To_Local'>datumtype</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN3757"><span class='Ref_To_Local'>datum</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN561"><span class='Ref_to_Macro'>PointerGetDatum</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN450"><span class='Ref_to_Func'>cstring_to_xmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3759"><span class='Ref_To_Local'>result_str</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="../../../include/utils/array.h.html#LN390"><span class='Ref_to_Proto'>accumArrayResult</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3753"><span class='Ref_to_Parameter'>astate</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3757"><span class='Ref_To_Local'>datum</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, 
</span>                            <a href="../../../include/catalog/pg_type.h.html#LN358"><span class='Ref_to_Const'>XMLOID</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>1</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end xml_xpathobjtoxmlarray &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Common code for xpath() and xmlexists() 
 * 
 * Evaluate XPath expression and return number of nodes in res_items 
 * and array of XML values in astate.  Either of those pointers can be 
 * NULL if the corresponding result isn't wanted. 
 * 
 * It is up to the user to ensure that the XML passed is in fact 
 * an XML document - XPath doesn't work easily on fragments without 
 * a context node being known. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN3830"></a><span class='Declare_Function'>xpath_internal</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>xpath_expr_text</span><span class='Delimiter'>, </span><a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>namespaces</span><span class='Delimiter'>, 
</span><a name="LN3831"></a>               <span class='Keyword'>int </span><span class='Operator'>*</span><span class='Declare_Parameter'>res_nitems</span><span class='Delimiter'>, </span><a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>astate</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN3833"></a>    <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xmlerrcxt</span><span class='Delimiter'>; 
</span><a name="LN3834"></a>    <span class='Keyword'>volatile </span>xmlParserCtxtPtr <span class='Declare_Local'>ctxt</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3835"></a>    <span class='Keyword'>volatile </span>xmlDocPtr <span class='Declare_Local'>doc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3836"></a>    <span class='Keyword'>volatile </span>xmlXPathContextPtr <span class='Declare_Local'>xpathctx</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3837"></a>    <span class='Keyword'>volatile </span>xmlXPathCompExprPtr <span class='Declare_Local'>xpathcomp</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3838"></a>    <span class='Keyword'>volatile </span>xmlXPathObjectPtr <span class='Declare_Local'>xpathobj</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN3839"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>datastr</span><span class='Delimiter'>; 
</span><a name="LN3840"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>len</span><span class='Delimiter'>; 
</span><a name="LN3841"></a>    <a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a>       <span class='Declare_Local'>xpath_len</span><span class='Delimiter'>; 
</span><a name="LN3842"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>string</span><span class='Delimiter'>; 
</span><a name="LN3843"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>xpath_expr</span><span class='Delimiter'>; 
</span><a name="LN3844"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span><a name="LN3845"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ndim</span><span class='Delimiter'>; 
</span><a name="LN3846"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>ns_names_uris</span><span class='Delimiter'>; 
</span><a name="LN3847"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>ns_names_uris_nulls</span><span class='Delimiter'>; 
</span><a name="LN3848"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>ns_count</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Namespace mappings are passed as text[].  If an empty array is passed 
     * (ndim = 0, "0-dimensional"), then there are no namespace mappings. 
     * Else, a 2-dimensional array with length of the second axis being equal 
     * to 2 should be passed, i.e., every subarray contains 2 elements, the 
     * first element defining the name, the second one the URI.  Example: 
     * ARRAY[ARRAY['myns', 'http://example.com'], ARRAY['myns2', 
     * 'http://example2.com']]. 
     */ 
</span>    <a href="xml.c.html#LN3845"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN3830"><span class='Ref_to_Parameter'>namespaces</span></a> <span class='Operator'>? </span><a href="../../../include/utils/array.h.html#LN270"><span class='Ref_to_Macro'>ARR_NDIM</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3830"><span class='Ref_to_Parameter'>namespaces</span></a><span class='Parentheses'>) </span><span class='Operator'>: </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3845"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN3862"></a>        <span class='Keyword'>int</span>        <span class='Operator'>*</span><span class='Declare_Local'>dims</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN3862"><span class='Ref_To_Local'>dims</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN274"><span class='Ref_to_Macro'>ARR_DIMS</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3830"><span class='Ref_to_Parameter'>namespaces</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3845"><span class='Ref_To_Local'>ndim</span></a> <span class='Operator'>!= </span><span class='Number'>2</span> <span class='Operator'>|| </span><a href="xml.c.html#LN3862"><span class='Ref_To_Local'>dims</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                    <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATA_EXCEPTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"invalid array for XML namespace mapping"</span><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                     <a href="../error/elog.c.html#LN871"><span class='Ref_to_Func'>errdetail</span></a><span class='Parentheses'>(</span><span class='String'>"The array must be two-dimensional with length of the second axis equal to 2."</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN272"><span class='Ref_to_Macro'>ARR_ELEMTYPE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3830"><span class='Ref_to_Parameter'>namespaces</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/array.h.html#LN382"><span class='Ref_to_Proto'>deconstruct_array</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3830"><span class='Ref_to_Parameter'>namespaces</span></a><span class='Delimiter'>, </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Delimiter'>, </span><span class='Operator'>-</span><span class='Number'>1</span><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Delimiter'>, </span><span class='String'>'i'</span><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="xml.c.html#LN3846"><span class='Ref_To_Local'>ns_names_uris</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="xml.c.html#LN3847"><span class='Ref_To_Local'>ns_names_uris_nulls</span></a><span class='Delimiter'>, 
</span>                          <span class='Operator'>&</span><a href="xml.c.html#LN3848"><span class='Ref_To_Local'>ns_count</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>((</span><a href="xml.c.html#LN3848"><span class='Ref_To_Local'>ns_count</span></a> <span class='Operator'>% </span><span class='Number'>2</span><span class='Parentheses'>) </span><span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>;</span>    <span class='Comment_Single_Line'>/* checked above */ 
</span>        <a href="xml.c.html#LN3848"><span class='Ref_To_Local'>ns_count</span></a> <span class='Operator'>/= </span><span class='Number'>2</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* count pairs only */ 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ndim!=0 &raquo; </span> 
    <span class='Control'>else</span> 
    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN3846"><span class='Ref_To_Local'>ns_names_uris</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN3847"><span class='Ref_To_Local'>ns_names_uris_nulls</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN3848"><span class='Ref_To_Local'>ns_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="xml.c.html#LN3839"><span class='Ref_To_Local'>datastr</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN302"><span class='Ref_to_Macro'>VARDATA</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3830"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN3840"><span class='Ref_To_Local'>len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN303"><span class='Ref_to_Macro'>VARSIZE</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3830"><span class='Ref_to_Parameter'>data</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><a href="../../../include/c.h.html#LN444"><span class='Ref_to_Const'>VARHDRSZ</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN3841"><span class='Ref_To_Local'>xpath_len</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN339"><span class='Ref_to_Macro'>VARSIZE_ANY_EXHDR</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3830"><span class='Ref_to_Parameter'>xpath_expr_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3841"><span class='Ref_To_Local'>xpath_len</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATA_EXCEPTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"empty XPath expression"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3842"><span class='Ref_To_Local'>string</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN148"><span class='Ref_to_Proto'>pg_xmlCharStrndup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3839"><span class='Ref_To_Local'>datastr</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3840"><span class='Ref_To_Local'>len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN3843"><span class='Ref_To_Local'>xpath_expr</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN148"><span class='Ref_to_Proto'>pg_xmlCharStrndup</span></a><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN346"><span class='Ref_to_Macro'>VARDATA_ANY</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3830"><span class='Ref_to_Parameter'>xpath_expr_text</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><a href="xml.c.html#LN3841"><span class='Ref_To_Local'>xpath_len</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN56"><span class='Ref_to_Proto'>pg_xml_init</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN43"><span class='Ref_to_EnumConst'>PG_XML_STRICTNESS_ALL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        xmlInitParser<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * redundant XML parsing (two parsings for the same value during one 
         * command execution are possible) 
         */ 
</span>        <a href="xml.c.html#LN3834"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>= </span>xmlNewParserCtxt<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3834"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                        <span class='String'>"could not allocate parser context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN3835"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>= </span>xmlCtxtReadMemory<span class='Parentheses'>(</span><a href="xml.c.html#LN3834"><span class='Ref_To_Local'>ctxt</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN3842"><span class='Ref_To_Local'>string</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3840"><span class='Ref_To_Local'>len</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3835"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INVALID_XML_DOCUMENT<span class='Delimiter'>, 
</span>                        <span class='String'>"could not parse XML document"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN3836"><span class='Ref_To_Local'>xpathctx</span></a> <span class='Operator'>= </span>xmlXPathNewContext<span class='Parentheses'>(</span><a href="xml.c.html#LN3835"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3836"><span class='Ref_To_Local'>xpathctx</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                        <span class='String'>"could not allocate XPath context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN3836"><span class='Ref_To_Local'>xpathctx</span></a><span class='Operator'>-&GT;</span>node <span class='Operator'>= </span>xmlDocGetRootElement<span class='Parentheses'>(</span><a href="xml.c.html#LN3835"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3836"><span class='Ref_To_Local'>xpathctx</span></a><span class='Operator'>-&GT;</span>node <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>, 
</span>                        <span class='String'>"could not find root XML element"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* register namespaces, if any */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3848"><span class='Ref_To_Local'>ns_count</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3844"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN3844"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="xml.c.html#LN3848"><span class='Ref_To_Local'>ns_count</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN3844"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN3931"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ns_name</span><span class='Delimiter'>; 
</span><a name="LN3932"></a>                <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>ns_uri</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3847"><span class='Ref_To_Local'>ns_names_uris_nulls</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3844"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>|| 
</span>                    <a href="xml.c.html#LN3847"><span class='Ref_To_Local'>ns_names_uris_nulls</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3844"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_NULL_VALUE_NOT_ALLOWED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                      <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"neither namespace name nor URI may be null"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>                <a href="xml.c.html#LN3931"><span class='Ref_To_Local'>ns_name</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3846"><span class='Ref_To_Local'>ns_names_uris</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3844"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="xml.c.html#LN3932"><span class='Ref_To_Local'>ns_uri</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN91"><span class='Ref_to_Macro'>TextDatumGetCString</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3846"><span class='Ref_To_Local'>ns_names_uris</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN3844"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>* </span><span class='Number'>2</span> <span class='Operator'>+ </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlXPathRegisterNs<span class='Parentheses'>(</span><a href="xml.c.html#LN3836"><span class='Ref_To_Local'>xpathctx</span></a><span class='Delimiter'>, 
</span>                                       <span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN3931"><span class='Ref_To_Local'>ns_name</span></a><span class='Delimiter'>, 
</span>                                       <span class='Parentheses'>(</span>xmlChar <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN3932"><span class='Ref_To_Local'>ns_uri</span></a><span class='Parentheses'>)</span> <span class='Operator'>!= </span><span class='Number'>0</span><span class='Parentheses'>)</span> 
                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>,</span>      <span class='Comment_Single_Line'>/* is this an internal error??? */ 
</span>                            <span class='Parentheses'>(</span><a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"could not register XML namespace with name \"%s\" and URI \"%s\""</span><span class='Delimiter'>, 
</span>                                    <a href="xml.c.html#LN3931"><span class='Ref_To_Local'>ns_name</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3932"><span class='Ref_To_Local'>ns_uri</span></a><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ns_count&GT;0 &raquo; </span> 
 
        <a href="xml.c.html#LN3837"><span class='Ref_To_Local'>xpathcomp</span></a> <span class='Operator'>= </span>xmlXPathCompile<span class='Parentheses'>(</span><a href="xml.c.html#LN3843"><span class='Ref_To_Local'>xpath_expr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3837"><span class='Ref_To_Local'>xpathcomp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>, 
</span>                        <span class='String'>"invalid XPath expression"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Version 2.6.27 introduces a function named 
         * xmlXPathCompiledEvalToBoolean, which would be enough for xmlexists, 
         * but we can derive the existence by whether any nodes are returned, 
         * thereby preventing a library version upgrade and keeping the code 
         * the same. 
         */ 
</span>        <a href="xml.c.html#LN3838"><span class='Ref_To_Local'>xpathobj</span></a> <span class='Operator'>= </span>xmlXPathCompiledEval<span class='Parentheses'>(</span><a href="xml.c.html#LN3837"><span class='Ref_To_Local'>xpathcomp</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3836"><span class='Ref_To_Local'>xpathctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3838"><span class='Ref_To_Local'>xpathobj</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>, 
</span>                        <span class='String'>"could not create XPath object"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Extract the results as requested. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3831"><span class='Ref_to_Parameter'>res_nitems</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <span class='Operator'>*</span><a href="xml.c.html#LN3831"><span class='Ref_to_Parameter'>res_nitems</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN145"><span class='Ref_to_Proto'>xml_xpathobjtoxmlarray</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3838"><span class='Ref_To_Local'>xpathobj</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3831"><span class='Ref_to_Parameter'>astate</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) </span><a href="xml.c.html#LN145"><span class='Ref_to_Proto'>xml_xpathobjtoxmlarray</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3838"><span class='Ref_To_Local'>xpathobj</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3831"><span class='Ref_to_Parameter'>astate</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3838"><span class='Ref_To_Local'>xpathobj</span></a><span class='Parentheses'>) 
</span>            xmlXPathFreeObject<span class='Parentheses'>(</span><a href="xml.c.html#LN3838"><span class='Ref_To_Local'>xpathobj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3837"><span class='Ref_To_Local'>xpathcomp</span></a><span class='Parentheses'>) 
</span>            xmlXPathFreeCompExpr<span class='Parentheses'>(</span><a href="xml.c.html#LN3837"><span class='Ref_To_Local'>xpathcomp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3836"><span class='Ref_To_Local'>xpathctx</span></a><span class='Parentheses'>) 
</span>            xmlXPathFreeContext<span class='Parentheses'>(</span><a href="xml.c.html#LN3836"><span class='Ref_To_Local'>xpathctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3835"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>) 
</span>            xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN3835"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN3834"><span class='Ref_To_Local'>ctxt</span></a><span class='Parentheses'>) 
</span>            xmlFreeParserCtxt<span class='Parentheses'>(</span><a href="xml.c.html#LN3834"><span class='Ref_To_Local'>ctxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    xmlXPathFreeObject<span class='Parentheses'>(</span><a href="xml.c.html#LN3838"><span class='Ref_To_Local'>xpathobj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    xmlXPathFreeCompExpr<span class='Parentheses'>(</span><a href="xml.c.html#LN3837"><span class='Ref_To_Local'>xpathcomp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    xmlXPathFreeContext<span class='Parentheses'>(</span><a href="xml.c.html#LN3836"><span class='Ref_To_Local'>xpathctx</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN3835"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    xmlFreeParserCtxt<span class='Parentheses'>(</span><a href="xml.c.html#LN3834"><span class='Ref_To_Local'>ctxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN3833"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end xpath_internal &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* USE_LIBXML */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Evaluate XPath expression and return array of XML values. 
 * 
 * As we have no support of XQuery sequences yet, this function seems 
 * to be the most useful one (array of XML functions plays a role of 
 * some kind of substitution for XQuery sequences). 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4012"></a><span class='Declare_Function'>xpath</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4015"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>xpath_expr_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4016"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4017"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>namespaces</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4018"></a>    <a href="../../../include/utils/array.h.html#LN167"><span class='Ref_to_Struct'>ArrayBuildState</span></a> <span class='Operator'>*</span><span class='Declare_Local'>astate</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4018"><span class='Ref_To_Local'>astate</span></a> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN388"><span class='Ref_to_Proto'>initArrayResult</span></a><span class='Parentheses'>(</span><a href="../../../include/catalog/pg_type.h.html#LN358"><span class='Ref_to_Const'>XMLOID</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN3829"><span class='Ref_to_Func'>xpath_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4015"><span class='Ref_To_Local'>xpath_expr_text</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN4016"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN4017"><span class='Ref_To_Local'>namespaces</span></a><span class='Delimiter'>, 
</span>                   <span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><a href="xml.c.html#LN4018"><span class='Ref_To_Local'>astate</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/array.h.html#LN245"><span class='Ref_to_Macro'>PG_RETURN_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/array.h.html#LN394"><span class='Ref_to_Proto'>makeArrayResult</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4018"><span class='Ref_To_Local'>astate</span></a><span class='Delimiter'>, </span><a href="../mmgr/mcxt.c.html#LN36"><span class='Ref_to_Global_Var'>CurrentMemoryContext</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Determines if the node specified by the supplied XPath exists 
 * in a given XML document, returning a boolean. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4035"></a><span class='Declare_Function'>xmlexists</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4038"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>xpath_expr_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4039"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4040"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_nitems</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3829"><span class='Ref_to_Func'>xpath_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4038"><span class='Ref_To_Local'>xpath_expr_text</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN4039"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="xml.c.html#LN4040"><span class='Ref_To_Local'>res_nitems</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4040"><span class='Ref_To_Local'>res_nitems</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Determines if the node specified by the supplied XPath exists 
 * in a given XML document, returning a boolean. Differs from 
 * xmlexists as it supports namespaces and is not defined in SQL/XML. 
 */ 
</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4058"></a><span class='Declare_Function'>xpath_exists</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4061"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>xpath_expr_text</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4062"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN52"><span class='Ref_to_Macro'>PG_GETARG_XML_P</span></a><span class='Parentheses'>(</span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4063"></a>    <a href="../../../include/utils/array.h.html#LN75"><span class='Ref_to_Typedef'>ArrayType</span></a>  <span class='Operator'>*</span><span class='Declare_Local'>namespaces</span> <span class='Operator'>= </span><a href="../../../include/utils/array.h.html#LN243"><span class='Ref_to_Macro'>PG_GETARG_ARRAYTYPE_P</span></a><span class='Parentheses'>(</span><span class='Number'>2</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4064"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>res_nitems</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN3829"><span class='Ref_to_Func'>xpath_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4061"><span class='Ref_To_Local'>xpath_expr_text</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN4062"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN4063"><span class='Ref_To_Local'>namespaces</span></a><span class='Delimiter'>, 
</span>                   <span class='Operator'>&</span><a href="xml.c.html#LN4064"><span class='Ref_To_Local'>res_nitems</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4064"><span class='Ref_To_Local'>res_nitems</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Functions for checking well-formed-ness 
 */ 
</span> 
<span class='Directive'>#ifdef</span> USE_LIBXML 
<span class='Keyword'>static bool 
</span><a name="LN4082"></a><span class='Declare_Function'>wellformed_xml</span><span class='Parentheses'>(</span><a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>data</span><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1131"><span class='Ref_to_Typedef'>XmlOptionType</span></a> <span class='Declare_Parameter'>xmloption_arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4084"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span><a name="LN4085"></a>    <span class='Keyword'>volatile </span>xmlDocPtr <span class='Declare_Local'>doc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* We want to catch any exceptions and return false */ 
</span>    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN4085"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN142"><span class='Ref_to_Proto'>xml_parse</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4082"><span class='Ref_to_Parameter'>data</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN4082"><span class='Ref_to_Parameter'>xmloption_arg</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="../../../include/mb/pg_wchar.h.html#LN545"><span class='Ref_to_Proto'>GetDatabaseEncoding</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN4084"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/utils/elog.h.html#LN365"><span class='Ref_to_Proto'>FlushErrorState</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN4084"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4085"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>) 
</span>        xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN4085"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN4084"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end wellformed_xml &raquo; </span> 
<span class='Directive'>#endif</span> 
 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4108"></a><span class='Declare_Function'>xml_is_well_formed</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4111"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4081"><span class='Ref_to_Func'>wellformed_xml</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4111"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN96"><span class='Ref_to_Global_Var'>xmloption</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4121"></a><span class='Declare_Function'>xml_is_well_formed_document</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4124"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4081"><span class='Ref_to_Func'>wellformed_xml</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4124"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1133"><span class='Ref_to_EnumConst'>XMLOPTION_DOCUMENT</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>} 
</span> 
<a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4134"></a><span class='Declare_Function'>xml_is_well_formed_content</span><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN157"><span class='Ref_to_Const'>PG_FUNCTION_ARGS</span></a><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4137"></a>    <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>data</span> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN272"><span class='Ref_to_Macro'>PG_GETARG_TEXT_PP</span></a><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/fmgr.h.html#LN318"><span class='Ref_to_Macro'>PG_RETURN_BOOL</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4081"><span class='Ref_to_Func'>wellformed_xml</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4137"><span class='Ref_To_Local'>data</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/primnodes.h.html#LN1134"><span class='Ref_to_EnumConst'>XMLOPTION_CONTENT</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>} 
</span> 
<span class='Comment_Multi_Line'>/* 
 * support functions for XMLTABLE 
 * 
 */ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
 
<span class='Comment_Multi_Line'>/* 
 * Returns private data from executor state. Ensure validity by check with 
 * MAGIC number. 
 */ 
</span><span class='Keyword'>static inline </span><a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>* 
</span><a name="LN4157"></a><span class='Declare_Function'>GetXmlTableBuilderPrivateData</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>const char </span><span class='Operator'>*</span><span class='Declare_Parameter'>fname</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN4159"></a>    <a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>result</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../../include/nodes/nodes.h.html#LN559"><span class='Ref_to_Macro'>IsA</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4157"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a><span class='Parentheses'>))</span> 
        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"%s called with invalid TableFuncScanState"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN4157"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN4159"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN4157"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN1429"><span class='Ref_to_Member'>opaque</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4159"><span class='Ref_To_Local'>result</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN179"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>!= </span><a href="xml.c.html#LN176"><span class='Ref_to_Const'>XMLTABLE_CONTEXT_MAGIC</span></a><span class='Parentheses'>) 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"%s called with invalid TableFuncScanState"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN4157"><span class='Ref_to_Parameter'>fname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN4159"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
} 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* 
 * XmlTableInitOpaque 
 *      Fill in TableFuncScanState-&GT;opaque for XmlTable processor; initialize 
 *      the XML parser. 
 * 
 * Note: Because we call pg_xml_init() here and pg_xml_done() in 
 * XmlTableDestroyOpaque, it is critical for robustness that no other 
 * executor nodes run until this node is processed to completion.  Caller 
 * must execute this to completion (probably filling a tuplestore to exhaust 
 * this node in a single pass) instead of using row-per-call mode. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4183"></a><span class='Declare_Function'>XmlTableInitOpaque</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>natts</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4186"></a>    <span class='Keyword'>volatile </span>xmlParserCtxtPtr <span class='Declare_Local'>ctxt</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4187"></a>    <a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xtCxt</span><span class='Delimiter'>; 
</span><a name="LN4188"></a>    <a href="xml.c.html#LN103"><span class='Ref_to_Struct'>PgXmlErrorContext</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xmlerrcxt</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4187"><span class='Ref_To_Local'>xtCxt</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN4187"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN179"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN176"><span class='Ref_to_Const'>XMLTABLE_CONTEXT_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN4187"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN180"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4183"><span class='Ref_to_Parameter'>natts</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN4187"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN188"><span class='Ref_to_Member'>xpathscomp</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span>xmlXPathCompExprPtr<span class='Parentheses'>) </span><span class='Operator'>* </span><a href="xml.c.html#LN4183"><span class='Ref_to_Parameter'>natts</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4188"><span class='Ref_To_Local'>xmlerrcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN56"><span class='Ref_to_Proto'>pg_xml_init</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/xml.h.html#LN43"><span class='Ref_to_EnumConst'>PG_XML_STRICTNESS_ALL</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        xmlInitParser<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN4186"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>= </span>xmlNewParserCtxt<span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4186"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN4188"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4188"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                        <span class='String'>"could not allocate parser context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4186"><span class='Ref_To_Local'>ctxt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            xmlFreeParserCtxt<span class='Parentheses'>(</span><a href="xml.c.html#LN4186"><span class='Ref_To_Local'>ctxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4188"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4187"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4188"><span class='Ref_To_Local'>xmlerrcxt</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN4187"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN183"><span class='Ref_to_Member'>ctxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4186"><span class='Ref_To_Local'>ctxt</span></a><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4183"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN1429"><span class='Ref_to_Member'>opaque</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4187"><span class='Ref_To_Local'>xtCxt</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XmlTableInitOpaque &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * XmlTableSetDocument 
 *      Install the input document 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4231"></a><span class='Declare_Function'>XmlTableSetDocument</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>value</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4234"></a>    <a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xtCxt</span><span class='Delimiter'>; 
</span><a name="LN4235"></a>    <a href="../../../include/utils/xml.h.html#LN22"><span class='Ref_to_Typedef'>xmltype</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>xmlval</span> <span class='Operator'>= </span><a href="../../../include/utils/xml.h.html#LN49"><span class='Ref_to_Macro'>DatumGetXmlP</span></a><span class='Parentheses'>(</span><span class='Keyword'>value</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN4236"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN4237"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>xstr</span><span class='Delimiter'>; 
</span><a name="LN4238"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>length</span><span class='Delimiter'>; 
</span><a name="LN4239"></a>    <span class='Keyword'>volatile </span>xmlDocPtr <span class='Declare_Local'>doc</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4240"></a>    <span class='Keyword'>volatile </span>xmlXPathContextPtr <span class='Declare_Local'>xpathcxt</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4156"><span class='Ref_to_Func'>GetXmlTableBuilderPrivateData</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4231"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='String'>"XmlTableSetDocument"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Use out function for casting to string (remove encoding property). See 
     * comment in xml_out. 
     */ 
</span>    <a href="xml.c.html#LN4236"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN289"><span class='Ref_to_Func'>xml_out_internal</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4235"><span class='Ref_To_Local'>xmlval</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4238"><span class='Ref_To_Local'>length</span></a> <span class='Operator'>= </span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN4236"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN4237"><span class='Ref_To_Local'>xstr</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN148"><span class='Ref_to_Proto'>pg_xmlCharStrndup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4236"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN4238"><span class='Ref_To_Local'>length</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN4239"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>= </span>xmlCtxtReadMemory<span class='Parentheses'>(</span><a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN183"><span class='Ref_to_Member'>ctxt</span></a><span class='Delimiter'>, </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN4237"><span class='Ref_To_Local'>xstr</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN4238"><span class='Ref_To_Local'>length</span></a><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Null_Value'>NULL</span><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4239"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INVALID_XML_DOCUMENT<span class='Delimiter'>, 
</span>                        <span class='String'>"could not parse XML document"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN4240"><span class='Ref_To_Local'>xpathcxt</span></a> <span class='Operator'>= </span>xmlXPathNewContext<span class='Parentheses'>(</span><a href="xml.c.html#LN4239"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4240"><span class='Ref_To_Local'>xpathcxt</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_OUT_OF_MEMORY<span class='Delimiter'>, 
</span>                        <span class='String'>"could not allocate XPath context"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="xml.c.html#LN4240"><span class='Ref_To_Local'>xpathcxt</span></a><span class='Operator'>-&GT;</span>node <span class='Operator'>= </span>xmlDocGetRootElement<span class='Parentheses'>(</span><a href="xml.c.html#LN4239"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4240"><span class='Ref_To_Local'>xpathcxt</span></a><span class='Operator'>-&GT;</span>node <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>, 
</span>                        <span class='String'>"could not find root XML element"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4240"><span class='Ref_To_Local'>xpathcxt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            xmlXPathFreeContext<span class='Parentheses'>(</span><a href="xml.c.html#LN4240"><span class='Ref_To_Local'>xpathcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4239"><span class='Ref_To_Local'>doc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN4239"><span class='Ref_To_Local'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN184"><span class='Ref_to_Member'>doc</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4239"><span class='Ref_To_Local'>doc</span></a><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN4234"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN185"><span class='Ref_to_Member'>xpathcxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4240"><span class='Ref_To_Local'>xpathcxt</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XmlTableSetDocument &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * XmlTableSetNamespace 
 *      Add a namespace declaration 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4291"></a><span class='Declare_Function'>XmlTableSetNamespace</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>name</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>uri</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4294"></a>    <a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xtCxt</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4291"><span class='Ref_to_Parameter'>name</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_FEATURE_NOT_SUPPORTED<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"DEFAULT namespace is not supported"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN4294"><span class='Ref_To_Local'>xtCxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4156"><span class='Ref_to_Func'>GetXmlTableBuilderPrivateData</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4291"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='String'>"XmlTableSetNamespace"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span>xmlXPathRegisterNs<span class='Parentheses'>(</span><a href="xml.c.html#LN4294"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN185"><span class='Ref_to_Member'>xpathcxt</span></a><span class='Delimiter'>, 
</span>                           <a href="xml.c.html#LN148"><span class='Ref_to_Proto'>pg_xmlCharStrndup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4291"><span class='Ref_to_Parameter'>name</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN4291"><span class='Ref_to_Parameter'>name</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>                           <a href="xml.c.html#LN148"><span class='Ref_to_Proto'>pg_xmlCharStrndup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4291"><span class='Ref_to_Parameter'>uri</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN4291"><span class='Ref_to_Parameter'>uri</span></a><span class='Parentheses'>))))</span> 
        <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4294"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_DATA_EXCEPTION<span class='Delimiter'>, 
</span>                    <span class='String'>"could not set XML namespace"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XmlTableSetNamespace &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * XmlTableSetRowFilter 
 *      Install the row-filter Xpath expression. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4317"></a><span class='Declare_Function'>XmlTableSetRowFilter</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4320"></a>    <a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xtCxt</span><span class='Delimiter'>; 
</span><a name="LN4321"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>xstr</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4320"><span class='Ref_To_Local'>xtCxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4156"><span class='Ref_to_Func'>GetXmlTableBuilderPrivateData</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4317"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='String'>"XmlTableSetRowFilter"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN4317"><span class='Ref_to_Parameter'>path</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATA_EXCEPTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"row path filter must not be empty string"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4321"><span class='Ref_To_Local'>xstr</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN148"><span class='Ref_to_Proto'>pg_xmlCharStrndup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4317"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN4317"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4320"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN186"><span class='Ref_to_Member'>xpathcomp</span></a> <span class='Operator'>= </span>xmlXPathCompile<span class='Parentheses'>(</span><a href="xml.c.html#LN4321"><span class='Ref_To_Local'>xstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4320"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN186"><span class='Ref_to_Member'>xpathcomp</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN4320"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4320"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_SYNTAX_ERROR<span class='Delimiter'>, 
</span>                    <span class='String'>"invalid XPath expression"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XmlTableSetRowFilter &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * XmlTableSetColumnFilter 
 *      Install the column-filter Xpath expression, for the given column. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4346"></a><span class='Declare_Function'>XmlTableSetColumnFilter</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Declare_Parameter'>path</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>colnum</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4349"></a>    <a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xtCxt</span><span class='Delimiter'>; 
</span><a name="LN4350"></a>    xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>xstr</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/c.h.html#LN676"><span class='Ref_to_Macro'>AssertArg</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4346"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4349"><span class='Ref_To_Local'>xtCxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4156"><span class='Ref_to_Func'>GetXmlTableBuilderPrivateData</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4346"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='String'>"XmlTableSetColumnFilter"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="xml.c.html#LN4346"><span class='Ref_to_Parameter'>path</span></a> <span class='Operator'>== </span><span class='String'>'\0'</span><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_DATA_EXCEPTION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                 <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"column path filter must not be empty string"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4350"><span class='Ref_To_Local'>xstr</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN148"><span class='Ref_to_Proto'>pg_xmlCharStrndup</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4346"><span class='Ref_to_Parameter'>path</span></a><span class='Delimiter'>, </span>strlen<span class='Parentheses'>(</span><a href="xml.c.html#LN4346"><span class='Ref_to_Parameter'>path</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4349"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN188"><span class='Ref_to_Member'>xpathscomp</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN4346"><span class='Ref_to_Parameter'>colnum</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span>xmlXPathCompile<span class='Parentheses'>(</span><a href="xml.c.html#LN4350"><span class='Ref_To_Local'>xstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4349"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN188"><span class='Ref_to_Member'>xpathscomp</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN4346"><span class='Ref_to_Parameter'>colnum</span></a><span class='Delimiter'>] </span><span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN4349"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4349"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_DATA_EXCEPTION<span class='Delimiter'>, 
</span>                    <span class='String'>"invalid XPath expression"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XmlTableSetColumnFilter &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * XmlTableFetchRow 
 *      Prepare the next "current" tuple for upcoming GetValue calls. 
 *      Returns FALSE if the row-filter expression returned no more rows. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN4378"></a><span class='Declare_Function'>XmlTableFetchRow</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4381"></a>    <a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xtCxt</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4156"><span class='Ref_to_Func'>GetXmlTableBuilderPrivateData</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4378"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='String'>"XmlTableFetchRow"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * XmlTable returns table - set of composite values. The error context, is 
     * used for producement more values, between two calls, there can be 
     * created and used another libxml2 error context. It is libxml2 global 
     * value, so it should be refreshed any time before any libxml2 usage, 
     * that is finished by returning some value. 
     */ 
</span>    xmlSetStructuredErrorFunc<span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN120"><span class='Ref_to_Proto'>xml_errorHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a> <span class='Operator'>= </span>xmlXPathCompiledEval<span class='Parentheses'>(</span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN186"><span class='Ref_to_Member'>xpathcomp</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN185"><span class='Ref_to_Member'>xpathcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>, 
</span>                        <span class='String'>"could not create XPath object"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN181"><span class='Ref_to_Member'>row_count</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a><span class='Operator'>-&GT;</span>type <span class='Operator'>== </span>XPATH_NODESET<span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN181"><span class='Ref_to_Member'>row_count</span></a><span class='Operator'>++ &LT; </span><a href="xml.c.html#LN4381"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval<span class='Operator'>-&GT;</span>nodeNr<span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XmlTableFetchRow &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * XmlTableGetValue 
 *      Return the value for column number 'colnum' for the current row.  If 
 *      column -1 is requested, return representation of the whole row. 
 * 
 * This leaks memory, so be sure to reset often the context in which it's 
 * called. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> 
<a name="LN4429"></a><span class='Declare_Function'>XmlTableGetValue</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>colnum</span><span class='Delimiter'>, 
</span><a name="LN4430"></a>                 <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>typid</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN255"><span class='Ref_to_Typedef'>int32</span></a> <span class='Declare_Parameter'>typmod</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Declare_Parameter'>isnull</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4433"></a>    <a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xtCxt</span><span class='Delimiter'>; 
</span><a name="LN4434"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>result</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>) </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN4435"></a>    xmlNodePtr  <span class='Declare_Local'>cur</span><span class='Delimiter'>; 
</span><a name="LN4436"></a>    <span class='Keyword'>char</span>       <span class='Operator'>*</span><span class='Declare_Local'>cstr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span><a name="LN4437"></a>    <span class='Keyword'>volatile </span>xmlXPathObjectPtr <span class='Declare_Local'>xpathobj</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4156"><span class='Ref_to_Func'>GetXmlTableBuilderPrivateData</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4429"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='String'>"XmlTableGetValue"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a> <span class='Operator'>&& 
</span>           <a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a><span class='Operator'>-&GT;</span>type <span class='Operator'>== </span>XPATH_NODESET <span class='Operator'>&& 
</span>           <a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Propagate context related error context to libxml2 */ 
</span>    xmlSetStructuredErrorFunc<span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN120"><span class='Ref_to_Proto'>xml_errorHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>*</span><a href="xml.c.html#LN4430"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4435"><span class='Ref_To_Local'>cur</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval<span class='Operator'>-&GT;</span>nodeTab<span class='Delimiter'>[</span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN181"><span class='Ref_to_Member'>row_count</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN188"><span class='Ref_to_Member'>xpathscomp</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN4429"><span class='Ref_to_Parameter'>colnum</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* Set current node as entry point for XPath evaluation */ 
</span>        <a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN185"><span class='Ref_to_Member'>xpathcxt</span></a><span class='Operator'>-&GT;</span>node <span class='Operator'>= </span><a href="xml.c.html#LN4435"><span class='Ref_To_Local'>cur</span></a><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Evaluate column path */ 
</span>        <a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a> <span class='Operator'>= </span>xmlXPathCompiledEval<span class='Parentheses'>(</span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN188"><span class='Ref_to_Member'>xpathscomp</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN4429"><span class='Ref_to_Parameter'>colnum</span></a><span class='Delimiter'>], </span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN185"><span class='Ref_to_Member'>xpathcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN109"><span class='Ref_to_Member'>err_occurred</span></a><span class='Parentheses'>) 
</span>            <a href="../../../include/utils/xml.h.html#LN59"><span class='Ref_to_Proto'>xml_ereport</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span>ERRCODE_INTERNAL_ERROR<span class='Delimiter'>, 
</span>                        <span class='String'>"could not create XPath object"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * There are four possible cases, depending on the number of nodes 
         * returned by the XPath expression and the type of the target column: 
         * a) XPath returns no nodes.  b) One node is returned, and column is 
         * of type XML.  c) One node, column type other than XML.  d) Multiple 
         * nodes are returned. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>type <span class='Operator'>== </span>XPATH_NODESET<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN4474"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>count</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <a href="xml.c.html#LN4474"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval<span class='Operator'>-&GT;</span>nodeNr<span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="xml.c.html#LN4474"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Operator'>*</span><a href="xml.c.html#LN4430"><span class='Ref_to_Parameter'>isnull</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4474"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>== </span><span class='Number'>1</span> <span class='Operator'>&& </span><a href="xml.c.html#LN4430"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>== </span><a href="../../../include/catalog/pg_type.h.html#LN358"><span class='Ref_to_Const'>XMLOID</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4485"></a>                <a href="../../../../contrib/seg/segparse.y.html#LN46"><span class='Ref_to_Global_Var'>text</span></a>       <span class='Operator'>*</span><span class='Declare_Local'>textstr</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* simple case, result is one value */ 
</span>                <a href="xml.c.html#LN4485"><span class='Ref_To_Local'>textstr</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN144"><span class='Ref_to_Proto'>xml_xmlnodetoxmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval<span class='Operator'>-&GT;</span>nodeTab<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                               <a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <a href="xml.c.html#LN4436"><span class='Ref_To_Local'>cstr</span></a> <span class='Operator'>= </span><a href="../../../include/utils/builtins.h.html#LN87"><span class='Ref_to_Proto'>text_to_cstring</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4485"><span class='Ref_To_Local'>textstr</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4474"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>== </span><span class='Number'>1</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN4494"></a>                xmlChar    <span class='Operator'>*</span><span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span> 
                <a href="xml.c.html#LN4494"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>= </span>xmlNodeListGetString<span class='Parentheses'>(</span><a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN184"><span class='Ref_to_Member'>doc</span></a><span class='Delimiter'>, 
</span>                           <a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval<span class='Operator'>-&GT;</span>nodeTab<span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>xmlChildrenNode<span class='Delimiter'>, 
</span>                                           <span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4494"><span class='Ref_To_Local'>str</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>{ 
</span>                        <a href="xml.c.html#LN4436"><span class='Ref_To_Local'>cstr</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN4494"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>{ 
</span>                        xmlFree<span class='Parentheses'>(</span><a href="xml.c.html#LN4494"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    <span class='Delimiter'>} 
</span>                    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>                    xmlFree<span class='Parentheses'>(</span><a href="xml.c.html#LN4494"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <span class='Control'>else</span> 
                <span class='Delimiter'>{ 
</span>                    <span class='Comment_Multi_Line'>/* 
                     * This line ensure mapping of empty tags to PostgreSQL 
                     * value. Usually we would to map a empty tag to empty 
                     * string. But this mapping can create empty string when 
                     * user doesn't expect it - when empty tag is enforced by 
                     * libxml2 - when user uses a text() function for example. 
                     */ 
</span>                    <a href="xml.c.html#LN4436"><span class='Ref_To_Local'>cstr</span></a> <span class='Operator'>= </span><span class='String'>""</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if count==1 &raquo; </span> 
            <span class='Control'>else</span> 
            <span class='Delimiter'>{ 
</span><a name="LN4528"></a>                <a href="../../../include/lib/stringinfo.h.html#LN34"><span class='Ref_to_Struct'>StringInfoData</span></a> <span class='Declare_Local'>str</span><span class='Delimiter'>; 
</span><a name="LN4529"></a>                <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="xml.c.html#LN4474"><span class='Ref_To_Local'>count</span></a> <span class='Operator'>&GT; </span><span class='Number'>1</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * When evaluating the XPath expression returns multiple 
                 * nodes, the result is the concatenation of them all. The 
                 * target type must be XML. 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4430"><span class='Ref_to_Parameter'>typid</span></a> <span class='Operator'>!= </span><a href="../../../include/catalog/pg_type.h.html#LN358"><span class='Ref_to_Const'>XMLOID</span></a><span class='Parentheses'>) 
</span>                    <a href="../../../include/utils/elog.h.html#LN121"><span class='Ref_to_Macro'>ereport</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, 
</span>                            <span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN130"><span class='Ref_to_Proto'>errcode</span></a><span class='Parentheses'>(</span>ERRCODE_CARDINALITY_VIOLATION<span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                             <a href="../error/elog.c.html#LN795"><span class='Ref_to_Func'>errmsg</span></a><span class='Parentheses'>(</span><span class='String'>"more than one value returned by column XPath expression"</span><span class='Parentheses'>)))</span><span class='Delimiter'>; 
</span> 
                <span class='Comment_Multi_Line'>/* Concatenate serialized values */ 
</span>                <a href="../../lib/stringinfo.c.html#LN44"><span class='Ref_to_Func'>initStringInfo</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN4528"><span class='Ref_To_Local'>str</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4529"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN4529"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="xml.c.html#LN4474"><span class='Ref_To_Local'>count</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN4529"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>                <span class='Delimiter'>{ 
</span>                    <a href="varlena.c.html#LN117"><span class='Ref_to_Proto'>appendStringInfoText</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN4528"><span class='Ref_To_Local'>str</span></a><span class='Delimiter'>, 
</span>                       <a href="xml.c.html#LN144"><span class='Ref_to_Proto'>xml_xmlnodetoxmltype</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>nodesetval<span class='Operator'>-&GT;</span>nodeTab<span class='Delimiter'>[</span><a href="xml.c.html#LN4529"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                                            <a href="xml.c.html#LN4433"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <span class='Delimiter'>} 
</span>                <a href="xml.c.html#LN4436"><span class='Ref_To_Local'>cstr</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4528"><span class='Ref_To_Local'>str</span></a><span class='Operator'>.</span><a href="../../../include/lib/stringinfo.h.html#LN36"><span class='Ref_to_Member'>data</span></a><span class='Delimiter'>; 
</span>            <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end else &raquo; </span> 
        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if xpathobj-&GT;type==XPATH... &raquo; </span> 
        <span class='Control'>else</span> <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>type <span class='Operator'>== </span>XPATH_STRING<span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="xml.c.html#LN4436"><span class='Ref_To_Local'>cstr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>stringval<span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/port/win32/sys/socket.h.html#LN22"><span class='Ref_to_Const'>ERROR</span></a><span class='Delimiter'>, </span><span class='String'>"unexpected XPath object type %u"</span><span class='Delimiter'>, </span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Operator'>-&GT;</span>type<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * By here, either cstr contains the result value, or the isnull flag 
         * has been set. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="xml.c.html#LN4436"><span class='Ref_To_Local'>cstr</span></a> <span class='Operator'>|| *</span><a href="xml.c.html#LN4430"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!*</span><a href="xml.c.html#LN4430"><span class='Ref_to_Parameter'>isnull</span></a><span class='Parentheses'>) 
</span>            <a href="xml.c.html#LN4434"><span class='Ref_To_Local'>result</span></a> <span class='Operator'>= </span><a href="../../../include/fmgr.h.html#LN642"><span class='Ref_to_Proto'>InputFunctionCall</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="xml.c.html#LN4429"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN1431"><span class='Ref_to_Member'>in_functions</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN4429"><span class='Ref_to_Parameter'>colnum</span></a><span class='Delimiter'>], 
</span>                                       <a href="xml.c.html#LN4436"><span class='Ref_To_Local'>cstr</span></a><span class='Delimiter'>, 
</span>                                       <a href="xml.c.html#LN4429"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN1432"><span class='Ref_to_Member'>typioparams</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN4429"><span class='Ref_to_Parameter'>colnum</span></a><span class='Delimiter'>], 
</span>                                       <a href="xml.c.html#LN4430"><span class='Ref_to_Parameter'>typmod</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            xmlXPathFreeObject<span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    xmlXPathFreeObject<span class='Parentheses'>(</span><a href="xml.c.html#LN4437"><span class='Ref_To_Local'>xpathobj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="xml.c.html#LN4434"><span class='Ref_To_Local'>result</span></a><span class='Delimiter'>; 
</span><span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Control'>return</span> <span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XmlTableGetValue &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * XmlTableDestroyOpaque 
 *      Release all libxml2 resources 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN4595"></a><span class='Declare_Function'>XmlTableDestroyOpaque</span><span class='Parentheses'>(</span><a href="../../../include/nodes/execnodes.h.html#LN1419"><span class='Ref_to_Struct'>TableFuncScanState</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>state</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_LIBXML 
<a name="LN4598"></a>    <a href="xml.c.html#LN177"><span class='Ref_to_Struct'>XmlTableBuilderData</span></a> <span class='Operator'>*</span><span class='Declare_Local'>xtCxt</span><span class='Delimiter'>; 
</span> 
    <a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a> <span class='Operator'>= </span><a href="xml.c.html#LN4156"><span class='Ref_to_Func'>GetXmlTableBuilderPrivateData</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4595"><span class='Ref_to_Parameter'>state</span></a><span class='Delimiter'>, </span><span class='String'>"XmlTableDestroyOpaque"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Propagate context related error context to libxml2 */ 
</span>    xmlSetStructuredErrorFunc<span class='Parentheses'>((</span><span class='Keyword'>void </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><a href="xml.c.html#LN120"><span class='Ref_to_Proto'>xml_errorHandler</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN188"><span class='Ref_to_Member'>xpathscomp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN4607"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4607"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="xml.c.html#LN4607"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN180"><span class='Ref_to_Member'>natts</span></a><span class='Delimiter'>; </span><a href="xml.c.html#LN4607"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN188"><span class='Ref_to_Member'>xpathscomp</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN4607"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>                xmlXPathFreeCompExpr<span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN188"><span class='Ref_to_Member'>xpathscomp</span></a><span class='Delimiter'>[</span><a href="xml.c.html#LN4607"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        xmlXPathFreeObject<span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN187"><span class='Ref_to_Member'>xpathobj</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN186"><span class='Ref_to_Member'>xpathcomp</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        xmlXPathFreeCompExpr<span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN186"><span class='Ref_to_Member'>xpathcomp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN185"><span class='Ref_to_Member'>xpathcxt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        xmlXPathFreeContext<span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN185"><span class='Ref_to_Member'>xpathcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN184"><span class='Ref_to_Member'>doc</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        xmlFreeDoc<span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN184"><span class='Ref_to_Member'>doc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN183"><span class='Ref_to_Member'>ctxt</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        xmlFreeParserCtxt<span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN183"><span class='Ref_to_Member'>ctxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/xml.h.html#LN57"><span class='Ref_to_Proto'>pg_xml_done</span></a><span class='Parentheses'>(</span><a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN182"><span class='Ref_to_Member'>xmlerrcxt</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* not valid anymore */ 
</span>    <a href="xml.c.html#LN4598"><span class='Ref_To_Local'>xtCxt</span></a><span class='Operator'>-&GT;</span><a href="xml.c.html#LN179"><span class='Ref_to_Member'>magic</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="xml.c.html#LN4595"><span class='Ref_to_Parameter'>state</span></a><span class='Operator'>-&GT;</span><a href="../../../include/nodes/execnodes.h.html#LN1429"><span class='Ref_to_Member'>opaque</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#else</span> 
    <a href="xml.c.html#LN216"><span class='Ref_to_Macro'>NO_XML_SUPPORT</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* not USE_LIBXML */ 
</span><span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end XmlTableDestroyOpaque &raquo; </span> 
</pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>