<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="Source Insight Version 4.00.0084 Built on 2017-02-26">
<meta charset='UTF-8' />
<style type='text/css'><!--
TD {background-color: #C0C0C0; font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.blurb {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 70%; }
.filename {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 120%; font-weight: bold; }
.dirname {font-family: 'Verdana', 'Arial', 'Helvetica', Sans-Serif; font-size: 100%; font-weight: bold; margin-top: 2.5em;}
--></style>
<title>src\backend\utils\cache\catcache.c</title>
<LINK REL=StyleSheet HREF="../../../../C_Cpp_Source_File.css" TYPE='text/css' MEDIA=screen>
</head>
<body bgcolor=#ffffff>
<table bgcolor='#c0c0c0' width='100%'>
<tr><td><p class='filename'><b>src\backend\utils\cache\catcache.c</b></p></td>
<td align='right'>
Wed Jun 14 08:25:55 2017
</td></tr>
<tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table>
<pre>
<span class='Comment_Multi_Line'>/*------------------------------------------------------------------------- 
 * 
 * catcache.c 
 *    System catalog cache for tuples matching a key. 
 * 
 * Portions Copyright (c) 1996-2017, PostgreSQL Global Development Group 
 * Portions Copyright (c) 1994, Regents of the University of California 
 * 
 * 
 * IDENTIFICATION 
 *    src/backend/utils/cache/catcache.c 
 * 
 *------------------------------------------------------------------------- 
 */ 
</span><span class='Keyword'>#include </span><span class='String'>"postgres.h"</span> 
 
<span class='Keyword'>#include </span><span class='String'>"access/genam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/hash.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/heapam.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/relscan.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/sysattr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/tuptoaster.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/valid.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"access/xact.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_operator.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"catalog/pg_type.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"miscadmin.h"</span> 
<span class='Directive'>#ifdef</span> CATCACHE_STATS 
<span class='Keyword'>#include </span><span class='String'>"storage/ipc.h"</span>        <span class='Comment_Single_Line'>/* for on_proc_exit */ 
</span><span class='Directive'>#endif</span> 
<span class='Keyword'>#include </span><span class='String'>"storage/lmgr.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/builtins.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/fmgroids.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/inval.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/memutils.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/rel.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/resowner_private.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/syscache.h"</span> 
<span class='Keyword'>#include </span><span class='String'>"utils/tqual.h"</span> 
 
 
 <span class='Comment_Multi_Line'>/* #define CACHEDEBUG */</span>   <span class='Comment_Single_Line'>/* turns DEBUG elogs on */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Given a hash value and the size of the hash table, find the bucket 
 * in which the hash value belongs. Since the hash table must contain 
 * a power-of-2 number of elements, this is a simple bitmask. 
 */ 
</span><a name="LN48"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>HASH_INDEX</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>h</span><span class='Delimiter'>, </span><span class='Declare_Parameter'>sz</span><span class='Parentheses'>) ((</span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a><span class='Parentheses'>)</span> <span class='Parentheses'>((</span><a href="catcache.c.html#LN48"><span class='Ref_to_Parameter'>h</span></a><span class='Parentheses'>)</span> <span class='Operator'>& </span><span class='Parentheses'>((</span><a href="catcache.c.html#LN48"><span class='Ref_to_Parameter'>sz</span></a><span class='Parentheses'>) </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Parentheses'>)))</span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      variables, macros and other stuff 
 */ 
</span> 
<span class='Directive'>#ifdef</span> CACHEDEBUG 
<a name="LN56"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE1_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>)</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN56"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN56"><span class='Ref_to_Parameter'>b</span></a><span class='Parentheses'>) 
</span><a name="LN57"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE2_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>)</span>              <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN57"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN57"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN57"><span class='Ref_to_Parameter'>c</span></a><span class='Parentheses'>) 
</span><a name="LN58"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE3_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>d</span><span class='Parentheses'>)</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN58"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN58"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN58"><span class='Ref_to_Parameter'>c</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN58"><span class='Ref_to_Parameter'>d</span></a><span class='Parentheses'>) 
</span><a name="LN59"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE4_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>d</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>e</span><span class='Parentheses'>)</span>          <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN59"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN59"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN59"><span class='Ref_to_Parameter'>c</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN59"><span class='Ref_to_Parameter'>d</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN59"><span class='Ref_to_Parameter'>e</span></a><span class='Parentheses'>) 
</span><a name="LN60"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE5_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>d</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>e</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>f</span><span class='Parentheses'>)</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN60"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN60"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN60"><span class='Ref_to_Parameter'>c</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN60"><span class='Ref_to_Parameter'>d</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN60"><span class='Ref_to_Parameter'>e</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN60"><span class='Ref_to_Parameter'>f</span></a><span class='Parentheses'>) 
</span><a name="LN61"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE6_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>d</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>e</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>f</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>g</span><span class='Parentheses'>)</span>      <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN61"><span class='Ref_to_Parameter'>a</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN61"><span class='Ref_to_Parameter'>b</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN61"><span class='Ref_to_Parameter'>c</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN61"><span class='Ref_to_Parameter'>d</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN61"><span class='Ref_to_Parameter'>e</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN61"><span class='Ref_to_Parameter'>f</span></a><span class='Delimiter'>,</span><a href="catcache.c.html#LN61"><span class='Ref_to_Parameter'>g</span></a><span class='Parentheses'>) 
</span><span class='Directive'>#else</span> 
<a name="LN63"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE1_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Parentheses'>) 
</span><a name="LN64"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE2_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Parentheses'>) 
</span><a name="LN65"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE3_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>d</span><span class='Parentheses'>) 
</span><a name="LN66"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE4_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>d</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>e</span><span class='Parentheses'>) 
</span><a name="LN67"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE5_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>d</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>e</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>f</span><span class='Parentheses'>) 
</span><a name="LN68"></a><span class='Keyword'>#define </span><span class='Declare_Macro'>CACHE6_elog</span><span class='Parentheses'>(</span><span class='Declare_Parameter'>a</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>b</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>c</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>d</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>e</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>f</span><span class='Delimiter'>,</span><span class='Declare_Parameter'>g</span><span class='Parentheses'>) 
</span><span class='Directive'>#endif</span> 
 
<span class='Comment_Multi_Line'>/* Cache management header --- pointer is NULL until created */ 
</span><a name="LN72"></a><span class='Keyword'>static </span><a href="../../../include/utils/catcache.h.html#LN158"><span class='Ref_to_Typedef'>CatCacheHeader</span></a> <span class='Operator'>*</span><span class='Declare_Var'>CacheHdr</span> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
 
<a name="LN75"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Prototype'>CatalogCacheComputeHashValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nkeys</span><span class='Delimiter'>, 
</span><a name="LN76"></a>                             <a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>cur_skey</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN77"></a><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Prototype'>CatalogCacheComputeTupleHashValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, 
</span><a name="LN78"></a>                                  <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> CATCACHE_STATS 
<a name="LN81"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CatCachePrintStats</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
<a name="LN83"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CatCacheRemoveCTup</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ct</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN84"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CatCacheRemoveCList</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cl</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN85"></a><span class='Keyword'>static void </span><span class='Declare_Prototype'>CatalogCacheInitializeCache</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN86"></a><span class='Keyword'>static </span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>*</span><span class='Declare_Prototype'>CatalogCacheCreateEntry</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>ntp</span><span class='Delimiter'>, 
</span><a name="LN87"></a>                        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashValue</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>hashIndex</span><span class='Delimiter'>, 
</span><a name="LN88"></a>                        <span class='Keyword'>bool </span><span class='Declare_Parameter'>negative</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN89"></a><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Prototype'>build_dummy_tuple</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nkeys</span><span class='Delimiter'>, </span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>skeys</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *                  internal support functions 
 */ 
</span> 
<span class='Comment_Multi_Line'>/* 
 * Look up the hash and equality functions for system types that are used 
 * as cache key fields. 
 * 
 * XXX this should be replaced by catalog lookups, 
 * but that seems to pose considerable risk of circularity... 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN104"></a><span class='Declare_Function'>GetCCHashEqFuncs</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>keytype</span><span class='Delimiter'>, </span><a href="../../../include/fmgr.h.html#LN39"><span class='Ref_to_Typedef'>PGFunction</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>hashfunc</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>eqfunc</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>keytype</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN17"><span class='Ref_to_Const'>BOOLOID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>hashfunc</span></a> <span class='Operator'>= </span><a href="../../access/hash/hashfunc.c.html#LN42"><span class='Ref_to_Func'>hashchar</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>eqfunc</span></a> <span class='Operator'>= </span>F_BOOLEQ<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN19"><span class='Ref_to_Const'>CHAROID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>hashfunc</span></a> <span class='Operator'>= </span><a href="../../access/hash/hashfunc.c.html#LN42"><span class='Ref_to_Func'>hashchar</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>eqfunc</span></a> <span class='Operator'>= </span>F_CHAREQ<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>hashfunc</span></a> <span class='Operator'>= </span><a href="../../access/hash/hashfunc.c.html#LN142"><span class='Ref_to_Func'>hashname</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>eqfunc</span></a> <span class='Operator'>= </span>F_NAMEEQ<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN22"><span class='Ref_to_Const'>INT2OID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>hashfunc</span></a> <span class='Operator'>= </span><a href="../../access/hash/hashfunc.c.html#LN48"><span class='Ref_to_Func'>hashint2</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>eqfunc</span></a> <span class='Operator'>= </span>F_INT2EQ<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN24"><span class='Ref_to_Const'>INT4OID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>hashfunc</span></a> <span class='Operator'>= </span><a href="../../access/hash/hashfunc.c.html#LN54"><span class='Ref_to_Func'>hashint4</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>eqfunc</span></a> <span class='Operator'>= </span>F_INT4EQ<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN26"><span class='Ref_to_Const'>TEXTOID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>hashfunc</span></a> <span class='Operator'>= </span><a href="../../access/hash/hashfunc.c.html#LN150"><span class='Ref_to_Func'>hashtext</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>eqfunc</span></a> <span class='Operator'>= </span>F_TEXTEQ<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN25"><span class='Ref_to_Const'>REGPROCOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN60"><span class='Ref_to_Const'>REGPROCEDUREOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN61"><span class='Ref_to_Const'>REGOPEROID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN62"><span class='Ref_to_Const'>REGOPERATOROID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN63"><span class='Ref_to_Const'>REGCLASSOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN64"><span class='Ref_to_Const'>REGTYPEOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN73"><span class='Ref_to_Const'>REGCONFIGOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN74"><span class='Ref_to_Const'>REGDICTIONARYOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN65"><span class='Ref_to_Const'>REGROLEOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN66"><span class='Ref_to_Const'>REGNAMESPACEOID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>hashfunc</span></a> <span class='Operator'>= </span><a href="../../access/hash/hashfunc.c.html#LN80"><span class='Ref_to_Func'>hashoid</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>eqfunc</span></a> <span class='Operator'>= </span>F_OIDEQ<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>case</span> <a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN31"><span class='Ref_to_Const'>OIDVECTOROID</span></a><span class='Operator'>: 
</span>            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>hashfunc</span></a> <span class='Operator'>= </span><a href="../../access/hash/hashfunc.c.html#LN134"><span class='Ref_to_Func'>hashoidvector</span></a><span class='Delimiter'>; 
</span> 
            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>eqfunc</span></a> <span class='Operator'>= </span>F_OIDVECTOREQ<span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"type %u not supported as catcache key"</span><span class='Delimiter'>, </span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>keytype</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>hashfunc</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* keep compiler quiet */ 
</span> 
            <span class='Operator'>*</span><a href="catcache.c.html#LN104"><span class='Ref_to_Parameter'>eqfunc</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch keytype &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end GetCCHashEqFuncs &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      CatalogCacheComputeHashValue 
 * 
 * Compute the hash value associated with a given set of lookup keys 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN173"></a><span class='Declare_Function'>CatalogCacheComputeHashValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nkeys</span><span class='Delimiter'>, </span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>cur_skey</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN175"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>hashValue</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN176"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>oneHash</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN59"><span class='Ref_to_Macro'>CACHE4_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"CatalogCacheComputeHashValue %s %d %p"</span><span class='Delimiter'>, 
</span>                <a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, 
</span>                <a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, 
</span>                <a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>            <a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>= 
</span>                <a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN49"><span class='Ref_to_Member'>cc_hashfunc</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>], 
</span>                                                   <a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN175"><span class='Ref_To_Local'>hashValue</span></a> <span class='Operator'>^= </span><a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>24</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN175"><span class='Ref_To_Local'>hashValue</span></a> <span class='Operator'>^= </span><a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* FALLTHROUGH */ 
</span>        <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>            <a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>= 
</span>                <a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN49"><span class='Ref_to_Member'>cc_hashfunc</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                                                   <a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN175"><span class='Ref_To_Local'>hashValue</span></a> <span class='Operator'>^= </span><a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>16</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN175"><span class='Ref_To_Local'>hashValue</span></a> <span class='Operator'>^= </span><a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>16</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* FALLTHROUGH */ 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>= 
</span>                <a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN49"><span class='Ref_to_Member'>cc_hashfunc</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                                                   <a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN175"><span class='Ref_To_Local'>hashValue</span></a> <span class='Operator'>^= </span><a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>&LT;&LT; </span><span class='Number'>8</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN175"><span class='Ref_To_Local'>hashValue</span></a> <span class='Operator'>^= </span><a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>&GT;&GT; </span><span class='Number'>24</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* FALLTHROUGH */ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a> <span class='Operator'>= 
</span>                <a href="../../../include/postgres.h.html#LN491"><span class='Ref_to_Macro'>DatumGetUInt32</span></a><span class='Parentheses'>(</span><a href="../../../include/fmgr.h.html#LN583"><span class='Ref_to_Macro'>DirectFunctionCall1</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN49"><span class='Ref_to_Member'>cc_hashfunc</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                                                   <a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN175"><span class='Ref_To_Local'>hashValue</span></a> <span class='Operator'>^= </span><a href="catcache.c.html#LN176"><span class='Ref_To_Local'>oneHash</span></a><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of hash keys: %d"</span><span class='Delimiter'>, </span><a href="catcache.c.html#LN173"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch nkeys &raquo; </span> 
 
    <span class='Control'>return</span> <a href="catcache.c.html#LN175"><span class='Ref_To_Local'>hashValue</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CatalogCacheComputeHashValue &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      CatalogCacheComputeTupleHashValue 
 * 
 * Compute the hash value associated with a given tuple to be cached 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN226"></a><span class='Declare_Function'>CatalogCacheComputeTupleHashValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN228"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>cur_skey</span><span class='Delimiter'>[</span><a href="../../../include/utils/catcache.h.html#LN34"><span class='Ref_to_Const'>CATCACHE_MAXKEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN229"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>isNull</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Copy pre-initialized overhead data for scankey */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="catcache.c.html#LN228"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN50"><span class='Ref_to_Member'>cc_skey</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN228"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Now extract key fields from tuple, insert into scankey */ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <span class='Number'>4</span><span class='Operator'>: 
</span>            <a href="catcache.c.html#LN228"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>? </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span> 
                <span class='Operator'>: </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, 
</span>                              <a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>], 
</span>                              <a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="catcache.c.html#LN229"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN229"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* FALLTHROUGH */ 
</span>        <span class='Control'>case</span> <span class='Number'>3</span><span class='Operator'>: 
</span>            <a href="catcache.c.html#LN228"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>? </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span> 
                <span class='Operator'>: </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, 
</span>                              <a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>], 
</span>                              <a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="catcache.c.html#LN229"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN229"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* FALLTHROUGH */ 
</span>        <span class='Control'>case</span> <span class='Number'>2</span><span class='Operator'>: 
</span>            <a href="catcache.c.html#LN228"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>? </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span> 
                <span class='Operator'>: </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, 
</span>                              <a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>], 
</span>                              <a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="catcache.c.html#LN229"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN229"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* FALLTHROUGH */ 
</span>        <span class='Control'>case</span> <span class='Number'>1</span><span class='Operator'>: 
</span>            <a href="catcache.c.html#LN228"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= 
</span>                <span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>] </span><span class='Operator'>== </span><a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>                <span class='Operator'>? </span><a href="../../../include/postgres.h.html#LN512"><span class='Ref_to_Macro'>ObjectIdGetDatum</span></a><span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN694"><span class='Ref_to_Macro'>HeapTupleGetOid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span> 
                <span class='Operator'>: </span><a href="../../../include/access/htup_details.h.html#LN718"><span class='Ref_to_Macro'>fastgetattr</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>tuple</span></a><span class='Delimiter'>, 
</span>                              <a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>], 
</span>                              <a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a><span class='Delimiter'>, 
</span>                              <span class='Operator'>&</span><a href="catcache.c.html#LN229"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN229"><span class='Ref_To_Local'>isNull</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>        <span class='Control'>default</span><span class='Operator'>: 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"wrong number of hash keys: %d"</span><span class='Delimiter'>, </span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cache-&GT;cc_nkeys &raquo; </span> 
 
    <span class='Control'>return</span> <a href="catcache.c.html#LN75"><span class='Ref_to_Proto'>CatalogCacheComputeHashValue</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN226"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN228"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CatalogCacheComputeTupleHashValue &raquo; </span> 
 
 
<span class='Directive'>#ifdef</span> CATCACHE_STATS 
 
<span class='Keyword'>static void 
</span><a name="LN289"></a><span class='Declare_Function'>CatCachePrintStats</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>code</span><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>arg</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN291"></a>    <a href="../../../include/lib/ilist.h.html#LN223"><span class='Ref_to_Struct'>slist_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN292"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>cc_searches</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN293"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>cc_hits</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN294"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>cc_neg_hits</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN295"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>cc_newloads</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN296"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>cc_invals</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN297"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>cc_lsearches</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><a name="LN298"></a>    <span class='Keyword'>long</span>        <span class='Declare_Local'>cc_lhits</span> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/ilist.h.html#LN699"><span class='Ref_to_Macro'>slist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN291"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN160"><span class='Ref_to_Member'>ch_caches</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN302"></a>        <a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cache</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN673"><span class='Ref_to_Macro'>slist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a><span class='Delimiter'>, </span>cc_next<span class='Delimiter'>, </span><a href="catcache.c.html#LN291"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN225"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN45"><span class='Ref_to_Member'>cc_ntup</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN61"><span class='Ref_to_Member'>cc_searches</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* don't print unused caches */ 
</span>        <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"catcache %s/%u: %d tup, %ld srch, %ld+%ld=%ld hits, %ld+%ld=%ld loads, %ld invals, %ld lsrch, %ld lhits"</span><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN42"><span class='Ref_to_Member'>cc_indexoid</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN45"><span class='Ref_to_Member'>cc_ntup</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN61"><span class='Ref_to_Member'>cc_searches</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN62"><span class='Ref_to_Member'>cc_hits</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN63"><span class='Ref_to_Member'>cc_neg_hits</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN62"><span class='Ref_to_Member'>cc_hits</span></a> <span class='Operator'>+ </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN63"><span class='Ref_to_Member'>cc_neg_hits</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN64"><span class='Ref_to_Member'>cc_newloads</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN61"><span class='Ref_to_Member'>cc_searches</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN62"><span class='Ref_to_Member'>cc_hits</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN63"><span class='Ref_to_Member'>cc_neg_hits</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN64"><span class='Ref_to_Member'>cc_newloads</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN61"><span class='Ref_to_Member'>cc_searches</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN62"><span class='Ref_to_Member'>cc_hits</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN63"><span class='Ref_to_Member'>cc_neg_hits</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN70"><span class='Ref_to_Member'>cc_invals</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN71"><span class='Ref_to_Member'>cc_lsearches</span></a><span class='Delimiter'>, 
</span>             <a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN72"><span class='Ref_to_Member'>cc_lhits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN292"><span class='Ref_To_Local'>cc_searches</span></a> <span class='Operator'>+= </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN61"><span class='Ref_to_Member'>cc_searches</span></a><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN293"><span class='Ref_To_Local'>cc_hits</span></a> <span class='Operator'>+= </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN62"><span class='Ref_to_Member'>cc_hits</span></a><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN294"><span class='Ref_To_Local'>cc_neg_hits</span></a> <span class='Operator'>+= </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN63"><span class='Ref_to_Member'>cc_neg_hits</span></a><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN295"><span class='Ref_To_Local'>cc_newloads</span></a> <span class='Operator'>+= </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN64"><span class='Ref_to_Member'>cc_newloads</span></a><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN296"><span class='Ref_To_Local'>cc_invals</span></a> <span class='Operator'>+= </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN70"><span class='Ref_to_Member'>cc_invals</span></a><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN297"><span class='Ref_To_Local'>cc_lsearches</span></a> <span class='Operator'>+= </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN71"><span class='Ref_to_Member'>cc_lsearches</span></a><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN298"><span class='Ref_To_Local'>cc_lhits</span></a> <span class='Operator'>+= </span><a href="catcache.c.html#LN302"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN72"><span class='Ref_to_Member'>cc_lhits</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"catcache totals: %d tup, %ld srch, %ld+%ld=%ld hits, %ld+%ld=%ld loads, %ld invals, %ld lsrch, %ld lhits"</span><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN161"><span class='Ref_to_Member'>ch_ntup</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN292"><span class='Ref_To_Local'>cc_searches</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN293"><span class='Ref_To_Local'>cc_hits</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN294"><span class='Ref_To_Local'>cc_neg_hits</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN293"><span class='Ref_To_Local'>cc_hits</span></a> <span class='Operator'>+ </span><a href="catcache.c.html#LN294"><span class='Ref_To_Local'>cc_neg_hits</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN295"><span class='Ref_To_Local'>cc_newloads</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN292"><span class='Ref_To_Local'>cc_searches</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN293"><span class='Ref_To_Local'>cc_hits</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN294"><span class='Ref_To_Local'>cc_neg_hits</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN295"><span class='Ref_To_Local'>cc_newloads</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN292"><span class='Ref_To_Local'>cc_searches</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN293"><span class='Ref_To_Local'>cc_hits</span></a> <span class='Operator'>- </span><a href="catcache.c.html#LN294"><span class='Ref_To_Local'>cc_neg_hits</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN296"><span class='Ref_To_Local'>cc_invals</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN297"><span class='Ref_To_Local'>cc_lsearches</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN298"><span class='Ref_To_Local'>cc_lhits</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CatCachePrintStats &raquo; </span> 
<span class='Directive'>#endif</span>   <span class='Comment_Single_Line'>/* CATCACHE_STATS */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *      CatCacheRemoveCTup 
 * 
 * Unlink and delete the given cache entry 
 * 
 * NB: if it is a member of a CatCList, the CatCList is deleted too. 
 * Both the cache entry and the list had better have zero refcount. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN353"></a><span class='Declare_Function'>CatCacheRemoveCTup</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>ct</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN81"><span class='Ref_to_Member'>my_cache</span></a> <span class='Operator'>== </span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Comment_Multi_Line'>/* 
         * The cleanest way to handle this is to call CatCacheRemoveCList, 
         * which will recurse back to me, and the recursive call will do the 
         * work.  Set the "dead" flag to make sure it does recurse. 
         */ 
</span>        <a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN84"><span class='Ref_to_Proto'>CatCacheRemoveCList</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>return</span><span class='Delimiter'>;</span>                 <span class='Comment_Single_Line'>/* nothing left to do */ 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* delink from linked list */ 
</span>    <a href="../../../include/lib/ilist.h.html#LN356"><span class='Ref_to_Func'>dlist_delete</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN88"><span class='Ref_to_Member'>cache_elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* free associated tuple data */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>ct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Operator'>--</span><a href="catcache.c.html#LN353"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN45"><span class='Ref_to_Member'>cc_ntup</span></a><span class='Delimiter'>; 
</span>    <span class='Operator'>--</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN161"><span class='Ref_to_Member'>ch_ntup</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CatCacheRemoveCTup &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      CatCacheRemoveCList 
 * 
 * Unlink and delete the given cache list entry 
 * 
 * NB: any dead member entries that become unreferenced are deleted too. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN390"></a><span class='Declare_Function'>CatCacheRemoveCList</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cl</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN392"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN123"><span class='Ref_to_Member'>my_cache</span></a> <span class='Operator'>== </span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* delink from member tuples */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN392"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN153"><span class='Ref_to_Member'>n_members</span></a><span class='Delimiter'>; </span><span class='Operator'>--</span><a href="catcache.c.html#LN392"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&GT;= </span><span class='Number'>0</span><span class='Delimiter'>;</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN400"></a>        <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span> <span class='Operator'>= </span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN154"><span class='Ref_to_Member'>members</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN392"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN400"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>== </span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN400"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* if the member is dead and now has no references, remove it */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>( 
</span><span class='Directive'>#ifndef</span> CATCACHE_FORCE_RELEASE 
            <a href="catcache.c.html#LN400"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>&& 
</span><span class='Directive'>#endif</span> 
            <a href="catcache.c.html#LN400"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="catcache.c.html#LN83"><span class='Ref_to_Proto'>CatCacheRemoveCTup</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN400"><span class='Ref_To_Local'>ct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* delink from linked list */ 
</span>    <a href="../../../include/lib/ilist.h.html#LN356"><span class='Ref_to_Func'>dlist_delete</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN146"><span class='Ref_to_Member'>cache_elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* free associated tuple data */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN152"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN152"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN66"><span class='Ref_to_Member'>t_data</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN390"><span class='Ref_to_Parameter'>cl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CatCacheRemoveCList &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  CatCacheInvalidate 
 * 
 *  Invalidate entries in the specified cache, given a hash value. 
 * 
 *  We delete cache entries that match the hash value, whether positive 
 *  or negative.  We don't care whether the invalidation is the result 
 *  of a tuple insertion or a deletion. 
 * 
 *  We used to try to match positive cache entries by TID, but that is 
 *  unsafe after a VACUUM FULL on a system catalog: an inval event could 
 *  be queued before VACUUM FULL, and then processed afterwards, when the 
 *  target tuple that has to be invalidated has a different TID than it 
 *  did when the event was created.  So now we just compare hash values and 
 *  accept the small risk of unnecessary invalidations due to false matches. 
 * 
 *  This routine is only quasi-public: it should only be used by inval.c. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN442"></a><span class='Declare_Function'>CatCacheInvalidate</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashValue</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN444"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>hashIndex</span><span class='Delimiter'>; 
</span><a name="LN445"></a>    <a href="../../../include/lib/ilist.h.html#LN177"><span class='Ref_to_Struct'>dlist_mutable_iter</span></a> <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN56"><span class='Ref_to_Macro'>CACHE1_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"CatCacheInvalidate: called"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * We don't bother to check whether the cache has finished initialization 
     * yet; if not, there will be no entries in it so no problem. 
     */ 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Invalidate *all* CatCLists in this cache; it's too hard to tell which 
     * searches might still be correct, so just zap 'em all. 
     */ 
</span>    <a href="../../../include/lib/ilist.h.html#LN523"><span class='Ref_to_Macro'>dlist_foreach_modify</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN445"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN442"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN53"><span class='Ref_to_Member'>cc_lists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN460"></a>        <a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cl</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN445"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN179"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN460"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="catcache.c.html#LN460"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN148"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="catcache.c.html#LN84"><span class='Ref_to_Proto'>CatCacheRemoveCList</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN442"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN460"><span class='Ref_To_Local'>cl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * inspect the proper hash bucket for tuple matches 
     */ 
</span>    <a href="catcache.c.html#LN444"><span class='Ref_To_Local'>hashIndex</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN48"><span class='Ref_to_Macro'>HASH_INDEX</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN442"><span class='Ref_to_Parameter'>hashValue</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN442"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/lib/ilist.h.html#LN523"><span class='Ref_to_Macro'>dlist_foreach_modify</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN445"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN442"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN444"><span class='Ref_To_Local'>hashIndex</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN474"></a>        <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN445"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN179"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN442"><span class='Ref_to_Parameter'>hashValue</span></a> <span class='Operator'>== </span><a href="catcache.c.html#LN474"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN114"><span class='Ref_to_Member'>hash_value</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN474"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="catcache.c.html#LN474"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>&& </span><a href="catcache.c.html#LN474"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="catcache.c.html#LN474"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* list, if any, was marked dead above */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN474"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="catcache.c.html#LN474"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN148"><span class='Ref_to_Member'>dead</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="catcache.c.html#LN83"><span class='Ref_to_Proto'>CatCacheRemoveCTup</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN442"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN474"><span class='Ref_To_Local'>ct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN56"><span class='Ref_to_Macro'>CACHE1_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"CatCacheInvalidate: invalidated"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> CATCACHE_STATS 
            <a href="catcache.c.html#LN442"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN70"><span class='Ref_to_Member'>cc_invals</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
            <span class='Comment_Multi_Line'>/* could be multiple matches, so keep looking! */ 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end CatCacheInvalidate &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* ---------------------------------------------------------------- 
 *                     public functions 
 * ---------------------------------------------------------------- 
 */ 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * Standard routine for creating cache context if it doesn't exist yet 
 * 
 * There are a lot of places (probably far more than necessary) that check 
 * whether CacheMemoryContext exists yet and want to create it if not. 
 * We centralize knowledge of exactly how to create it here. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN510"></a><span class='Declare_Function'>CreateCacheMemoryContext</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* 
     * Purely for paranoia, check that context doesn't exist; caller probably 
     * did so already. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>) 
</span>        <a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a> <span class='Operator'>= </span><a href="../../../include/utils/memutils.h.html#LN145"><span class='Ref_to_Proto'>AllocSetContextCreate</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN42"><span class='Ref_to_Global_Var'>TopMemoryContext</span></a><span class='Delimiter'>, 
</span>                                                   <span class='String'>"CacheMemoryContext"</span><span class='Delimiter'>, 
</span>                                                   <a href="../../../include/utils/memutils.h.html#LN164"><span class='Ref_to_Const'>ALLOCSET_DEFAULT_SIZES</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 *      AtEOXact_CatCache 
 * 
 * Clean up catcaches at end of main transaction (either commit or abort) 
 * 
 * As of PostgreSQL 8.1, catcache pins should get released by the 
 * ResourceOwner mechanism.  This routine is just a debugging 
 * cross-check that no pins remain. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN533"></a><span class='Declare_Function'>AtEOXact_CatCache</span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Declare_Parameter'>isCommit</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><span class='Directive'>#ifdef</span> USE_ASSERT_CHECKING 
<a name="LN536"></a>    <a href="../../../include/lib/ilist.h.html#LN223"><span class='Ref_to_Struct'>slist_iter</span></a>  <span class='Declare_Local'>cache_iter</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/ilist.h.html#LN699"><span class='Ref_to_Macro'>slist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN536"><span class='Ref_To_Local'>cache_iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN160"><span class='Ref_to_Member'>ch_caches</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN540"></a>        <a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ccp</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN673"><span class='Ref_to_Macro'>slist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a><span class='Delimiter'>, </span>cc_next<span class='Delimiter'>, </span><a href="catcache.c.html#LN536"><span class='Ref_To_Local'>cache_iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN225"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN541"></a>        <a href="../../../include/lib/ilist.h.html#LN158"><span class='Ref_to_Struct'>dlist_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN542"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Check CatCLists */ 
</span>        <a href="../../../include/lib/ilist.h.html#LN506"><span class='Ref_to_Macro'>dlist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN541"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN540"><span class='Ref_To_Local'>ccp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN53"><span class='Ref_to_Member'>cc_lists</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN547"></a>            <a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cl</span><span class='Delimiter'>; 
</span> 
            <a href="catcache.c.html#LN547"><span class='Ref_To_Local'>cl</span></a> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN541"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN160"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN547"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN121"><span class='Ref_to_Member'>cl_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/catcache.h.html#LN122"><span class='Ref_to_Const'>CL_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN547"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN547"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN148"><span class='Ref_to_Member'>dead</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <span class='Comment_Multi_Line'>/* Check individual tuples */ 
</span>        <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN542"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="catcache.c.html#LN542"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="catcache.c.html#LN540"><span class='Ref_To_Local'>ccp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a><span class='Delimiter'>; </span><a href="catcache.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN558"></a>            <a href="../../../include/lib/ilist.h.html#LN134"><span class='Ref_to_Struct'>dlist_head</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bucket</span> <span class='Operator'>= &</span><a href="catcache.c.html#LN540"><span class='Ref_To_Local'>ccp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN542"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
            <a href="../../../include/lib/ilist.h.html#LN506"><span class='Ref_to_Macro'>dlist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN541"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN558"><span class='Ref_To_Local'>bucket</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN562"></a>                <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span><span class='Delimiter'>; 
</span> 
                <a href="catcache.c.html#LN562"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN541"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN160"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN562"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN79"><span class='Ref_to_Member'>ct_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/catcache.h.html#LN80"><span class='Ref_to_Const'>CT_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN562"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN562"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span><span class='Directive'>#endif</span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end AtEOXact_CatCache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      ResetCatalogCache 
 * 
 * Reset one catalog cache to empty. 
 * 
 * This is not very efficient if the target cache is nearly empty. 
 * However, it shouldn't need to be efficient; we don't invoke it often. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN583"></a><span class='Declare_Function'>ResetCatalogCache</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN585"></a>    <a href="../../../include/lib/ilist.h.html#LN177"><span class='Ref_to_Struct'>dlist_mutable_iter</span></a> <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN586"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Remove each list in this cache, or at least mark it dead */ 
</span>    <a href="../../../include/lib/ilist.h.html#LN523"><span class='Ref_to_Macro'>dlist_foreach_modify</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN585"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN583"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN53"><span class='Ref_to_Member'>cc_lists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN591"></a>        <a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cl</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN585"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN179"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN591"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>            <a href="catcache.c.html#LN591"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN148"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>        <span class='Control'>else</span> 
            <a href="catcache.c.html#LN84"><span class='Ref_to_Proto'>CatCacheRemoveCList</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN583"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN591"><span class='Ref_To_Local'>cl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Remove each tuple in this cache, or at least mark it dead */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN586"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="catcache.c.html#LN586"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="catcache.c.html#LN583"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a><span class='Delimiter'>; </span><a href="catcache.c.html#LN586"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN602"></a>        <a href="../../../include/lib/ilist.h.html#LN134"><span class='Ref_to_Struct'>dlist_head</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bucket</span> <span class='Operator'>= &</span><a href="catcache.c.html#LN583"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN586"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <a href="../../../include/lib/ilist.h.html#LN523"><span class='Ref_to_Macro'>dlist_foreach_modify</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN585"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN602"><span class='Ref_To_Local'>bucket</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN606"></a>            <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN585"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN179"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN606"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>|| 
</span>                <span class='Parentheses'>(</span><a href="catcache.c.html#LN606"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>&& </span><a href="catcache.c.html#LN606"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
            <span class='Delimiter'>{ 
</span>                <a href="catcache.c.html#LN606"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Comment_Multi_Line'>/* list, if any, was marked dead above */ 
</span>                <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN606"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="catcache.c.html#LN606"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN148"><span class='Ref_to_Member'>dead</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <span class='Control'>else</span> 
                <a href="catcache.c.html#LN83"><span class='Ref_to_Proto'>CatCacheRemoveCTup</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN583"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN606"><span class='Ref_To_Local'>ct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> CATCACHE_STATS 
            <a href="catcache.c.html#LN583"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN70"><span class='Ref_to_Member'>cc_invals</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;cache-&GT;cc_nbuck... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end ResetCatalogCache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      ResetCatalogCaches 
 * 
 * Reset all caches when a shared cache inval event forces it 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN630"></a><span class='Declare_Function'>ResetCatalogCaches</span><span class='Parentheses'>(</span><span class='Keyword'>void</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN632"></a>    <a href="../../../include/lib/ilist.h.html#LN223"><span class='Ref_to_Struct'>slist_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN56"><span class='Ref_to_Macro'>CACHE1_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"ResetCatalogCaches called"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/ilist.h.html#LN699"><span class='Ref_to_Macro'>slist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN632"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN160"><span class='Ref_to_Member'>ch_caches</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN638"></a>        <a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cache</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN673"><span class='Ref_to_Macro'>slist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a><span class='Delimiter'>, </span>cc_next<span class='Delimiter'>, </span><a href="catcache.c.html#LN632"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN225"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN582"><span class='Ref_to_Func'>ResetCatalogCache</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN638"><span class='Ref_To_Local'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="catcache.c.html#LN56"><span class='Ref_to_Macro'>CACHE1_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"end of ResetCatalogCaches call"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Comment_Multi_Line'>/* 
 *      CatalogCacheFlushCatalog 
 * 
 *  Flush all catcache entries that came from the specified system catalog. 
 *  This is needed after VACUUM FULL/CLUSTER on the catalog, since the 
 *  tuples very likely now have different TIDs than before.  (At one point 
 *  we also tried to force re-execution of CatalogCacheInitializeCache for 
 *  the cache(s) on that catalog.  This is a bad idea since it leads to all 
 *  kinds of trouble if a cache flush occurs while loading cache entries. 
 *  We now avoid the need to do it by copying cc_tupdesc out of the relcache, 
 *  rather than relying on the relcache to keep a tupdesc for us.  Of course 
 *  this assumes the tupdesc of a cachable system table will not change...) 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN660"></a><span class='Declare_Function'>CatalogCacheFlushCatalog</span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>catId</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN662"></a>    <a href="../../../include/lib/ilist.h.html#LN223"><span class='Ref_to_Struct'>slist_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN57"><span class='Ref_to_Macro'>CACHE2_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"CatalogCacheFlushCatalog called for %u"</span><span class='Delimiter'>, </span><a href="catcache.c.html#LN660"><span class='Ref_to_Parameter'>catId</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/ilist.h.html#LN699"><span class='Ref_to_Macro'>slist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN662"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN160"><span class='Ref_to_Member'>ch_caches</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN668"></a>        <a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cache</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN673"><span class='Ref_to_Macro'>slist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a><span class='Delimiter'>, </span>cc_next<span class='Delimiter'>, </span><a href="catcache.c.html#LN662"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN225"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Does this cache store tuples of the target catalog? */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN668"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN41"><span class='Ref_to_Member'>cc_reloid</span></a> <span class='Operator'>== </span><a href="catcache.c.html#LN660"><span class='Ref_to_Parameter'>catId</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* Yes, so flush all its contents */ 
</span>            <a href="catcache.c.html#LN582"><span class='Ref_to_Func'>ResetCatalogCache</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN668"><span class='Ref_To_Local'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* Tell inval.c to call syscache callbacks for this cache */ 
</span>            <a href="../../../include/utils/inval.h.html#LN62"><span class='Ref_to_Proto'>CallSyscacheCallbacks</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN668"><span class='Ref_To_Local'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="catcache.c.html#LN56"><span class='Ref_to_Macro'>CACHE1_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"end of CatalogCacheFlushCatalog call"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CatalogCacheFlushCatalog &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      InitCatCache 
 * 
 *  This allocates and initializes a cache for a system catalog relation. 
 *  Actually, the cache is only partially initialized to avoid opening the 
 *  relation.  The relation will be opened and the rest of the cache 
 *  structure initialized on the first access. 
 */ 
</span><span class='Directive'>#ifdef</span> CACHEDEBUG 
<a name="LN693"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>InitCatCache_DEBUG2</span> <span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"InitCatCache: rel=%u ind=%u id=%d nkeys=%d size=%d"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>         cp<span class='Operator'>-&GT;</span>cc_reloid<span class='Delimiter'>, </span>cp<span class='Operator'>-&GT;</span>cc_indexoid<span class='Delimiter'>, </span>cp<span class='Operator'>-&GT;</span>id<span class='Delimiter'>, </span><span class='Operator'>\ 
</span>         cp<span class='Operator'>-&GT;</span>cc_nkeys<span class='Delimiter'>, </span>cp<span class='Operator'>-&GT;</span>cc_nbuckets<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span><span class='Directive'>#else</span> 
<a name="LN700"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>InitCatCache_DEBUG2</span> 
<span class='Directive'>#endif</span> 
 
<a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>* 
</span><a name="LN704"></a><span class='Declare_Function'>InitCatCache</span><span class='Parentheses'>(</span><span class='Keyword'>int </span><span class='Declare_Parameter'>id</span><span class='Delimiter'>, 
</span><a name="LN705"></a>             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>reloid</span><span class='Delimiter'>, 
</span><a name="LN706"></a>             <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a> <span class='Declare_Parameter'>indexoid</span><span class='Delimiter'>, 
</span><a name="LN707"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>nkeys</span><span class='Delimiter'>, 
</span><a name="LN708"></a>             <span class='Keyword'>const int </span><span class='Operator'>*</span><span class='Declare_Parameter'>key</span><span class='Delimiter'>, 
</span><a name="LN709"></a>             <span class='Keyword'>int </span><span class='Declare_Parameter'>nbuckets</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN711"></a>    <a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cp</span><span class='Delimiter'>; 
</span><a name="LN712"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN713"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * nbuckets is the initial number of hash buckets to use in this catcache. 
     * It will be enlarged later if it becomes too full. 
     * 
     * nbuckets must be a power of two.  We check this via Assert rather than 
     * a full runtime check because the values will be coming from constant 
     * tables. 
     * 
     * If you're confused by the power-of-two check, see comments in 
     * bitmapset.c for an explanation. 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN709"><span class='Ref_to_Parameter'>nbuckets</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><span class='Parentheses'>(</span><a href="catcache.c.html#LN709"><span class='Ref_to_Parameter'>nbuckets</span></a> <span class='Operator'>& -</span><a href="catcache.c.html#LN709"><span class='Ref_to_Parameter'>nbuckets</span></a><span class='Parentheses'>) </span><span class='Operator'>== </span><a href="catcache.c.html#LN709"><span class='Ref_to_Parameter'>nbuckets</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * first switch to the cache context so our allocations do not vanish at 
     * the end of a transaction 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/utils/catcache.h.html#LN168"><span class='Ref_to_Proto'>CreateCacheMemoryContext</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN712"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * if first time through, initialize the cache group header 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN158"><span class='Ref_to_Typedef'>CatCacheHeader</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN158"><span class='Ref_to_Typedef'>CatCacheHeader</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../../include/lib/ilist.h.html#LN552"><span class='Ref_to_Func'>slist_init</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN160"><span class='Ref_to_Member'>ch_caches</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN161"><span class='Ref_to_Member'>ch_ntup</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span><span class='Directive'>#ifdef</span> CATCACHE_STATS 
        <span class='Comment_Multi_Line'>/* set up to dump stats at backend exit */ 
</span>        <a href="../../../include/storage/ipc.h.html#LN68"><span class='Ref_to_Proto'>on_proc_exit</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN81"><span class='Ref_to_Proto'>CatCachePrintStats</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * allocate a new cache structure 
     * 
     * Note: we rely on zeroing to initialize all the dlist headers correctly 
     */ 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN34"><span class='Ref_to_Proto'>palloc0</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN709"><span class='Ref_to_Parameter'>nbuckets</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/lib/ilist.h.html#LN134"><span class='Ref_to_Struct'>dlist_head</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize the cache's relation information for the relation 
     * corresponding to this cache, and initialize some of the new cache's 
     * other internal fields.  But don't open the relation yet. 
     */ 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN704"><span class='Ref_to_Parameter'>id</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a> <span class='Operator'>= </span><span class='String'>"(not known yet)"</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN41"><span class='Ref_to_Member'>cc_reloid</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN705"><span class='Ref_to_Parameter'>reloid</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN42"><span class='Ref_to_Member'>cc_indexoid</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN706"><span class='Ref_to_Parameter'>indexoid</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN43"><span class='Ref_to_Member'>cc_relisshared</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; </span><span class='Comment_Single_Line'>/* temporary */ 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a><span class='Parentheses'>) </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN45"><span class='Ref_to_Member'>cc_ntup</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN709"><span class='Ref_to_Parameter'>nbuckets</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN707"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>; 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN713"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="catcache.c.html#LN713"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="catcache.c.html#LN707"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="catcache.c.html#LN713"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>        <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN713"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="catcache.c.html#LN708"><span class='Ref_to_Parameter'>key</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN713"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * new cache is initialized as far as we can go for now. print some 
     * debugging information, if appropriate. 
     */ 
</span>    <a href="catcache.c.html#LN693"><span class='Ref_to_Const'>InitCatCache_DEBUG2</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * add completed cache to top of group header's list 
     */ 
</span>    <a href="../../../include/lib/ilist.h.html#LN572"><span class='Ref_to_Func'>slist_push_head</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN160"><span class='Ref_to_Member'>ch_caches</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN39"><span class='Ref_to_Member'>cc_next</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * back to the old context before we return... 
     */ 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN712"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="catcache.c.html#LN711"><span class='Ref_To_Local'>cp</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end InitCatCache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * Enlarge a catcache, doubling the number of buckets. 
 */ 
</span><span class='Keyword'>static void 
</span><a name="LN799"></a><span class='Declare_Function'>RehashCatCache</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cp</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN801"></a>    <a href="../../../include/lib/ilist.h.html#LN134"><span class='Ref_to_Struct'>dlist_head</span></a> <span class='Operator'>*</span><span class='Declare_Local'>newbucket</span><span class='Delimiter'>; 
</span><a name="LN802"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>newnbuckets</span><span class='Delimiter'>; 
</span><a name="LN803"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN24"><span class='Ref_to_Const'>DEBUG1</span></a><span class='Delimiter'>, </span><span class='String'>"rehashing catalog cache id %d for %s; %d tups, %d buckets"</span><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN45"><span class='Ref_to_Member'>cc_ntup</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Allocate a new, larger, hash table. */ 
</span>    <a href="catcache.c.html#LN802"><span class='Ref_To_Local'>newnbuckets</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN801"><span class='Ref_To_Local'>newbucket</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/lib/ilist.h.html#LN134"><span class='Ref_to_Struct'>dlist_head</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/utils/palloc.h.html#LN71"><span class='Ref_to_Proto'>MemoryContextAllocZero</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN802"><span class='Ref_To_Local'>newnbuckets</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/lib/ilist.h.html#LN134"><span class='Ref_to_Struct'>dlist_head</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Move all entries from old hash table to new. */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN803"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="catcache.c.html#LN803"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a><span class='Delimiter'>; </span><a href="catcache.c.html#LN803"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN815"></a>        <a href="../../../include/lib/ilist.h.html#LN177"><span class='Ref_to_Struct'>dlist_mutable_iter</span></a> <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/lib/ilist.h.html#LN523"><span class='Ref_to_Macro'>dlist_foreach_modify</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN815"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN803"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN819"></a>            <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN815"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN179"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN820"></a>            <span class='Keyword'>int</span>         <span class='Declare_Local'>hashIndex</span> <span class='Operator'>= </span><a href="catcache.c.html#LN48"><span class='Ref_to_Macro'>HASH_INDEX</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN819"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN114"><span class='Ref_to_Member'>hash_value</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN802"><span class='Ref_To_Local'>newnbuckets</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="../../../include/lib/ilist.h.html#LN356"><span class='Ref_to_Func'>dlist_delete</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN815"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN179"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="../../../include/lib/ilist.h.html#LN298"><span class='Ref_to_Func'>dlist_push_head</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN801"><span class='Ref_To_Local'>newbucket</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN820"><span class='Ref_To_Local'>hashIndex</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="catcache.c.html#LN819"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN88"><span class='Ref_to_Member'>cache_elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* Switch to the new array. */ 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN802"><span class='Ref_To_Local'>newnbuckets</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN799"><span class='Ref_to_Parameter'>cp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN801"><span class='Ref_To_Local'>newbucket</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end RehashCatCache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *      CatalogCacheInitializeCache 
 * 
 * This function does final initialization of a catcache: obtain the tuple 
 * descriptor and set up the hash and equality function links.  We assume 
 * that the relcache entry can be opened at this point! 
 */ 
</span><span class='Directive'>#ifdef</span> CACHEDEBUG 
<a name="LN841"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CatalogCacheInitializeCache_DEBUG1</span> <span class='Operator'>\ 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"CatalogCacheInitializeCache: cache @%p rel=%u"</span><span class='Delimiter'>, </span>cache<span class='Delimiter'>, </span><span class='Operator'>\ 
</span>         cache<span class='Operator'>-&GT;</span>cc_reloid<span class='Parentheses'>) 
</span> 
<a name="LN845"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CatalogCacheInitializeCache_DEBUG2</span> <span class='Operator'>\ 
</span><span class='Control'>do</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span>cache<span class='Operator'>-&GT;</span>cc_key<span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) </span><span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"CatalogCacheInitializeCache: load %d/%d w/%d, %u"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                <a href="../../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a><span class='Operator'>+</span><span class='Number'>1</span><span class='Delimiter'>, </span>cache<span class='Operator'>-&GT;</span>cc_nkeys<span class='Delimiter'>, </span>cache<span class='Operator'>-&GT;</span>cc_key<span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a><span class='Delimiter'>], </span><span class='Operator'>\ 
</span>                 tupdesc<span class='Operator'>-&GT;</span>attrs<span class='Delimiter'>[</span>cache<span class='Operator'>-&GT;</span>cc_key<span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>-&GT;</span>atttypid<span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Control'>else</span> <span class='Delimiter'>{ </span><span class='Operator'>\ 
</span>            <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"CatalogCacheInitializeCache: load %d/%d w/%d"</span><span class='Delimiter'>, </span><span class='Operator'>\ 
</span>                <a href="../../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a><span class='Operator'>+</span><span class='Number'>1</span><span class='Delimiter'>, </span>cache<span class='Operator'>-&GT;</span>cc_nkeys<span class='Delimiter'>, </span>cache<span class='Operator'>-&GT;</span>cc_key<span class='Delimiter'>[</span><a href="../../../interfaces/ecpg/test/expected/preproc-comment.c.html#LN22"><span class='Ref_to_Global_Var'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>)</span><span class='Delimiter'>; </span><span class='Operator'>\ 
</span>        <span class='Delimiter'>} </span><span class='Operator'>\ 
</span><span class='Delimiter'>} </span><span class='Control'>while</span><span class='Parentheses'>(</span><span class='Number'>0</span><span class='Parentheses'>) 
</span><span class='Directive'>#else</span> 
<a name="LN857"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CatalogCacheInitializeCache_DEBUG1</span> 
<a name="LN858"></a><span class='Keyword'>#define </span><span class='Declare_Constant'>CatalogCacheInitializeCache_DEBUG2</span> 
<span class='Directive'>#endif</span> 
 
<span class='Keyword'>static void 
</span><a name="LN862"></a><span class='Declare_Function'>CatalogCacheInitializeCache</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN864"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN865"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN866"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupdesc</span><span class='Delimiter'>; 
</span><a name="LN867"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN841"><span class='Ref_to_Const'>CatalogCacheInitializeCache_DEBUG1</span></a><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN864"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN41"><span class='Ref_to_Member'>cc_reloid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * switch to the cache context so our allocations do not vanish at the end 
     * of a transaction 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN865"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * copy the relcache's tuple descriptor to permanent cache storage 
     */ 
</span>    <a href="catcache.c.html#LN866"><span class='Ref_To_Local'>tupdesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/tupdesc.h.html#LN90"><span class='Ref_to_Proto'>CreateTupleDescCopyConstr</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN428"><span class='Ref_to_Macro'>RelationGetDescr</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN864"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * save the relation's name and relisshared flag, too (cc_relname is used 
     * only for debugging purposes) 
     */ 
</span>    <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a> <span class='Operator'>= </span><a href="../../../include/common/fe_memutils.h.html#LN32"><span class='Ref_to_Proto'>pstrdup</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN436"><span class='Ref_to_Macro'>RelationGetRelationName</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN864"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN43"><span class='Ref_to_Member'>cc_relisshared</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN410"><span class='Ref_to_Macro'>RelationGetForm</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN864"><span class='Ref_To_Local'>relation</span></a><span class='Parentheses'>)</span><span class='Operator'>-&GT;</span>relisshared<span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * return to the caller's memory context and close the rel 
     */ 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN865"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN864"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN58"><span class='Ref_to_Macro'>CACHE3_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"CatalogCacheInitializeCache: %s, %d keys"</span><span class='Delimiter'>, 
</span>                <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize cache's key information 
     */ 
</span>    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Delimiter'>; </span><span class='Operator'>++</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN908"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>keytype</span><span class='Delimiter'>; 
</span><a name="LN909"></a>        <a href="../../../include/c.h.html#LN394"><span class='Ref_to_Typedef'>RegProcedure</span></a> <span class='Declare_Local'>eqfunc</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN845"><span class='Ref_to_Const'>CatalogCacheInitializeCache_DEBUG2</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN915"></a>            <a href="../../../include/catalog/pg_attribute.h.html#LN186"><span class='Ref_to_Typedef'>Form_pg_attribute</span></a> <span class='Declare_Local'>attr</span> <span class='Operator'>= </span><a href="catcache.c.html#LN866"><span class='Ref_To_Local'>tupdesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN73"><span class='Ref_to_Member'>attrs</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>]; 
</span> 
            <a href="catcache.c.html#LN908"><span class='Ref_To_Local'>keytype</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN915"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>atttypid<span class='Delimiter'>; 
</span>            <span class='Comment_Multi_Line'>/* cache key columns should always be NOT NULL */ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN915"><span class='Ref_To_Local'>attr</span></a><span class='Operator'>-&GT;</span>attnotnull<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>!= </span><a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>) 
</span>                <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN51"><span class='Ref_to_Const'>FATAL</span></a><span class='Delimiter'>, </span><span class='String'>"only sys attr supported in caches is OID"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN908"><span class='Ref_To_Local'>keytype</span></a> <span class='Operator'>= </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN27"><span class='Ref_to_Const'>OIDOID</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="catcache.c.html#LN103"><span class='Ref_to_Func'>GetCCHashEqFuncs</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN908"><span class='Ref_To_Local'>keytype</span></a><span class='Delimiter'>, 
</span>                         <span class='Operator'>&</span><a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN49"><span class='Ref_to_Member'>cc_hashfunc</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>], 
</span>                         <span class='Operator'>&</span><a href="catcache.c.html#LN909"><span class='Ref_To_Local'>eqfunc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN52"><span class='Ref_to_Member'>cc_isname</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Parentheses'>(</span><a href="catcache.c.html#LN908"><span class='Ref_To_Local'>keytype</span></a> <span class='Operator'>== </span><a href="../../../interfaces/ecpg/ecpglib/pg_type.h.html#LN20"><span class='Ref_to_Const'>NAMEOID</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Do equality-function lookup (we assume this won't need a catalog 
         * lookup for any supported type) 
         */ 
</span>        <a href="../../../include/fmgr.h.html#LN99"><span class='Ref_to_Proto'>fmgr_info_cxt</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN909"><span class='Ref_To_Local'>eqfunc</span></a><span class='Delimiter'>, 
</span>                      <span class='Operator'>&</span><a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN50"><span class='Ref_to_Member'>cc_skey</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN70"><span class='Ref_to_Member'>sk_func</span></a><span class='Delimiter'>, 
</span>                      <a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Initialize sk_attno suitably for HeapKeyTest() and heap scans */ 
</span>        <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN50"><span class='Ref_to_Member'>cc_skey</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN66"><span class='Ref_to_Member'>sk_attno</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
        <span class='Comment_Multi_Line'>/* Fill in sk_strategy as well --- always standard equality */ 
</span>        <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN50"><span class='Ref_to_Member'>cc_skey</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN67"><span class='Ref_to_Member'>sk_strategy</span></a> <span class='Operator'>= </span><a href="../../../include/access/stratnum.h.html#LN30"><span class='Ref_to_Const'>BTEqualStrategyNumber</span></a><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN50"><span class='Ref_to_Member'>cc_skey</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN68"><span class='Ref_to_Member'>sk_subtype</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* Currently, there are no catcaches on collation-aware data types */ 
</span>        <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN50"><span class='Ref_to_Member'>cc_skey</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN69"><span class='Ref_to_Member'>sk_collation</span></a> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN59"><span class='Ref_to_Macro'>CACHE4_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"CatalogCacheInitializeCache %s %d %p"</span><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN867"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;cache-&GT;cc_nkeys... &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* 
     * mark this cache fully initialized 
     */ 
</span>    <a href="catcache.c.html#LN862"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN866"><span class='Ref_To_Local'>tupdesc</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CatalogCacheInitializeCache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * InitCatCachePhase2 -- external interface for CatalogCacheInitializeCache 
 * 
 * One reason to call this routine is to ensure that the relcache has 
 * created entries for all the catalogs and indexes referenced by catcaches. 
 * Therefore, provide an option to open the index as well as fixing the 
 * cache itself.  An exception is the indexes on pg_am, which we don't use 
 * (cf. IndexScanOK). 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN973"></a><span class='Declare_Function'>InitCatCachePhase2</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>touch_index</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN973"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="catcache.c.html#LN85"><span class='Ref_to_Proto'>CatalogCacheInitializeCache</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN973"><span class='Ref_to_Parameter'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN973"><span class='Ref_to_Parameter'>touch_index</span></a> <span class='Operator'>&& 
</span>        <a href="catcache.c.html#LN973"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/syscache.h.html#LN35"><span class='Ref_to_EnumConst'>AMOID</span></a> <span class='Operator'>&& 
</span>        <a href="catcache.c.html#LN973"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a> <span class='Operator'>!= </span><a href="../../../include/utils/syscache.h.html#LN34"><span class='Ref_to_EnumConst'>AMNAME</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN982"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>idesc</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We must lock the underlying catalog before opening the index to 
         * avoid deadlock, since index_open could possibly result in reading 
         * this same catalog, and if anyone else is exclusive-locking this 
         * catalog and index they'll be doing it in that order. 
         */ 
</span>        <a href="../../../include/storage/lmgr.h.html#LN39"><span class='Ref_to_Proto'>LockRelationOid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN973"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN41"><span class='Ref_to_Member'>cc_reloid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN982"><span class='Ref_To_Local'>idesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN129"><span class='Ref_to_Proto'>index_open</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN973"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN42"><span class='Ref_to_Member'>cc_indexoid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * While we've got the index open, let's check that it's unique (and 
         * not just deferrable-unique, thank you very much).  This is just to 
         * catch thinkos in definitions of new catcaches, so we don't worry 
         * about the pg_am indexes not getting tested. 
         */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN982"><span class='Ref_To_Local'>idesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indisunique <span class='Operator'>&& 
</span>               <a href="catcache.c.html#LN982"><span class='Ref_To_Local'>idesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/rel.h.html#LN158"><span class='Ref_to_Member'>rd_index</span></a><span class='Operator'>-&GT;</span>indimmediate<span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/genam.h.html#LN130"><span class='Ref_to_Proto'>index_close</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN982"><span class='Ref_To_Local'>idesc</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/storage/lmgr.h.html#LN42"><span class='Ref_to_Proto'>UnlockRelationOid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN973"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN41"><span class='Ref_to_Member'>cc_reloid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if touch_index&&cache-&GT;i... &raquo; </span> 
<span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end InitCatCachePhase2 &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *      IndexScanOK 
 * 
 *      This function checks for tuples that will be fetched by 
 *      IndexSupportInitialize() during relcache initialization for 
 *      certain system indexes that support critical syscaches. 
 *      We can't use an indexscan to fetch these, else we'll get into 
 *      infinite recursion.  A plain heap scan will work, however. 
 *      Once we have completed relcache initialization (signaled by 
 *      criticalRelcachesBuilt), we don't have to worry anymore. 
 * 
 *      Similarly, during backend startup we have to be able to use the 
 *      pg_authid and pg_auth_members syscaches for authentication even if 
 *      we don't yet have relcache entries for those catalogs' indexes. 
 */ 
</span><span class='Keyword'>static bool 
</span><a name="LN1024"></a><span class='Declare_Function'>IndexScanOK</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>cur_skey</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Control'>switch</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1024"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/syscache.h.html#LN65"><span class='Ref_to_EnumConst'>INDEXRELID</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Rather than tracking exactly which indexes have to be loaded 
             * before we can use indexscans (which changes from time to time), 
             * just force all pg_index searches to be heap scans until we've 
             * built the critical relcaches. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN128"><span class='Ref_to_Global_Var'>criticalRelcachesBuilt</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/syscache.h.html#LN35"><span class='Ref_to_EnumConst'>AMOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/syscache.h.html#LN34"><span class='Ref_to_EnumConst'>AMNAME</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Always do heap scans in pg_am, because it's so small there's 
             * not much point in an indexscan anyway.  We *must* do this when 
             * initially building critical relcache entries, but we might as 
             * well just always do it. 
             */ 
</span>            <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>case</span> <a href="../../../include/utils/syscache.h.html#LN43"><span class='Ref_to_EnumConst'>AUTHNAME</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/syscache.h.html#LN44"><span class='Ref_to_EnumConst'>AUTHOID</span></a><span class='Operator'>: 
</span>        <span class='Control'>case</span> <a href="../../../include/utils/syscache.h.html#LN41"><span class='Ref_to_EnumConst'>AUTHMEMMEMROLE</span></a><span class='Operator'>: 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * Protect authentication lookups occurring before relcache has 
             * collected entries for shared indexes. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="relcache.c.html#LN134"><span class='Ref_to_Global_Var'>criticalSharedRelcachesBuilt</span></a><span class='Parentheses'>) 
</span>                <span class='Control'>return</span> <span class='Boolean'>false</span><span class='Delimiter'>; 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>default</span><span class='Operator'>: 
</span>            <span class='Control'>break</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end switch cache-&GT;id &raquo; </span> 
 
    <span class='Comment_Multi_Line'>/* Normal case, allow index scan */ 
</span>    <span class='Control'>return</span> <span class='Boolean'>true</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end IndexScanOK &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  SearchCatCache 
 * 
 *      This call searches a system cache for a tuple, opening the relation 
 *      if necessary (on the first access to a particular cache). 
 * 
 *      The result is NULL if not found, or a pointer to a HeapTuple in 
 *      the cache.  The caller must not modify the tuple, and must call 
 *      ReleaseCatCache() when done with it. 
 * 
 * The search key values should be expressed as Datums of the key columns' 
 * datatype(s).  (Pass zeroes for any unused parameters.)  As a special 
 * exception, the passed-in key for a NAME column can be just a C string; 
 * the caller need not go to the trouble of converting it to a fully 
 * null-padded NAME. 
 */ 
</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN1088"></a><span class='Declare_Function'>SearchCatCache</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, 
</span><a name="LN1089"></a>               <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v1</span><span class='Delimiter'>, 
</span><a name="LN1090"></a>               <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v2</span><span class='Delimiter'>, 
</span><a name="LN1091"></a>               <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v3</span><span class='Delimiter'>, 
</span><a name="LN1092"></a>               <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v4</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1094"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>cur_skey</span><span class='Delimiter'>[</span><a href="../../../include/utils/catcache.h.html#LN34"><span class='Ref_to_Const'>CATCACHE_MAXKEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN1095"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>hashValue</span><span class='Delimiter'>; 
</span><a name="LN1096"></a>    <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>hashIndex</span><span class='Delimiter'>; 
</span><a name="LN1097"></a>    <a href="../../../include/lib/ilist.h.html#LN158"><span class='Ref_to_Struct'>dlist_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN1098"></a>    <a href="../../../include/lib/ilist.h.html#LN134"><span class='Ref_to_Struct'>dlist_head</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bucket</span><span class='Delimiter'>; 
</span><a name="LN1099"></a>    <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span><span class='Delimiter'>; 
</span><a name="LN1100"></a>    <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN1101"></a>    <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scandesc</span><span class='Delimiter'>; 
</span><a name="LN1102"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>ntp</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Make sure we're in an xact, even if this ends up being a cache hit */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/xact.h.html#LN329"><span class='Ref_to_Proto'>IsTransactionState</span></a><span class='Parentheses'>())</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * one-time startup overhead for each cache 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="catcache.c.html#LN85"><span class='Ref_to_Proto'>CatalogCacheInitializeCache</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> CATCACHE_STATS 
    <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN61"><span class='Ref_to_Member'>cc_searches</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * initialize the search key information 
     */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN50"><span class='Ref_to_Member'>cc_skey</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1089"><span class='Ref_to_Parameter'>v1</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1090"><span class='Ref_to_Parameter'>v2</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1091"><span class='Ref_to_Parameter'>v3</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1092"><span class='Ref_to_Parameter'>v4</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * find the hash bucket in which to look for the tuple 
     */ 
</span>    <a href="catcache.c.html#LN1095"><span class='Ref_To_Local'>hashValue</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN75"><span class='Ref_to_Proto'>CatalogCacheComputeHashValue</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1096"><span class='Ref_To_Local'>hashIndex</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN48"><span class='Ref_to_Macro'>HASH_INDEX</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1095"><span class='Ref_To_Local'>hashValue</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * scan the hash bucket until we find a match or exhaust our tuples 
     * 
     * Note: it's okay to use dlist_foreach here, even though we modify the 
     * dlist within the loop, because we don't continue the loop afterwards. 
     */ 
</span>    <a href="catcache.c.html#LN1098"><span class='Ref_To_Local'>bucket</span></a> <span class='Operator'>= &</span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1096"><span class='Ref_To_Local'>hashIndex</span></a><span class='Delimiter'>]; 
</span>    <a href="../../../include/lib/ilist.h.html#LN506"><span class='Ref_to_Macro'>dlist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1097"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1098"><span class='Ref_To_Local'>bucket</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1141"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN1097"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN160"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore dead entries */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN114"><span class='Ref_to_Member'>hash_value</span></a> <span class='Operator'>!= </span><a href="catcache.c.html#LN1095"><span class='Ref_To_Local'>hashValue</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* quickly skip entry if wrong hash val */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * see if the cached tuple matches our key. 
         */ 
</span>        <a href="../../../include/access/valid.h.html#LN21"><span class='Ref_to_Macro'>HeapKeyTest</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1141"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN1141"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We found a match in the cache.  Move it to the front of the list 
         * for its hashbucket, in order to speed subsequent searches.  (The 
         * most frequently accessed elements in any hashbucket will tend to be 
         * near the front of the hashbucket's list.) 
         */ 
</span>        <a href="../../../include/lib/ilist.h.html#LN383"><span class='Ref_to_Func'>dlist_move_head</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1098"><span class='Ref_To_Local'>bucket</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN88"><span class='Ref_to_Member'>cache_elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * If it's a positive entry, bump its refcount and return it. If it's 
         * negative, we can report failure to the caller. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN113"><span class='Ref_to_Member'>negative</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="../../../include/utils/resowner_private.h.html#LN37"><span class='Ref_to_Proto'>ResourceOwnerEnlargeCatCacheRefs</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>            <a href="../../../include/utils/resowner_private.h.html#LN38"><span class='Ref_to_Proto'>ResourceOwnerRememberCatCacheRef</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="catcache.c.html#LN58"><span class='Ref_to_Macro'>CACHE3_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"SearchCatCache(%s): found in bucket %d"</span><span class='Delimiter'>, 
</span>                        <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1096"><span class='Ref_To_Local'>hashIndex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> CATCACHE_STATS 
            <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN62"><span class='Ref_to_Member'>cc_hits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
            <span class='Control'>return</span> <span class='Operator'>&</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <a href="catcache.c.html#LN58"><span class='Ref_to_Macro'>CACHE3_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"SearchCatCache(%s): found neg entry in bucket %d"</span><span class='Delimiter'>, 
</span>                        <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1096"><span class='Ref_To_Local'>hashIndex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> CATCACHE_STATS 
            <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN63"><span class='Ref_to_Member'>cc_neg_hits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Tuple was not found in cache, so we have to try to retrieve it directly 
     * from the relation.  If found, we will add it to the cache; if not 
     * found, we will add a negative cache entry instead. 
     * 
     * NOTE: it is possible for recursive cache lookups to occur while reading 
     * the relation --- for example, due to shared-cache-inval messages being 
     * processed during heap_open().  This is OK.  It's even possible for one 
     * of those lookups to find and enter the very same tuple we are trying to 
     * fetch here.  If that happens, we will enter a second copy of the tuple 
     * into the cache.  The first copy will never be referenced again, and 
     * will eventually age out of the cache, so there's no functional problem. 
     * This case is rare enough that it's not worth expending extra cycles to 
     * detect. 
     */ 
</span>    <a href="catcache.c.html#LN1100"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN41"><span class='Ref_to_Member'>cc_reloid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN1101"><span class='Ref_To_Local'>scandesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1100"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, 
</span>                                  <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN42"><span class='Ref_to_Member'>cc_indexoid</span></a><span class='Delimiter'>, 
</span>                                  <a href="catcache.c.html#LN1023"><span class='Ref_to_Func'>IndexScanOK</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                  <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                  <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Delimiter'>, 
</span>                                  <a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1102"><span class='Ref_To_Local'>ntp</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1101"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)))</span> 
    <span class='Delimiter'>{ 
</span>        <a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN86"><span class='Ref_to_Proto'>CatalogCacheCreateEntry</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1102"><span class='Ref_To_Local'>ntp</span></a><span class='Delimiter'>, 
</span>                                     <a href="catcache.c.html#LN1095"><span class='Ref_To_Local'>hashValue</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1096"><span class='Ref_To_Local'>hashIndex</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* immediately set the refcount to 1 */ 
</span>        <a href="../../../include/utils/resowner_private.h.html#LN37"><span class='Ref_to_Proto'>ResourceOwnerEnlargeCatCacheRefs</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/resowner_private.h.html#LN38"><span class='Ref_to_Proto'>ResourceOwnerRememberCatCacheRef</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>break</span><span class='Delimiter'>;</span>                  <span class='Comment_Single_Line'>/* assume only one match */ 
</span>    <span class='Delimiter'>} 
</span> 
    <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1101"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1100"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If tuple was not found, we need to build a negative cache entry 
     * containing a fake tuple.  The fake tuple has the correct key columns, 
     * but nulls everywhere else. 
     * 
     * In bootstrap mode, we don't build negative entries, because the cache 
     * invalidation mechanism isn't alive and can't clear them if the tuple 
     * gets created later.  (Bootstrap doesn't do UPDATEs, so it doesn't need 
     * cache inval for that.) 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/miscadmin.h.html#LN369"><span class='Ref_to_Macro'>IsBootstrapProcessingMode</span></a><span class='Parentheses'>())</span> 
            <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN1102"><span class='Ref_To_Local'>ntp</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN89"><span class='Ref_to_Proto'>build_dummy_tuple</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1094"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN86"><span class='Ref_to_Proto'>CatalogCacheCreateEntry</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1102"><span class='Ref_To_Local'>ntp</span></a><span class='Delimiter'>, 
</span>                                     <a href="catcache.c.html#LN1095"><span class='Ref_To_Local'>hashValue</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1096"><span class='Ref_To_Local'>hashIndex</span></a><span class='Delimiter'>, 
</span>                                     <span class='Boolean'>true</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1102"><span class='Ref_To_Local'>ntp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN59"><span class='Ref_to_Macro'>CACHE4_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"SearchCatCache(%s): Contains %d/%d tuples"</span><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN45"><span class='Ref_to_Member'>cc_ntup</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN161"><span class='Ref_to_Member'>ch_ntup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN58"><span class='Ref_to_Macro'>CACHE3_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"SearchCatCache(%s): put neg entry in bucket %d"</span><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1096"><span class='Ref_To_Local'>hashIndex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We are not returning the negative entry to the caller, so leave its 
         * refcount zero. 
         */ 
</span> 
        <span class='Control'>return</span> <span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end if ct==NULL &raquo; </span> 
 
    <a href="catcache.c.html#LN59"><span class='Ref_to_Macro'>CACHE4_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"SearchCatCache(%s): Contains %d/%d tuples"</span><span class='Delimiter'>, 
</span>                <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN45"><span class='Ref_to_Member'>cc_ntup</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN161"><span class='Ref_to_Member'>ch_ntup</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN58"><span class='Ref_to_Macro'>CACHE3_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"SearchCatCache(%s): put in bucket %d"</span><span class='Delimiter'>, 
</span>                <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1096"><span class='Ref_To_Local'>hashIndex</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> CATCACHE_STATS 
    <a href="catcache.c.html#LN1088"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN64"><span class='Ref_to_Member'>cc_newloads</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Control'>return</span> <span class='Operator'>&</span><a href="catcache.c.html#LN1099"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SearchCatCache &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  ReleaseCatCache 
 * 
 *  Decrement the reference count of a catcache entry (releasing the 
 *  hold grabbed by a successful SearchCatCache). 
 * 
 *  NOTE: if compiled with -DCATCACHE_FORCE_RELEASE then catcache entries 
 *  will be freed as soon as their refcount goes to zero.  In combination 
 *  with aset.c's CLOBBER_FREED_MEMORY option, this provides a good test 
 *  to catch references to already-released catcache entries. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1302"></a><span class='Declare_Function'>ReleaseCatCache</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1304"></a>    <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="catcache.c.html#LN1302"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span> <span class='Operator'>- 
</span>                                  <a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1302"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Safety checks to ensure we were handed a cache entry */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN79"><span class='Ref_to_Member'>ct_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/catcache.h.html#LN80"><span class='Ref_to_Const'>CT_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/resowner_private.h.html#LN40"><span class='Ref_to_Proto'>ResourceOwnerForgetCatCacheRef</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span> 
<span class='Directive'>#ifndef</span> CATCACHE_FORCE_RELEASE 
        <a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>&& 
</span><span class='Directive'>#endif</span> 
        <a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>        <span class='Parentheses'>(</span><a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
        <a href="catcache.c.html#LN83"><span class='Ref_to_Proto'>CatCacheRemoveCTup</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN81"><span class='Ref_to_Member'>my_cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1304"><span class='Ref_To_Local'>ct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end ReleaseCatCache &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  GetCatCacheHashValue 
 * 
 *      Compute the hash value for a given set of search keys. 
 * 
 * The reason for exposing this as part of the API is that the hash value is 
 * exposed in cache invalidation operations, so there are places outside the 
 * catcache code that need to be able to compute the hash values. 
 */ 
</span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> 
<a name="LN1334"></a><span class='Declare_Function'>GetCatCacheHashValue</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, 
</span><a name="LN1335"></a>                     <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v1</span><span class='Delimiter'>, 
</span><a name="LN1336"></a>                     <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v2</span><span class='Delimiter'>, 
</span><a name="LN1337"></a>                     <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v3</span><span class='Delimiter'>, 
</span><a name="LN1338"></a>                     <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v4</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1340"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>cur_skey</span><span class='Delimiter'>[</span><a href="../../../include/utils/catcache.h.html#LN34"><span class='Ref_to_Const'>CATCACHE_MAXKEYS</span></a><span class='Delimiter'>]; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * one-time startup overhead for each cache 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1334"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="catcache.c.html#LN85"><span class='Ref_to_Proto'>CatalogCacheInitializeCache</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1334"><span class='Ref_to_Parameter'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * initialize the search key information 
     */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="catcache.c.html#LN1340"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1334"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN50"><span class='Ref_to_Member'>cc_skey</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1340"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1340"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1335"><span class='Ref_to_Parameter'>v1</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1340"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1336"><span class='Ref_to_Parameter'>v2</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1340"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1337"><span class='Ref_to_Parameter'>v3</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1340"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1338"><span class='Ref_to_Parameter'>v4</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * calculate the hash value 
     */ 
</span>    <span class='Control'>return</span> <a href="catcache.c.html#LN75"><span class='Ref_to_Proto'>CatalogCacheComputeHashValue</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1334"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1334"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1340"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end GetCatCacheHashValue &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  SearchCatCacheList 
 * 
 *      Generate a list of all tuples matching a partial key (that is, 
 *      a key specifying just the first K of the cache's N key columns). 
 * 
 *      The caller must not modify the list object or the pointed-to tuples, 
 *      and must call ReleaseCatCacheList() when done with the list. 
 */ 
</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a> <span class='Operator'>* 
</span><a name="LN1374"></a><span class='Declare_Function'>SearchCatCacheList</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, 
</span><a name="LN1375"></a>                   <span class='Keyword'>int </span><span class='Declare_Parameter'>nkeys</span><span class='Delimiter'>, 
</span><a name="LN1376"></a>                   <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v1</span><span class='Delimiter'>, 
</span><a name="LN1377"></a>                   <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v2</span><span class='Delimiter'>, 
</span><a name="LN1378"></a>                   <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v3</span><span class='Delimiter'>, 
</span><a name="LN1379"></a>                   <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Declare_Parameter'>v4</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1381"></a>    <a href="../../../include/access/skey.h.html#LN63"><span class='Ref_to_Struct'>ScanKeyData</span></a> <span class='Declare_Local'>cur_skey</span><span class='Delimiter'>[</span><a href="../../../include/utils/catcache.h.html#LN34"><span class='Ref_to_Const'>CATCACHE_MAXKEYS</span></a><span class='Delimiter'>]; 
</span><a name="LN1382"></a>    <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>lHashValue</span><span class='Delimiter'>; 
</span><a name="LN1383"></a>    <a href="../../../include/lib/ilist.h.html#LN158"><span class='Ref_to_Struct'>dlist_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN1384"></a>    <a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>cl</span><span class='Delimiter'>; 
</span><a name="LN1385"></a>    <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span><span class='Delimiter'>; 
</span><a name="LN1386"></a>    <a href="../../../include/nodes/pg_list.h.html#LN44"><span class='Ref_to_Struct'>List</span></a>       <span class='Operator'>*</span><span class='Keyword'>volatile </span><span class='Declare_Local'>ctlist</span><span class='Delimiter'>; 
</span><a name="LN1387"></a>    <a href="../../../include/nodes/pg_list.h.html#LN52"><span class='Ref_to_Struct'>ListCell</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ctlist_item</span><span class='Delimiter'>; 
</span><a name="LN1388"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>nmembers</span><span class='Delimiter'>; 
</span><a name="LN1389"></a>    <span class='Keyword'>bool</span>        <span class='Declare_Local'>ordered</span><span class='Delimiter'>; 
</span><a name="LN1390"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>ntp</span><span class='Delimiter'>; 
</span><a name="LN1391"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span><a name="LN1392"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * one-time startup overhead for each cache 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>        <a href="catcache.c.html#LN85"><span class='Ref_to_Proto'>CatalogCacheInitializeCache</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1375"><span class='Ref_to_Parameter'>nkeys</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span> <span class='Operator'>&& </span><a href="catcache.c.html#LN1375"><span class='Ref_to_Parameter'>nkeys</span></a> <span class='Operator'>&LT; </span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN47"><span class='Ref_to_Member'>cc_nkeys</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> CATCACHE_STATS 
    <a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN71"><span class='Ref_to_Member'>cc_lsearches</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
    <span class='Comment_Multi_Line'>/* 
     * initialize the search key information 
     */ 
</span>    memcpy<span class='Parentheses'>(</span><a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN50"><span class='Ref_to_Member'>cc_skey</span></a><span class='Delimiter'>, </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>0</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1376"><span class='Ref_to_Parameter'>v1</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>1</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1377"><span class='Ref_to_Parameter'>v2</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>2</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1378"><span class='Ref_to_Parameter'>v3</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>[</span><span class='Number'>3</span><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1379"><span class='Ref_to_Parameter'>v4</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * compute a hash value of the given keys for faster search.  We don't 
     * presently divide the CatCList items into buckets, but this still lets 
     * us skip non-matching items quickly most of the time. 
     */ 
</span>    <a href="catcache.c.html#LN1382"><span class='Ref_To_Local'>lHashValue</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN75"><span class='Ref_to_Proto'>CatalogCacheComputeHashValue</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1375"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * scan the items until we find a match or exhaust our list 
     * 
     * Note: it's okay to use dlist_foreach here, even though we modify the 
     * dlist within the loop, because we don't continue the loop afterwards. 
     */ 
</span>    <a href="../../../include/lib/ilist.h.html#LN506"><span class='Ref_to_Macro'>dlist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1383"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN53"><span class='Ref_to_Member'>cc_lists</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1430"></a>        <span class='Keyword'>bool</span>        <span class='Declare_Local'>res</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN1383"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN160"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN148"><span class='Ref_to_Member'>dead</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* ignore dead entries */ 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN151"><span class='Ref_to_Member'>hash_value</span></a> <span class='Operator'>!= </span><a href="catcache.c.html#LN1382"><span class='Ref_To_Local'>lHashValue</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* quickly skip entry if wrong hash val */ 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * see if the cached list matches our key. 
         */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN150"><span class='Ref_to_Member'>nkeys</span></a> <span class='Operator'>!= </span><a href="catcache.c.html#LN1375"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/valid.h.html#LN21"><span class='Ref_to_Macro'>HeapKeyTest</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN152"><span class='Ref_to_Member'>tuple</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1375"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1430"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN1430"><span class='Ref_To_Local'>res</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We found a matching list.  Move the list to the front of the 
         * cache's list-of-lists, to speed subsequent searches.  (We do not 
         * move the members to the fronts of their hashbucket lists, however, 
         * since there's no point in that unless they are searched for 
         * individually.) 
         */ 
</span>        <a href="../../../include/lib/ilist.h.html#LN383"><span class='Ref_to_Func'>dlist_move_head</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN53"><span class='Ref_to_Member'>cc_lists</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN146"><span class='Ref_to_Member'>cache_elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Bump the list's refcount and return it */ 
</span>        <a href="../../../include/utils/resowner_private.h.html#LN42"><span class='Ref_to_Proto'>ResourceOwnerEnlargeCatCacheListRefs</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/resowner_private.h.html#LN43"><span class='Ref_to_Proto'>ResourceOwnerRememberCatCacheListRef</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN57"><span class='Ref_to_Macro'>CACHE2_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"SearchCatCacheList(%s): found list"</span><span class='Delimiter'>, 
</span>                    <a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
<span class='Directive'>#ifdef</span> CATCACHE_STATS 
        <a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN72"><span class='Ref_to_Member'>cc_lhits</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span><span class='Directive'>#endif</span> 
 
        <span class='Control'>return</span> <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * List was not found in cache, so we have to build it by reading the 
     * relation.  For each matching tuple found in the relation, use an 
     * existing cache entry if possible, else build a new one. 
     * 
     * We have to bump the member refcounts temporarily to ensure they won't 
     * get dropped from the cache while loading other members. We use a PG_TRY 
     * block to ensure we can undo those refcounts if we get an error before 
     * we finish constructing the CatCList. 
     */ 
</span>    <a href="../../../include/utils/resowner_private.h.html#LN42"><span class='Ref_to_Proto'>ResourceOwnerEnlargeCatCacheListRefs</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN1386"><span class='Ref_To_Local'>ctlist</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN68"><span class='Ref_to_Const'>NIL</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/utils/elog.h.html#LN283"><span class='Ref_to_Macro'>PG_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1493"></a>        <a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a>    <span class='Declare_Local'>relation</span><span class='Delimiter'>; 
</span><a name="LN1494"></a>        <a href="../../../include/access/genam.h.html#LN86"><span class='Ref_to_Typedef'>SysScanDesc</span></a> <span class='Declare_Local'>scandesc</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN1493"><span class='Ref_To_Local'>relation</span></a> <span class='Operator'>= </span><a href="../../../include/access/heapam.h.html#LN91"><span class='Ref_to_Proto'>heap_open</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN41"><span class='Ref_to_Member'>cc_reloid</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN1494"><span class='Ref_To_Local'>scandesc</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN189"><span class='Ref_to_Proto'>systable_beginscan</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1493"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, 
</span>                                      <a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN42"><span class='Ref_to_Member'>cc_indexoid</span></a><span class='Delimiter'>, 
</span>                                      <a href="catcache.c.html#LN1023"><span class='Ref_to_Func'>IndexScanOK</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, 
</span>                                      <span class='Null_Value'>NULL</span><span class='Delimiter'>, 
</span>                                      <a href="catcache.c.html#LN1375"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, 
</span>                                      <a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* The list will be ordered iff we are doing an index scan */ 
</span>        <a href="catcache.c.html#LN1389"><span class='Ref_To_Local'>ordered</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1494"><span class='Ref_To_Local'>scandesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/relscan.h.html#LN154"><span class='Ref_to_Member'>irel</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>while</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1390"><span class='Ref_To_Local'>ntp</span></a> <span class='Operator'>= </span><a href="../../../include/access/genam.h.html#LN194"><span class='Ref_to_Proto'>systable_getnext</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1494"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)))</span> 
        <span class='Delimiter'>{ 
</span><a name="LN1510"></a>            <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>hashValue</span><span class='Delimiter'>; 
</span><a name="LN1511"></a>            <a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a>       <span class='Declare_Local'>hashIndex</span><span class='Delimiter'>; 
</span><a name="LN1512"></a>            <span class='Keyword'>bool</span>        <span class='Declare_Local'>found</span> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span><a name="LN1513"></a>            <a href="../../../include/lib/ilist.h.html#LN134"><span class='Ref_to_Struct'>dlist_head</span></a> <span class='Operator'>*</span><span class='Declare_Local'>bucket</span><span class='Delimiter'>; 
</span> 
            <span class='Comment_Multi_Line'>/* 
             * See if there's an entry for this tuple already. 
             */ 
</span>            <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN1510"><span class='Ref_To_Local'>hashValue</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN77"><span class='Ref_to_Proto'>CatalogCacheComputeTupleHashValue</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1390"><span class='Ref_To_Local'>ntp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN1511"><span class='Ref_To_Local'>hashIndex</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN48"><span class='Ref_to_Macro'>HASH_INDEX</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1510"><span class='Ref_To_Local'>hashValue</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <a href="catcache.c.html#LN1513"><span class='Ref_To_Local'>bucket</span></a> <span class='Operator'>= &</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1511"><span class='Ref_To_Local'>hashIndex</span></a><span class='Delimiter'>]; 
</span>            <a href="../../../include/lib/ilist.h.html#LN506"><span class='Ref_to_Macro'>dlist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1383"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1513"><span class='Ref_To_Local'>bucket</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN476"><span class='Ref_to_Macro'>dlist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a><span class='Delimiter'>, </span>cache_elem<span class='Delimiter'>, </span><a href="catcache.c.html#LN1383"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN160"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>|| </span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN113"><span class='Ref_to_Member'>negative</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* ignore dead and negative entries */ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN114"><span class='Ref_to_Member'>hash_value</span></a> <span class='Operator'>!= </span><a href="catcache.c.html#LN1510"><span class='Ref_To_Local'>hashValue</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* quickly skip entry if wrong hash val */ 
</span> 
                <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="../../storage/page/itemptr.c.html#LN27"><span class='Ref_to_Func'>ItemPointerEquals</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Operator'>.</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)</span><span class='Delimiter'>, </span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1390"><span class='Ref_To_Local'>ntp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>)))</span> 
                    <span class='Control'>continue</span><span class='Delimiter'>;</span>   <span class='Comment_Single_Line'>/* not same tuple */ 
</span> 
                <span class='Comment_Multi_Line'>/* 
                 * Found a match, but can't use it if it belongs to another 
                 * list already 
                 */ 
</span>                <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a><span class='Parentheses'>) 
</span>                    <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
                <a href="catcache.c.html#LN1512"><span class='Ref_To_Local'>found</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>                <span class='Control'>break</span><span class='Delimiter'>;</span>          <span class='Comment_Single_Line'>/* A-OK */ 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><span class='Operator'>!</span><a href="catcache.c.html#LN1512"><span class='Ref_To_Local'>found</span></a><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span>                <span class='Comment_Multi_Line'>/* We didn't find a usable entry, so make a new one */ 
</span>                <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN86"><span class='Ref_to_Proto'>CatalogCacheCreateEntry</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1390"><span class='Ref_To_Local'>ntp</span></a><span class='Delimiter'>, 
</span>                                             <a href="catcache.c.html#LN1510"><span class='Ref_To_Local'>hashValue</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1511"><span class='Ref_To_Local'>hashIndex</span></a><span class='Delimiter'>, 
</span>                                             <span class='Boolean'>false</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span> 
            <span class='Comment_Multi_Line'>/* Careful here: add entry to ctlist, then bump its refcount */ 
</span>            <span class='Comment_Multi_Line'>/* This way leaves state correct if lappend runs out of memory */ 
</span>            <a href="catcache.c.html#LN1386"><span class='Ref_To_Local'>ctlist</span></a> <span class='Operator'>= </span><a href="../../nodes/list.c.html#LN126"><span class='Ref_to_Func'>lappend</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1386"><span class='Ref_To_Local'>ctlist</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end while HeapTupleIsValid(ntp=... &raquo; </span> 
 
        <a href="../../../include/access/genam.h.html#LN196"><span class='Ref_to_Proto'>systable_endscan</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1494"><span class='Ref_To_Local'>scandesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="../../../include/access/heapam.h.html#LN96"><span class='Ref_to_Macro'>heap_close</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1493"><span class='Ref_To_Local'>relation</span></a><span class='Delimiter'>, </span><a href="../../../include/storage/lockdefs.h.html#LN35"><span class='Ref_to_Const'>AccessShareLock</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * Now we can build the CatCList entry.  First we need a dummy tuple 
         * containing the key values... 
         */ 
</span>        <a href="catcache.c.html#LN1390"><span class='Ref_To_Local'>ntp</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN89"><span class='Ref_to_Proto'>build_dummy_tuple</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1375"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1381"><span class='Ref_To_Local'>cur_skey</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN1391"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN1388"><span class='Ref_To_Local'>nmembers</span></a> <span class='Operator'>= </span><a href="../../../include/nodes/pg_list.h.html#LN87"><span class='Ref_to_Func'>list_length</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1386"><span class='Ref_To_Local'>ctlist</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a> <span class='Operator'>*</span><span class='Parentheses'>) 
</span>            <a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a><span class='Delimiter'>, </span>members<span class='Parentheses'>) </span><span class='Operator'>+</span><a href="catcache.c.html#LN1388"><span class='Ref_To_Local'>nmembers</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>*</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>        <a href="../../access/common/heaptuple.c.html#LN632"><span class='Ref_to_Func'>heap_copytuple_with_tuple</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1390"><span class='Ref_To_Local'>ntp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN152"><span class='Ref_to_Member'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1391"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1390"><span class='Ref_To_Local'>ntp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* 
         * We are now past the last thing that could trigger an elog before we 
         * have finished building the CatCList and remembering it in the 
         * resource owner.  So it's OK to fall out of the PG_TRY, and indeed 
         * we'd better do so before we start marking the members as belonging 
         * to the list. 
         */ 
</span> 
    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN292"><span class='Ref_to_Macro'>PG_CATCH</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>{ 
</span>        <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1387"><span class='Ref_To_Local'>ctlist_item</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1386"><span class='Ref_To_Local'>ctlist</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1387"><span class='Ref_To_Local'>ctlist_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span> 
<span class='Directive'>#ifndef</span> CATCACHE_FORCE_RELEASE 
                <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>&& 
</span><span class='Directive'>#endif</span> 
                <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span> <span class='Operator'>&& 
</span>                <span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL </span><span class='Operator'>|| </span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>))</span> 
                <a href="catcache.c.html#LN83"><span class='Ref_to_Proto'>CatCacheRemoveCTup</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span> 
        <a href="../../../include/utils/elog.h.html#LN310"><span class='Ref_to_Macro'>PG_RE_THROW</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <a href="../../../include/utils/elog.h.html#LN299"><span class='Ref_to_Macro'>PG_END_TRY</span></a><span class='Parentheses'>()</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN121"><span class='Ref_to_Member'>cl_magic</span></a> <span class='Operator'>= </span><a href="../../../include/utils/catcache.h.html#LN122"><span class='Ref_to_Const'>CL_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN123"><span class='Ref_to_Member'>my_cache</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* for the moment */ 
</span>    <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN148"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN149"><span class='Ref_to_Member'>ordered</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1389"><span class='Ref_To_Local'>ordered</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN150"><span class='Ref_to_Member'>nkeys</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1375"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN151"><span class='Ref_to_Member'>hash_value</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1382"><span class='Ref_To_Local'>lHashValue</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN153"><span class='Ref_to_Member'>n_members</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1388"><span class='Ref_To_Local'>nmembers</span></a><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN1392"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; 
</span>    <a href="../../../include/nodes/pg_list.h.html#LN160"><span class='Ref_to_Macro'>foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1387"><span class='Ref_To_Local'>ctlist_item</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1386"><span class='Ref_To_Local'>ctlist</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span>        <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN154"><span class='Ref_to_Member'>members</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1392"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/nodes/pg_list.h.html#LN105"><span class='Ref_to_Macro'>lfirst</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1387"><span class='Ref_To_Local'>ctlist_item</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* release the temporary refcount on the member */ 
</span>        <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>        <span class='Comment_Multi_Line'>/* mark list dead if any members already dead */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1385"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a><span class='Parentheses'>) 
</span>            <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN148"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>= </span><span class='Boolean'>true</span><span class='Delimiter'>; 
</span>    <span class='Delimiter'>} 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1392"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>== </span><a href="catcache.c.html#LN1388"><span class='Ref_To_Local'>nmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/ilist.h.html#LN298"><span class='Ref_to_Func'>dlist_push_head</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN53"><span class='Ref_to_Member'>cc_lists</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN146"><span class='Ref_to_Member'>cache_elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Finally, bump the list's refcount and return it */ 
</span>    <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/resowner_private.h.html#LN43"><span class='Ref_to_Proto'>ResourceOwnerRememberCatCacheListRef</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN58"><span class='Ref_to_Macro'>CACHE3_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"SearchCatCacheList(%s): made list of %d members"</span><span class='Delimiter'>, 
</span>                <a href="catcache.c.html#LN1374"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1388"><span class='Ref_To_Local'>nmembers</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="catcache.c.html#LN1384"><span class='Ref_To_Local'>cl</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end SearchCatCacheList &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 *  ReleaseCatCacheList 
 * 
 *  Decrement the reference count of a catcache list. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1650"></a><span class='Declare_Function'>ReleaseCatCacheList</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <span class='Comment_Multi_Line'>/* Safety checks to ensure we were handed a cache entry */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1650"><span class='Ref_to_Parameter'>list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN121"><span class='Ref_to_Member'>cl_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/catcache.h.html#LN122"><span class='Ref_to_Const'>CL_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1650"><span class='Ref_to_Parameter'>list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1650"><span class='Ref_to_Parameter'>list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a><span class='Operator'>--</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/resowner_private.h.html#LN45"><span class='Ref_to_Proto'>ResourceOwnerForgetCatCacheListRef</span></a><span class='Parentheses'>(</span><a href="../resowner/resowner.c.html#LN137"><span class='Ref_to_Global_Var'>CurrentResourceOwner</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1650"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>( 
</span><span class='Directive'>#ifndef</span> CATCACHE_FORCE_RELEASE 
        <a href="catcache.c.html#LN1650"><span class='Ref_to_Parameter'>list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN148"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>&& 
</span><span class='Directive'>#endif</span> 
        <a href="catcache.c.html#LN1650"><span class='Ref_to_Parameter'>list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>== </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <a href="catcache.c.html#LN84"><span class='Ref_to_Proto'>CatCacheRemoveCList</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1650"><span class='Ref_to_Parameter'>list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN123"><span class='Ref_to_Member'>my_cache</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1650"><span class='Ref_to_Parameter'>list</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
 
<span class='Comment_Multi_Line'>/* 
 * CatalogCacheCreateEntry 
 *      Create a new CatCTup entry, copying the given HeapTuple and other 
 *      supplied data into it.  The new entry initially has refcount 0. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>* 
</span><a name="LN1673"></a><span class='Declare_Function'>CatalogCacheCreateEntry</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>ntp</span><span class='Delimiter'>, 
</span><a name="LN1674"></a>                        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a> <span class='Declare_Parameter'>hashValue</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN364"><span class='Ref_to_Typedef'>Index</span></a> <span class='Declare_Parameter'>hashIndex</span><span class='Delimiter'>, </span><span class='Keyword'>bool </span><span class='Declare_Parameter'>negative</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1676"></a>    <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span><span class='Delimiter'>; 
</span><a name="LN1677"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>dtp</span><span class='Delimiter'>; 
</span><a name="LN1678"></a>    <a href="../../../include/utils/palloc.h.html#LN35"><span class='Ref_to_Typedef'>MemoryContext</span></a> <span class='Declare_Local'>oldcxt</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If there are any out-of-line toasted fields in the tuple, expand them 
     * in-line.  This saves cycles during later use of the catcache entry, and 
     * also protects us against the possibility of the toast tuples being 
     * freed before we attempt to fetch them, in case of something using a 
     * slightly stale catcache entry. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="../../../include/access/htup_details.h.html#LN673"><span class='Ref_to_Macro'>HeapTupleHasExternal</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>ntp</span></a><span class='Parentheses'>))</span> 
        <a href="catcache.c.html#LN1677"><span class='Ref_To_Local'>dtp</span></a> <span class='Operator'>= </span><a href="../../../include/access/tuptoaster.h.html#LN183"><span class='Ref_to_Proto'>toast_flatten_tuple</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>ntp</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>else</span> 
        <a href="catcache.c.html#LN1677"><span class='Ref_To_Local'>dtp</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>ntp</span></a><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Allocate CatCTup header in cache memory, and copy the tuple there too. 
     */ 
</span>    <a href="catcache.c.html#LN1678"><span class='Ref_To_Local'>oldcxt</span></a> <span class='Operator'>= </span><a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="../mmgr/mcxt.c.html#LN45"><span class='Ref_to_Global_Var'>CacheMemoryContext</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="../../access/common/heaptuple.c.html#LN632"><span class='Ref_to_Func'>heap_copytuple_with_tuple</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1677"><span class='Ref_To_Local'>dtp</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN115"><span class='Ref_to_Member'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/utils/palloc.h.html#LN107"><span class='Ref_to_Func'>MemoryContextSwitchTo</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1678"><span class='Ref_To_Local'>oldcxt</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1677"><span class='Ref_To_Local'>dtp</span></a> <span class='Operator'>!= </span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>ntp</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/access/htup_details.h.html#LN815"><span class='Ref_to_Proto'>heap_freetuple</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1677"><span class='Ref_To_Local'>dtp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * Finish initializing the CatCTup header, and add it to the cache's 
     * linked list and counts. 
     */ 
</span>    <a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN79"><span class='Ref_to_Member'>ct_magic</span></a> <span class='Operator'>= </span><a href="../../../include/utils/catcache.h.html#LN80"><span class='Ref_to_Const'>CT_MAGIC</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN81"><span class='Ref_to_Member'>my_cache</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>cache</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN97"><span class='Ref_to_Member'>c_list</span></a> <span class='Operator'>= </span><span class='Null_Value'>NULL</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>;</span>           <span class='Comment_Single_Line'>/* for the moment */ 
</span>    <a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN112"><span class='Ref_to_Member'>dead</span></a> <span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN113"><span class='Ref_to_Member'>negative</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1674"><span class='Ref_to_Parameter'>negative</span></a><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN114"><span class='Ref_to_Member'>hash_value</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1674"><span class='Ref_to_Parameter'>hashValue</span></a><span class='Delimiter'>; 
</span> 
    <a href="../../../include/lib/ilist.h.html#LN298"><span class='Ref_to_Func'>dlist_push_head</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN54"><span class='Ref_to_Member'>cc_bucket</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1674"><span class='Ref_to_Parameter'>hashIndex</span></a><span class='Delimiter'>], </span><span class='Operator'>&</span><a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN88"><span class='Ref_to_Member'>cache_elem</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN45"><span class='Ref_to_Member'>cc_ntup</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN161"><span class='Ref_to_Member'>ch_ntup</span></a><span class='Operator'>++</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * If the hash table has become too full, enlarge the buckets array. Quite 
     * arbitrarily, we enlarge when fill factor &GT; 2. 
     */ 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN45"><span class='Ref_to_Member'>cc_ntup</span></a> <span class='Operator'>&GT; </span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN46"><span class='Ref_to_Member'>cc_nbuckets</span></a> <span class='Operator'>* </span><span class='Number'>2</span><span class='Parentheses'>) 
</span>        <a href="catcache.c.html#LN798"><span class='Ref_to_Func'>RehashCatCache</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1673"><span class='Ref_to_Parameter'>cache</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="catcache.c.html#LN1676"><span class='Ref_To_Local'>ct</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end CatalogCacheCreateEntry &raquo; </span> 
 
<span class='Comment_Multi_Line'>/* 
 * build_dummy_tuple 
 *      Generate a palloc'd HeapTuple that contains the specified key 
 *      columns, and NULLs for other columns. 
 * 
 * This is used to store the keys for negative cache entries and CatCList 
 * entries, which don't have real tuples associated with them. 
 */ 
</span><span class='Keyword'>static </span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> 
<a name="LN1739"></a><span class='Declare_Function'>build_dummy_tuple</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>cache</span><span class='Delimiter'>, </span><span class='Keyword'>int </span><span class='Declare_Parameter'>nkeys</span><span class='Delimiter'>, </span><a href="../../../include/access/skey.h.html#LN74"><span class='Ref_to_Typedef'>ScanKey</span></a> <span class='Declare_Parameter'>skeys</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1741"></a>    <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a>   <span class='Declare_Local'>ntp</span><span class='Delimiter'>; 
</span><a name="LN1742"></a>    <a href="../../../include/access/tupdesc.h.html#LN70"><span class='Ref_to_Typedef'>TupleDesc</span></a>   <span class='Declare_Local'>tupDesc</span> <span class='Operator'>= </span><a href="catcache.c.html#LN1739"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a><span class='Delimiter'>; 
</span><a name="LN1743"></a>    <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>      <span class='Operator'>*</span><span class='Declare_Local'>values</span><span class='Delimiter'>; 
</span><a name="LN1744"></a>    <span class='Keyword'>bool</span>       <span class='Operator'>*</span><span class='Declare_Local'>nulls</span><span class='Delimiter'>; 
</span><a name="LN1745"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>tupOid</span> <span class='Operator'>= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Delimiter'>; 
</span><a name="LN1746"></a>    <a href="../../../include/c.h.html#LN492"><span class='Ref_to_Typedef'>NameData</span></a>    <span class='Declare_Local'>tempNames</span><span class='Delimiter'>[</span><span class='Number'>4</span><span class='Delimiter'>]; 
</span><a name="LN1747"></a>    <span class='Keyword'>int</span>         <span class='Declare_Local'>i</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN1743"><span class='Ref_To_Local'>values</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a> <span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1742"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <a href="catcache.c.html#LN1744"><span class='Ref_To_Local'>nulls</span></a> <span class='Operator'>= </span><span class='Parentheses'>(</span><span class='Keyword'>bool </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="../../../include/common/fe_memutils.h.html#LN33"><span class='Ref_to_Proto'>palloc</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1742"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    memset<span class='Parentheses'>(</span><a href="catcache.c.html#LN1743"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><span class='Number'>0</span><span class='Delimiter'>, </span><a href="catcache.c.html#LN1742"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    memset<span class='Parentheses'>(</span><a href="catcache.c.html#LN1744"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>, </span><span class='Boolean'>true</span><span class='Delimiter'>, </span><a href="catcache.c.html#LN1742"><span class='Ref_To_Local'>tupDesc</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/tupdesc.h.html#LN72"><span class='Ref_to_Member'>natts</span></a> <span class='Operator'>* </span><span class='Keyword'>sizeof</span><span class='Parentheses'>(</span><span class='Keyword'>bool</span><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>for</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1747"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>= </span><span class='Number'>0</span><span class='Delimiter'>; </span><a href="catcache.c.html#LN1747"><span class='Ref_To_Local'>i</span></a> <span class='Operator'>&LT; </span><a href="catcache.c.html#LN1739"><span class='Ref_to_Parameter'>nkeys</span></a><span class='Delimiter'>; </span><a href="catcache.c.html#LN1747"><span class='Ref_To_Local'>i</span></a><span class='Operator'>++</span><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1757"></a>        <span class='Keyword'>int</span>         <span class='Declare_Local'>attindex</span> <span class='Operator'>= </span><a href="catcache.c.html#LN1739"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN48"><span class='Ref_to_Member'>cc_key</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1747"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span><a name="LN1758"></a>        <a href="../../../include/postgres.h.html#LN371"><span class='Ref_to_Typedef'>Datum</span></a>       <span class='Declare_Local'>keyval</span> <span class='Operator'>= </span><a href="catcache.c.html#LN1739"><span class='Ref_to_Parameter'>skeys</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1747"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Operator'>.</span><a href="../../../include/access/skey.h.html#LN71"><span class='Ref_to_Member'>sk_argument</span></a><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1757"><span class='Ref_To_Local'>attindex</span></a> <span class='Operator'>&GT; </span><span class='Number'>0</span><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span>            <span class='Comment_Multi_Line'>/* 
             * Here we must be careful in case the caller passed a C string 
             * where a NAME is wanted: convert the given argument to a 
             * correctly padded NAME.  Otherwise the memcpy() done in 
             * heap_form_tuple could fall off the end of memory. 
             */ 
</span>            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1739"><span class='Ref_to_Parameter'>cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN52"><span class='Ref_to_Member'>cc_isname</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1747"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]</span><span class='Parentheses'>) 
</span>            <span class='Delimiter'>{ 
</span><a name="LN1770"></a>                <a href="../../../include/c.h.html#LN496"><span class='Ref_to_Typedef'>Name</span></a>        <span class='Declare_Local'>newval</span> <span class='Operator'>= &</span><a href="catcache.c.html#LN1746"><span class='Ref_To_Local'>tempNames</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1747"><span class='Ref_To_Local'>i</span></a><span class='Delimiter'>]; 
</span> 
                <a href="../../../include/utils/builtins.h.html#LN40"><span class='Ref_to_Proto'>namestrcpy</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1770"><span class='Ref_To_Local'>newval</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres.h.html#LN571"><span class='Ref_to_Macro'>DatumGetCString</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1758"><span class='Ref_To_Local'>keyval</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>                <a href="catcache.c.html#LN1758"><span class='Ref_To_Local'>keyval</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN600"><span class='Ref_to_Macro'>NameGetDatum</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1770"><span class='Ref_To_Local'>newval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <span class='Delimiter'>} 
</span>            <a href="catcache.c.html#LN1743"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1757"><span class='Ref_To_Local'>attindex</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><a href="catcache.c.html#LN1758"><span class='Ref_To_Local'>keyval</span></a><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN1744"><span class='Ref_To_Local'>nulls</span></a><span class='Delimiter'>[</span><a href="catcache.c.html#LN1757"><span class='Ref_To_Local'>attindex</span></a> <span class='Operator'>- </span><span class='Number'>1</span><span class='Delimiter'>] </span><span class='Operator'>= </span><span class='Boolean'>false</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>        <span class='Control'>else</span> 
        <span class='Delimiter'>{ 
</span>            <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1757"><span class='Ref_To_Local'>attindex</span></a> <span class='Operator'>== </span><a href="../../../include/access/sysattr.h.html#LN21"><span class='Ref_to_Const'>ObjectIdAttributeNumber</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>            <a href="catcache.c.html#LN1745"><span class='Ref_To_Local'>tupOid</span></a> <span class='Operator'>= </span><a href="../../../include/postgres.h.html#LN505"><span class='Ref_to_Macro'>DatumGetObjectId</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1758"><span class='Ref_To_Local'>keyval</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>}</span><span class='Auto_Annotations'> &laquo; end for i=0;i&LT;nkeys;i++ &raquo; </span> 
 
    <a href="catcache.c.html#LN1741"><span class='Ref_To_Local'>ntp</span></a> <span class='Operator'>= </span><a href="../../access/common/heaptuple.c.html#LN690"><span class='Ref_to_Func'>heap_form_tuple</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1742"><span class='Ref_To_Local'>tupDesc</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1743"><span class='Ref_To_Local'>values</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1744"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1745"><span class='Ref_To_Local'>tupOid</span></a> <span class='Operator'>!= </span><a href="../../../include/postgres_ext.h.html#LN33"><span class='Ref_to_Const'>InvalidOid</span></a><span class='Parentheses'>) 
</span>        <a href="../../../include/access/htup_details.h.html#LN697"><span class='Ref_to_Macro'>HeapTupleSetOid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1741"><span class='Ref_To_Local'>ntp</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1745"><span class='Ref_To_Local'>tupOid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1743"><span class='Ref_To_Local'>values</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>    <a href="../../../include/common/fe_memutils.h.html#LN37"><span class='Ref_to_Proto'>pfree</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1744"><span class='Ref_To_Local'>nulls</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Control'>return</span> <a href="catcache.c.html#LN1741"><span class='Ref_To_Local'>ntp</span></a><span class='Delimiter'>; 
}</span><span class='Auto_Annotations'> &laquo; end build_dummy_tuple &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 *  PrepareToInvalidateCacheTuple() 
 * 
 *  This is part of a rather subtle chain of events, so pay attention: 
 * 
 *  When a tuple is inserted or deleted, it cannot be flushed from the 
 *  catcaches immediately, for reasons explained at the top of cache/inval.c. 
 *  Instead we have to add entry(s) for the tuple to a list of pending tuple 
 *  invalidations that will be done at the end of the command or transaction. 
 * 
 *  The lists of tuples that need to be flushed are kept by inval.c.  This 
 *  routine is a helper routine for inval.c.  Given a tuple belonging to 
 *  the specified relation, find all catcaches it could be in, compute the 
 *  correct hash value for each such catcache, and call the specified 
 *  function to record the cache id and hash value in inval.c's lists. 
 *  SysCacheInvalidate will be called later, if appropriate, 
 *  using the recorded information. 
 * 
 *  For an insert or delete, tuple is the target tuple and newtuple is NULL. 
 *  For an update, we are called just once, with tuple being the old tuple 
 *  version and newtuple the new version.  We should make two list entries 
 *  if the tuple's hash value changed, but only one if it didn't. 
 * 
 *  Note that it is irrelevant whether the given tuple is actually loaded 
 *  into the catcache at the moment.  Even if it's not there now, it might 
 *  be by the end of the command, or there might be a matching negative entry 
 *  to flush --- or other backends' caches might have such entries --- so 
 *  we have to make list entries to flush it later. 
 * 
 *  Also note that it's not an error if there are no catcaches for the 
 *  specified relation.  inval.c doesn't know exactly which rels have 
 *  catcaches --- it will call this routine for any tuple that's in a 
 *  system relation. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1831"></a><span class='Declare_Function'>PrepareToInvalidateCacheTuple</span><span class='Parentheses'>(</span><a href="../../../include/utils/relcache.h.html#LN20"><span class='Ref_to_Typedef'>Relation</span></a> <span class='Declare_Parameter'>relation</span><span class='Delimiter'>, 
</span><a name="LN1832"></a>                              <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Delimiter'>, 
</span><a name="LN1833"></a>                              <a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>newtuple</span><span class='Delimiter'>, 
</span><a name="LN1834"></a>                              <span class='Keyword'>void </span><span class='Parentheses'>(</span><span class='Operator'>*</span><span class='Declare_Parameter'>function</span><span class='Parentheses'>) (</span><span class='Keyword'>int</span><span class='Delimiter'>, </span><a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a><span class='Delimiter'>, </span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>))</span> 
<span class='Delimiter'>{ 
</span><a name="LN1836"></a>    <a href="../../../include/lib/ilist.h.html#LN223"><span class='Ref_to_Struct'>slist_iter</span></a>  <span class='Declare_Local'>iter</span><span class='Delimiter'>; 
</span><a name="LN1837"></a>    <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>reloid</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN56"><span class='Ref_to_Macro'>CACHE1_elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN23"><span class='Ref_to_Const'>DEBUG2</span></a><span class='Delimiter'>, </span><span class='String'>"PrepareToInvalidateCacheTuple: called"</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* 
     * sanity checks 
     */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/utils/rel.h.html#LN389"><span class='Ref_to_Macro'>RelationIsValid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1831"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN76"><span class='Ref_to_Macro'>HeapTupleIsValid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1832"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="../../../include/c.h.html#LN525"><span class='Ref_to_Macro'>PointerIsValid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1834"><span class='Ref_to_Parameter'>function</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a> <span class='Operator'>!= </span><span class='Null_Value'>NULL</span><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="catcache.c.html#LN1837"><span class='Ref_To_Local'>reloid</span></a> <span class='Operator'>= </span><a href="../../../include/utils/rel.h.html#LN416"><span class='Ref_to_Macro'>RelationGetRelid</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1831"><span class='Ref_to_Parameter'>relation</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* ---------------- 
     *  for each cache 
     *     if the cache contains tuples from the specified relation 
     *         compute the tuple's hash value(s) in this cache, 
     *         and call the passed function to register the information. 
     * ---------------- 
     */ 
</span> 
    <a href="../../../include/lib/ilist.h.html#LN699"><span class='Ref_to_Macro'>slist_foreach</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1836"><span class='Ref_To_Local'>iter</span></a><span class='Delimiter'>, </span><span class='Operator'>&</span><a href="catcache.c.html#LN72"><span class='Ref_to_Global_Var'>CacheHdr</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN160"><span class='Ref_to_Member'>ch_caches</span></a><span class='Parentheses'>) 
</span>    <span class='Delimiter'>{ 
</span><a name="LN1861"></a>        <a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a>   <span class='Operator'>*</span><span class='Declare_Local'>ccp</span> <span class='Operator'>= </span><a href="../../../include/lib/ilist.h.html#LN673"><span class='Ref_to_Macro'>slist_container</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN36"><span class='Ref_to_Typedef'>CatCache</span></a><span class='Delimiter'>, </span>cc_next<span class='Delimiter'>, </span><a href="catcache.c.html#LN1836"><span class='Ref_To_Local'>iter</span></a><span class='Operator'>.</span><a href="../../../include/lib/ilist.h.html#LN225"><span class='Ref_to_Member'>cur</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span><a name="LN1862"></a>        <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>hashvalue</span><span class='Delimiter'>; 
</span><a name="LN1863"></a>        <a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a>         <span class='Declare_Local'>dbid</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1861"><span class='Ref_To_Local'>ccp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN41"><span class='Ref_to_Member'>cc_reloid</span></a> <span class='Operator'>!= </span><a href="catcache.c.html#LN1837"><span class='Ref_To_Local'>reloid</span></a><span class='Parentheses'>) 
</span>            <span class='Control'>continue</span><span class='Delimiter'>; 
</span> 
        <span class='Comment_Multi_Line'>/* Just in case cache hasn't finished initialization yet... */ 
</span>        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1861"><span class='Ref_To_Local'>ccp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN44"><span class='Ref_to_Member'>cc_tupdesc</span></a> <span class='Operator'>== </span><span class='Null_Value'>NULL</span><span class='Parentheses'>) 
</span>            <a href="catcache.c.html#LN85"><span class='Ref_to_Proto'>CatalogCacheInitializeCache</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1861"><span class='Ref_To_Local'>ccp</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <a href="catcache.c.html#LN1862"><span class='Ref_To_Local'>hashvalue</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN77"><span class='Ref_to_Proto'>CatalogCacheComputeTupleHashValue</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1861"><span class='Ref_To_Local'>ccp</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1832"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <a href="catcache.c.html#LN1863"><span class='Ref_To_Local'>dbid</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN1861"><span class='Ref_To_Local'>ccp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN43"><span class='Ref_to_Member'>cc_relisshared</span></a> <span class='Operator'>? </span><span class='Parentheses'>(</span><a href="../../../include/postgres_ext.h.html#LN30"><span class='Ref_to_Typedef'>Oid</span></a><span class='Parentheses'>) </span><span class='Number'>0</span> <span class='Operator'>: </span><a href="../init/globals.c.html#LN76"><span class='Ref_to_Global_Var'>MyDatabaseId</span></a><span class='Delimiter'>; 
</span> 
        <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="catcache.c.html#LN1834"><span class='Ref_to_Parameter'>function</span></a><span class='Parentheses'>) (</span><a href="catcache.c.html#LN1861"><span class='Ref_To_Local'>ccp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1862"><span class='Ref_To_Local'>hashvalue</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1863"><span class='Ref_To_Local'>dbid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
        <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1833"><span class='Ref_to_Parameter'>newtuple</span></a><span class='Parentheses'>) 
</span>        <span class='Delimiter'>{ 
</span><a name="LN1879"></a>            <a href="../../../include/c.h.html#LN267"><span class='Ref_to_Typedef'>uint32</span></a>      <span class='Declare_Local'>newhashvalue</span><span class='Delimiter'>; 
</span> 
            <a href="catcache.c.html#LN1879"><span class='Ref_To_Local'>newhashvalue</span></a> <span class='Operator'>= </span><a href="catcache.c.html#LN77"><span class='Ref_to_Proto'>CatalogCacheComputeTupleHashValue</span></a><span class='Parentheses'>(</span><a href="catcache.c.html#LN1861"><span class='Ref_To_Local'>ccp</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1833"><span class='Ref_to_Parameter'>newtuple</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
            <span class='Control'>if</span> <span class='Parentheses'>(</span><a href="catcache.c.html#LN1879"><span class='Ref_To_Local'>newhashvalue</span></a> <span class='Operator'>!= </span><a href="catcache.c.html#LN1862"><span class='Ref_To_Local'>hashvalue</span></a><span class='Parentheses'>) 
</span>                <span class='Parentheses'>(</span><span class='Operator'>*</span><a href="catcache.c.html#LN1834"><span class='Ref_to_Parameter'>function</span></a><span class='Parentheses'>) (</span><a href="catcache.c.html#LN1861"><span class='Ref_To_Local'>ccp</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1879"><span class='Ref_To_Local'>newhashvalue</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1863"><span class='Ref_To_Local'>dbid</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span>        <span class='Delimiter'>} 
</span>    <span class='Delimiter'>} 
}</span><span class='Auto_Annotations'> &laquo; end PrepareToInvalidateCacheTuple &raquo; </span> 
 
 
<span class='Comment_Multi_Line'>/* 
 * Subroutines for warning about reference leaks.  These are exported so 
 * that resowner.c can call them. 
 */ 
</span><span class='Keyword'>void 
</span><a name="LN1895"></a><span class='Declare_Function'>PrintCatCacheLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/access/htup.h.html#LN69"><span class='Ref_to_Typedef'>HeapTuple</span></a> <span class='Declare_Parameter'>tuple</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span><a name="LN1897"></a>    <a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a>    <span class='Operator'>*</span><span class='Declare_Local'>ct</span> <span class='Operator'>= </span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a> <span class='Operator'>*</span><span class='Parentheses'>) (((</span><span class='Keyword'>char </span><span class='Operator'>*</span><span class='Parentheses'>) </span><a href="catcache.c.html#LN1895"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>)</span> <span class='Operator'>- 
</span>                                  <a href="../../../include/c.h.html#LN554"><span class='Ref_to_Macro'>offsetof</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN77"><span class='Ref_to_Typedef'>CatCTup</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1895"><span class='Ref_to_Parameter'>tuple</span></a><span class='Parentheses'>))</span><span class='Delimiter'>; 
</span> 
    <span class='Comment_Multi_Line'>/* Safety check to ensure we were handed a cache entry */ 
</span>    <span class='Debug'>Assert</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1897"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN79"><span class='Ref_to_Member'>ct_magic</span></a> <span class='Operator'>== </span><a href="../../../include/utils/catcache.h.html#LN80"><span class='Ref_to_Const'>CT_MAGIC</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
</span> 
    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"cache reference leak: cache %s (%d), tuple %u/%u has count %d"</span><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN1897"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN81"><span class='Ref_to_Member'>my_cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1897"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN81"><span class='Ref_to_Member'>my_cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, 
</span>         <a href="../../../include/storage/itemptr.h.html#LN74"><span class='Ref_to_Macro'>ItemPointerGetBlockNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1895"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>         <a href="../../../include/storage/itemptr.h.html#LN93"><span class='Ref_to_Macro'>ItemPointerGetOffsetNumber</span></a><span class='Parentheses'>(</span><span class='Operator'>&</span><span class='Parentheses'>(</span><a href="catcache.c.html#LN1895"><span class='Ref_to_Parameter'>tuple</span></a><span class='Operator'>-&GT;</span><a href="../../../include/access/htup.h.html#LN64"><span class='Ref_to_Member'>t_self</span></a><span class='Parentheses'>))</span><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN1897"><span class='Ref_To_Local'>ct</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN111"><span class='Ref_to_Member'>refcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span> 
<span class='Keyword'>void 
</span><a name="LN1911"></a><span class='Declare_Function'>PrintCatCacheListLeakWarning</span><span class='Parentheses'>(</span><a href="../../../include/utils/catcache.h.html#LN119"><span class='Ref_to_Typedef'>CatCList</span></a> <span class='Operator'>*</span><span class='Declare_Parameter'>list</span><span class='Parentheses'>) 
</span><span class='Delimiter'>{ 
</span>    <a href="../../bootstrap/bootscanner.l.html#LN129"><span class='Ref_to_Proto'>elog</span></a><span class='Parentheses'>(</span><a href="../../../include/utils/elog.h.html#LN39"><span class='Ref_to_Const'>WARNING</span></a><span class='Delimiter'>, </span><span class='String'>"cache reference leak: cache %s (%d), list %p has count %d"</span><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN1911"><span class='Ref_to_Parameter'>list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN123"><span class='Ref_to_Member'>my_cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN40"><span class='Ref_to_Member'>cc_relname</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1911"><span class='Ref_to_Parameter'>list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN123"><span class='Ref_to_Member'>my_cache</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN38"><span class='Ref_to_Member'>id</span></a><span class='Delimiter'>, 
</span>         <a href="catcache.c.html#LN1911"><span class='Ref_to_Parameter'>list</span></a><span class='Delimiter'>, </span><a href="catcache.c.html#LN1911"><span class='Ref_to_Parameter'>list</span></a><span class='Operator'>-&GT;</span><a href="../../../include/utils/catcache.h.html#LN147"><span class='Ref_to_Member'>refcount</span></a><span class='Parentheses'>)</span><span class='Delimiter'>; 
} 
</span></pre>
<table bgcolor='#c0c0c0' width='100%'><tr><td><a href='../../../../Contents.html'>Contents</a></td></tr>
</table><hr><p class='blurb' align='center'><a href='http://www.sourceinsight.com'>HTML Created by Source Insight Version 4.00.0084 Built on 2017-02-26</a></p>
</body></html>